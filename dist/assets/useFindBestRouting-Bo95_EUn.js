import{e as I,A as d}from"./useSwapHelper-CKwapxYx.js";import{aH as P,c3 as C,a8 as E,bh as f,aJ as y}from"./index-D49RffYW.js";function _(){const{aggregatorSDK:g}=P(),{getSwapPoolAddress:A}=I(),{deepbookV3Config:D,setDeepbookV3Config:w,providers:p}=C(),h=n=>n&&n.error?n.error.code===d.InsufficientLiquidity||d.HoneyPot||d.NumberTooLarge:!1,b=async n=>{const e=p.length>0?n.filter(t=>p.includes(t)):n;if(n.includes("DEEPBOOKV3")){let t=D;const u=new Date().getTime()/1e3;if(t===null||u-((t==null?void 0:t.last_update_time)||0)>60)try{t=await g.getDeepbookV3Config(),w(t)}catch{}if(t&&t.is_alternative_payment){const{deep_fee_vault:a}=t;if(a<E(20,6))return e.filter(o=>o!=="DEEPBOOKV3")}}return e},v=async n=>{const{fromToken:e,toToken:t,amount:u,providersKeys:a,by_amount_in:o,uuid:s}=n;try{const i={from:e.coin_type,target:t.coin_type,amount:new f(u),byAmountIn:o,depth:3,splitAlgorithm:void 0,splitFactor:void 0,splitCount:void 0,providers:a},r=await g.findRouters(i);if(r&&h(r))return c(!1,o,s,e,t,r);if(!r||r.routes.length===0)throw Error("not find router");return c(!1,o,s,e,t,r)}catch{try{const r=await A(e,t);if(r.length===0){const S={amountIn:new f("0"),amountOut:new f("0"),byAmountIn:o,routes:[],insufficientLiquidity:!0,error:{code:d.NoRouter,msg:""}};return c(!0,o,s,e,t,S)}const m={from:e.coin_type,target:t.coin_type,amount:new f(u),byAmountIn:o,pools:r},l=await g.swapInPools(m);return!l||!l.routeData?c(!0,o,s,e,t):c(!0,o,s,e,t,l.routeData)}catch{return{uuid:s,byAmountIn:o,isDegrade:!0}}}},c=(n,e,t,u,a,o)=>{var s;if(o){const i=o.error!==void 0,r=y(o.amountIn.toString(),u.decimals).toString(),m=y(o.amountOut.toString(),a.decimals).toString();return{routerData:i?void 0:o,fromAmountUi:i?e?r:"":r,toAmountUi:i&&e?"":m,uuid:t,byAmountIn:e,isDegrade:n,errorCode:(s=o.error)==null?void 0:s.code}}else return{uuid:t,byAmountIn:e,isDegrade:n}};return{findBestRouters:v,checkProvidersKeys:b}}export{_ as u};
