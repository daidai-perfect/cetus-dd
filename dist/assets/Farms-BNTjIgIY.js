import{a as n,j as e,V as _,T as C,f as N,p as f,q as $,H as k,S as X}from"./vendor-BowHGuwE.js";import{a as as}from"./ExpendItem-De11Bq_6.js";import{u as Y,b as D}from"./usePositionList-DEh0XQ33.js";import{n as A,R as is,d as E,r as M,q as O,I as ns,a as q,j as ds}from"./index-gsbUcTxN.js";import{N as Z}from"./NoData-DwPvHKvw.js";import{A as xs}from"./index-DkKc3htU.js";import{V as ms,R as ps,S as gs,T as cs,F as hs,a as us}from"./FarmsTable-B4mhsbSZ.js";import{R as bs}from"./RefreshButton-DTYedI-5.js";import{S as js}from"./SortDropBlock-Bf1ApppS.js";import{u as fs}from"./useGetPoolList-PUHyLeM6.js";import{u as Ls}from"./useAccountBalance-Cj6v5Cs9.js";import{u as Ss}from"./useRpcListener-Dfdz2AWu.js";import"./useTransaction-BS5tAjv5.js";import"./useTrack-B5UsnSsf.js";import"./useSigner-DttmdQdc.js";import"./msafe-oYBkW7LJ.js";import"./SingleTokenInfo-Cp98kdQx.js";import"./useToken-D86igCts.js";import"./CopyButton-Cwc4Cc5l.js";import"./PositionStatus-BBiWDW8f.js";import"./RangeValue-ClNqvZmo.js";import"./useFavoritePool-8IeshSiD.js";import"./useWrapPoolData-Bn6yqwG9.js";import"./global-BYj4jnQG.js";import"./CoinPairInfo-Bbvpvgxp.js";import"./PoweredByHaedal-uLEk4Xbu.js";import"./usePreviousValue-ChnvxeJQ.js";function Rs(s){const{totalRewards:d}=s,{currentAccount:o}=A(),{posBaseList:r}=Y(),{getPositionBaseList:p,getPosRelatedData:l}=D(),{toClaimAllPos:c,claimLoading:j}=as(),a=n.useRef(null),L=async()=>{if(o!=null&&o.address){const y=await p(o==null?void 0:o.address);l(y,!0)}},g=()=>{c(r,L)};return n.useEffect(()=>{a!=null&&a.current&&(a.current.textContent=is(d,2))},[d]),e.jsx(_,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(_,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(C,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(C,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(o==null?void 0:o.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(f,{isLoaded:!!d,children:e.jsx(C,{color:"primary",fontSize:"20px",fontWeight:"500",ref:a})})}),(o==null?void 0:o.address)&&e.jsx($,{isLoading:j,disabled:j||d=="--"?!0:E(d).lte(0),h:"28px",fontSize:"14px",borderRadius:"8px",onClick:g,children:"Claim All Rewards"})]})})}function ys({dataList:s,showSkeletonLoading:d,currTabLabel:o}){const{currentAccount:r,onWalletModal:p}=A();return e.jsx(e.Fragment,{children:o=="Your Farms"&&!(r!=null&&r.address)?e.jsx(Z,{type:"nowallet",onboard:()=>{p(!0)}}):d?e.jsx(vs,{}):s.length===0?e.jsx(Z,{type:"nodata",text:"No farms found"}):e.jsx(_,{w:"100%",children:s.map(l=>e.jsx(Ts,{apiInfo:l},l==null?void 0:l.poolAddress))})})}const Ts=({apiInfo:s})=>{const{getTokenAmountValue:d}=M(),{coinPriceObj:o}=O();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:r,onWalletModal:p}=A(),[l,c]=n.useState({}),{farmsPosRewardsDataLoading:j,farmsPosRewardsData:a,posBaseListLoading:L,posBaseListGroupByPool:g}=Y(),y=n.useMemo(()=>{var S;if(!(r!=null&&r.address)||!(s!=null&&s.poolAddress))return"--";if(!L&&!j)return(((S=g[s.poolAddress])==null?void 0:S.list)||[]).reduce((h,x)=>{const T=a[x==null?void 0:x.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",h,T);const m=T.reduce((W,v)=>{if(W==="--")return"--";const b=d(v==null?void 0:v.token.coin_type,v==null?void 0:v.display_amount_owed,"--");return b==="--"?"--":E(W).plus(b).toString()},"0");return h==="--"||m==="--"?"--":E(h).plus(m).toString()},"0")},[L,a,j,o,r==null?void 0:r.address]),w=n.useMemo(()=>{var R,h;const S=((h=(R=g==null?void 0:g[s==null?void 0:s.poolAddress])==null?void 0:R.list)==null?void 0:h.filter(x=>x.posType!=="burn").sort((x,T)=>Number(T.liquidity)-Number(x.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",S),S},[s==null?void 0:s.poolAddress,g]);return e.jsxs(_,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(ms,{apiInfo:s}),e.jsx(V,{label:"Staked TVL",value:e.jsx(C,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(V,{label:"APR",value:e.jsx(xs,{poolInfo:s,isPosition:!0})}),e.jsx(V,{label:"Rewards / day",value:e.jsx(ps,{apiInfo:s})}),e.jsx(V,{label:"Your Staked",value:e.jsx(gs,{apiInfo:s})}),e.jsx(V,{label:"Your Earned",value:e.jsx(cs,{totalEarned:y,apiInfo:s,disabled:y=="--"?!0:E(y).lte(0)})}),e.jsx($,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{l[s==null?void 0:s.poolAddress]?l[s==null?void 0:s.poolAddress]=!1:l[s==null?void 0:s.poolAddress]=!0,c({...l})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(ns,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:l[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),l[s==null?void 0:s.poolAddress]&&e.jsx(hs,{expendList:w,apiInfo:s})]})},V=({label:s,value:d})=>e.jsxs(k,{w:"100%",justify:"space-between",children:[e.jsx(C,{children:s}),d]}),vs=()=>e.jsx(_,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,d)=>e.jsxs(_,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(k,{gap:"0",children:[e.jsx(X,{size:"9"}),e.jsx(X,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(f,{height:"4",width:"150px"})]}),e.jsxs(k,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(k,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(k,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(k,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]})]},d))});function ks(s){const{sortByList:d,currTab:o,tabList:r,handleChangeTab:p,currSortType:l,onSortByChange:c,sortRule:j,handleRefresh:a,handleChangeSortRule:L}=s,{isApp:g}=q();return e.jsxs(k,{w:"100%",mt:{base:"20px",lg:"40px"},justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[e.jsx(ds,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"415px"},h:"46px",borderRadius:{base:"8px",lg:"12px"}},itemStyle:{w:"50%",fontSize:"16px"},tabList:r,currentTab:o.label,handleChangeTab:p}),e.jsxs(k,{w:{base:"100%",lg:"unset"},children:[e.jsx(js,{sortText:"Sort by",xlinkHref:j=="desc"?"#icon-icon_sort2":"#icon-icon_sort_asc1",iconOnClick:()=>{L(j==="asc"?"desc":"asc")},minW:g?"calc(100vw - 126px)":"120px",currentSort:l,sortByList:d,onSortByChange:c,wrapStyle:{borderRadius:{base:"8px",lg:"12px"}}}),e.jsx(bs,{handleRefresh:a,borderRadius:{base:"8px",lg:"12px"}})]})]})}function ws(){const{getPoolList:s}=fs();return{getFarmList:async(o="-tvl")=>{var p;const r=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",r),(p=r==null?void 0:r.list)==null?void 0:p.sort((l,c)=>o==="-apr"?c.feeAndFarmsApr-l.feeAndFarmsApr:o==="apr"?l.feeAndFarmsApr-c.feeAndFarmsApr:o==="-tvl"?c.farmsStatedTvl-l.farmsStatedTvl:l.farmsStatedTvl-c.farmsStatedTvl)}}}function ee(){const{currentAccount:s}=A(),{getPositionBaseList:d,getPosRelatedData:o}=D(),{posBaseList:r,posBaseListLoading:p,farmsPosRewardsData:l,farmsPosRewardsDataLoading:c}=Y(),{getFarmList:j}=ws(),[a,L]=n.useState([]),[g,y]=n.useState([]),[w,S]=n.useState([]),[R,h]=n.useState(!0),[x,T]=n.useState([]);Ls();const[m,W]=n.useState({label:"Live"}),v=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[b,G]=n.useState({sortRule:"desc",sortType:"tvl"}),[I,ss]=n.useState({label:"TVL",value:"tvl"}),es=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:R?void 0:g.length.toString()}),t.push({label:"Your Farms",num:w.length>0&&(s!=null&&s.address)&&!R?w.length.toString():void 0}),t},[m.label,R,g,w,s==null?void 0:s.address]),Q=async()=>{if(s!=null&&s.address){const t=await d(s==null?void 0:s.address);console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address),o(t,!0)}else T([])},z=async t=>{const i=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,F=await j(i);F&&L(F)};n.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",x),a.length>0){if(m.label=="Live"&&(y(a.filter(t=>t==null?void 0:t.haveFarming)),h(!1)),s!=null&&s.address&&(x==null?void 0:x.length)>0){const t=a.filter(i=>(x==null?void 0:x.filter(u=>(u==null?void 0:u.posType)==="farms")).some(u=>(i==null?void 0:i.poolAddress)===(u==null?void 0:u.clmmPool)));S(t)}else S([]);p||h(!1)}else y([]),S([])},[m.label,a,s==null?void 0:s.address,x,p]),n.useEffect(()=>{z(b),s!=null&&s.address?(h(!0),Q()):T([])},[s==null?void 0:s.address]),n.useEffect(()=>{T(r)},[r]);const J=()=>{h(!0),z(b),Q()};Ss({onRpcChange:()=>{J()}});const{fetchTokenPrices:ts}=M(),os=()=>{const t=[];a==null||a.forEach(i=>{var F,u;t.includes(i.tokenA.coin_type)||t.push(i.tokenA.coin_type),t.includes(i.tokenB.coin_type)||t.push(i.tokenB.coin_type),((F=i==null?void 0:i.farmsRewarderList)==null?void 0:F.length)>0&&((u=i==null?void 0:i.farmsRewarderList)==null||u.forEach(P=>{t.push(P==null?void 0:P.coinType)}))}),t.length>0&&ts(Array.from(new Set(t)))};n.useEffect(()=>{(a==null?void 0:a.length)>0&&os()},[a]);const{getTokenAmountValue:rs}=M(),{coinPriceObj:ls}=O(),K=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!p&&!c)return r.reduce((t,i)=>{const u=(l[i==null?void 0:i.id]||[]).reduce((P,B)=>{if(P==="--")return"--";const U=rs(B==null?void 0:B.token.coin_type,B==null?void 0:B.display_amount_owed,"--");return U==="--"?"--":E(P).plus(U).toString()},"0");return t==="--"||u==="--"?"--":E(t).plus(u).toString()},"0")},[p,l,c,ls,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",K);const{isApp:H}=q();return e.jsxs(_,{gap:"20px",w:"100%",children:[e.jsx(Rs,{totalRewards:K}),e.jsx(N,{h:"220px"}),e.jsx(ks,{sortByList:v,currTab:m,tabList:es,handleChangeTab:t=>{W(t)},currSortType:I,onSortByChange:t=>{h(!0),b.sortType=t.value,G({...b}),ss(t),z(b)},sortRule:b.sortRule,handleChangeSortRule:t=>{h(!0),b.sortRule=t,G({...b}),z(b)},handleRefresh:J}),H&&e.jsx(C,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!H&&e.jsx(us,{dataList:m.label=="Live"?g:w,showSkeletonLoading:R,currTabLabel:m==null?void 0:m.label}),H&&e.jsx(ys,{dataList:m.label=="Live"?g:w,showSkeletonLoading:R,currTabLabel:m==null?void 0:m.label})]})}export{ee as default};
//# sourceMappingURL=Farms-BNTjIgIY.js.map
