import{U as E,bT as L,bU as N,bV as W,bW as M,bX as X,u as $,am as Y,R as U,r as q,X as v,aH as C,bc as b,bi as H,bh as x,d as h,aa as I,a9 as B,bY as K,aX as S,bZ as Z,b_ as z}from"./index-D49RffYW.js";import{u as j}from"./useToken-BlS8b5ft.js";import{m as J}from"./api-data-utils-D656F-wl.js";import{u as Q,d as ee,e as oe,c as te,f as G,h as se}from"./useGetPoolList-DBJielhS.js";const ne=(s,T)=>({poolListLength:"",setPoolListLength:e=>{s(()=>({poolListLength:e}))},poolRefreshStatus:"pending",setPoolRefreshStatus:e=>{s(()=>({poolRefreshStatus:e}))},isWatchList:void 0,setIsWatchList:e=>{s(()=>({isWatchList:e})),L.setItem(W,e)},isAllPools:!1,setIsAllPools:e=>{s(()=>({isAllPools:e})),L.setItem(M,e)},isIncentivizedOnly:!1,setIsIncentivizedOnly:e=>{s(()=>({isIncentivizedOnly:e})),L.setItem(X,e)},poolFavoriteIds:[],setPoolFavoriteId:e=>{const m=[...T().poolFavoriteIds,e];s(()=>({poolFavoriteIds:m})),L.setItem(N,m)},setPoolFavoriteIds:e=>{s(()=>({poolFavoriteIds:e})),L.setItem(N,e)},poolFavoriteIdsChange:!1,setPoolFavoriteIdsChange:e=>{s(()=>({poolFavoriteIdsChange:e}))}}),O=E(ne);L.getItem(N).then(s=>{(s==null?void 0:s.length)>0&&O.getState().setPoolFavoriteIds(s)});L.getItem(W).then(s=>{typeof s=="boolean"?O.getState().setIsWatchList(s):O.getState().setIsWatchList(!1)});L.getItem(M).then(s=>{typeof s=="boolean"&&O.getState().setIsAllPools(s)});L.getItem(X).then(s=>{typeof s=="boolean"&&O.getState().setIsIncentivizedOnly(s)});function ae(){const{fetchByApi:s}=$(),{getLocalJsonPoolList:T}=Q(),{wrapPoolData:e}=ee(),{poolFavoriteIds:m,setPoolFavoriteId:l,setPoolFavoriteIds:i,setPoolFavoriteIdsChange:f}=O(),{successTsToast:P,failedTsToast:n}=Y();return{addFavorites:r=>{const o={linkLabel:"",getShowInfo:()=>({toastTitleText:m.length>=100?"Watchlist exceeds the maximum limit":"Added to Watchlist"})};m.length>=100?n(o):(l(r),f(!0),P(o))},removeFavorites:r=>{const o=m==null?void 0:m.filter(g=>g!==r);i(o),f(!0),P({linkLabel:"",getShowInfo:()=>({toastTitleText:"Removed from Watchlist"})})},getFavoritePoolList:async r=>{var g,y,w;const{needLocalData:o=!0}=r;if(((r==null?void 0:r.pools)||[]).length>0)try{const c=await s(J,"POST",r);if(c!=null&&c.data)return{list:(y=(g=c==null?void 0:c.data)==null?void 0:g.lp_list)==null?void 0:y.map(k=>e(k)),total:(w=c==null?void 0:c.data)==null?void 0:w.total}}catch{if(o)return await T(r)}return{list:[],total:0}}}}const re=(s,T)=>({showPosListLength:"",setShowPosListLength:e=>{s(()=>({showPosListLength:e}))},posApiPoolData:{},setPosApiPoolData:e=>{s(()=>({posApiPoolData:e}))},myPosYieldValue:"",setMyPosYieldValue:e=>{s(()=>({myPosYieldValue:e}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:e=>{const m=e.reduce((l,i)=>{var f,P,n;return l[i.clmmPool]||(l[i.clmmPool]={list:[]}),(f=l[i.clmmPool])!=null&&f.tokenA||(l[i.clmmPool].isReverse=i==null?void 0:i.isReverse,l[i.clmmPool].tokenA=i==null?void 0:i.tokenA,l[i.clmmPool].tokenB=i==null?void 0:i.tokenB,l[i.clmmPool].displayTokenA=i==null?void 0:i.displayTokenA,l[i.clmmPool].displayTokenB=i==null?void 0:i.displayTokenB,l[i.clmmPool].clmmPoolAddress=i.clmmPool),(n=(P=l[i.clmmPool])==null?void 0:P.list)==null||n.push(i),l},{});s(()=>({posBaseList:e,posBaseListGroupByPool:m,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:e=>{s(()=>({posBaseListLoading:e}))},setPosBaseListIsLoading:e=>{s(()=>({posBaseListLoading:e}))},fullRangePosBaseList:[],setFullRangePosBaseList:e=>{s(()=>({fullRangePosBaseList:e,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:e=>{s(()=>({fullRangePosBaseListLoading:e}))},posPoolsOriginalData:{},setPosPoolOriginalData:e=>{s(()=>({posPoolsOriginalData:e}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:e=>{s(()=>({posPoolsRelatedData:e,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:e=>{s(()=>({posPoolsRelatedDataLoading:e}))},posLiquidityData:{},setPosLiquidityData:e=>{s(()=>({posLiquidityData:e,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:e=>{s(()=>({posLiquidityDataLoading:e}))},posRewardsData:{},setPosRewardsData:e=>{s(()=>({posRewardsData:e,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:e=>{s(()=>({posRewardsDataLoading:e}))},farmsPosRewardsData:{},setFarmsPosRewardsData:e=>{s(()=>({farmsPosRewardsData:e,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:e=>{s(()=>({farmsPosRewardsDataLoading:e}))},posFeeData:{},setPosFeeData:e=>{s(()=>({posFeeData:e,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:e=>{s(()=>({posFeeDataLoading:e}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:e=>{s(()=>({currentPosBaseInfo:e,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:e=>{s(()=>({currentPosBaseInfoLoading:e}))}}),F=E(re);function ie(){const{peripherySdk:s}=U(),{getTokenInfo:T}=j(),{setFarmsPosRewardsData:e,setFarmsPosRewardsDataLoading:m}=F(),l=q.useRef(s);return q.useEffect(()=>{l.current=s},[s.ClmmSDK.senderAddress]),{getFarmsRewardsData:async f=>{m(!0);const P=f==null?void 0:f.filter(n=>n.posType==="farms").map(n=>({pool_id:n.farmsPool,position_nft_id:n.id}));try{let n={},a={};if(P&&P.length>0&&(n=await l.current.Farms.calculateFarmingRewards(P),n)){const t=Object.entries(n).map(([u,r])=>({id:u,rewarderAmountOwed:r}));a=Object.fromEntries(t.map((u,r)=>{for(const o of u.rewarderAmountOwed){const{rewarder_amount:p,rewarder_type:g}=o,y=T(g);o.display_amount_owed=v(p.toString(),(y==null?void 0:y.decimals)||0),o.amount_owed=p.toString(),o.token=y}return[u.id,u.rewarderAmountOwed]}))}e(a)}catch{}}}}function ce(){const{setPosApiPoolData:s}=F(),{getFavoritePoolList:T}=ae();return{getPosApiPoolData:async m=>{try{const i={needLocalData:!1,pools:Array.from(new Set(m==null?void 0:m.map(n=>n.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0},f=await T(i)||[],P=f==null?void 0:f.list.reduce((n,a)=>(n[a.poolAddress]=a,n),{});s(P)}catch{}}}}function le(){const{clmmSdk:s}=C(),{setPosFeeData:T,setPosFeeDataLoading:e}=F();return{getPosFeeData:async l=>{e(!0);const i=l==null?void 0:l.map(n=>({poolAddress:n.clmmPool,positionId:n.posId,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB})),f=await s.Position.fetchPosFeeAmount(i)||[],P=Object.fromEntries(f.map((n,a)=>{var o,p;const t=l[a],u=v(t.isReverse?n.feeOwedB.toString():n.feeOwedA.toString(),((o=t==null?void 0:t.displayTokenA)==null?void 0:o.decimals)||0),r=v(t.isReverse?n.feeOwedA.toString():n.feeOwedB.toString(),((p=t==null?void 0:t.displayTokenB)==null?void 0:p.decimals)||0);return[n.position_id,{feeOwedA:n.feeOwedA.toString(),feeOwedB:n.feeOwedB.toString(),displayFeeOwedA:u,displayFeeOwedB:r}]}));T(P)}}}function de(){const{setPosLiquidityData:s,setPosLiquidityDataLoading:T}=F(),e=({tokenA:l,tokenB:i,liquidity:f,currentSqrtPrice:P,lowerTick:n,upperTick:a,roundUp:t})=>{const u=b.tickIndexToSqrtPriceX64(n),r=b.tickIndexToSqrtPriceX64(a),o=H.getCoinAmountFromLiquidity(new x(f),new x(P),u,r,t),p=o.coinA.toString(),g=o.coinB.toString(),y=l.decimals,w=i.decimals,c=v(p,y||0),d=v(g,w||0);return{coinAmountA:p,coinAmountB:g,amountA:c,amountB:d}};return{getPosLiquidityData:async(l,i)=>{T(!0);const f={};for(let P=0;P<l.length;P++){const n=l[P],a=i==null?void 0:i[n.clmmPool],{coinAmountA:t,coinAmountB:u,amountA:r,amountB:o}=e({tokenA:n.tokenA,tokenB:n.tokenB,liquidity:n.liquidity,currentSqrtPrice:a==null?void 0:a.current_sqrt_price,lowerTick:n.lowerTick,upperTick:n.upperTick,roundUp:!0}),p=oe(n.lowerTick,n.upperTick),g=n.tokenA.decimals,y=n.tokenB.decimals,w=b.sqrtPriceX64ToPrice(new x(a==null?void 0:a.current_sqrt_price),g,y).toString(),{percentA:c,percentB:d}=te(r,o,w,p);f[n.posId]={coinAmountA:t,coinAmountB:u,displayCoinAmountA:n.isReverse?o:r,displayCoinAmountB:n.isReverse?r:o,displayPercentA:n.isReverse?d:c,displayPercentB:n.isReverse?c:d}}s(f)},getCoinAmountFromLiquidity:e}}function ue(){const{clmmSdk:s}=C(),{setPosPoolOriginalData:T,setPosPoolsRelatedData:e,setPosPoolsRelatedDataLoading:m,setFullRangePosBaseList:l,setFullRangePosBaseListLoading:i}=F();return{getPosPoolsOriginalObj:async n=>{const a=n==null?void 0:n.map(r=>r.clmmPool),t=[...new Set([...a])];let u={};if(t&&t.length>0){const r=await s.Pool.getPools(t,0,1e3);u=Object.fromEntries(r==null?void 0:r.map(o=>{const p=n.find(d=>d.clmmPool===(o==null?void 0:o.poolAddress)),g=p.tokenA.decimals,y=p.tokenB.decimals,w=b.sqrtPriceX64ToPrice(new x(o==null?void 0:o.current_sqrt_price),g,y).toString(),c=h(1).div(w).toString();return[o==null?void 0:o.poolAddress,{...o,currentPrice:w,currentPriceReverse:c}]}))}return T(u),u},getPosPoolsRelatedData:(n,a)=>{m(!0),i(!0);const t={},u=[];n.forEach(r=>{const o=a[r.clmmPool],p=r.tokenA.decimals,g=r.tokenB.decimals,y=b.sqrtPriceX64ToPrice(new x(o==null?void 0:o.current_sqrt_price),p,g).toString(),w=h(1).div(y).toString();let c="0",d="0";G(r.lowerTick,"min")?c="0":c=b.tickIndexToPrice(Number(r.lowerTick),p,g).toString(),G(r.upperTick,"max")?d="∞":d=b.tickIndexToPrice(Number(r.upperTick),p,g).toString();let k,_;d!=="∞"?_=h(1).div(h(d)).toString():_="0",c!=="0"?k=h(1).div(h(c)).toString():k="∞";let A="";o!=null&&o.is_pause?A="Closed":Number(y)>=Number(c)&&(d==="∞"||Number(y)<=Number(d))?A="Active":(Number(y)>Number(d)||Number(y)<Number(c))&&(A="Inactive"),(c==="0"&&d==="∞"||k==="0"&&_==="∞")&&r.posType==="clmm"&&u.push(r);const R=r.isReverse;t[r.posId]={currentPrice:o?I(R?w:y).toString():"",currentPriceReverse:o?I(R?y:w).toString():"",minPrice:I(R?_:c).toString(),minPriceResever:I(R?c:_).toString(),maxPrice:I(R?k:d).toString(),maxPriceResever:I(R?d:k).toString(),minPriceOrigin:o?R?_:c:"",maxPriceOrigin:o?R?k:d:"",currentStatus:o?A:"",fee:o==null?void 0:o.fee_rate,displayFee:h(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),e(t),l(u)}}}function Pe(){const{clmmSdk:s}=C(),{getTokenInfo:T}=j(),{setPosRewardsData:e,setPosRewardsDataLoading:m}=F();return{getPosRewardsData:async(i,f)=>{m(!0);const P=i==null?void 0:i.filter(a=>a.posType!=="farms").map(a=>{const t=f[a.clmmPool];return{poolAddress:a.clmmPool,positionId:a.posId,coinTypeA:a.coinTypeA,coinTypeB:a.coinTypeB,rewarderInfo:t.rewarder_infos}});let n={};if(P&&P.length>0)try{const a=await s.Rewarder.fetchPosRewardersAmount(P);n=Object.fromEntries(a.map((t,u)=>{for(const r of t.rewarderAmountOwed){const{amount_owed:o,coin_address:p}=r,g=T(p);r.display_amount_owed=v(o.toString(),(g==null?void 0:g.decimals)||0),r.amount_owed=o.toString(),r.token=g}return[t.positionId,t.rewarderAmountOwed]}))}catch{}e(n)}}}function V(){const s=(l,i)=>{if(i||i==0)return`Cetus LP | Pool${i}-${l}`},T=q.useMemo(()=>`${B.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[B]),e=q.useMemo(()=>`${B.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[B]),m=q.useMemo(()=>`${B.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[B]);return{getClmmPosName:s,buildPositionType:T,buildFarmsPositionType:e,buildBurnPositionType:m}}function pe(){const{buildPositionType:s,buildFarmsPositionType:T,buildBurnPositionType:e}=V(),{getTokenInfo:m}=j(),l=(a,t)=>{const u=!se(a,t),r=m(a),o=m(t);return{isReverse:u,tokenA:r,tokenB:o,displayTokenA:u?o:r,displayTokenB:u?r:o}},i=a=>{var d;const t=K(a),u=S(t.coin_type_a).full_address,r=S(t.coin_type_b).full_address,{isReverse:o,tokenA:p,tokenB:g,displayTokenA:y,displayTokenB:w}=l(u,r),c=((d=a==null?void 0:a.data)==null?void 0:d.version)||"0";return{clmmPool:t.pool,posId:t.pos_object_id,id:t.pos_object_id,liquidity:t.liquidity,index:t.index,lowerTick:t.tick_lower_index,upperTick:t.tick_upper_index,owner:t.owner,coinTypeA:u,coinTypeB:r,posType:"clmm",tokenName:"",tokenA:p,tokenB:g,displayTokenA:y,displayTokenB:w,isReverse:o,version:c}},f=a=>{var d;const t=Z.buildFramsPositionNFT(a),u=((d=a==null?void 0:a.data)==null?void 0:d.version)||"0",r=S(t.coinTypeA).full_address,o=S(t.coinTypeB).full_address,{isReverse:p,tokenA:g,tokenB:y,displayTokenA:w,displayTokenB:c}=l(r,o);return{clmmPool:t.clmm_pool_id,farmsPool:t.pool_id,posId:t.clmm_position_id,id:t.id,liquidity:t.liquidity,index:t.name.split("-")[1],lowerTick:t.tick_lower_index,upperTick:t.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"farms",tokenName:t.name,isReverse:p,tokenA:g,tokenB:y,displayTokenA:w,displayTokenB:c,version:u}},P=a=>{var d,k,_;const t=z.buildBurnPositionNFT((k=(d=a==null?void 0:a.data)==null?void 0:d.content)==null?void 0:k.fields),u=((_=a==null?void 0:a.data)==null?void 0:_.version)||"0",r=S(t.coinTypeA).full_address,o=S(t.coinTypeB).full_address,{isReverse:p,tokenA:g,tokenB:y,displayTokenA:w,displayTokenB:c}=l(r,o);return{clmmPool:t.clmm_pool_id,posId:t.clmm_position_id,liquidity:t.liquidity,index:t.index,id:t.id,lowerTick:t.tick_lower_index,upperTick:t.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"burn",tokenName:t.name,isReverse:p,tokenA:g,tokenB:y,displayTokenA:w,displayTokenB:c,version:u}};return{wrapClmmPosBaseInfo:i,wrapBurnPosBaseInfo:P,wrapFarmsPosBaseInfo:f,buildPosBaseInfo:a=>{const t=S(a.data.type);return t.full_address===s?i(a):t.full_address===T?f(a):t.full_address===e?P(a):null}}}function we(){const{clmmSdk:s}=C(),{buildPositionType:T,buildFarmsPositionType:e,buildBurnPositionType:m}=V(),{buildPosBaseInfo:l}=pe(),{setPosBaseList:i,setFullRangePosBaseList:f,setPosBaseListLoading:P}=F(),{getPosPoolsOriginalObj:n,getPosPoolsRelatedData:a}=ue(),{getPosLiquidityData:t}=de(),{getPosFeeData:u}=le(),{getPosApiPoolData:r}=ce(),{getPosRewardsData:o}=Pe(),{getFarmsRewardsData:p}=ie();return{getPositionBaseList:async(w,c)=>{P(!0);try{const d=await s.fullClient.getOwnedObjectsByPage(w,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:B.clmm_sdk_options.clmm_pool.package_id},{StructType:e},{StructType:m}]}}),k=[];for(const R of d.data){const D=l(R);h(D==null?void 0:D.liquidity).lte(0)||!(D!=null&&D.displayTokenA)||!(D!=null&&D.displayTokenB)||D&&k.push(D)}const _=k.sort((R,D)=>D.version-R.version);let A=[];return c?A=_==null?void 0:_.filter(R=>R.clmmPool===c):A=_,i(A),P(!1),(A==null?void 0:A.length)==0&&f([]),A}catch(d){if(console.error("🚀 ~ getPositionBaseList ~ 79 ~ error:",d),d instanceof TypeError)return P(!1),i([]),"Something went wrong, please change the rpc node and try again"}},getPosRelatedData:async(w,c=!1)=>{var d;p(w),c||(r(w),u(w));try{const k=await n(w);a(w,k),((d=Object.keys(k))==null?void 0:d.length)>0&&(t(w,k),c||o(w,k))}catch(k){console.error("🚀 ~ getPosRelatedData ~ error: 96",k)}}}}export{ae as a,V as b,F as c,we as d,le as e,Pe as f,ie as g,de as h,pe as i,O as u};
