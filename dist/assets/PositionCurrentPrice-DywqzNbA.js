import{r as U,R as j,d as S,Y as H,j as R,$ as C,I as v,J as D}from"./index-ptnn7YYs.js";import{a as B,j as i,H as F,u as E,T as b}from"./vendor-DsVemle5.js";import{u as I}from"./useBurn-Dg2fme1h.js";import{M as N}from"./msafe-oYBkW7LJ.js";import{u as O}from"./usePositionList-DPh0B0ja.js";function V(){const{getTokenAmountValue:h}=U(),f=(l,t,e,a)=>{if(!(l!=null&&l.length))return{total:"0",rewardAndFeeList:[]};let n="0";const u=[];l.forEach(c=>{const _=t[c==null?void 0:c.posId],x=e[c==null?void 0:c.posId]||[],P=a?a[c==null?void 0:c.id]:[],y=x.concat(P);if(_){const s=d(c==null?void 0:c.displayTokenA,_==null?void 0:_.displayFeeOwedA),r=d(c==null?void 0:c.displayTokenB,_==null?void 0:_.displayFeeOwedB);s&&u.push(s),r&&u.push(r),n=g(n,s==null?void 0:s.amountUSD,r==null?void 0:r.amountUSD)}y.forEach(s=>{var r;if(Number(s==null?void 0:s.display_amount_owed)>0){const m=d(s==null?void 0:s.token,s==null?void 0:s.display_amount_owed,(r=s==null?void 0:s.token)==null?void 0:r.coin_type);m&&(u.push(m),n=g(n,m==null?void 0:m.amountUSD))}})});const o=p(u);return console.log("ðŸš€ ~ calculatePendingYield ~  total,:",o,n,o.length==1&&(n=="--"||Number(n)==0)),{total:(o==null?void 0:o.length)>0&&Number(n)==0?"--":n,rewardAndFeeList:o}},d=(l,t,e)=>{if(!l||!t)return null;const a=e||l.coin_type,n=h(a,t);return{coin_address:j(a,!1),amount:t,amountUSD:S(t).gt(0)&&S(n).lte(0)?"--":n,token:l}},g=(l,...t)=>{console.log("ðŸš€ ~ useCalculatePendingYield ~ amounts:",t);let e=S(l);return t.forEach(a=>{a&&a!=="--"&&e!=="--"&&(e=e.plus(a))}),e.toString()},p=l=>{const t={};return l.forEach(e=>{var o,c;const{coin_address:a,amount:n,amountUSD:u}=e;t[a]||(t[a]={...e,amount:"0",amountUSD:"0"}),u=="--"?t[a].amountUSD="--":t[a].amountUSD=t[a].amountUSD=="--"?"--":S((o=t[a])==null?void 0:o.amountUSD).plus(u||0).toString(),t[a].amount=S((c=t[a])==null?void 0:c.amount).plus(n||0).toString()}),Object.values(t).filter(e=>Number(e.amount)>0).sort((e,a)=>S(a.amountUSD=="--"?0:a.amountUSD).minus(e.amountUSD=="--"?0:e.amountUSD).toNumber())};return{calculatePendingYield:f}}const A=h=>h.startsWith("0x")?h.slice(2):h;function W(){const{clmmSdk:h}=H(),{peripherySdk:f,burnSdk:d}=R(),{getBurnClaimTxPayload:g}=I();return{getPosClaimFeeAndRewardTxPayload:async t=>{const{posType:e,id:a,clmmPool:n,coinTypeA:u,coinTypeB:o,rewarderCoinTypes:c,account:_}=t;let x,P;if(e==="clmm"){const y={pool_id:n,pos_id:a,rewarder_coin_types:c,coinTypeA:u,coinTypeB:o,collect_fee:!0};x=await h.Rewarder.collectRewarderTransactionPayload(y),P={action:N.ClaimFeeAndMining,txbParams:y}}else if(e==="farms"){const y={coinTypeA:u,coinTypeB:o,clmm_pool_id:n,position_nft_id:a,clmm_rewarder_types:c,collect_fee:!0};x=await f.Farms.claimFeeAndClmmReward(y),P={action:"FarmingClaimFeeAndReward",txbParams:y}}else e==="burn"&&(x=g({poolAddress:n,posId:a,coinTypeA:u,coinTypeB:o,account:_,rewarderCoinTypes:c}));return{tx:x,msafeParams:P}},getBatchHarvestFeeAndRewardsTxPayload:async(t,e,a)=>{console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ posBaseList:",t,e,a);const n=[],u=[],o=[],c=[];t.forEach(r=>{var T;const m=((T=e[r.posId])==null?void 0:T.map(w=>w.coin_address))||[];console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ rewarderCoinTypes:",m),r.posType=="clmm"?n.push({pool_id:r.clmmPool,pos_id:r.id,collect_fee:!0,rewarder_coin_types:m,coinTypeA:A(r.coinTypeA),coinTypeB:A(r.coinTypeB)}):r.posType=="farms"?(u.push({pool_id:r.farmsPool,position_nft_id:r.id,clmm_pool_id:r.clmmPool,collect_fee:!0,collect_frams_rewarder:!1,clmm_rewarder_types:m,coinTypeA:r.coinTypeA,coinTypeB:r.coinTypeB}),c.push({pool_id:r.farmsPool,position_nft_id:r.id})):o.push({pos:r==null?void 0:r.id,pool:r.clmmPool,coinTypeA:r.coinTypeA,coinTypeB:r.coinTypeB,rewarderCoinTypes:m,account:a})});const _=await f.Farms.batchHarvestAndClmmFeePayload(u,n),x=[];for(let r=0;r<o.length;r++){const m=o[r];(m==null?void 0:m.rewarderCoinTypes.length)>0&&x.push(m)}const P=d.Burn.createCollectFeesPaylaod(o,_),y=d.Burn.crateCollectRewardsPayload(x,P),s=await f.Farms.batchHarvestPayload(c,y);return{txb:P,tx:y,txf:s}}}}function $({posId:h,displayTokenA:f,displayTokenB:d,symbolEllipsesDecimals:g=10}){const[p,l]=B.useState(!0),{posPoolsRelatedData:t}=O(),e=t[h];return i.jsxs(F,{children:[i.jsx(E,{isLoaded:!!(e!=null&&e.currentPrice),children:i.jsx(b,{color:"text_caption",children:p?e==null?void 0:e.currentPrice:e==null?void 0:e.currentPriceReverse})}),i.jsxs(F,{gap:"0",children:[i.jsx(b,{color:"primary_gray",children:C(p?d==null?void 0:d.symbol:f==null?void 0:f.symbol,g)}),i.jsx(b,{color:"primary_gray",children:"Â perÂ "}),i.jsx(b,{color:"primary_gray",children:C(p?f==null?void 0:f.symbol:d==null?void 0:d.symbol,g)})]}),i.jsx(v,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:a=>{D(a),l(!p)}})]})}export{$ as P,V as a,W as u};
//# sourceMappingURL=PositionCurrentPrice-DywqzNbA.js.map
