import{r as F,aO as p,aX as w,aI as k,c3 as H,a9 as N,bg as B,aA as U}from"./index-Bms7VPPn.js";import{u as G}from"./useToken-CODAfOk_.js";import{u as $}from"./global-RxS6w5VQ.js";import{u as v}from"./useGetPoolList-BzobRC0A.js";var E=(t=>(t.CETUS="CETUS",t.KRIYA="KRIYA",t.KRIYAV3="KRIYAV3",t.FLOWX="FLOWX",t.FLOWXV3="FLOWXV3",t.AFTERMATH="AFTERMATH",t.METASTABLE="METASTABLE",t.HAEDAL="HAEDAL",t.VOLO="VOLO",t.AFSUI="AFSUI",t.DEEPBOOKV3="DEEPBOOKV3",t.SCALLOP="SCALLOP",t.BLUEMOVE="BLUEMOVE",t.TURBOS="TURBOS",t.SPRINGSUI="SPRINGSUI",t.BLUEFIN="BLUEFIN",t.HAEDALPMM="HAEDALPMM",t.ALPHAFI="ALPHAFI",t.STEAMM="STEAMM",t))(E||{}),S=(t=>(t[t.CalculateError=1e4]="CalculateError",t[t.NumberTooLarge=10001]="NumberTooLarge",t[t.NoRouter=10002]="NoRouter",t[t.InsufficientLiquidity=10003]="InsufficientLiquidity",t[t.HoneyPot=10004]="HoneyPot",t))(S||{}),x=(t=>(t.TradeInputPage="TradeInput",t.TradeStatus="TradeStatus",t.SelectTokenPage="SelectToken",t.TradeConfirmPage="TradeConfirm",t.RoutePage="Route",t.TradeSetting="TradeSetting",t.SlippageSetting="SlippageSetting",t))(x||{});function D(t=!0){const{poolApiMap:s,setPoolApiMap:m}=$(),{getPoolList:L,getLocalJsonPoolList:d,getLocalJsonPoolAddress:T}=v();return{getPoolListByCoinType:async(a,n)=>{if(a&&n){const i=[a,n].sort(),o=`${i[0]}_${i[1]}`,c=s[o];if(c)return c;const f={coin_type:`${a},${n}`,display_all_pools:!0,offset:0,limit:100,order_by:"-tvl",no_incentives:!0,has_farming:!0,has_mining:!0};let e=t?await d(f):void 0;(e===void 0||e.list.length===0)&&(e=await L(f));const r=e.list;if(r.length>0)return s[o]=r,m(o,r),r}return[]},getPoolAddressByCoinType:async(a,n)=>{if(a&&n){const i=[a,n].sort(),o=`${i[0]}_${i[1]}`;if(t){const e=await T(a,n);if(!e||e.length===0){const r=s[o];if(r)return r.map(l=>l.poolAddress)}else return e}const c={coin_type:`${a},${n}`,display_all_pools:!0,offset:0,limit:100,order_by:"-tvl",no_incentives:!0,has_farming:!0,has_mining:!0},f=await L(c);if(f){const e=f.list;if(e.length>0)return s[o]=e,m(o,e),e.map(r=>r.poolAddress)}}return[]}}}function j(t,s){return{priceAcceptRouterData:F.useMemo(()=>{if(s&&t){if(t.byAmountIn){if(!p(t.toAmountUi).eq(s.toAmountUi||"0"))return s}else if(!p(t.fromAmountUi).eq(s.fromAmountUi||"0"))return s;return}},[s,t])}}function W(t,s){return{amountLimit:F.useMemo(()=>{if(s&&s.routerData){const{byAmountIn:L,fromAmountUi:d,toAmountUi:T}=s;return L?p(T).mul(p(1).sub(p(t))).toString():p(d).mul(p(1).add(p(t))).toString()}},[t,s])}}function z(t){const{getTokenInfo:s,fetchTokenInfo:m}=G(),[L,d]=F.useState({}),T=async()=>{var I,R,a;if(t&&t.routerData){const n=[],i=t.byAmountIn?t.routerData.amountIn.toString():t.routerData.amountOut.toString(),o=[],c=[];let f=p(0);const e=((I=t==null?void 0:t.routerData)==null?void 0:I.routes)||[];for(let l=0;l<e.length;l++){const u=e[l],y={},h=t.byAmountIn?u.amountIn.toString():u.amountOut.toString();l===t.routerData.routes.length-1?y.percentage=p(1).sub(f).toFixed(2):y.percentage=p(h).div(i).toFixed(2),f=p(f).add(y.percentage);const P=[];for(let b=0;b<((R=u==null?void 0:u.path)==null?void 0:R.length);b++){const A=(a=u==null?void 0:u.path)==null?void 0:a[b];n.includes(A.provider)||n.push(A.provider);const _=w(A.from).full_address,O=w(A.target).full_address,M=await m(_),V=await m(O);M||c.includes(_)&&c.push(_),V||c.includes(O)&&c.push(O);const K=A.provider===E.SCALLOP||A.provider===E.FLOWX||A.provider===E.FLOWXV3;P.push({from_type:_,to_type:O,pool_address:K?"":A.id,fee_rate:A.feeRate,provider:A.provider})}y.paths=P,o.push(y)}if(c.length>0)for(const l in c)m(l);const r={router_summery:`${t.routerData.routes.length} Streams`,providers:n,routers:o};d(r);return}d(void 0)};return F.useEffect(()=>{T()},[t]),{formatSwapRouter:L}}function X(){const{getPoolAddressByCoinType:t}=D(!0);return{getSwapPoolAddress:async(m,L)=>{if(m&&L){const d=await t(m.coin_type,L.coin_type);return console.log("ðŸš€ ~ getSwapPoolAddress ~ list:",d),d}return[]}}}function Q(t,s){return F.useMemo(()=>t&&s&&+t&&+s?p(s).div(t).toString():"0",[t,s])}function Z(){const{aggregatorSDK:t}=k(),{getSwapPoolAddress:s}=X(),{deepbookV3Config:m,setDeepbookV3Config:L,providers:d}=H(),T=n=>n&&n.error?n.error.code===S.InsufficientLiquidity||S.HoneyPot||S.NumberTooLarge:!1,I=async n=>{const i=d.length>0?n.filter(o=>d.includes(o)):n;if(n.includes("DEEPBOOKV3")){let o=m;const c=new Date().getTime()/1e3;if(o===null||c-((o==null?void 0:o.last_update_time)||0)>60)try{o=await t.getDeepbookV3Config(),L(o)}catch(f){console.log("ðŸš€ ~ checkProvidersKeys ~ error:",f)}if(o&&o.is_alternative_payment){const{deep_fee_vault:f}=o;if(f<N(20,6))return i.filter(e=>e!=="DEEPBOOKV3")}}return i},R=async n=>{const{fromToken:i,toToken:o,amount:c,providersKeys:f,by_amount_in:e,uuid:r}=n;try{const l={from:i.coin_type,target:o.coin_type,amount:new B(c),byAmountIn:e,depth:3,splitAlgorithm:void 0,splitFactor:void 0,splitCount:void 0,providers:f};console.log("ðŸš€ ~ file: useFindBestRouting.ts:26 ~ findBestRouters ~ routerParams:",l);const u=await t.findRouters(l);if(console.log("ðŸš€ ~ file: useFindBestRouting.ts:145 ~ findBestRouters ~ res:",u),u&&T(u))return a(!1,e,r,i,o,u);if(!u||u.routes.length===0)throw Error("not find router");return a(!1,e,r,i,o,u)}catch(l){try{console.log("ðŸš€ ~ file: useFindBestRouting.ts:105 ~ findRouters ~ error:",l);const u=await s(i,o);if(u.length===0){const P={amountIn:new B("0"),amountOut:new B("0"),byAmountIn:e,routes:[],insufficientLiquidity:!0,error:{code:S.NoRouter,msg:""}};return a(!0,e,r,i,o,P)}const y={from:i.coin_type,target:o.coin_type,amount:new B(c),byAmountIn:e,pools:u};console.log("ðŸš€ ~ file: useFindBestRouting.ts:115 ~ findRouters ~ routerParams:",y);const h=await t.swapInPools(y);return console.log("ðŸš€ ~ file: useFindBestRouting.ts:170 ~ swapInPools ~ res:",h),!h||!h.routeData?a(!0,e,r,i,o):a(!0,e,r,i,o,h.routeData)}catch(u){return console.log("ðŸš€ ~ file: useFindBestRouting.ts:120 ~ swapInPools ~  error:",u),{uuid:r,byAmountIn:e,isDegrade:!0}}}},a=(n,i,o,c,f,e)=>{var r;if(console.log("ðŸš€ ~ file: useSwap.ts:166 ~ handleRouterData ~ res:",{isDegrade:n,routerData:e}),e){const l=e.error!==void 0,u=U(e.amountIn.toString(),c.decimals).toString(),y=U(e.amountOut.toString(),f.decimals).toString();return{routerData:l?void 0:e,fromAmountUi:l?i?u:"":u,toAmountUi:l&&i?"":y,uuid:o,byAmountIn:i,isDegrade:n,errorCode:(r=e.error)==null?void 0:r.code}}else return{uuid:o,byAmountIn:i,isDegrade:n}};return{findBestRouters:R,checkProvidersKeys:I}}export{S as A,x as S,z as a,E as b,W as c,Q as d,j as e,Z as u};
