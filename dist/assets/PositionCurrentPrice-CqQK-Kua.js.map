{"version":3,"file":"PositionCurrentPrice-CqQK-Kua.js","sources":["../../src/hooks/position/useCalculatePendingYield.ts","../../src/components/position/PositionCurrentPrice.tsx"],"sourcesContent":["import { PosBaseInfo } from '@/types'\nimport useTokenPrice from '@cetus/hooks/src/useTokenPrice'\nimport { d } from '@cetus/utils'\nimport { fixCoinType } from '@cetusprotocol/common-sdk'\n// Ê†πÊçÆ‰ªì‰ΩçÂàóË°®ËøîÂõûfeeÂíåminingÂ•ñÂä±ÁöÑtokenÊï∞ÁªÑ\nexport default function useCalculatePendingYield() {\n  const { getTokenAmountValue } = useTokenPrice()\n\n  const calculatePendingYield = (\n    list: PosBaseInfo[],\n    posFeeData: Record<string, any>,\n    posRewardsData: Record<string, any>,\n    posFarmsData?: Record<string, any>\n  ) => {\n    if (!list?.length) {\n      return {\n        total: '0',\n        rewardAndFeeList: []\n      }\n    }\n\n    let total = '0'\n    const rewardAndFeeList: any[] = []\n\n    list.forEach(position => {\n      const currentFeesData = posFeeData[position?.posId]\n      const currentPosRewardsData = posRewardsData[position?.posId] || []\n      const currentPosFarmsData = posFarmsData ? posFarmsData[position?.id] : []\n      const rewardsArr = currentPosRewardsData.concat(currentPosFarmsData)\n      // Process fees\n      if (currentFeesData) {\n        const feeTokenA = processToken(position?.displayTokenA, currentFeesData?.displayFeeOwedA)\n        const feeTokenB = processToken(position?.displayTokenB, currentFeesData?.displayFeeOwedB)\n\n        if (feeTokenA) rewardAndFeeList.push(feeTokenA)\n        if (feeTokenB) rewardAndFeeList.push(feeTokenB)\n\n        total = updateTotal(total, feeTokenA?.amountUSD, feeTokenB?.amountUSD)\n      }\n\n      // Process rewards\n      rewardsArr.forEach((reward: any) => {\n        if (Number(reward?.display_amount_owed) > 0) {\n          const rewardToken = processToken(reward?.token, reward?.display_amount_owed, reward?.token?.coin_type)\n\n          if (rewardToken) {\n            rewardAndFeeList.push(rewardToken)\n            total = updateTotal(total, rewardToken?.amountUSD)\n          }\n        }\n      })\n    })\n\n    const aggregatedList = aggregateRewardsAndFees(rewardAndFeeList)\n    console.log('üöÄ ~ calculatePendingYield ~  total,:', aggregatedList, total, aggregatedList.length == 1 && (total == '--' || Number(total) == 0))\n    return {\n      total: aggregatedList?.length > 0 && Number(total) == 0 ? '--' : total,\n      rewardAndFeeList: aggregatedList\n    }\n  }\n\n  // Helper to process individual tokens\n  const processToken = (token: any, amount: any, coinAddress?: string) => {\n    if (!token || !amount) return null\n\n    const coinType = coinAddress || token.coin_type\n\n    if (!coinType) {\n      return null\n    }\n\n    const amountUSD = getTokenAmountValue(coinType, amount)\n\n    return {\n      coin_address: fixCoinType(coinType, false),\n      amount,\n      amountUSD: d(amount).gt(0) && d(amountUSD).lte(0) ? '--' : amountUSD,\n      token\n    }\n  }\n\n  // Helper to update total\n  const updateTotal = (currentTotal: string, ...amounts: (string | undefined)[]) => {\n    console.log('üöÄ ~ useCalculatePendingYield ~ amounts:', amounts)\n    // if (currentTotal === '--') return '--' // Â¶ÇÊûúÂΩìÂâç total Êó†ÊïàÔºåÁõ¥Êé•ËøîÂõû '--'\n\n    let updatedTotal: any = d(currentTotal) // ÂΩìÂâçÊúâÊïàÁöÑ total\n    amounts.forEach(amount => {\n      if (amount && amount !== '--' && updatedTotal !== '--') {\n        updatedTotal = updatedTotal.plus(amount)\n      } else {\n        // updatedTotal = '--'\n      }\n    })\n\n    return updatedTotal.toString()\n  }\n\n  // Aggregate and sort rewards and fees\n  const aggregateRewardsAndFees = (list: any[]) => {\n    const claimObj: Record<string, any> = {}\n\n    list.forEach(item => {\n      const { coin_address, amount, amountUSD } = item\n      // console.log('üöÄ ~ aggregateRewardsAndFees ~ claimObj:', amount, amountUSD, item, claimObj)\n\n      if (!claimObj[coin_address]) {\n        claimObj[coin_address] = { ...item, amount: '0', amountUSD: '0' }\n      }\n\n      if (amountUSD == '--') {\n        claimObj[coin_address].amountUSD = '--'\n      } else {\n        claimObj[coin_address].amountUSD =\n          claimObj[coin_address].amountUSD == '--'\n            ? '--'\n            : d(claimObj[coin_address]?.amountUSD)\n                .plus(amountUSD || 0)\n                .toString()\n      }\n\n      claimObj[coin_address].amount = d(claimObj[coin_address]?.amount)\n        .plus(amount || 0)\n        .toString()\n    })\n\n    return Object.values(claimObj)\n      .filter((item: any) => Number(item.amount) > 0)\n      .sort((a: any, b: any) =>\n        d(b.amountUSD == '--' ? 0 : b.amountUSD)\n          .minus(a.amountUSD == '--' ? 0 : a.amountUSD)\n          .toNumber()\n      )\n  }\n\n  return {\n    calculatePendingYield\n  }\n}\n","import usePositionStore from '@/store/position'\nimport { Token } from '@cetus/types'\nimport { Icon } from '@cetus/ui-kit'\nimport { cancelBubble, textEllipses } from '@cetus/utils'\nimport { HStack, Skeleton, Text } from '@chakra-ui/react'\nimport { useState } from 'react'\n\nfunction PositionCurrentPrice({\n  posId,\n  displayTokenA,\n  displayTokenB,\n  symbolEllipsesDecimals = 10, //symbolË∂ÖÂá∫‰ΩçÊï∞ÂêéÊòØÂê¶Â±ïÁ§∫...\n  handleDirect\n}: {\n  posId: string\n  displayTokenA: Token\n  displayTokenB: Token\n  symbolEllipsesDecimals?: number\n  handleDirect?: () => void\n}) {\n  const [isDirect, setIsDirect] = useState(true)\n  const { posPoolsRelatedData } = usePositionStore()\n  const currentPosPoolsRelatedData = posPoolsRelatedData[posId]\n\n  return (\n    <HStack>\n      <Skeleton isLoaded={!!currentPosPoolsRelatedData?.currentPrice}>\n        <Text color=\"text_caption\">{isDirect ? currentPosPoolsRelatedData?.currentPrice : currentPosPoolsRelatedData?.currentPriceReverse}</Text>\n      </Skeleton>\n      <HStack gap=\"0\">\n        <Text color=\"primary_gray\">{textEllipses(isDirect ? displayTokenB?.symbol : displayTokenA?.symbol, symbolEllipsesDecimals)}</Text>\n        <Text color=\"primary_gray\">&nbsp;per&nbsp;</Text>\n        <Text color=\"primary_gray\">{textEllipses(isDirect ? displayTokenA?.symbol : displayTokenB?.symbol, symbolEllipsesDecimals)}</Text>\n      </HStack>\n      <Icon\n        xlinkHref=\"#icon-icon_swap1\"\n        w=\"16px\"\n        h=\"16px\"\n        onClick={(e: any) => {\n          cancelBubble(e)\n          setIsDirect(!isDirect)\n          if (handleDirect) {\n            handleDirect()\n          }\n        }}\n      />\n    </HStack>\n  )\n}\n\nexport default PositionCurrentPrice\n"],"names":["useCalculatePendingYield","getTokenAmountValue","useTokenPrice","calculatePendingYield","list","posFeeData","posRewardsData","posFarmsData","total","rewardAndFeeList","position","currentFeesData","currentPosRewardsData","currentPosFarmsData","rewardsArr","feeTokenA","processToken","feeTokenB","updateTotal","reward","rewardToken","_a","aggregatedList","aggregateRewardsAndFees","token","amount","coinAddress","coinType","amountUSD","fixCoinType","d","currentTotal","amounts","updatedTotal","claimObj","item","coin_address","_b","a","b","PositionCurrentPrice","posId","displayTokenA","displayTokenB","symbolEllipsesDecimals","handleDirect","isDirect","setIsDirect","useState","posPoolsRelatedData","usePositionStore","currentPosPoolsRelatedData","HStack","jsx","Skeleton","Text","jsxs","textEllipses","Icon","e","cancelBubble"],"mappings":"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"}