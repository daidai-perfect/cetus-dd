import{c as ro,u as lo}from"./useGetPoolList-DBJielhS.js";import{u as X}from"./useToken-BlS8b5ft.js";import{u as to}from"./useTokenBalance-Cc02jFZo.js";import{U as ao,bK as no,r as i,aa as $,d as V,a6 as U,bp as uo,R as so,a4 as eo,aO as F,bL as co,bc as O,bh as H,bi as io,br as W,j as d,V as po,H as K,T as Y,C as yo,g as fo,u as vo,s as go}from"./index-D49RffYW.js";import{H as z}from"./HTextLabelBox-DVxTk_Ir.js";import{C as J}from"./CetusTooltip-7TnGbJNH.js";import{a as G}from"./api-data-utils-D656F-wl.js";const _o=(r,o)=>({detailRefreshCount:0,contractClmmPoolObjLoading:!1,contractVaultObjLoading:!1,vaultBaseListLoading:!1,vaultStatsLoading:!1,holdVaultsObj:{},holdTotalValue:{},vaultStatsObj:{},contractClmmPoolObj:{},contractVaultObj:{},setVaultStatsObj:l=>{r(()=>({vaultStatsObj:l}))},vaultBaseList:[],setVaultBaseList:l=>{r(()=>({vaultBaseList:l}))},setVaultBaseListLoading:l=>{r(()=>({vaultBaseListLoading:l}))},setVaultStatsLoading:l=>{r(()=>({vaultStatsLoading:l}))},setContractVaultObj:l=>{const n=o().contractVaultObj;n[l.id]=l,r(()=>({contractVaultObj:{...n}}))},setContractVaultObjLoading:l=>{r(()=>({contractVaultObjLoading:l}))},setContractClmmPoolObjLoading:l=>{r(()=>({contractClmmPoolObjLoading:l}))},setContractClmmPoolObj:l=>{const n=o().contractClmmPoolObj;n[l.poolAddress]=l,r(()=>({contractClmmPoolObj:{...n}}))},setHoldTotalValue:(l,n)=>{const y=o().holdTotalValue;y[l]=n,r(()=>({holdTotalValue:{...y}}))},setDetailRefreshCount:l=>{r(()=>({detailRefreshCount:l}))}}),R=ao(no(_o,{name:"useVaultsStore",partialize:r=>{const{vaultBaseList:o,vaultStatsObj:l,contractVaultObj:n,contractClmmPoolObj:y}=r;return{vaultBaseList:o,vaultStatsObj:l,contractVaultObj:n,contractClmmPoolObj:y}}}));function mo(r,o){return{lpRate:i.useMemo(()=>r&&o?V(o).eq(0)?"100%":uo(V(r).div(V(r).add(o)).mul(100).toString(),9):"0%",[r,o])}}function Bo(r,o,l=!1){return{amountLimit:i.useMemo(()=>{if(o)return V(o).mul(l?1+r:1-r).toString()},[o,r,l])}}function So(r){const{contractVaultObj:o}=R();return{contractVault:i.useMemo(()=>{if(r)return o[r]},[o,r])}}function Po(r){const{contractClmmPoolObj:o}=R();return{contractClmmInfo:i.useMemo(()=>{if(r)return o[r]},[o,r])}}function Ro(r){return{stakeProtocolName:i.useMemo(()=>{if(r){if(r.includes("HASUI"))return"Haedal";if(r.includes("AFSUI"))return"Aftermath";if(r.includes("CERT"))return"Volo"}},[r])}}function qo(r,o){const l=i.useMemo(()=>{if(o&&r)return`${$(V(o.amountPerLpA).mul(r).toFixed(18,U.ROUND_DOWN),o.displayTokenA.decimals)}  ${o==null?void 0:o.displayTokenA.symbol}`},[o==null?void 0:o.amountPerLpA,r]),n=i.useMemo(()=>{if(o&&r)return`${$(V(o.amountPerLpB).mul(r).toFixed(18,U.ROUND_DOWN),o.displayTokenB.decimals)}  ${o==null?void 0:o.displayTokenB.symbol}`},[o==null?void 0:o.amountPerLpB,r]);return{rewardPerA:l,rewardPerB:n}}function Mo(r,o,l,n,y=!1){const{vaultsSdk:j}=so(),{getTokenAmountValue:x}=eo(),{setContractVaultObjLoading:T,setContractVaultObj:w,setContractClmmPoolObj:D,setContractClmmPoolObjLoading:m,setHoldTotalValue:B,holdTotalValue:h}=R(),f=async(_,C=!1)=>{T(!0);const L=await j.Vaults.getVault(_,C);L&&w(L),T(!1)},s=async(_,C=!1)=>{m(!0);const L=await j.Pool.getPool(_,C);L&&D(L),m(!1)},{contractVault:a}=So(r),{tokenInfo:t}=X(a==null?void 0:a.lp_token_type),{balanceInfo:c}=to(t),S=i.useMemo(()=>a&&c?F(c.balance).div(a.total_supply).mul(100).toString():"0",[a,c]),{contractClmmInfo:u}=Po(o),p=_=>{if(a&&u&&l&&n&&y!==void 0){const C=new H(u.current_sqrt_price),L=O.tickIndexToSqrtPriceX64(a.position.tick_lower_index),oo=O.tickIndexToSqrtPriceX64(a.position.tick_upper_index),N=io.getCoinAmountFromLiquidity(new H(_),C,L,oo,!1),M=W(N.coinA.toString(),l.decimals).toString(),E=W(N.coinB.toString(),n.decimals).toString();return{coinAmountA:M,coinAmountB:E,displayCoinA:y?E:M,displayCoinB:y?M:E}}},g=i.useMemo(()=>{if(a&&c&&u){const _=co.get_share_liquidity_by_amount(a,c.balance),C=p(_);if(C)return C}return{coinAmountA:"0",coinAmountB:"0",displayCoinA:"0",displayCoinB:"0"}},[c==null?void 0:c.balance,u==null?void 0:u.current_sqrt_price]),e=i.useMemo(()=>{if(a&&u){const _=p(a.liquidity);if(_)return _}},[a==null?void 0:a.liquidity,u==null?void 0:u.current_sqrt_price]),v=i.useMemo(()=>{if(u&&l&&n)return O.sqrtPriceX64ToPrice(new H(u.current_sqrt_price),l.decimals,n.decimals).toString()},[u==null?void 0:u.current_sqrt_price,l==null?void 0:l.decimals]),P=i.useMemo(()=>{if(a&&l&&n)return O.tickIndexToPrice(a.position.tick_lower_index,l.decimals,n.decimals).toString()},[a==null?void 0:a.position.tick_lower_index,l==null?void 0:l.decimals]),b=i.useMemo(()=>{if(a&&l&&n)return O.tickIndexToPrice(a.position.tick_upper_index,l.decimals,n.decimals).toString()},[a==null?void 0:a.position.tick_upper_index,l==null?void 0:l.decimals]),A=x(l==null?void 0:l.coin_type,g.coinAmountA),q=x(n==null?void 0:n.coin_type,g.coinAmountB),Q=x(l==null?void 0:l.coin_type,e==null?void 0:e.coinAmountA),Z=x(n==null?void 0:n.coin_type,e==null?void 0:e.coinAmountB),k=i.useMemo(()=>{if(v&&e)return ro(e.coinAmountA,e.coinAmountB,v,!1)},[v,e]);i.useEffect(()=>{r&&B(r,F(A).add(q).toString())},[A,q,r]);const I=i.useMemo(()=>{if(r)return h[r]},[h,r]);return{fetchVaultInfoFromContract:f,contractVault:a,lpTokenInfo:t,balanceInfo:c,sharePoolRate:S,fetchClmmPoolFromContract:s,holdCoinAmounts:g,totalValue:I,maxPrice:b,currPrice:v,minPrice:P,vaultCoinAmounts:e,vaultsCoinAValue:Q,vaultsCoinBValue:Z,vaultsCoinPercent:k,holdCoinAValue:A,holdCoinBValue:q,calculateCoinAmounts:p}}function Eo({vaultsLstApyDisplay:r,vaultsApyDisplay:o,vaultsTotalApyDisplay:l}){return d.jsx(J,{tooltip:d.jsx(Co,{vaultsApyDisplay:o,vaultsLstApyDisplay:r,vaultsTotalApyDisplay:l}),children:d.jsx(Y,{textColor:"text_caption",textAlign:"right",fontWeight:"500",textDecoration:"underline dotted",color:"primary",children:l})})}const Co=({vaultsLstApyDisplay:r,vaultsApyDisplay:o,vaultsTotalApyDisplay:l})=>d.jsxs(po,{gap:"12px",w:"100%",pt:"8px",pb:"8px",children:[d.jsx(z,{label:"Total APY",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},wrapStyle:{gap:"16px"},value:l}),d.jsx(K,{h:"1px",w:"100%",backgroundColor:"border"}),d.jsx(z,{label:"Fees and Rewards",labelStyle:{fontSize:"12px"},valueStyle:{fontSize:"12px"},wrapStyle:{gap:"16px"},value:o}),d.jsx(z,{label:"LST",labelStyle:{fontSize:"12px"},wrapStyle:{gap:"16px"},value:r,valueStyle:{fontSize:"12px"}})]});function Ho({rewardList:r}){return d.jsx(J,{tooltip:d.jsx(Y,{fontSize:"12px",lineHeight:"20px",children:"Rewards will be auto harvested and compounded to your position."}),children:d.jsx(K,{justifyContent:"end",gap:"4px",children:r.map(o=>d.jsx(xo,{coinType:o},o))})})}function xo({coinType:r}){const{tokenInfo:o}=X(r);return d.jsx(yo,{children:d.jsx(fo,{imageUrl:o==null?void 0:o.logo_url,w:"20px",h:"20px"})})}function Lo(r,o){return{...r,vaultsTvl:(o==null?void 0:o.vaultsTvl)||"--",vaultsTvlDisplay:(o==null?void 0:o.vaultsTvlDisplay)||"--",vaultsApy:(o==null?void 0:o.vaultsApy)||"--",vaultsApyDisplay:(o==null?void 0:o.vaultsApyDisplay)||"--",vaultsTotalApy:(o==null?void 0:o.vaultsTotalApy)||"--",vaultsTotalApyDisplay:(o==null?void 0:o.vaultsTotalApyDisplay)||"--",vaultsLstApy:(o==null?void 0:o.vaultsLstApy)||"--",vaultsLstApyDisplay:(o==null?void 0:o.vaultsLstApyDisplay)||"--",vaultsId:(o==null?void 0:o.vaultsId)||"",clmmPoolAddress:(o==null?void 0:o.clmmPoolAddress)||"",amountPerLpA:(o==null?void 0:o.amountPerLpA)||"0",amountPerLpB:(o==null?void 0:o.amountPerLpB)||"0"}}const zo=(r,o)=>V(r).gt(0)?`${r} ${o}`:"";function Go(){const{fetchByApi:r}=vo(),{getPoolList:o}=lo(),{setVaultStatsObj:l,setVaultBaseList:n,vaultBaseList:y,vaultStatsObj:j,setVaultStatsLoading:x,setVaultBaseListLoading:T}=R(),w=async(f=!0)=>{try{(f||y.length===0)&&T(!0);const s=await o({is_vaults:!0,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0}),a=s==null?void 0:s.list.map(t=>{var g,e,v,P;const c=[(g=t==null?void 0:t.tokenA)==null?void 0:g.coin_type,(e=t==null?void 0:t.tokenB)==null?void 0:e.coin_type],S=(v=t==null?void 0:t.miningRewardList)==null?void 0:v.map(b=>t==null?void 0:t.coinType),u=(P=t==null?void 0:t.miningRewardList)==null?void 0:P.map(b=>t==null?void 0:t.coinType),p=Array.from(new Set([...c,...S,...u]));return{...t,vaultsRewards:p}});return a.length>0&&n(a),a}catch{}finally{T(!1)}return[]},D=async()=>{var f;try{x(!0);const s=await r("/v2/sui/auto_pools","GET"),a={};if(s!=null&&s.pools)return(f=s==null?void 0:s.pools)==null||f.forEach(t=>{const c=t==null?void 0:t.clmm_pool,S=t==null?void 0:t.object_id,u=t==null?void 0:t.total_apy,p=G(u,!0),g=t==null?void 0:t.apr,e=G(g,!0),v=t==null?void 0:t.lst_apy,P=G(v,!0),b=t==null?void 0:t.tvl,A=go(b,"$");a[c]={vaultsApy:g,vaultsApyDisplay:e,vaultsTotalApy:u,vaultsTotalApyDisplay:p,vaultsLstApy:v,vaultsLstApyDisplay:P,clmmPoolAddress:c,vaultsId:S,vaultsTvl:b,vaultsTvlDisplay:A,amountPerLpA:t.reward_per_lp.amount_a_per_lp,amountPerLpB:t.reward_per_lp.amount_b_per_lp}}),l(a),a}catch(s){return console.error("getVaultsStats Error:",s),j}finally{x(!1)}return{}},m=async f=>{try{const s=y.length>0?y:await w(),a=await D();return h(f,s,a)}catch(s){return console.error("getVaultList Error:",s),B(f)}return[]},B=f=>{try{return h(f,y,j)}catch(s){console.error("getVaultListFromCache Error:",s)}return[]},h=(f,s,a)=>{const{sortRule:t,sortType:c}=f,S=s==null?void 0:s.map(u=>{const p=a==null?void 0:a[u.poolAddress];return Lo(u,p)});return S==null?void 0:S.sort((u,p)=>{var g,e,v,P;return c==="apr"?t==="desc"?((g=p.vaultsTotalApyDisplay)==null?void 0:g.replace("%",""))-((e=u.vaultsTotalApyDisplay)==null?void 0:e.replace("%","")):((v=u.vaultsTotalApyDisplay)==null?void 0:v.replace("%",""))-((P=p.vaultsTotalApyDisplay)==null?void 0:P.replace("%","")):t==="desc"?p.vaultsTvl-u.vaultsTvl:u.vaultsTvl-p.vaultsTvl})};return{getVaultBaseList:w,getVaultsStats:D,getVaultListFromCache:B,getVaultList:m}}export{xo as C,Eo as V,Ho as a,R as b,qo as c,Go as d,Ro as e,zo as f,mo as g,Bo as h,Co as i,Mo as u};
