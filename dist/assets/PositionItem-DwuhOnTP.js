import{y as Ye,a as h,ak as Se,j as e,H as v,C as ae,I,T as y,f as E,P as Ae,h as fe,m as ve,n as _e,p as $,V as M,F as ne,W as Ve,X as Je,Y as Qe,a0 as Ke,$ as Xe,k as Fe,q as Ze}from"./vendor-BowHGuwE.js";import{a as K,J as Pe,K as le,d as g,z as ie,a2 as V,C as Ie,B as We,n as we,a9 as ze,$ as Q,aa as es,r as Te,w as ue,R as Z,f as ge,q as Oe,h as Ee,I as Ne}from"./index-e1XEidi2.js";import{u as ss,V as ts,a as rs,b as ns}from"./VaultsAprBlock-Bc81YXKl.js";import{a as is,u as as,V as ls}from"./VaultsAction-B3gDe-xN.js";import{u as De}from"./useAccountBalance-CQ_1E3vK.js";import{u as cs}from"./useInterval-BcJtT0it.js";import{P as os}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as xs}from"./VTextLabelBox-BoCr-NCb.js";import{u as ps}from"./global-pbKpyHQ5.js";import{u as ce,b as ds,a as us}from"./usePositionList-BSr3H_3U.js";import{u as gs}from"./useTransaction-DL_fEFz9.js";import{h as ms}from"./RemoveBlock-DwFmwqhA.js";import{T as hs}from"./TableSortTh-DOfNk0r1.js";import{b as bs}from"./useClaimPosition-CSWV6EgR.js";import{a as ys}from"./useNotifiSubscription-B7P936L_.js";import{S as me,A as Ue}from"./SingleTokenInfo-CNJTTpm6.js";import{L as js}from"./ExpendItem-8PsxE0uW.js";function Ys(){const{search:s}=Ye(),[n,l]=h.useState({});return h.useLayoutEffect(()=>{const i=new URLSearchParams(s);l(Object.fromEntries(i.entries()))},[s]),n}const Vs=({tooltip:s,...n})=>{const l=Se(),{isApp:i}=K();return e.jsx(v,{w:"20px",h:"20px",onClick:p=>{le(p),i||l("/farms")},...n,children:e.jsx(Pe,{placement:"top",tooltip:s||e.jsx(y,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(ae,{children:e.jsx(I,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function ws(s){const{minPrice:n,maxPrice:l,currPrice:i}=s,[p,t]=h.useState(0),[A,j]=h.useState(0),o=h.useRef(null),r=h.useRef(null);h.useEffect(()=>{const m=()=>{o.current&&t(o.current.offsetWidth),r.current&&j(r.current.offsetWidth)},S=new ResizeObserver(m),P=new ResizeObserver(m);return o.current&&S.observe(o.current),r.current&&P.observe(r.current),()=>{o.current&&S.unobserve(o.current),r.current&&P.unobserve(r.current)}},[n,l,i]);const b=h.useMemo(()=>{if(l==="âˆž")return"0px";if(i&&n&&l&&p){if(g(i).lessThanOrEqualTo(l)&&g(i).greaterThanOrEqualTo(n)){const m=g(i).sub(n).div(g(l).sub(g(n))).toString();return`${g(p).mul(m).toFixed(0)}px`}if(g(i).lt(n))return"-36px";if(g(i).gt(l))return"calc(100% + 36px)"}return"0px"},[i,n,l,p]),f=h.useMemo(()=>{const m=b.replace("px","");return Number(m)-A/2+"px"},[b,A]),{isApp:_}=K();return e.jsx(e.Fragment,{children:n!==void 0&&l!==void 0&&i!==void 0?e.jsx(v,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(E,{w:"100%",padding:n&&g(i).lt(n)?"0 40px 0 60px":l&&g(i).gt(l)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(y,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:n&&g(i).lt(n)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(n)}),e.jsx(E,{w:"100%",position:"relative",height:"14px",ref:o,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(Ae,{isLazy:!0,placement:"top",trigger:_?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(fe,{children:e.jsx(E,{as:"button",children:e.jsx(E,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:b,ml:"-2px",zIndex:"5"})})}),e.jsx(ve,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:f,zIndex:"5",children:e.jsx(_e,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(y,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:ie(i)})})})]})}),e.jsx(y,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:l&&g(i).gt(l)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(l)})]})},b):e.jsx(v,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx($,{w:"100%",h:"20px"})})})}function Ss(s){const{vaultId:n,displayTokenA:l,displayTokenB:i,feeDisplay:p,minPrice:t,maxPrice:A,currPrice:j}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:o}=ss(),r=h.useMemo(()=>{if(V(o)&&n)return o[n]},[o,n]);return e.jsxs(M,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ne,{children:[e.jsx(Ie,{coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ne,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(E,{children:e.jsxs(ne,{alignItems:"center",children:[e.jsx(y,{fontSize:"16px",color:"text_caption",children:`${l==null?void 0:l.symbol} - ${i==null?void 0:i.symbol}`}),e.jsx(We,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(y,{fontSize:"12px",color:"primary",children:p})})]})}),e.jsx(ne,{flexDirection:"column",children:e.jsx(xs,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(ts,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(ws,{minPrice:t,maxPrice:A,currPrice:j})]})}function Js(s){const{currentAccount:n}=we(),{isOpen:l,setIsOpen:i,vaultId:p,category:t,displayTokenA:A,displayTokenB:j,feeDisplay:o,clmmPool:r,isReverse:b}=s,{isOpenWalletModal:f}=we(),{getCurrentVaultDetail:_,getCurrentVaultContractInfo:m}=is(),{clearVaultsActionData:S}=as(),{fetchAccountBalance:P}=De(),d=Se(),{vaultsPoolObj:T}=rs(),u=h.useMemo(()=>T[p],[T,p]);h.useEffect(()=>{p&&_(p)},[n==null?void 0:n.address,p]);const{getPythLastPrice:a}=ns(),x=h.useRef(!1);h.useEffect(()=>(x.current=!0,()=>{x.current=!1,S()}),[]),h.useEffect(()=>{u!=null&&u.displayCoinTypeA&&(u!=null&&u.displayCoinTypeB)&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])},[u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB]),cs({interval:20*1e3,callback:()=>{x.current&&t=="haedal"&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])}});const L=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),n!=null&&n.address?(P(),_(p,!0)):m(p)};return e.jsxs(Ve,{isCentered:!0,isOpen:l&&!f,onClose:()=>{i(!1)},children:[e.jsx(Je,{}),e.jsx(Qe,{width:{base:"100%",lg:"420px"},children:e.jsx(Ke,{p:"0 0 8px",children:e.jsxs(M,{width:"100%",children:[e.jsxs(M,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(v,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(y,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Xe,{})]}),e.jsx(Ss,{displayTokenA:A,displayTokenB:j,feeDisplay:o,clmmPool:r,isReverse:b,minPrice:u==null?void 0:u.minPrice,maxPrice:u==null?void 0:u.maxPrice,currPrice:u==null?void 0:u.currentPrice,category:t,vaultId:p}),e.jsx(ls,{vaultId:p,isModal:!0,autoRefresh:L})]}),e.jsxs(v,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:t=="haedal"?"space-between":"center",children:[e.jsx(os,{mt:"0",category:t}),e.jsx(y,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{t&&p&&(S(),d(`/vaults-detail/${p}/${t}`))},children:"Vault Details >"})]})]})})})]})}function $e(){const s=(l,i,p,t)=>{const A=Math.max(l,p),o=Math.min(i,t)-A,r=i-l,b=t-p,f=Q(o.toString());console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:14 ~ estPositionAPRWithMultiMethod ~ retroRangeD:",f.toString());const _=Q(r.toString());console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:16 ~ estPositionAPRWithMultiMethod ~ userRangeD:",r.toString());const m=Q(b.toString());return console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:18 ~ estPositionAPRWithMultiMethod ~ histRangeD:",b.toString()),o<=0?Q(0):o===r?m.div(f):o===b?f.div(_):m.div(f)};return{getPositionApr:(l,i,p,t)=>{if(!V(l)||!V(i)||!V(t))return;const{minPrice:A,minPriceResever:j,maxPrice:o,maxPriceResever:r}=i,{tokenA:b,tokenB:f,miningAprList:_,feeApr:m,feeApr7d:S,feeApr30d:P,isReverse:d}=l;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ getPositionApr ~ isReverse:",d),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:28 ~ getPositionApr ~ feeApr30d:",S,P);const T=b==null?void 0:b.decimals,u=f==null?void 0:f.decimals,a=A=="0"&&o=="âˆž",x=d?j:A,L=a?2**50:d?r:o;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:31 ~ getPositionApr ~ lowerUserPrice:",x),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:33 ~ getPositionApr ~ upperUserPrice:",L);const{lower:B,upper:ee}=t;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ range:",t);const se=ze.tickIndexToPrice(B,T,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ beforeContractPriceLowest:",se);const X=ze.tickIndexToPrice(ee,T,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:40 ~ getPositionApr ~ beforeContractPriceHighest:",X),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ lowerUserPrice, upperUserPrice, beforeContractPriceLowest, beforeContractPriceHighest:",x,L,se,X);const W=s(x,L,se,X);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:41 ~ getPositionApr ~ positionMulti:",W.toString());const C=Q(p=="day"?m:p=="month"?P:S).mul(W).toString(),z=[];let F=Q(C);return _==null||_.forEach(O=>{const H=Q(W).mul(O.apr).toString();z.push({...O,posMiningRewardApr:H}),F=F.add(H)}),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:45 ~ getPositionApr ~",{aprPercentageTotal:F.toString(),aprByFee:C,posMiningReward:z}),{aprPercentageTotal:F.toString(),displayAprPercentageTotal:es(F.toNumber()*100),aprByFee:C,posMiningReward:z}}}}function As(){const[s,n]=h.useState(!1),{getPositionApr:l}=$e(),{getTokenAmountValue:i}=Te(),{posPoolsRelatedData:p,posLiquidityData:t,posFeeData:A,farmsPosRewardsData:j,posRewardsData:o,posApiPoolData:r,poolRangeObj:b,setPosBaseList:f}=ce(),{mevProtect:_,transactionMode:m,maxCapForGas:S,customGasPrice:P}=ps(),{getCloseTsPayloadAll:d}=ms(),{signAndExecuteTransaction:T,transactionConfirmation:u}=gs(),{fetchAccountBalance:a}=De(),{getPositionBaseList:x,getPosRelatedData:L}=ds(),{currentAccount:B}=we(),ee=async()=>{const W=await x(B==null?void 0:B.address);L(W)};return{getPositionSortList:(W,C,z)=>{if(!(z!=null&&z.length))return;const F=(c=[])=>c.map(w=>{var k;return{...w,amountUSD:i((k=w==null?void 0:w.token)==null?void 0:k.coin_type,w==null?void 0:w.display_amount_owed)}}).filter(w=>g(w.display_amount_owed).gt(0)),O=z.map(c=>{var ke,Ce,Le,Re,Be;const w=c.posId,k=c.clmmPool,R=r[k],N=b[k],D=(ke=N==null?void 0:N.ranges)==null?void 0:ke.reduce((G,Y)=>(G[Y.dateType]=Y,G),{}),oe=l(R,p[w],"week",D==null?void 0:D.week),q=t[w],he=i((Ce=c.displayTokenA)==null?void 0:Ce.coin_type,q==null?void 0:q.displayCoinAmountA),be=i((Le=c.displayTokenB)==null?void 0:Le.coin_type,q==null?void 0:q.displayCoinAmountB),te=g(he).plus(be),U=A[w],xe=i((Re=c.displayTokenA)==null?void 0:Re.coin_type,U==null?void 0:U.displayFeeOwedA),pe=i((Be=c.displayTokenB)==null?void 0:Be.coin_type,U==null?void 0:U.displayFeeOwedB),de=g(xe).plus(pe),re=F(o[w]),J=F(j[c.id]),ye=[...re,...J].reduce((G,Y)=>G.plus(Y.amountUSD),g(0)),qe=re.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0)),Ge=J.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0));return{...c,apr:oe,totalLiquidity:te.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:qe.toString(),totalFarmingAmount:Ge.toString()}}),H={apr:(c,w)=>{var N,D;const k=g(((N=c.apr)==null?void 0:N.aprPercentageTotal)??0),R=g(((D=w.apr)==null?void 0:D.aprPercentageTotal)??0);return C==="asc"?k.minus(R).toNumber():R.minus(k).toNumber()},liquidity:(c,w)=>{const k=g(c.totalLiquidity),R=g(w.totalLiquidity);return C==="asc"?k.minus(R).toNumber():R.minus(k).toNumber()},fees:(c,w)=>{const k=g(c.totalFee),R=g(w.totalFee);return C==="asc"?k.minus(R).toNumber():R.minus(k).toNumber()},rewards:(c,w)=>{const k=g(c.totalRewards),R=g(w.totalRewards);return C==="asc"?k.minus(R).toNumber():R.minus(k).toNumber()}};return H[W]&&O.sort(H[W]),O},toCloseAllAction:async W=>{n(!0);try{const C=W.map(c=>{var U,xe,pe,de,re;const w=t[c==null?void 0:c.posId],k=o[c==null?void 0:c.posId],R=r[c.clmmPool],N=!k||(k==null?void 0:k.length)==0?(U=(R==null?void 0:R.miningRewardList)||[])==null?void 0:U.reduce((J,ye)=>(J.push(ye.coinType),J),[]):(k||[]).map(J=>J.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",c,r,R,k,N);const D=ie(w==null?void 0:w.displayCoinAmountA,void 0,!0),oe=ie(w==null?void 0:w.displayCoinAmountB,void 0,!0),q=c.isReverse,[he,be]=q?[g(oe).mul(ue.pow(10,(xe=c.displayTokenB)==null?void 0:xe.decimals)).toString(),g(D).mul(ue.pow(10,(pe=c.displayTokenA)==null?void 0:pe.decimals)).toString()]:[g(D).mul(ue.pow(10,(de=c.displayTokenA)==null?void 0:de.decimals)).toString(),g(oe).mul(ue.pow(10,(re=c.displayTokenB)==null?void 0:re.decimals)).toString()],te={posId:c.posType==="farms"?c.id:c.posId,poolAddress:c.clmmPool,coinTypeA:c.coinTypeA,coinTypeB:c.coinTypeB,amountA:he,amountB:be,liquidity:c.liquidity,lowerTick:c.lowerTick,upperTick:c.upperTick,posType:c.posType,rewarderCoinTypes:N};return c.posType==="farms"&&(te.farmsPoolId=c.farmsPool,te.farmsPosId=c.id),te});console.log("ðŸš€ ~ toRemove ~ paramsList:",C);const z={getShowInfo:c=>{const w=c==="success";return{modalDescriptionText:w?"":"Close all positions",toastTitleText:w?"Close all positions successful":"Close all positions",toastDescriptionContent:w?"":void 0}}};u(z);const{tx:F,msafeParams:O}=await d(C),H=await T(F,z,{useMev:_,useFastMode:m==="Fast Mode",maxCapForGas:S,customGasPrice:P,msafeParams:O});console.log("ðŸš€ ~ toClaim ~ res:",H),H&&(a(),f([]),ee())}catch(C){console.error("ðŸš€ ~ toClaim ~ error:",C)}finally{n(!1)}},isRemoveLoading:s}}const fs=({positionInfo:s,onFeesChange:n})=>{var _,m;const[l,i]=h.useState(!1),{getTokenAmountValue:p}=Te(),{posFeeData:t,posFeeDataLoading:A}=ce(),j=t[s==null?void 0:s.posId],o=p((_=s==null?void 0:s.displayTokenA)==null?void 0:_.coin_type,j==null?void 0:j.displayFeeOwedA,"--"),r=p((m=s==null?void 0:s.displayTokenB)==null?void 0:m.coin_type,j==null?void 0:j.displayFeeOwedB,"--"),b=h.useMemo(()=>o!=="--"&&r!=="--"?Z(g(o).plus(r).toString(),2):"$--",[o,r]),{isApp:f}=K();return h.useEffect(()=>{n==null||n(b)},[b]),e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:S=>le(S),onMouseEnter:Number(o)==0&&Number(r)==0?()=>{}:()=>i(!0),onMouseLeave:()=>i(!1),children:e.jsxs(Ae,{isLazy:!0,trigger:f?"click":"hover",placement:"top-start",children:[e.jsx(fe,{children:e.jsx(ae,{as:"button",cursor:Number(o)==0&&Number(r)==0?"default":"help",children:e.jsx($,{isLoaded:!!b,children:e.jsx(y,{color:"text_caption",borderColor:"text_caption",children:b})})})}),l&&b!=="--"&&e.jsx(Fe,{children:e.jsx(ve,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(_e,{p:"8px",children:e.jsxs(M,{align:"flex-start",minW:"200px",children:[e.jsxs(v,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(j==null?void 0:j.displayFeeOwedA)}),e.jsx(y,{fontSize:"12px",children:Z(o,2)})]})]}),e.jsxs(v,{w:"100%",justify:"space-between",children:[e.jsx(me,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(j==null?void 0:j.displayFeeOwedB)}),e.jsx(y,{fontSize:"12px",children:Z(r,2)})]})]})]})})})})]})})})},vs=({positionInfo:s,onRewardsChange:n})=>{var T,u;const{getTokenAmountValue:l}=Te(),{coinPriceObj:i}=Oe(),{posRewardsData:p,posRewardsDataLoading:t,posApiPoolData:A,farmsPosRewardsData:j,farmsPosRewardsDataLoading:o}=ce(),r=(T=A[s==null?void 0:s.clmmPool])==null?void 0:T.haveMining,b=(u=A[s==null?void 0:s.clmmPool])==null?void 0:u.haveFarming,f=p[s==null?void 0:s.posId],_=j[s==null?void 0:s.id],m=h.useMemo(()=>{const a=f==null?void 0:f.map(x=>{var B;console.log("ðŸš€ ~ list ~ reward:",x);const L=l((B=x==null?void 0:x.token)==null?void 0:B.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,f,i]),S=h.useMemo(()=>{const a=_==null?void 0:_.map(x=>{var B;console.log("ðŸš€ ~ list ~ reward:",x);const L=l((B=x==null?void 0:x.token)==null?void 0:B.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,_,i]),P=h.useMemo(()=>{let a;const x=m.concat(S);return console.log("ðŸš€ ~ totalUSD ~ arr:",x,m,S),(x==null?void 0:x.length)>0?(x.forEach(L=>{const B=L==null?void 0:L.amountUSD;a=B=="--"||a=="--"?"--":g(a).plus(B).toString()}),a=="--"?"$--":Z(a,2)):"$0"},[m,S]),{isApp:d}=K();return h.useEffect(()=>{n==null||n(P)},[P]),e.jsx(e.Fragment,{children:e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:a=>le(a),children:e.jsxs(Ae,{isLazy:!0,trigger:d?"click":"hover",placement:"top-start",children:[e.jsx(fe,{children:e.jsx(ae,{as:"button",cursor:P=="$0"?"text":"help",children:e.jsx($,{h:"14px",isLoaded:!!P&&!t&&!o,children:e.jsx(y,{color:"text_caption",children:P})})})}),P!=="$0"&&e.jsx(Fe,{children:e.jsx(ve,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(_e,{borderRadius:"12px",p:"8px",children:e.jsxs(M,{align:"flex-start",children:[r&&e.jsx(y,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),m==null?void 0:m.map(a=>{var x;return e.jsxs(v,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(y,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)}),b&&e.jsx(y,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),S==null?void 0:S.map(a=>{var x;return e.jsxs(v,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(y,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)})]})})})})]})})})})},_s="/images/icon_active_new@2x.png";function Me({isActive:s,isLoading:n,imgStyle:l={},...i}){const{imgW:p="16px",imgH:t="12px"}=l;return e.jsx(ne,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...i,children:e.jsx(Pe,{placement:"top",tooltip:e.jsx(y,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(ae,{onClick:A=>le(A),children:e.jsxs(v,{align:"center",children:[s&&e.jsx(I,{w:p,h:t,src:_s}),e.jsx($,{w:"100%",isLoaded:!n,children:e.jsx(y,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Ps({positionInfo:s,tokenName:n,priceDirect:l,isShowIcon:i}){const{posPoolsRelatedData:p}=ce(),t=p[s==null?void 0:s.posId],A=(t==null?void 0:t.currentStatus)=="Active",{isApp:j}=K(),o=h.useMemo(()=>t==null?void 0:t.minPriceOrigin,[t]),r=h.useMemo(()=>t==null?void 0:t.maxPriceOrigin,[t]),b=h.useMemo(()=>t==null?void 0:t.currentPriceOrigin,[t]),[f,_]=h.useState(0),m=h.useRef(null);h.useEffect(()=>{const d=()=>{m.current&&_(m.current.offsetWidth)},T=new ResizeObserver(d);return m.current&&T.observe(m.current),()=>{m.current&&T.unobserve(m.current)}},[o,r,b]);const S=h.useMemo(()=>{if(r==="âˆž")return"0px";if(b&&o&&r&&f){if(g(b).lessThanOrEqualTo(r)&&g(b).greaterThanOrEqualTo(o)){const d=g(b).sub(o).div(g(r).sub(g(o))).toString();return`${g(f).mul(d).toFixed(0)}px`}if(g(b).lt(o))return"6px";if(g(b).gt(r))return"calc(100% + 6px)"}return"0px"},[b,o,r,f]),{getExplorerUrl:P}=Ee();return e.jsxs(M,{align:{base:"flex-end",lg:"flex-start"},gap:{base:"4px",lg:"8px"},w:"100%",maxW:"100%",children:[e.jsxs(v,{justify:{base:"flex-end",lg:"flex-start"},maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:{base:"0",lg:"16px"},children:[e.jsx($,{isLoaded:!!(t!=null&&t.minPrice)&&!!(t!=null&&t.maxPrice),borderRadius:"4px",children:l?e.jsx(y,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPrice} - ${t==null?void 0:t.maxPrice}`}):e.jsx(y,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPriceResever} - ${t==null?void 0:t.maxPriceResever}`})}),!j&&e.jsx(Me,{isActive:A,isLoading:(t==null?void 0:t.currentStatus)==""}),i&&!j&&e.jsx(v,{onClick:d=>le(d),children:e.jsx(Pe,{placement:"top",tooltip:e.jsxs(v,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(v,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx($,{isLoaded:!!n,children:e.jsx(y,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:n==null?void 0:n.split("|")[1]})})]}),e.jsxs(v,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(Ue,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(P(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(ae,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ne,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsxs(v,{children:[j&&e.jsx(Me,{isActive:A,isLoading:(t==null?void 0:t.currentStatus)==""}),e.jsx($,{h:"6px",isLoaded:!!(t!=null&&t.currentPriceOrigin),borderRadius:"4px",children:e.jsx(E,{w:"88px",h:"6px",bgImage:r==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(E,{w:r==="âˆž"?"88px":"56px",h:r==="âˆž"?"2px":"6px",position:"relative",ref:m,background:r==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":A?"url('/images/img_range@2x.png')":"none",ml:r==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:r!=="âˆž"&&e.jsx(E,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:S,transform:"translateY(-50%)",zIndex:"5"})})})})]})]})}function Ts({positionInfo:s,positionItemWidth:n=[],priceDirect:l,showMiningIcon:i,showFarmingIcon:p}){const{isApp:t}=K(),{getExplorerUrl:A}=Ee(),{getClmmPosName:j}=us(),o=Se(),{setCurrentPosDetailTab:r}=ys(),{posPoolsOriginalData:b,posPoolsRelatedData:f,posApiPoolData:_,poolRangeObj:m}=ce(),S=f[s==null?void 0:s.posId],P=_[s==null?void 0:s.clmmPool],d=h.useMemo(()=>{var C;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const z=(C=b==null?void 0:b[s==null?void 0:s.clmmPool])==null?void 0:C.index;return j(Number(s==null?void 0:s.index),z)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,b]),T=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),o(`/position-detail/${s==null?void 0:s.id}`)},[u,a]=h.useState(!1),{getPositionApr:x}=$e(),L=h.useMemo(()=>{if(V(S)&&V(P)&&V(m)){const C=m[s==null?void 0:s.clmmPool];if(C){const z=C==null?void 0:C.ranges.reduce((F,O)=>(F[O.dateType]=O,F),{});return x(P,S,"week",z.week)}}},[S,P,s,m]);bs();const[B,ee]=h.useState(null),[se,X]=h.useState(null),W=(S==null?void 0:S.currentStatus)=="Active";return e.jsx(We,{onMouseEnter:()=>{setTimeout(()=>{a(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{a(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:T,children:e.jsx(v,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(M,{w:"100%",align:"flex-start",gap:"12px",children:[t&&e.jsxs(v,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(v,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx($,{isLoaded:!!d,children:e.jsx(y,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:d==null?void 0:d.split("|")[1]})})]}),e.jsxs(v,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(Ue,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(A(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(v,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[e.jsxs(v,{w:{base:"100%",lg:n[0]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",whiteSpace:"nowrap",children:"Price Range"}),e.jsx(Ps,{positionInfo:s,tokenName:d,priceDirect:l,isShowIcon:u})]}),e.jsxs(v,{w:{base:"100%",lg:n[1]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"APR"}),e.jsx($,{isLoaded:!!L,children:e.jsx(y,{textAlign:"right",color:"primary",children:W?L==null?void 0:L.displayAprPercentageTotal:"0%"})})]}),e.jsxs(v,{m:"-12px 0",w:{base:"100%",lg:n[2]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Liquidity"}),e.jsx(js,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(v,{m:"-12px 0",w:{base:"100%",lg:n[3]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Pending Fees"}),e.jsx(fs,{positionInfo:s,onFeesChange:ee})]}),(i||p)&&e.jsxs(v,{m:"-12px 0",w:{base:"100%",lg:n[4]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(v,{gap:"4px",children:[t&&i&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),t&&p&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(vs,{positionInfo:s,onRewardsChange:X})]})]})]}),t&&e.jsxs(Ze,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(y,{color:"primary_gray",children:"Manage"}),e.jsx(Ne,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const je=["480px","20%","20%","20%","20%"],He=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],ks=He.reduce((s,n)=>(s[n.value]=n,s),{});function Qs({poolInfo:s,priceDirect:n}){const{coinPriceObj:l}=Oe(),{getPositionSortList:i}=As(),[p,t]=h.useState("desc"),[A,j]=h.useState({label:"",value:""}),o=d=>{(d==null?void 0:d.value)===A.value?t(T=>T==="desc"?"asc":"desc"):(t("desc"),j(d))},[r,b]=h.useState([]),f=h.useMemo(()=>{if(!V(s))return[];const d=i(A.value,p,s.list),T=A.value?d:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",T,d),b(d),T},[A.value,p,s==null?void 0:s.list,l]),_=d=>r.some(T=>g(T[d]).gt(0)),m=h.useMemo(()=>_("totalMiningAmount"),[r]),S=h.useMemo(()=>_("totalFarmingAmount"),[r]),{isApp:P}=K();return e.jsxs(M,{gap:"12px",w:"100%",children:[!P&&e.jsxs(v,{w:"100%",p:"0 16px",children:[e.jsx(y,{w:je[0],children:"Price Range"}),He.map((d,T)=>d.value!=="rewards"||m||S?e.jsxs(v,{gap:"4px",w:je[T+1],justify:"flex-end",children:[m&&d.value==="rewards"&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),S&&d.value==="rewards"&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(hs,{labelInfo:ks[d.value],sortRule:p,sortBy:A,clickSort:o})]},d.value):null)]}),e.jsx(M,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:f.map(d=>e.jsx(Ts,{positionInfo:d,positionItemWidth:je,priceDirect:n,showMiningIcon:m,showFarmingIcon:S},d==null?void 0:d.id))})]})}export{Vs as F,Qs as P,Js as V,As as a,Ys as u};
//# sourceMappingURL=PositionItem-DwuhOnTP.js.map
