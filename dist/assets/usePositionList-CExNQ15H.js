import{R as N,Q as j,r as q,W as h,aK as O,b9 as F,bf as G,be as v,d as _,a9 as b,a8 as B,b_ as E,a_ as L,b$ as M,c0 as $}from"./index-BAaNMf6I.js";import{u as x}from"./useToken-DV8FZdgD.js";import{a as K}from"./useFavoritePool-rr4WwvpD.js";import{e as X,c as W,f as C,d as V}from"./useGetPoolList-Ch-cSiNu.js";const Y=(i,R)=>({showPosListLength:"",setShowPosListLength:t=>{i(()=>({showPosListLength:t}))},posApiPoolData:{},setPosApiPoolData:t=>{i(()=>({posApiPoolData:t}))},myPosYieldValue:"",setMyPosYieldValue:t=>{i(()=>({myPosYieldValue:t}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:t=>{const w=t.reduce((c,r)=>{var g,p,s;return c[r.clmmPool]||(c[r.clmmPool]={list:[]}),(g=c[r.clmmPool])!=null&&g.tokenA||(c[r.clmmPool].isReverse=r==null?void 0:r.isReverse,c[r.clmmPool].tokenA=r==null?void 0:r.tokenA,c[r.clmmPool].tokenB=r==null?void 0:r.tokenB,c[r.clmmPool].displayTokenA=r==null?void 0:r.displayTokenA,c[r.clmmPool].displayTokenB=r==null?void 0:r.displayTokenB,c[r.clmmPool].clmmPoolAddress=r.clmmPool),(s=(p=c[r.clmmPool])==null?void 0:p.list)==null||s.push(r),c},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",w),i(()=>({posBaseList:t,posBaseListGroupByPool:w,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:t=>{i(()=>({posBaseListLoading:t}))},setPosBaseListIsLoading:t=>{i(()=>({posBaseListLoading:t}))},fullRangePosBaseList:[],setFullRangePosBaseList:t=>{i(()=>({fullRangePosBaseList:t,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:t=>{i(()=>({fullRangePosBaseListLoading:t}))},posPoolsOriginalData:{},setPosPoolOriginalData:t=>{i(()=>({posPoolsOriginalData:t}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:t=>{i(()=>({posPoolsRelatedData:t,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:t=>{i(()=>({posPoolsRelatedDataLoading:t}))},posLiquidityData:{},setPosLiquidityData:t=>{i(()=>({posLiquidityData:t,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:t=>{i(()=>({posLiquidityDataLoading:t}))},posRewardsData:{},setPosRewardsData:t=>{i(()=>({posRewardsData:t,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:t=>{i(()=>({posRewardsDataLoading:t}))},farmsPosRewardsData:{},setFarmsPosRewardsData:t=>{i(()=>({farmsPosRewardsData:t,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:t=>{i(()=>({farmsPosRewardsDataLoading:t}))},posFeeData:{},setPosFeeData:t=>{i(()=>({posFeeData:t,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:t=>{i(()=>({posFeeDataLoading:t}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:t=>{i(()=>({currentPosBaseInfo:t,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:t=>{i(()=>({currentPosBaseInfoLoading:t}))}}),S=N(Y);function U(){const{peripherySdk:i}=j(),{getTokenInfo:R}=x(),{setFarmsPosRewardsData:t,setFarmsPosRewardsDataLoading:w}=S(),c=q.useRef(i);return q.useEffect(()=>{c.current=i},[i.ClmmSDK.senderAddress]),{getFarmsRewardsData:async g=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",g),w(!0);const p=g==null?void 0:g.filter(s=>s.posType==="farms").map(s=>({pool_id:s.farmsPool,position_nft_id:s.id}));try{let s={},a={};if(p&&p.length>0&&(s=await c.current.Farms.calculateFarmingRewards(p),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",s,c.current.ClmmSDK.senderAddress,p),s)){const o=Object.entries(s).map(([u,n])=>({id:u,rewarderAmountOwed:n}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",o),a=Object.fromEntries(o.map((u,n)=>{for(const e of u.rewarderAmountOwed){const{rewarder_amount:m,rewarder_type:f}=e,d=R(f);e.display_amount_owed=h(m.toString(),(d==null?void 0:d.decimals)||0),e.amount_owed=m.toString(),e.token=d}return[u.id,u.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",a),t(a)}catch(s){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",s)}}}}function H(){const{setPosApiPoolData:i}=S(),{getFavoritePoolList:R}=K();return{getPosApiPoolData:async w=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",w);const r={needLocalData:!1,pools:Array.from(new Set(w==null?void 0:w.map(s=>s.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",r);const g=await R(r)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",g);const p=g==null?void 0:g.list.reduce((s,a)=>(s[a.poolAddress]=a,s),{});i(p)}catch(c){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",c)}}}}function Q(){const{clmmSdk:i}=O(),{setPosFeeData:R,setPosFeeDataLoading:t}=S();return{getPosFeeData:async c=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",c),t(!0);const r=c==null?void 0:c.map(s=>({poolAddress:s.clmmPool,positionId:s.posId,coinTypeA:s.coinTypeA,coinTypeB:s.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",r);const g=await i.Position.fetchPosFeeAmount(r)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",g);const p=Object.fromEntries(g.map((s,a)=>{var e,m;const o=c[a],u=h(o.isReverse?s.feeOwedB.toString():s.feeOwedA.toString(),((e=o==null?void 0:o.displayTokenA)==null?void 0:e.decimals)||0),n=h(o.isReverse?s.feeOwedA.toString():s.feeOwedB.toString(),((m=o==null?void 0:o.displayTokenB)==null?void 0:m.decimals)||0);return[s.position_id,{feeOwedA:s.feeOwedA.toString(),feeOwedB:s.feeOwedB.toString(),displayFeeOwedA:u,displayFeeOwedB:n}]}));console.log("getPosFeeData ~ posFeesData:",p),R(p)}}}function z(){const{setPosLiquidityData:i,setPosLiquidityDataLoading:R}=S(),t=({tokenA:c,tokenB:r,liquidity:g,currentSqrtPrice:p,lowerTick:s,upperTick:a,roundUp:o})=>{const u=F.tickIndexToSqrtPriceX64(s),n=F.tickIndexToSqrtPriceX64(a),e=G.getCoinAmountFromLiquidity(new v(g),new v(p),u,n,o),m=e.coinA.toString(),f=e.coinB.toString(),d=c.decimals,y=r.decimals,P=h(m,d||0),l=h(f,y||0);return{coinAmountA:m,coinAmountB:f,amountA:P,amountB:l}};return{getPosLiquidityData:async(c,r)=>{R(!0);const g={};for(let p=0;p<c.length;p++){const s=c[p],a=r==null?void 0:r[s.clmmPool],{coinAmountA:o,coinAmountB:u,amountA:n,amountB:e}=t({tokenA:s.tokenA,tokenB:s.tokenB,liquidity:s.liquidity,currentSqrtPrice:a==null?void 0:a.current_sqrt_price,lowerTick:s.lowerTick,upperTick:s.upperTick,roundUp:!0}),m=X(s.lowerTick,s.upperTick),f=s.tokenA.decimals,d=s.tokenB.decimals,y=F.sqrtPriceX64ToPrice(new v(a==null?void 0:a.current_sqrt_price),f,d).toString(),{percentA:P,percentB:l}=W(n,e,y,m);g[s.posId]={coinAmountA:o,coinAmountB:u,displayCoinAmountA:s.isReverse?e:n,displayCoinAmountB:s.isReverse?n:e,displayPercentA:s.isReverse?l:P,displayPercentB:s.isReverse?P:l}}console.log("getPosLisuidityData ~ posLiquidityData:",g),i(g)},getCoinAmountFromLiquidity:t}}function J(){const{clmmSdk:i}=O(),{setPosPoolOriginalData:R,setPosPoolsRelatedData:t,setPosPoolsRelatedDataLoading:w,setFullRangePosBaseList:c,setFullRangePosBaseListLoading:r}=S();return{getPosPoolsOriginalObj:async s=>{const a=s==null?void 0:s.map(n=>n.clmmPool),o=[...new Set([...a])];let u={};if(o&&o.length>0){const n=await i.Pool.getPools(o,0,1e3);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",n),u=Object.fromEntries(n==null?void 0:n.map(e=>{const m=s.find(l=>l.clmmPool===(e==null?void 0:e.poolAddress)),f=m.tokenA.decimals,d=m.tokenB.decimals,y=F.sqrtPriceX64ToPrice(new v(e==null?void 0:e.current_sqrt_price),f,d).toString(),P=_(1).div(y).toString();return[e==null?void 0:e.poolAddress,{...e,currentPrice:y,currentPriceReverse:P}]}))}return R(u),u},getPosPoolsRelatedData:(s,a)=>{w(!0),r(!0);const o={},u=[];s.forEach(n=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",n);const e=a[n.clmmPool],m=n.tokenA.decimals,f=n.tokenB.decimals,d=F.sqrtPriceX64ToPrice(new v(e==null?void 0:e.current_sqrt_price),m,f).toString(),y=_(1).div(d).toString();let P="0",l="0";C(n.lowerTick,"min")?P="0":P=F.tickIndexToPrice(Number(n.lowerTick),m,f).toString(),C(n.upperTick,"max")?l="âˆž":l=F.tickIndexToPrice(Number(n.upperTick),m,f).toString();let A,k;l!=="âˆž"?k=_(1).div(_(l)).toString():k="0",P!=="0"?A=_(1).div(_(P)).toString():A="âˆž";let T="";e!=null&&e.is_pause?T="Closed":Number(d)>=Number(P)&&(l==="âˆž"||Number(d)<=Number(l))?T="Active":(Number(d)>Number(l)||Number(d)<Number(P))&&(T="Inactive"),(P==="0"&&l==="âˆž"||A==="0"&&k==="âˆž")&&n.posType==="clmm"&&u.push(n);const D=n.isReverse;o[n.posId]={currentPrice:e?b(D?y:d).toString():"",currentPriceReverse:e?b(D?d:y).toString():"",minPrice:b(D?k:P).toString(),minPriceResever:b(D?P:k).toString(),maxPrice:b(D?A:l).toString(),maxPriceResever:b(D?l:A).toString(),minPriceOrigin:e?D?k:P:"",maxPriceOrigin:e?D?A:l:"",currentStatus:e?T:"",fee:e==null?void 0:e.fee_rate,displayFee:_(e==null?void 0:e.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:e==null?void 0:e.tickSpacing,currentTickIndex:e==null?void 0:e.current_tick_index,curSqrtPrice:e==null?void 0:e.current_sqrt_price,liquidity:e==null?void 0:e.liquidity}}),t(o),c(u)}}}function Z(){const{clmmSdk:i}=O(),{getTokenInfo:R}=x(),{setPosRewardsData:t,setPosRewardsDataLoading:w}=S();return{getPosRewardsData:async(r,g)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",r),w(!0);const p=r==null?void 0:r.filter(a=>a.posType!=="farms").map(a=>{const o=g[a.clmmPool];return{poolAddress:a.clmmPool,positionId:a.posId,coinTypeA:a.coinTypeA,coinTypeB:a.coinTypeB,rewarderInfo:o.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",p);let s={};if(p&&p.length>0)try{const a=await i.Rewarder.fetchPosRewardersAmount(p);s=Object.fromEntries(a.map((o,u)=>{for(const n of o.rewarderAmountOwed){const{amount_owed:e,coin_address:m}=n,f=R(m);n.display_amount_owed=h(e.toString(),(f==null?void 0:f.decimals)||0),n.amount_owed=e.toString(),n.token=f}return[o.positionId,o.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",s)}catch(a){console.log("getPosRewardsData ~ error:",a)}t(s)}}}function I(){const i=(c,r)=>{if(r||r==0)return`Cetus LP | Pool${r}-${c}`},R=q.useMemo(()=>`${B.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[B]),t=q.useMemo(()=>`${B.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[B]),w=q.useMemo(()=>`${B.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[B]);return{getClmmPosName:i,buildPositionType:R,buildFarmsPositionType:t,buildBurnPositionType:w}}function ee(){const{buildPositionType:i,buildFarmsPositionType:R,buildBurnPositionType:t}=I(),{getTokenInfo:w}=x(),c=(a,o)=>{const u=!V(a,o),n=w(a),e=w(o);return{isReverse:u,tokenA:n,tokenB:e,displayTokenA:u?e:n,displayTokenB:u?n:e}},r=a=>{var l;const o=E(a),u=L(o.coin_type_a).full_address,n=L(o.coin_type_b).full_address,{isReverse:e,tokenA:m,tokenB:f,displayTokenA:d,displayTokenB:y}=c(u,n),P=((l=a==null?void 0:a.data)==null?void 0:l.version)||"0";return{clmmPool:o.pool,posId:o.pos_object_id,id:o.pos_object_id,liquidity:o.liquidity,index:o.index,lowerTick:o.tick_lower_index,upperTick:o.tick_upper_index,owner:o.owner,coinTypeA:u,coinTypeB:n,posType:"clmm",tokenName:"",tokenA:m,tokenB:f,displayTokenA:d,displayTokenB:y,isReverse:e,version:P}},g=a=>{var l;const o=M.buildFramsPositionNFT(a),u=((l=a==null?void 0:a.data)==null?void 0:l.version)||"0",n=L(o.coinTypeA).full_address,e=L(o.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:d,displayTokenA:y,displayTokenB:P}=c(n,e);return{clmmPool:o.clmm_pool_id,farmsPool:o.pool_id,posId:o.clmm_position_id,id:o.id,liquidity:o.liquidity,index:o.name.split("-")[1],lowerTick:o.tick_lower_index,upperTick:o.tick_upper_index,owner:"",coinTypeA:n,coinTypeB:e,posType:"farms",tokenName:o.name,isReverse:m,tokenA:f,tokenB:d,displayTokenA:y,displayTokenB:P,version:u}},p=a=>{var l,A,k;const o=$.buildBurnPositionNFT((A=(l=a==null?void 0:a.data)==null?void 0:l.content)==null?void 0:A.fields),u=((k=a==null?void 0:a.data)==null?void 0:k.version)||"0",n=L(o.coinTypeA).full_address,e=L(o.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:d,displayTokenA:y,displayTokenB:P}=c(n,e);return{clmmPool:o.clmm_pool_id,posId:o.clmm_position_id,liquidity:o.liquidity,index:o.index,id:o.id,lowerTick:o.tick_lower_index,upperTick:o.tick_upper_index,owner:"",coinTypeA:n,coinTypeB:e,posType:"burn",tokenName:o.name,isReverse:m,tokenA:f,tokenB:d,displayTokenA:y,displayTokenB:P,version:u}};return{wrapClmmPosBaseInfo:r,wrapBurnPosBaseInfo:p,wrapFarmsPosBaseInfo:g,buildPosBaseInfo:a=>{const o=L(a.data.type);return o.full_address===i?r(a):o.full_address===R?g(a):o.full_address===t?p(a):null}}}function re(){const{clmmSdk:i}=O(),{buildFarmsPositionType:R,buildBurnPositionType:t}=I(),{buildPosBaseInfo:w}=ee(),{setPosBaseList:c,setFullRangePosBaseList:r,setPosBaseListLoading:g}=S(),{getPosPoolsOriginalObj:p,getPosPoolsRelatedData:s}=J(),{getPosLiquidityData:a}=z(),{getPosFeeData:o}=Q(),{getPosApiPoolData:u}=H(),{getPosRewardsData:n}=Z(),{getFarmsRewardsData:e}=U();return{getPositionBaseList:async(d,y)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",y),g(!0);try{const P=await i.fullClient.getOwnedObjectsByPage(d,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:B.clmm_sdk_options.clmm_pool.package_id},{StructType:R},{StructType:t}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",P);const l=[];for(const T of P.data){const D=w(T);_(D==null?void 0:D.liquidity).lte(0)||!(D!=null&&D.displayTokenA)||!(D!=null&&D.displayTokenB)||D&&l.push(D)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",l);const A=l.sort((T,D)=>D.version-T.version);let k=[];return y?k=A==null?void 0:A.filter(T=>T.clmmPool===y):k=A,c(k),g(!1),(k==null?void 0:k.length)==0&&r([]),k}catch(P){if(console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",P),P instanceof TypeError)return g(!1),c([]),"Something went wrong, please change the rpc node and try again"}},getPosRelatedData:async(d,y=!1)=>{var P;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",y,d),e(d),y||(u(d),o(d));try{const l=await p(d);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",l),s(d,l),((P=Object.keys(l))==null?void 0:P.length)>0&&(a(d,l),y||n(d,l))}catch(l){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",l)}}}}export{S as a,re as b,Q as c,Z as d,U as e,z as f,ee as g,I as u};
