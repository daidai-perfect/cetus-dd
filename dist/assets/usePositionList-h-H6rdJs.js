import{U as j,bT as A,bU as C,bV as E,bW as W,bX as M,u as V,an as $,R as Y,r as O,X as v,aI as x,bb as F,bh as K,bg as q,d as _,ab as b,aa as h,bY as U,aX as S,bZ as H,b_ as Z}from"./index-B590w5bb.js";import{u as N}from"./useToken-BmuTH09v.js";import{l as z}from"./api-data-utils-CYJ1lZoU.js";import{u as J,d as Q,e as ee,c as oe,f as G,h as se}from"./useGetPoolList-Cy1o8r-8.js";const te=(t,D)=>({poolListLength:"",setPoolListLength:e=>{t(()=>({poolListLength:e}))},poolRefreshStatus:"pending",setPoolRefreshStatus:e=>{t(()=>({poolRefreshStatus:e}))},isWatchList:void 0,setIsWatchList:e=>{t(()=>({isWatchList:e})),A.setItem(M,e)},isAllPools:!1,setIsAllPools:e=>{t(()=>({isAllPools:e})),A.setItem(W,e)},isIncentivizedOnly:!1,setIsIncentivizedOnly:e=>{t(()=>({isIncentivizedOnly:e})),A.setItem(E,e)},poolFavoriteIds:[],setPoolFavoriteId:e=>{const m=[...D().poolFavoriteIds,e];t(()=>({poolFavoriteIds:m})),A.setItem(C,m)},setPoolFavoriteIds:e=>{t(()=>({poolFavoriteIds:e})),A.setItem(C,e)},poolFavoriteIdsChange:!1,setPoolFavoriteIdsChange:e=>{t(()=>({poolFavoriteIdsChange:e}))}}),I=j(te);A.getItem(C).then(t=>{console.log("ðŸš€ ~ file: store/pool/index.ts.ts ~ savedPoolFavoriteList:",t),(t==null?void 0:t.length)>0&&I.getState().setPoolFavoriteIds(t)});A.getItem(M).then(t=>{console.log("ðŸš€ ~ LocalStorageService isWatchList:",t),typeof t=="boolean"?I.getState().setIsWatchList(t):I.getState().setIsWatchList(!1)});A.getItem(W).then(t=>{console.log("ðŸš€ ~ LocalStorageService isAllPools:",t),typeof t=="boolean"&&I.getState().setIsAllPools(t)});A.getItem(E).then(t=>{console.log("ðŸš€ ~ LocalStorageService isIncentivizedOnly:",t),typeof t=="boolean"&&I.getState().setIsIncentivizedOnly(t)});function ae(){const{fetchByApi:t}=V(),{getLocalJsonPoolList:D}=J(),{wrapPoolData:e}=Q(),{poolFavoriteIds:m,setPoolFavoriteId:c,setPoolFavoriteIds:i,setPoolFavoriteIdsChange:P}=I(),{successTsToast:p,failedTsToast:a}=$();return{addFavorites:r=>{const o={linkLabel:"",getShowInfo:()=>({toastTitleText:m.length>=100?"Watchlist exceeds the maximum limit":"Added to Watchlist"})};m.length>=100?a(o):(c(r),P(!0),p(o))},removeFavorites:r=>{const o=m==null?void 0:m.filter(f=>f!==r);i(o),P(!0),p({linkLabel:"",getShowInfo:()=>({toastTitleText:"Removed from Watchlist"})})},getFavoritePoolList:async r=>{var f,u,w;const{needLocalData:o=!0}=r;if(((r==null?void 0:r.pools)||[]).length>0)try{const l=await t(z,"POST",r);if(l!=null&&l.data)return console.log("ðŸš€ ~ getFavoritePoolList ~ res?.data:",l==null?void 0:l.data),{list:(u=(f=l==null?void 0:l.data)==null?void 0:f.lp_list)==null?void 0:u.map(k=>e(k)),total:(w=l==null?void 0:l.data)==null?void 0:w.total}}catch(l){if(console.log("ðŸš€ ~ getFavoritePoolList ~ error:",l),o)return await D(r)}return{list:[],total:0}}}}const ne=(t,D)=>({showPosListLength:"",setShowPosListLength:e=>{t(()=>({showPosListLength:e}))},posApiPoolData:{},setPosApiPoolData:e=>{t(()=>({posApiPoolData:e}))},myPosYieldValue:"",setMyPosYieldValue:e=>{t(()=>({myPosYieldValue:e}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:e=>{const m=e.reduce((c,i)=>{var P,p,a;return c[i.clmmPool]||(c[i.clmmPool]={list:[]}),(P=c[i.clmmPool])!=null&&P.tokenA||(c[i.clmmPool].isReverse=i==null?void 0:i.isReverse,c[i.clmmPool].tokenA=i==null?void 0:i.tokenA,c[i.clmmPool].tokenB=i==null?void 0:i.tokenB,c[i.clmmPool].displayTokenA=i==null?void 0:i.displayTokenA,c[i.clmmPool].displayTokenB=i==null?void 0:i.displayTokenB,c[i.clmmPool].clmmPoolAddress=i.clmmPool),(a=(p=c[i.clmmPool])==null?void 0:p.list)==null||a.push(i),c},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",m),t(()=>({posBaseList:e,posBaseListGroupByPool:m,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:e=>{t(()=>({posBaseListLoading:e}))},setPosBaseListIsLoading:e=>{t(()=>({posBaseListLoading:e}))},fullRangePosBaseList:[],setFullRangePosBaseList:e=>{t(()=>({fullRangePosBaseList:e,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:e=>{t(()=>({fullRangePosBaseListLoading:e}))},posPoolsOriginalData:{},setPosPoolOriginalData:e=>{t(()=>({posPoolsOriginalData:e}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:e=>{t(()=>({posPoolsRelatedData:e,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:e=>{t(()=>({posPoolsRelatedDataLoading:e}))},posLiquidityData:{},setPosLiquidityData:e=>{t(()=>({posLiquidityData:e,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:e=>{t(()=>({posLiquidityDataLoading:e}))},posRewardsData:{},setPosRewardsData:e=>{t(()=>({posRewardsData:e,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:e=>{t(()=>({posRewardsDataLoading:e}))},farmsPosRewardsData:{},setFarmsPosRewardsData:e=>{t(()=>({farmsPosRewardsData:e,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:e=>{t(()=>({farmsPosRewardsDataLoading:e}))},posFeeData:{},setPosFeeData:e=>{t(()=>({posFeeData:e,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:e=>{t(()=>({posFeeDataLoading:e}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:e=>{t(()=>({currentPosBaseInfo:e,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:e=>{t(()=>({currentPosBaseInfoLoading:e}))}}),B=j(ne);function re(){const{peripherySdk:t}=Y(),{getTokenInfo:D}=N(),{setFarmsPosRewardsData:e,setFarmsPosRewardsDataLoading:m}=B(),c=O.useRef(t);return O.useEffect(()=>{c.current=t},[t.ClmmSDK.senderAddress]),{getFarmsRewardsData:async P=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",P),m(!0);const p=P==null?void 0:P.filter(a=>a.posType==="farms").map(a=>({pool_id:a.farmsPool,position_nft_id:a.id}));try{let a={},n={};if(p&&p.length>0&&(a=await c.current.Farms.calculateFarmingRewards(p),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",a,c.current.ClmmSDK.senderAddress,p),a)){const s=Object.entries(a).map(([g,r])=>({id:g,rewarderAmountOwed:r}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",s),n=Object.fromEntries(s.map((g,r)=>{for(const o of g.rewarderAmountOwed){const{rewarder_amount:y,rewarder_type:f}=o,u=D(f);o.display_amount_owed=v(y.toString(),(u==null?void 0:u.decimals)||0),o.amount_owed=y.toString(),o.token=u}return[g.id,g.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",n),e(n)}catch(a){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",a)}}}}function ie(){const{setPosApiPoolData:t}=B(),{getFavoritePoolList:D}=ae();return{getPosApiPoolData:async m=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",m);const i={needLocalData:!1,pools:Array.from(new Set(m==null?void 0:m.map(a=>a.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",i);const P=await D(i)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",P);const p=P==null?void 0:P.list.reduce((a,n)=>(a[n.poolAddress]=n,a),{});t(p)}catch(c){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",c)}}}}function le(){const{clmmSdk:t}=x(),{setPosFeeData:D,setPosFeeDataLoading:e}=B();return{getPosFeeData:async c=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",c),e(!0);const i=c==null?void 0:c.map(a=>({poolAddress:a.clmmPool,positionId:a.posId,coinTypeA:a.coinTypeA,coinTypeB:a.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",i);const P=await t.Position.fetchPosFeeAmount(i)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",P);const p=Object.fromEntries(P.map((a,n)=>{var o,y;const s=c[n],g=v(s.isReverse?a.feeOwedB.toString():a.feeOwedA.toString(),((o=s==null?void 0:s.displayTokenA)==null?void 0:o.decimals)||0),r=v(s.isReverse?a.feeOwedA.toString():a.feeOwedB.toString(),((y=s==null?void 0:s.displayTokenB)==null?void 0:y.decimals)||0);return[a.position_id,{feeOwedA:a.feeOwedA.toString(),feeOwedB:a.feeOwedB.toString(),displayFeeOwedA:g,displayFeeOwedB:r}]}));console.log("getPosFeeData ~ posFeesData:",p),D(p)}}}function ce(){const{setPosLiquidityData:t,setPosLiquidityDataLoading:D}=B(),e=({tokenA:c,tokenB:i,liquidity:P,currentSqrtPrice:p,lowerTick:a,upperTick:n,roundUp:s})=>{const g=F.tickIndexToSqrtPriceX64(a),r=F.tickIndexToSqrtPriceX64(n),o=K.getCoinAmountFromLiquidity(new q(P),new q(p),g,r,s),y=o.coinA.toString(),f=o.coinB.toString(),u=c.decimals,w=i.decimals,l=v(y,u||0),d=v(f,w||0);return{coinAmountA:y,coinAmountB:f,amountA:l,amountB:d}};return{getPosLiquidityData:async(c,i)=>{D(!0);const P={};for(let p=0;p<c.length;p++){const a=c[p],n=i==null?void 0:i[a.clmmPool],{coinAmountA:s,coinAmountB:g,amountA:r,amountB:o}=e({tokenA:a.tokenA,tokenB:a.tokenB,liquidity:a.liquidity,currentSqrtPrice:n==null?void 0:n.current_sqrt_price,lowerTick:a.lowerTick,upperTick:a.upperTick,roundUp:!0}),y=ee(a.lowerTick,a.upperTick),f=a.tokenA.decimals,u=a.tokenB.decimals,w=F.sqrtPriceX64ToPrice(new q(n==null?void 0:n.current_sqrt_price),f,u).toString(),{percentA:l,percentB:d}=oe(r,o,w,y);P[a.posId]={coinAmountA:s,coinAmountB:g,displayCoinAmountA:a.isReverse?o:r,displayCoinAmountB:a.isReverse?r:o,displayPercentA:a.isReverse?d:l,displayPercentB:a.isReverse?l:d}}console.log("getPosLisuidityData ~ posLiquidityData:",P),t(P)},getCoinAmountFromLiquidity:e}}function de(){const{clmmSdk:t}=x(),{setPosPoolOriginalData:D,setPosPoolsRelatedData:e,setPosPoolsRelatedDataLoading:m,setFullRangePosBaseList:c,setFullRangePosBaseListLoading:i}=B();return{getPosPoolsOriginalObj:async a=>{const n=a==null?void 0:a.map(r=>r.clmmPool),s=[...new Set([...n])];let g={};if(s&&s.length>0){const r=await t.Pool.getPools(s,0,1e3);g=Object.fromEntries(r==null?void 0:r.map(o=>{const y=a.find(d=>d.clmmPool===(o==null?void 0:o.poolAddress)),f=y.tokenA.decimals,u=y.tokenB.decimals,w=F.sqrtPriceX64ToPrice(new q(o==null?void 0:o.current_sqrt_price),f,u).toString(),l=_(1).div(w).toString();return[o==null?void 0:o.poolAddress,{...o,currentPrice:w,currentPriceReverse:l}]}))}return D(g),g},getPosPoolsRelatedData:(a,n)=>{m(!0),i(!0);const s={},g=[];a.forEach(r=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",r);const o=n[r.clmmPool],y=r.tokenA.decimals,f=r.tokenB.decimals,u=F.sqrtPriceX64ToPrice(new q(o==null?void 0:o.current_sqrt_price),y,f).toString(),w=_(1).div(u).toString();let l="0",d="0";G(r.lowerTick,"min")?l="0":l=F.tickIndexToPrice(Number(r.lowerTick),y,f).toString(),G(r.upperTick,"max")?d="âˆž":d=F.tickIndexToPrice(Number(r.upperTick),y,f).toString();let k,T;d!=="âˆž"?T=_(1).div(_(d)).toString():T="0",l!=="0"?k=_(1).div(_(l)).toString():k="âˆž";let L="";o!=null&&o.is_pause?L="Closed":Number(u)>=Number(l)&&(d==="âˆž"||Number(u)<=Number(d))?L="Active":(Number(u)>Number(d)||Number(u)<Number(l))&&(L="Inactive"),(l==="0"&&d==="âˆž"||k==="0"&&T==="âˆž")&&r.posType==="clmm"&&g.push(r);const R=r.isReverse;s[r.posId]={currentPrice:o?b(R?w:u).toString():"",currentPriceReverse:o?b(R?u:w).toString():"",minPrice:b(R?T:l).toString(),minPriceResever:b(R?l:T).toString(),maxPrice:b(R?k:d).toString(),maxPriceResever:b(R?d:k).toString(),minPriceOrigin:o?R?T:l:"",maxPriceOrigin:o?R?k:d:"",currentStatus:o?L:"",fee:o==null?void 0:o.fee_rate,displayFee:_(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),e(s),c(g)}}}function ue(){const{clmmSdk:t}=x(),{getTokenInfo:D}=N(),{setPosRewardsData:e,setPosRewardsDataLoading:m}=B();return{getPosRewardsData:async(i,P)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",i),m(!0);const p=i==null?void 0:i.filter(n=>n.posType!=="farms").map(n=>{const s=P[n.clmmPool];return{poolAddress:n.clmmPool,positionId:n.posId,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,rewarderInfo:s.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",p);let a={};if(p&&p.length>0)try{const n=await t.Rewarder.fetchPosRewardersAmount(p);a=Object.fromEntries(n.map((s,g)=>{for(const r of s.rewarderAmountOwed){const{amount_owed:o,coin_address:y}=r,f=D(y);r.display_amount_owed=v(o.toString(),(f==null?void 0:f.decimals)||0),r.amount_owed=o.toString(),r.token=f}return[s.positionId,s.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",a)}catch(n){console.log("getPosRewardsData ~ error:",n)}e(a)}}}function X(){const t=(c,i)=>{if(i||i==0)return`Cetus LP | Pool${i}-${c}`},D=O.useMemo(()=>`${h.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[h]),e=O.useMemo(()=>`${h.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[h]),m=O.useMemo(()=>`${h.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[h]);return{getClmmPosName:t,buildPositionType:D,buildFarmsPositionType:e,buildBurnPositionType:m}}function Pe(){const{buildPositionType:t,buildFarmsPositionType:D,buildBurnPositionType:e}=X(),{getTokenInfo:m}=N(),c=(n,s)=>{const g=!se(n,s),r=m(n),o=m(s);return{isReverse:g,tokenA:r,tokenB:o,displayTokenA:g?o:r,displayTokenB:g?r:o}},i=n=>{var d;const s=U(n),g=S(s.coin_type_a).full_address,r=S(s.coin_type_b).full_address,{isReverse:o,tokenA:y,tokenB:f,displayTokenA:u,displayTokenB:w}=c(g,r),l=((d=n==null?void 0:n.data)==null?void 0:d.version)||"0";return{clmmPool:s.pool,posId:s.pos_object_id,id:s.pos_object_id,liquidity:s.liquidity,index:s.index,lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:s.owner,coinTypeA:g,coinTypeB:r,posType:"clmm",tokenName:"",tokenA:y,tokenB:f,displayTokenA:u,displayTokenB:w,isReverse:o,version:l}},P=n=>{var d;const s=H.buildFramsPositionNFT(n),g=((d=n==null?void 0:n.data)==null?void 0:d.version)||"0",r=S(s.coinTypeA).full_address,o=S(s.coinTypeB).full_address,{isReverse:y,tokenA:f,tokenB:u,displayTokenA:w,displayTokenB:l}=c(r,o);return{clmmPool:s.clmm_pool_id,farmsPool:s.pool_id,posId:s.clmm_position_id,id:s.id,liquidity:s.liquidity,index:s.name.split("-")[1],lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"farms",tokenName:s.name,isReverse:y,tokenA:f,tokenB:u,displayTokenA:w,displayTokenB:l,version:g}},p=n=>{var d,k,T;const s=Z.buildBurnPositionNFT((k=(d=n==null?void 0:n.data)==null?void 0:d.content)==null?void 0:k.fields),g=((T=n==null?void 0:n.data)==null?void 0:T.version)||"0",r=S(s.coinTypeA).full_address,o=S(s.coinTypeB).full_address,{isReverse:y,tokenA:f,tokenB:u,displayTokenA:w,displayTokenB:l}=c(r,o);return{clmmPool:s.clmm_pool_id,posId:s.clmm_position_id,liquidity:s.liquidity,index:s.index,id:s.id,lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"burn",tokenName:s.name,isReverse:y,tokenA:f,tokenB:u,displayTokenA:w,displayTokenB:l,version:g}};return{wrapClmmPosBaseInfo:i,wrapBurnPosBaseInfo:p,wrapFarmsPosBaseInfo:P,buildPosBaseInfo:n=>{const s=S(n.data.type);return s.full_address===t?i(n):s.full_address===D?P(n):s.full_address===e?p(n):null}}}function ye(){const{clmmSdk:t}=x(),{buildFarmsPositionType:D,buildBurnPositionType:e}=X(),{buildPosBaseInfo:m}=Pe(),{setPosBaseList:c,setFullRangePosBaseList:i,setPosBaseListLoading:P}=B(),{getPosPoolsOriginalObj:p,getPosPoolsRelatedData:a}=de(),{getPosLiquidityData:n}=ce(),{getPosFeeData:s}=le(),{getPosApiPoolData:g}=ie(),{getPosRewardsData:r}=ue(),{getFarmsRewardsData:o}=re();return{getPositionBaseList:async(u,w)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",w),P(!0);try{const l=await t.fullClient.getOwnedObjectsByPage(u,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:h.clmm_sdk_options.clmm_pool.package_id},{StructType:D},{StructType:e}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",l);const d=[];for(const L of l.data){const R=m(L);_(R==null?void 0:R.liquidity).lte(0)||!(R!=null&&R.displayTokenA)||!(R!=null&&R.displayTokenB)||R&&d.push(R)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",d);const k=d.sort((L,R)=>R.version-L.version);let T=[];return w?T=k==null?void 0:k.filter(L=>L.clmmPool===w):T=k,c(T),P(!1),(T==null?void 0:T.length)==0&&i([]),T}catch(l){if(console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",l),l instanceof TypeError)return P(!1),c([]),"Something went wrong, please change the rpc node and try again"}},getPosRelatedData:async(u,w=!1)=>{var l;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",w,u),o(u),w||(g(u),s(u));try{const d=await p(u);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",d),a(u,d),((l=Object.keys(d))==null?void 0:l.length)>0&&(n(u,d),w||r(u,d))}catch(d){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",d)}}}}export{ae as a,X as b,B as c,ye as d,le as e,ue as f,re as g,ce as h,Pe as i,I as u};
