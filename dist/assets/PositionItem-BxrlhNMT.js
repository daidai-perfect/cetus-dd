import{y as Ye,a as h,ak as Se,j as e,H as A,C as ae,I,T as y,f as E,P as fe,h as ve,m as Ae,n as _e,p as $,V as M,F as ne,W as Ve,X as Je,Y as Qe,a0 as Ke,$ as Xe,k as Fe,q as Ze}from"./vendor-BowHGuwE.js";import{a as K,J as Te,K as ce,d as g,z as ie,a2 as V,C as Ie,B as Oe,n as we,a9 as ze,$ as Q,aa as es,r as Pe,w as ue,R as Z,f as ge,q as We,h as Ee,I as Ne}from"./index-DnbdeLwO.js";import{u as ss,V as ts,a as rs,b as ns}from"./VaultsAprBlock-BHaIklPU.js";import{a as is,u as as,V as cs}from"./VaultsAction-CdZRq3N3.js";import{u as Ue}from"./useAccountBalance-4JA8lH8K.js";import{u as ls}from"./useInterval-BcJtT0it.js";import{P as os}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as xs}from"./VTextLabelBox-Uio_3C_Q.js";import{u as ps}from"./global-B9IhxtcL.js";import{u as le,b as ds,a as us}from"./usePositionList-BvxvpDIH.js";import{u as gs}from"./useTransaction-CT4mrV_c.js";import{h as ms}from"./RemoveBlock-yVYP3UNn.js";import{T as hs}from"./TableSortTh-ByFNnntj.js";import{b as bs}from"./useClaimPosition-s8OPk8wN.js";import{a as ys}from"./useNotifiSubscription-Br1VuvQq.js";import{S as me,A as De}from"./SingleTokenInfo-DEb2Nxv2.js";import{L as js}from"./ExpendItem-BDmQw4VF.js";function Ys(){const{search:s}=Ye(),[n,c]=h.useState({});return h.useLayoutEffect(()=>{const i=new URLSearchParams(s);c(Object.fromEntries(i.entries()))},[s]),n}const Vs=({tooltip:s,...n})=>{const c=Se(),{isApp:i}=K();return e.jsx(A,{w:"20px",h:"20px",onClick:d=>{ce(d),i||c("/farms")},...n,children:e.jsx(Te,{placement:"top",tooltip:s||e.jsx(y,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(ae,{children:e.jsx(I,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function ws(s){const{minPrice:n,maxPrice:c,currPrice:i}=s,[d,t]=h.useState(0),[f,j]=h.useState(0),o=h.useRef(null),r=h.useRef(null);h.useEffect(()=>{const m=()=>{o.current&&t(o.current.offsetWidth),r.current&&j(r.current.offsetWidth)},S=new ResizeObserver(m),T=new ResizeObserver(m);return o.current&&S.observe(o.current),r.current&&T.observe(r.current),()=>{o.current&&S.unobserve(o.current),r.current&&T.unobserve(r.current)}},[n,c,i]);const b=h.useMemo(()=>{if(c==="âˆž")return"0px";if(i&&n&&c&&d){if(g(i).lessThanOrEqualTo(c)&&g(i).greaterThanOrEqualTo(n)){const m=g(i).sub(n).div(g(c).sub(g(n))).toString();return`${g(d).mul(m).toFixed(0)}px`}if(g(i).lt(n))return"-36px";if(g(i).gt(c))return"calc(100% + 36px)"}return"0px"},[i,n,c,d]),v=h.useMemo(()=>{const m=b.replace("px","");return Number(m)-f/2+"px"},[b,f]),{isApp:_}=K();return e.jsx(e.Fragment,{children:n!==void 0&&c!==void 0&&i!==void 0?e.jsx(A,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(E,{w:"100%",padding:n&&g(i).lt(n)?"0 40px 0 60px":c&&g(i).gt(c)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(y,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:n&&g(i).lt(n)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(n)}),e.jsx(E,{w:"100%",position:"relative",height:"14px",ref:o,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(fe,{isLazy:!0,placement:"top",trigger:_?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(ve,{children:e.jsx(E,{as:"button",children:e.jsx(E,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:b,ml:"-2px",zIndex:"5"})})}),e.jsx(Ae,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:v,zIndex:"5",children:e.jsx(_e,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(y,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:ie(i)})})})]})}),e.jsx(y,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:c&&g(i).gt(c)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(c)})]})},b):e.jsx(A,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx($,{w:"100%",h:"20px"})})})}function Ss(s){const{vaultId:n,displayTokenA:c,displayTokenB:i,feeDisplay:d,minPrice:t,maxPrice:f,currPrice:j}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:o}=ss(),r=h.useMemo(()=>{if(V(o)&&n)return o[n]},[o,n]);return e.jsxs(M,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ne,{children:[e.jsx(Ie,{coinAIconUrl:c==null?void 0:c.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ne,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(E,{children:e.jsxs(ne,{alignItems:"center",children:[e.jsx(y,{fontSize:"16px",color:"text_caption",children:`${c==null?void 0:c.symbol} - ${i==null?void 0:i.symbol}`}),e.jsx(Oe,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(y,{fontSize:"12px",color:"primary",children:d})})]})}),e.jsx(ne,{flexDirection:"column",children:e.jsx(xs,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(ts,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(ws,{minPrice:t,maxPrice:f,currPrice:j})]})}function Js(s){const{currentAccount:n}=we(),{isOpen:c,setIsOpen:i,vaultId:d,category:t,displayTokenA:f,displayTokenB:j,feeDisplay:o,clmmPool:r,isReverse:b}=s,{isOpenWalletModal:v}=we(),{getCurrentVaultDetail:_,getCurrentVaultContractInfo:m}=is(),{clearVaultsActionData:S}=as(),{fetchAccountBalance:T}=Ue(),p=Se(),{vaultsPoolObj:P}=rs(),u=h.useMemo(()=>P[d],[P,d]);h.useEffect(()=>{d&&_(d)},[n==null?void 0:n.address,d]);const{getPythLastPrice:a}=ns(),x=h.useRef(!1);h.useEffect(()=>(x.current=!0,()=>{x.current=!1,S()}),[]),h.useEffect(()=>{u!=null&&u.displayCoinTypeA&&(u!=null&&u.displayCoinTypeB)&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])},[u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB]),ls({interval:20*1e3,callback:()=>{x.current&&t=="haedal"&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])}});const L=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),n!=null&&n.address?(T(),_(d,!0)):m(d)};return e.jsxs(Ve,{isCentered:!0,isOpen:c&&!v,onClose:()=>{i(!1)},children:[e.jsx(Je,{}),e.jsx(Qe,{width:{base:"100%",lg:"420px"},children:e.jsx(Ke,{p:"0 0 8px",children:e.jsxs(M,{width:"100%",children:[e.jsxs(M,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(A,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(y,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Xe,{})]}),e.jsx(Ss,{displayTokenA:f,displayTokenB:j,feeDisplay:o,clmmPool:r,isReverse:b,minPrice:u==null?void 0:u.minPrice,maxPrice:u==null?void 0:u.maxPrice,currPrice:u==null?void 0:u.currentPrice,category:t,vaultId:d}),e.jsx(cs,{vaultId:d,isModal:!0,autoRefresh:L})]}),e.jsxs(A,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:t=="haedal"?"space-between":"center",children:[e.jsx(os,{mt:"0",category:t}),e.jsx(y,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{t&&d&&(S(),p(`/vaults-detail/${d}/${t}`))},children:"Vault Details >"})]})]})})})]})}function $e(){const s=(c,i,d,t)=>{const f=Math.max(c,d),o=Math.min(i,t)-f,r=i-c,b=t-d,v=Q(o.toString()),_=Q(r.toString()),m=Q(b.toString());return o<=0?Q(0):r<=o?m.div(v):o===b?v.div(_):v.div(m).mul(v.div(_))};return{getPositionApr:(c,i,d,t)=>{if(!V(c)||!V(i)||!V(t))return;const{minPrice:f,minPriceResever:j,maxPrice:o,maxPriceResever:r}=i,{tokenA:b,tokenB:v,miningAprList:_,feeApr:m,feeApr7d:S,feeApr30d:T,isReverse:p}=c;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ getPositionApr ~ isReverse:",p),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:28 ~ getPositionApr ~ feeApr30d:",S,T);const P=b==null?void 0:b.decimals,u=v==null?void 0:v.decimals,a=f=="0"&&o=="âˆž",x=p?j:f,L=a?2**50:p?r:o;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:31 ~ getPositionApr ~ lowerUserPrice:",x),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:33 ~ getPositionApr ~ upperUserPrice:",L);const{lower:R,upper:ee}=t;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ range:",t);const se=ze.tickIndexToPrice(R,P,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ beforeContractPriceLowest:",se);const X=ze.tickIndexToPrice(ee,P,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:40 ~ getPositionApr ~ beforeContractPriceHighest:",X),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ lowerUserPrice, upperUserPrice, beforeContractPriceLowest, beforeContractPriceHighest:",x,L,se,X);const O=s(x,L,se,X);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:41 ~ getPositionApr ~ positionMulti:",O.toString());const k=Q(d=="day"?m:d=="month"?T:S).mul(O).toString(),z=[];let F=Q(k);return _==null||_.forEach(W=>{const H=Q(O).mul(W.apr).toString();z.push({...W,posMiningRewardApr:H}),F=F.add(H)}),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:45 ~ getPositionApr ~",{aprPercentageTotal:F.toString(),aprByFee:k,posMiningReward:z}),{aprPercentageTotal:F.toString(),displayAprPercentageTotal:es(F.toNumber()*100),aprByFee:k,posMiningReward:z}}}}function fs(){const[s,n]=h.useState(!1),{getPositionApr:c}=$e(),{getTokenAmountValue:i}=Pe(),{posPoolsRelatedData:d,posLiquidityData:t,posFeeData:f,farmsPosRewardsData:j,posRewardsData:o,posApiPoolData:r,poolRangeObj:b,setPosBaseList:v}=le(),{mevProtect:_,transactionMode:m,maxCapForGas:S,customGasPrice:T}=ps(),{getCloseTsPayloadAll:p}=ms(),{signAndExecuteTransaction:P,transactionConfirmation:u}=gs(),{fetchAccountBalance:a}=Ue(),{getPositionBaseList:x,getPosRelatedData:L}=ds(),{currentAccount:R}=we(),ee=async()=>{const O=await x(R==null?void 0:R.address);L(O)};return{getPositionSortList:(O,k,z)=>{if(!(z!=null&&z.length))return;const F=(l=[])=>l.map(w=>{var C;return{...w,amountUSD:i((C=w==null?void 0:w.token)==null?void 0:C.coin_type,w==null?void 0:w.display_amount_owed)}}).filter(w=>g(w.display_amount_owed).gt(0)),W=z.map(l=>{var Ce,ke,Le,Be,Re;const w=l.posId,C=l.clmmPool,B=r[C],N=b[C],U=(Ce=N==null?void 0:N.ranges)==null?void 0:Ce.reduce((G,Y)=>(G[Y.dateType]=Y,G),{}),oe=c(B,d[w],"day",U==null?void 0:U.day),q=t[w],he=i((ke=l.displayTokenA)==null?void 0:ke.coin_type,q==null?void 0:q.displayCoinAmountA),be=i((Le=l.displayTokenB)==null?void 0:Le.coin_type,q==null?void 0:q.displayCoinAmountB),te=g(he).plus(be),D=f[w],xe=i((Be=l.displayTokenA)==null?void 0:Be.coin_type,D==null?void 0:D.displayFeeOwedA),pe=i((Re=l.displayTokenB)==null?void 0:Re.coin_type,D==null?void 0:D.displayFeeOwedB),de=g(xe).plus(pe),re=F(o[w]),J=F(j[l.id]),ye=[...re,...J].reduce((G,Y)=>G.plus(Y.amountUSD),g(0)),qe=re.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0)),Ge=J.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0));return{...l,apr:oe,totalLiquidity:te.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:qe.toString(),totalFarmingAmount:Ge.toString()}}),H={apr:(l,w)=>{var N,U;const C=g(((N=l.apr)==null?void 0:N.aprPercentageTotal)??0),B=g(((U=w.apr)==null?void 0:U.aprPercentageTotal)??0);return k==="asc"?C.minus(B).toNumber():B.minus(C).toNumber()},liquidity:(l,w)=>{const C=g(l.totalLiquidity),B=g(w.totalLiquidity);return k==="asc"?C.minus(B).toNumber():B.minus(C).toNumber()},fees:(l,w)=>{const C=g(l.totalFee),B=g(w.totalFee);return k==="asc"?C.minus(B).toNumber():B.minus(C).toNumber()},rewards:(l,w)=>{const C=g(l.totalRewards),B=g(w.totalRewards);return k==="asc"?C.minus(B).toNumber():B.minus(C).toNumber()}};return H[O]&&W.sort(H[O]),W},toCloseAllAction:async O=>{n(!0);try{const k=O.map(l=>{var D,xe,pe,de,re;const w=t[l==null?void 0:l.posId],C=o[l==null?void 0:l.posId],B=r[l.clmmPool],N=!C||(C==null?void 0:C.length)==0?(D=(B==null?void 0:B.miningRewardList)||[])==null?void 0:D.reduce((J,ye)=>(J.push(ye.coinType),J),[]):(C||[]).map(J=>J.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",l,r,B,C,N);const U=ie(w==null?void 0:w.displayCoinAmountA,void 0,!0),oe=ie(w==null?void 0:w.displayCoinAmountB,void 0,!0),q=l.isReverse,[he,be]=q?[g(oe).mul(ue.pow(10,(xe=l.displayTokenB)==null?void 0:xe.decimals)).toString(),g(U).mul(ue.pow(10,(pe=l.displayTokenA)==null?void 0:pe.decimals)).toString()]:[g(U).mul(ue.pow(10,(de=l.displayTokenA)==null?void 0:de.decimals)).toString(),g(oe).mul(ue.pow(10,(re=l.displayTokenB)==null?void 0:re.decimals)).toString()],te={posId:l.posType==="farms"?l.id:l.posId,poolAddress:l.clmmPool,coinTypeA:l.coinTypeA,coinTypeB:l.coinTypeB,amountA:he,amountB:be,liquidity:l.liquidity,lowerTick:l.lowerTick,upperTick:l.upperTick,posType:l.posType,rewarderCoinTypes:N};return l.posType==="farms"&&(te.farmsPoolId=l.farmsPool,te.farmsPosId=l.id),te});console.log("ðŸš€ ~ toRemove ~ paramsList:",k);const z={getShowInfo:l=>{const w=l==="success";return{modalDescriptionText:w?"":"Close all positions",toastTitleText:w?"Close all positions successful":"Close all positions",toastDescriptionContent:w?"":void 0}}};u(z);const{tx:F,msafeParams:W}=await p(k),H=await P(F,z,{useMev:_,useFastMode:m==="Fast Mode",maxCapForGas:S,customGasPrice:T,msafeParams:W});console.log("ðŸš€ ~ toClaim ~ res:",H),H&&(a(),v([]),ee())}catch(k){console.error("ðŸš€ ~ toClaim ~ error:",k)}finally{n(!1)}},isRemoveLoading:s}}const vs=({positionInfo:s,onFeesChange:n})=>{var _,m;const[c,i]=h.useState(!1),{getTokenAmountValue:d}=Pe(),{posFeeData:t,posFeeDataLoading:f}=le(),j=t[s==null?void 0:s.posId],o=d((_=s==null?void 0:s.displayTokenA)==null?void 0:_.coin_type,j==null?void 0:j.displayFeeOwedA,"--"),r=d((m=s==null?void 0:s.displayTokenB)==null?void 0:m.coin_type,j==null?void 0:j.displayFeeOwedB,"--"),b=h.useMemo(()=>o!=="--"&&r!=="--"?Z(g(o).plus(r).toString(),2):"$--",[o,r]),{isApp:v}=K();return h.useEffect(()=>{n==null||n(b)},[b]),e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:S=>ce(S),onMouseEnter:Number(o)==0&&Number(r)==0?()=>{}:()=>i(!0),onMouseLeave:()=>i(!1),children:e.jsxs(fe,{isLazy:!0,trigger:v?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:Number(o)==0&&Number(r)==0?"default":"help",children:e.jsx($,{isLoaded:!!b,children:e.jsx(y,{color:"text_caption",borderColor:"text_caption",children:b})})})}),c&&b!=="--"&&e.jsx(Fe,{children:e.jsx(Ae,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(_e,{p:"8px",children:e.jsxs(M,{align:"flex-start",minW:"200px",children:[e.jsxs(A,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(j==null?void 0:j.displayFeeOwedA)}),e.jsx(y,{fontSize:"12px",children:Z(o,2)})]})]}),e.jsxs(A,{w:"100%",justify:"space-between",children:[e.jsx(me,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(j==null?void 0:j.displayFeeOwedB)}),e.jsx(y,{fontSize:"12px",children:Z(r,2)})]})]})]})})})})]})})})},As=({positionInfo:s,onRewardsChange:n})=>{var P,u;const{getTokenAmountValue:c}=Pe(),{coinPriceObj:i}=We(),{posRewardsData:d,posRewardsDataLoading:t,posApiPoolData:f,farmsPosRewardsData:j,farmsPosRewardsDataLoading:o}=le(),r=(P=f[s==null?void 0:s.clmmPool])==null?void 0:P.haveMining,b=(u=f[s==null?void 0:s.clmmPool])==null?void 0:u.haveFarming,v=d[s==null?void 0:s.posId],_=j[s==null?void 0:s.id],m=h.useMemo(()=>{const a=v==null?void 0:v.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=c((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,v,i]),S=h.useMemo(()=>{const a=_==null?void 0:_.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=c((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,_,i]),T=h.useMemo(()=>{let a;const x=m.concat(S);return console.log("ðŸš€ ~ totalUSD ~ arr:",x,m,S),(x==null?void 0:x.length)>0?(x.forEach(L=>{const R=L==null?void 0:L.amountUSD;a=R=="--"||a=="--"?"--":g(a).plus(R).toString()}),a=="--"?"$--":Z(a,2)):"$0"},[m,S]),{isApp:p}=K();return h.useEffect(()=>{n==null||n(T)},[T]),e.jsx(e.Fragment,{children:e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:a=>ce(a),children:e.jsxs(fe,{isLazy:!0,trigger:p?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:T=="$0"?"text":"help",children:e.jsx($,{h:"14px",isLoaded:!!T&&!t&&!o,children:e.jsx(y,{color:"text_caption",children:T})})})}),T!=="$0"&&e.jsx(Fe,{children:e.jsx(Ae,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(_e,{borderRadius:"12px",p:"8px",children:e.jsxs(M,{align:"flex-start",children:[r&&e.jsx(y,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),m==null?void 0:m.map(a=>{var x;return e.jsxs(A,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(y,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)}),b&&e.jsx(y,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),S==null?void 0:S.map(a=>{var x;return e.jsxs(A,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(y,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(y,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)})]})})})})]})})})})},_s="/images/icon_active_new@2x.png";function Me({isActive:s,isLoading:n,imgStyle:c={},...i}){const{imgW:d="16px",imgH:t="12px"}=c;return e.jsx(ne,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...i,children:e.jsx(Te,{placement:"top",tooltip:e.jsx(y,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(ae,{onClick:f=>ce(f),children:e.jsxs(A,{align:"center",children:[s&&e.jsx(I,{w:d,h:t,src:_s}),e.jsx($,{w:"100%",isLoaded:!n,children:e.jsx(y,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Ts({positionInfo:s,tokenName:n,priceDirect:c,isShowIcon:i}){const{posPoolsRelatedData:d}=le(),t=d[s==null?void 0:s.posId],f=(t==null?void 0:t.currentStatus)=="Active",{isApp:j}=K(),o=h.useMemo(()=>t==null?void 0:t.minPriceOrigin,[t]),r=h.useMemo(()=>t==null?void 0:t.maxPriceOrigin,[t]),b=h.useMemo(()=>t==null?void 0:t.currentPriceOrigin,[t]),[v,_]=h.useState(0),m=h.useRef(null);h.useEffect(()=>{const p=()=>{m.current&&_(m.current.offsetWidth)},P=new ResizeObserver(p);return m.current&&P.observe(m.current),()=>{m.current&&P.unobserve(m.current)}},[o,r,b]);const S=h.useMemo(()=>{if(r==="âˆž")return"0px";if(b&&o&&r&&v){if(g(b).lessThanOrEqualTo(r)&&g(b).greaterThanOrEqualTo(o)){const p=g(b).sub(o).div(g(r).sub(g(o))).toString();return`${g(v).mul(p).toFixed(0)}px`}if(g(b).lt(o))return"6px";if(g(b).gt(r))return"calc(100% + 6px)"}return"0px"},[b,o,r,v]),{getExplorerUrl:T}=Ee();return e.jsxs(M,{align:{base:"flex-end",lg:"flex-start"},gap:{base:"4px",lg:"8px"},w:"100%",maxW:"100%",children:[e.jsxs(A,{justify:{base:"flex-end",lg:"flex-start"},maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:{base:"0",lg:"16px"},children:[e.jsx($,{isLoaded:!!(t!=null&&t.minPrice)&&!!(t!=null&&t.maxPrice),borderRadius:"4px",children:c?e.jsx(y,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPrice} - ${t==null?void 0:t.maxPrice}`}):e.jsx(y,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPriceResever} - ${t==null?void 0:t.maxPriceResever}`})}),!j&&e.jsx(Me,{isActive:f,isLoading:(t==null?void 0:t.currentStatus)==""}),i&&!j&&e.jsx(A,{onClick:p=>ce(p),children:e.jsx(Te,{placement:"top",tooltip:e.jsxs(A,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(A,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx($,{isLoaded:!!n,children:e.jsx(y,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:n==null?void 0:n.split("|")[1]})})]}),e.jsxs(A,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(T(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(ae,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ne,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsxs(A,{children:[j&&e.jsx(Me,{isActive:f,isLoading:(t==null?void 0:t.currentStatus)==""}),e.jsx($,{h:"6px",isLoaded:!!(t!=null&&t.currentPriceOrigin),borderRadius:"4px",children:e.jsx(E,{w:"88px",h:"6px",bgImage:r==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(E,{w:r==="âˆž"?"88px":"56px",h:r==="âˆž"?"2px":"6px",position:"relative",ref:m,background:r==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":f?"url('/images/img_range@2x.png')":"none",ml:r==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:r!=="âˆž"&&e.jsx(E,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:S,transform:"translateY(-50%)",zIndex:"5"})})})})]})]})}function Ps({positionInfo:s,positionItemWidth:n=[],priceDirect:c,showMiningIcon:i,showFarmingIcon:d}){const{isApp:t}=K(),{getExplorerUrl:f}=Ee(),{getClmmPosName:j}=us(),o=Se(),{setCurrentPosDetailTab:r}=ys(),{posPoolsOriginalData:b,posPoolsRelatedData:v,posApiPoolData:_,poolRangeObj:m}=le(),S=v[s==null?void 0:s.posId],T=_[s==null?void 0:s.clmmPool],p=h.useMemo(()=>{var k;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const z=(k=b==null?void 0:b[s==null?void 0:s.clmmPool])==null?void 0:k.index;return j(Number(s==null?void 0:s.index),z)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,b]),P=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),o(`/position-detail/${s==null?void 0:s.id}`)},[u,a]=h.useState(!1),{getPositionApr:x}=$e(),L=h.useMemo(()=>{if(V(S)&&V(T)&&V(m)){const k=m[s==null?void 0:s.clmmPool];if(k){const z=k==null?void 0:k.ranges.reduce((F,W)=>(F[W.dateType]=W,F),{});return x(T,S,"day",z.day)}}},[S,T,s,m]);bs();const[R,ee]=h.useState(null),[se,X]=h.useState(null),O=(S==null?void 0:S.currentStatus)=="Active";return e.jsx(Oe,{onMouseEnter:()=>{setTimeout(()=>{a(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{a(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:P,children:e.jsx(A,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(M,{w:"100%",align:"flex-start",gap:"12px",children:[t&&e.jsxs(A,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(A,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx($,{isLoaded:!!p,children:e.jsx(y,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:p==null?void 0:p.split("|")[1]})})]}),e.jsxs(A,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(y,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(f(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(A,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[e.jsxs(A,{w:{base:"100%",lg:n[0]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",whiteSpace:"nowrap",children:"Price Range"}),e.jsx(Ts,{positionInfo:s,tokenName:p,priceDirect:c,isShowIcon:u})]}),e.jsxs(A,{w:{base:"100%",lg:n[1]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"APR"}),e.jsx($,{isLoaded:!!L,children:e.jsx(y,{textAlign:"right",color:"primary",children:O?L==null?void 0:L.displayAprPercentageTotal:"0%"})})]}),e.jsxs(A,{m:"-12px 0",w:{base:"100%",lg:n[2]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Liquidity"}),e.jsx(js,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(A,{m:"-12px 0",w:{base:"100%",lg:n[3]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Pending Fees"}),e.jsx(vs,{positionInfo:s,onFeesChange:ee})]}),(i||d)&&e.jsxs(A,{m:"-12px 0",w:{base:"100%",lg:n[4]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(y,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(A,{gap:"4px",children:[t&&i&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),t&&d&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(As,{positionInfo:s,onRewardsChange:X})]})]})]}),t&&e.jsxs(Ze,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(y,{color:"primary_gray",children:"Manage"}),e.jsx(Ne,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const je=["480px","20%","20%","20%","20%"],He=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Cs=He.reduce((s,n)=>(s[n.value]=n,s),{});function Qs({poolInfo:s,priceDirect:n}){const{coinPriceObj:c}=We(),{getPositionSortList:i}=fs(),[d,t]=h.useState("desc"),[f,j]=h.useState({label:"",value:""}),o=p=>{(p==null?void 0:p.value)===f.value?t(P=>P==="desc"?"asc":"desc"):(t("desc"),j(p))},[r,b]=h.useState([]),v=h.useMemo(()=>{if(!V(s))return[];const p=i(f.value,d,s.list),P=f.value?p:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",P,p),b(p),P},[f.value,d,s==null?void 0:s.list,c]),_=p=>r.some(P=>g(P[p]).gt(0)),m=h.useMemo(()=>_("totalMiningAmount"),[r]),S=h.useMemo(()=>_("totalFarmingAmount"),[r]),{isApp:T}=K();return e.jsxs(M,{gap:"12px",w:"100%",children:[!T&&e.jsxs(A,{w:"100%",p:"0 16px",children:[e.jsx(y,{w:je[0],children:"Price Range"}),He.map((p,P)=>p.value!=="rewards"||m||S?e.jsxs(A,{gap:"4px",w:je[P+1],justify:"flex-end",children:[m&&p.value==="rewards"&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),S&&p.value==="rewards"&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(hs,{labelInfo:Cs[p.value],sortRule:d,sortBy:f,clickSort:o,tooltip:{content:p.value==="apr"?"APR based on the past 24h historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. Calculations are an estimate and only for reference.":""}})]},p.value):null)]}),e.jsx(M,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:v.map(p=>e.jsx(Ps,{positionInfo:p,positionItemWidth:je,priceDirect:n,showMiningIcon:m,showFarmingIcon:S},p==null?void 0:p.id))})]})}export{Vs as F,Qs as P,Js as V,fs as a,Ys as u};
//# sourceMappingURL=PositionItem-BxrlhNMT.js.map
