import{j as e,H as j,a0 as Wt,T as b,Y as D,Z as Te,bp as rt,e as at,r as p,b as ne,W as U,V as P,I as X,c as ke,X as Oe,U as ot,a1 as ee,R as be,bq as ge,br as se,bs as lt,aO as J,d as z,ad as Pe,ae as Me,af as He,ag as Ee,ah as ct,ai as Ae,aj as Re,k as dt,al as pt,$ as q,S as Z,g as Bt,C as pe,a2 as Ke,B as xt,a$ as fe,a9 as he,a4 as Fe,a as ut,bd as $t,a8 as Ze,ak as Xe,as as qe,l as Vt,aa as Yt,u as Ut,ao as Gt}from"./index-BK3qBWSh.js";import{P as _e}from"./Pagination-CwizWIDd.js";import{N as I}from"./NoData-BhGkTf8z.js";import{u as Qt}from"./RangeValue-CZnCh2wF.js";import{u as we}from"./useAccountBalance-NcYomdwl.js";import{u as de}from"./useTransaction-DpwrswED.js";import{u as ze}from"./useToken-DpJnfVqM.js";import{C as Ne}from"./CetusTooltip-BsW2316G.js";import{S as Jt}from"./SingleTokenInfo-xY1nD1m1.js";import{b as mt}from"./FarmsTable-BFzNS9K7.js";import{a as G,b as N,c as gt,d as ht,e as K,T as jt}from"./tr-But4ZoZC.js";import{A as Kt}from"./aggregator-Bkrz9W-B.js";import{A as Ie}from"./useSwapHelper-Df7nVJNZ.js";import{u as et}from"./useTokenBalance-CVi8JO-l.js";import{u as Zt}from"./useInsufficientBalanceToast-C-hqlzj_.js";import{u as Xt}from"./useFindBestRouting-DId-iVSt.js";import{T as qt}from"./TradeInputGroup-D4pAsmIv.js";import{W as It}from"./WarningTokenTipModal-BG_knBy7.js";import{M as es,C as ts}from"./MenuDropBlock-C_Z9QXUp.js";import{T as ss,a as is,L as ns}from"./LimitPriceChart-CXBB9DQH.js";import"./Swap-BhznQFDB.js";import{T as rs}from"./TradeConfirmAmountInfo-V7aHEj7d.js";import{I as je}from"./InputBox-CM4JGRSy.js";import{L as as}from"./api-data-utils-DdJFeMQ-.js";import{u as os}from"./global-53UTVccp.js";import{R as tt}from"./RefreshButton-mdGmVCU4.js";import{u as ls}from"./useRpcListener-C0dspcGl.js";import"./AddressCopyLink-BGAzWPCI.js";import"./AddressUnderline-nUIj4Nzz.js";import"./usePositionList-BroHlzpa.js";import"./useGetPoolList-Dh5p8iGx.js";import"./index-DxZphBvI.js";import"./ExpendItem-BGps0hHA.js";import"./msafe-oYBkW7LJ.js";import"./PriceRange-lbUMpjhm.js";import"./PositionStatus-7fshRL0W.js";import"./CoinPairInfo-CRQtWggE.js";import"./_getAllKeysIn-BLU9PuTy.js";import"./IconBg-CEM4uVwz.js";import"./SwapConfirmBlock-CyUJ2stw.js";import"./index-Dxkzt3vd.js";import"./usePriceImpact-BRV0QwOj.js";import"./CurrentPrice-B2BgMjpW.js";import"./HighlightText-BoWB2kGH.js";import"./HTextLabelBox-2DdWq0e6.js";import"./swap-CTnqj-aF.js";import"./Slippage-DIdyvG62.js";import"./TooltipIcon-CdD8MgA7.js";import"./switch-BJZWD4Rs.js";import"./index-C_m-PA7q.js";import"./debounce-DfT4vXEV.js";import"./throttle-pj_lqYNG.js";import"./usePreviousValue-C_PycxJ_.js";const xe=({info:t,imgSize:n="32px"})=>{const{pay_coin:r,target_coin:u,total_pay_amount:x,expect_obtain_amount:l}=t;return e.jsxs(j,{children:[e.jsx(Wt,{w:n,h:n,coinAIconUrl:r.logo_url,coinBIconUrl:u.logo_url}),e.jsxs(b,{color:"text_caption",children:[D(x)," ",r.symbol," â†’ ",D(l)," ",u.symbol]})]})},ue=({info:t})=>e.jsx(j,{justifyContent:"end",gap:"2px",children:e.jsxs(b,{color:"text_caption",children:[Te(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),me=({info:t})=>{const{pay_coin:n,total_pay_amount:r,deal_amount:u,deal_rate:x}=t;return e.jsxs(j,{justifyContent:"end",gap:"2px",children:[e.jsxs(b,{color:"text_caption",children:[D(u),"/",D(r)," ",n.symbol]}),e.jsxs(b,{color:"primary_gray",children:["(",rt(Number(x)*100),")"]})]})},bt=({historyInfo:t,type:n,...r})=>{const{getExplorerUrl:u}=at(),{pay_coin:x,target_coin:l}=t,g=p.useMemo(()=>(t==null?void 0:t.events)||[],[t]),h=c=>{const o=c==null?void 0:c.event_type;return o.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${D(Oe(c==null?void 0:c.amount,x==null?void 0:x.decimals))}`}:o.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:l,num:`+${D(Oe(c==null?void 0:c.amount,l==null?void 0:l.decimals))}`}:o.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${D(Oe(c==null?void 0:c.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=ne();return e.jsx(U,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...r,children:e.jsx(P,{align:"flex-start",children:g.map(c=>{const{tokenInfo:o,text:s,icon:i,color:d,num:f}=h(c);return e.jsxs(P,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(j,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(j,{gap:n=="card"?"4px":"8px",flexDirection:n=="card"?"column":"row",align:n=="card"?"flex-start":"center",children:[e.jsxs(j,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(X,{svgW:"14px",xlinkHref:i,svgFill:d,svgHover:d}),e.jsx(b,{color:d,children:s})]}),!a&&e.jsxs(b,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[f,"Â ",o==null?void 0:o.symbol]})]}),e.jsxs(j,{gap:n=="card"?"4px":"20px",flexDirection:n=="card"&&!a?"column":"row",align:n=="card"?"flex-end":"center",children:[e.jsxs(b,{h:"20px",lineHeight:"20px",children:[Te(Number(c.block_time),"")," (UTC)"]}),e.jsxs(j,{gap:"4px",cursor:"pointer",onClick:_=>{ke(_),window.open(u(c.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(b,{color:"text_caption",children:"View Transaction"}),e.jsx(X,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(b,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[f,"Â ",o==null?void 0:o.symbol]})]},c==null?void 0:c.tx)})})})},oe=({info:t})=>{const[n,r]=p.useState(!0),{getTokenRank:u}=Qt();p.useEffect(()=>{const a=u(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),r(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:l,price:g,reseverPrice:h}=t;return e.jsxs(j,{justifyContent:"end",children:[n?e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(b,{color:"text_caption",lineHeight:"1",children:D(g)}),e.jsxs(b,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[l.symbol," per ",x.symbol]})]}):e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(b,{color:"text_caption",children:D(h)}),e.jsxs(b,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",l.symbol]})]}),e.jsx(X,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{ke(a),r(!n)}})]})},ft=({historyInfo:t,openExpendItemObj:n})=>e.jsxs(j,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(X,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(X,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(b,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(X,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:n[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),cs=(t,n)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:r=>{t(()=>({orderListLoading:r}))},setMyOrderList:r=>{t(()=>({myOrderList:r}))}}),ye=ot(cs);function Se(){const{currentAccount:t,addressChangeVersion:n}=ee(),{peripherySdk:r}=be(),{setOrderListLoading:u,setMyOrderList:x,myOrderList:l,orderListLoading:g}=ye(),{fetchTokenInfo:h}=ze(),a=async(o=t==null?void 0:t.address,s)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",o);try{if(!o){u(!1),x([]);return}s&&u(!0);const i=await r.LimitOrder.getOwnerLimitOrderList(o,"all"),d=await c(i.data.filter(f=>f.status===ge.PartialCompleted||f.status===ge.Running));x(d),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",d)}catch(i){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",i)}finally{u(!1)}},c=async o=>{const s=[];for(const i of o){const[d,f]=await Promise.all([h(i.pay_coin_type),h(i.target_coin_type)]);if(d&&f){const{total_pay_amount:_,pay_balance:T,rate:C,obtained_amount:O,claimed_amount:H,target_balance:y,created_ts:S,expire_ts:w,status:M,id:A}=i,k=se(_,d.decimals).toString(),V=se(T,d.decimals).toString(),B=se(O,f.decimals).toString(),Y=se(H,f.decimals).toString(),v=se(y,f.decimals).toString(),$=lt.rateToPrice(C.toString(),d.decimals,f.decimals),E=J(1).div($).toString(),L=se(J(_).sub(T).toFixed(0),d.decimals).toString(),ie={order_id:A,pay_coin:d,target_coin:f,price:$,reseverPrice:E,total_pay_amount:k,expect_obtain_amount:J(k).mul($).toString(),remaining_amount:V,deal_amount:L,deal_rate:J(L).div(k).toString(),obtained_amount:B,claimed_amount:Y,un_claimed_amount:J(v).sub(Y).toString(),created_ts:S,expire_ts:w,status:M};s.push(ie)}}return s.sort((i,d)=>d.created_ts-i.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:g,myOrderList:l}}function _t(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:n}=Se(),{signAndExecuteTransaction:r}=de(),{peripherySdk:u}=be(),[x,l]=p.useState(!1),{transactionConfirmation:g}=de();return{handleCancelOrder:async a=>{l(!0);const c={getShowInfo:d=>{const f="Canceling order",_={modalDescriptionText:f,toastTitleText:f};return d==="success"&&(_.toastDescriptionContent="Order cancelled successfully",_.modalDescriptionText="Order cancelled successfully",_.toastTitleText="Order cancelled"),_}};g(c);const o=a.map(d=>({pay_coin_type:d.pay_coin.coin_type,target_coin_type:d.target_coin.coin_type,order_id:d.order_id})),s=await u.LimitOrder.cancelOrdersByOwner(o),i=await r(s,c);l(!1),i&&setTimeout(()=>{t(),n()},2e3)},cancelOrderLoading:x}}function ds(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:n}=Se(),{signAndExecuteTransaction:r}=de(),{peripherySdk:u}=be(),[x,l]=p.useState(!1),[g,h]=p.useState(!1);return{handleClaimOrder:async(o,s)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",o),l(!0);const i={pay_coin_type:o.pay_coin.coin_type,target_coin_type:o.target_coin.coin_type,order_id:o.order_id},d=await u.LimitOrder.claimTargetCoin(i),f=await r(d,{getShowInfo:(_,T)=>{var H;const C=`Claim ${D(s)} ${(H=o==null?void 0:o.target_coin)==null?void 0:H.symbol}`,O={modalDescriptionText:C,toastTitleText:C};return _==="success"&&(O.toastDescriptionContent="",O.modalDescriptionText="",O.toastTitleText="Claim successfully"),O}});l(!1),f&&setTimeout(()=>{t(),n()},2e3)},getLimitOrderClaimHistory:async o=>{h(!0);const s=await u.LimitOrder.getLimitOrderClaimLogs(o.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",o,s),s?(h(!1),s.map(i=>{var f;const d=z(i.parsedJson.claimed_amount).div(Math.pow(10,(f=o.target_coin)==null?void 0:f.decimals));return{...i,...i.parsedJson,claimed_amount:d}})):[]},isClaimHistoryLoading:g,claimLoading:x}}const ps=({orderInfo:t,isOpen:n,onClose:r,handleClaim:u,claimLoading:x,getLimitOrderClaimHistory:l,isClaimHistoryLoading:g})=>{const{getExplorerUrl:h}=at(),[a,c]=p.useState(""),[o,s]=p.useState([]),[i,d]=p.useState({label:"Claim",value:"claim"}),f=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],_=y=>{d(y),(y==null?void 0:y.value)=="history"&&T()},T=async()=>{const y=await l();y&&s(y)},C=p.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:z(a).gt(t.un_claimed_amount)||z(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[O,H]=p.useState(!0);return p.useEffect(()=>{O&&(H(!1),c(t.un_claimed_amount))},[O,t.un_claimed_amount]),e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:r,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{children:[e.jsx(Ee,{children:e.jsx(ct,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(Ae,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(P,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(xe,{info:t,imgSize:"28px"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsx(dt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:f,currentTab:i.label,handleChangeTab:_}),(i==null?void 0:i.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(P,{gap:"16px",align:"flex-start",children:[e.jsx(b,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(pt,{value:a?D(a).toString():"",onChange:y=>{c(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(j,{children:e.jsx(Jt,{portal:!1,token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(q,{onClick:()=>{u(a),r()},disabled:C.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:C.text})]}),(i==null?void 0:i.value)=="history"&&e.jsx(P,{w:"100%",gap:"12px",children:g?e.jsxs(U,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(j,{justify:"space-between",children:[e.jsx(Z,{height:"4",width:"150px"}),e.jsx(Z,{height:"4",width:"150px"})]}),e.jsxs(j,{justify:"space-between",mt:"16px",children:[e.jsx(Z,{height:"4",width:"150px"}),e.jsx(Z,{height:"4",width:"150px"})]})]},history==null?void 0:history.id):(o==null?void 0:o.length)==0?e.jsx(I,{type:"nodata",text:"No History.",p:"20px"}):o==null?void 0:o.map(y=>{var S,w;return e.jsx(U,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(P,{gap:"16px",align:"flex-start",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Amount"}),e.jsxs(j,{gap:"4px",children:[e.jsx(Bt,{imageUrl:(S=t==null?void 0:t.target_coin)==null?void 0:S.logo_url,w:"20px",h:"20px"}),e.jsxs(b,{color:"text_caption",lineHeight:"18px",children:[D(y==null?void 0:y.claimed_amount)," ",(w=t==null?void 0:t.target_coin)==null?void 0:w.symbol]})]})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Time"}),e.jsxs(j,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:M=>{ke(M),window.open(h(y.digest,"tx"))},children:[e.jsxs(b,{color:"text_caption",children:[Te(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(X,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},ve=({orderInfo:t})=>{const{handleCancelOrder:n,cancelOrderLoading:r}=_t(),{handleClaimOrder:u,claimLoading:x,getLimitOrderClaimHistory:l,isClaimHistoryLoading:g}=ds(),[h,a]=p.useState(),[c,o]=p.useState(!1),s=(i,d)=>{a(i),d==="cancel"&&n([i]),d==="claim"&&o(!0)};return ne(),e.jsxs(j,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[z(t==null?void 0:t.obtained_amount).lte(0)&&z(t.un_claimed_amount).lte(0)?e.jsx(Ne,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(pe,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(q,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(q,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||s(t,"claim")},children:"Claim"}),e.jsx(q,{isLoading:r,disabled:r,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{r||s(t,"cancel")},children:"Cancel"}),c&&e.jsx(ps,{orderInfo:t,claimLoading:x,isOpen:c,onClose:()=>o(!1),handleClaim:i=>u(t,i),getLimitOrderClaimHistory:()=>l(t),isClaimHistoryLoading:g})]})};function st(){const{currentAccount:t,onWalletModal:n}=ee(),{myOrderList:r,orderListLoading:u}=ye();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",r);const x=10,[l,g]=p.useState([]),[h,a]=p.useState(0),[c,o]=p.useState(1);return p.useEffect(()=>{if((r==null?void 0:r.length)>0){a(r==null?void 0:r.length);const s=(c-1)*x,i=s+x;g(r.slice(s,i))}},[c,r]),e.jsx(P,{w:"100%",children:t!=null&&t.address?u?e.jsx(U,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,i)=>e.jsx(wt,{},i))})}):r.length===0?e.jsx(I,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(U,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(l==null?void 0:l.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:l==null?void 0:l.map(s=>e.jsx(xs,{orderInfo:s},s==null?void 0:s.order_id))}),!u&&(r==null?void 0:r.length)>x&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:h,size:x,currentPage:c,onChange:o})})]}):e.jsx(I,{type:"nowallet",onboard:()=>n(!0),borderRadius:"16px"})})}const xs=({orderInfo:t})=>{const{isApp:n}=ne();return e.jsxs(P,{w:"100%",gap:"16px",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(xe,{info:t,imgSize:"28px"}),!n&&e.jsx(ve,{orderInfo:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(ue,{info:t})]}),n&&e.jsx(ve,{orderInfo:t})]})},wt=()=>e.jsxs(P,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(j,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(j,{gap:"0",children:[e.jsxs(j,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(Ke,{size:"8"}),e.jsx(Ke,{size:"8"})]}),e.jsx(Z,{height:"4",width:"100px"})]})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(Z,{height:"4",width:"180px"}),e.jsx(Z,{height:"4",width:"150px"})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(Z,{height:"4",width:"180px"}),e.jsx(Z,{height:"4",width:"150px"})]})]});function it(t){const{historyOrderList:n,historyOrderLoading:r}=t,{currentAccount:u,onWalletModal:x}=ee();console.log("ðŸš€ ~ OrderTableList ~ historyOrderList:",n);const l=10,[g,h]=p.useState([]),[a,c]=p.useState(0),[o,s]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){c(n==null?void 0:n.length);const i=(o-1)*l,d=i+l;h(n.slice(i,d))}},[o,n]),e.jsx(P,{w:"100%",children:u!=null&&u.address?r?e.jsx(U,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((i,d)=>e.jsx(wt,{},d))})}):n.length===0?e.jsx(I,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(U,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(g==null?void 0:g.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:g==null?void 0:g.map(i=>e.jsx(us,{historyInfo:i},i==null?void 0:i.order_id))}),!r&&(n==null?void 0:n.length)>l&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:a,size:l,currentPage:o,onChange:s})})]}):e.jsx(I,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const us=({historyInfo:t})=>{const[n,r]=p.useState({});return e.jsxs(P,{w:"100%",gap:"16px",children:[e.jsx(j,{w:"100%",justify:"space-between",children:e.jsx(xe,{info:t,imgSize:"28px"})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Limit Price"}),e.jsx(oe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Status"}),e.jsx(xt,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,r({...n})},children:e.jsx(ft,{historyInfo:t,openExpendItemObj:n})})]}),n[t==null?void 0:t.order_id]&&e.jsx(bt,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function ms({historyInfo:t}){const[n,r]=p.useState({});return e.jsxs(fe.Fragment,{children:[e.jsxs(G,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,r({...n})},sx:{td:{pb:n[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(N,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(N,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(ft,{historyInfo:t,openExpendItemObj:n})})]}),!n[t==null?void 0:t.order_id]&&e.jsx(G,{h:"16px"}),e.jsx(G,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:n[t==null?void 0:t.order_id]&&e.jsx(N,{colSpan:5,children:e.jsx(bt,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function gs(t){const{historyOrderList:n,historyOrderLoading:r}=t;console.log("ðŸš€ ~ HistoryTableList ~ historyOrderList:",n);const{currentAccount:u,onWalletModal:x}=ee(),l=10,[g,h]=p.useState([]),[a,c]=p.useState(0),[o,s]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){c(n==null?void 0:n.length);const i=(o-1)*l,d=i+l;h(n.slice(i,d))}},[o,n]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(ht,{children:e.jsxs(G,{children:[e.jsx(K,{children:"Order Info"}),e.jsx(K,{textAlign:"right",children:"Limit Price"}),e.jsx(K,{textAlign:"right",children:"Expiry"}),e.jsx(K,{textAlign:"right",children:"Filled Size"}),e.jsx(K,{textAlign:"right",children:"Status"})]})}),e.jsx(jt,{children:u!=null&&u.address?r?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(N,{colSpan:5,w:"100%",children:e.jsx(I,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(fe.Fragment,{children:[g.map(i=>e.jsx(ms,{historyInfo:i},i.order_id)),!r&&(n==null?void 0:n.length)>l&&e.jsx(N,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:a,size:l,currentPage:o,onChange:s})})})]}):e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(N,{colSpan:5,w:"100%",children:e.jsx(I,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const hs=(t,n)=>({quoteToken:void 0,payCoin:he.clmm_swap.from_coin,targetCoin:he.clmm_swap.to_coin,setPayCoin:r=>{t(()=>({payCoin:r}))},setTargetCoin:r=>{t(()=>({targetCoin:r}))},setQuoteToken:r=>{t(()=>({quoteToken:r}))},expiresIn:"7 Days",setExpiresIn:r=>{t(()=>({expiresIn:r}))},customExpiresVal:null,setCustomExpiresVal:r=>{t(()=>({customExpiresVal:r}))},refreshPriceLoading:!1,setRefreshPriceLoading:r=>{t(()=>({refreshPriceLoading:r}))}}),re=ot(hs);function js(t,n){const{getTokenPrice:r}=Fe(),u=r(t),x=r(n),l=p.useMemo(()=>{if(u&&x){const g=J(u.price).div(x.price).toString(),h=g.toString();return{price:g,displayPrice:h}}},[u,x]);return{price:l==null?void 0:l.price,displayPrice:l==null?void 0:l.displayPrice}}function yt(){const{payCoin:t,targetCoin:n,setRefreshPriceLoading:r}=re(),{fetchTokenPrices:u}=Fe();return{refreshCoinMarketPrice:()=>{const l=[];t&&l.push(t.coin_type),n&&l.push(n.coin_type),l.length>0&&(r(!0),u(l).finally(()=>{r(!1)}))}}}function bs(){const{refreshCoinMarketPrice:t}=yt(),{fetchAccountBalance:n}=we(),{fetchMyLimitOrder:r}=Se(),{signAndExecuteTransaction:u}=de(),{peripherySdk:x}=be(),{findBestRouters:l}=Xt(),{getTokenAmountValue:g}=Fe(),h=ut(),{pay:a,target:c}=$t(),{getTokenInfo:o}=ze(),{payCoin:s,targetCoin:i,quoteToken:d,expiresIn:f,setPayCoin:_,setTargetCoin:T,setQuoteToken:C,customExpiresVal:O,setExpiresIn:H,setRefreshPriceLoading:y}=re(),[S,w]=p.useState(""),[M,A]=p.useState(""),[k,V]=p.useState(!0),[B,Y]=p.useState(!0),[v,$]=p.useState(""),{displayPrice:E}=js((d==null?void 0:d.coin_type)===(s==null?void 0:s.coin_type)?i==null?void 0:i.coin_type:s==null?void 0:s.coin_type,d==null?void 0:d.coin_type),{balanceInfo:L}=et(s),{balanceInfo:ie}=et(i),De=g(s==null?void 0:s.coin_type,S),St=g(i==null?void 0:i.coin_type,M),[Ce,Ct]=p.useState(""),We=p.useRef(Ce);p.useEffect(()=>{We.current=Ce},[Ce]);const[le,Be]=p.useState(void 0),[Lt,$e]=p.useState(""),Ot=p.useRef(S),vt=p.useRef(M);p.useEffect(()=>{Ot.current=S},[S]),p.useEffect(()=>{vt.current=M},[M]),p.useEffect(()=>{_(o(a)||he.clmm_swap.from_coin),T(o(c)||he.clmm_swap.to_coin)},[a,c]),p.useEffect(()=>{if(Be(void 0),t(),Tt(),s&&i){const m=s.extensions&&s.extensions.rank||"0",R=i.extensions&&i.extensions.rank||"0";console.log("ðŸš€ ~ useEffect ~ payCoinRank:",s,i),z(m).gte(R)?C({...s}):C({...i})}},[s==null?void 0:s.coin_type,i==null?void 0:i.coin_type]);const Tt=async()=>{if(s&&i){const m=`${s.coin_type}_${i.coin_type}`;Ct(m);const R=Object.entries(Kt).map(([W,te])=>te.id),Q=await l({fromToken:s,toToken:i,amount:Ze(1,s.decimals).toFixed(0),providersKeys:R,by_amount_in:!0,uuid:m});m===We.current&&Be(Q)}};p.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",B,E),B?$(E||""):Ye()},[E]),p.useEffect(()=>{d&&!B&&+v&&$(D(z(1).div(v).toFixed(d.decimals)).toString())},[d]),p.useEffect(()=>{Ue(k?S:M,k),Ye()},[v]);const[kt,Pt]=p.useState({tooltip:"",color:"",text:"",bg:""}),[Mt,Ve]=p.useState(!1),Ye=()=>{var m,R;if(!B&&E&&v){Ve(!0);const Q=z(v).sub(E).div(E).mul(100).toFixed(2);$e(Q);const W=z(Q).gt(0),te=W?Q:Q.split("-")[1],F={tooltip:"",color:"",text:"",bg:""};F.tooltip=`Limit order price is ${te}% ${W?"higher":"lower"} than the market.`,((m=d==null?void 0:d.coin_type)==null?void 0:m.toLowerCase())==((R=i==null?void 0:i.coin_type)==null?void 0:R.toLowerCase())?Number(v)>Number(E)?(F.text="",F.color="#68FFD8"):Number(E)>Number(v)&&(F.text=`Your limit order price is ${te}% ${W?"higher":"lower"} than market. You are selling at a much ${W?"higher":"lower"} rate. We recommend you to use`,F.color="#ffb62d",F.bg="rgba(255,202,104,0.1)"):Number(v)>Number(E)?(F.text=`Your limit order price is ${te}% ${W?"higher":"lower"} than market. You are buying at a much ${W?"higher":"lower"} rate. We recommend you to use`,F.color="#ffb62d",F.bg="rgba(255,202,104,0.1)"):Number(E)>Number(v)&&(F.text="",F.color="#68FFD8"),Pt(F),Ve(!1);return}$e("")},Ht=(m=!0)=>{console.log("ðŸš€ ~ handleMarketPriceClick ~ marketPrice:",E),Y(m),m&&($(E||""),t())},Ue=(m,R)=>{if(V(R),R?w(m):A(m),d&&s&&i&&+v&&+m)if(R){d.coin_type===s.coin_type?A(z(m).div(v).toString().toString()):A(z(m).mul(v).toString().toString());return}else{d.coin_type===i.coin_type?w(z(m).div(v).toString().toString()):w(z(m).mul(v).toString().toString());return}R?A(""):w("")},Ge=(m,R)=>{Qe(),V(R),Y(!0),R?m.coin_type===(i==null?void 0:i.coin_type)?h(`/limit/${m==null?void 0:m.coin_type}/${s==null?void 0:s.coin_type}`):h(`/limit/${m==null?void 0:m.coin_type}/${i==null?void 0:i.coin_type}`):m.coin_type===(s==null?void 0:s.coin_type)?h(`/limit/${i==null?void 0:i.coin_type}/${m==null?void 0:m.coin_type}`):h(`/limit/${s==null?void 0:s.coin_type}/${m==null?void 0:m.coin_type}`)},Et=async()=>{i&&(Ge(i,!0),w(M),A(S))},Qe=()=>{w(""),A("")};p.useEffect(()=>()=>{H("7 Days")},[]);const[At,Le]=p.useState(!1),Rt=m=>{switch(m){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:Ft}=Zt(),{transactionConfirmation:zt}=de(),Nt=async()=>{const m={getShowInfo:(W,te)=>{const F="Creating order",ce={modalDescriptionText:F,toastTitleText:F};return W==="success"&&(ce.toastDescriptionContent="",ce.modalDescriptionText="Created order successfully",ce.toastTitleText="Created order successfully"),W==="rejected"&&(ce.toastTitleText="Create order"),ce}};zt(m);const R=Date.parse(new Date().toString())+(Rt(f)||O);console.log(" ~ handleSubmitOrder ~ expired_ts:",R),Le(!0);let Q;(d==null?void 0:d.coin_type)===(i==null?void 0:i.coin_type)?Q=v:Q=z(1).div(v).toFixed(i.decimals);try{const W={pay_coin_type:s.coin_type,target_coin_type:i.coin_type,expired_ts:R,target_decimal:i.decimals,pay_decimal:s.decimals,price:Number(Q),pay_coin_amount:Number(Ze(S,s.decimals).toFixed(0))},te=await x.LimitOrder.placeLimitOrder(W),F=await u(te,m);Le(!1),F&&(n(),r(),Qe())}catch(W){Ft(String(W)),Le(!1)}},{currentAccount:ae}=ee(),Je=p.useMemo(()=>{const m=g(s==null?void 0:s.coin_type,S);return Number(m)==0&&Number(S)>0?!1:Number(m)<5},[s,S]),Dt=p.useMemo(()=>{const m={text:"Place Limit Order",disabled:!1};return ae!=null&&ae.address?!s||!i?(m.disabled=!0,m.text=" Select a token",m):!Number(S)||!Number(M)?(m.disabled=!0,m.text="Enter an amount",m):Je?(m.disabled=!0,m.text="Order size should be higher than $5",m):Number(S)>Number(L==null?void 0:L.balanceFormat)||!(L!=null&&L.balanceFormat)?(m.disabled=!0,m.text=`Insufficient ${s==null?void 0:s.symbol} balance`,m):(le&&le.errorCode&&(le.errorCode===Ie.NoRouter||le.errorCode===Ie.HoneyPot)&&(m.text="No Available Route",m.disabled=!0),m):(m.disabled=!1,m.text="Connect Wallet",m)},[ae==null?void 0:ae.address,s,i,le,S,M,Je,L]);return{priceImpactInfoLoading:Mt,priceImpactInfo:kt,fixPayCoin:k,onReverseClick:Et,handleSelectToken:Ge,marketPrice:E,payCoin:s,targetCoin:i,handleAmountChange:Ue,payAmount:S,targetAmount:M,payBalanceInfo:L,targetBalanceInfo:ie,payAmountValue:De,targetAmountValue:St,useMarketPrice:B,handleMarketPriceClick:Ht,inputPrice:v,setInputPrice:$,priceImpact:Lt,quoteToken:d,setQuoteToken:C,handleSubmitOrder:Nt,submitOrderLoading:At,buttonTextStatus:Dt}}const fs=({confirmData:t,isOpen:n,onClose:r,handleSubmitOrder:u,submitOrderLoading:x})=>{var f,_,T,C;const{payAmount:l,targetAmount:g,payCoin:h,targetCoin:a,inputPrice:c,expiresIn:o,quoteToken:s}=t,i=((f=s==null?void 0:s.coin_type)==null?void 0:f.toLowerCase())==((_=a==null?void 0:a.coin_type)==null?void 0:_.toLowerCase())?c:z(1).div(c).toString(),d=((T=s==null?void 0:s.coin_type)==null?void 0:T.toLowerCase())==((C=a==null?void 0:a.coin_type)==null?void 0:C.toLowerCase())?z(1).div(c).toString():c;return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:r,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{children:[e.jsx(Ee,{children:e.jsx(ct,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(Ae,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(P,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(rs,{coinA:{amount:D(l,h==null?void 0:h.decimals).toString()||"0",...h},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:D(g,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(oe,{info:{pay_coin:h,target_coin:a,price:i,reseverPrice:d}})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expires in"}),e.jsx(b,{color:"text_caption",children:o})]}),e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(q,{onClick:()=>{u(),r()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},_s=({isOpen:t,onClose:n})=>{const{isApp:r}=ne(),{setCustomExpiresVal:u,setExpiresIn:x}=re(),[l,g]=p.useState(""),[h,a]=p.useState(""),c=T=>{const C=T.target.value.replace(/[^\d]/g,"");g(C)},o=T=>{const C=T.target.value.replace(/[^\d]/g,"");a(C)},[s,i]=p.useState({}),d=(T,C)=>{const O=Number(T||0)*60+Number(C||0),H=Math.floor(O/(60*24)),y=Math.floor(O%(60*24)/60),S=O%60;let w="";H>0&&(w+=H+"d "),y>0&&(w+=y+"h "),S>0&&(w+=S+"m "),i({timeText:w.trim()||"0 m",time:O*60*1e3})};p.useEffect(()=>{d(l,h)},[l,h]);const f=p.useMemo(()=>!l&&!h||Number(l)==0&&!h||Number(h)==0&&!l||Number(l)==0&&Number(h)==0,[l,h]),_=()=>{x(s==null?void 0:s.timeText),u(s==null?void 0:s.time),n()};return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:n,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{maxW:"1200px",w:r?"calc(100vw - 32px)":"440px",children:[e.jsx(Ee,{mr:"-10px",children:e.jsxs(j,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(b,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(j,{gap:"0",align:"center",children:e.jsx(Ae,{mt:"0",position:"static"})})]})}),e.jsx(Re,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(P,{w:"100%",children:[e.jsx(je,{children:e.jsxs(j,{children:[e.jsx(Xe,{value:l,onChange:c,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:"Hours"})]})}),e.jsx(je,{children:e.jsxs(j,{children:[e.jsx(Xe,{value:h,onChange:o,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:"Minutes"})]})}),e.jsx(q,{onClick:_,disabled:f,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function ws(t){const{expiresIn:n,setExpiresIn:r}=re(),[u,x]=p.useState(!1),l=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(je,{w:"156px",borderRadius:"16px",children:[e.jsxs(P,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(Ne,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(j,{gap:"4px",children:[e.jsx(b,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(X,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(es,{label:n,list:l,onListItemClick:g=>{g=="Custom"?x(!0):r(g)}})]}),u&&e.jsx(_s,{isOpen:u,onClose:()=>x(!1)})]})}function ys(t){ne();const{marketPrice:n,priceImpactInfo:r,priceImpactInfoLoading:u,priceImpact:x,inputPrice:l,handleMarketPriceClick:g,setInputPrice:h}=t,{payCoin:a,targetCoin:c,quoteToken:o,refreshPriceLoading:s,setQuoteToken:i}=re();return e.jsx(je,{w:"calc(100% - 156px)",children:e.jsxs(P,{w:"100%",gap:"20px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsxs(j,{children:[e.jsx(b,{fontSize:"13px",fontWeight:"500",children:(o==null?void 0:o.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${qe(c==null?void 0:c.symbol,10)} at rate`:`Sell ${qe(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!s&&(u?e.jsx(Vt,{size:"sm"}):e.jsx(Ne,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:r.tooltip}),children:e.jsxs(b,{color:r.color,children:[z(x).gt(0)?"+":"",Number(x)>1e4?">10000%":rt(x)]})}))]}),(n||s)&&e.jsx(q,{isLoading:s,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>g(!0),children:"Market"})]}),e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsx(pt,{value:l?Yt(l).toString():"",onChange:d=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",l,d),g(!1),h(d)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(j,{gap:"4px",children:[e.jsx(b,{textColor:"text_caption",children:o==null?void 0:o.symbol}),e.jsx(X,{xlinkHref:"#icon-icon_swap1",onClick:()=>{c&&a&&((o==null?void 0:o.coin_type)===(a==null?void 0:a.coin_type)?i(c):i(a))}})]})]})]})})}function Ss(){const{expiresIn:t}=re(),{buttonTextStatus:n,payBalanceInfo:r,targetBalanceInfo:u,payAmountValue:x,targetAmountValue:l,payAmount:g,targetAmount:h,payCoin:a,targetCoin:c,marketPrice:o,handleAmountChange:s,handleMarketPriceClick:i,handleSelectToken:d,inputPrice:f,setInputPrice:_,priceImpact:T,quoteToken:C,handleSubmitOrder:O,submitOrderLoading:H,onReverseClick:y,priceImpactInfoLoading:S,priceImpactInfo:w}=bs(),M=p.useMemo(()=>({payAmount:g,targetAmount:h,payCoin:a,targetCoin:c,inputPrice:f,expiresIn:t,quoteToken:C}),[g,h,a,c,f,t,C]),{onWalletModal:A}=ee(),[k,V]=p.useState("#icon-a-icon_trade"),B=L=>V(L?"#icon-icon_swap1":"#icon-a-icon_trade"),[Y,v]=p.useState(!1),$=ut(),E=p.useMemo(()=>{const L=[];return a&&L.push(a),c&&L.push(c),L},[a,c]);return e.jsxs(P,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(ss,{currTradeTab:is.Limit}),e.jsx(ts,{})]}),e.jsx(qt,{onClick:y,from:{title:"You Pay",balance:(r==null?void 0:r.balanceFormat)||"",value:g,amountValue:x,onChange:L=>{s(L,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:L=>{d(L,!0)}},to:{title:"You Receive",balance:(u==null?void 0:u.balanceFormat)||"",value:h,amountValue:l,onTokenChange:L=>{d(L,!1)},onChange:L=>{s(L,!1)},selectable:!0,placeholder:"0.0",token:c,half:!1,max:!1},iconParams:{xlinkHref:k,svgFill:"text_caption",transform:k==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:k==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1)}}),e.jsxs(j,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(ys,{marketPrice:o,priceImpactInfoLoading:S,priceImpactInfo:w,priceImpact:T,inputPrice:f,setInputPrice:_,handleMarketPriceClick:i}),e.jsx(ws,{})]}),(w==null?void 0:w.text)&&o&&Number(T)!==0&&f&&e.jsxs(b,{color:w==null?void 0:w.color,lineHeight:"20px",bg:w==null?void 0:w.bg,p:"12px",borderRadius:"8px",children:[w==null?void 0:w.text,"Â ",e.jsx(b,{color:w==null?void 0:w.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>$(`/swap/${a==null?void 0:a.coin_type}/${c==null?void 0:c.coin_type}`),children:"Cetus Swap"}),"Â instead."]}),e.jsx(q,{disabled:(n==null?void 0:n.disabled)||H,isLoading:H,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(n==null?void 0:n.text)=="Connect Wallet"?()=>A(!0):()=>v(!0),children:n==null?void 0:n.text}),Y&&e.jsx(fs,{confirmData:M,isOpen:Y,onClose:()=>v(!1),handleSubmitOrder:O,submitOrderLoading:H}),(a||c)&&e.jsx(It,{addToken:!0,tokensInfo:E,waringModalCancel:L=>{L.forEach(ie=>{(ie.coin_type===(a==null?void 0:a.coin_type)||ie.coin_type===(c==null?void 0:c.coin_type))&&d(void 0,ie.coin_type===(a==null?void 0:a.coin_type))})}})]})}function Cs({orderInfo:t}){return e.jsxs(fe.Fragment,{children:[e.jsxs(G,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(N,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(N,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(N,{textAlign:"right",children:e.jsx(ve,{orderInfo:t})})]}),e.jsx(G,{h:"16px"})]},t==null?void 0:t.order_id)}function Ls(){const{currentAccount:t,onWalletModal:n}=ee(),{myOrderList:r,orderListLoading:u}=ye();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",r);const x=10,[l,g]=p.useState([]),[h,a]=p.useState(0),[c,o]=p.useState(1);return p.useEffect(()=>{if((r==null?void 0:r.length)>0){a(r==null?void 0:r.length);const s=(c-1)*x,i=s+x;g(r.slice(s,i))}},[c,r]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(ht,{children:e.jsxs(G,{children:[e.jsx(K,{children:"Order Info"}),e.jsx(K,{textAlign:"right",children:"Price"}),e.jsx(K,{textAlign:"right",children:"Filled Size"}),e.jsx(K,{textAlign:"right",children:"Expiry"}),e.jsx(K,{textAlign:"right",children:"Action"})]})}),e.jsx(jt,{children:t!=null&&t.address?u?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):r.length===0?e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(N,{colSpan:5,w:"100%",children:e.jsx(I,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(fe.Fragment,{children:[l.map(s=>e.jsx(Cs,{orderInfo:s},s.order_id)),!u&&(r==null?void 0:r.length)>x&&e.jsx(N,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:h,size:x,currentPage:c,onChange:o})})})]}):e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(N,{colSpan:5,w:"100%",children:e.jsx(I,{type:"nowallet",onboard:()=>{n(!0)},borderRadius:"16px"})})})})]})}function Os(){const{fetchByApi:t}=Ut(),{fetchTokenInfo:n}=ze(),{currentAccount:r}=ee(),[u,x]=p.useState(!1),[l,g]=p.useState([]);p.useEffect(()=>{g([])},[r==null?void 0:r.address]);const h=async(c,o)=>{try{o&&x(!0);const s=await t(as,"GET",{wallet_address:c});if(s!=null&&s.list){const i=await a((s==null?void 0:s.list)||[]);return g(i),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",i),i}}catch(s){console.log("getLimitOrderHistory ~ error:",s)}finally{x(!1)}},a=async c=>{const o=[];for(const s of c){const[i,d]=await Promise.all([n(s.pay_coin),n(s.target_coin)]);if(i&&d){const{total_pay_amount:f,remaining_amount:_,rate:T,obtained_amount:C,claimed_amount:O,target_balance:H,created_ts:y,expire_ts:S,cancel_reason:w,events:M}=s,A=M;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",s,A),A.sort(($,E)=>E.block_time-$.block_time);const k=se(f,i.decimals).toString(),V=lt.rateToPrice(T.toString(),i.decimals,d.decimals),B=J(1).div(V).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",V,B);const Y=se(J(f).sub(_).toFixed(0),i.decimals).toString(),v={order_id:s.order_id,pay_coin:i,target_coin:d,price:V,reseverPrice:B,total_pay_amount:k,remaining_amount:_,deal_amount:Y,deal_rate:J(Y).div(k).toString(),expect_obtain_amount:J(k).mul(V).toString(),obtained_amount:C,claimed_amount:O,un_claimed_amount:"0",created_ts:y,expire_ts:S,status:Number(w)===0?ge.Completed:ge.Cancelled,events:A};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",v),o.push(v)}}return o.sort((s,i)=>i.created_ts=s.created_ts),o};return{getLimitOrderHistory:h,historyOrderLoading:u,historyOrderList:l}}function Oi(){const{currentAccount:t}=ee(),{getLimitOrderHistory:n,historyOrderList:r,historyOrderLoading:u}=Os(),{fetchMyLimitOrder:x}=Se(),{setMyOrderList:l,myOrderList:g,orderListLoading:h}=ye(),{payCoin:a,targetCoin:c}=re(),{fetchAccountBalance:o}=we();p.useEffect(()=>{t!=null&&t.address&&o()},[]);const{isShowTradeChart:s,isShowTradeOrders:i}=os(),[d,f]=p.useState([]),[_,T]=p.useState({label:"Open Orders"}),C=p.useMemo(()=>{console.log("ðŸš€ ~ Limit ~ myOrderList:",g);const k=[];return k.push({label:"Open Orders",num:_.label==="Open Orders"&&g.length>0&&!h?g.length.toString():void 0}),k.push({label:"Order History",num:_.label==="Order History"&&d.length>0&&!u?d.length.toString():void 0}),k},[_.label,g,d,u,h]);p.useEffect(()=>{O(!0)},[_.label,t,i]),ls({onRpcChange:()=>{O(!0),t!=null&&t.address&&o()}});const O=k=>{i&&(A(0),console.log("ðŸš€  ~ currentAccount:",_.label==="Open Orders",t==null?void 0:t.address),t!=null&&t.address&&(_.label==="Open Orders"?x(t.address,k):(console.log("ðŸš€ ~  ~ currentAccount:",t),n(t.address,k))))};p.useEffect(()=>{t!=null&&t.address&&(r==null?void 0:r.length)>0?f(r):(f([]),l([]))},[r,t==null?void 0:t.address]);const H=k=>{T(k)},{windowWidth:y,isApp:S}=ne(),{refreshCoinMarketPrice:w}=yt(),[M,A]=p.useState(0);return Gt({interval:1e3,callback:()=>{A(M+1),M>=20&&(A(0),w(),t!=null&&t.address&&o(),O(!1))}}),e.jsxs(P,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:S||s||i?"":"bg_img",children:[e.jsxs(j,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:s?"column":"column-reverse",lg:"row"},children:[(i||s)&&e.jsx(j,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:s?e.jsx(ns,{baseToken:a,quoteToken:c}):e.jsxs(P,{w:"100%",children:[e.jsx(nt,{tabList:C,currTab:_,myOrderList:g,handleChangeTab:H,handleGetOrderList:O}),_.label==="Open Orders"&&e.jsx(st,{}),_.label==="Order History"&&e.jsx(it,{historyOrderList:d,historyOrderLoading:u})]})}),e.jsx(Ss,{})]}),i&&s&&e.jsxs(P,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(nt,{handleGetOrderList:()=>O(!0),tabList:C,currTab:_,myOrderList:g,handleChangeTab:H}),S&&e.jsx(xt,{h:"16px"}),_.label==="Open Orders"&&(S?e.jsx(st,{}):e.jsx(Ls,{})),_.label==="Order History"&&(S?e.jsx(it,{historyOrderList:d,historyOrderLoading:u}):e.jsx(gs,{historyOrderList:d,historyOrderLoading:u}))]})]})}const nt=({tabList:t,currTab:n,myOrderList:r,handleChangeTab:u,handleGetOrderList:x})=>{const{handleCancelOrder:l,cancelOrderLoading:g}=_t(),{isApp:h}=ne(),a=n.label==="Open Orders"&&r.length>1;return e.jsxs(j,{w:"100%",justifyContent:"space-between",flexDirection:{base:n.label==="Open Orders"&&r.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(j,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(dt,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:n.label,handleChangeTab:u}),h&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),(!h||a)&&e.jsxs(j,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(q,{onClick:()=>{l(r)},disabled:g,isLoading:g,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!h&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]})};export{Oi as default};
