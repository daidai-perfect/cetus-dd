import{y as He,a as d,ak as Se,j as e,H as k,C as ae,I as de,T as S,f as E,P as Ae,h as ve,m as fe,n as Te,p as J,V as z,F as ne,W as qe,X as Ge,Y as Ye,a0 as Ve,$ as Je,k as Me}from"./vendor-BowHGuwE.js";import{a as ee,J as _e,K as ce,d as p,z as ie,a2 as Q,C as Qe,B as Fe,n as we,a9 as ze,$ as Z,aa as Ke,r as Pe,w as ue,R as I,f as ge,q as Oe,h as We,I as Xe}from"./index-CgoR1qPP.js";import{u as Ze,V as Ie,a as et,b as tt}from"./VaultsAprBlock-ChO6zwey.js";import{a as st,u as rt,V as nt}from"./VaultsAction-GlmxYK2F.js";import{u as Ee}from"./useAccountBalance-CUv7A_t2.js";import{u as it}from"./useInterval-BcJtT0it.js";import{P as at}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as ct}from"./VTextLabelBox-Cda-xajC.js";import{u as ot}from"./global-D9vZ-cnR.js";import{u as te,b as lt,a as xt}from"./usePositionList-DXcwwVzq.js";import{u as pt}from"./useTransaction-CQE1pk2O.js";import{h as ut}from"./RemoveBlock-CC-b7ty1.js";import{T as dt}from"./TableSortTh-mu6CBf4W.js";import{b as gt}from"./useClaimPosition-wxPNeK-Q.js";import{a as mt}from"./useNotifiSubscription-C7bqIToT.js";import{L as ht}from"./ExpendItem-iOjX-tKI.js";import{S as me,A as bt}from"./SingleTokenInfo-CSxZ8I4K.js";function Gt(){const{search:t}=He(),[i,a]=d.useState({});return d.useLayoutEffect(()=>{const c=new URLSearchParams(t);a(Object.fromEntries(c.entries()))},[t]),i}const Yt=({tooltip:t,...i})=>{const a=Se(),{isApp:c}=ee();return e.jsx(k,{w:"20px",h:"20px",onClick:g=>{ce(g),c||a("/farms")},...i,children:e.jsx(_e,{placement:"top",tooltip:t||e.jsx(S,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(ae,{children:e.jsx(de,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function yt(t){const{minPrice:i,maxPrice:a,currPrice:c}=t,[g,s]=d.useState(0),[A,w]=d.useState(0),n=d.useRef(null),r=d.useRef(null);d.useEffect(()=>{const y=()=>{n.current&&s(n.current.offsetWidth),r.current&&w(r.current.offsetWidth)},f=new ResizeObserver(y),T=new ResizeObserver(y);return n.current&&f.observe(n.current),r.current&&T.observe(r.current),()=>{n.current&&f.unobserve(n.current),r.current&&T.unobserve(r.current)}},[i,a,c]);const h=d.useMemo(()=>{if(a==="âˆž")return"0px";if(c&&i&&a&&g){if(p(c).lessThanOrEqualTo(a)&&p(c).greaterThanOrEqualTo(i)){const y=p(c).sub(i).div(p(a).sub(p(i))).toString();return`${p(g).mul(y).toFixed(0)}px`}if(p(c).lt(i))return"-36px";if(p(c).gt(a))return"calc(100% + 36px)"}return"0px"},[c,i,a,g]),v=d.useMemo(()=>{const y=h.replace("px","");return Number(y)-A/2+"px"},[h,A]),{isApp:j}=ee();return e.jsx(e.Fragment,{children:i!==void 0&&a!==void 0&&c!==void 0?e.jsx(k,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(E,{w:"100%",padding:i&&p(c).lt(i)?"0 40px 0 60px":a&&p(c).gt(a)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(S,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:i&&p(c).lt(i)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(i)}),e.jsx(E,{w:"100%",position:"relative",height:"14px",ref:n,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(Ae,{isLazy:!0,placement:"top",trigger:j?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(ve,{children:e.jsx(E,{as:"button",children:e.jsx(E,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:h,ml:"-2px",zIndex:"5"})})}),e.jsx(fe,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:v,zIndex:"5",children:e.jsx(Te,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(S,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:ie(c)})})})]})}),e.jsx(S,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:a&&p(c).gt(a)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(a)})]})},h):e.jsx(k,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx(J,{w:"100%",h:"20px"})})})}function jt(t){const{vaultId:i,displayTokenA:a,displayTokenB:c,feeDisplay:g,minPrice:s,maxPrice:A,currPrice:w}=t;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",t);const{vaultListObj:n}=Ze(),r=d.useMemo(()=>{if(Q(n)&&i)return n[i]},[n,i]);return e.jsxs(z,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ne,{children:[e.jsx(Qe,{coinAIconUrl:a==null?void 0:a.logo_url,coinBIconUrl:c==null?void 0:c.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ne,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(E,{children:e.jsxs(ne,{alignItems:"center",children:[e.jsx(S,{fontSize:"16px",color:"text_caption",children:`${a==null?void 0:a.symbol} - ${c==null?void 0:c.symbol}`}),e.jsx(Fe,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(S,{fontSize:"12px",color:"primary",children:g})})]})}),e.jsx(ne,{flexDirection:"column",children:e.jsx(ct,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(Ie,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(yt,{minPrice:s,maxPrice:A,currPrice:w})]})}function Vt(t){const{currentAccount:i}=we(),{isOpen:a,setIsOpen:c,vaultId:g,category:s,displayTokenA:A,displayTokenB:w,feeDisplay:n,clmmPool:r,isReverse:h}=t,{isOpenWalletModal:v}=we(),{getCurrentVaultDetail:j,getCurrentVaultContractInfo:y}=st(),{clearVaultsActionData:f}=rt(),{fetchAccountBalance:T}=Ee(),u=Se(),{vaultsPoolObj:_}=et(),l=d.useMemo(()=>_[g],[_,g]);d.useEffect(()=>{g&&j(g)},[i==null?void 0:i.address,g]);const{getPythLastPrice:D}=tt(),B=d.useRef(!1);d.useEffect(()=>(B.current=!0,()=>{B.current=!1,f()}),[]),d.useEffect(()=>{l!=null&&l.displayCoinTypeA&&(l!=null&&l.displayCoinTypeB)&&D([l==null?void 0:l.displayCoinTypeA,l==null?void 0:l.displayCoinTypeB])},[l==null?void 0:l.displayCoinTypeA,l==null?void 0:l.displayCoinTypeB]),it({interval:20*1e3,callback:()=>{B.current&&s=="haedal"&&D([l==null?void 0:l.displayCoinTypeA,l==null?void 0:l.displayCoinTypeB])}});const N=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),i!=null&&i.address?(T(),j(g,!0)):y(g)};return e.jsxs(qe,{isCentered:!0,isOpen:a&&!v,onClose:()=>{c(!1)},children:[e.jsx(Ge,{}),e.jsx(Ye,{width:{base:"100%",lg:"420px"},children:e.jsx(Ve,{p:"0 0 8px",children:e.jsxs(z,{width:"100%",children:[e.jsxs(z,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(k,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(S,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Je,{})]}),e.jsx(jt,{displayTokenA:A,displayTokenB:w,feeDisplay:n,clmmPool:r,isReverse:h,minPrice:l==null?void 0:l.minPrice,maxPrice:l==null?void 0:l.maxPrice,currPrice:l==null?void 0:l.currentPrice,category:s,vaultId:g}),e.jsx(nt,{vaultId:g,isModal:!0,autoRefresh:N})]}),e.jsxs(k,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:s=="haedal"?"space-between":"center",children:[e.jsx(at,{mt:"0",category:s}),e.jsx(S,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{s&&g&&(f(),u(`/vaults-detail/${g}/${s}`))},children:"Vault Details >"})]})]})})})]})}function Ne(){const t=(a,c,g,s)=>{const A=Math.max(a,g),n=Math.min(c,s)-A,r=c-a,h=s-g,v=Z(n.toString()),j=Z(r.toString()),y=Z(h.toString());return n<=0?Z(0):n===r?y.div(v):n===h?v.div(j):v.mul(v).div(y).div(j)};return{getPositionApr:(a,c,g,s)=>{if(!Q(a)||!Q(c)||!Q(s))return;const{minPrice:A,minPriceResever:w,maxPrice:n,maxPriceResever:r}=c,{tokenA:h,tokenB:v,miningAprList:j,feeApr:y,feeApr7d:f,feeApr30d:T,isReverse:u}=a;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ getPositionApr ~ isReverse:",u),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:28 ~ getPositionApr ~ feeApr30d:",f,T);const _=h==null?void 0:h.decimals,l=v==null?void 0:v.decimals,D=A=="0"&&n=="âˆž",B=u?w:A,N=D?2**50:u?r:n;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:31 ~ getPositionApr ~ lowerUserPrice:",B),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:33 ~ getPositionApr ~ upperUserPrice:",N);const{lower:o,upper:m}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ range:",s);const F=ze.tickIndexToPrice(o,_,l).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ beforeContractPriceLowest:",F);const M=ze.tickIndexToPrice(m,_,l).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:40 ~ getPositionApr ~ beforeContractPriceHighest:",M),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ lowerUserPrice, upperUserPrice, beforeContractPriceLowest, beforeContractPriceHighest:",B,N,F,M);const C=t(B,N,F,M);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:41 ~ getPositionApr ~ positionMulti:",C.toString());const R=Z(g=="day"?y:g=="month"?T:f).mul(C).toString(),O=[];let W=Z(R);return j==null||j.forEach(K=>{const q=Z(C).mul(K.apr).toString();O.push({...K,posMiningRewardApr:q}),W=W.add(q)}),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:45 ~ getPositionApr ~",{aprPercentageTotal:W.toString(),aprByFee:R,posMiningReward:O}),{aprPercentageTotal:W.toString(),displayAprPercentageTotal:Ke(W.toNumber()*100),aprByFee:R,posMiningReward:O}}}}function wt(){const[t,i]=d.useState(!1),{getPositionApr:a}=Ne(),{getTokenAmountValue:c}=Pe(),{posPoolsRelatedData:g,posLiquidityData:s,posFeeData:A,farmsPosRewardsData:w,posRewardsData:n,posApiPoolData:r,poolRangeObj:h,setPosBaseList:v}=te(),{mevProtect:j,transactionMode:y,maxCapForGas:f,customGasPrice:T}=ot(),{getCloseTsPayloadAll:u}=ut(),{signAndExecuteTransaction:_,transactionConfirmation:l}=pt(),{fetchAccountBalance:D}=Ee(),{getPositionBaseList:B,getPosRelatedData:N}=lt(),{currentAccount:o}=we(),m=async()=>{const C=await B(o==null?void 0:o.address);N(C)};return{getPositionSortList:(C,R,O)=>{if(!(O!=null&&O.length))return;const W=(x=[])=>x.map(b=>{var P;return{...b,amountUSD:c((P=b==null?void 0:b.token)==null?void 0:P.coin_type,b==null?void 0:b.display_amount_owed)}}).filter(b=>p(b.display_amount_owed).gt(0)),K=O.map(x=>{var ke,Ce,Le,Be,Re;const b=x.posId,P=x.clmmPool,L=r[P],U=h[P],$=(ke=U==null?void 0:U.ranges)==null?void 0:ke.reduce((Y,V)=>(Y[V.dateType]=V,Y),{}),oe=a(L,g[b],"week",$==null?void 0:$.week),G=s[b],he=c((Ce=x.displayTokenA)==null?void 0:Ce.coin_type,G==null?void 0:G.displayCoinAmountA),be=c((Le=x.displayTokenB)==null?void 0:Le.coin_type,G==null?void 0:G.displayCoinAmountB),se=p(he).plus(be),H=A[b],le=c((Be=x.displayTokenA)==null?void 0:Be.coin_type,H==null?void 0:H.displayFeeOwedA),xe=c((Re=x.displayTokenB)==null?void 0:Re.coin_type,H==null?void 0:H.displayFeeOwedB),pe=p(le).plus(xe),re=W(n[b]),X=W(w[x.id]),ye=[...re,...X].reduce((Y,V)=>Y.plus(V.amountUSD),p(0)),Ue=re.reduce((Y,V)=>Y.plus(V.display_amount_owed),p(0)),$e=X.reduce((Y,V)=>Y.plus(V.display_amount_owed),p(0));return{...x,apr:oe,totalLiquidity:se.toString(),totalFee:pe.toString(),totalRewards:ye.toString(),totalMiningAmount:Ue.toString(),totalFarmingAmount:$e.toString()}}),q={apr:(x,b)=>{var U,$;const P=p(((U=x.apr)==null?void 0:U.aprPercentageTotal)??0),L=p((($=b.apr)==null?void 0:$.aprPercentageTotal)??0);return R==="asc"?P.minus(L).toNumber():L.minus(P).toNumber()},liquidity:(x,b)=>{const P=p(x.totalLiquidity),L=p(b.totalLiquidity);return R==="asc"?P.minus(L).toNumber():L.minus(P).toNumber()},fees:(x,b)=>{const P=p(x.totalFee),L=p(b.totalFee);return R==="asc"?P.minus(L).toNumber():L.minus(P).toNumber()},rewards:(x,b)=>{const P=p(x.totalRewards),L=p(b.totalRewards);return R==="asc"?P.minus(L).toNumber():L.minus(P).toNumber()}};return q[C]&&K.sort(q[C]),K},toCloseAllAction:async C=>{i(!0);try{const R=C.map(x=>{var H,le,xe,pe,re;const b=s[x==null?void 0:x.posId],P=n[x==null?void 0:x.posId],L=r[x.clmmPool],U=!P||(P==null?void 0:P.length)==0?(H=(L==null?void 0:L.miningRewardList)||[])==null?void 0:H.reduce((X,ye)=>(X.push(ye.coinType),X),[]):(P||[]).map(X=>X.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",x,r,L,P,U);const $=ie(b==null?void 0:b.displayCoinAmountA,void 0,!0),oe=ie(b==null?void 0:b.displayCoinAmountB,void 0,!0),G=x.isReverse,[he,be]=G?[p(oe).mul(ue.pow(10,(le=x.displayTokenB)==null?void 0:le.decimals)).toString(),p($).mul(ue.pow(10,(xe=x.displayTokenA)==null?void 0:xe.decimals)).toString()]:[p($).mul(ue.pow(10,(pe=x.displayTokenA)==null?void 0:pe.decimals)).toString(),p(oe).mul(ue.pow(10,(re=x.displayTokenB)==null?void 0:re.decimals)).toString()],se={posId:x.posType==="farms"?x.id:x.posId,poolAddress:x.clmmPool,coinTypeA:x.coinTypeA,coinTypeB:x.coinTypeB,amountA:he,amountB:be,liquidity:x.liquidity,lowerTick:x.lowerTick,upperTick:x.upperTick,posType:x.posType,rewarderCoinTypes:U};return x.posType==="farms"&&(se.farmsPoolId=x.farmsPool,se.farmsPosId=x.id),se});console.log("ðŸš€ ~ toRemove ~ paramsList:",R);const O={getShowInfo:x=>{const b=x==="success";return{modalDescriptionText:b?"":"Close All",toastTitleText:b?"Close All Successful":"Close All",toastDescriptionContent:b?"":void 0}}};l(O);const{tx:W,msafeParams:K}=await u(R),q=await _(W,O,{useMev:j,useFastMode:y==="Fast Mode",maxCapForGas:f,customGasPrice:T,msafeParams:K});console.log("ðŸš€ ~ toClaim ~ res:",q),q&&(D(),v([]),m())}catch(R){console.error("ðŸš€ ~ toClaim ~ error:",R)}finally{i(!1)}},isRemoveLoading:t}}const St=({positionInfo:t,width:i,onFeesChange:a})=>{var y,f;const[c,g]=d.useState(!1),{getTokenAmountValue:s}=Pe(),{posFeeData:A,posFeeDataLoading:w}=te(),n=A[t==null?void 0:t.posId],r=s((y=t==null?void 0:t.displayTokenA)==null?void 0:y.coin_type,n==null?void 0:n.displayFeeOwedA,"--"),h=s((f=t==null?void 0:t.displayTokenB)==null?void 0:f.coin_type,n==null?void 0:n.displayFeeOwedB,"--"),v=d.useMemo(()=>r!=="--"&&h!=="--"?I(p(r).plus(h).toString(),2):"$--",[r,h]),{isApp:j}=ee();return d.useEffect(()=>{a==null||a(v)},[v]),e.jsx(z,{w:{base:"100%",lg:i||"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:T=>ce(T),onMouseEnter:Number(r)==0&&Number(h)==0?()=>{}:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsxs(Ae,{isLazy:!0,trigger:j?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:Number(r)==0&&Number(h)==0?"default":"help",children:e.jsx(J,{isLoaded:!!v,children:e.jsx(S,{color:"text_caption",borderColor:"text_caption",children:v})})})}),c&&v!=="--"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(Te,{p:"8px",children:e.jsxs(z,{align:"flex-start",minW:"200px",children:[e.jsxs(k,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:t==null?void 0:t.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(z,{align:"flex-end",gap:"4px",children:[e.jsx(S,{fontSize:"12px",color:"text_caption",children:ge(n==null?void 0:n.displayFeeOwedA)}),e.jsx(S,{fontSize:"12px",children:I(r,2)})]})]}),e.jsxs(k,{w:"100%",justify:"space-between",children:[e.jsx(me,{token:t==null?void 0:t.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(z,{align:"flex-end",gap:"4px",children:[e.jsx(S,{fontSize:"12px",color:"text_caption",children:ge(n==null?void 0:n.displayFeeOwedB)}),e.jsx(S,{fontSize:"12px",children:I(h,2)})]})]})]})})})})]})})})},At=({positionInfo:t,width:i,onRewardsChange:a,showMiningIcon:c,showFarmingIcon:g})=>{var B,N;const{getTokenAmountValue:s}=Pe(),{coinPriceObj:A}=Oe(),{posRewardsData:w,posRewardsDataLoading:n,posApiPoolData:r,farmsPosRewardsData:h,farmsPosRewardsDataLoading:v}=te(),j=(B=r[t==null?void 0:t.clmmPool])==null?void 0:B.haveMining,y=(N=r[t==null?void 0:t.clmmPool])==null?void 0:N.haveFarming,f=w[t==null?void 0:t.posId],T=h[t==null?void 0:t.id],u=d.useMemo(()=>{const o=f==null?void 0:f.map(m=>{var M;console.log("ðŸš€ ~ list ~ reward:",m);const F=s((M=m==null?void 0:m.token)==null?void 0:M.coin_type,m==null?void 0:m.display_amount_owed,"--");return{...m,amountUSD:F}});return o&&o.length>0?o.filter(m=>p(m.display_amount_owed).gt(0)):[]},[t,f,A]),_=d.useMemo(()=>{const o=T==null?void 0:T.map(m=>{var M;console.log("ðŸš€ ~ list ~ reward:",m);const F=s((M=m==null?void 0:m.token)==null?void 0:M.coin_type,m==null?void 0:m.display_amount_owed,"--");return{...m,amountUSD:F}});return o&&o.length>0?o.filter(m=>p(m.display_amount_owed).gt(0)):[]},[t,T,A]),l=d.useMemo(()=>{let o;const m=u.concat(_);return console.log("ðŸš€ ~ totalUSD ~ arr:",m,u,_),(m==null?void 0:m.length)>0?(m.forEach(F=>{const M=F==null?void 0:F.amountUSD;o=M=="--"||o=="--"?"--":p(o).plus(M).toString()}),o=="--"?"$--":I(o,2)):"$0"},[u,_]),{isApp:D}=ee();return d.useEffect(()=>{a==null||a(l)},[l]),e.jsx(e.Fragment,{children:(c||g)&&e.jsx(z,{w:{base:"100%",lg:i||"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:o=>ce(o),children:e.jsxs(Ae,{isLazy:!0,trigger:D?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:l=="$0"?"text":"help",children:e.jsx(J,{h:"14px",isLoaded:!!l&&!n&&!v,children:e.jsx(S,{color:"text_caption",children:l})})})}),l!=="$0"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(Te,{borderRadius:"12px",p:"8px",children:e.jsxs(z,{align:"flex-start",children:[j&&e.jsx(S,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),u==null?void 0:u.map(o=>{var m;return e.jsxs(k,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:o==null?void 0:o.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(z,{align:"flex-end",gap:"4px",children:[e.jsx(S,{fontSize:"12px",color:"text_caption",children:ge(o==null?void 0:o.display_amount_owed)}),e.jsxs(S,{fontSize:"12px",children:[" ",I(o==null?void 0:o.amountUSD,2)]})]})]},(m=o==null?void 0:o.token)==null?void 0:m.coin_type)}),y&&e.jsx(S,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),_==null?void 0:_.map(o=>{var m;return e.jsxs(k,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:o==null?void 0:o.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(z,{align:"flex-end",gap:"4px",children:[e.jsx(S,{fontSize:"12px",color:"text_caption",children:ge(o==null?void 0:o.display_amount_owed)}),e.jsxs(S,{fontSize:"12px",children:[" ",I(o==null?void 0:o.amountUSD,2)]})]})]},(m=o==null?void 0:o.token)==null?void 0:m.coin_type)})]})})})})]})})})})},vt="/images/icon_active_new@2x.png";function ft({isActive:t,isLoading:i,imgStyle:a={},...c}){const{imgW:g="16px",imgH:s="12px"}=a;return e.jsx(ne,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...c,children:e.jsx(_e,{placement:"top",tooltip:e.jsx(S,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:t?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(ae,{onClick:A=>ce(A),children:e.jsxs(k,{align:"center",children:[t&&e.jsx(de,{w:g,h:s,src:vt}),e.jsx(J,{w:"100%",isLoaded:!i,children:e.jsx(S,{fontSize:"12px",color:t?"primary":"primary_gray",fontWeight:"500",children:t?"Active":"Inactive"})})]})})})})}function Tt({positionInfo:t,width:i,tokenName:a,priceDirect:c}){const{posPoolsRelatedData:g}=te(),s=g[t==null?void 0:t.posId],A=(s==null?void 0:s.currentStatus)=="Active";ee();const w=d.useMemo(()=>s==null?void 0:s.minPriceOrigin,[s]),n=d.useMemo(()=>s==null?void 0:s.maxPriceOrigin,[s]),r=d.useMemo(()=>s==null?void 0:s.currentPriceOrigin,[s]),[h,v]=d.useState(0),j=d.useRef(null);d.useEffect(()=>{const T=()=>{j.current&&v(j.current.offsetWidth)},u=new ResizeObserver(T);return j.current&&u.observe(j.current),()=>{j.current&&u.unobserve(j.current)}},[w,n,r]);const y=d.useMemo(()=>{if(n==="âˆž")return"0px";if(r&&w&&n&&h){if(p(r).lessThanOrEqualTo(n)&&p(r).greaterThanOrEqualTo(w)){const T=p(r).sub(w).div(p(n).sub(p(w))).toString();return`${p(h).mul(T).toFixed(0)}px`}if(p(r).lt(w))return"6px";if(p(r).gt(n))return"calc(100% + 6px)"}return"0px"},[r,w,n,h]),{getExplorerUrl:f}=We();return e.jsxs(z,{align:"flex-start",w:{base:"100%",lg:i},maxW:{base:"100%",lg:i},children:[e.jsxs(k,{maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:"16px",children:[e.jsx(J,{isLoaded:!!(s!=null&&s.minPrice)&&!!(s!=null&&s.maxPrice),borderRadius:"4px",children:c?e.jsx(S,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${s==null?void 0:s.minPrice} - ${s==null?void 0:s.maxPrice}`}):e.jsx(S,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${s==null?void 0:s.minPriceResever} - ${s==null?void 0:s.maxPriceResever}`})}),e.jsx(ft,{isActive:A,isLoading:(s==null?void 0:s.currentStatus)==""}),e.jsx(k,{onClick:T=>ce(T),children:e.jsx(_e,{placement:"top",tooltip:e.jsxs(k,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(k,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(S,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx(J,{isLoaded:!!a,children:e.jsx(S,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:a==null?void 0:a.split("|")[1]})})]}),e.jsxs(k,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(S,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(bt,{fontWeight:"500",color:"text_caption",address:t==null?void 0:t.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(f(t==null?void 0:t.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(ae,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Xe,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsx(J,{h:"6px",isLoaded:!!(s!=null&&s.currentPriceOrigin),borderRadius:"4px",children:e.jsx(E,{w:"88px",h:"6px",bgImage:n==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(E,{w:n==="âˆž"?"88px":"56px",h:n==="âˆž"?"2px":"6px",position:"relative",ref:j,background:n==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":A?"url('/images/img_range@2x.png')":"none",ml:n==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:n!=="âˆž"&&e.jsx(E,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:y,transform:"translateY(-50%)",zIndex:"5"})})})})]})}function _t({positionInfo:t,positionItemWidth:i=[],priceDirect:a,showMiningIcon:c,showFarmingIcon:g}){const{isApp:s}=ee();We();const{getClmmPosName:A}=xt(),w=Se(),{setCurrentPosDetailTab:n}=mt(),{posPoolsOriginalData:r,posPoolsRelatedData:h,posApiPoolData:v,poolRangeObj:j}=te(),y=h[t==null?void 0:t.posId],f=v[t==null?void 0:t.clmmPool],T=d.useMemo(()=>{var C;if(t!=null&&t.tokenName)return t==null?void 0:t.tokenName;{const R=(C=r==null?void 0:r[t==null?void 0:t.clmmPool])==null?void 0:C.index;return A(Number(t==null?void 0:t.index),R)}},[t==null?void 0:t.tokenName,t==null?void 0:t.index,t==null?void 0:t.clmmPool,r]),u=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",t),w(`/position-detail/${t==null?void 0:t.id}`)},[_,l]=d.useState(!1),{getPositionApr:D}=Ne(),B=d.useMemo(()=>{if(Q(y)&&Q(f)&&Q(j)){const C=j[t==null?void 0:t.clmmPool];if(C){const R=C==null?void 0:C.ranges.reduce((O,W)=>(O[W.dateType]=W,O),{});return D(f,y,"week",R.week)}}},[y,f,t,j]);gt();const[N,o]=d.useState(null),[m,F]=d.useState(null),M=(y==null?void 0:y.currentStatus)=="Active";return e.jsx(Fe,{onMouseEnter:()=>{setTimeout(()=>{l(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{l(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:u,children:e.jsx(k,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsx(z,{w:"100%",align:"flex-start",children:e.jsxs(k,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"0",lg:"8px"},children:[s&&e.jsx(E,{h:"4px"}),e.jsx(Tt,{positionInfo:t,width:i[0],tokenName:T,priceDirect:a}),s&&e.jsx(E,{h:"4px"}),e.jsx(k,{w:i[1],justify:"flex-end",children:e.jsx(J,{isLoaded:!!B,children:e.jsx(S,{textAlign:"right",color:"primary",children:M?B==null?void 0:B.displayAprPercentageTotal:"0%"})})}),e.jsx(z,{w:{base:"100%",lg:i[2]},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(ht,{positionInfo:t,fontSize:"14px",isPosList:!0})}),e.jsx(St,{positionInfo:t,width:i[3],onFeesChange:o}),e.jsx(At,{positionInfo:t,width:i[4],onRewardsChange:F,showMiningIcon:c,showFarmingIcon:g})]})})})})}const je=["480px","20%","20%","20%","20%"],De=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Pt=De.reduce((t,i)=>(t[i.value]=i,t),{});function Jt({poolInfo:t,priceDirect:i}){const{coinPriceObj:a}=Oe(),{posApiPoolData:c}=te(),{getPositionSortList:g}=wt(),[s,A]=d.useState("desc"),[w,n]=d.useState({label:"",value:""}),r=u=>{(u==null?void 0:u.value)===w.value?A(_=>_==="desc"?"asc":"desc"):(A("desc"),n(u))},[h,v]=d.useState([]),j=d.useMemo(()=>{if(!Q(t))return[];const u=g(w.value,s,t.list),_=w.value?u:t.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",_,u),v(u),_},[w.value,s,t==null?void 0:t.list,a]),y=u=>h.some(_=>p(_[u]).gt(0)),f=d.useMemo(()=>y("totalMiningAmount"),[h]),T=d.useMemo(()=>y("totalFarmingAmount"),[h]);return e.jsxs(z,{gap:"12px",w:"100%",children:[e.jsxs(k,{w:"100%",p:"0 16px",children:[e.jsx(S,{w:je[0],children:"Price Range"}),De.map((u,_)=>u.value!=="rewards"||f||T?e.jsxs(k,{gap:"4px",w:je[_+1],justify:"flex-end",children:[f&&u.value==="rewards"&&e.jsx(de,{w:"18px",h:"18px",src:"/images/icon_mining.png"}),T&&u.value==="rewards"&&e.jsx(de,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(dt,{labelInfo:Pt[u.value],sortRule:s,sortBy:w,clickSort:r})]},u.value):null)]}),e.jsx(z,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:j.map(u=>e.jsx(_t,{positionInfo:u,positionItemWidth:je,priceDirect:i,showMiningIcon:f,showFarmingIcon:T},u==null?void 0:u.id))})]})}export{Yt as F,Jt as P,Vt as V,wt as a,Gt as u};
//# sourceMappingURL=PositionItem-BskfRO_C.js.map
