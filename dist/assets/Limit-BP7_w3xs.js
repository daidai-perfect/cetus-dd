import{j as e,H as b,a0 as Bt,T as f,Y as N,Z as Te,bp as rt,e as at,r as p,b as ne,W as V,V as k,I as q,c as ke,X as Oe,U as ot,a1 as te,R as be,bq as ge,br as ie,bs as lt,aO as K,d as F,ad as Pe,ae as Me,af as He,ag as Ee,ah as ct,ai as Ae,aj as Re,k as dt,al as pt,$ as I,S as X,g as $t,C as pe,a2 as Ke,B as xt,a$ as fe,a9 as he,a4 as Fe,a as ut,bd as Vt,a8 as Ze,ak as Xe,as as qe,l as Yt,aa as Ut,u as Gt,ao as Qt}from"./index-BHioxihs.js";import{P as _e}from"./Pagination-BUK82tyz.js";import{N as ee}from"./NoData-CGTwny5r.js";import{u as Jt}from"./RangeValue-VrD61sZb.js";import{u as we}from"./useAccountBalance-BkCOmdNG.js";import{u as de}from"./useTransaction-B_4Jg7f2.js";import{u as ze}from"./useToken-DZK_dzU3.js";import{C as Ne}from"./CetusTooltip-D74XO5fb.js";import{S as Kt}from"./SingleTokenInfo-D28cfzld.js";import{b as mt}from"./FarmsTable-f2hd4c3K.js";import{a as Y,b as z,c as gt,d as ht,e as Z,T as jt}from"./tr-CgVG6u5U.js";import{A as Zt}from"./aggregator-9CNLNseD.js";import{A as Ie}from"./useSwapHelper-B60Pi301.js";import{u as et}from"./useTokenBalance-BLs9nTNB.js";import{u as Xt}from"./useInsufficientBalanceToast-9c6kR8yD.js";import{u as qt}from"./useFindBestRouting-B6UyUTu_.js";import{T as It}from"./TradeInputGroup-DHW51PUD.js";import{W as es}from"./WarningTokenTipModal-0WqsQevr.js";import{M as ts,C as ss}from"./MenuDropBlock-4MrT_e3b.js";import{T as is,a as ns,L as rs}from"./LimitPriceChart-Ds5fE0O7.js";import"./Swap-CzR5UGdq.js";import{T as as}from"./TradeConfirmAmountInfo-BvV6xzPt.js";import{I as je}from"./InputBox-Cm2u5Ykw.js";import{L as os}from"./api-data-utils-BCUKKSI0.js";import{u as ls}from"./global-DSBKxi_f.js";import{R as tt}from"./RefreshButton-CiZJCLSA.js";import{u as cs}from"./useRpcListener-6V6cT5db.js";import"./AddressCopyLink-V33ze5Xu.js";import"./AddressUnderline-DQBj8kxU.js";import"./usePositionList-BoU0l88X.js";import"./useGetPoolList-g-UFM5lp.js";import"./index-C8I2j922.js";import"./ExpendItem-B1TjnID1.js";import"./msafe-oYBkW7LJ.js";import"./PriceRange-BMz9svBY.js";import"./PositionStatus-CHJ1G87m.js";import"./CoinPairInfo-BKqrb6GE.js";import"./_getAllKeysIn-Be6LJ_gF.js";import"./IconBg-FZ4dAJUP.js";import"./SwapConfirmBlock-BCAzZ0Tc.js";import"./index-XbiT-K8U.js";import"./usePriceImpact-DDSffb27.js";import"./CurrentPrice-DrDGi8VN.js";import"./HighlightText-DGbw96w7.js";import"./HTextLabelBox-Bsxm1-Y-.js";import"./swap-UiyfIXwY.js";import"./Slippage-CSOPwUTp.js";import"./TooltipIcon-B9nqzUAW.js";import"./switch-CTPaY6an.js";import"./index-BUbOgaOa.js";import"./debounce-Y-z0BKQj.js";import"./throttle-Bv3l8_Th.js";import"./usePreviousValue-qnWj3KZg.js";const xe=({info:t,imgSize:i="32px"})=>{const{pay_coin:n,target_coin:u,total_pay_amount:x,expect_obtain_amount:c}=t;return e.jsxs(b,{children:[e.jsx(Bt,{w:i,h:i,coinAIconUrl:n.logo_url,coinBIconUrl:u.logo_url}),e.jsxs(f,{color:"text_caption",children:[N(x)," ",n.symbol," â†’ ",N(c)," ",u.symbol]})]})},ue=({info:t})=>e.jsx(b,{justifyContent:"end",gap:"2px",children:e.jsxs(f,{color:"text_caption",children:[Te(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),me=({info:t})=>{const{pay_coin:i,total_pay_amount:n,deal_amount:u,deal_rate:x}=t;return e.jsxs(b,{justifyContent:"end",gap:"2px",children:[e.jsxs(f,{color:"text_caption",children:[N(u),"/",N(n)," ",i.symbol]}),e.jsxs(f,{color:"primary_gray",children:["(",rt(Number(x)*100),")"]})]})},bt=({historyInfo:t,type:i,...n})=>{const{getExplorerUrl:u}=at(),{pay_coin:x,target_coin:c}=t,h=p.useMemo(()=>(t==null?void 0:t.events)||[],[t]),j=d=>{const l=d==null?void 0:d.event_type;return l.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${N(Oe(d==null?void 0:d.amount,x==null?void 0:x.decimals))}`}:l.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:c,num:`+${N(Oe(d==null?void 0:d.amount,c==null?void 0:c.decimals))}`}:l.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${N(Oe(d==null?void 0:d.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=ne();return e.jsx(V,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...n,children:e.jsx(k,{align:"flex-start",children:h.map(d=>{const{tokenInfo:l,text:o,icon:s,color:r,num:g}=j(d);return e.jsxs(k,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(b,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(b,{gap:i=="card"?"4px":"8px",flexDirection:i=="card"?"column":"row",align:i=="card"?"flex-start":"center",children:[e.jsxs(b,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(q,{svgW:"14px",xlinkHref:s,svgFill:r,svgHover:r}),e.jsx(f,{color:r,children:o})]}),!a&&e.jsxs(f,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[g,"Â ",l==null?void 0:l.symbol]})]}),e.jsxs(b,{gap:i=="card"?"4px":"20px",flexDirection:i=="card"&&!a?"column":"row",align:i=="card"?"flex-end":"center",children:[e.jsxs(f,{h:"20px",lineHeight:"20px",children:[Te(Number(d.block_time),"")," (UTC)"]}),e.jsxs(b,{gap:"4px",cursor:"pointer",onClick:w=>{ke(w),window.open(u(d.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(f,{color:"text_caption",children:"View Transaction"}),e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(f,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[g,"Â ",l==null?void 0:l.symbol]})]},d==null?void 0:d.tx)})})})},oe=({info:t})=>{const[i,n]=p.useState(!0),{getTokenRank:u}=Jt();p.useEffect(()=>{const a=u(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),n(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:c,price:h,reseverPrice:j}=t;return e.jsxs(b,{justifyContent:"end",children:[i?e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(f,{color:"text_caption",lineHeight:"1",children:N(h)}),e.jsxs(f,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[c.symbol," per ",x.symbol]})]}):e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(f,{color:"text_caption",children:N(j)}),e.jsxs(f,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",c.symbol]})]}),e.jsx(q,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{ke(a),n(!i)}})]})},ft=({historyInfo:t,openExpendItemObj:i})=>e.jsxs(b,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(q,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(f,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(q,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:i[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),ds=(t,i)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:n=>{t(()=>({orderListLoading:n}))},setMyOrderList:n=>{t(()=>({myOrderList:n}))}}),ye=ot(ds);function Se(){const{currentAccount:t,addressChangeVersion:i}=te(),{peripherySdk:n}=be(),{setOrderListLoading:u,setMyOrderList:x,myOrderList:c,orderListLoading:h}=ye(),{fetchTokenInfo:j}=ze(),a=async(l=t==null?void 0:t.address,o)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",l);try{if(!l){u(!1),x([]);return}o&&u(!0);const s=await n.LimitOrder.getOwnerLimitOrderList(l,"all"),r=await d(s.data.filter(g=>g.status===ge.PartialCompleted||g.status===ge.Running));x(r),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",r)}catch(s){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",s)}finally{u(!1)}},d=async l=>{const o=[];for(const s of l){const[r,g]=await Promise.all([j(s.pay_coin_type),j(s.target_coin_type)]);if(r&&g){const{total_pay_amount:w,pay_balance:T,rate:O,obtained_amount:C,claimed_amount:M,target_balance:y,created_ts:H,expire_ts:_,status:E,id:P}=s,L=ie(w,r.decimals).toString(),$=ie(T,r.decimals).toString(),U=ie(C,g.decimals).toString(),D=ie(M,g.decimals).toString(),G=ie(y,g.decimals).toString(),v=lt.rateToPrice(O.toString(),r.decimals,g.decimals),Q=K(1).div(v).toString(),S=ie(K(w).sub(T).toFixed(0),r.decimals).toString(),W={order_id:P,pay_coin:r,target_coin:g,price:v,reseverPrice:Q,total_pay_amount:L,expect_obtain_amount:K(L).mul(v).toString(),remaining_amount:$,deal_amount:S,deal_rate:K(S).div(L).toString(),obtained_amount:U,claimed_amount:D,un_claimed_amount:K(G).sub(D).toString(),created_ts:H,expire_ts:_,status:E};o.push(W)}}return o.sort((s,r)=>r.created_ts-s.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:h,myOrderList:c}}function _t(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:i}=Se(),{signAndExecuteTransaction:n}=de(),{peripherySdk:u}=be(),[x,c]=p.useState(!1),{transactionConfirmation:h}=de();return{handleCancelOrder:async a=>{c(!0);const d={getShowInfo:r=>{const g="Canceling order",w={modalDescriptionText:g,toastTitleText:g};return r==="success"&&(w.toastDescriptionContent="Order cancelled successfully",w.modalDescriptionText="Order cancelled successfully",w.toastTitleText="Order cancelled"),w}};h(d);const l=a.map(r=>({pay_coin_type:r.pay_coin.coin_type,target_coin_type:r.target_coin.coin_type,order_id:r.order_id})),o=await u.LimitOrder.cancelOrdersByOwner(l),s=await n(o,d);c(!1),s&&setTimeout(()=>{t(),i()},2e3)},cancelOrderLoading:x}}function ps(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:i}=Se(),{signAndExecuteTransaction:n}=de(),{peripherySdk:u}=be(),[x,c]=p.useState(!1),[h,j]=p.useState(!1);return{handleClaimOrder:async(l,o)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",l),c(!0);const s={pay_coin_type:l.pay_coin.coin_type,target_coin_type:l.target_coin.coin_type,order_id:l.order_id},r=await u.LimitOrder.claimTargetCoin(s),g=await n(r,{getShowInfo:(w,T)=>{var M;const O=`Claim ${N(o)} ${(M=l==null?void 0:l.target_coin)==null?void 0:M.symbol}`,C={modalDescriptionText:O,toastTitleText:O};return w==="success"&&(C.toastDescriptionContent="",C.modalDescriptionText="",C.toastTitleText="Claim successfully"),C}});c(!1),g&&setTimeout(()=>{t(),i()},2e3)},getLimitOrderClaimHistory:async l=>{j(!0);const o=await u.LimitOrder.getLimitOrderClaimLogs(l.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",l,o),o?(j(!1),o.map(s=>{var g;const r=F(s.parsedJson.claimed_amount).div(Math.pow(10,(g=l.target_coin)==null?void 0:g.decimals));return{...s,...s.parsedJson,claimed_amount:r}})):[]},isClaimHistoryLoading:h,claimLoading:x}}const xs=({orderInfo:t,isOpen:i,onClose:n,handleClaim:u,claimLoading:x,getLimitOrderClaimHistory:c,isClaimHistoryLoading:h})=>{const{getExplorerUrl:j}=at(),[a,d]=p.useState(""),[l,o]=p.useState([]),[s,r]=p.useState({label:"Claim",value:"claim"}),g=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],w=y=>{r(y),(y==null?void 0:y.value)=="history"&&T()},T=async()=>{const y=await c();y&&o(y)},O=p.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:F(a).gt(t.un_claimed_amount)||F(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[C,M]=p.useState(!0);return p.useEffect(()=>{C&&(M(!1),d(t.un_claimed_amount))},[C,t.un_claimed_amount]),e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:i,onClose:n,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{children:[e.jsx(Ee,{children:e.jsx(ct,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(Ae,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(k,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(xe,{info:t,imgSize:"28px"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsx(dt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:g,currentTab:s.label,handleChangeTab:w}),(s==null?void 0:s.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(V,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(k,{gap:"16px",align:"flex-start",children:[e.jsx(f,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(pt,{value:a?N(a).toString():"",onChange:y=>{d(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:e.jsx(Kt,{portal:!1,token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(I,{onClick:()=>{u(a),n()},disabled:O.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:O.text})]}),(s==null?void 0:s.value)=="history"&&e.jsx(k,{w:"100%",gap:"12px",children:h?e.jsxs(V,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(b,{justify:"space-between",children:[e.jsx(X,{height:"4",width:"150px"}),e.jsx(X,{height:"4",width:"150px"})]}),e.jsxs(b,{justify:"space-between",mt:"16px",children:[e.jsx(X,{height:"4",width:"150px"}),e.jsx(X,{height:"4",width:"150px"})]})]},history==null?void 0:history.id):(l==null?void 0:l.length)==0?e.jsx(ee,{type:"nodata",text:"No History.",p:"20px"}):l==null?void 0:l.map(y=>{var H,_;return e.jsx(V,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(k,{gap:"16px",align:"flex-start",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Amount"}),e.jsxs(b,{gap:"4px",children:[e.jsx($t,{imageUrl:(H=t==null?void 0:t.target_coin)==null?void 0:H.logo_url,w:"20px",h:"20px"}),e.jsxs(f,{color:"text_caption",lineHeight:"18px",children:[N(y==null?void 0:y.claimed_amount)," ",(_=t==null?void 0:t.target_coin)==null?void 0:_.symbol]})]})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Time"}),e.jsxs(b,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:E=>{ke(E),window.open(j(y.digest,"tx"))},children:[e.jsxs(f,{color:"text_caption",children:[Te(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},ve=({orderInfo:t})=>{const{handleCancelOrder:i,cancelOrderLoading:n}=_t(),{handleClaimOrder:u,claimLoading:x,getLimitOrderClaimHistory:c,isClaimHistoryLoading:h}=ps(),[j,a]=p.useState(),[d,l]=p.useState(!1),o=(s,r)=>{a(s),r==="cancel"&&i([s]),r==="claim"&&l(!0)};return ne(),e.jsxs(b,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[F(t==null?void 0:t.obtained_amount).lte(0)&&F(t.un_claimed_amount).lte(0)?e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(pe,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(I,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(I,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||o(t,"claim")},children:"Claim"}),e.jsx(I,{isLoading:n,disabled:n,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{n||o(t,"cancel")},children:"Cancel"}),d&&e.jsx(xs,{orderInfo:t,claimLoading:x,isOpen:d,onClose:()=>l(!1),handleClaim:s=>u(t,s),getLimitOrderClaimHistory:()=>c(t),isClaimHistoryLoading:h})]})};function st(){const{currentAccount:t,onWalletModal:i}=te(),{myOrderList:n,orderListLoading:u}=ye();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",n);const x=10,[c,h]=p.useState([]),[j,a]=p.useState(0),[d,l]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){a(n==null?void 0:n.length);const o=(d-1)*x,s=o+x;h(n.slice(o,s))}},[d,n]),e.jsx(k,{w:"100%",children:t!=null&&t.address?u?e.jsx(V,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((o,s)=>e.jsx(wt,{},s))})}):n.length===0?e.jsx(ee,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(V,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(c==null?void 0:c.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:c==null?void 0:c.map(o=>e.jsx(us,{orderInfo:o},o==null?void 0:o.order_id))}),!u&&(n==null?void 0:n.length)>x&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:j,size:x,currentPage:d,onChange:l})})]}):e.jsx(ee,{type:"nowallet",onboard:()=>i(!0),borderRadius:"16px"})})}const us=({orderInfo:t})=>{const{isApp:i}=ne();return e.jsxs(k,{w:"100%",gap:"16px",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(xe,{info:t,imgSize:"28px"}),!i&&e.jsx(ve,{orderInfo:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),i&&e.jsx(ve,{orderInfo:t})]})},wt=()=>e.jsxs(k,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(b,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(b,{gap:"0",children:[e.jsxs(b,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(Ke,{size:"8"}),e.jsx(Ke,{size:"8"})]}),e.jsx(X,{height:"4",width:"100px"})]})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(X,{height:"4",width:"180px"}),e.jsx(X,{height:"4",width:"150px"})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(X,{height:"4",width:"180px"}),e.jsx(X,{height:"4",width:"150px"})]})]});function it(t){const{historyOrderList:i,historyOrderLoading:n}=t,{currentAccount:u,onWalletModal:x}=te();console.log("ðŸš€ ~ OrderTableList ~ historyOrderList:",i);const c=10,[h,j]=p.useState([]),[a,d]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){d(i==null?void 0:i.length);const s=(l-1)*c,r=s+c;j(i.slice(s,r))}},[l,i]),e.jsx(k,{w:"100%",children:u!=null&&u.address?n?e.jsx(V,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,r)=>e.jsx(wt,{},r))})}):i.length===0?e.jsx(ee,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(V,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(h==null?void 0:h.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:h==null?void 0:h.map(s=>e.jsx(ms,{historyInfo:s},s==null?void 0:s.order_id))}),!n&&(i==null?void 0:i.length)>c&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:a,size:c,currentPage:l,onChange:o})})]}):e.jsx(ee,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const ms=({historyInfo:t})=>{const[i,n]=p.useState({});return e.jsxs(k,{w:"100%",gap:"16px",children:[e.jsx(b,{w:"100%",justify:"space-between",children:e.jsx(xe,{info:t,imgSize:"28px"})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Limit Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Status"}),e.jsx(xt,{cursor:"pointer",onClick:()=>{i[t==null?void 0:t.order_id]?i[t==null?void 0:t.order_id]=!1:i[t==null?void 0:t.order_id]=!0,n({...i})},children:e.jsx(ft,{historyInfo:t,openExpendItemObj:i})})]}),i[t==null?void 0:t.order_id]&&e.jsx(bt,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function gs({historyInfo:t}){const[i,n]=p.useState({});return e.jsxs(fe.Fragment,{children:[e.jsxs(Y,{cursor:"pointer",onClick:()=>{i[t==null?void 0:t.order_id]?i[t==null?void 0:t.order_id]=!1:i[t==null?void 0:t.order_id]=!0,n({...i})},sx:{td:{pb:i[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(ft,{historyInfo:t,openExpendItemObj:i})})]}),!i[t==null?void 0:t.order_id]&&e.jsx(Y,{h:"16px"}),e.jsx(Y,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:i[t==null?void 0:t.order_id]&&e.jsx(z,{colSpan:5,children:e.jsx(bt,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function hs(t){const{historyOrderList:i,historyOrderLoading:n}=t;console.log("ðŸš€ ~ HistoryTableList ~ historyOrderList:",i);const{currentAccount:u,onWalletModal:x}=te(),c=10,[h,j]=p.useState([]),[a,d]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){d(i==null?void 0:i.length);const s=(l-1)*c,r=s+c;j(i.slice(s,r))}},[l,i]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(ht,{children:e.jsxs(Y,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Limit Price"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Status"})]})}),e.jsx(jt,{children:u!=null&&u.address?n?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):i.length===0?e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(fe.Fragment,{children:[h.map(s=>e.jsx(gs,{historyInfo:s},s.order_id)),!n&&(i==null?void 0:i.length)>c&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:a,size:c,currentPage:l,onChange:o})})})]}):e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const js=(t,i)=>({quoteToken:void 0,payCoin:he.clmm_swap.from_coin,targetCoin:he.clmm_swap.to_coin,setPayCoin:n=>{t(()=>({payCoin:n}))},setTargetCoin:n=>{t(()=>({targetCoin:n}))},setQuoteToken:n=>{t(()=>({quoteToken:n}))},expiresIn:"7 Days",setExpiresIn:n=>{t(()=>({expiresIn:n}))},customExpiresVal:null,setCustomExpiresVal:n=>{t(()=>({customExpiresVal:n}))},refreshPriceLoading:!1,setRefreshPriceLoading:n=>{t(()=>({refreshPriceLoading:n}))}}),re=ot(js);function bs(t,i){const{getTokenPrice:n}=Fe(),u=n(t),x=n(i),c=p.useMemo(()=>{if(u&&x){const h=K(u.price).div(x.price).toString(),j=h.toString();return{price:h,displayPrice:j}}},[u,x]);return{price:c==null?void 0:c.price,displayPrice:c==null?void 0:c.displayPrice}}function yt(){const{payCoin:t,targetCoin:i,setRefreshPriceLoading:n}=re(),{fetchTokenPrices:u}=Fe();return{refreshCoinMarketPrice:()=>{const c=[];t&&c.push(t.coin_type),i&&c.push(i.coin_type),c.length>0&&(n(!0),u(c).finally(()=>{n(!1)}))}}}function fs(){const{refreshCoinMarketPrice:t}=yt(),{fetchAccountBalance:i}=we(),{fetchMyLimitOrder:n}=Se(),{signAndExecuteTransaction:u}=de(),{peripherySdk:x}=be(),{findBestRouters:c}=qt(),{fetchTokenPrices:h,getTokenAmountValue:j}=Fe(),a=ut(),{pay:d,target:l}=Vt(),{getTokenInfo:o}=ze(),{payCoin:s,targetCoin:r,quoteToken:g,expiresIn:w,setPayCoin:T,setTargetCoin:O,setQuoteToken:C,customExpiresVal:M,setExpiresIn:y,setRefreshPriceLoading:H}=re(),[_,E]=p.useState(""),[P,L]=p.useState(""),[$,U]=p.useState(!0),[D,G]=p.useState(!0),[v,Q]=p.useState(""),{displayPrice:S}=bs((g==null?void 0:g.coin_type)===(s==null?void 0:s.coin_type)?r==null?void 0:r.coin_type:s==null?void 0:s.coin_type,g==null?void 0:g.coin_type),{balanceInfo:W}=et(s),{balanceInfo:De}=et(r),St=j(s==null?void 0:s.coin_type,_),Ct=j(r==null?void 0:r.coin_type,P),[Ce,Lt]=p.useState(""),We=p.useRef(Ce);p.useEffect(()=>{We.current=Ce},[Ce]);const[le,Be]=p.useState(void 0),[Ot,$e]=p.useState(""),vt=p.useRef(_),Tt=p.useRef(P);p.useEffect(()=>{vt.current=_},[_]),p.useEffect(()=>{Tt.current=P},[P]),p.useEffect(()=>{T(o(d)||he.clmm_swap.from_coin),O(o(l)||he.clmm_swap.to_coin)},[d,l]),p.useEffect(()=>{if(Be(void 0),t(),kt(),s&&r){const m=s.extensions&&s.extensions.rank||"0",A=r.extensions&&r.extensions.rank||"0";console.log("ðŸš€ ~ useEffect ~ payCoinRank:",s,r),F(m).gte(A)?C({...s}):C({...r})}},[s==null?void 0:s.coin_type,r==null?void 0:r.coin_type]);const kt=async()=>{if(s&&r){const m=`${s.coin_type}_${r.coin_type}`;Lt(m);const A=Object.entries(Zt).map(([B,se])=>se.id),J=await c({fromToken:s,toToken:r,amount:Ze(1,s.decimals).toFixed(0),providersKeys:A,by_amount_in:!0,uuid:m});m===We.current&&Be(J)}};p.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",D,S),D?Q(S||""):Ye()},[S]),p.useEffect(()=>{g&&!D&&+v&&Q(N(F(1).div(v).toFixed(g.decimals)).toString())},[g]),p.useEffect(()=>{Ue($?_:P,$),Ye()},[v]);const[Pt,Mt]=p.useState({tooltip:"",color:"",text:"",bg:""}),[Ht,Ve]=p.useState(!1),Ye=()=>{var m,A;if(!D&&S&&v){Ve(!0);const J=F(v).sub(S).div(S).mul(100).toFixed(2);$e(J);const B=F(J).gt(0),se=B?J:J.split("-")[1],R={tooltip:"",color:"",text:"",bg:""};R.tooltip=`Limit order price is ${se}% ${B?"higher":"lower"} than the market.`,((m=g==null?void 0:g.coin_type)==null?void 0:m.toLowerCase())==((A=r==null?void 0:r.coin_type)==null?void 0:A.toLowerCase())?Number(v)>Number(S)?(R.text="",R.color="#68FFD8"):Number(S)>Number(v)&&(R.text=`Your limit order price is ${se}% ${B?"higher":"lower"} than market. You are selling at a much ${B?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(v)>Number(S)?(R.text=`Your limit order price is ${se}% ${B?"higher":"lower"} than market. You are buying at a much ${B?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(S)>Number(v)&&(R.text="",R.color="#68FFD8"),Mt(R),Ve(!1);return}$e("")},Et=(m=!0)=>{console.log("ðŸš€ ~ handleMarketPriceClick ~ marketPrice:",S),G(m),m&&(Q(S||""),t())},Ue=(m,A)=>{if(U(A),A?E(m):L(m),g&&s&&r&&+v&&+m)if(A){g.coin_type===s.coin_type?L(F(m).div(v).toString().toString()):L(F(m).mul(v).toString().toString());return}else{g.coin_type===r.coin_type?E(F(m).div(v).toString().toString()):E(F(m).mul(v).toString().toString());return}A?L(""):E("")},Ge=(m,A)=>{Qe(),U(A),G(!0),A?m.coin_type===(r==null?void 0:r.coin_type)?a(`/limit/${m==null?void 0:m.coin_type}/${s==null?void 0:s.coin_type}`):a(`/limit/${m==null?void 0:m.coin_type}/${r==null?void 0:r.coin_type}`):m.coin_type===(s==null?void 0:s.coin_type)?a(`/limit/${r==null?void 0:r.coin_type}/${m==null?void 0:m.coin_type}`):a(`/limit/${s==null?void 0:s.coin_type}/${m==null?void 0:m.coin_type}`)},At=async()=>{r&&(Ge(r,!0),E(P),L(_))},Qe=()=>{E(""),L("")};p.useEffect(()=>()=>{y("7 Days")},[]);const[Rt,Le]=p.useState(!1),Ft=m=>{switch(m){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:zt}=Xt(),{transactionConfirmation:Nt}=de(),Dt=async()=>{const m={getShowInfo:(B,se)=>{const R="Creating order",ce={modalDescriptionText:R,toastTitleText:R};return B==="success"&&(ce.toastDescriptionContent="",ce.modalDescriptionText="Created order successfully",ce.toastTitleText="Created order successfully"),B==="rejected"&&(ce.toastTitleText="Create order"),ce}};Nt(m);const A=Date.parse(new Date().toString())+(Ft(w)||M);console.log(" ~ handleSubmitOrder ~ expired_ts:",A),Le(!0);let J;(g==null?void 0:g.coin_type)===(r==null?void 0:r.coin_type)?J=v:J=F(1).div(v).toFixed(r.decimals);try{const B={pay_coin_type:s.coin_type,target_coin_type:r.coin_type,expired_ts:A,target_decimal:r.decimals,pay_decimal:s.decimals,price:Number(J),pay_coin_amount:Number(Ze(_,s.decimals).toFixed(0))},se=await x.LimitOrder.placeLimitOrder(B),R=await u(se,m);Le(!1),R&&(i(),n(),Qe())}catch(B){zt(String(B)),Le(!1)}},{currentAccount:ae}=te(),Je=p.useMemo(()=>{const m=j(s==null?void 0:s.coin_type,_);return Number(m)==0&&Number(_)>0?!1:Number(m)<5},[s,_]),Wt=p.useMemo(()=>{const m={text:"Place Limit Order",disabled:!1};return ae!=null&&ae.address?!s||!r?(m.disabled=!0,m.text=" Select a token",m):!Number(_)||!Number(P)?(m.disabled=!0,m.text="Enter an amount",m):Je?(m.disabled=!0,m.text="Order size should be higher than $5",m):Number(_)>Number(W==null?void 0:W.balanceFormat)||!(W!=null&&W.balanceFormat)?(m.disabled=!0,m.text=`Insufficient ${s==null?void 0:s.symbol} balance`,m):(le&&le.errorCode&&(le.errorCode===Ie.NoRouter||le.errorCode===Ie.HoneyPot)&&(m.text="No Available Route",m.disabled=!0),m):(m.disabled=!1,m.text="Connect Wallet",m)},[ae==null?void 0:ae.address,s,r,le,_,P,Je,W]);return{priceImpactInfoLoading:Ht,priceImpactInfo:Pt,fixPayCoin:$,onReverseClick:At,handleSelectToken:Ge,marketPrice:S,payCoin:s,targetCoin:r,handleAmountChange:Ue,payAmount:_,targetAmount:P,payBalanceInfo:W,targetBalanceInfo:De,payAmountValue:St,targetAmountValue:Ct,useMarketPrice:D,handleMarketPriceClick:Et,inputPrice:v,setInputPrice:Q,priceImpact:Ot,quoteToken:g,setQuoteToken:C,handleSubmitOrder:Dt,submitOrderLoading:Rt,buttonTextStatus:Wt}}const _s=({confirmData:t,isOpen:i,onClose:n,handleSubmitOrder:u,submitOrderLoading:x})=>{var g,w,T,O;const{payAmount:c,targetAmount:h,payCoin:j,targetCoin:a,inputPrice:d,expiresIn:l,quoteToken:o}=t,s=((g=o==null?void 0:o.coin_type)==null?void 0:g.toLowerCase())==((w=a==null?void 0:a.coin_type)==null?void 0:w.toLowerCase())?d:F(1).div(d).toString(),r=((T=o==null?void 0:o.coin_type)==null?void 0:T.toLowerCase())==((O=a==null?void 0:a.coin_type)==null?void 0:O.toLowerCase())?F(1).div(d).toString():d;return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:i,onClose:n,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{children:[e.jsx(Ee,{children:e.jsx(ct,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(Ae,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(k,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(as,{coinA:{amount:N(c,j==null?void 0:j.decimals).toString()||"0",...j},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:N(h,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:{pay_coin:j,target_coin:a,price:s,reseverPrice:r}})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expires in"}),e.jsx(f,{color:"text_caption",children:l})]}),e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(I,{onClick:()=>{u(),n()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},ws=({isOpen:t,onClose:i})=>{const{isApp:n}=ne(),{setCustomExpiresVal:u,setExpiresIn:x}=re(),[c,h]=p.useState(""),[j,a]=p.useState(""),d=T=>{const O=T.target.value.replace(/[^\d]/g,"");h(O)},l=T=>{const O=T.target.value.replace(/[^\d]/g,"");a(O)},[o,s]=p.useState({}),r=(T,O)=>{const C=Number(T||0)*60+Number(O||0),M=Math.floor(C/(60*24)),y=Math.floor(C%(60*24)/60),H=C%60;let _="";M>0&&(_+=M+"d "),y>0&&(_+=y+"h "),H>0&&(_+=H+"m "),s({timeText:_.trim()||"0 m",time:C*60*1e3})};p.useEffect(()=>{r(c,j)},[c,j]);const g=p.useMemo(()=>!c&&!j||Number(c)==0&&!j||Number(j)==0&&!c||Number(c)==0&&Number(j)==0,[c,j]),w=()=>{x(o==null?void 0:o.timeText),u(o==null?void 0:o.time),i()};return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:i,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(He,{maxW:"1200px",w:n?"calc(100vw - 32px)":"440px",children:[e.jsx(Ee,{mr:"-10px",children:e.jsxs(b,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(f,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(b,{gap:"0",align:"center",children:e.jsx(Ae,{mt:"0",position:"static"})})]})}),e.jsx(Re,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(k,{w:"100%",children:[e.jsx(je,{children:e.jsxs(b,{children:[e.jsx(Xe,{value:c,onChange:d,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(f,{children:"Hours"})]})}),e.jsx(je,{children:e.jsxs(b,{children:[e.jsx(Xe,{value:j,onChange:l,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(f,{children:"Minutes"})]})}),e.jsx(I,{onClick:w,disabled:g,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function ys(t){const{expiresIn:i,setExpiresIn:n}=re(),[u,x]=p.useState(!1),c=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(je,{w:"156px",borderRadius:"16px",children:[e.jsxs(k,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(b,{gap:"4px",children:[e.jsx(f,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(q,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(ts,{label:i,list:c,onListItemClick:h=>{h=="Custom"?x(!0):n(h)}})]}),u&&e.jsx(ws,{isOpen:u,onClose:()=>x(!1)})]})}function Ss(t){ne();const{marketPrice:i,priceImpactInfo:n,priceImpactInfoLoading:u,priceImpact:x,inputPrice:c,handleMarketPriceClick:h,setInputPrice:j}=t,{payCoin:a,targetCoin:d,quoteToken:l,refreshPriceLoading:o,setQuoteToken:s}=re();return e.jsx(je,{w:"calc(100% - 156px)",children:e.jsxs(k,{w:"100%",gap:"20px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsxs(b,{children:[e.jsx(f,{fontSize:"13px",fontWeight:"500",children:(l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${qe(d==null?void 0:d.symbol,10)} at rate`:`Sell ${qe(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!o&&(u?e.jsx(Yt,{size:"sm"}):e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:n.tooltip}),children:e.jsxs(f,{color:n.color,children:[F(x).gt(0)?"+":"",Number(x)>1e4?">10000%":rt(x)]})}))]}),(i||o)&&e.jsx(I,{isLoading:o,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>h(!0),children:"Market"})]}),e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsx(pt,{value:c?Ut(c).toString():"",onChange:r=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",c,r),h(!1),j(r)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(b,{gap:"4px",children:[e.jsx(f,{textColor:"text_caption",children:l==null?void 0:l.symbol}),e.jsx(q,{xlinkHref:"#icon-icon_swap1",onClick:()=>{d&&a&&((l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?s(d):s(a))}})]})]})]})})}function Cs(){const{expiresIn:t}=re(),{buttonTextStatus:i,payBalanceInfo:n,targetBalanceInfo:u,payAmountValue:x,targetAmountValue:c,payAmount:h,targetAmount:j,payCoin:a,targetCoin:d,marketPrice:l,handleAmountChange:o,handleMarketPriceClick:s,handleSelectToken:r,inputPrice:g,setInputPrice:w,priceImpact:T,quoteToken:O,handleSubmitOrder:C,submitOrderLoading:M,onReverseClick:y,priceImpactInfoLoading:H,priceImpactInfo:_}=fs(),E=p.useMemo(()=>({payAmount:h,targetAmount:j,payCoin:a,targetCoin:d,inputPrice:g,expiresIn:t,quoteToken:O}),[h,j,a,d,g,t,O]),{onWalletModal:P}=te(),[L,$]=p.useState("#icon-a-icon_trade"),U=S=>$(S?"#icon-icon_swap1":"#icon-a-icon_trade"),[D,G]=p.useState(!1),v=ut(),Q=p.useMemo(()=>{const S=[];return a&&S.push(a),d&&S.push(d),S},[a,d]);return e.jsxs(k,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(is,{currTradeTab:ns.Limit}),e.jsx(ss,{})]}),e.jsx(It,{onClick:y,from:{title:"You Pay",balance:(n==null?void 0:n.balanceFormat)||"",value:h,amountValue:x,onChange:S=>{o(S,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:S=>{r(S,!0)}},to:{title:"You Receive",balance:(u==null?void 0:u.balanceFormat)||"",value:j,amountValue:c,onTokenChange:S=>{r(S,!1)},onChange:S=>{o(S,!1)},selectable:!0,placeholder:"0.0",token:d,half:!1,max:!1},iconParams:{xlinkHref:L,svgFill:"text_caption",transform:L==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:L==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1)}}),e.jsxs(b,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(Ss,{marketPrice:l,priceImpactInfoLoading:H,priceImpactInfo:_,priceImpact:T,inputPrice:g,setInputPrice:w,handleMarketPriceClick:s}),e.jsx(ys,{})]}),(_==null?void 0:_.text)&&l&&Number(T)!==0&&g&&e.jsxs(f,{color:_==null?void 0:_.color,lineHeight:"20px",bg:_==null?void 0:_.bg,p:"12px",borderRadius:"8px",children:[_==null?void 0:_.text,"Â ",e.jsx(f,{color:_==null?void 0:_.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>v(`/swap/${a==null?void 0:a.coin_type}/${d==null?void 0:d.coin_type}`),children:"Cetus Swap"}),"Â instead."]}),e.jsx(I,{disabled:(i==null?void 0:i.disabled)||M,isLoading:M,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(i==null?void 0:i.text)=="Connect Wallet"?()=>P(!0):()=>G(!0),children:i==null?void 0:i.text}),D&&e.jsx(_s,{confirmData:E,isOpen:D,onClose:()=>G(!1),handleSubmitOrder:C,submitOrderLoading:M}),(a||d)&&e.jsx(es,{addToken:!0,tokensInfo:Q,waringModalCancel:S=>{S.forEach(W=>{(W.coin_type===(a==null?void 0:a.coin_type)||W.coin_type===(d==null?void 0:d.coin_type))&&r(void 0,W.coin_type===(a==null?void 0:a.coin_type))})}})]})}function Ls({orderInfo:t}){return e.jsxs(fe.Fragment,{children:[e.jsxs(Y,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(ve,{orderInfo:t})})]}),e.jsx(Y,{h:"16px"})]},t==null?void 0:t.order_id)}function Os(){const{currentAccount:t,onWalletModal:i}=te(),{myOrderList:n,orderListLoading:u}=ye();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",n);const x=10,[c,h]=p.useState([]),[j,a]=p.useState(0),[d,l]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){a(n==null?void 0:n.length);const o=(d-1)*x,s=o+x;h(n.slice(o,s))}},[d,n]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(ht,{children:e.jsxs(Y,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Price"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Action"})]})}),e.jsx(jt,{children:t!=null&&t.address?u?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(fe.Fragment,{children:[c.map(o=>e.jsx(Ls,{orderInfo:o},o.order_id)),!u&&(n==null?void 0:n.length)>x&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:j,size:x,currentPage:d,onChange:l})})})]}):e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nowallet",onboard:()=>{i(!0)},borderRadius:"16px"})})})})]})}function vs(){const{fetchByApi:t}=Gt(),{fetchTokenInfo:i}=ze(),{currentAccount:n}=te(),[u,x]=p.useState(!1),[c,h]=p.useState([]);p.useEffect(()=>{h([])},[n==null?void 0:n.address]);const j=async(d,l)=>{try{l&&x(!0);const o=await t(os,"GET",{wallet_address:d});if(o!=null&&o.list){const s=await a((o==null?void 0:o.list)||[]);return h(s),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",s),s}}catch(o){console.log("getLimitOrderHistory ~ error:",o)}finally{x(!1)}},a=async d=>{const l=[];for(const o of d){const[s,r]=await Promise.all([i(o.pay_coin),i(o.target_coin)]);if(s&&r){const{total_pay_amount:g,remaining_amount:w,rate:T,obtained_amount:O,claimed_amount:C,target_balance:M,created_ts:y,expire_ts:H,cancel_reason:_,events:E}=o,P=E;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",o,P),P.sort((v,Q)=>Q.block_time-v.block_time);const L=ie(g,s.decimals).toString(),$=lt.rateToPrice(T.toString(),s.decimals,r.decimals),U=K(1).div($).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",$,U);const D=ie(K(g).sub(w).toFixed(0),s.decimals).toString(),G={order_id:o.order_id,pay_coin:s,target_coin:r,price:$,reseverPrice:U,total_pay_amount:L,remaining_amount:w,deal_amount:D,deal_rate:K(D).div(L).toString(),expect_obtain_amount:K(L).mul($).toString(),obtained_amount:O,claimed_amount:C,un_claimed_amount:"0",created_ts:y,expire_ts:H,status:Number(_)===0?ge.Completed:ge.Cancelled,events:P};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",G),l.push(G)}}return l.sort((o,s)=>s.created_ts=o.created_ts),l};return{getLimitOrderHistory:j,historyOrderLoading:u,historyOrderList:c}}function vi(){const{currentAccount:t}=te(),{getLimitOrderHistory:i,historyOrderList:n,historyOrderLoading:u}=vs(),{fetchMyLimitOrder:x}=Se(),{setMyOrderList:c,myOrderList:h,orderListLoading:j}=ye(),{payCoin:a,targetCoin:d}=re(),{fetchAccountBalance:l}=we();p.useEffect(()=>{t!=null&&t.address&&l()},[]);const{isShowTradeChart:o,isShowTradeOrders:s}=ls(),[r,g]=p.useState([]),[w,T]=p.useState({label:"Open Orders"}),O=p.useMemo(()=>{console.log("ðŸš€ ~ Limit ~ myOrderList:",h);const L=[];return L.push({label:"Open Orders",num:w.label==="Open Orders"&&h.length>0&&!j?h.length.toString():void 0}),L.push({label:"Order History",num:w.label==="Order History"&&r.length>0&&!u?r.length.toString():void 0}),L},[w.label,h,r,u,j]);p.useEffect(()=>{C(!0)},[w.label,t,s]),cs({onRpcChange:()=>{C(!0),t!=null&&t.address&&l()}});const C=L=>{s&&(P(0),console.log("ðŸš€  ~ currentAccount:",w.label==="Open Orders",t==null?void 0:t.address),t!=null&&t.address&&(w.label==="Open Orders"?x(t.address,L):(console.log("ðŸš€ ~  ~ currentAccount:",t),i(t.address,L))))};p.useEffect(()=>{t!=null&&t.address&&(n==null?void 0:n.length)>0?g(n):(g([]),c([]))},[n,t==null?void 0:t.address]);const M=L=>{T(L)},{windowWidth:y,isApp:H}=ne(),{refreshCoinMarketPrice:_}=yt(),[E,P]=p.useState(0);return Qt({interval:1e3,callback:()=>{P(E+1),E>=20&&(P(0),_(),t!=null&&t.address&&l(),C(!1))}}),e.jsxs(k,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:H||o||s?"":"bg_img",children:[e.jsxs(b,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:o?"column":"column-reverse",lg:"row"},children:[(s||o)&&e.jsx(b,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:o?e.jsx(rs,{baseToken:a,quoteToken:d}):e.jsxs(k,{w:"100%",children:[e.jsx(nt,{tabList:O,currTab:w,myOrderList:h,handleChangeTab:M,handleGetOrderList:C}),w.label==="Open Orders"&&e.jsx(st,{}),w.label==="Order History"&&e.jsx(it,{historyOrderList:r,historyOrderLoading:u})]})}),e.jsx(Cs,{})]}),s&&o&&e.jsxs(k,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(nt,{handleGetOrderList:()=>C(!0),tabList:O,currTab:w,myOrderList:h,handleChangeTab:M}),H&&e.jsx(xt,{h:"16px"}),w.label==="Open Orders"&&(H?e.jsx(st,{}):e.jsx(Os,{})),w.label==="Order History"&&(H?e.jsx(it,{historyOrderList:r,historyOrderLoading:u}):e.jsx(hs,{historyOrderList:r,historyOrderLoading:u}))]})]})}const nt=({tabList:t,currTab:i,myOrderList:n,handleChangeTab:u,handleGetOrderList:x})=>{const{handleCancelOrder:c,cancelOrderLoading:h}=_t(),{isApp:j}=ne(),a=i.label==="Open Orders"&&n.length>1;return e.jsxs(b,{w:"100%",justifyContent:"space-between",flexDirection:{base:i.label==="Open Orders"&&n.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(b,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(dt,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:i.label,handleChangeTab:u}),j&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),(!j||a)&&e.jsxs(b,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(I,{onClick:()=>{c(n)},disabled:h,isLoading:h,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!j&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]})};export{vi as default};
