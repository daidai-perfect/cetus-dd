import{a as m,j as t,W as ue,X as fe,Y as xe,Z as me,a7 as pe,$ as he,a0 as Ce,V as B,H as F,T as P,q as ee,f as oe,a1 as be,a2 as ge,a3 as Te,a4 as Se}from"./vendor-BFGDaAdA.js";import{u as N}from"./useTransaction-C_My4i0J.js";import{k as U,l as O,ao as R,v as M,d as Z,E as J,z as K,M as Q,q as se,j as we,B as ne,aj as ae,a as ve,e as z,f as ye,o as Ie,aL as je,aM as ke,aI as Me,ai as De,Z as Y,G as Re}from"./index-Fe2tZAmL.js";import{M as V}from"./msafe-oYBkW7LJ.js";import{u as X}from"./useAccountBalance-Byib0voT.js";import{u as re}from"./useTokenBalance-DP5kgkCW.js";import{u as W,d as ie,e as _e,f as Oe,g as Le}from"./useXCetusHelper-DdpP9EUM.js";import{T as ce}from"./TradeInputGroup-eK__EKBF.js";import{H as Pe}from"./HTextLabelBox-a2CUIzAy.js";import{C as Ue}from"./CheckBox-CTFo1Bg1.js";import{H as Ee}from"./HighlightText-fkyigc44.js";import{u as Ae}from"./activeOrders-CuLgFsVc.js";const tt=(l,r,s="seconds")=>{const a=()=>{const n=l-new Date().getTime();if(n<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const d=Math.floor(n/1e3%60),u=Math.floor(n/1e3/60%60),e=Math.floor(n/(1e3*60*60)%24),f=Math.floor(n/(1e3*60*60*24)%30),h=Math.floor(n/(1e3*60*60*24*30)%12),C=Math.floor(n/(1e3*60*60*24*365));return s==="days"?{years:0,months:0,days:f+h*30+C*365,hours:e,minutes:u,seconds:d}:s==="months"?{years:0,months:h+C*12,days:f,hours:e,minutes:u,seconds:d}:{years:C,months:h,days:f,hours:e,minutes:u,seconds:d}},[i,o]=m.useState(a());return m.useEffect(()=>{const c=setInterval(()=>{const n=a();o(n),n.years===0&&n.months===0&&n.days===0&&n.hours===0&&n.minutes===0&&n.seconds===0&&(clearInterval(c),r&&r())},1e3);return()=>clearInterval(c)},[l]),i};function Fe(){const{fetchAccountBalance:l}=X(),{signAndExecuteTransaction:r}=N(),{currentAccount:s}=U(),{fetchOwnerVeNFT:a}=W(),i=O("xcetus"),{veNFT:o}=R(),[c,n]=m.useState(""),[d,u]=m.useState(""),{balanceInfo:e}=re(M.cetus_coin),f=x=>{n(x),u(x)},[h,C]=m.useState(!1),w=async()=>{try{C(!0);const x={venft_id:o==null?void 0:o.id,amount:J(c,9).toFixed(0)},y=await i.XCetusModule.convertPayload(x),g=await r(y,{getShowInfo:_=>{const I=`Converting ${K(c)} CETUS to ${K(c)} xCETUS`,v={modalTitleText:"Convert",modalDescriptionText:I,toastDescriptionContent:I};if(_==="success"){const L=I.replace("Converting","Converted");v.modalDescriptionText=L,v.toastDescriptionContent=L}return v}},{msafeParams:{action:V.xCETUSConvert,txbParams:x}});C(!1),g&&(n(""),u(""),setTimeout(()=>{l(),s&&a(s==null?void 0:s.address,!0)},2e3))}catch{C(!1)}},S=m.useMemo(()=>{const x={text:"Convert",disabled:!1};return s!=null&&s.address?+c?(+c&&Z(c).gt((e==null?void 0:e.balanceFormat)||0)&&(x.disabled=!0,x.text="Insufficient CETUS Balance"),x):(x.text="Enter an amount",x.disabled=!0,x):(x.text="Connect Wallet",x.disabled=!1,x)},[e==null?void 0:e.balanceFormat,s==null?void 0:s.address,c]);return{inputAmountFrom:c,inputAmountTo:d,handleInputChange:f,balanceInfoFrom:e,convertLoading:h,btnText:S.text,btnDisabled:S.disabled,handleConvertClick:w}}function le(l){const{isOpen:r,onClose:s,onSubmitClick:a}=l,{setShowConvertModel:i}=R(),[o,c]=m.useState(!1);return t.jsxs(ue,{autoFocus:!1,returnFocusOnClose:!1,isOpen:r,onClose:s,isCentered:!0,children:[t.jsx(fe,{}),t.jsxs(xe,{children:[t.jsx(me,{children:t.jsx(pe,{fontWeight:"500",fontSize:"16px"})}),t.jsx(he,{}),t.jsx(Ce,{textAlign:"center",p:"0px",children:t.jsxs(B,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[t.jsx(Ee,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),t.jsxs(F,{children:[t.jsx(Ue,{checked:o,onClick:()=>{c(!o)}}),t.jsx(P,{color:"text_caption",children:"Do not remind again."})]}),t.jsx(ee,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{i(!o),a()},children:"Convert"})]})})]})]})}function st(l){const{availableXCetusAmount:r,iconParams:s,onIconClick:a,onClose:i}=l,{currentAccount:o,onWalletModal:c}=U(),{inputAmountFrom:n,inputAmountTo:d,handleInputChange:u,balanceInfoFrom:e,btnText:f,btnDisabled:h,handleConvertClick:C,convertLoading:w}=Fe(),{showConvertModel:S}=R(),[x,y]=m.useState(!1);return t.jsxs(B,{w:"100%",gap:"8px",children:[t.jsx(ce,{onClick:a,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(e==null?void 0:e.balanceFormat)||"",value:n,amountValue:"",loading:!1,onChange:g=>{u(g)},selectable:!1,placeholder:"0.0",token:M.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:Q(r,9),value:d,half:!1,max:!1,amountValue:"",onChange:g=>{u(g)},selectable:!1,placeholder:"0.0",token:M.x_cetus_coin},iconParams:s}),t.jsx(ee,{w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:h||w,isLoading:w,onClick:()=>{console.log(o,S,"showConvertModel"),o?S?y(!0):C().then(()=>{i&&i()}):c(!0)},children:f}),x&&t.jsx(le,{isOpen:x,onClose:()=>{y(!1)},onSubmitClick:()=>{y(!1),C().then(()=>{i&&i()})}})]})}function Xe(l){const{fetchAccountBalance:r}=X(),{signAndExecuteTransaction:s}=N(),{currentAccount:a}=U(),{fetchOwnerVeNFT:i}=W(),o=O("xcetus"),{veNFT:c}=R(),[n,d]=m.useState(""),[u,e]=m.useState(""),[f,h]=m.useState(180),[C,w]=m.useState(""),[S,x]=m.useState(!0),{balanceInfo:y}=re(M.cetus_coin),g=(p,D)=>{x(D),D?d(p):e(p),I(p,D,f)},_=p=>{h(p),I(S?n:u,S,p)},I=async(p,D,E)=>{if(+p){const A=J(p,9);if(D){const j=await o.XCetusModule.redeemNum(A,E);e(Q(j.amount_out,9)),w(Z(j.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const j=await o.XCetusModule.reverseRedeemNum(A,E);d(Q(j.amount_out,9)),w(Z(j.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else d(""),e(""),w("")},[v,L]=m.useState(!1),G=async()=>{if(!c)return;L(!0);const p={venft_id:c.id,amount:J(n,9).toFixed(0),lock_day:f},D=o.XCetusModule.redeemLockPayload(p),E=await s(D,{getShowInfo:A=>{const j=`Redeeming ${K(n)} xCETUS to ${K(u)} CETUS`,k={modalTitleText:"Redeem",modalDescriptionText:j,toastDescriptionContent:j};if(A==="success"){const $=j.replace("Redeeming","Redeemed");k.modalDescriptionText=$,k.toastDescriptionContent=$}return k}},{msafeParams:{action:V.xCETUSRedeemLock,txbParams:p}});L(!1),E&&(a&&setTimeout(()=>{i(a==null?void 0:a.address,!0)},2e3),d(""),e(""),r())},H=m.useMemo(()=>{const p={text:"Redeem",disabled:!1};return a!=null&&a.address?+n?(+n&&Z(n).gt(l||0)&&(p.disabled=!0,p.text="Insufficient xCETUS Balance"),p):(p.text="Enter an amount",p.disabled=!0,p):(p.text="Connect Wallet",p.disabled=!1,p)},[l,a==null?void 0:a.address,n]);return{inputAmountFrom:n,inputAmountTo:u,handleInputChange:g,balanceInfoTo:y,convertLoading:v,btnText:H.text,btnDisabled:H.disabled,handleConvertClick:G,day:f,handleDayChange:_,percent:C}}function Be(l){const{day:r,onChange:s}=l,a=m.useMemo(()=>`${r}D`,[r]),i=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return t.jsxs(oe,{children:[t.jsxs(F,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[t.jsxs(P,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[r," Days"]}),t.jsx(we,{type:"outlineTab",tabList:i,currentTab:a,handleChangeTab:o=>{o.label==="MAX"?s(100):s(o.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),t.jsxs(be,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(r),onChange:o=>s(o),children:[t.jsx(ge,{h:"8px",children:t.jsx(Te,{h:"4px"})}),t.jsx(Se,{})]})]})}function nt(l){const{availableXCetusAmount:r,iconParams:s,onIconClick:a,onClose:i}=l,{currentAccount:o,onWalletModal:c}=U(),{inputAmountFrom:n,inputAmountTo:d,handleInputChange:u,balanceInfoTo:e,btnText:f,btnDisabled:h,handleConvertClick:C,day:w,handleDayChange:S,percent:x,convertLoading:y}=Xe(r),{showConvertModel:g}=R(),[_,I]=m.useState(!1);return t.jsxs(B,{w:"100%",gap:"8px",children:[t.jsx(ce,{onClick:a,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:r,value:n,amountValue:"",loading:!1,onChange:v=>{u(v,!0)},selectable:!1,placeholder:"0.0",token:M.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(e==null?void 0:e.balanceFormat)||"",value:d,half:!1,max:!1,amountValue:"",onChange:v=>{u(v,!1)},selectable:!1,placeholder:"0.0",token:M.cetus_coin},iconParams:s}),t.jsxs(ne,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[t.jsx(P,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),t.jsx(Be,{day:w,onChange:v=>{S(Number(v))}})]}),t.jsx(ne,{borderRadius:"12px",p:"0px",border:"none",children:t.jsxs(B,{w:"100%",gap:"20px",children:[t.jsx(ee,{mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:h||y,isLoading:y,onClick:()=>{o?g?I(!0):C().then(()=>{i&&i()}):c(!0)},children:f}),+x&&t.jsx(F,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:t.jsx(Pe,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:ae(x),valueStyle:{fontSize:"14px"}})})]})}),_&&t.jsx(le,{isOpen:_,onClose:()=>{I(!1)},onSubmitClick:()=>{I(!1),C().then(()=>{i&&i()})}})]})}function ot(){const{fetchAccountBalance:l}=X(),{signAndExecuteTransaction:r}=N(),s=O("xcetus"),{veNFT:a}=R(),{fetchOwnerVeNFT:i}=W(),{currentAccount:o}=U(),[c,n]=m.useState(!1);return{handleCancelOrder:async u=>{if(!a)return;n(!0);const e={venft_id:a.id,lock_id:u.id},f=s.XCetusModule.cancelRedeemPayload(e),h=await r(f,{},{msafeParams:{action:V.xCETUSCancelRedeem,txbParams:e}});n(!1),h&&(l(),o&&setTimeout(()=>{i(o==null?void 0:o.address,!0)},2e3))},cancelOrderLoading:c}}function at(){const{fetchAccountBalance:l}=X(),{signAndExecuteTransaction:r}=N(),s=O("xcetus"),{veNFT:a}=R(),{fetchOwnerVeNFT:i}=W(),{currentAccount:o}=U(),[c,n]=m.useState(!1);return{handleClaimOrder:async u=>{if(n(!0),!a)return;const e={lock_id:u,venft_id:a.id},f=await s.XCetusModule.redeemPayload(e),h=await r(f,{},{useDevInspect:!1,msafeParams:{action:V.xCETUSRedeem,txbParams:e}});n(!1),h&&setTimeout(()=>{l(),o&&i(o==null?void 0:o.address,!0)},2e3)},claimOrderLoading:c}}function rt({xcetus_amount:l,cetus_amount:r,imageSize:s="24px"}){const{isApp:a}=ve();return a?t.jsxs(B,{w:"100%",align:"center",gap:"8px",children:[t.jsxs(F,{children:[t.jsx(z,{imageUrl:M.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:s,h:s,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),t.jsx(q,{amount:l,token:"xCETUS"})]}),t.jsx(P,{color:"text_caption",transform:"rotate(90deg)",children:"→"}),t.jsxs(F,{children:[t.jsx(z,{imageUrl:M.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:s,h:s,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),t.jsx(q,{amount:r,token:"CETUS"})]})]}):t.jsxs(F,{children:[t.jsx(z,{imageUrl:M.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:s,h:s,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),t.jsx(q,{amount:l,token:"xCETUS"}),t.jsx(P,{color:"text_caption",children:" →"}),t.jsx(z,{imageUrl:M.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:s,h:s,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),t.jsx(q,{amount:r,token:"CETUS"})]})}const q=({amount:l,token:r})=>t.jsxs(oe,{as:"div",children:[t.jsxs(P,{as:"span",color:"text_caption",children:[ye(Q(l,9),9)," "]}),t.jsx(P,{as:"span",color:"text_paragraph",children:r})]});function it(){const{fetchAccountBalance:l}=X(),{signAndExecuteTransaction:r}=N(),s=O("xcetus"),{veNFT:a}=R(),[i,o]=m.useState(!1),{fetchVeNFTDividendInfo:c}=ie();return{handleClaimReward:async d=>{if(a){o(!0),console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:23 ~ handleClaimReward ~ rewardList:",d);try{const u=s.XCetusModule.redeemDividendV3Payload(a.id,d),e=await r(u,{},{useDevInspect:!0,msafeParams:{action:V.xCETUSClaimStakingRwewards,txbParams:{veNftId:a.id,rewardList:d}}});o(!1),e&&setTimeout(()=>{l(),c(a.id)},2e3)}catch(u){console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:40 ~ handleClaimReward ~ error:",u)}finally{o(!1)}}},claimRewardLoading:i}}function Ne(){const{getTokenPrice:l,fetchTokenPrices:r}=Ie();return{refreshCoinPriceInfo:async(a,i=!1,o=!1)=>{const c=new Set;o||a.forEach(n=>{const d=l(n,6e4);d?i&&!d.price_change&&c.add(n):c.add(n)}),console.log("🚀 ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:c,coinTypeList:a}),c.size>0&&await r(Array.from(c),!0,!1)}}}function ct(){const{limitUserIndexerObj:l,setLimitUserIndexerObj:r,dcaUserIndexerObj:s,setDcaUserIndexerObj:a}=Ae(),i=O("limit"),o=O("dca");return{getLimitUserIndexer:async d=>{const u=l[d];if(u)return u;try{const e=new Me;i==null||i.LimitOrder.buildGetUserIndexerHandle(d,e);const f=await i.FullClient.devInspectTransactionBlock({transactionBlock:e,sender:De("0x0")}),h=i==null?void 0:i.LimitOrder.parsedQueryUserIndexerEvent(f);if(h)return r(d,h),h}catch(e){console.log("🚀 ~ getLimitUserIndexer ~ error:",e)}},getDcaUserIndexer:async d=>{const u=s[d];if(u)return u;try{const{dca:e}=o.sdkOptions,{user_indexer_id:f}=je(e),h=await o.FullClient.getDynamicFieldObject({parentId:f,name:{type:"address",value:d}}),C=ke(h).value.fields.id.id;if(C)return a(d,C),C}catch(e){console.log("🚀 ~ getDcaUserIndexer ~ error:",e)}}}}function lt(l=!1){const r=O("xcetus"),{currentAccount:s}=U(),{fetchAccountBalance:a}=X(),{refreshCoinPriceInfo:i}=Ne(),{lockCetusList:o,veNFTLoading:c,lockCetusListLoading:n,clearData:d,owner:u,veNFT:e,XCetusManager:f,setXCetusManager:h,setDividendManager:C,setPhaseDividendInfoMap:w,phaseDividendInfoMap:S,availableXCetusAmount:x}=R(),{nextStartTime:y,currentPeriod:g,calculateCurrPeriod:_}=_e(),{summaryRewardList:I,rewardList:v,totalRewardValue:L}=Oe(g),{fetchVeNFTDividendInfo:G}=ie(),H=async b=>{try{const T=await r.XCetusModule.getXcetusManager(b);T&&h(T)}catch(T){console.log("🚀 ~ fetchXCetusManager ~ error:",T)}},p=async b=>{try{const T=await r.XCetusModule.getPhaseDividendInfo(b.toString());if(T)w(T);else{const de=(b-1).toString();if(!S[de]){const te=await r.XCetusModule.getPhaseDividendInfo(b.toString());te&&w(te)}}}catch(T){console.log("🚀 ~ fetchXCetusManager ~ error:",T)}},D=async b=>{try{const T=await r.XCetusModule.getDividendManager(b);T&&C(T)}catch(T){console.log("🚀 ~ fetchXCetusManager ~ error:",T)}},{fetchOwnerVeNFT:E}=W(),A=m.useMemo(()=>{if(e){const b=Y(e.xcetus_balance).sub(x);if(b.gte(0))return b.toFixed(0)}return"0"},[e==null?void 0:e.xcetus_balance]),j=m.useMemo(()=>{if(f&&e){const b=Y(e.xcetus_balance).div(f.treasury).mul(100);return Y(b).lt(.01)?"<0.01%":ae(b.toString(),3)}return s!=null&&s.address?"0%":"--"},[f==null?void 0:f.treasury,e==null?void 0:e.xcetus_balance,s==null?void 0:s.address]),k=m.useMemo(()=>{if(g){let b=S[g.toString()];return b===void 0&&(b=S[(g-1).toString()]),b}},[S,g]),{cetusApr:$}=Le(k,f==null?void 0:f.treasury);return m.useEffect(()=>{if(k){const b=k.bonus_types.map(T=>Re(T,!1));b&&(b.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),i(b))}},[k==null?void 0:k.id]),m.useEffect(()=>{g&&g>0&&p(g)},[g]),m.useEffect(()=>{e&&!l&&G(e.id)},[e==null?void 0:e.id]),{fetchOwnerVeNFT:E,fetchAccountBalance:a,fetchXCetusManager:H,fetchDividendManager:D,fetchVeNFTDividendInfo:G,veNFTLoading:c,lockCetusListLoading:n,redeemingXCetusAmount:A,availableXCetusAmount:x,veNFT:e,myShare:j,nextStartTime:y,cetusApr:$,summaryRewardList:I,rewardList:v,totalRewardValue:L,lockCetusList:o,calculateCurrPeriod:_}}export{st as C,rt as X,ot as a,at as b,it as c,lt as d,nt as e,Ne as f,ct as g,tt as u};
//# sourceMappingURL=useXCetus-DaYDNffB.js.map
