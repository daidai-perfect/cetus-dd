import{a1 as A,r as n,aB as rs,j as e,V as k,T as _,B as N,S as b,$ as Z,d as P,H as w,a3 as U,a5 as H,a4 as O,I as is,b as as}from"./index-B590w5bb.js";import{V as ns}from"./VaultsAndFarmsTabFilter-ChmtjACn.js";import{u as ds}from"./ExpendItem-Cbn2I4IE.js";import{c as Y,d as D}from"./usePositionList-h-H6rdJs.js";import{N as X}from"./NoData-CQO8ah7n.js";import{A as xs}from"./AprTooltip-CuZfG8W5.js";import{V as ms,R as ps,S as gs,T as hs,F as cs,a as us}from"./FarmsTable-Df0o5SzC.js";import{u as js}from"./useGetPoolList-Cy1o8r-8.js";import{u as bs}from"./useAccountBalance-PY7FPqgW.js";import{u as fs}from"./useRpcListener-C21ycrFq.js";import"./RefreshButton-By_6CvHq.js";import"./IconBg-DHxogp7_.js";import"./SortDropBlock-CF2mWI_M.js";import"./useTransaction-lY1r9B8U.js";import"./msafe-oYBkW7LJ.js";import"./CetusTooltip-DphMru6t.js";import"./SingleTokenInfo-sy5R-yzZ.js";import"./AddressCopyLink-CRuDoMZC.js";import"./AddressUnderline-yAm6W5Hh.js";import"./useToken-BmuTH09v.js";import"./PriceRange-DPpB1CB9.js";import"./PositionStatus-DFi7WKsn.js";import"./RangeValue-BRH9Hgo0.js";import"./api-data-utils-CYJ1lZoU.js";import"./generateCategoricalChart-CzuhI5WP.js";import"./debounce-DMfRlO97.js";import"./throttle-BW5DKmnO.js";import"./index-CXblhEV1.js";import"./CoinPairInfo-CB-kFLVd.js";import"./tr-BIRt7YmP.js";import"./usePreviousValue-HGU3Zmql.js";function Ls(s){const{totalRewards:x}=s,{currentAccount:l}=A(),{posBaseList:o}=Y(),{getPositionBaseList:h}=D(),{toClaimAllPos:r,claimLoading:c}=ds(),i=n.useRef(null),T=async()=>{l!=null&&l.address&&await h(l==null?void 0:l.address)},f=()=>{r(o,T)};return n.useEffect(()=>{i!=null&&i.current&&(i.current.textContent=rs(x,2))},[x]),e.jsx(k,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(k,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(_,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(_,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(l==null?void 0:l.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(b,{isLoaded:!!x,children:e.jsx(_,{color:"primary",fontSize:"20px",fontWeight:"500",ref:i})})}),(l==null?void 0:l.address)&&e.jsx(Z,{isLoading:c,disabled:c||x=="--"?!0:P(x).lte(0),w:"170px",h:"28px",fontSize:"14px",borderRadius:"4px",onClick:f,children:"Claim All Rewards"})]})})}function Ss({dataList:s,showSkeletonLoading:x,currTabLabel:l}){const{currentAccount:o,onWalletModal:h}=A();return e.jsx(e.Fragment,{children:l=="Your Farms"&&!(o!=null&&o.address)?e.jsx(X,{type:"nowallet",onboard:()=>{h(!0)}}):x?e.jsx(Fs,{}):s.length===0?e.jsx(X,{type:"nodata",text:"No farms found"}):e.jsx(k,{w:"100%",children:s.map(r=>e.jsx(vs,{apiInfo:r},r==null?void 0:r.poolAddress))})})}const vs=({apiInfo:s})=>{const{getTokenAmountValue:x}=H(),{coinPriceObj:l}=O();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:o,onWalletModal:h}=A(),[r,c]=n.useState({}),{farmsPosRewardsDataLoading:i,farmsPosRewardsData:T,posBaseListLoading:f,posBaseListGroupByPool:S}=Y(),L=n.useMemo(()=>{var u;if(!(o!=null&&o.address)||!(s!=null&&s.poolAddress))return"--";if(!f&&!i)return(((u=S[s.poolAddress])==null?void 0:u.list)||[]).reduce((p,j)=>{const d=T[j==null?void 0:j.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",p,d);const V=d.reduce((W,m)=>{if(W==="--")return"--";const B=x(m==null?void 0:m.token.coin_type,m==null?void 0:m.display_amount_owed,"--");return B==="--"?"--":P(W).plus(B).toString()},"0");return p==="--"||V==="--"?"--":P(p).plus(V).toString()},"0")},[f,T,i,l,o==null?void 0:o.address]),E=n.useMemo(()=>{var v,p;const u=((p=(v=S==null?void 0:S[s==null?void 0:s.poolAddress])==null?void 0:v.list)==null?void 0:p.filter(j=>j.posType!=="burn").sort((j,d)=>Number(d.liquidity)-Number(j.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",u),u},[s==null?void 0:s.poolAddress,S]);return e.jsxs(k,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(ms,{apiInfo:s}),e.jsx(C,{label:"Staked TVL",value:e.jsx(_,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(C,{label:"APR",value:e.jsx(xs,{poolInfo:s,isPosition:!0})}),e.jsx(C,{label:"Rewards / day",value:e.jsx(ps,{apiInfo:s})}),e.jsx(C,{label:"Your Staked",value:e.jsx(gs,{apiInfo:s})}),e.jsx(C,{label:"Your Earned",value:e.jsx(hs,{totalEarned:L,apiInfo:s,disabled:L=="--"?!0:P(L).lte(0)})}),e.jsx(Z,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{r[s==null?void 0:s.poolAddress]?r[s==null?void 0:s.poolAddress]=!1:r[s==null?void 0:s.poolAddress]=!0,c({...r})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(is,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:r[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),r[s==null?void 0:s.poolAddress]&&e.jsx(cs,{expendList:E,apiInfo:s})]})},C=({label:s,value:x})=>e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:s}),x]}),Fs=()=>e.jsx(k,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,x)=>e.jsxs(k,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(w,{gap:"0",children:[e.jsx(U,{size:"9"}),e.jsx(U,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(b,{height:"4",width:"150px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]})]},x))});function ks(){const{getPoolList:s}=js();return{getFarmList:async(l="-tvl")=>{var h;const o=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",o),(h=o==null?void 0:o.list)==null?void 0:h.sort((r,c)=>l==="-apr"?c.feeAndFarmsApr-r.feeAndFarmsApr:l==="apr"?r.feeAndFarmsApr-c.feeAndFarmsApr:l==="-tvl"?c.farmsStatedTvl-r.farmsStatedTvl:r.farmsStatedTvl-c.farmsStatedTvl)}}}function te(){var J;const{currentAccount:s}=A(),{getPositionBaseList:x,getPosRelatedData:l}=D(),{posBaseList:o,posBaseListLoading:h,farmsPosRewardsData:r}=Y(),{getFarmList:c}=ks(),[i,T]=n.useState([]),[f,S]=n.useState([]),[L,E]=n.useState([]),[u,v]=n.useState(!0),[p,j]=n.useState([]);bs();const[d,V]=n.useState({label:"Live"}),W=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[m,B]=n.useState({sortRule:"desc",sortType:"tvl"}),[q,I]=n.useState({label:"TVL",value:"tvl"}),ss=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:u?void 0:f.length.toString()}),t.push({label:"Your Farms",num:L.length>0&&(s!=null&&s.address)&&!u?L.length.toString():void 0}),t},[d.label,u,f,L,s==null?void 0:s.address]),G=async()=>{s!=null&&s.address?(await x(s==null?void 0:s.address),console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address)):j([])};n.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ posBaseList:",o),(o==null?void 0:o.length)>0&&l(o,!0)},[o]);const z=async t=>{const a=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,F=await c(a);F&&T(F)};n.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",p),i.length>0){if(d.label=="Live"&&(S(i),v(!1)),s!=null&&s.address&&(p==null?void 0:p.length)>0){const t=i.filter(a=>(p==null?void 0:p.filter(g=>(g==null?void 0:g.posType)==="farms")).some(g=>(a==null?void 0:a.poolAddress)===(g==null?void 0:g.clmmPool)));E(t)}else E([]);h||v(!1)}else S([]),E([])},[d.label,i,s==null?void 0:s.address,p,h]),n.useEffect(()=>{z(m),s!=null&&s.address?(v(!0),G()):j([])},[s==null?void 0:s.address]),n.useEffect(()=>{j(o)},[o]);const Q=()=>{v(!0),z(m),G()};fs({onRpcChange:()=>{Q()}});const{fetchTokenPrices:es}=H(),ts=()=>{const t=[];i==null||i.forEach(a=>{var F,g;t.includes(a.tokenA.coin_type)||t.push(a.tokenA.coin_type),t.includes(a.tokenB.coin_type)||t.push(a.tokenB.coin_type),((F=a==null?void 0:a.farmsRewarderList)==null?void 0:F.length)>0&&((g=a==null?void 0:a.farmsRewarderList)==null||g.forEach(y=>{t.push(y==null?void 0:y.coinType)}))}),t.length>0&&es(Array.from(new Set(t)))};n.useEffect(()=>{(i==null?void 0:i.length)>0&&ts()},[i]);const{getTokenAmountValue:os}=H(),{coinPriceObj:ls}=O(),$=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!h)return o.reduce((t,a)=>{const g=(r[a==null?void 0:a.id]||[]).reduce((y,R)=>{if(y==="--")return"--";const K=os(R==null?void 0:R.token.coin_type,R==null?void 0:R.display_amount_owed,"--");return K==="--"?"--":P(y).plus(K).toString()},"0");return t==="--"||g==="--"?"--":P(t).plus(g).toString()},"0")},[h,(J=Object.values(r))==null?void 0:J.length,ls,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",$);const{isApp:M}=as();return e.jsxs(k,{gap:"20px",w:"100%",children:[e.jsx(Ls,{totalRewards:$}),e.jsx(N,{h:"220px"}),e.jsx(ns,{sortByList:W,currTab:d,tabList:ss,handleChangeTab:t=>{V(t)},currSortType:q,onSortByChange:t=>{m.sortType=t.value,B({...m}),I(t),z(m)},sortRule:m.sortRule,handleChangeSortRule:t=>{m.sortRule=t,B({...m}),z(m)},handleRefresh:Q}),M&&e.jsx(_,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!M&&e.jsx(us,{dataList:d.label=="Live"?f:L,showSkeletonLoading:u,currTabLabel:d==null?void 0:d.label}),M&&e.jsx(Ss,{dataList:d.label=="Live"?f:L,showSkeletonLoading:u,currTabLabel:d==null?void 0:d.label})]})}export{te as default};
