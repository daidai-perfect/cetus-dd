import{k as C,j as I,l as L,Y as x,ac as F,am as E,aS as h,d as _,A as v,z as S,a5 as O,b2 as X,W as B,b3 as $,b4 as K}from"./index-ptnn7YYs.js";import{a as q}from"./vendor-DsVemle5.js";import{u as j}from"./useToken-D0Y8EMfE.js";import{a as M}from"./useFavoritePool-BRmN064e.js";import{d as W,c as Y,f as N,e as V}from"./useGetPoolList-BWUJTUb5.js";const U=(c,R)=>({showPosListLength:"",setShowPosListLength:a=>{c(()=>({showPosListLength:a}))},posApiPoolData:{},setPosApiPoolData:a=>{c(()=>({posApiPoolData:a}))},myPosYieldValue:"",setMyPosYieldValue:a=>{c(()=>({myPosYieldValue:a}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:a=>{const k=a.reduce((l,n)=>{var d,i,s;return l[n.clmmPool]||(l[n.clmmPool]={list:[]}),(d=l[n.clmmPool])!=null&&d.tokenA||(l[n.clmmPool].isReverse=n==null?void 0:n.isReverse,l[n.clmmPool].tokenA=n==null?void 0:n.tokenA,l[n.clmmPool].tokenB=n==null?void 0:n.tokenB,l[n.clmmPool].displayTokenA=n==null?void 0:n.displayTokenA,l[n.clmmPool].displayTokenB=n==null?void 0:n.displayTokenB,l[n.clmmPool].clmmPoolAddress=n.clmmPool),(s=(i=l[n.clmmPool])==null?void 0:i.list)==null||s.push(n),l},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",k),c(()=>({posBaseList:a,posBaseListGroupByPool:k,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:a=>{c(()=>({posBaseListLoading:a}))},setPosBaseListIsLoading:a=>{c(()=>({posBaseListLoading:a}))},fullRangePosBaseList:[],setFullRangePosBaseList:a=>{c(()=>({fullRangePosBaseList:a,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:a=>{c(()=>({fullRangePosBaseListLoading:a}))},posPoolsOriginalData:{},setPosPoolOriginalData:a=>{c(()=>({posPoolsOriginalData:a}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:a=>{c(()=>({posPoolsRelatedData:a,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:a=>{c(()=>({posPoolsRelatedDataLoading:a}))},posLiquidityData:{},setPosLiquidityData:a=>{c(()=>({posLiquidityData:a,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:a=>{c(()=>({posLiquidityDataLoading:a}))},posRewardsData:{},setPosRewardsData:a=>{c(()=>({posRewardsData:a,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:a=>{c(()=>({posRewardsDataLoading:a}))},farmsPosRewardsData:{},setFarmsPosRewardsData:a=>{c(()=>({farmsPosRewardsData:a,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:a=>{c(()=>({farmsPosRewardsDataLoading:a}))},posFeeData:{},setPosFeeData:a=>{c(()=>({posFeeData:a,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:a=>{c(()=>({posFeeDataLoading:a}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:a=>{c(()=>({currentPosBaseInfo:a,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:a=>{c(()=>({currentPosBaseInfoLoading:a}))}}),b=C(U);function z(){const{peripherySdk:c}=I(),{getTokenListInfo:R}=j(),{setFarmsPosRewardsData:a,setFarmsPosRewardsDataLoading:k}=b(),l=q.useRef(c);return q.useEffect(()=>{l.current=c},[c.ClmmSDK.senderAddress]),{getFarmsRewardsData:async d=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",d),k(!0);const i=d==null?void 0:d.filter(s=>s.posType==="farms").map(s=>({pool_id:s.farmsPool,position_nft_id:s.id}));try{let s={},t={};if(i&&i.length>0&&(s=await l.current.Farms.calculateFarmingRewards(i),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",s,l.current.ClmmSDK.senderAddress,i),s)){const e=Object.entries(s).map(([o,p])=>({id:o,rewarderAmountOwed:p}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",e);const m=e.map(o=>o.rewarderAmountOwed.map(p=>p.rewarder_type)).flat(),r=await R(m);t=Object.fromEntries(e.map((o,p)=>{for(const w of o.rewarderAmountOwed){const{rewarder_amount:P,rewarder_type:f}=w,g=r==null?void 0:r.get(f);w.display_amount_owed=L(P.toString(),(g==null?void 0:g.decimals)||0),w.amount_owed=P.toString(),w.token=g}return[o.id,o.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",t),a(t)}catch(s){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",s)}}}}function H(){const{setPosApiPoolData:c}=b(),{getFavoritePoolList:R}=M();return{getPosApiPoolData:async k=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",k);const n={needLocalData:!1,pools:Array.from(new Set(k==null?void 0:k.map(s=>s.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",n);const d=await R(n)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",d);const i=d==null?void 0:d.list.reduce((s,t)=>(s[t.poolAddress]=t,s),{});c(i)}catch(l){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",l)}}}}function J(){const{clmmSdk:c}=x(),{setPosFeeData:R,setPosFeeDataLoading:a}=b();return{getPosFeeData:async l=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",l),a(!0);const n=l==null?void 0:l.map(s=>({poolAddress:s.clmmPool,positionId:s.posId,coinTypeA:s.coinTypeA,coinTypeB:s.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",n);const d=await c.Position.fetchPosFeeAmount(n)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",d);const i=Object.fromEntries(d.map((s,t)=>{var o,p;const e=l[t],m=L(e.isReverse?s.feeOwedB.toString():s.feeOwedA.toString(),((o=e==null?void 0:e.displayTokenA)==null?void 0:o.decimals)||0),r=L(e.isReverse?s.feeOwedA.toString():s.feeOwedB.toString(),((p=e==null?void 0:e.displayTokenB)==null?void 0:p.decimals)||0);return[s.position_id,{feeOwedA:s.feeOwedA.toString(),feeOwedB:s.feeOwedB.toString(),displayFeeOwedA:m,displayFeeOwedB:r}]}));console.log("getPosFeeData ~ posFeesData:",i),R(i)}}}function Q(){const{setPosLiquidityData:c,setPosLiquidityDataLoading:R}=b(),a=({tokenA:l,tokenB:n,liquidity:d,currentSqrtPrice:i,lowerTick:s,upperTick:t,roundUp:e})=>{const m=F.tickIndexToSqrtPriceX64(s),r=F.tickIndexToSqrtPriceX64(t),o=E.getCoinAmountFromLiquidity(new h(d),new h(i),m,r,e),p=o.coinA.toString(),w=o.coinB.toString(),P=l.decimals,f=n.decimals,g=L(p,P||0),u=L(w,f||0);return{coinAmountA:p,coinAmountB:w,amountA:g,amountB:u}};return{getPosLiquidityData:async(l,n)=>{R(!0);const d={};for(let i=0;i<l.length;i++){const s=l[i],t=n==null?void 0:n[s.clmmPool],{coinAmountA:e,coinAmountB:m,amountA:r,amountB:o}=a({tokenA:s.tokenA,tokenB:s.tokenB,liquidity:s.liquidity,currentSqrtPrice:t==null?void 0:t.current_sqrt_price,lowerTick:s.lowerTick,upperTick:s.upperTick,roundUp:!0}),p=W(s.lowerTick,s.upperTick),w=s.tokenA.decimals,P=s.tokenB.decimals,f=F.sqrtPriceX64ToPrice(new h(t==null?void 0:t.current_sqrt_price),w,P).toString(),{percentA:g,percentB:u}=Y(r,o,f,p),A=L(e,w),D=L(m,P),T=_(D).div(f).add(A).toString(),y=_(A).mul(f).add(D).toString();d[s.posId]={coinAmountA:e,coinAmountB:m,displayCoinAmountA:s.isReverse?o:r,displayCoinAmountB:s.isReverse?r:o,displayPercentA:s.isReverse?u:g,displayPercentB:s.isReverse?g:u,onlyAmountA:T,onlyAmountB:y}}console.log("getPosLisuidityData ~ posLiquidityData:",d),c(d)},getCoinAmountFromLiquidity:a}}function Z(){const{clmmSdk:c}=x(),{setPosPoolOriginalData:R,setPosPoolsRelatedData:a,setPosPoolsRelatedDataLoading:k,setFullRangePosBaseList:l,setFullRangePosBaseListLoading:n}=b();return{getPosPoolsOriginalObj:async s=>{const t=s==null?void 0:s.map(r=>r.clmmPool),e=[...new Set([...t])];let m={};if(e&&e.length>0){const r=await c.Pool.getPools(e,0,1e3);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",r),m=Object.fromEntries(r==null?void 0:r.map(o=>{const p=s.find(u=>u.clmmPool===(o==null?void 0:o.poolAddress)),w=p.tokenA.decimals,P=p.tokenB.decimals,f=F.sqrtPriceX64ToPrice(new h(o==null?void 0:o.current_sqrt_price),w,P).toString(),g=_(1).div(f).toString();return[o==null?void 0:o.poolAddress,{...o,currentPrice:f,currentPriceReverse:g}]}))}return R(m),m},getPosPoolsRelatedData:(s,t)=>{k(!0),n(!0);const e={},m=[];s.forEach(r=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",r);const o=t[r.clmmPool],p=r.tokenA.decimals,w=r.tokenB.decimals,P=F.sqrtPriceX64ToPrice(new h(o==null?void 0:o.current_sqrt_price),p,w).toString(),f=_(1).div(P).toString();let g="0",u="0";N(r.lowerTick,"min")?g="0":g=F.tickIndexToPrice(Number(r.lowerTick),p,w).toString(),N(r.upperTick,"max")?u="âˆž":u=F.tickIndexToPrice(Number(r.upperTick),p,w).toString();let A,D;u!=="âˆž"?D=_(1).div(_(u)).toString():D="0",g!=="0"?A=_(1).div(_(g)).toString():A="âˆž";let T="";o!=null&&o.is_pause?T="Closed":Number(P)>=Number(g)&&(u==="âˆž"||Number(P)<=Number(u))?T="Active":(Number(P)>Number(u)||Number(P)<Number(g))&&(T="Inactive"),(g==="0"&&u==="âˆž"||A==="0"&&D==="âˆž")&&r.posType==="clmm"&&m.push(r);const y=r.isReverse;e[r.posId]={currentPrice:o?v(y?f:P).toString():"",currentPriceReverse:o?v(y?P:f).toString():"",minPrice:v(y?D:g).toString(),minPriceResever:v(y?g:D).toString(),maxPrice:v(y?A:u).toString(),maxPriceResever:v(y?u:A).toString(),minPriceOrigin:o?y?D:g:"",maxPriceOrigin:o?y?A:u:"",currentStatus:o?T:"",fee:o==null?void 0:o.fee_rate,displayFee:_(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),a(e),l(m)}}}function ee(){const{clmmSdk:c}=x(),{getTokenListInfo:R}=j(),{setPosRewardsData:a,setPosRewardsDataLoading:k}=b();return{getPosRewardsData:async(n,d)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",n),k(!0);const i=n==null?void 0:n.filter(t=>t.posType!=="farms").map(t=>{const e=d[t.clmmPool];return{poolAddress:t.clmmPool,positionId:t.posId,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,rewarderInfo:e.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",i);let s={};if(i&&i.length>0)try{const t=await c.Rewarder.fetchPosRewardersAmount(i),e=t==null?void 0:t.map(r=>r.rewarderAmountOwed.map(o=>o.coin_address)).flat(),m=await R(e);s=Object.fromEntries(t.map((r,o)=>{for(const p of r.rewarderAmountOwed){const{amount_owed:w,coin_address:P}=p,f=m==null?void 0:m.get(P);p.display_amount_owed=L(w.toString(),(f==null?void 0:f.decimals)||0),p.amount_owed=w.toString(),p.token=f}return[r.positionId,r.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",s)}catch(t){console.log("getPosRewardsData ~ error:",t)}a(s)}}}function G(){const c=(d,i)=>{if(i||i==0)return`Cetus LP | Pool${i}-${d}`},R=q.useMemo(()=>`${S.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[S]),a=q.useMemo(()=>`${S.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[S]),k=q.useMemo(()=>`${S.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[S]);return{getClmmPosName:c,buildPositionType:R,buildFarmsPositionType:a,buildBurnPositionType:k,getTokenALock:(d,i)=>{if(O(d)&&O(i)){const{lowerTick:s,upperTick:t}=d,e=i==null?void 0:i.current_tick_index;if(e!==void 0&&s!==void 0&&t!==void 0)return e>=s&&e<t?!1:e>=t?!0:!(e<s)}return!1},getTokenBLock:(d,i)=>{if(O(d)&&O(i)){const{lowerTick:s,upperTick:t}=d,e=i==null?void 0:i.current_tick_index;if(e!==void 0&&s!==void 0&&t!==void 0)return e>=s&&e<t||e>=t?!1:(e<s,!0)}return!1}}}function oe(){const{buildPositionType:c,buildFarmsPositionType:R,buildBurnPositionType:a}=G(),{getTokenListInfo:k}=j(),l=async(t,e)=>{const m=!V(t,e),r=await k([t,e]),o=r==null?void 0:r.get(t),p=r==null?void 0:r.get(e);return{isReverse:m,tokenA:o,tokenB:p,displayTokenA:m?p:o,displayTokenB:m?o:p}},n=async t=>{var u;const e=X(t),m=B(e.coin_type_a).full_address,r=B(e.coin_type_b).full_address,{isReverse:o,tokenA:p,tokenB:w,displayTokenA:P,displayTokenB:f}=await l(m,r),g=((u=t==null?void 0:t.data)==null?void 0:u.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:m,coinTypeB:r,posType:"clmm",tokenName:"",tokenA:p,tokenB:w,displayTokenA:P,displayTokenB:f,isReverse:o,version:g}},d=async t=>{var u;const e=$.buildFramsPositionNFT(t),m=((u=t==null?void 0:t.data)==null?void 0:u.version)||"0",r=B(e.coinTypeA).full_address,o=B(e.coinTypeB).full_address,{isReverse:p,tokenA:w,tokenB:P,displayTokenA:f,displayTokenB:g}=await l(r,o);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"farms",tokenName:e.name,isReverse:p,tokenA:w,tokenB:P,displayTokenA:f,displayTokenB:g,version:m}},i=async t=>{var u,A,D;const e=K.buildBurnPositionNFT((A=(u=t==null?void 0:t.data)==null?void 0:u.content)==null?void 0:A.fields),m=((D=t==null?void 0:t.data)==null?void 0:D.version)||"0",r=B(e.coinTypeA).full_address,o=B(e.coinTypeB).full_address,{isReverse:p,tokenA:w,tokenB:P,displayTokenA:f,displayTokenB:g}=await l(r,o);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"burn",tokenName:e.name,isReverse:p,tokenA:w,tokenB:P,displayTokenA:f,displayTokenB:g,version:m}};return{wrapClmmPosBaseInfo:n,wrapBurnPosBaseInfo:i,wrapFarmsPosBaseInfo:d,buildPosBaseInfo:async t=>{const e=B(t.data.type);return e.full_address===c?await n(t):e.full_address===R?await d(t):e.full_address===a?await i(t):null}}}function ie(){const{clmmSdk:c}=x(),{buildFarmsPositionType:R,buildBurnPositionType:a}=G(),{buildPosBaseInfo:k}=oe(),{setPosBaseList:l,setFullRangePosBaseList:n,setPosBaseListLoading:d}=b(),{getPosPoolsOriginalObj:i,getPosPoolsRelatedData:s}=Z(),{getPosLiquidityData:t}=Q(),{getPosFeeData:e}=J(),{getPosApiPoolData:m}=H(),{getPosRewardsData:r}=ee(),{getFarmsRewardsData:o}=z();return{getPositionBaseList:async(P,f)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",f),d(!0);try{const g=await c.fullClient.getOwnedObjectsByPage(P,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:S.clmm_sdk_options.clmm_pool.package_id},{StructType:R},{StructType:a}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",g);const u=[];for(const T of g.data){const y=await k(T);_(y==null?void 0:y.liquidity).lte(0)||!(y!=null&&y.displayTokenA)||!(y!=null&&y.displayTokenB)||y&&u.push(y)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",u);const A=u.sort((T,y)=>y.version-T.version);let D=[];return f?D=A==null?void 0:A.filter(T=>T.clmmPool===f):D=A,l(D),d(!1),(D==null?void 0:D.length)==0&&n([]),D}catch(g){return console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",g),g instanceof TypeError?(d(!1),l([]),"Something went wrong, please change the rpc node and try again"):""}},getPosRelatedData:async(P,f=!1)=>{var g;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",f,P),o(P),f||(console.log("ðŸš€ ~ getPosRelatedData ~ isFarms:",P),m(P),e(P));try{const u=await i(P);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",u),s(P,u),((g=Object.keys(u))==null?void 0:g.length)>0&&(t(P,u),f||r(P,u))}catch(u){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",u)}}}}export{G as a,ie as b,J as c,ee as d,z as e,Q as f,oe as g,b as u};
//# sourceMappingURL=usePositionList-DPh0B0ja.js.map
