import{u as T}from"./useNotifiAlerts-CXMtDwwp.js";import{E as O,P as x,d as D,V as _,j as B}from"./index-z4pUiXVL.js";import"./vendor-DXHkIl66.js";import{d as j}from"./useXCetusHelper-wRFDNkyC.js";import{a as L,h as v,u as E}from"./usePositionList-B_ysosd0.js";import{u as k}from"./detail-DtzavPik.js";function A(){const{fetchOwnerVeNFT:d}=j(),{showCommonToast:c}=O(),{notifiSources:g}=x();return{createNotifiSubscriptionVerify:async()=>{try{const n=await d();if(n!=null&&n.xcetus_balance){if(D(n.xcetus_balance).div(Math.pow(10,9)).lessThan(1e3))return c("Price alerts are currently open to users who hold 1000+ xCETUS.","rejected"),!1}else return c("Unable to fetch xCetus information.","rejected"),!1;return g.length>=5?(c("Price alerts can only be enabled for up to 5 positions for an account at the same time.","rejected"),!1):!0}catch(n){return console.error("ğŸš€ ~ createNotifiSubscriptionVerify ~ error:",n),c("An error occurred while verifying the subscription.","rejected"),!1}},getPositionNotifiStatus:(n,m)=>{try{const u=g.find(b=>{const{pool_address:P,position_index:p}=JSON.parse(b.blockchainAddress);return P===n&&p===m});return{isSubscription:!!u,alertID:(u==null?void 0:u.alertID)||""}}catch(u){return console.error("ğŸš€ ~ getPositionNotifiStatus ~ error:",u),{isSubscription:!1,alertID:""}}}}}function U(){const{clmmSdk:d}=_(),{posBaseList:c,setCurrentPosBaseInfo:g,setCurrentPosBaseInfoLoading:y}=L(),{setCurPosHistoryList:N,setIsPosHistoryLoading:n}=k(),{buildPosBaseInfo:m}=v(),{getPosRelatedData:u}=E(),b=async(l,t,o=!1)=>{y(!0);const s=c.find(i=>i.id===t);let e;s&&!o?e=s:e=await P(l,t),console.log("getCurrentPosBaseInfo ~ posInfo:",c,e),g(e),e&&u([e])},P=async(l,t)=>{const o=await d.fullClient.getOwnedObjectsByPage(l,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{ObjectId:t}});return o&&o.data&&o.data.length>0?await m(o.data[0]):null},p=async(l,t)=>{var s;const o=["https://mainnet.suiet.app:443","https://rpc-mainnet.suiscan.xyz:443"];for(const e of o)try{const i=await d.Position.getPositionTransactionList({posId:l,fullRpcUrl:e,originPosId:t,order:"descending"});if(console.log("ğŸš€ ~ getCurrentPosHistory ~ response?.data:",i==null?void 0:i.data,e),((s=i==null?void 0:i.data)==null?void 0:s.length)>0)return i.data}catch(i){console.error(`Error fetching data from ${e}:`,i)}return[]};return{getCurrentPosBaseInfo:b,getCurrentPosHistory:async(l,t)=>{console.log("ğŸš€ ~ getCurrentPosHistory ~ posId:",l,t),n(!0);const o=await p(l,t),s=l.toLowerCase()!==t.toLowerCase()?await p(t,t):[];console.log("ğŸš€ ~ getCurrentPosHistory ~ clmmHistory:",o,s,[...o,...s]);const i=[...o,...s].sort((f,a)=>(a==null?void 0:a.timestampMs)-(f==null?void 0:f.timestampMs));N(i),n(!1),console.log("ğŸš€ ~ getCurrentPosHistory ~ result:",i)},getCurrentPosByPosId:P}}function z(){const{getCurrentPosByPosId:d}=U(),{currentAccount:c}=B(),{createNotifiAlert:g,deleteNotifiAlerts:y}=T(),{setIsChecked:N,setNotifiSubscriptionLoading:n,notifiClient:m}=x(),{createNotifiSubscriptionVerify:u,getPositionNotifiStatus:b}=A(),P=async t=>{if(n(!0),!await u())return N(!1),!1;const{subscriptionSource:s,position:e,posIndex:i,events:f}=t;console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:30 ~ notifiSubscription ~ notifiSubscriptionParams:",t);try{if(s=="PositionDetail")p(String(e),String(i));else{const a=f.filter(I=>I.type.indexOf("OpenPositionEvent")>-1)[0],r=f.filter(I=>I.type.indexOf("DepositEvent")>-1)[0],{position:S,pool:H}=a.parsedJson,w=r?r.parsedJson.wrapped_position_id:a.parsedJson.position,C=await d(c==null?void 0:c.address,w);C&&(console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:36 ~ notifiSubscription ~ currentPosInfo.index:",C.index),p(S,String(C.index)))}}catch(a){n(!1),console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:45 ~ notifiSubscription ~ error:",a)}},p=async(t,o)=>{g(t,o)},h=async(t,o,s)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:57 ~ notifiUnSubscription ~ posId:",t),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:58 ~ notifiUnSubscription ~ posIndex:",s);const{alertID:e}=b(t,String(s));e&&y(e)};return{notifiSubscription:P,notifiUnSubscription:h,getNotifiPositionTransfer:(t,o,s)=>{if(o&&o.userState&&o.userState.status=="authenticated"){console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:62 ~ getNotifiPositionTransfer ~ notifiSources:",s);for(let e=0;e<s.length;e++){const{pool_address:i,position_index:f}=JSON.parse(s[e].blockchainAddress);let a=!1,r;for(let S=0;S<t.length;S++){const{posId:H,index:w}=t[S];i==H&&Number(w)==Number(f)&&(a=!0),r={pool_address:i,position_index:f,clmmPool:t[S].clmmPool}}a||h(r==null?void 0:r.pool_address,r==null?void 0:r.clmmPool,r==null?void 0:r.position_index)}}console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiSources:",s),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ posBaseList:",t),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiClient:",o.us)}}}export{U as a,A as b,z as u};
//# sourceMappingURL=useNotifiSubscription-DEm03jwr.js.map
