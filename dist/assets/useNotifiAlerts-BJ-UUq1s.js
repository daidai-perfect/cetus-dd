import{U as N,H as V}from"./index-DOpwe9u0.js";import"./vendor-BowHGuwE.js";function v(){const{notifiClient:a}=N(),{setDefaultTargetGroup:p,setEmailTarget:T,setTelegramTarget:A,setSmsTarget:m,setNotifiLoginLoading:u}=N(),c=t=>{t.emailTargets&&t.emailTargets.length>0&&T(t.emailTargets.slice(-1)[0]),t.telegramTargets&&(t==null?void 0:t.telegramTargets.length)>0&&A(t.telegramTargets.slice(-1)[0]),t.smsTargets&&(t==null?void 0:t.smsTargets.length)>0&&m(t.smsTargets.slice(-1)[0])};return{getNotifiTargetGroups:async t=>{try{const o=t?await t.getTargetGroups():await a.getTargetGroups();if(console.log("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:8 ~ getNotifiTargetGroups ~ targetGroup:",o),(o==null?void 0:o.length)>0){const n=o[0];console.log("ðŸš€ðŸš€ðŸš€ ~ First target group:",n),c(n)}return p(o),o}catch(o){return console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:20 ~ getNotifiTargetGroups ~ error:",o),{}}},ensureTargetGroup:async t=>{try{u(!0);const o={...t},n=await a.ensureTargetGroup({name:"Default",...o});n!=null&&n.id&&c(n),p([n]),u(!1)}catch(o){u(!1),console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:45 ~ ensureTargetGroup ~ error:",o)}}}}function F(){const{notifiClient:a}=N(),{defaultTargetGroup:p,setNotifiAlerts:T,setNotifiSourceGroups:A,setNotifiSources:m,setIsChecked:u,setNotifiSubscriptionLoading:c}=N(),{showCommonToast:f}=V(),{getNotifiTargetGroups:h}=v(),t=async r=>{let s=p.filter(i=>i.name==="Default");return s.length||(s=(await h(r)).filter(i=>i.name==="Default")),s[0]},o=(r,s)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:18 ~ useNotifiAlert ~ alerts:",r);const i=[],l=[],g=[];r.forEach(e=>{var S,y;console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:41 ~ useNotifiAlert ~ alert:",e.subscriptionValue);const d=(e==null?void 0:e.subscriptionValue)!==null&&(e==null?void 0:e.subscriptionValue)!=="*"?JSON.parse(e==null?void 0:e.subscriptionValue):null;((y=(S=e==null?void 0:e.sourceGroup)==null?void 0:S.name)!=null&&y.includes("position")||e.name.includes("Position Range Alerts"))&&e.name!=="Fusion Source Filter"&&e.name!=="defaultAlert"&&(i.push(e==null?void 0:e.sourceGroup),d!==null&&l.push({...d,alertID:e.id,alertName:e.name})),g.push({...d,alertID:e.id,alertName:e.name})}),console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:38 ~ useNotifiAlert ~ allSource:",g);const b=g.some(e=>e.alertName==="defaultAlert");return console.log("ðŸš€ðŸš€ðŸš€ ~ useNotifiAlerts.ts:51 ~ handleAlertSource ~ hasDefaultSource:",b),b||D(s),{sourceGroup:i,sources:l}},n=async r=>{try{const s=r?await r.getAlerts():await a.getAlerts();console.log("ðŸš€ ~ getNotifiAlerts ~ alerts:",s);const{sourceGroup:i,sources:l}=o(s,r||a);T(s),A(i),m(l),c(!1)}catch(s){console.error("ðŸš€ ~ getNotifiAlerts ~ error:",s)}},G=async r=>{console.log("ðŸš€ ~ deleteNotifiAlerts ~ id:",r);try{await a.deleteAlert({id:r}),f("Unsubscribed","success","You'll no longer receive alerts when the price goes out of range."),n(),c(!1)}catch(s){console.error("ðŸš€ ~ deleteNotifiAlerts ~ error:",s),f("There was an error unsubscribe alert","rejected",String(s)),c(!1)}},w=async(r,s)=>{try{const i=await t(),l={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:r&&s?`Position Range Alerts${new Date().getTime()}`:"defaultAlert",targetGroupId:i.id,subscriptionValue:r&&s?JSON.stringify({pool_address:r,position_index:String(s)}):"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]},g=await a.ensureFusionAlerts(l);console.log("ðŸš€ ~ createNotifiAlert ~ alerts:",g),f("Subscribed to Alerts!","success","Verify your notification channels to receive alerts when the price goes out of range. To edit your alert settings, click the bell icon in the top nav."),n()}catch(i){console.error("ðŸš€ ~ createNotifiAlert ~ error:",i),f("There was an error subscribe alert","rejected",String(i)),u(!1),c(!1)}},D=async r=>{try{const i={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:"defaultAlert",targetGroupId:(await t(r)).id,subscriptionValue:"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]};await r.ensureFusionAlerts(i),n()}catch(s){console.error("ðŸš€ ~ initDefaultAlert ~ error:",s)}};return{getNotifiAlerts:n,createNotifiAlert:w,deleteNotifiAlerts:G}}export{v as a,F as u};
//# sourceMappingURL=useNotifiAlerts-BJ-UUq1s.js.map
