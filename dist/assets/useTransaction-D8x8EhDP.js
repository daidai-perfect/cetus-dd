import{a as q,B as ae,c as J}from"./vendor-BFGDaAdA.js";import{bw as re,j as P,bq as se,aI as ce,d as Q,c9 as ie,ca as de,cb as fe,k as ue,A as le,e as be,bL as ge,by as xe,cc as he,cd as Te,ce as me}from"./index-QNvgVKlA.js";import{u as Se,t as we}from"./useTrack-DgiixkZ_.js";import{u as ee}from"./useSigner-NhmhdGMF.js";function pe(t){try{return t&&t.includes("user")&&t.includes("reject")}catch{return!1}}function Ie(t){const e=String(t);return e.indexOf('Some("create_pool_internal")')>-1&&e.indexOf(" }, 1")>-1}function Ee(t){const e=String(t);return e.indexOf("withdraw_with_proof")>-1||e.indexOf("check_coin_threshold")>-1||e.indexOf('Identifier("balance")')>-1||e.indexOf("remove_liquidity")>-1&&(e.indexOf("in command 1")>-1||e.indexOf("in command 2")>-1||e.indexOf("in command 4")>-1||e.indexOf("in command 5")>-1)||e.indexOf("repay_add_liquidity")>-1&&(e.indexOf("in command 1")>-1||e.indexOf("in command 2")>-1||e.indexOf("in command 3")>-1||e.indexOf("in command 4")>-1||e.indexOf("in command 5")>-1)}function je(t){return!!String(t).includes("Could not find the referenced transaction")}function ve(t){return!!String(t).includes("TRPCClientError:")}function Ce(t){const e=t.status,n=String(t);return!!([429,503,502,400].includes(e)||n.includes("Could not find the referenced object"))}function ke(t){return!!String(t).includes("Max cap reached.")}function Me(t){return!!String(t).includes("Fast Mode service error")}function _e(t){return!!String(t).includes("The current operation does not support msafe wallet")}function Be(t){return String(t).indexOf("hard_cap_reached")>-1}const ye=[{matcher:pe,message:"User rejected the request"},{matcher:je,message:"Oops. Failed to sync data from your txid. Please check your txn status from explorer or from your wallet."},{matcher:ve,message:t=>String(t).split(":")[1]},{matcher:Ce,message:"RPC loading failed. Try resubmission or check your network. You can also switch an RPC in settings to try again."},{matcher:ke,message:"Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed."},{matcher:Me,message:"Fast Mode service error, please switch to the Default Transaction Mode or try again later."},{matcher:_e,message:"The current operation does not support msafe wallet."},{matcher:t=>String(t).includes("Transaction validator signing failed"),message:"Oops. Failed to pull your txid. Please check your txn status from explorer or from your wallet."},{matcher:Ee,message:"Exceeded price slippage"},{matcher:Ie,message:"Pool already exists"},{matcher:Be,message:"Deposit Exceeds Cap"}];function Fe(t){for(const{matcher:e,message:n}of ye)if(e(t))return typeof n=="function"?n(t):n;return"Transaction failed"}function Oe(){const{setTransactionData:t,setTransactionModalVisible:e,manualCloseIdList:n}=re(),o=q.useRef(n);q.useEffect(()=>{o.current=n},[n]);const s=r=>{if(r){const g=o.current.includes(r);return g&&e(!1),g}return!1};return{transactionConfirmation:r=>{s(r.transactionId)||(t({...r,status:"confirmation"}),e(!0))},transactionSubmitted:r=>{s(r.transactionId)||(e(!1),t({...r,status:"submitted"}),e(!0))},transactionSuccess:r=>{s(r.transactionId)||(e(!1),t({...r,status:"success"}),e(!0))},transactionRejected:(r,g=n)=>{console.log("ðŸš€ ~ file: useTransactionModal.ts:10 ~ useTransactionModal ~ id 55:",n),!s(r.transactionId)&&(e(!1),t({...r,status:"rejected"}),e(!0))},closeTransactionModal:()=>{e(!1)}}}const Ae="0x2::sui::SUI",De="https://rpc.getshio.com/fast",Re="0x1889977f0fb56ae730e7bda8e8e32859ce78874458c74910d36121a81a615123",Z=[{objectId:"0xc32ce42eac951759666cbc993646b72387ec2708a2917c2c6fb7d21f00108c18",version:72869622},{objectId:"0x0289acae0edcdf1fe3aedc2e886bc23064d41c359e0179a18152a64d1c1c2b3e",version:327637282},{objectId:"0x03132160e8c2c45208abf3ccf165e82edcc42fee2e614afe54582f9740a808b8",version:327637282},{objectId:"0x072ae7307459e535379f422995a0d10132f12a3450298f8cf0cc07bd164f9999",version:327637282},{objectId:"0x1c1a96a2f4a34ea09ab15b8ff98f4b6b4338ce89f4158eb7d3eb2cd4dcbd6d86",version:327637282},{objectId:"0x20d76f37ad9f2421a9e6afaf3bb204250b1c2241c50e8a955e86a1a48767d06f",version:327637282},{objectId:"0x213ed368233cc7480fcb6336e70c5ae7ee106b2317ba02ccb5d0478e45bcc046",version:327637282},{objectId:"0x22ce1e80937354eba5549fed2937dc6e2b24026d03505bb51a3e4a64aa4142f6",version:327637282},{objectId:"0x26188cb7ce5ae633279f440f66081cb65cc585e428de18e194f8843e866f799f",version:327637282},{objectId:"0x38642f01422480128388d3e2948d3dc1b2680f9914077edb6bd3451ae1c5bcf0",version:327637282},{objectId:"0x3dd85b6424aea1cae9eff6e55456ca783e056226325f1362106eca8b3ed04ca0",version:327637282},{objectId:"0x42f8adc490542369d9c3b95e9f6eb70b2583102900feb7e103072ed49ba7fc3d",version:327637282},{objectId:"0x46b8158c82fa6bda7230d31a127d934c7295a0042083b4900f3096e9191f6f3f",version:327637282},{objectId:"0x6ebac88a8c3f7a4a9fb05ea49d188a1fe8520ae59ee736e0473004d3033512a4",version:327637282},{objectId:"0x6f55ad6cb40cfc124c11b11c19be0a80237b104acd955e7b52ccb7bf9046fe33",version:327637282},{objectId:"0x71aafb8bac986e82e5f78846bf3b36c2a82505585625207324140227a27ff279",version:327637282},{objectId:"0x7fe9b08680d4179de5672f213b863525b21f10604ca161538075e9338d1d2324",version:327637282},{objectId:"0x81538ef2909a3e0dd3d7f38bcbee191509bae4e8666272938ced295672e2ee8d",version:327637282},{objectId:"0x828eb6b3354ad68a23dd792313a16a0d888b7ea4fdb884bb22bd569f8e61319e",version:327637282},{objectId:"0x9705a332b8c1650dd7fe687ef9f9a9638afb51c30c0b34db150d60b920bc07eb",version:327637282},{objectId:"0x9918f73797a9390e9888b55454f2b31bc01de1a4634acab08f80641c4248e8a5",version:327637282},{objectId:"0x9cd4c08bdf2e132ec2cc77b0f03be60a94951e046d8e82ed5494f44e609edd2f",version:327637282},{objectId:"0xac8ce2033571140509788337c8a1f3aa8941a320ecd7047acda310d39cad9e03",version:327637282},{objectId:"0xbcd4527035265461a9a7b4f1e57c63ea7a6bdf0dc223c66033c218d880f928b1",version:327637282},{objectId:"0xbfdb691b8cc0b3c3a3b7a654f6682f3e53b164d9ee00b9582cdb4d0a353440a9",version:327637282},{objectId:"0xc2559d5c52ae04837ddf943a8c2cd53a5a0b512cee615d30d3abe25aa339465e",version:327637282},{objectId:"0xc56db634d02511e66d7ca1254312b71c60d64dc44bf67ea46b922c52d8aebba6",version:327637282},{objectId:"0xc84545cbff1b36b874ab2b69d11a3d108f23562e87550588c0bda335b27101e0",version:327637282},{objectId:"0xcc141659b5885043f9bfcfe470064819ab9ac667953bcedd1000e0652e90ee76",version:327637282},{objectId:"0xef6bf4952968d25d3e79f7e4db1dc38f2e9d99d61ad38f3829acb4100fe6383a",version:327637282},{objectId:"0xf2ed8d00ef829de5c4a3c5adf2d6b0f41f7fec005fb9c88e5616b98173b2fd66",version:327637282},{objectId:"0xfce73f3c32c3f56ddb924a04cabd44dd870b72954bbe7c3d7767c3b8c25c4326",version:327637282}];async function Le(t){const e=t.client,n=await t.transaction.build({client:e,onlyTransactionKind:!0});let o=t.sender??t.transaction.getData().sender;if(!o)throw new Error("Sender need to be either set in options or in transaction data");return await e.call("shio_estimateFastModeFee",[o,t.transaction.getData().gasData.price,ae.from(n).toString("base64")])}function Ue(){return Z[Math.floor(Math.random()*Z.length)]}async function We(t,e,n){return await t.executeTransactionBlock({transactionBlock:e.bytes,signature:e.signature,options:n})}async function Ne(t,e,n){let o=t.moveCall({package:"0x2",module:"coin",function:"into_balance",typeArguments:[Ae],arguments:[e]});return Ye(t,o,n)}async function Ye(t,e,n){let o=Ue();t.moveCall({package:Re,module:"auctioneer",function:"submit_bid",arguments:[t.sharedObjectRef({objectId:o.objectId,mutable:!0,initialSharedVersion:o.version}),t.pure.u64(n),e]})}function qe(){const{signTransactionBlock:t}=ee(),{currentAccount:e}=P(),n=async(o,s,u)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useFastModeTransaction.ts:12 ~ getFastModeTx ~ getFastModeTx:",n);let T,j,w;try{const h=new se({url:De});o.setSender(e==null?void 0:e.address),o.setGasPrice(Number(u));let r;try{r=ce.from(o),r!=null&&r.blockData&&console.log("ðŸš€ ~ getFastModeTx ~ ntx?.blockData:",r==null?void 0:r.blockData)}catch{r=o}const g=await Le({transaction:r,client:h}),A=Q(s).mul(Math.pow(10,9)).toString();if(Q(g.gasBudget).gt(A))throw Error("Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed.");o.setGasBudget(g.gasBudget),console.log(g);const B=o.splitCoins(o.gas,[g.tipAmount]);Ne(o,B[0],g.tipAmount);const D=await o.build({client:h}),v=await t(D);console.log("ðŸš€ ~ file: useTransaction.tsx:94 ~ useTransaction ~ signTx:",v);const{bytes:M,signature:H}=v;w=M,console.log("ðŸš€ ~ getFastModeTx ~ signTx:",v),j=new Date().getTime(),T=await We(h,v,{showEffects:!0,showEvents:!0}),console.log("ðŸš€ ~ getFastModeTx ~ result:",T)}catch(h){throw console.log("ðŸš€ ~ getFastModeTx ~ error:",h),console.log("ðŸš€ ~ getFastModeTx ~ String(error).includes(Failed to fetch):",String(h).includes("Failed to fetch")),String(h).includes("Failed to fetch")?Error("Fast Mode service error"):h}return{result:T,startExecuteTime:j,transactionBlockBytes:w}};return{getFastModeTx:n}}function Ge(){const t=ie(),e=de(),n=q.useMemo(()=>{if(!t.currentWallet)return null;const s=t.currentWallet.features["sui:signAndExecuteTransactionBlock"];return s?s.signAndExecuteTransactionBlock:null},[t]);return{getMsafeRes:async(s,u)=>{if(!e||!n)throw new Error("No account information");return s.setSender(e==null?void 0:e.address),await n({transactionBlock:s,account:e,chain:e==null?void 0:e.chains[0],action:u==null?void 0:u.action,txbParams:u==null?void 0:u.txbParams})}}}var G={},He=J&&J.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G,"__esModule",{value:!0});var Ve=G.executeAuction=te;const Ke=He(fe),Xe="https://rpc.getshio.com",$e=500,ze=300;function te(t,e,n=$e){const o={jsonrpc:"2.0",method:"shio_executeAuction",params:[t,e],id:1};return new Promise((s,u)=>{setTimeout(s,n),Ke.default.post(Xe,o,{headers:{"Content-Type":"application/json"},timeout:n}).then(T=>{console.log("Shio executeAuction response:",T.data),setTimeout(s,ze)}).catch(u)})}G.default={executeAuction:te};function et(){const{signTransactionBlock:t,executeTransactionBlock:e,signAndExecuteTransactionBlock:n}=ee(),{currentAccount:o}=P(),s=ue("clmm"),{transactionConfirmation:u,transactionSubmitted:T,transactionSuccess:j,transactionRejected:w,closeTransactionModal:h}=Oe(),{submittedTsToast:r,failedTsToast:g,successTsToast:A,closeToast:B}=le();be();const{getFastModeTx:D}=qe(),{getMsafeRes:v}=Ge(),{trackSwap:M}=Se(),H=5,V=2e3;async function R(c,a=1){console.log("ðŸš€ ~ file: useTransaction.tsx:24 ~ getTransactionStatus ~ Checking transaction status, attempt:",a);try{let i;try{i=await s.FullClient.getTransactionBlock({digest:c,options:{showEvents:!0,showEffects:!0,showBalanceChanges:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0}})}catch{i=await s.FullClient.getTransactionBlock({digest:c,options:{showEvents:!0,showEffects:!0}})}if(console.log("ðŸš€ ~ file: useTransaction.tsx:28 ~ getTransactionStatus ~ response:",i),i)return i;throw new Error("Empty response")}catch(i){if(console.error(`Attempt ${a} failed:`,i),a>=H)throw new Error("Failed to fetch transaction status after maximum retries.");return await ge(V),R(c,a+1)}}const ne=async(c,a,{useDevInspect:i=!1,useMev:b=!1,txAction:p="signTransactionBlock",showSuccessModal:oe=!0,useFastMode:C=!1,maxCapForGas:U="",customGasPrice:W="",msafeParams:m,otherParams:y}={})=>{var K,X,$,z;console.log("ðŸš€ ~ useTransaction ~ msafeParams:",m),console.log("ðŸš€ ~ useTransaction ~ otherParams:",y),console.log("ðŸš€ ~ file: useTransaction.tsx:76 ~ useTransaction ~ option:",{useDevInspect:i,useMev:b,txAction:p,tx:c,toastType:a,useFastMode:C,maxCapForGas:U,customGasPrice:W,msafeParams:m});const F=a.transactionId?a.transactionId:new Date().getTime().toString();a.transactionId=F,u(a);const N=(m==null?void 0:m.action)==="AggregatorSwap";let x="";try{let d,k,I;typeof c=="function"?I=await c():I=c,I.setSender(o==null?void 0:o.address);let _;if(C&&U&&W){console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:135 ~ useTransaction ~ res:");const l=await D(I,U,W);d=l.result,_=l.startExecuteTime,k=l.transactionBlockBytes}else if((K=xe)!=null&&K.inMSafeWallet())if(m)d=await v(I,m);else throw Error("The current operation does not support msafe wallet");else if(p==="signTransactionBlock"){const l=await t(I);_=new Date().getTime(),console.log("ðŸš€ ~ file: useTransaction.tsx:94 ~ useTransaction ~ signTx:",l);const{bytes:S,signature:E}=l;if(k=l.bytes,b)try{const O=await Ve(S,E,500);console.log("ðŸš€ ~ file: useTransaction.tsx:92 ~ useTransaction ~ shioRes: success",O)}catch(O){console.log("ðŸš€ ~ file: useTransaction.tsx:95 ~ useTransaction ~ shioRes : error:",O)}console.log("ðŸš€ ~ useTransaction ~ useMev:",b),d=await e(S,E,i),console.log("ðŸš€ ~ useTransaction ~ response:",d)}else d=await n(I,i);if(x=d==null?void 0:d.digest,console.log("ðŸš€ ~ file: useTransaction.tsx:24 ~ signAndExecuteTransaction ~ response:",d),!x&&k){const l=he(k);x=Te.getDigestFromBytes(l)}a.tx=x,T(a),a.isSwapWidget||r(a),B(F);let f;if(((X=d==null?void 0:d.effects)==null?void 0:X.status.status)==="success"?f=d:(console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:191 ~ useTransaction ~ digest:",x),f=await R(x,0)),!f||(($=f.effects)==null?void 0:$.status.status)==="failure"){const l=L(a,(z=f.effects)==null?void 0:z.status.error);N&&M({...y,useMev:b,useFastMode:C},l,x)}else{if(_){const S=new Date().getTime(),E=(f==null?void 0:f.timestampMs)||0,Y=(E&&Number(E)>_?Math.min(S,Number(E)):S)-_;console.log("ðŸš€ ~ useTransaction ~ executeTime:",Y),Y<1e3&&(a.executeTime=Y)}const l=me(f,o==null?void 0:o.address,!1);if(console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:165 ~ useTransaction ~ res:",f),console.log("ðŸš€ ~ file: useTransaction.tsx:48 ~ signAndExecuteTransaction ~ balanceChanges:",l),a.getShowInfo){const S=a.getShowInfo("success",l,f);a.getShowInfo=E=>S}if(oe?j(a):h(),a.isSwapWidget||(a.transactionId=void 0,A(a)),f&&!f.digest&&x&&(f.digest=x),m)try{we(m.action,C||b,x)}catch(S){console.log("ðŸš€ ~ useTransaction ~ trackShioEvent error:",S)}return N&&M({...y,useMev:b,useFastMode:C},"",x),f}}catch(d){console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:253 ~ useTransaction ~ error:",d),F&&B(F);const k=L(a,d);N&&M({...y,useMev:b,useFastMode:C},k,x)}},L=(c,a)=>{const i=Fe(a);if(console.error("ðŸš€ ~ file: useTransaction.tsx:270 ~ handleError ~ error:",{error:a,errorString:i}),c.getShowInfo){const b=c.getShowInfo("rejected");c.getShowInfo=p=>(b.toastDescriptionContent=i,b.modalDescriptionText=i,b),w(c),c.isSwapWidget||g(c)}else c.getShowInfo=b=>{const p={};return p.toastDescriptionContent=i,p.modalDescriptionText=i,p},w(c),c.isSwapWidget||g(c);return i};return{signAndExecuteTransaction:ne,transactionSuccess:j,getTransactionStatus:R,transactionConfirmation:u,transactionRejected:w,handleError:L}}export{Oe as a,et as u};
//# sourceMappingURL=useTransaction-D8x8EhDP.js.map
