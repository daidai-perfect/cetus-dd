import{a as p,j as e,X as fe,Y as xe,Z as me,$ as pe,a8 as he,a0 as Ce,a1 as be,V,H as E,T as O,v as te,f as ae,a2 as ge,a3 as Se,a4 as we,a5 as Te}from"./vendor-BulRdKUe.js";import{u as N}from"./useTransaction-CEDCgy0u.js";import{j as A,k as P,as as D,w as j,d as Y,t as ee,C as Z,M as Q,p as se,i as ye,B as oe,am as re,a as ve,c as $,v as ke,n as Ie,aY as je,aZ as Me,aR as De,al as Re,ar as _e,a0 as K,aK as Le}from"./index-C9eB4n05.js";import{M as W}from"./msafe-oYBkW7LJ.js";import{u as F}from"./useAccountBalance-CS3ca8rH.js";import{u as ce}from"./useTokenBalance-BoTga07n.js";import{u as q,d as H,e as ie,f as Oe,g as Ae,h as Pe}from"./useXCetusHelper-Dj67W-Ua.js";import{T as le}from"./TradeInputGroup-BNI7CpwJ.js";import{H as Ue}from"./HTextLabelBox-CRyapKB_.js";import{C as Xe}from"./CheckBox-C-vSoIAm.js";import{H as Ee}from"./HighlightText-Uv5QOqtT.js";import{u as Fe}from"./activeOrders-B_DQ4Rr1.js";const st=(x,c,l="seconds")=>{const o=()=>{const t=x-new Date().getTime();if(t<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const r=Math.floor(t/1e3%60),f=Math.floor(t/1e3/60%60),n=Math.floor(t/(1e3*60*60)%24),a=Math.floor(t/(1e3*60*60*24)%30),C=Math.floor(t/(1e3*60*60*24*30)%12),b=Math.floor(t/(1e3*60*60*24*365));return l==="days"?{years:0,months:0,days:a+C*30+b*365,hours:n,minutes:f,seconds:r}:l==="months"?{years:0,months:C+b*12,days:a,hours:n,minutes:f,seconds:r}:{years:b,months:C,days:a,hours:n,minutes:f,seconds:r}},[s,u]=p.useState(o());return p.useEffect(()=>{const i=setInterval(()=>{const t=o();u(t),t.years===0&&t.months===0&&t.days===0&&t.hours===0&&t.minutes===0&&t.seconds===0&&(clearInterval(i),c&&c())},1e3);return()=>clearInterval(i)},[x]),s};function Be(){const{fetchAccountBalance:x}=F(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:l}=N(),{currentAccount:o}=A(),{fetchOwnerVeNFT:s}=H(),{xCetusSdk:u}=P(),{veNFT:i}=D(),[t,r]=p.useState(""),[f,n]=p.useState(""),{balanceInfo:a}=ce(j.cetus_coin),C=d=>{r(d),n(d)},[b,T]=p.useState(!1),w=async()=>{try{T(!0);const d={venft_id:i==null?void 0:i.id,amount:ee(t,9).toFixed(0)},k=await u.XCetusModule.convertPayload(d),R=await l(k,{getShowInfo:M=>{const y=`Converting ${Z(t)} CETUS to ${Z(t)} xCETUS`,_={modalTitleText:"Convert",modalDescriptionText:y,toastDescriptionContent:y};if(M==="success"){const L=y.replace("Converting","Converted");_.modalDescriptionText=L,_.toastDescriptionContent=L}return _}},{msafeParams:{action:W.xCETUSConvert,txbParams:d}});T(!1),R&&(o&&s(o==null?void 0:o.address,!0),r(""),n(""),setTimeout(()=>{x()},2e3),c())}catch{T(!1)}},v=p.useMemo(()=>{const d={text:"Convert",disabled:!1};return o!=null&&o.address?+t?(+t&&Y(t).gt((a==null?void 0:a.balanceFormat)||0)&&(d.disabled=!0,d.text="Insufficient CETUS Balance"),d):(d.text="Enter an amount",d.disabled=!0,d):(d.text="Connect Wallet",d.disabled=!1,d)},[a==null?void 0:a.balanceFormat,o==null?void 0:o.address,t]);return{inputAmountFrom:t,inputAmountTo:f,handleInputChange:C,balanceInfoFrom:a,convertLoading:b,btnText:v.text,btnDisabled:v.disabled,handleConvertClick:w}}function de(x){const{isOpen:c,onClose:l,onSubmitClick:o}=x,{setShowConvertModel:s}=D(),[u,i]=p.useState(!1);return e.jsxs(fe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:c,onClose:l,isCentered:!0,children:[e.jsx(xe,{}),e.jsxs(me,{children:[e.jsx(pe,{children:e.jsx(he,{fontWeight:"500",fontSize:"16px"})}),e.jsx(Ce,{}),e.jsx(be,{textAlign:"center",p:"0px",children:e.jsxs(V,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[e.jsx(Ee,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),e.jsxs(E,{children:[e.jsx(Xe,{checked:u,onClick:()=>{i(!u)}}),e.jsx(O,{color:"text_caption",children:"Do not remind again."})]}),e.jsx(te,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{s(!u),o()},children:"Convert"})]})})]})]})}function ot(x){const{availableXCetusAmount:c,iconParams:l,onIconClick:o,onClose:s}=x,{currentAccount:u,onWalletModal:i}=A(),{inputAmountFrom:t,inputAmountTo:r,handleInputChange:f,balanceInfoFrom:n,btnText:a,btnDisabled:C,handleConvertClick:b,convertLoading:T}=Be(),{showConvertModel:w}=D(),[v,d]=p.useState(!1);return e.jsxs(V,{w:"100%",gap:"8px",children:[e.jsx(le,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(n==null?void 0:n.balanceFormat)||"",value:t,amountValue:"",loading:!1,onChange:k=>{f(k)},selectable:!1,placeholder:"0.0",token:j.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:Q(c,9),value:r,half:!1,max:!1,amountValue:"",onChange:k=>{f(k)},selectable:!1,placeholder:"0.0",token:j.x_cetus_coin},iconParams:l}),e.jsx(te,{w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:C||T,isLoading:T,onClick:()=>{console.log(u,w,"showConvertModel"),u?w?d(!0):b().then(()=>{s&&s()}):i(!0)},children:a}),v&&e.jsx(de,{isOpen:v,onClose:()=>{d(!1)},onSubmitClick:()=>{d(!1),b().then(()=>{s&&s()})}})]})}function Ve(x){const{fetchAccountBalance:c}=F(),{fetchOwnerLockCetusList:l}=q(),{signAndExecuteTransaction:o}=N(),{currentAccount:s}=A(),{fetchOwnerVeNFT:u}=H(),{xCetusSdk:i}=P(),{veNFT:t}=D(),[r,f]=p.useState(""),[n,a]=p.useState(""),[C,b]=p.useState(180),[T,w]=p.useState(""),[v,d]=p.useState(!0),{balanceInfo:k}=ce(j.cetus_coin),R=(h,I)=>{d(I),I?f(h):a(h),y(h,I,C)},M=h=>{b(h),y(v?r:n,v,h)},y=async(h,I,U)=>{if(+h){const X=ee(h,9);if(I){const g=await i.XCetusModule.redeemNum(X,U);a(Q(g.amount_out,9)),w(Y(g.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const g=await i.XCetusModule.reverseRedeemNum(X,U);f(Q(g.amount_out,9)),w(Y(g.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else f(""),a(""),w("")},[_,L]=p.useState(!1),J=async()=>{if(!t)return;L(!0);const h={venft_id:t.id,amount:ee(r,9).toFixed(0),lock_day:C},I=i.XCetusModule.redeemLockPayload(h),U=await o(I,{getShowInfo:X=>{const g=`Redeeming ${Z(r)} xCETUS to ${Z(n)} CETUS`,B={modalTitleText:"Redeem",modalDescriptionText:g,toastDescriptionContent:g};if(X==="success"){const m=g.replace("Redeeming","Redeemed");B.modalDescriptionText=m,B.toastDescriptionContent=m}return B}},{msafeParams:{action:W.xCETUSRedeemLock,txbParams:h}});L(!1),U&&(s&&u(s==null?void 0:s.address,!0),f(""),a(""),c(),l())},G=p.useMemo(()=>{const h={text:"Redeem",disabled:!1};return s!=null&&s.address?+r?(+r&&Y(r).gt(x||0)&&(h.disabled=!0,h.text="Insufficient xCETUS Balance"),h):(h.text="Enter an amount",h.disabled=!0,h):(h.text="Connect Wallet",h.disabled=!1,h)},[x,s==null?void 0:s.address,r]);return{inputAmountFrom:r,inputAmountTo:n,handleInputChange:R,balanceInfoTo:k,convertLoading:_,btnText:G.text,btnDisabled:G.disabled,handleConvertClick:J,day:C,handleDayChange:M,percent:T}}function Ne(x){const{day:c,onChange:l}=x,o=p.useMemo(()=>`${c}D`,[c]),s=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return e.jsxs(ae,{children:[e.jsxs(E,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[e.jsxs(O,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[c," Days"]}),e.jsx(ye,{type:"outlineTab",tabList:s,currentTab:o,handleChangeTab:u=>{u.label==="MAX"?l(100):l(u.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),e.jsxs(ge,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(c),onChange:u=>l(u),children:[e.jsx(Se,{h:"8px",children:e.jsx(we,{h:"4px"})}),e.jsx(Te,{})]})]})}function at(x){const{availableXCetusAmount:c,iconParams:l,onIconClick:o,onClose:s}=x,{currentAccount:u,onWalletModal:i}=A(),{inputAmountFrom:t,inputAmountTo:r,handleInputChange:f,balanceInfoTo:n,btnText:a,btnDisabled:C,handleConvertClick:b,day:T,handleDayChange:w,percent:v,convertLoading:d}=Ve(c),{showConvertModel:k}=D(),[R,M]=p.useState(!1);return e.jsxs(V,{w:"100%",gap:"8px",children:[e.jsx(le,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:c,value:t,amountValue:"",loading:!1,onChange:y=>{f(y,!0)},selectable:!1,placeholder:"0.0",token:j.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(n==null?void 0:n.balanceFormat)||"",value:r,half:!1,max:!1,amountValue:"",onChange:y=>{f(y,!1)},selectable:!1,placeholder:"0.0",token:j.cetus_coin},iconParams:l}),e.jsxs(oe,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(O,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),e.jsx(Ne,{day:T,onChange:y=>{w(Number(y))}})]}),e.jsx(oe,{borderRadius:"12px",p:"0px",border:"none",children:e.jsxs(V,{w:"100%",gap:"20px",children:[e.jsx(te,{mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:C||d,isLoading:d,onClick:()=>{u?k?M(!0):b().then(()=>{s&&s()}):i(!0)},children:a}),+v&&e.jsx(E,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:e.jsx(Ue,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:re(v),valueStyle:{fontSize:"14px"}})})]})}),R&&e.jsx(de,{isOpen:R,onClose:()=>{M(!1)},onSubmitClick:()=>{M(!1),b().then(()=>{s&&s()})}})]})}function rt(){const{fetchAccountBalance:x}=F(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:l}=N(),{xCetusSdk:o}=P(),{veNFT:s}=D(),{fetchOwnerVeNFT:u}=H(),{currentAccount:i}=A(),[t,r]=p.useState(!1);return{handleCancelOrder:async n=>{if(!s)return;r(!0);const a={venft_id:s.id,lock_id:n.id},C=o.XCetusModule.cancelRedeemPayload(a),b=await l(C,{},{msafeParams:{action:W.xCETUSCancelRedeem,txbParams:a}});r(!1),b&&(x(),c(),i&&u(i==null?void 0:i.address,!0))},cancelOrderLoading:t}}function ct(){const{fetchAccountBalance:x}=F(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:l}=N(),{xCetusSdk:o}=P(),{veNFT:s}=D(),{fetchOwnerVeNFT:u}=H(),{currentAccount:i}=A(),[t,r]=p.useState(!1);return{handleClaimOrder:async n=>{if(r(!0),!s)return;const a={lock_id:n,venft_id:s.id},C=await o.XCetusModule.redeemPayload(a),b=await l(C,{},{useDevInspect:!1,msafeParams:{action:W.xCETUSRedeem,txbParams:a}});r(!1),b&&setTimeout(()=>{x(),c(),i&&u(i==null?void 0:i.address,!0)},2e3)},claimOrderLoading:t}}function it({xcetus_amount:x,cetus_amount:c,imageSize:l="24px"}){const{isApp:o}=ve();return o?e.jsxs(V,{w:"100%",align:"center",gap:"8px",children:[e.jsxs(E,{children:[e.jsx($,{imageUrl:j.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:l,h:l,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(z,{amount:x,token:"xCETUS"})]}),e.jsx(O,{color:"text_caption",transform:"rotate(90deg)",children:"â†’"}),e.jsxs(E,{children:[e.jsx($,{imageUrl:j.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:l,h:l,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(z,{amount:c,token:"CETUS"})]})]}):e.jsxs(E,{children:[e.jsx($,{imageUrl:j.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:l,h:l,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(z,{amount:x,token:"xCETUS"}),e.jsx(O,{color:"text_caption",children:" â†’"}),e.jsx($,{imageUrl:j.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:l,h:l,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(z,{amount:c,token:"CETUS"})]})}const z=({amount:x,token:c})=>e.jsxs(ae,{as:"div",children:[e.jsxs(O,{as:"span",color:"text_caption",children:[ke(Q(x,9),9)," "]}),e.jsx(O,{as:"span",color:"text_paragraph",children:c})]});function lt(){const{fetchAccountBalance:x}=F(),{signAndExecuteTransaction:c}=N(),{xCetusSdk:l}=P(),{veNFT:o}=D(),[s,u]=p.useState(!1),{fetchVeNFTDividendInfo:i}=ie();return{handleClaimReward:async r=>{if(o){u(!0),console.log("ðŸš€ ~ file: useXCetusClaimRewardAction.ts:23 ~ handleClaimReward ~ rewardList:",r);try{const f=l.XCetusModule.redeemDividendV3Payload(o.id,r),n=await c(f,{},{useDevInspect:!0,msafeParams:{action:W.xCETUSClaimStakingRwewards,txbParams:{veNftId:o.id,rewardList:r}}});u(!1),n&&setTimeout(()=>{x(),i(o.id)},2e3)}catch(f){console.log("ðŸš€ ~ file: useXCetusClaimRewardAction.ts:40 ~ handleClaimReward ~ error:",f)}finally{u(!1)}}},claimRewardLoading:s}}function We(){const{getTokenPrice:x,fetchTokenPrices:c}=Ie();return{refreshCoinPriceInfo:async(o,s=!1,u=!1)=>{const i=new Set;u||o.forEach(t=>{const r=x(t,6e4);r?s&&!r.price_change&&i.add(t):i.add(t)}),console.log("ðŸš€ ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:i,coinTypeList:o}),i.size>0&&await c(Array.from(i),!0,!1)}}}function dt(){const{limitUserIndexerObj:x,setLimitUserIndexerObj:c,dcaUserIndexerObj:l,setDcaUserIndexerObj:o}=Fe(),{peripherySdk:s}=P();return{getLimitUserIndexer:async t=>{const r=x[t];if(r)return r;try{const f=new De;s.LimitOrder.buildGetUserIndexerHandle(t,f);const n=await s.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:f,sender:Re("0x0")}),a=s.LimitOrder.parsedQueryUserIndexerEvent(n);if(a)return c(t,a),a}catch(f){throw console.log("ðŸš€ ~ getLimitUserIndexer ~ error:",f),f}},getDcaUserIndexer:async t=>{const r=l[t];if(r)return r;try{const{dca:f}=s.sdkOptions,{user_indexer_id:n}=je(f),a=await s.ClmmSDK.fullClient.getDynamicFieldObject({parentId:n,name:{type:"address",value:t}}),C=Me(a).value.fields.id.id;if(C)return o(t,C),C}catch(f){throw console.log("ðŸš€ ~ getDcaUserIndexer ~ error:",f),f}}}}function ut(x=!1){const{xCetusSdk:c}=P(),{currentAccount:l}=A(),{fetchAccountBalance:o}=F(),{refreshCoinPriceInfo:s}=We(),{lockCetusList:u,veNFTLoading:i,lockCetusListLoading:t,clearData:r,owner:f,veNFT:n,XCetusManager:a,setXCetusManager:C,setDividendManager:b,setPhaseDividendInfoMap:T,phaseDividendInfoMap:w}=D(),{nextStartTime:v,currentPeriod:d,calculateCurrPeriod:k}=Oe(),{summaryRewardList:R,rewardList:M,totalRewardValue:y}=Ae(d),{fetchVeNFTDividendInfo:_}=ie(),L=async m=>{try{const S=await c.XCetusModule.getXcetusManager(m);S&&C(S)}catch(S){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",S)}},J=async m=>{try{const S=await c.XCetusModule.getPhaseDividendInfo(m.toString());if(S)T(S);else{const ue=(m-1).toString();if(!w[ue]){const ne=await c.XCetusModule.getPhaseDividendInfo(m.toString());ne&&T(ne)}}}catch(S){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",S)}},G=async m=>{try{const S=await c.XCetusModule.getDividendManager(m);S&&b(S)}catch(S){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",S)}},{fetchOwnerVeNFT:h}=H(),I=p.useMemo(()=>{if(n&&l&&!t){const m=_e.getAvailableXCetus(n,u);if(K(m).gte(0))return m}return"0"},[n==null?void 0:n.xcetus_balance,u]),U=p.useMemo(()=>{if(n){const m=K(n.xcetus_balance).sub(I);if(m.gte(0))return m.toFixed(0)}return"0"},[n==null?void 0:n.xcetus_balance,I]),X=p.useMemo(()=>{if(a&&n){const m=K(n.xcetus_balance).div(a.treasury).mul(100);return K(m).lt(.01)?"<0.01%":re(m.toString(),3)}return l?"0%":"--"},[a==null?void 0:a.treasury,n==null?void 0:n.xcetus_balance]),g=p.useMemo(()=>{if(d){let m=w[d.toString()];return m===void 0&&(m=w[(d-1).toString()]),m}},[w,d]),{cetusApr:B}=Pe(g,a==null?void 0:a.treasury);return p.useEffect(()=>{if(g){const m=g.bonus_types.map(S=>Le(S,!1));m&&(m.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),s(m))}},[g==null?void 0:g.id]),p.useEffect(()=>{d&&d>0&&J(d)},[d]),p.useEffect(()=>{n&&!x&&_(n.id)},[n==null?void 0:n.id]),{fetchOwnerVeNFT:h,fetchAccountBalance:o,fetchXCetusManager:L,fetchDividendManager:G,fetchVeNFTDividendInfo:_,veNFTLoading:i,lockCetusListLoading:t,redeemingXCetusAmount:U,availableXCetusAmount:I,veNFT:n,myShare:X,nextStartTime:v,cetusApr:B,summaryRewardList:R,rewardList:M,totalRewardValue:y,lockCetusList:u,calculateCurrPeriod:k}}export{ot as C,it as X,rt as a,ct as b,lt as c,ut as d,at as e,We as f,dt as g,st as u};
//# sourceMappingURL=useXCetus-PdK_JF4O.js.map
