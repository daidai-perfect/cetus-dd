{"version":3,"file":"useToken-D86igCts.js","sources":["../../../hooks/src/useToken.ts"],"sourcesContent":["import { CoinType, Token } from '@cetus/types'\nimport { AllTokensTable } from '@cetus/utils'\nimport { useDeepCompareEffect } from 'ahooks'\nimport { useState } from 'react'\nimport { useGetTokens } from './useGetTokens'\n\ntype TokenInfoType<T> = T extends CoinType ? Token | undefined : T extends CoinType[] ? Map<CoinType, Token> | undefined : undefined\n\nexport function useGetToken<T extends CoinType | CoinType[] | undefined>(coinType?: T) {\n  const { getToken, getTokenList } = useGetTokens()\n  const [tokenInfo, setTokenInfo] = useState<TokenInfoType<T>>()\n  useDeepCompareEffect(() => {\n    if (coinType) {\n      fetchTokenInfo(coinType).then(tokenInfo => {\n        setTokenInfo(tokenInfo)\n      })\n    }\n  }, [coinType])\n\n  const fetchTokenInfo = async <K extends CoinType | CoinType[]>(coinType: K): Promise<TokenInfoType<K>> => {\n    try {\n      if (Array.isArray(coinType)) {\n        const tokenMap = await getTokenListInfo(coinType)\n        return tokenMap as TokenInfoType<K>\n      } else {\n        const token = await getTokenInfo(coinType)\n        if (token) {\n          return token as TokenInfoType<K>\n        }\n      }\n    } catch (error) {\n      console.log('ðŸš€ ~ file: useToken.ts:44 ~ fetchTokenInfo ~ error:', error)\n    }\n\n    return undefined as TokenInfoType<K>\n  }\n\n  const getTokenInfo = async (coinType?: CoinType) => {\n    try {\n      if (coinType) {\n        let token: any\n        if (coinType === '0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI') {\n          token = await AllTokensTable.getItem<Token>('0x2::sui::SUI')\n        } else {\n          token = await AllTokensTable.getItem<Token>(coinType)\n        }\n        if (token) {\n          return token\n        } else {\n          await getToken(coinType)\n          return AllTokensTable.getItem<Token>(coinType)\n        }\n      }\n      return undefined\n    } catch (error) {\n      console.log('ðŸš€ ~ getTokenInfo ~ 58:', error)\n      return undefined\n    }\n  }\n\n  const getTokenListInfo = async (coinTypes?: CoinType[]) => {\n    try {\n      if (coinTypes && coinTypes.length > 0) {\n        const tokenMap = new Map<CoinType, Token>()\n        const unStoredTypes: CoinType[] = []\n        for (const coinType of coinTypes) {\n          let token: any\n          if (coinType === '0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI') {\n            token = await AllTokensTable.getItem<Token>('0x2::sui::SUI')\n          } else {\n            token = await AllTokensTable.getItem<Token>(coinType)\n          }\n          if (token) {\n            tokenMap.set(coinType, token)\n          } else {\n            unStoredTypes.push(coinType)\n          }\n        }\n        if (unStoredTypes.length > 0) {\n          await getTokenList(unStoredTypes)\n        }\n        for (const coinType of unStoredTypes) {\n          let _token: any\n          if (coinType === '0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI') {\n            _token = await AllTokensTable.getItem<Token>('0x2::sui::SUI')\n          } else {\n            _token = await AllTokensTable.getItem<Token>(coinType)\n          }\n          if (_token) {\n            tokenMap.set(coinType, _token)\n          }\n        }\n        // console.log('getTokenListInfo tokenMap', tokenMap)\n        return tokenMap\n      }\n      return undefined\n    } catch (error) {\n      console.log('ðŸš€ ~ getTokenListInfo ~ 70:', error)\n      return undefined\n    }\n  }\n\n  return {\n    tokenInfo,\n    getTokenInfo,\n    getTokenListInfo,\n    fetchTokenInfo\n  }\n}\n"],"names":["useGetToken","coinType","getToken","getTokenList","useGetTokens","tokenInfo","setTokenInfo","useState","useDeepCompareEffect","fetchTokenInfo","getTokenListInfo","token","getTokenInfo","error","AllTokensTable","coinTypes","tokenMap","unStoredTypes","_token"],"mappings":"iGAQO,SAASA,EAAyDC,EAAc,CACrF,KAAM,CAAE,SAAAC,EAAU,aAAAC,CAAa,EAAIC,EAAa,EAC1C,CAACC,EAAWC,CAAY,EAAIC,WAA2B,EAC7DC,EAAqB,IAAM,CACrBP,GACFQ,EAAeR,CAAQ,EAAE,KAAKI,GAAa,CACzCC,EAAaD,CAAS,CAAA,CACvB,CACH,EACC,CAACJ,CAAQ,CAAC,EAEP,MAAAQ,EAAiB,MAAwCR,GAA2C,CACpG,GAAA,CACE,GAAA,MAAM,QAAQA,CAAQ,EAEjB,OADU,MAAMS,EAAiBT,CAAQ,EAE3C,CACC,MAAAU,EAAQ,MAAMC,EAAaX,CAAQ,EACzC,GAAIU,EACK,OAAAA,CACT,QAEKE,EAAO,CACN,QAAA,IAAI,sDAAuDA,CAAK,CAAA,CAI5E,EAEMD,EAAe,MAAOX,GAAwB,CAC9C,GAAA,CACF,GAAIA,EAAU,CACR,IAAAU,EAMJ,OALIV,IAAa,+EACPU,EAAA,MAAMG,EAAe,QAAe,eAAe,EAEnDH,EAAA,MAAMG,EAAe,QAAeb,CAAQ,EAElDU,IAGF,MAAMT,EAASD,CAAQ,EAChBa,EAAe,QAAeb,CAAQ,EAC/C,CAEK,aACAY,EAAO,CACN,QAAA,IAAI,0BAA2BA,CAAK,EACrC,MAAA,CAEX,EAEMH,EAAmB,MAAOK,GAA2B,CACrD,GAAA,CACE,GAAAA,GAAaA,EAAU,OAAS,EAAG,CAC/B,MAAAC,MAAe,IACfC,EAA4B,CAAC,EACnC,UAAWhB,KAAYc,EAAW,CAC5B,IAAAJ,EACAV,IAAa,+EACPU,EAAA,MAAMG,EAAe,QAAe,eAAe,EAEnDH,EAAA,MAAMG,EAAe,QAAeb,CAAQ,EAElDU,EACOK,EAAA,IAAIf,EAAUU,CAAK,EAE5BM,EAAc,KAAKhB,CAAQ,CAC7B,CAEEgB,EAAc,OAAS,GACzB,MAAMd,EAAac,CAAa,EAElC,UAAWhB,KAAYgB,EAAe,CAChC,IAAAC,EACAjB,IAAa,+EACNiB,EAAA,MAAMJ,EAAe,QAAe,eAAe,EAEnDI,EAAA,MAAMJ,EAAe,QAAeb,CAAQ,EAEnDiB,GACOF,EAAA,IAAIf,EAAUiB,CAAM,CAC/B,CAGK,OAAAF,CAAA,CAEF,aACAH,EAAO,CACN,QAAA,IAAI,8BAA+BA,CAAK,EACzC,MAAA,CAEX,EAEO,MAAA,CACL,UAAAR,EACA,aAAAO,EACA,iBAAAF,EACA,eAAAD,CACF,CACF"}