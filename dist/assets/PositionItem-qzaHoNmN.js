import{y as Ge,a as b,ak as Se,j as e,H as _,C as ae,I,T as j,f as E,P as Ae,h as ve,m as fe,n as _e,p as $,V as M,F as ne,W as Ye,X as Ve,Y as Je,a0 as Qe,$ as Ke,k as Me,q as Xe}from"./vendor-BowHGuwE.js";import{a as K,J as Te,K as ce,d as g,z as ie,a2 as V,C as Ze,B as Fe,n as we,a9 as ze,$ as Q,aa as Ie,r as Pe,w as ue,R as Z,f as ge,q as Oe,h as We,I as Ee}from"./index-BNC9dWjK.js";import{u as es,V as ss,a as ts,b as rs}from"./VaultsAprBlock-CUOaprqK.js";import{a as ns,u as is,V as as}from"./VaultsAction-BtZnBQrQ.js";import{u as Ne}from"./useAccountBalance-Bo3OTVoK.js";import{u as cs}from"./useInterval-BcJtT0it.js";import{P as ls}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as os}from"./VTextLabelBox-DXlpfUmg.js";import{u as xs}from"./global-DRIkroNb.js";import{u as le,b as ps,a as ds}from"./usePositionList-t7kEDTMX.js";import{u as us}from"./useTransaction-6wjv9a0e.js";import{h as gs}from"./RemoveBlock-P19GOSKR.js";import{T as ms}from"./TableSortTh-MShTQgI_.js";import{b as hs}from"./useClaimPosition-C3-zgk8P.js";import{a as bs}from"./useNotifiSubscription-DzLlkFzN.js";import{S as me,A as De}from"./SingleTokenInfo-xqyqe7It.js";import{P as ys,L as js}from"./ExpendItem-D943GqlA.js";function Vs(){const{search:s}=Ge(),[n,c]=b.useState({});return b.useLayoutEffect(()=>{const i=new URLSearchParams(s);c(Object.fromEntries(i.entries()))},[s]),n}const Js=({tooltip:s,...n})=>{const c=Se(),{isApp:i}=K();return e.jsx(_,{w:"20px",h:"20px",onClick:p=>{ce(p),i||c("/farms")},...n,children:e.jsx(Te,{placement:"top",tooltip:s||e.jsx(j,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(ae,{children:e.jsx(I,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function ws(s){const{minPrice:n,maxPrice:c,currPrice:i}=s,[p,m]=b.useState(0),[r,S]=b.useState(0),o=b.useRef(null),t=b.useRef(null);b.useEffect(()=>{const h=()=>{o.current&&m(o.current.offsetWidth),t.current&&S(t.current.offsetWidth)},A=new ResizeObserver(h),T=new ResizeObserver(h);return o.current&&A.observe(o.current),t.current&&T.observe(t.current),()=>{o.current&&A.unobserve(o.current),t.current&&T.unobserve(t.current)}},[n,c,i]);const y=b.useMemo(()=>{if(c==="âˆž")return"0px";if(i&&n&&c&&p){if(g(i).lessThanOrEqualTo(c)&&g(i).greaterThanOrEqualTo(n)){const h=g(i).sub(n).div(g(c).sub(g(n))).toString();return`${g(p).mul(h).toFixed(0)}px`}if(g(i).lt(n))return"-36px";if(g(i).gt(c))return"calc(100% + 36px)"}return"0px"},[i,n,c,p]),v=b.useMemo(()=>{const h=y.replace("px","");return Number(h)-r/2+"px"},[y,r]),{isApp:f}=K();return e.jsx(e.Fragment,{children:n!==void 0&&c!==void 0&&i!==void 0?e.jsx(_,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(E,{w:"100%",padding:n&&g(i).lt(n)?"0 40px 0 60px":c&&g(i).gt(c)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:n&&g(i).lt(n)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(n)}),e.jsx(E,{w:"100%",position:"relative",height:"14px",ref:o,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(Ae,{isLazy:!0,placement:"top",trigger:f?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(ve,{children:e.jsx(E,{as:"button",children:e.jsx(E,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:y,ml:"-2px",zIndex:"5"})})}),e.jsx(fe,{w:"fit-content",bg:"none",border:"none",ref:t,position:"absolute",top:"-32px !important",left:v,zIndex:"5",children:e.jsx(_e,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(j,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:ie(i)})})})]})}),e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:c&&g(i).gt(c)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(c)})]})},y):e.jsx(_,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx($,{w:"100%",h:"20px"})})})}function Ss(s){const{vaultId:n,displayTokenA:c,displayTokenB:i,feeDisplay:p,minPrice:m,maxPrice:r,currPrice:S}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:o}=es(),t=b.useMemo(()=>{if(V(o)&&n)return o[n]},[o,n]);return e.jsxs(M,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ne,{children:[e.jsx(Ze,{coinAIconUrl:c==null?void 0:c.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ne,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(E,{children:e.jsxs(ne,{alignItems:"center",children:[e.jsx(j,{fontSize:"16px",color:"text_caption",children:`${c==null?void 0:c.symbol} - ${i==null?void 0:i.symbol}`}),e.jsx(Fe,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(j,{fontSize:"12px",color:"primary",children:p})})]})}),e.jsx(ne,{flexDirection:"column",children:e.jsx(os,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(ss,{vaultsLstApyDisplay:t==null?void 0:t.vaultsLstApyDisplay,vaultsApyDisplay:t==null?void 0:t.vaultsApyDisplay,vaultsTotalApyDisplay:t==null?void 0:t.vaultsTotalApyDisplay,vaultsAprDisplay:t==null?void 0:t.vaultsAprDisplay,category:t==null?void 0:t.category}),value:(t==null?void 0:t.category)=="cetus"?t==null?void 0:t.vaultsTotalApyDisplay:(t==null?void 0:t.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(ws,{minPrice:m,maxPrice:r,currPrice:S})]})}function Qs(s){const{currentAccount:n}=we(),{isOpen:c,setIsOpen:i,vaultId:p,category:m,displayTokenA:r,displayTokenB:S,feeDisplay:o,clmmPool:t,isReverse:y}=s,{isOpenWalletModal:v}=we(),{getCurrentVaultDetail:f,getCurrentVaultContractInfo:h}=ns(),{clearVaultsActionData:A}=is(),{fetchAccountBalance:T}=Ne(),d=Se(),{vaultsPoolObj:P}=ts(),u=b.useMemo(()=>P[p],[P,p]);b.useEffect(()=>{p&&f(p)},[n==null?void 0:n.address,p]);const{getPythLastPrice:a}=rs(),x=b.useRef(!1);b.useEffect(()=>(x.current=!0,()=>{x.current=!1,A()}),[]),b.useEffect(()=>{u!=null&&u.displayCoinTypeA&&(u!=null&&u.displayCoinTypeB)&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])},[u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB]),cs({interval:20*1e3,callback:()=>{x.current&&m=="haedal"&&a([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])}});const L=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),n!=null&&n.address?(T(),f(p,!0)):h(p)};return e.jsxs(Ye,{isCentered:!0,isOpen:c&&!v,onClose:()=>{i(!1)},children:[e.jsx(Ve,{}),e.jsx(Je,{width:{base:"100%",lg:"420px"},children:e.jsx(Qe,{p:"0 0 8px",children:e.jsxs(M,{width:"100%",children:[e.jsxs(M,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(_,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(j,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Ke,{})]}),e.jsx(Ss,{displayTokenA:r,displayTokenB:S,feeDisplay:o,clmmPool:t,isReverse:y,minPrice:u==null?void 0:u.minPrice,maxPrice:u==null?void 0:u.maxPrice,currPrice:u==null?void 0:u.currentPrice,category:m,vaultId:p}),e.jsx(as,{vaultId:p,isModal:!0,autoRefresh:L})]}),e.jsxs(_,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:m=="haedal"?"space-between":"center",children:[e.jsx(ls,{mt:"0",category:m}),e.jsx(j,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{m&&p&&(A(),d(`/vaults-detail/${p}/${m}`))},children:"Vault Details >"})]})]})})})]})}function Ue(){const s=(c,i,p,m)=>{const r=Math.max(c,p),o=Math.min(i,m)-r,t=i-c,y=m-p,v=Q(o.toString()),f=Q(t.toString()),h=Q(y.toString());return o<=0?Q(0):o===t?h.div(v):o===y?v.div(f):v.mul(v).div(h).div(f)};return{getPositionApr:(c,i,p,m)=>{if(!V(c)||!V(i)||!V(m))return;const{minPrice:r,minPriceResever:S,maxPrice:o,maxPriceResever:t}=i,{tokenA:y,tokenB:v,miningAprList:f,feeApr:h,feeApr7d:A,feeApr30d:T,isReverse:d}=c;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ getPositionApr ~ isReverse:",d),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:28 ~ getPositionApr ~ feeApr30d:",A,T);const P=y==null?void 0:y.decimals,u=v==null?void 0:v.decimals,a=r=="0"&&o=="âˆž",x=d?S:r,L=a?2**50:d?t:o;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:31 ~ getPositionApr ~ lowerUserPrice:",x),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:33 ~ getPositionApr ~ upperUserPrice:",L);const{lower:R,upper:ee}=m;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ range:",m);const se=ze.tickIndexToPrice(R,P,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ beforeContractPriceLowest:",se);const X=ze.tickIndexToPrice(ee,P,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:40 ~ getPositionApr ~ beforeContractPriceHighest:",X),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ lowerUserPrice, upperUserPrice, beforeContractPriceLowest, beforeContractPriceHighest:",x,L,se,X);const O=s(x,L,se,X);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:41 ~ getPositionApr ~ positionMulti:",O.toString());const C=Q(p=="day"?h:p=="month"?T:A).mul(O).toString(),z=[];let F=Q(C);return f==null||f.forEach(W=>{const H=Q(O).mul(W.apr).toString();z.push({...W,posMiningRewardApr:H}),F=F.add(H)}),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:45 ~ getPositionApr ~",{aprPercentageTotal:F.toString(),aprByFee:C,posMiningReward:z}),{aprPercentageTotal:F.toString(),displayAprPercentageTotal:Ie(F.toNumber()*100),aprByFee:C,posMiningReward:z}}}}function As(){const[s,n]=b.useState(!1),{getPositionApr:c}=Ue(),{getTokenAmountValue:i}=Pe(),{posPoolsRelatedData:p,posLiquidityData:m,posFeeData:r,farmsPosRewardsData:S,posRewardsData:o,posApiPoolData:t,poolRangeObj:y,setPosBaseList:v}=le(),{mevProtect:f,transactionMode:h,maxCapForGas:A,customGasPrice:T}=xs(),{getCloseTsPayloadAll:d}=gs(),{signAndExecuteTransaction:P,transactionConfirmation:u}=us(),{fetchAccountBalance:a}=Ne(),{getPositionBaseList:x,getPosRelatedData:L}=ps(),{currentAccount:R}=we(),ee=async()=>{const O=await x(R==null?void 0:R.address);L(O)};return{getPositionSortList:(O,C,z)=>{if(!(z!=null&&z.length))return;const F=(l=[])=>l.map(w=>{var k;return{...w,amountUSD:i((k=w==null?void 0:w.token)==null?void 0:k.coin_type,w==null?void 0:w.display_amount_owed)}}).filter(w=>g(w.display_amount_owed).gt(0)),W=z.map(l=>{var ke,Ce,Le,Be,Re;const w=l.posId,k=l.clmmPool,B=t[k],N=y[k],D=(ke=N==null?void 0:N.ranges)==null?void 0:ke.reduce((G,Y)=>(G[Y.dateType]=Y,G),{}),oe=c(B,p[w],"week",D==null?void 0:D.week),q=m[w],he=i((Ce=l.displayTokenA)==null?void 0:Ce.coin_type,q==null?void 0:q.displayCoinAmountA),be=i((Le=l.displayTokenB)==null?void 0:Le.coin_type,q==null?void 0:q.displayCoinAmountB),te=g(he).plus(be),U=r[w],xe=i((Be=l.displayTokenA)==null?void 0:Be.coin_type,U==null?void 0:U.displayFeeOwedA),pe=i((Re=l.displayTokenB)==null?void 0:Re.coin_type,U==null?void 0:U.displayFeeOwedB),de=g(xe).plus(pe),re=F(o[w]),J=F(S[l.id]),ye=[...re,...J].reduce((G,Y)=>G.plus(Y.amountUSD),g(0)),He=re.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0)),qe=J.reduce((G,Y)=>G.plus(Y.display_amount_owed),g(0));return{...l,apr:oe,totalLiquidity:te.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:He.toString(),totalFarmingAmount:qe.toString()}}),H={apr:(l,w)=>{var N,D;const k=g(((N=l.apr)==null?void 0:N.aprPercentageTotal)??0),B=g(((D=w.apr)==null?void 0:D.aprPercentageTotal)??0);return C==="asc"?k.minus(B).toNumber():B.minus(k).toNumber()},liquidity:(l,w)=>{const k=g(l.totalLiquidity),B=g(w.totalLiquidity);return C==="asc"?k.minus(B).toNumber():B.minus(k).toNumber()},fees:(l,w)=>{const k=g(l.totalFee),B=g(w.totalFee);return C==="asc"?k.minus(B).toNumber():B.minus(k).toNumber()},rewards:(l,w)=>{const k=g(l.totalRewards),B=g(w.totalRewards);return C==="asc"?k.minus(B).toNumber():B.minus(k).toNumber()}};return H[O]&&W.sort(H[O]),W},toCloseAllAction:async O=>{n(!0);try{const C=O.map(l=>{var U,xe,pe,de,re;const w=m[l==null?void 0:l.posId],k=o[l==null?void 0:l.posId],B=t[l.clmmPool],N=!k||(k==null?void 0:k.length)==0?(U=(B==null?void 0:B.miningRewardList)||[])==null?void 0:U.reduce((J,ye)=>(J.push(ye.coinType),J),[]):(k||[]).map(J=>J.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",l,t,B,k,N);const D=ie(w==null?void 0:w.displayCoinAmountA,void 0,!0),oe=ie(w==null?void 0:w.displayCoinAmountB,void 0,!0),q=l.isReverse,[he,be]=q?[g(oe).mul(ue.pow(10,(xe=l.displayTokenB)==null?void 0:xe.decimals)).toString(),g(D).mul(ue.pow(10,(pe=l.displayTokenA)==null?void 0:pe.decimals)).toString()]:[g(D).mul(ue.pow(10,(de=l.displayTokenA)==null?void 0:de.decimals)).toString(),g(oe).mul(ue.pow(10,(re=l.displayTokenB)==null?void 0:re.decimals)).toString()],te={posId:l.posType==="farms"?l.id:l.posId,poolAddress:l.clmmPool,coinTypeA:l.coinTypeA,coinTypeB:l.coinTypeB,amountA:he,amountB:be,liquidity:l.liquidity,lowerTick:l.lowerTick,upperTick:l.upperTick,posType:l.posType,rewarderCoinTypes:N};return l.posType==="farms"&&(te.farmsPoolId=l.farmsPool,te.farmsPosId=l.id),te});console.log("ðŸš€ ~ toRemove ~ paramsList:",C);const z={getShowInfo:l=>{const w=l==="success";return{modalDescriptionText:w?"":"Close All",toastTitleText:w?"Close All Successful":"Close All",toastDescriptionContent:w?"":void 0}}};u(z);const{tx:F,msafeParams:W}=await d(C),H=await P(F,z,{useMev:f,useFastMode:h==="Fast Mode",maxCapForGas:A,customGasPrice:T,msafeParams:W});console.log("ðŸš€ ~ toClaim ~ res:",H),H&&(a(),v([]),ee())}catch(C){console.error("ðŸš€ ~ toClaim ~ error:",C)}finally{n(!1)}},isRemoveLoading:s}}const vs=({positionInfo:s,onFeesChange:n})=>{var f,h;const[c,i]=b.useState(!1),{getTokenAmountValue:p}=Pe(),{posFeeData:m,posFeeDataLoading:r}=le(),S=m[s==null?void 0:s.posId],o=p((f=s==null?void 0:s.displayTokenA)==null?void 0:f.coin_type,S==null?void 0:S.displayFeeOwedA,"--"),t=p((h=s==null?void 0:s.displayTokenB)==null?void 0:h.coin_type,S==null?void 0:S.displayFeeOwedB,"--"),y=b.useMemo(()=>o!=="--"&&t!=="--"?Z(g(o).plus(t).toString(),2):"$--",[o,t]),{isApp:v}=K();return b.useEffect(()=>{n==null||n(y)},[y]),e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:A=>ce(A),onMouseEnter:Number(o)==0&&Number(t)==0?()=>{}:()=>i(!0),onMouseLeave:()=>i(!1),children:e.jsxs(Ae,{isLazy:!0,trigger:v?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:Number(o)==0&&Number(t)==0?"default":"help",children:e.jsx($,{isLoaded:!!y,children:e.jsx(j,{color:"text_caption",borderColor:"text_caption",children:y})})})}),c&&y!=="--"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(_e,{p:"8px",children:e.jsxs(M,{align:"flex-start",minW:"200px",children:[e.jsxs(_,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ge(S==null?void 0:S.displayFeeOwedA)}),e.jsx(j,{fontSize:"12px",children:Z(o,2)})]})]}),e.jsxs(_,{w:"100%",justify:"space-between",children:[e.jsx(me,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ge(S==null?void 0:S.displayFeeOwedB)}),e.jsx(j,{fontSize:"12px",children:Z(t,2)})]})]})]})})})})]})})})},fs=({positionInfo:s,onRewardsChange:n})=>{var P,u;const{getTokenAmountValue:c}=Pe(),{coinPriceObj:i}=Oe(),{posRewardsData:p,posRewardsDataLoading:m,posApiPoolData:r,farmsPosRewardsData:S,farmsPosRewardsDataLoading:o}=le(),t=(P=r[s==null?void 0:s.clmmPool])==null?void 0:P.haveMining,y=(u=r[s==null?void 0:s.clmmPool])==null?void 0:u.haveFarming,v=p[s==null?void 0:s.posId],f=S[s==null?void 0:s.id],h=b.useMemo(()=>{const a=v==null?void 0:v.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=c((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,v,i]),A=b.useMemo(()=>{const a=f==null?void 0:f.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=c((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return a&&a.length>0?a.filter(x=>g(x.display_amount_owed).gt(0)):[]},[s,f,i]),T=b.useMemo(()=>{let a;const x=h.concat(A);return console.log("ðŸš€ ~ totalUSD ~ arr:",x,h,A),(x==null?void 0:x.length)>0?(x.forEach(L=>{const R=L==null?void 0:L.amountUSD;a=R=="--"||a=="--"?"--":g(a).plus(R).toString()}),a=="--"?"$--":Z(a,2)):"$0"},[h,A]),{isApp:d}=K();return b.useEffect(()=>{n==null||n(T)},[T]),e.jsx(e.Fragment,{children:e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:a=>ce(a),children:e.jsxs(Ae,{isLazy:!0,trigger:d?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:T=="$0"?"text":"help",children:e.jsx($,{h:"14px",isLoaded:!!T&&!m&&!o,children:e.jsx(j,{color:"text_caption",children:T})})})}),T!=="$0"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(_e,{borderRadius:"12px",p:"8px",children:e.jsxs(M,{align:"flex-start",children:[t&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),h==null?void 0:h.map(a=>{var x;return e.jsxs(_,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)}),y&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),A==null?void 0:A.map(a=>{var x;return e.jsxs(_,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:a==null?void 0:a.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ge(a==null?void 0:a.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",Z(a==null?void 0:a.amountUSD,2)]})]})]},(x=a==null?void 0:a.token)==null?void 0:x.coin_type)})]})})})})]})})})})},_s="/images/icon_active_new@2x.png";function Ts({isActive:s,isLoading:n,imgStyle:c={},...i}){const{imgW:p="16px",imgH:m="12px"}=c;return e.jsx(ne,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...i,children:e.jsx(Te,{placement:"top",tooltip:e.jsx(j,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(ae,{onClick:r=>ce(r),children:e.jsxs(_,{align:"center",children:[s&&e.jsx(I,{w:p,h:m,src:_s}),e.jsx($,{w:"100%",isLoaded:!n,children:e.jsx(j,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Ps({positionInfo:s,width:n,tokenName:c,priceDirect:i,isShowIcon:p}){const{posPoolsRelatedData:m}=le(),r=m[s==null?void 0:s.posId],S=(r==null?void 0:r.currentStatus)=="Active";K();const o=b.useMemo(()=>r==null?void 0:r.minPriceOrigin,[r]),t=b.useMemo(()=>r==null?void 0:r.maxPriceOrigin,[r]),y=b.useMemo(()=>r==null?void 0:r.currentPriceOrigin,[r]),[v,f]=b.useState(0),h=b.useRef(null);b.useEffect(()=>{const d=()=>{h.current&&f(h.current.offsetWidth)},P=new ResizeObserver(d);return h.current&&P.observe(h.current),()=>{h.current&&P.unobserve(h.current)}},[o,t,y]);const A=b.useMemo(()=>{if(t==="âˆž")return"0px";if(y&&o&&t&&v){if(g(y).lessThanOrEqualTo(t)&&g(y).greaterThanOrEqualTo(o)){const d=g(y).sub(o).div(g(t).sub(g(o))).toString();return`${g(v).mul(d).toFixed(0)}px`}if(g(y).lt(o))return"6px";if(g(y).gt(t))return"calc(100% + 6px)"}return"0px"},[y,o,t,v]),{getExplorerUrl:T}=We();return e.jsxs(M,{align:"flex-start",w:{base:"100%",lg:n},maxW:{base:"100%",lg:n},children:[e.jsxs(_,{maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:"16px",children:[e.jsx($,{isLoaded:!!(r!=null&&r.minPrice)&&!!(r!=null&&r.maxPrice),borderRadius:"4px",children:i?e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${r==null?void 0:r.minPrice} - ${r==null?void 0:r.maxPrice}`}):e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${r==null?void 0:r.minPriceResever} - ${r==null?void 0:r.maxPriceResever}`})}),e.jsx(Ts,{isActive:S,isLoading:(r==null?void 0:r.currentStatus)==""}),p&&e.jsx(_,{onClick:d=>ce(d),children:e.jsx(Te,{placement:"top",tooltip:e.jsxs(_,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(_,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx($,{isLoaded:!!c,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:c==null?void 0:c.split("|")[1]})})]}),e.jsxs(_,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(T(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(ae,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ee,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsx($,{h:"6px",isLoaded:!!(r!=null&&r.currentPriceOrigin),borderRadius:"4px",children:e.jsx(E,{w:"88px",h:"6px",bgImage:t==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(E,{w:t==="âˆž"?"88px":"56px",h:t==="âˆž"?"2px":"6px",position:"relative",ref:h,background:t==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":S?"url('/images/img_range@2x.png')":"none",ml:t==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:t!=="âˆž"&&e.jsx(E,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:A,transform:"translateY(-50%)",zIndex:"5"})})})})]})}function ks({positionInfo:s,positionItemWidth:n=[],priceDirect:c,showMiningIcon:i,showFarmingIcon:p}){const{isApp:m}=K(),{getExplorerUrl:r}=We(),{getClmmPosName:S}=ds(),o=Se(),{setCurrentPosDetailTab:t}=bs(),{posPoolsOriginalData:y,posPoolsRelatedData:v,posApiPoolData:f,poolRangeObj:h}=le(),A=v[s==null?void 0:s.posId],T=f[s==null?void 0:s.clmmPool],d=b.useMemo(()=>{var C;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const z=(C=y==null?void 0:y[s==null?void 0:s.clmmPool])==null?void 0:C.index;return S(Number(s==null?void 0:s.index),z)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,y]),P=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),o(`/position-detail/${s==null?void 0:s.id}`)},[u,a]=b.useState(!1),{getPositionApr:x}=Ue(),L=b.useMemo(()=>{if(V(A)&&V(T)&&V(h)){const C=h[s==null?void 0:s.clmmPool];if(C){const z=C==null?void 0:C.ranges.reduce((F,W)=>(F[W.dateType]=W,F),{});return x(T,A,"week",z.week)}}},[A,T,s,h]);hs();const[R,ee]=b.useState(null),[se,X]=b.useState(null),O=(A==null?void 0:A.currentStatus)=="Active";return e.jsx(Fe,{onMouseEnter:()=>{setTimeout(()=>{a(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{a(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:P,children:e.jsx(_,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(M,{w:"100%",align:"flex-start",gap:"12px",children:[m&&e.jsxs(_,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(_,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx($,{isLoaded:!!d,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:d==null?void 0:d.split("|")[1]})})]}),e.jsxs(_,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(r(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(_,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[m?e.jsx(ys,{positionInfo:s,symbolEllipsesDecimals:10,labelInfo:{text:"Price Range"}}):e.jsx(Ps,{positionInfo:s,width:n[0],tokenName:d,priceDirect:c,isShowIcon:u}),e.jsxs(_,{w:{base:"100%",lg:n[1]},justify:{base:"space-between",lg:"flex-end"},children:[m&&e.jsx(j,{color:"primary_gray",children:"APR"}),e.jsx($,{isLoaded:!!L,children:e.jsx(j,{textAlign:"right",color:"primary",children:O?L==null?void 0:L.displayAprPercentageTotal:"0%"})})]}),e.jsxs(_,{m:"-12px 0",w:{base:"100%",lg:n[2]},justify:{base:"space-between",lg:"flex-end"},children:[m&&e.jsx(j,{color:"primary_gray",children:"Liquidity"}),e.jsx(js,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(_,{m:"-12px 0",w:{base:"100%",lg:n[3]},justify:{base:"space-between",lg:"flex-end"},children:[m&&e.jsx(j,{color:"primary_gray",children:"Pending Fees"}),e.jsx(vs,{positionInfo:s,onFeesChange:ee})]}),(i||p)&&e.jsxs(_,{m:"-12px 0",w:{base:"100%",lg:n[4]},justify:{base:"space-between",lg:"flex-end"},children:[m&&e.jsx(j,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(_,{gap:"4px",children:[m&&i&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),m&&p&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(fs,{positionInfo:s,onRewardsChange:X})]})]})]}),m&&e.jsxs(Xe,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(j,{color:"primary_gray",children:"Manage"}),e.jsx(Ee,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const je=["480px","20%","20%","20%","20%"],$e=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Cs=$e.reduce((s,n)=>(s[n.value]=n,s),{});function Ks({poolInfo:s,priceDirect:n}){const{coinPriceObj:c}=Oe(),{getPositionSortList:i}=As(),[p,m]=b.useState("desc"),[r,S]=b.useState({label:"",value:""}),o=d=>{(d==null?void 0:d.value)===r.value?m(P=>P==="desc"?"asc":"desc"):(m("desc"),S(d))},[t,y]=b.useState([]),v=b.useMemo(()=>{if(!V(s))return[];const d=i(r.value,p,s.list),P=r.value?d:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",P,d),y(d),P},[r.value,p,s==null?void 0:s.list,c]),f=d=>t.some(P=>g(P[d]).gt(0)),h=b.useMemo(()=>f("totalMiningAmount"),[t]),A=b.useMemo(()=>f("totalFarmingAmount"),[t]),{isApp:T}=K();return e.jsxs(M,{gap:"12px",w:"100%",children:[!T&&e.jsxs(_,{w:"100%",p:"0 16px",children:[e.jsx(j,{w:je[0],children:"Price Range"}),$e.map((d,P)=>d.value!=="rewards"||h||A?e.jsxs(_,{gap:"4px",w:je[P+1],justify:"flex-end",children:[h&&d.value==="rewards"&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),A&&d.value==="rewards"&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(ms,{labelInfo:Cs[d.value],sortRule:p,sortBy:r,clickSort:o})]},d.value):null)]}),e.jsx(M,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:v.map(d=>e.jsx(ks,{positionInfo:d,positionItemWidth:je,priceDirect:n,showMiningIcon:h,showFarmingIcon:A},d==null?void 0:d.id))})]})}export{Js as F,Ks as P,Qs as V,As as a,Vs as u};
//# sourceMappingURL=PositionItem-qzaHoNmN.js.map
