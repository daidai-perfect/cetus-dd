import{y as Qe,a as h,ak as fe,j as e,H as w,C as I,I as se,T as j,f as N,P as ve,h as _e,m as Te,n as Ae,p as P,V as B,F as ae,W as Xe,X as Ze,Y as Ke,a0 as Ie,$ as es,k as Ee,S as ss,q as ts}from"./vendor-BowHGuwE.js";import{a as Z,J as me,K as te,d as m,z as Y,a2 as X,C as rs,B as De,n as Se,a9 as Be,$ as D,aa as ns,r as Ce,w as pe,R as ee,f as ue,q as Ne,Z as as,G as Pe,y as is,X as cs,h as $e,I as Ue}from"./index-f9FTB66s.js";import{u as ls,V as os,a as xs,b as ds}from"./VaultsAprBlock-Br_jZYaV.js";import{a as ps,u as us,V as gs}from"./VaultsAction-DWFDsjxY.js";import{u as qe}from"./useAccountBalance-BQbcMZ0A.js";import{u as ms}from"./useInterval-BcJtT0it.js";import{P as hs}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as bs}from"./VTextLabelBox-D2BuZCO_.js";import{u as js}from"./global-CLOQGfNJ.js";import{u as ie,b as ys,a as ws}from"./usePositionList-hox-VPav.js";import{u as Ss}from"./useTransaction-CVvvHIbX.js";import{a as ze}from"./useWrapPoolData-CC4DzncA.js";import{h as fs}from"./RemoveBlock-D_VRzYl4.js";import{T as vs}from"./TableSortTh-C27QUSss.js";import{b as _s}from"./useClaimPosition-BXUMP5rx.js";import{a as Ts}from"./useNotifiSubscription-DzA_qNMa.js";import{S as ge,A as He}from"./SingleTokenInfo-COzMVCbU.js";import{T as As}from"./TooltipIcon-D-nOaE_M.js";import{L as Cs}from"./ExpendItem-CyPmbFwC.js";import ks from"./ExamplePieChart-1FKftbN-.js";import{u as Rs}from"./useToken-CZtTqA04.js";function lt(){const{search:s}=Qe(),[a,l]=h.useState({});return h.useLayoutEffect(()=>{const n=new URLSearchParams(s);l(Object.fromEntries(n.entries()))},[s]),a}const ot=({tooltip:s,...a})=>{const l=fe(),{isApp:n}=Z();return e.jsx(w,{w:"20px",h:"20px",onClick:i=>{te(i),n||l("/farms")},...a,children:e.jsx(me,{placement:"top",tooltip:s||e.jsx(j,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(I,{children:e.jsx(se,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function Ls(s){const{minPrice:a,maxPrice:l,currPrice:n}=s,[i,t]=h.useState(0),[S,y]=h.useState(0),d=h.useRef(null),r=h.useRef(null);h.useEffect(()=>{const g=()=>{d.current&&t(d.current.offsetWidth),r.current&&y(r.current.offsetWidth)},f=new ResizeObserver(g),v=new ResizeObserver(g);return d.current&&f.observe(d.current),r.current&&v.observe(r.current),()=>{d.current&&f.unobserve(d.current),r.current&&v.unobserve(r.current)}},[a,l,n]);const b=h.useMemo(()=>{if(l==="âˆž")return"0px";if(n&&a&&l&&i){if(m(n).lessThanOrEqualTo(l)&&m(n).greaterThanOrEqualTo(a)){const g=m(n).sub(a).div(m(l).sub(m(a))).toString();return`${m(i).mul(g).toFixed(0)}px`}if(m(n).lt(a))return"-36px";if(m(n).gt(l))return"calc(100% + 36px)"}return"0px"},[n,a,l,i]),T=h.useMemo(()=>{const g=b.replace("px","");return Number(g)-S/2+"px"},[b,S]),{isApp:C}=Z();return e.jsx(e.Fragment,{children:a!==void 0&&l!==void 0&&n!==void 0?e.jsx(w,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(N,{w:"100%",padding:a&&m(n).lt(a)?"0 40px 0 60px":l&&m(n).gt(l)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:a&&m(n).lt(a)?"60px":"40px",fontSize:"12px",color:"text_caption",children:Y(a)}),e.jsx(N,{w:"100%",position:"relative",height:"14px",ref:d,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(ve,{isLazy:!0,placement:"top",trigger:C?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(_e,{children:e.jsx(N,{as:"button",children:e.jsx(N,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:b,ml:"-2px",zIndex:"5"})})}),e.jsx(Te,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:T,zIndex:"5",children:e.jsx(Ae,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(j,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:Y(n)})})})]})}),e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:l&&m(n).gt(l)?"60px":"40px",fontSize:"12px",color:"text_caption",children:Y(l)})]})},b):e.jsx(w,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx(P,{w:"100%",h:"20px"})})})}function Ms(s){const{vaultId:a,displayTokenA:l,displayTokenB:n,feeDisplay:i,minPrice:t,maxPrice:S,currPrice:y}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:d}=ls(),r=h.useMemo(()=>{if(X(d)&&a)return d[a]},[d,a]);return e.jsxs(B,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ae,{children:[e.jsx(rs,{coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:n==null?void 0:n.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ae,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(N,{children:e.jsxs(ae,{alignItems:"center",children:[e.jsx(j,{fontSize:"16px",color:"text_caption",children:`${l==null?void 0:l.symbol} - ${n==null?void 0:n.symbol}`}),e.jsx(De,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(j,{fontSize:"12px",color:"primary",children:i})})]})}),e.jsx(ae,{flexDirection:"column",children:e.jsx(bs,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(os,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(Ls,{minPrice:t,maxPrice:S,currPrice:y})]})}function xt(s){const{currentAccount:a}=Se(),{isOpen:l,setIsOpen:n,vaultId:i,category:t,displayTokenA:S,displayTokenB:y,feeDisplay:d,clmmPool:r,isReverse:b}=s,{isOpenWalletModal:T}=Se(),{getCurrentVaultDetail:C,getCurrentVaultContractInfo:g}=ps(),{clearVaultsActionData:f}=us(),{fetchAccountBalance:v}=qe(),x=fe(),{vaultsPoolObj:A}=xs(),c=h.useMemo(()=>A[i],[A,i]);h.useEffect(()=>{i&&C(i)},[a==null?void 0:a.address,i]);const{getPythLastPrice:o}=ds(),u=h.useRef(!1);h.useEffect(()=>(u.current=!0,()=>{u.current=!1,f()}),[]),h.useEffect(()=>{c!=null&&c.displayCoinTypeA&&(c!=null&&c.displayCoinTypeB)&&o([c==null?void 0:c.displayCoinTypeA,c==null?void 0:c.displayCoinTypeB])},[c==null?void 0:c.displayCoinTypeA,c==null?void 0:c.displayCoinTypeB]),ms({interval:20*1e3,callback:()=>{u.current&&t=="haedal"&&o([c==null?void 0:c.displayCoinTypeA,c==null?void 0:c.displayCoinTypeB])}});const k=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),a!=null&&a.address?(v(),C(i,!0)):g(i)};return e.jsxs(Xe,{isCentered:!0,isOpen:l&&!T,onClose:()=>{n(!1)},children:[e.jsx(Ze,{}),e.jsx(Ke,{width:{base:"100%",lg:"420px"},children:e.jsx(Ie,{p:"0 0 8px",children:e.jsxs(B,{width:"100%",children:[e.jsxs(B,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(w,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(j,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(es,{})]}),e.jsx(Ms,{displayTokenA:S,displayTokenB:y,feeDisplay:d,clmmPool:r,isReverse:b,minPrice:c==null?void 0:c.minPrice,maxPrice:c==null?void 0:c.maxPrice,currPrice:c==null?void 0:c.currentPrice,category:t,vaultId:i}),e.jsx(gs,{vaultId:i,isModal:!0,autoRefresh:k})]}),e.jsxs(w,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:t=="haedal"?"space-between":"center",children:[e.jsx(hs,{mt:"0",category:t}),e.jsx(j,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{t&&i&&(f(),x(`/vaults-detail/${i}/${t}`))},children:"Vault Details >"})]})]})})})]})}function Ge(){const s=(l,n,i,t)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:8 ~ estPositionAPRWithMultiMethod ~ lowerUserPrice:",l,n,n,t);const S=Math.max(l,i),d=Math.min(n,t)-S,r=n-l,b=t-i,T=D(d.toString());console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ estPositionAPRWithMultiMethod ~ retroRange.toString():",d.toString());const C=D(r.toString()),g=D(b.toString());return console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:30 ~ estPositionAPRWithMultiMethod ~ histRange.toString():",b.toString()),d<=0?D(0):r<=d?g.div(T):d===b?T.div(C):T.div(g).mul(T.div(C))};return{getPositionApr:(l,n,i,t)=>{if(!X(l)||!X(n)||!X(t))return;const{minPriceRaw:S,maxPriceRaw:y}=n,{tokenA:d,tokenB:r,miningAprList:b,feeApr:T,feeApr7d:C,feeApr30d:g,isReverse:f}=l,v=d==null?void 0:d.decimals,x=r==null?void 0:r.decimals,A=y=="0"&&S=="âˆž",c=S,o=A?2**50:y,{lower:u,upper:k}=t,M=Be.tickIndexToPrice(u,v,x).toNumber(),$=Be.tickIndexToPrice(k,v,x).toNumber(),he=f?Y(D(1).div($).toString(),void 0,!0):Y(M,void 0,!0),ce=f?Y(D(1).div(M).toString(),void 0,!0):Y($,void 0,!0),O=s(c,o,he,ce);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:71 ~ getPositionApr ~ positionMulti:ç³»æ•°",O.toString());const L=D(i=="day"?T:i=="month"?g:C).mul(O).toString(),z=[];let W=D(L);return b==null||b.forEach(E=>{const U=D(O).mul(E.apr).toString(),p=ze(U,!0);z.push({...E,posMiningRewardApr:U,posMiningRewardAprDisplay:p}),W=W.add(U)}),{aprPercentageTotal:W.toString(),displayAprPercentageTotal:ns(W.mul(100).toNumber()),aprByFee:L,aprByFeeDisplay:ze(L,!0),posMiningReward:z}}}}function Fs(){const[s,a]=h.useState(!1),{getPositionApr:l}=Ge(),{getTokenAmountValue:n}=Ce(),{posPoolsRelatedData:i,posLiquidityData:t,posFeeData:S,farmsPosRewardsData:y,posRewardsData:d,posApiPoolData:r,poolRangeObj:b,setPosBaseList:T}=ie(),{mevProtect:C,transactionMode:g,maxCapForGas:f,customGasPrice:v}=js(),{getCloseTsPayloadAll:x}=fs(),{signAndExecuteTransaction:A,transactionConfirmation:c}=Ss(),{fetchAccountBalance:o}=qe(),{getPositionBaseList:u,getPosRelatedData:k}=ys(),{currentAccount:M}=Se(),$=async()=>{const O=await u(M==null?void 0:M.address);k(O)};return{getPositionSortList:(O,L,z)=>{if(!(z!=null&&z.length))return;const W=(p=[])=>p.map(_=>{var R;return{..._,amountUSD:n((R=_==null?void 0:_.token)==null?void 0:R.coin_type,_==null?void 0:_.display_amount_owed)}}).filter(_=>m(_.display_amount_owed).gt(0)),E=z.map(p=>{var ke,Re,Le,Me,Fe;const _=p.posId,R=p.clmmPool,F=r[R],q=b[R],H=(ke=q==null?void 0:q.ranges)==null?void 0:ke.reduce((J,Q)=>(J[Q.dateType]=Q,J),{}),le=l(F,i[_],"day",H==null?void 0:H.day),V=t[_],be=n((Re=p.displayTokenA)==null?void 0:Re.coin_type,V==null?void 0:V.displayCoinAmountA),je=n((Le=p.displayTokenB)==null?void 0:Le.coin_type,V==null?void 0:V.displayCoinAmountB),re=m(be).plus(je),G=S[_],oe=n((Me=p.displayTokenA)==null?void 0:Me.coin_type,G==null?void 0:G.displayFeeOwedA),xe=n((Fe=p.displayTokenB)==null?void 0:Fe.coin_type,G==null?void 0:G.displayFeeOwedB),de=m(oe).plus(xe),ne=W(d[_]),K=W(y[p.id]),ye=[...ne,...K].reduce((J,Q)=>J.plus(Q.amountUSD),m(0)),Ve=ne.reduce((J,Q)=>J.plus(Q.display_amount_owed),m(0)),Je=K.reduce((J,Q)=>J.plus(Q.display_amount_owed),m(0));return{...p,apr:le,totalLiquidity:re.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:Ve.toString(),totalFarmingAmount:Je.toString()}}),U={apr:(p,_)=>{var q,H;const R=m(((q=p.apr)==null?void 0:q.aprPercentageTotal)??0),F=m(((H=_.apr)==null?void 0:H.aprPercentageTotal)??0);return L==="asc"?R.minus(F).toNumber():F.minus(R).toNumber()},liquidity:(p,_)=>{const R=m(p.totalLiquidity),F=m(_.totalLiquidity);return L==="asc"?R.minus(F).toNumber():F.minus(R).toNumber()},fees:(p,_)=>{const R=m(p.totalFee),F=m(_.totalFee);return L==="asc"?R.minus(F).toNumber():F.minus(R).toNumber()},rewards:(p,_)=>{const R=m(p.totalRewards),F=m(_.totalRewards);return L==="asc"?R.minus(F).toNumber():F.minus(R).toNumber()}};return U[O]&&E.sort(U[O]),E},toCloseAllAction:async O=>{a(!0);try{const L=O.map(p=>{var G,oe,xe,de,ne;const _=t[p==null?void 0:p.posId],R=d[p==null?void 0:p.posId],F=r[p.clmmPool],q=!R||(R==null?void 0:R.length)==0?(G=(F==null?void 0:F.miningRewardList)||[])==null?void 0:G.reduce((K,ye)=>(K.push(ye.coinType),K),[]):(R||[]).map(K=>K.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",p,r,F,R,q);const H=Y(_==null?void 0:_.displayCoinAmountA,void 0,!0),le=Y(_==null?void 0:_.displayCoinAmountB,void 0,!0),V=p.isReverse,[be,je]=V?[m(le).mul(pe.pow(10,(oe=p.displayTokenB)==null?void 0:oe.decimals)).toString(),m(H).mul(pe.pow(10,(xe=p.displayTokenA)==null?void 0:xe.decimals)).toString()]:[m(H).mul(pe.pow(10,(de=p.displayTokenA)==null?void 0:de.decimals)).toString(),m(le).mul(pe.pow(10,(ne=p.displayTokenB)==null?void 0:ne.decimals)).toString()],re={posId:p.posType==="farms"?p.id:p.posId,poolAddress:p.clmmPool,coinTypeA:p.coinTypeA,coinTypeB:p.coinTypeB,amountA:be,amountB:je,liquidity:p.liquidity,lowerTick:p.lowerTick,upperTick:p.upperTick,posType:p.posType,rewarderCoinTypes:q};return p.posType==="farms"&&(re.farmsPoolId=p.farmsPool,re.farmsPosId=p.id),re});console.log("ðŸš€ ~ toRemove ~ paramsList:",L);const z={getShowInfo:p=>{const _=p==="success";return{modalDescriptionText:_?"":"Close all positions",toastTitleText:_?"Close all positions successful":"Close all positions",toastDescriptionContent:_?"":void 0}}};c(z);const{tx:W,msafeParams:E}=await x(L),U=await A(W,z,{useMev:C,useFastMode:g==="Fast Mode",maxCapForGas:f,customGasPrice:v,msafeParams:E});console.log("ðŸš€ ~ toClaim ~ res:",U),U&&(o(),T([]),$())}catch(L){console.error("ðŸš€ ~ toClaim ~ error:",L)}finally{a(!1)}},isRemoveLoading:s}}const Bs=({positionInfo:s,onFeesChange:a})=>{var C,g;const[l,n]=h.useState(!1),{getTokenAmountValue:i}=Ce(),{posFeeData:t,posFeeDataLoading:S}=ie(),y=t[s==null?void 0:s.posId],d=i((C=s==null?void 0:s.displayTokenA)==null?void 0:C.coin_type,y==null?void 0:y.displayFeeOwedA,"--"),r=i((g=s==null?void 0:s.displayTokenB)==null?void 0:g.coin_type,y==null?void 0:y.displayFeeOwedB,"--"),b=h.useMemo(()=>d!=="--"&&r!=="--"?ee(m(d).plus(r).toString(),2):"$--",[d,r]),{isApp:T}=Z();return h.useEffect(()=>{a==null||a(b)},[b]),e.jsx(B,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(N,{p:"12px 0",onClick:f=>te(f),onMouseEnter:Number(d)==0&&Number(r)==0?()=>{}:()=>n(!0),onMouseLeave:()=>n(!1),children:e.jsxs(ve,{isLazy:!0,trigger:T?"click":"hover",placement:"top-start",children:[e.jsx(_e,{children:e.jsx(I,{as:"button",cursor:Number(d)==0&&Number(r)==0?"default":"help",children:e.jsx(P,{isLoaded:!!b,children:e.jsx(j,{color:"text_caption",borderColor:"text_caption",children:b})})})}),l&&b!=="--"&&e.jsx(Ee,{children:e.jsx(Te,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(Ae,{p:"8px",children:e.jsxs(B,{align:"flex-start",minW:"200px",children:[e.jsxs(w,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(B,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(y==null?void 0:y.displayFeeOwedA)}),e.jsx(j,{fontSize:"12px",children:ee(d,2)})]})]}),e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(ge,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(B,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(y==null?void 0:y.displayFeeOwedB)}),e.jsx(j,{fontSize:"12px",children:ee(r,2)})]})]})]})})})})]})})})},Ps=({positionInfo:s,onRewardsChange:a})=>{var A,c;const{getTokenAmountValue:l}=Ce(),{coinPriceObj:n}=Ne(),{posRewardsData:i,posRewardsDataLoading:t,posApiPoolData:S,farmsPosRewardsData:y,farmsPosRewardsDataLoading:d}=ie(),r=(A=S[s==null?void 0:s.clmmPool])==null?void 0:A.haveMining,b=(c=S[s==null?void 0:s.clmmPool])==null?void 0:c.haveFarming,T=i[s==null?void 0:s.posId],C=y[s==null?void 0:s.id],g=h.useMemo(()=>{const o=T==null?void 0:T.map(u=>{var M;console.log("ðŸš€ ~ list ~ reward:",u);const k=l((M=u==null?void 0:u.token)==null?void 0:M.coin_type,u==null?void 0:u.display_amount_owed,"--");return{...u,amountUSD:k}});return o&&o.length>0?o.filter(u=>m(u.display_amount_owed).gt(0)):[]},[s,T,n]),f=h.useMemo(()=>{const o=C==null?void 0:C.map(u=>{var M;console.log("ðŸš€ ~ list ~ reward:",u);const k=l((M=u==null?void 0:u.token)==null?void 0:M.coin_type,u==null?void 0:u.display_amount_owed,"--");return{...u,amountUSD:k}});return o&&o.length>0?o.filter(u=>m(u.display_amount_owed).gt(0)):[]},[s,C,n]),v=h.useMemo(()=>{let o;const u=g.concat(f);return console.log("ðŸš€ ~ totalUSD ~ arr:",u,g,f),(u==null?void 0:u.length)>0?(u.forEach(k=>{const M=k==null?void 0:k.amountUSD;o=M=="--"||o=="--"?"--":m(o).plus(M).toString()}),o=="--"?"$--":ee(o,2)):"$0"},[g,f]),{isApp:x}=Z();return h.useEffect(()=>{a==null||a(v)},[v]),e.jsx(e.Fragment,{children:e.jsx(B,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(N,{p:"12px 0",onClick:o=>te(o),children:e.jsxs(ve,{isLazy:!0,trigger:x?"click":"hover",placement:"top-start",children:[e.jsx(_e,{children:e.jsx(I,{as:"button",cursor:v=="$0"?"text":"help",children:e.jsx(P,{h:"14px",isLoaded:!!v&&!t&&!d,children:e.jsx(j,{color:"text_caption",children:v})})})}),v!=="$0"&&e.jsx(Ee,{children:e.jsx(Te,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(Ae,{borderRadius:"12px",p:"8px",children:e.jsxs(B,{align:"flex-start",children:[r&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),g==null?void 0:g.map(o=>{var u;return e.jsxs(w,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:o==null?void 0:o.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(B,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(o==null?void 0:o.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",ee(o==null?void 0:o.amountUSD,2)]})]})]},(u=o==null?void 0:o.token)==null?void 0:u.coin_type)}),b&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),f==null?void 0:f.map(o=>{var u;return e.jsxs(w,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:o==null?void 0:o.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(B,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(o==null?void 0:o.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",ee(o==null?void 0:o.amountUSD,2)]})]})]},(u=o==null?void 0:o.token)==null?void 0:u.coin_type)})]})})})})]})})})})},zs=({totalAprDisplay:s,farmingAprDisplay:a,placement:l="top",poolInfo:n,positionApr:i})=>{var f;const{getTokenListInfo:t}=Rs(),[S,y]=h.useState(new Map);as(()=>{var x,A;if(((x=i==null?void 0:i.posMiningReward)==null?void 0:x.length)==0)return;const v=(A=i==null?void 0:i.posMiningReward)==null?void 0:A.map(c=>c==null?void 0:c.coinType);t(v).then(c=>{c&&(c==null?void 0:c.size)>0&&y(c)})},[i==null?void 0:i.posMiningReward]);const{isApp:d}=Z(),r=D(n==null?void 0:n.feeApr).gt(0)?[{name:"Fees",value:Number(i==null?void 0:i.aprByFee),displayValue:i==null?void 0:i.aprByFeeDisplay,color:"#68FFD8"}]:[],b=["#6868FF","#FFCA68","#C8FF00","#FF562B","#0A05FF","#FF65F8","#FF3232","#842CFF","#31D829"];let T=-1;const C=(f=i==null?void 0:i.posMiningReward)==null?void 0:f.map(v=>{var k,M,$;const{symbol:x,coinType:A,posMiningRewardApr:c,posMiningRewardAprDisplay:o}=v||{},u=Pe(A||"")==Pe(((M=(k=is)==null?void 0:k.sui_coin)==null?void 0:M.coin_type)||"");return T=u?T:T+1,{name:`${cs(`${x||(($=S==null?void 0:S.get(A))==null?void 0:$.symbol)||""}`,8)} Rewards`,value:Number(c),displayValue:o,color:u?"#65C8FF":b[T]}}).sort((v,x)=>x.value-v.value),g=r.concat(C);return e.jsx(w,{justify:"flex-end",w:"100%",onClick:v=>{d&&te(v)},children:n!=null&&n.haveMining&&s!=="--"?e.jsx(me,{placement:l,tooltip:e.jsxs(B,{w:"100%",p:"4px",children:[e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(j,{color:"text_caption",children:"Total APR"}),e.jsx(j,{color:"text_caption",fontSize:"16px",children:s})]}),e.jsx(Os,{originData:g})]}),children:e.jsx(I,{children:e.jsx(Oe,{poolInfo:n,totalAprDisplay:s,farmingAprDisplay:a})})}):e.jsx(I,{children:e.jsx(Oe,{poolInfo:n,totalAprDisplay:s,farmingAprDisplay:a})})})},Oe=({poolInfo:s,totalAprDisplay:a,farmingAprDisplay:l})=>e.jsxs(B,{align:"flex-end",gap:"4px",children:[e.jsx(j,{as:"span",color:"primary",cursor:s!=null&&s.haveMining?"help":"text",children:a}),(s==null?void 0:s.haveFarming)&&e.jsx(j,{fontWeight:"500",p:"2px 4px",fontSize:"12px",color:"primary_yellow",bg:"primary_yellow_opacity.10",borderRadius:"4px",children:l=="--"?"--":"+"+l})]}),Os=({originData:s})=>e.jsx(h.Suspense,{fallback:e.jsxs(w,{justify:"space-between",gap:"20px",w:"100%",children:[e.jsx(ss,{w:"64px",h:"64px"}),e.jsxs(B,{w:"calc(100% - 84px)",children:[e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(P,{w:"40%",h:"16px"}),e.jsx(P,{w:"30%",h:"16px"})]}),e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(P,{w:"40%",h:"16px"}),e.jsx(P,{w:"30%",h:"16px"})]}),e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(P,{w:"40%",h:"16px"}),e.jsx(P,{w:"30%",h:"16px"})]})]})]}),children:e.jsx(ks,{originData:s})}),Ws="/images/icon_active_new@2x.png";function We({isActive:s,isLoading:a,imgStyle:l={},...n}){const{imgW:i="16px",imgH:t="12px"}=l;return e.jsx(ae,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...n,children:e.jsx(me,{placement:"top",tooltip:e.jsx(j,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(I,{onClick:S=>te(S),children:e.jsxs(w,{align:"center",children:[s&&e.jsx(se,{w:i,h:t,src:Ws}),e.jsx(P,{w:"100%",isLoaded:!a,children:e.jsx(j,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Es({positionInfo:s,tokenName:a,priceDirect:l,isShowIcon:n}){const{posPoolsRelatedData:i}=ie(),t=i[s==null?void 0:s.posId],S=(t==null?void 0:t.currentStatus)=="Active",{isApp:y}=Z(),d=h.useMemo(()=>t==null?void 0:t.minPriceOrigin,[t]),r=h.useMemo(()=>t==null?void 0:t.maxPriceOrigin,[t]),b=h.useMemo(()=>t==null?void 0:t.currentPriceOrigin,[t]),[T,C]=h.useState(0),g=h.useRef(null);h.useEffect(()=>{const x=()=>{g.current&&C(g.current.offsetWidth)},A=new ResizeObserver(x);return g.current&&A.observe(g.current),()=>{g.current&&A.unobserve(g.current)}},[d,r,b]);const f=h.useMemo(()=>{if(r==="âˆž")return"0px";if(b&&d&&r&&T){if(m(b).lessThanOrEqualTo(r)&&m(b).greaterThanOrEqualTo(d)){const x=m(b).sub(d).div(m(r).sub(m(d))).toString();return`${m(T).mul(x).toFixed(0)}px`}if(m(b).lt(d))return"6px";if(m(b).gt(r))return"calc(100% + 6px)"}return"0px"},[b,d,r,T]),{getExplorerUrl:v}=$e();return e.jsxs(B,{align:{base:"flex-end",lg:"flex-start"},gap:{base:"4px",lg:"8px"},w:"100%",maxW:"100%",children:[e.jsxs(w,{justify:{base:"flex-end",lg:"flex-start"},maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:{base:"0",lg:"16px"},children:[e.jsx(P,{isLoaded:!!(t!=null&&t.minPrice)&&!!(t!=null&&t.maxPrice),borderRadius:"4px",children:l?e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPrice} - ${t==null?void 0:t.maxPrice}`}):e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPriceResever} - ${t==null?void 0:t.maxPriceResever}`})}),!y&&e.jsx(We,{isActive:S,isLoading:(t==null?void 0:t.currentStatus)==""}),n&&!y&&e.jsx(w,{onClick:x=>te(x),children:e.jsx(me,{placement:"top",tooltip:e.jsxs(w,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx(P,{isLoaded:!!a,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:a==null?void 0:a.split("|")[1]})})]}),e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(He,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(v(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(I,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ue,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsxs(w,{children:[y&&e.jsx(We,{isActive:S,isLoading:(t==null?void 0:t.currentStatus)==""}),e.jsx(P,{h:"6px",isLoaded:!!(t!=null&&t.currentPriceOrigin),borderRadius:"4px",children:e.jsx(N,{w:"88px",h:"6px",bgImage:r==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(N,{w:r==="âˆž"?"88px":"56px",h:r==="âˆž"?"2px":"6px",position:"relative",ref:g,background:r==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":S?"url('/images/img_range@2x.png')":"none",ml:r==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:r!=="âˆž"&&e.jsx(N,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:f,transform:"translateY(-50%)",zIndex:"5"})})})})]})]})}function Ds({positionInfo:s,positionItemWidth:a=[],priceDirect:l,showMiningIcon:n,showFarmingIcon:i}){const{isApp:t}=Z(),{getExplorerUrl:S}=$e(),{getClmmPosName:y}=ws(),d=fe(),{setCurrentPosDetailTab:r}=Ts(),{posPoolsOriginalData:b,posPoolsRelatedData:T,posApiPoolData:C,poolRangeObj:g}=ie(),f=T[s==null?void 0:s.posId],v=C[s==null?void 0:s.clmmPool],x=h.useMemo(()=>{var L;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const z=(L=b==null?void 0:b[s==null?void 0:s.clmmPool])==null?void 0:L.index;return y(Number(s==null?void 0:s.index),z)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,b]),A=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),d(`/position-detail/${s==null?void 0:s.id}`)},[c,o]=h.useState(!1),{getPositionApr:u}=Ge(),k=h.useMemo(()=>{if(X(f)&&X(v)&&X(g)){const L=g[s==null?void 0:s.clmmPool];if(L){const z=L==null?void 0:L.ranges.reduce((W,E)=>(W[E.dateType]=E,W),{});return u(v,f,"day",z.day)}}},[f,v,s,g]);_s();const[M,$]=h.useState(null),[he,ce]=h.useState(null),O=(f==null?void 0:f.currentStatus)=="Active";return e.jsx(De,{onMouseEnter:()=>{setTimeout(()=>{o(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{o(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:A,children:e.jsx(w,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(B,{w:"100%",align:"flex-start",gap:"12px",children:[t&&e.jsxs(w,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx(P,{isLoaded:!!x,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:x==null?void 0:x.split("|")[1]})})]}),e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(He,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(S(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(w,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[e.jsxs(w,{w:{base:"100%",lg:a[0]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",whiteSpace:"nowrap",children:"Price Range"}),e.jsx(Es,{positionInfo:s,tokenName:x,priceDirect:l,isShowIcon:c})]}),e.jsxs(w,{w:{base:"100%",lg:a[1]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsxs(w,{gap:"2px",children:[e.jsx(j,{color:"primary_gray",children:"APR"}),e.jsx(As,{tooltipCon:e.jsxs("span",{children:["APR based on the past 24h historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. ",e.jsx("br",{}),"Calculations are an estimate and only for reference."]})})]}),e.jsx(P,{isLoaded:!!k,children:e.jsx(zs,{poolInfo:v,positionApr:k,farmingAprDisplay:O?k==null?void 0:k.displayAprPercentageTotal:"0%",totalAprDisplay:O?k==null?void 0:k.displayAprPercentageTotal:"0%"})})]}),e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:a[2]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Liquidity"}),e.jsx(Cs,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:a[3]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Pending Fees"}),e.jsx(Bs,{positionInfo:s,onFeesChange:$})]}),(n||i)&&e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:a[4]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(w,{gap:"4px",children:[t&&n&&e.jsx(se,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),t&&i&&e.jsx(se,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(Ps,{positionInfo:s,onRewardsChange:ce})]})]})]}),t&&e.jsxs(ts,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(j,{color:"primary_gray",children:"Manage"}),e.jsx(Ue,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const we=["480px","20%","20%","20%","20%"],Ye=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Ns=Ye.reduce((s,a)=>(s[a.value]=a,s),{});function dt({poolInfo:s,priceDirect:a}){const{coinPriceObj:l}=Ne(),{getPositionSortList:n}=Fs(),[i,t]=h.useState("desc"),[S,y]=h.useState({label:"",value:""}),d=x=>{(x==null?void 0:x.value)===S.value?t(A=>A==="desc"?"asc":"desc"):(t("desc"),y(x))},[r,b]=h.useState([]),T=h.useMemo(()=>{if(!X(s))return[];const x=n(S.value,i,s.list),A=S.value?x:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",A,x),b(x),A},[S.value,i,s==null?void 0:s.list,l]),C=x=>r.some(A=>m(A[x]).gt(0)),g=h.useMemo(()=>C("totalMiningAmount"),[r]),f=h.useMemo(()=>C("totalFarmingAmount"),[r]),{isApp:v}=Z();return e.jsxs(B,{gap:"12px",w:"100%",children:[!v&&e.jsxs(w,{w:"100%",p:"0 16px",children:[e.jsx(j,{w:we[0],children:"Price Range"}),Ye.map((x,A)=>x.value!=="rewards"||g||f?e.jsxs(w,{gap:"4px",w:we[A+1],justify:"flex-end",children:[g&&x.value==="rewards"&&e.jsx(se,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),f&&x.value==="rewards"&&e.jsx(se,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(vs,{labelInfo:Ns[x.value],sortRule:i,sortBy:S,clickSort:d,tooltip:{content:x.value==="apr"?e.jsxs("span",{children:["APR based on the past 24h historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. ",e.jsx("br",{}),"Calculations are an estimate and only for reference."]}):""}})]},x.value):null)]}),e.jsx(B,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:T.map(x=>e.jsx(Ds,{positionInfo:x,positionItemWidth:we,priceDirect:a,showMiningIcon:g,showFarmingIcon:f},x==null?void 0:x.id))})]})}export{ot as F,dt as P,xt as V,Fs as a,lt as u};
//# sourceMappingURL=PositionItem-I7tjwlEg.js.map
