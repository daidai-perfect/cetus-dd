import{Q as $,k as q,q as b,a8 as S,aQ as V,aJ as v,d as T,x as B,aH as C,v as x,b9 as W,ba as Y,a1 as h,bb as H,o as L,bc as Q,bd as J}from"./index-QNvgVKlA.js";import{a as j}from"./vendor-BFGDaAdA.js";import{u as O}from"./useToken-DOpzZ4jY.js";import{u as M}from"./useFavoritePool-DqHLM_4q.js";import{d as U,c as Z,f as G,e as z}from"./useGetPoolList-ByJZGCUe.js";const K=(P,D)=>({showPosListLength:"",setShowPosListLength:n=>{P(()=>({showPosListLength:n}))},posApiPoolData:{},setPosApiPoolData:n=>{const m=D().posApiPoolData;P(()=>({posApiPoolData:{...m,...n}}))},myPosYieldValue:"",setMyPosYieldValue:n=>{P(()=>({myPosYieldValue:n}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:n=>{const m=n.reduce((y,i)=>{var l,d,a;return y[i.clmmPool]||(y[i.clmmPool]={list:[]}),(l=y[i.clmmPool])!=null&&l.tokenA||(y[i.clmmPool].isReverse=i==null?void 0:i.isReverse,y[i.clmmPool].tokenA=i==null?void 0:i.tokenA,y[i.clmmPool].tokenB=i==null?void 0:i.tokenB,y[i.clmmPool].displayTokenA=i==null?void 0:i.displayTokenA,y[i.clmmPool].displayTokenB=i==null?void 0:i.displayTokenB,y[i.clmmPool].clmmPoolAddress=i.clmmPool),(a=(d=y[i.clmmPool])==null?void 0:d.list)==null||a.push(i),y},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",m),P(()=>({posBaseList:n,posBaseListGroupByPool:m,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:n=>{P(()=>({posBaseListLoading:n}))},fullRangePosBaseList:[],setFullRangePosBaseList:n=>{P(()=>({fullRangePosBaseList:n,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:n=>{P(()=>({fullRangePosBaseListLoading:n}))},posPoolsOriginalData:{},setPosPoolOriginalData:n=>{P(()=>({posPoolsOriginalData:n}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:n=>{const m=D().posPoolsRelatedData;P(()=>({posPoolsRelatedData:{...m,...n},posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:n=>{P(()=>({posPoolsRelatedDataLoading:n}))},posLiquidityData:{},setPosLiquidityData:n=>{const m=D().posLiquidityData;P(()=>({posLiquidityData:{...m,...n},posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:n=>{P(()=>({posLiquidityDataLoading:n}))},posRewardsData:{},setPosRewardsData:n=>{const m=D().posRewardsData;P(()=>({posRewardsData:{...m,...n},posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:n=>{P(()=>({posRewardsDataLoading:n}))},farmsPosRewardsData:{},setFarmsPosRewardsData:n=>{P(()=>({farmsPosRewardsData:n,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:n=>{P(()=>({farmsPosRewardsDataLoading:n}))},posFeeData:{},setPosFeeData:n=>{const m=D().posFeeData;P(()=>({posFeeData:{...m,...n},posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:n=>{P(()=>({posFeeDataLoading:n}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:n=>{P(()=>({currentPosBaseInfo:n,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:n=>{P(()=>({currentPosBaseInfoLoading:n}))}}),F=$(K);function ee(){const P=q("farms"),{getTokenListInfo:D}=O(),{setFarmsPosRewardsData:n,setFarmsPosRewardsDataLoading:m}=F();return{getFarmsRewardsData:async l=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",l),m(!0);const d=l==null?void 0:l.filter(a=>a.posType==="farms").map(a=>({pool_id:a.farmsPool,position_nft_id:a.id}));try{let a={};if(d&&d.length>0){const s=await P.Farms.calculateFarmingRewards(d);if(console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",s,P.getSenderAddress(),d),s){const e=Object.entries(s).map(([o,u])=>({id:o,rewarderAmountOwed:u}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",e);const r=e.map(o=>o.rewarderAmountOwed.map(u=>u.rewarder_type)).flat(),t=await D(r);a=Object.fromEntries(e.map((o,u)=>{for(const f of o.rewarderAmountOwed){const{rewarder_amount:p,rewarder_type:_}=f,g=t==null?void 0:t.get(_);f.display_amount_owed=b(p.toString(),(g==null?void 0:g.decimals)||0),f.amount_owed=p.toString(),f.token=g}return[o.id,o.rewarderAmountOwed]}))}}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",a),n(a)}catch(a){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",a)}},formatFarmsRewardsData:async l=>{let d={};const a=Object.entries(l).map(([r,t])=>({id:r,rewarderAmountOwed:t}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",a);const s=a.map(r=>r.rewarderAmountOwed.map(t=>t.rewarder_type)).flat(),e=await D(s);return d=Object.fromEntries(a.map((r,t)=>{for(const o of r.rewarderAmountOwed){const{rewarder_amount:u,rewarder_type:f}=o,p=e==null?void 0:e.get(f);o.display_amount_owed=b(u.toString(),(p==null?void 0:p.decimals)||0),o.amount_owed=u.toString(),o.token=p}return[r.id,r.rewarderAmountOwed]})),d}}}function oe(){const{setPosApiPoolData:P}=F(),{getFavoritePoolList:D}=M();return{getPosApiPoolData:async m=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",m);const i={needLocalData:!1,pools:Array.from(new Set(m==null?void 0:m.map(a=>a.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",i);const l=await D(i)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",l);const d=l==null?void 0:l.list.reduce((a,s)=>(a[s.poolAddress]=s,a),{});P(d)}catch(y){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",y)}}}}function se(){const P=q("clmm"),{setPosFeeData:D,setPosFeeDataLoading:n}=F(),m=async i=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",i),n(!0);const l=i==null?void 0:i.map(s=>({pool_id:s.clmmPool,position_id:s.posId,coin_type_a:s.coinTypeA,coin_type_b:s.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",l);const d=await P.Position.fetchPosFeeAmount(l)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",d);const a=await y(d,i);console.log("getPosFeeData ~ posFeesData:",a),D(a)},y=async(i,l)=>Object.fromEntries(i.map((a,s)=>{var o,u;const e=l[s],r=b(e.isReverse?a.fee_owned_b.toString():a.fee_owned_a.toString(),((o=e==null?void 0:e.displayTokenA)==null?void 0:o.decimals)||0),t=b(e.isReverse?a.fee_owned_a.toString():a.fee_owned_b.toString(),((u=e==null?void 0:e.displayTokenB)==null?void 0:u.decimals)||0);return[a.position_id,{feeOwedA:a.fee_owned_a.toString(),feeOwedB:a.fee_owned_b.toString(),displayFeeOwedA:r,displayFeeOwedB:t}]}));return{getPosFeeData:m,formatPosFeeData:y}}function te(){const{setPosLiquidityData:P,setPosLiquidityDataLoading:D}=F(),{getTokenInfo:n}=O(),m=({tokenA:i,tokenB:l,liquidity:d,currentSqrtPrice:a,lowerTick:s,upperTick:e,roundUp:r})=>{const t=S.tickIndexToSqrtPriceX64(s),o=S.tickIndexToSqrtPriceX64(e),u=V.getCoinAmountFromLiquidity(new v(d),new v(a),t,o,r),f=u.coin_amount_a.toString(),p=u.coin_amount_b.toString(),_=i.decimals,g=l.decimals,c=b(f,_||0),w=b(p,g||0);return{coinAmountA:f,coinAmountB:p,amountA:c,amountB:w}};return{getPosLiquidityData:async(i,l)=>{var a,s;D(!0);const d={};for(let e=0;e<i.length;e++){const r=i[e],t=l==null?void 0:l[r.clmmPool],{coinAmountA:o,coinAmountB:u,amountA:f,amountB:p}=m({tokenA:r.tokenA,tokenB:r.tokenB,liquidity:r.liquidity,currentSqrtPrice:t==null?void 0:t.current_sqrt_price,lowerTick:r.lowerTick,upperTick:r.upperTick,roundUp:!0}),_=U(r.lowerTick,r.upperTick);let g=r.tokenA.decimals,c=r.tokenB.decimals;g==null&&(g=(a=await n(r.tokenA.coin_type))==null?void 0:a.decimals),c==null&&(c=(s=await n(r.tokenB.coin_type))==null?void 0:s.decimals);const w=S.sqrtPriceX64ToPrice(new v(t==null?void 0:t.current_sqrt_price),g,c).toString(),{percentA:k,percentB:A}=Z(f,p,w,_),R=b(o,g),N=b(u,c),I=T(N).div(w).add(R).toString(),X=T(R).mul(w).add(N).toString();d[r.posId]={coinAmountA:o,coinAmountB:u,displayCoinAmountA:r.isReverse?p:f,displayCoinAmountB:r.isReverse?f:p,displayPercentA:r.isReverse?A:k,displayPercentB:r.isReverse?k:A,onlyAmountA:I,onlyAmountB:X}}console.log("getPosLisuidityData ~ posLiquidityData:",d),P(d)},getCoinAmountFromLiquidity:m}}function ae(){const P=q("clmm"),{setPosPoolOriginalData:D,setPosPoolsRelatedData:n,setPosPoolsRelatedDataLoading:m,setFullRangePosBaseList:y,setFullRangePosBaseListLoading:i}=F();return{getPosPoolsOriginalObj:async a=>{const s=a==null?void 0:a.map(t=>t.clmmPool),e=[...new Set([...s])];let r={};if(e&&e.length>0){const t=await P.Pool.getAssignPools(e);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",t),r=Object.fromEntries(t==null?void 0:t.map(o=>{const u=a.find(c=>c.clmmPool===(o==null?void 0:o.id)),f=u.tokenA.decimals,p=u.tokenB.decimals,_=S.sqrtPriceX64ToPrice(new v(o==null?void 0:o.current_sqrt_price),f,p).toString(),g=T(1).div(_).toString();return[o==null?void 0:o.id,{...o,currentPrice:_,currentPriceReverse:g,coinAmountA:String(o.coin_amount_a),coinAmountB:String(o.coin_amount_b),coinTypeA:o.coin_type_a,coinTypeB:o.coin_type_b,poolAddress:o.id,poolType:o.pool_type,tickSpacing:Number(o.tick_spacing),current_sqrt_price:String(o.current_sqrt_price),fee_growth_global_a:String(o.fee_growth_global_a),fee_growth_global_b:String(o.fee_growth_global_b),fee_protocol_coin_a:String(o.fee_protocol_coin_a),fee_protocol_coin_b:String(o.fee_protocol_coin_b),fee_rate:String(o.fee_rate),liquidity:String(o.liquidity),rewarder_infos:o.rewarder_infos.map(c=>({coinAddress:c.coin_type,emissionsEveryDay:c.emissions_per_second,emissions_per_second:String(c.emissions_per_second),growth_global:String(c.growth_global)}))}]}))}return D(r),r},getPosPoolsRelatedData:(a,s)=>{m(!0),i(!0);const e={},r=[];a.forEach(t=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",t);const o=s[t.clmmPool],u=t.tokenA.decimals,f=t.tokenB.decimals,p=S.sqrtPriceX64ToPrice(new v(o==null?void 0:o.current_sqrt_price),u,f).toString(),_=T(1).div(p).toString();let g="0",c="0";G(t.lowerTick,"min")?g="0":g=S.tickIndexToPrice(Number(t.lowerTick),u,f).toString(),G(t.upperTick,"max")?c="âˆž":c=S.tickIndexToPrice(Number(t.upperTick),u,f).toString();let w,k;c!=="âˆž"?k=T(1).div(T(c)).toString():k="0",g!=="0"?w=T(1).div(T(g)).toString():w="âˆž";let A="";o!=null&&o.is_pause?A="Closed":Number(p)>=Number(g)&&(c==="âˆž"||Number(p)<=Number(c))?A="Active":(Number(p)>Number(c)||Number(p)<Number(g))&&(A="Inactive"),(g==="0"&&c==="âˆž"||w==="0"&&k==="âˆž")&&t.posType==="clmm"&&r.push(t);const R=t.isReverse;e[t.posId]={currentPrice:o?B(R?_:p).toString():"",currentPriceReverse:o?B(R?p:_).toString():"",minPrice:B(R?k:g).toString(),minPriceResever:B(R?g:k).toString(),maxPrice:B(R?w:c).toString(),maxPriceResever:B(R?c:w).toString(),minPriceOrigin:o?R?k:g:"",maxPriceOrigin:o?R?w:c:"",currentStatus:o?A:"",fee:o==null?void 0:o.fee_rate,displayFee:T(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),n(e),y(r)}}}function re(){const P=q("clmm"),{getTokenListInfo:D}=O(),{setPosRewardsData:n,setPosRewardsDataLoading:m}=F();return{formatPosRewardsData:async l=>{let d={};const a=l==null?void 0:l.map(e=>e.rewarderAmountOwed.map(r=>r.coin_address)).flat(),s=await D(a);return d=Object.fromEntries(l.map(e=>{for(const r of e.rewarderAmountOwed){const{amount_owed:t,coin_address:o}=r,u=s==null?void 0:s.get(o);r.display_amount_owed=b(t.toString(),(u==null?void 0:u.decimals)||0),r.amount_owed=t.toString(),r.token=u}return[e.positionId,e.rewarderAmountOwed]})),d},getPosRewardsData:async(l,d)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",l),m(!0);const a=l==null?void 0:l.filter(e=>e.posType!=="farms").map(e=>{var t;const r=d[e.clmmPool];return{pool_id:e.clmmPool,position_id:e.posId,coin_type_a:e.coinTypeA,coin_type_b:e.coinTypeB,rewarder_types:(t=r.rewarder_infos)==null?void 0:t.map(o=>o.coinAddress)}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",a);let s={};if(a&&a.length>0)try{const e=await P.Rewarder.fetchPosRewardersAmount(a),r=e==null?void 0:e.map(u=>u.rewarder_amounts.map(f=>f.coin_type)).flat(),t=await D(r);let o;s=Object.fromEntries(e.map((u,f)=>{o=[];for(const p of u.rewarder_amounts){const{amount_owned:_,coin_type:g}=p,c=t==null?void 0:t.get(g);o.push({...p,display_amount_owed:b(_.toString(),(c==null?void 0:c.decimals)||0),amount_owed:_.toString(),token:c,coin_address:g})}return[u.position_id,o]})),console.log("getPosRewardsData ~ posRewardsData:",s)}catch(e){console.log("getPosRewardsData ~ error:",e)}n(s)}}}function E(){const P=(l,d)=>{if(d||d==0)return`Cetus LP | Pool${d}-${l}`},D=j.useMemo(()=>`${C.clmm_pool.package_id}::position::Position`,[x]),n=j.useMemo(()=>`${W.farms.package_id}::pool::WrappedPositionNFT`,[x]),m=j.useMemo(()=>`${Y.burn.package_id}::lp_burn::CetusLPBurnProof`,[x]);return{getClmmPosName:P,buildPositionType:D,buildFarmsPositionType:n,buildBurnPositionType:m,getTokenALock:(l,d)=>{if(h(l)&&h(d)){const{lowerTick:a,upperTick:s}=l,e=d==null?void 0:d.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s?!1:e>=s?!0:!(e<a)}return!1},getTokenBLock:(l,d)=>{if(h(l)&&h(d)){const{lowerTick:a,upperTick:s}=l,e=d==null?void 0:d.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s||e>=s?!1:(e<a,!0)}return!1}}}function ne(){const{buildPositionType:P,buildFarmsPositionType:D,buildBurnPositionType:n}=E(),{getTokenListInfo:m}=O(),y=async(s,e)=>{const r=!z(s,e),t=await m([s,e]),o=t==null?void 0:t.get(s),u=t==null?void 0:t.get(e);return{isReverse:r,tokenA:o,tokenB:u,displayTokenA:r?u:o,displayTokenB:r?o:u}},i=async s=>{var c;const e=H(s),r=L(e.coin_type_a).full_address,t=L(e.coin_type_b).full_address,{isReverse:o,tokenA:u,tokenB:f,displayTokenA:p,displayTokenB:_}=await y(r,t),g=((c=s==null?void 0:s.data)==null?void 0:c.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:r,coinTypeB:t,posType:"clmm",tokenName:"",tokenA:u,tokenB:f,displayTokenA:p,displayTokenB:_,isReverse:o,version:g}},l=async s=>{var c;const e=Q.buildFarmsPositionNFT(s),r=((c=s==null?void 0:s.data)==null?void 0:c.version)||"0",t=L(e.coin_type_a).full_address,o=L(e.coin_type_b).full_address,{isReverse:u,tokenA:f,tokenB:p,displayTokenA:_,displayTokenB:g}=await y(t,o);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:t,coinTypeB:o,posType:"farms",tokenName:e.name,isReverse:u,tokenA:f,tokenB:p,displayTokenA:_,displayTokenB:g,version:r}},d=async s=>{var c,w,k;const e=J.buildBurnPositionNFT((w=(c=s==null?void 0:s.data)==null?void 0:c.content)==null?void 0:w.fields),r=((k=s==null?void 0:s.data)==null?void 0:k.version)||"0",t=L(e.coin_type_a).full_address,o=L(e.coin_type_b).full_address,{isReverse:u,tokenA:f,tokenB:p,displayTokenA:_,displayTokenB:g}=await y(t,o);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:t,coinTypeB:o,posType:"burn",tokenName:e.name,isReverse:u,tokenA:f,tokenB:p,displayTokenA:_,displayTokenB:g,version:r}};return{wrapClmmPosBaseInfo:i,wrapBurnPosBaseInfo:d,wrapFarmsPosBaseInfo:l,buildPosBaseInfo:async s=>{const e=L(s.data.type);return e.full_address===P?await i(s):e.full_address===D?await l(s):e.full_address===n?await d(s):null}}}function ge(){const P=q("clmm"),{buildFarmsPositionType:D,buildBurnPositionType:n}=E(),{buildPosBaseInfo:m}=ne(),{setPosBaseList:y,setFullRangePosBaseList:i,setPosBaseListLoading:l}=F(),{getPosPoolsOriginalObj:d,getPosPoolsRelatedData:a}=ae(),{getPosLiquidityData:s}=te(),{getPosFeeData:e}=se(),{getPosApiPoolData:r}=oe(),{getPosRewardsData:t}=re(),{getFarmsRewardsData:o}=ee(),u=async(_,g)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",g),l(!0);try{const c=await P.FullClient.getOwnedObjectsByPage(_,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:C.clmm_pool.package_id},{StructType:D},{StructType:n}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",c);let w=await f(c,g);return y(w),l(!1),(w==null?void 0:w.length)==0&&i([]),w}catch(c){return console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",c),c instanceof TypeError?(l(!1),y([]),[]):[]}},f=async(_,g)=>{const c=[];for(const A of _.data){const R=await m(A);T(R==null?void 0:R.liquidity).lte(0)||!(R!=null&&R.displayTokenA)||!(R!=null&&R.displayTokenB)||R&&c.push(R)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",c);const w=c.sort((A,R)=>R.version-A.version);let k=[];return g?k=w==null?void 0:w.filter(A=>A.clmmPool===g):k=w,k};return{formatPosBaseList:f,getPositionBaseList:u,getPosRelatedData:async(_,g=!1)=>{var c;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",g,_),o(_),g||(console.log("ðŸš€ ~ getPosRelatedData ~ isFarms:",_),r(_),e(_));try{const w=await d(_);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",w),a(_,w),((c=Object.keys(w))==null?void 0:c.length)>0&&(s(_,w),g||t(_,w))}catch(w){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",w)}}}}export{F as a,se as b,re as c,E as d,ae as e,te as f,ee as g,ne as h,ge as u};
//# sourceMappingURL=usePositionList-BaYucLl_.js.map
