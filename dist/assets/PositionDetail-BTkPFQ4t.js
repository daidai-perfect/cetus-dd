import{a as n,j as i,a6 as qe,T as w,V as H,H as r,p as le,al as Si,q as Oe,R as vi,f as Ue,ak as _i,ay as Ci}from"./vendor-BowHGuwE.js";import{A as Ri}from"./index-DPKcMUp_.js";import{C as Li}from"./CoinPairInfo-2vGf4-hW.js";import{v as ei,S as Fi}from"./usePriceImpact-BIoeWpyw.js";import{u as Mi,L as Ei,S as Ee}from"./LiquidityRangeChart-TyX03j37.js";import{u as Di,P as Wi}from"./PositionCurrentPrice-dUncy_W5.js";import{b as Vi}from"./useClaimPosition-DmR0MUnL.js";import{a as ke,b as Ye}from"./useNotifiSubscription-55mM24ly.js";import{u as re,a as oi,e as Ni,f as Zi}from"./usePositionList-B802Vh58.js";import{z as se,a as $e,B as de,e as ii,X as Te,R as xi,d as pe,h as ni,r as Qe,x as zi,a0 as Gi,n as Xe,m as li,a2 as Hi,w as qi,a3 as si,$ as Oi,Z as Ui,a1 as Yi,a9 as $i,f as Qi,y as ti,j as Xi}from"./index-C2ps9-Dy.js";import{S as Ji,A as Ki}from"./SingleTokenInfo-DIrFWCBu.js";import{L as fi}from"./ExpendItem-CPm9nAfZ.js";import{c as Bi,e as Ii,a as Pi,i as el,T as il,g as ll,Z as sl,F as tl,R as al,b as pl,j as dl}from"./RemoveBlock-Dd2q82D4.js";import{a as ol,u as xl}from"./useTransaction-Ck5-rOQU.js";import{u as mi}from"./global-BoVQYRiM.js";import{f as De}from"./index-Boni-CYJ.js";import{u as ci}from"./useAccountBalance-B0xlJzQj.js";import{u as ai}from"./useTokenBalance-eEyVQXxK.js";import{u as nl}from"./useInsufficientBalanceToast-BdP-JqEM.js";import{u as ml}from"./usePosAdd-CChK0lk4.js";import{T as cl}from"./TradeInputGroup-BqBvRaPG.js";import{T as gl}from"./TooltipIcon-BfbnL_ik.js";import{P as rl}from"./PositionStatus-BGCbpj7Q.js";import{R as bl}from"./RangeValue-DWfWcPYm.js";import{u as hl}from"./index-D2IlHd3Z.js";import{b as jl,u as yl}from"./useGetPoolList-BvCBEPsL.js";import{u as wl}from"./swapWidget-CRKQkd0I.js";import{B as Tl}from"./BackButton-BZiYsQVm.js";import{R as pi}from"./RefreshButton-BWpjf_f7.js";import{u as kl}from"./useRpcListener-DeWebjhk.js";import"./PoweredByHaedal-uLEk4Xbu.js";import"./useSwapHelper-cv5rkCZQ.js";import"./useToken-CE5Fcadt.js";import"./HTextLabelBox-CQuTbPJv.js";import"./VTextLabelBox-CVt1crGp.js";import"./linear-DYpwdEgO.js";import"./liquidity-DzBubAPD.js";import"./usePreviousValue-ChnvxeJQ.js";import"./ActionButton-DOFa-oIM.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-DZ1jccss.js";import"./useXCetusHelper-BE6VRSYi.js";import"./index-DoMH3iiU.js";import"./debounce-0tBm08Ev.js";import"./index-V0MTi46y.js";import"./useFavoritePool-B6oF_6s2.js";import"./useWrapPoolData-BaqaQLpY.js";import"./CopyButton-Cjlcf9Y-.js";import"./DepositRatio-ChoYKfgJ.js";import"./FreshProgressV2-b6RZXCN2.js";import"./ErrorTips-CPMkm2Zu.js";import"./useTrack-B_zQnmjy.js";import"./useSigner-BdKZjEAY.js";import"./_getAllKeysIn-CoLSYt1_.js";function ul(){var W,v,Y,N,V,u;const{tokenAmountAfterA:e,tokenAmountAfterB:o,currentPosDetailTab:p,curPosContractPoolInfo:t}=ke(),{currentPosBaseInfo:s,posFeeData:c,posRewardsData:g,posLiquidityData:R,currentPosBaseInfoLoading:a,posFeeDataLoading:A,posRewardsDataLoading:_}=re();Ye();const x=n.useMemo(()=>R[s==null?void 0:s.posId],[R,s==null?void 0:s.posId]),k=n.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",c[s==null?void 0:s.posId]),c[s==null?void 0:s.posId]),[c,s==null?void 0:s.posId]),M=n.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",g[s==null?void 0:s.posId]),g[s==null?void 0:s.posId]),[g,s==null?void 0:s.posId]);se(x==null?void 0:x.displayCoinAmountA,void 0,!0),se(x==null?void 0:x.displayCoinAmountB,void 0,!0);const[m,z]=n.useState("--"),{calculatePendingYield:l}=Di();n.useEffect(()=>{if(!a&&!A&&!_){const{total:C}=l([s],c,g);z(C)}},[a,A,_]);const{toClaimPosition:L,isClaimLoading:E}=Vi(),Z=()=>{L(s,t)},T=e!==""||o!=="",{isApp:D}=$e();return i.jsxs(de,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(de,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(qe,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(w,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(fi,{positionInfo:s,haveTooltip:!1})]}),i.jsxs(H,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(r,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(r,{gap:"4px",children:[i.jsx(ii,{imageUrl:(W=s==null?void 0:s.displayTokenA)==null?void 0:W.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(v=s==null?void 0:s.displayTokenA)==null?void 0:v.coin_type:""}),i.jsx(le,{isLoaded:!!s&&!!x,children:i.jsxs(r,{gap:"4px",children:[i.jsx(w,{color:"primary",children:Te((Y=s==null?void 0:s.displayTokenA)==null?void 0:Y.symbol)}),i.jsxs(w,{color:"primary",children:[x==null?void 0:x.displayPercentA,"%"]})]})})]}),i.jsxs(r,{gap:"4px",children:[i.jsx(ii,{imageUrl:(N=s==null?void 0:s.displayTokenB)==null?void 0:N.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(V=s==null?void 0:s.displayTokenB)==null?void 0:V.coin_type:""}),i.jsx(le,{isLoaded:!!s&&!!x,children:i.jsxs(r,{gap:"4px",children:[i.jsx(w,{color:"primary_green",children:Te((u=s==null?void 0:s.displayTokenB)==null?void 0:u.symbol)}),i.jsxs(w,{color:"primary_green",children:[x==null?void 0:x.displayPercentB,"%"]})]})})]})]}),i.jsx(Si,{w:"200px",h:"4px",value:x==null?void 0:x.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(r,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(we,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:x==null?void 0:x.displayCoinAmountA,afterAmount:e}),i.jsx(we,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:x==null?void 0:x.displayCoinAmountB,afterAmount:o})]}),i.jsx(de,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(r,{w:"100%",justify:"space-between",children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(w,{color:"primary_gray",children:"Pending Yield"}),i.jsx(le,{isLoaded:!!m&&!!s&&!!c&&!!g,children:i.jsx(w,{color:"text_caption",fontSize:"16px",children:xi(m,2)})})]}),i.jsx(Oe,{isLoading:E,disabled:Number(m)==0||A||_||E||!k,onClick:Z,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(r,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(we,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:k==null?void 0:k.displayFeeOwedA,afterAmount:T?"0":""}),i.jsx(we,{label:D?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:k==null?void 0:k.displayFeeOwedB,afterAmount:T?"0":""}),M==null?void 0:M.map((C,$)=>i.jsx(vi.Fragment,{children:pe(C.amount_owed).gt(0)&&i.jsx(we,{label:D?$==0?"Mining Rewards":"":"Mining Rewards",token:C==null?void 0:C.token,amount:C==null?void 0:C.display_amount_owed,afterAmount:T?"0":""})},C==null?void 0:C.coin_address))]})]})}const we=({label:e,token:o,amount:p,afterAmount:t,isLoading:s})=>{const{isApp:c}=$e(),{getExplorerUrl:g}=ni();return i.jsxs(H,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(r,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(w,{color:"primary_gray",children:e}),i.jsxs(r,{children:[i.jsx(Ue,{onClick:c?()=>window.open(g(o==null?void 0:o.coin_type,"coin")):()=>{},children:i.jsx(Ji,{haveTooltip:!c,coinType:o?o==null?void 0:o.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(le,{isLoaded:!s&&!!p,children:i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:se(p)})}),i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:Te(o==null?void 0:o.symbol)})]})]}),t!==""&&t&&i.jsxs(r,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",children:se(t)}),i.jsx(w,{color:"primary",children:"after"})]})]})};function Al(){const{currentPosBaseInfo:e,posPoolsOriginalData:o,posPoolsRelatedData:p,posRewardsData:t,posLiquidityData:s}=re(),c=t[e==null?void 0:e.posId],{getTokenAmountValue:g}=Qe(),{transactionConfirmation:R}=ol(),{preAdd:a,getAddTsPayload:A,getClmmCreateAddData:_,getFarmsCreateAddData:x}=ml(),{getTokenALock:k,getTokenBLock:M}=oi(),{getCurrentPosBaseInfo:m}=Ye(),{setTokenAmountAfterA:z,setTokenAmountAfterB:l,currentPoolSqrtPrice:L,isFixedDisplayTokenA:E,setIsFixedDisplayTokenA:Z,curPosContractPoolInfo:T,currentPosDetailTab:D,isPosDetailRefresh:W,useZapIn:v}=ke(),{getZapDepositToastInfo:Y,getZapDepositTx:N,reCalculateZapData:V}=Bi(),{preDepositeData:u,setZapAmount:C,setPreDepositeData:$}=Ii(),[G,q]=n.useState(!1),[te,oe]=n.useState(""),[ue,Ae]=n.useState(""),[F,B]=n.useState(""),[S,Q]=n.useState(""),X=n.useMemo(()=>s[e==null?void 0:e.posId],[s,e==null?void 0:e.posId]),Se=se(X==null?void 0:X.displayCoinAmountA,void 0,!0),h=se(X==null?void 0:X.displayCoinAmountB,void 0,!0);n.useEffect(()=>{if(+F||+S){const d=+F,j=+S;z(pe(d).plus(Se).toString()),l(pe(j).plus(h).toString())}else z(""),l("")},[F,S]);const y=e==null?void 0:e.displayTokenA,b=e==null?void 0:e.displayTokenB,{mevProtect:We,maxCapForGas:ve,transactionMode:_e,customGasPrice:J}=mi(),{balanceInfo:be}=ai(y),{balanceInfo:he}=ai(b),gi=g(y==null?void 0:y.coin_type,F),ri=g(b==null?void 0:b.coin_type,S),[Ve,Ne]=n.useState(""),Je=n.useRef("");n.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",Ve),Je.current=Ve},[Ve]);const je=()=>{B(""),Q(""),q(!1),Ne("")},Ce=n.useMemo(()=>k(e,T),[T==null?void 0:T.current_tick_index,e]),Re=n.useMemo(()=>M(e,T),[T==null?void 0:T.current_tick_index,e]),Ze=e!=null&&e.isReverse?Re:Ce,ze=e!=null&&e.isReverse?Ce:Re;n.useEffect(()=>{je()},[Ze,ze]);const Ke=zi((d,j,O)=>{var ge,f;if(D!=="increase")return;const U=j?(ge=e==null?void 0:e.displayTokenA)==null?void 0:ge.decimals:(f=e==null?void 0:e.displayTokenB)==null?void 0:f.decimals,ye=Gi(d,U),Fe=e==null?void 0:e.tokenA,I=e==null?void 0:e.tokenB,P=e==null?void 0:e.lowerTick,xe=e==null?void 0:e.upperTick,ne=e==null?void 0:e.isReverse,ee={amount:ye,tokenA:Fe,tokenB:I,isTokenA:ne?!j:j,lowerTick:P,upperTick:xe,curSqrtPrice:L,isReverse:ne,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",ee);const{displayCoinAmountA:ae,displayCoinAmountB:me,tokenMaxA:ce,tokenMaxB:ie}=a(ee);Je.current===O?(oe(ce),Ae(ie),j?Q(me||""):B(ae||"")):je(),q(!1)},500),Le=()=>{if((F||S)&&Hi(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const d=E?F:S;if(+d){const j=ei();Ne(j),Ke(d,E,j)}}};n.useEffect(()=>{D=="increase"&&W&&Le()},[W]);const bi=(d,j)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!d,+d,d),!d){je();return}if(Z(j),j?B(d):Q(d),+d){q(!0);const O=ei();Ne(O),console.log("ðŸš€ ~ handleAmountChange ~ params:",d),Ke(d,j,O)}else j?Q(""):B("")},{currentAccount:K}=Xe(),hi=n.useMemo(()=>{const d={text:"Add More Liquidity",disabled:!1};return K!=null&&K.address?!+F&&!+S?(d.text="Enter an amount",d.disabled=!0,d):!Ze&&F&&pe(F).gt((be==null?void 0:be.balanceFormat)||0)?(d.disabled=!0,d.text=`Insufficient ${Te(y==null?void 0:y.symbol,10)} Balance`,d):!ze&&S&&pe(S).gt((he==null?void 0:he.balanceFormat)||0)?(d.disabled=!0,d.text=`Insufficient ${Te(b==null?void 0:b.symbol,10)} Balance`,d):((!Ce&&!Re&&(!+F||!+S)||(e==null?void 0:e.posType)=="burn")&&(d.disabled=!0),d):(d.text="Connect Wallet",d.disabled=!1,d)},[F,S,be,he,K==null?void 0:K.address]),{signAndExecuteTransaction:ji}=xl(),{getContractPoolInfo:yi}=Pi(),[wi,Ge]=n.useState(!1),{fetchAccountBalance:Ti}=ci(),{showInsufficientBalanceToast:ki}=nl(),ui=async()=>{var d;Ge(!0);try{let j,O,U;const ye=(d=c||[])==null?void 0:d.reduce((I,P)=>(pe(P==null?void 0:P.amount_owed).gt(0)&&I.push(P.coin_address),I),[]);if(v)U=Y(),R(U),j=await N(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:ye});else{const I=E?F:S,P=E?y.decimals:b.decimals,xe=pe(I).mul(qi.pow(10,P)).toString(),ne=e!=null&&e.isReverse?!E:E;let ee,ae;const me=e==null?void 0:e.lowerTick,ce=e==null?void 0:e.upperTick,ie=T==null?void 0:T.current_tick_index;ie!==void 0&&me!==void 0&&ce!==void 0&&(ie>=me&&ie<=ce?(ee=ne?xe:te,ae=ne?ue:xe):ie>ce?(ee=0,ae=xe):ie<me&&(ee=xe,ae=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",me,ce,ie),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,ee,ae),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",c,ye);const ge={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:ee,amountB:ae,fixAmountA:ne,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:L,posType:e==null?void 0:e.posType,rewarderCoinTypes:ye,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(ge.farmsPoolId=e==null?void 0:e.farmsPool),U={getShowInfo:(Ai,He)=>{const fe="Add "+[De(F,y==null?void 0:y.symbol),De(S,b==null?void 0:b.symbol)].filter(Boolean).join(" and "),Me={modalDescriptionText:fe,toastTitleText:fe};if(Ai==="success"){let Be=F,Ie=S;He&&(Be=si(He,y)||F,Ie=si(He,b)||S);const Pe="Add "+[De(Be,y==null?void 0:y.symbol),De(Ie,b==null?void 0:b.symbol)].filter(Boolean).join(" and ");Me.toastDescriptionContent=Pe,Me.modalDescriptionText=Pe,Me.toastTitleText="Supplied Successful"}return Me}},R(U),console.log("ðŸš€ ~ toAdd ~ params:",ge);const f=await A(ge);j=f==null?void 0:f.tx,O=f==null?void 0:f.msafeParams}const Fe=await ji(j,U,{useMev:We,useFastMode:_e==="Fast Mode",maxCapForGas:ve,customGasPrice:J,msafeParams:O});console.log("ðŸš€ ~ toClaim ~ res:",Fe),Fe?(Ti(),je(),C(""),m(K==null?void 0:K.address,e==null?void 0:e.id,!0)):e&&yi(e==null?void 0:e.clmmPool).then(I=>{console.log("ðŸš€ ~ toClaim ~ res:",I),v?V():Le()}),Ge(!1)}catch(j){console.log("ðŸš€ ~ toClaim ~ error:",j),v?V():Le(),ki(String(j)),Ge(!1)}};return n.useEffect(()=>{if(D==="increase"&&v){if(u!=null&&u.amount_a||u!=null&&u.amount_b){const d=e==null?void 0:e.tokenA,j=e==null?void 0:e.tokenB,O=li(u==null?void 0:u.amount_a,d==null?void 0:d.decimals),U=li(u==null?void 0:u.amount_b,j==null?void 0:j.decimals);B(e!=null&&e.isReverse?U:O),Q(e!=null&&e.isReverse?O:U);return}B(""),Q("")}},[v,u,e==null?void 0:e.isReverse]),n.useEffect(()=>(B(""),Q(""),()=>{$(void 0)}),[]),{tokenAmountA:F,tokenAmountB:S,reCalculateResult:Le,preAddLoading:G,preAdd:a,getAddTsPayload:A,displayTokenA:y,displayTokenB:b,tokenABalanceInfo:be,tokenBBalanceInfo:he,tokenAmountValueA:gi,tokenAmountValueB:ri,handleAmountChange:bi,resetInputAmount:je,btnStatusText:hi,toAdd:ui,isAddLoading:wi,showTokenALock:Ce,showTokenBLock:Re,showDisplayTokenALock:Ze,showDisplayTokenBLock:ze,getClmmCreateAddData:_,getFarmsCreateAddData:x,currentPoolSqrtPrice:L}}function Sl(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posApiPoolData:p}=re(),{currentAccount:t,onWalletModal:s}=Xe(),{isFixedDisplayTokenA:c,curPosContractPoolInfo:g,useZapIn:R,currentPosPoolInfo:a}=ke(),{tokenAmountA:A,tokenAmountB:_,displayTokenA:x,displayTokenB:k,tokenABalanceInfo:M,tokenBBalanceInfo:m,tokenAmountValueA:z,tokenAmountValueB:l,handleAmountChange:L,preAddLoading:E,btnStatusText:Z,toAdd:T,isAddLoading:D,showDisplayTokenALock:W,showDisplayTokenBLock:v,resetInputAmount:Y,currentPoolSqrtPrice:N}=Al();n.useEffect(()=>()=>{Y()},[]);const{getTokenAmountValue:V}=Qe(),u=V(x==null?void 0:x.coin_type,A,"--"),C=V(k==null?void 0:k.coin_type,_,"--"),$=u=="--"||C=="--"?"--":Oi(z).plus(l).toString(),G=o[e==null?void 0:e.posId],{currentApiPoolInfo:q}=el(e,p);return i.jsxs(H,{w:"100%",gap:"8px",children:[i.jsxs(Ue,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(q==null?void 0:q.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!W&&!v&&i.jsx(il,{action:"Deposit",resetInputAmount:Y}),R?i.jsx(ll,{action:"Deposit",apiPoolInfo:q,currentSqrtPrice:N,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(cl,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(M==null?void 0:M.balanceFormat)||"",value:A,amountValue:z,loading:!c&&E,onChange:te=>{L(te,!0)},placeholder:"0.0",token:x,lock:{isLock:e&&g&&W,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(m==null?void 0:m.balanceFormat)||"",value:_,amountValue:l,loading:c&&E,onChange:te=>{L(te,!1)},placeholder:"0.0",token:k,lock:{isLock:e&&g&&v,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:W||v?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!g||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),R?i.jsx(sl,{action:"Deposit",onClick:T,hideDepositRatio:!0,otherLoading:D,isReverse:e==null?void 0:e.isReverse}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>{t?T():s(!0)},isLoading:D,disabled:Z.disabled||D,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:Z.text}),$&&i.jsx(de,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(r,{w:"100%",justify:"space-between",children:[i.jsx(w,{children:"Total Amount"}),i.jsx(w,{color:"text_caption",children:xi($,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&i.jsx(tl,{haveFarming:a==null?void 0:a.haveFarming}),G&&(G==null?void 0:G.minPrice)!=="0"&&(G==null?void 0:G.maxPrice)!=="âˆž"&&i.jsx(al,{subscriptionSource:"PositionDetail"})]})}function vl(){const{currentPosBaseInfo:e}=re(),{currentPosPoolInfo:o,curPosContractPoolInfo:p}=ke(),{setContractPoolInfo:t,setApiPoolInfo:s}=hl(),{lowerTickData:c,upperTickData:g,setLowerTickData:R,setUpperTickData:a}=Mi();Ui(()=>{s(o)},[o]);const A=(k,M,m)=>{var W,v;const z=(W=m==null?void 0:m.tokenA)==null?void 0:W.decimals,l=(v=m==null?void 0:m.tokenB)==null?void 0:v.decimals;let L;Math.abs(k)==Math.abs(Yi.getMinIndex(Number(m.tickSpacing)))?L=M==="lower"?"0":"âˆž":L=$i.tickIndexToPrice(k,z,l).toString();const E=L==="âˆž"?"âˆž":se(L,6),Z=jl(L),T=Z==="âˆž"?"âˆž":se(Z,6),D={id:M,tokenA:m==null?void 0:m.tokenA,tokenB:m==null?void 0:m.tokenB,tick:k,price:L,displayPrice:E,reversePrice:Z,displayReversePrice:T,tickSpacing:m==null?void 0:m.tickSpacing,pool:m==null?void 0:m.poolAddress};M==="lower"?R({...D}):a({...D})},{getCurrentPrice:_}=pl();n.useEffect(()=>{e!=null&&e.lowerTick&&(p!=null&&p.current_sqrt_price)&&(o!=null&&o.poolAddress)&&(A(e==null?void 0:e.lowerTick,"lower",{...o,tickSpacing:p.tickSpacing}),A(e==null?void 0:e.upperTick,"upper",{...o,tickSpacing:p.tickSpacing}),_(p==null?void 0:p.current_sqrt_price,o),t(p))},[e==null?void 0:e.lowerTick,p==null?void 0:p.current_sqrt_price,o==null?void 0:o.poolAddress]);const x=n.useMemo(()=>(e==null?void 0:e.posId)&&(c==null?void 0:c.pool)&&(g==null?void 0:g.pool),[c==null?void 0:c.pool,g==null?void 0:g.pool,e==null?void 0:e.posId]);return i.jsx(Ue,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:x&&i.jsx(Ei,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?g:c,maxPriceData:e!=null&&e.isReverse?c:g,readonly:!0})})}function _l(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posPoolsOriginalData:p}=re(),t=o[e==null?void 0:e.posId],{getClmmPosName:s}=oi(),c=n.useMemo(()=>{var A;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const _=(A=p==null?void 0:p[e==null?void 0:e.clmmPool])==null?void 0:A.index;return s(e==null?void 0:e.index,_)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,p]);(t==null?void 0:t.displayFee)+"";const g=(t==null?void 0:t.currentStatus)=="Active",R=n.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",t);const A=t==null?void 0:t.minPriceOrigin,_=t==null?void 0:t.maxPriceOrigin;return A!=="0"&&_!=="âˆž"?Qi(1/(1-Number((A/_)**.25)),2)+"x":"1x"},[t==null?void 0:t.minPriceOrigin,t==null?void 0:t.maxPriceOrigin]),{getExplorerUrl:a}=ni();return i.jsxs(de,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(de,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(r,{justify:"space-between",children:[i.jsxs(r,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(r,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position ID"}),i.jsx(le,{isLoaded:!!c,children:i.jsx(w,{color:"text_caption",children:c==null?void 0:c.split("|")[1]})})]}),i.jsxs(r,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position NFT"}),i.jsx(le,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Ki,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(a(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),t&&i.jsx(rl,{isActive:g,isLoading:(t==null?void 0:t.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(r,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(H,{gap:{base:"16px",lg:"32px"},children:[i.jsxs(H,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Current Price"}),i.jsx(Wi,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs(H,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Position Range"}),i.jsx(bl,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:t==null?void 0:t.minPrice,maxPrice:t==null?void 0:t.maxPrice,minPriceResever:t==null?void 0:t.minPriceResever,maxPriceResever:t==null?void 0:t.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs(H,{gap:"0",children:[i.jsx(vl,{}),i.jsx(H,{zIndex:"9",children:i.jsxs(r,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(gl,{type:"leverage"}),i.jsx(le,{ml:"4px",isLoaded:!!R&&!!t,children:i.jsx(w,{color:"primary",children:R})})]})})]})]})]})}function Cs(){var X,Se;const e=_i(),{fetchAccountBalance:o}=ci(),{currentAccount:p}=Xe(),{position_nft_id:t}=Ci(),{getCurrentPosBaseInfo:s,getCurrentPosByPosId:c}=Ye(),{curPosContractPoolInfo:g,currentPosDetailTab:R,currentPosPoolInfo:a,setCurrentPosDetailTab:A,setCurrentPosPoolInfo:_,setCurrentPoolSqrtPrice:x,setCurPosContractPoolInfo:k,setIsPosDetailRefresh:M,setUseZapIn:m}=ke(),{posPoolsRelatedData:z,currentPosBaseInfo:l,setCurrentPosBaseInfo:L,farmsPosRewardsData:E,posRewardsData:Z}=re();console.log(l,"currentPosBaseInfo");const T=(((X=z[l==null?void 0:l.posId])==null?void 0:X.displayFee)||"--")+"%",D=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],W=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),M(!0),v(!0),$(),u(),o(),oe(),setTimeout(()=>{M(!1)},1e3)},v=(h=!1)=>{p!=null&&p.address&&t&&s(p==null?void 0:p.address,t,h)};n.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",t),v()},[p==null?void 0:p.address,t]),n.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:Y}=Qe(),N=E[l==null?void 0:l.id],V=Z[l==null?void 0:l.posId],u=()=>{var ve,_e;const h=(V==null?void 0:V.map(J=>J==null?void 0:J.coin_address))||[],y=(N==null?void 0:N.map(J=>J==null?void 0:J.rewarder_type))||[],b=[(ve=l==null?void 0:l.tokenA)==null?void 0:ve.coin_type,(_e=l==null?void 0:l.tokenB)==null?void 0:_e.coin_type].filter(Boolean),We=Array.from(new Set([...h,...b,...y]));Y(We)};n.useEffect(()=>{u()},[l==null?void 0:l.posId,V==null?void 0:V.length,N==null?void 0:N.length]);const{getPoolList:C}=yl(),$=async()=>{if(!(l!=null&&l.clmmPool))return;const h=await C({pool:l==null?void 0:l.clmmPool,display_all_pools:!0});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,h),h)return _(h==null?void 0:h.list[0])},{getPosPoolsOriginalObj:G,getPosPoolsRelatedData:q}=Ni(),{getPosLiquidityData:te}=Zi(),oe=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const h=await c(p==null?void 0:p.address,t),y=await G([h]);q([h],y);const b=y[h==null?void 0:h.clmmPool];console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo[currentPosBaseInfo?.clmmPool]:",b,g),(b==null?void 0:b.current_sqrt_price)!==(g==null?void 0:g.current_sqrt_price)&&te([h],y),y&&(x(b==null?void 0:b.current_sqrt_price),k(b))}},{setFromCoin:ue,setToCoin:Ae,fromCoin:F,toCoin:B}=wl();n.useEffect(()=>{$(),oe();let h;return l!=null&&l.clmmPool&&(h=setInterval(()=>{oe()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(ue(l==null?void 0:l.displayTokenA),Ae(l==null?void 0:l.displayTokenB)),()=>{clearInterval(h),ue(ti.clmm_swap.from_coin),Ae(ti.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),n.useEffect(()=>(p!=null&&p.address&&o(),()=>{k(null),L(null),_(null),m(!1)}),[]),kl({onRpcChange:()=>{v(!0),oe(),p!=null&&p.address&&o()}});const{isApp:S}=$e(),{setBackUrl:Q}=mi();return i.jsxs(H,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(r,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(r,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(Tl,{}),S&&i.jsxs(r,{children:[i.jsx(di,{}),i.jsx(pi,{handleRefresh:W,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(r,{w:{base:"100%",lg:"unset"},children:[i.jsx(Oe,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:h=>{Q(`/position-detail/${l==null?void 0:l.id}`),e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!S&&i.jsx(pi,{handleRefresh:W,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(r,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(le,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Li,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:T,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(r,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ee,{label:"Pool APR",value:i.jsx(Ri,{poolInfo:a,children:i.jsxs(r,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(w,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:a!=null&&a.farmingAprDisplay||((Se=a==null?void 0:a.miningAprList)==null?void 0:Se.length)>0?"help":"text",children:a==null?void 0:a.feeAndMiningAprDisplay}),(a==null?void 0:a.haveFarming)&&i.jsxs(w,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",a==null?void 0:a.farmingAprDisplay]})]})}),loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"TVL",value:(a==null?void 0:a.tvlDisplay)||"",loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"Volume (24H)",value:(a==null?void 0:a.volume24Display)||"",loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"Fees (24H)",value:(a==null?void 0:a.fees24Display)||"",loading:!(a!=null&&a.poolAddress)})]})]}),i.jsxs(r,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(H,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(_l,{}),i.jsx(ul,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs(H,{w:{base:"100%",lg:"40%"},children:[i.jsx(de,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(r,{w:"100%",p:"0 16px",children:[i.jsx(Xi,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:D,currentTab:R=="increase"?"Increase":"Remove",handleChangeTab:h=>{A(h==null?void 0:h.value)}}),!S&&i.jsx(di,{})]})}),R=="increase"&&i.jsx(Sl,{}),R=="remove"&&i.jsx(dl,{})]})]})]})}const di=()=>i.jsx(r,{children:i.jsx(Fi,{})});export{Cs as default};
//# sourceMappingURL=PositionDetail-BTkPFQ4t.js.map
