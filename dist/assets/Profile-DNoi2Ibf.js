import{a as p,D as qe,j as e,V as F,F as Ke,aa as Re,H as S,T as w,C as I,u as J,f as N,v as X,X as Ie,Y as Qe,Z as Ye,$ as Ze,a0 as Je,a1 as et,ab as De,I as tt,N as gt,aA as ht,O as ft,Q as mt,ar as Ue,ag as jt}from"./vendor-BulRdKUe.js";import{u as st}from"./global-BuWkHhOb.js";import{j as M,F as le,I as U,O as ie,aU as bt,i as je,e as nt,q as Me,d as B,aV as me,B as K,v as se,c as ke,a as V,G as wt,z as Z,R as ot,n as pe,M as ae,p as Ct,X as yt,f as it,am as _t,w as $,m as Oe,as as Q,ar as Le,k as be,aW as St,aX as We,Q as fe,V as at,aR as vt,al as Tt,aI as _e,a0 as kt,aY as Xe,aZ as $e}from"./index-DQXcYZM3.js";import{N as ee}from"./NoData-fdoVeTOA.js";import{u as Lt,A as Pt,R as Rt}from"./RecentTransactions-JtYO1MRA.js";import{A as Dt}from"./AccountSwitchDrawer-CSy9a9RZ.js";import{u as rt,D as lt,g as Ot,e as At,f as Ht,W as Ft,b as zt,R as Bt,a as Et,d as Ut}from"./OverviewOrders-DMoxLgQi.js";import{I as Se}from"./IconText-Dv6MxevE.js";import{u as Mt}from"./RangeValue-DXl0oxFo.js";import{H as te}from"./HTextLabelBox-BbkaBhAF.js";import{u as Y}from"./activeOrders-i2xAVh_4.js";import{H as Ae,T as He}from"./Table-vUzyvRiO.js";import{P as we}from"./Pagination-DMDslsNH.js";import{b as Wt,u as xe,c as Xt,C as $t,P as Nt,F as Vt,E as Gt,S as qt,O as Kt,a as It}from"./useGetLimitOrderHistory-D-ZPtHwP.js";import{u as Qt}from"./useRpcListener-DcWfr3wN.js";import{R as Yt}from"./RefreshButton-B8MFu3on.js";import{a as re,d as Zt,u as ct,e as Jt,f as es,g as ts,c as ss,b as ns}from"./usePositionList-TWxNDHlY.js";import{P as os,a as is,b as as,u as rs}from"./PoolItem-CoOzK9Cv.js";import{P as ls,u as cs}from"./PositionListLoading-BVEKWmFE.js";import{u as ds}from"./useAccountBalance-Duoi0cgh.js";import{u as dt}from"./useToken-B7nJkCt9.js";import{f as Fe,a as ps,b as xs,u as us,X as gs,c as hs,C as fs,e as ms,d as js,g as bs}from"./useXCetus-JTXrwwAw.js";import{S as pt}from"./SingleTokenInfo-i-hk68uf.js";import{S as ws}from"./SortDropBlock-DDLVH57V.js";import{T as ve}from"./TableSortTh-CQTx2-Q6.js";import{u as Cs}from"./useTokenBalance-BlI0L6Xi.js";import{X as ys,a as _s,b as Ss,c as vs,u as Ts}from"./useXCetusHelper-DAIEcNOd.js";import"./CopyButton-CyTJs4bP.js";import"./Drawer-Cc85-wz0.js";import"./useTransaction-DV2HqOSw.js";import"./useTrack-CR6k9VIU.js";import"./useSigner-CQx-z6kb.js";import"./ErrorTips-DExSaZKW.js";import"./usePreviousValue-DJR5Z5zU.js";import"./useFavoritePool-7rpG34q4.js";import"./useGetPoolList-BxPVC45v.js";import"./useWrapPoolData-C3ek6Qim.js";import"./CheckBox-DmrDTHK7.js";import"./SearchInputBlock-BEKYL0BT.js";import"./index-DsLptUdo.js";import"./Loading-CEW9oCbv.js";import"./TooltipIcon-CSKgLEKO.js";import"./PositionCurrentPrice-DS4oZvb0.js";import"./useBurn-DNSqnPXV.js";import"./msafe-oYBkW7LJ.js";import"./CoinPairInfo-DPxMtCcM.js";import"./PoweredByHaedal-DgLgYLeQ.js";import"./PriceRange-CVasDjdI.js";import"./PositionStatus-krUIu92G.js";import"./detail-Df2908DH.js";import"./TradeInputGroup-DGHlX_h-.js";import"./_getAllKeysIn-YPbCBHiA.js";import"./HighlightText-Uv5QOqtT.js";import"./index-4kM3JsjZ.js";import"./debounce-Cta0IZrB.js";import"./index-e8NcK24v.js";function ks(t=100){const o=p.useRef([]),s=p.useRef(!1),a=p.useRef(void 0),r=p.useCallback(async()=>{if(!s.current){for(s.current=!0;o.current.length>0;){const l=o.current.shift();if(!l)continue;const{id:c,run:x,onStart:u,onSuccess:d,onError:C}=l;if(l._cancelled){console.log(`[task:${l.id}] skipped (cancelled)`);continue}try{console.log(`[task:${c}] start`),u==null||u(c);const j=await x(a.current,c);a.current=j,console.log(`[task:${c}] success`,j),d==null||d(j,c)}catch(j){console.error(`[task:${c}] failed`,j),C==null||C(j,c)}await new Promise(j=>setTimeout(j,t))}s.current=!1}},[t]),i=l=>{o.current.push(l),r()},n=l=>{const c=o.current.find(x=>x.id===l);c&&(c._cancelled=!0),o.current=o.current.filter(x=>x.id!==l)};return p.useEffect(()=>()=>{o.current=[],s.current=!1,a.current=void 0},[]),{addTask:i,removeTask:n}}const xt=(t,o)=>o?t:"********";function Ls({totalValue:t,onRefreshTask:o,isLoading:s,children:a}){const[r,i]=p.useState(!1),{currentAccount:n,onWalletModal:l,accounts:c,accountServiceNameObj:x}=M(),{isShowProfileAssets:u,setIsShowProfileAssets:d}=st();p.useEffect(()=>{i(!0)},[]);const{isOpen:C,onClose:j,onToggle:b}=qe(),{getServiceNames:L}=Lt(),O=p.useCallback(()=>{C||L(c),b(),console.log("AccountSwitch###handleClick###isOpen: ",C)},[C,c]);return console.log(n,x,c,"currentAccount-H5Main"),e.jsxs(F,{w:"100%",mt:"28px",children:[r?n!=null&&n.address?e.jsxs(F,{w:"100%",gap:"16px",alignItems:"start",children:[e.jsxs(S,{w:"100%",h:"18px",align:"flex-end",justify:"space-between",children:[e.jsxs(S,{h:"18px",children:[e.jsx(w,{h:"18px",lineHeight:"18px",fontSize:{base:"14px",lg:"16px"},color:"text_caption",children:"Total Value"}),e.jsx(le,{showTooltip:!1,placement:"bottom-end",tooltip:e.jsx(w,{fontSize:"12px",children:u?"Hide Value":"Show Value"}),children:e.jsx(I,{children:e.jsx(U,{xlinkHref:u?"#icon-hide_eyes":"#icon-show_eyes",svgFill:"text_caption",onClick:()=>d(!u)})})})]}),e.jsxs(S,{h:"16px",align:"center",gap:"0",cursor:"pointer",onClick:()=>console.log("jump to transactions"),children:[e.jsx(w,{h:"16px",lineHeight:"16px",fontSize:"12px",children:"Transactions"}),e.jsx(U,{xlinkHref:"#icon-icon_ascending",fontSize:"16px",transform:"rotate(90deg)"})]})]}),e.jsx(J,{isLoaded:!s,h:"32px",children:e.jsx(w,{mt:"-6px",letterSpacing:"1px",h:"32px",fontSize:"28px",lineHeight:"32px",color:"text_caption",fontWeight:"500",children:xt(ie(t,2),u)})}),c.length>1&&e.jsxs(S,{w:"100%",h:"44px",borderRadius:"8px",bg:"account_switch_bg",backdropFilter:"blur(4px)",p:"12px 12px 12px 0",justify:"space-between",onClick:O,cursor:"pointer",children:[e.jsxs(S,{children:[e.jsx(U,{xlinkHref:"#icon-account",svgFill:"text_caption"}),e.jsxs(w,{color:"text_caption",fontSize:"14px",lineHeight:"14px",children:[n!=null&&n.label?`${n==null?void 0:n.label} : `:"",(x==null?void 0:x[n==null?void 0:n.address])||bt(n==null?void 0:n.address)]})]}),e.jsx(U,{xlinkHref:"#icon-icon_descending_nor",svgFill:"text_caption",svgW:"20px",svgH:"20px",transform:"rotate(0deg)",transition:"transform 0.3s"})]}),a]}):e.jsx(ee,{type:"nowallet",mt:"20px",onboard:()=>l(!0)}):e.jsx(Ke,{h:"300px",w:"100%",justifyContent:"center",alignItems:"center",children:e.jsx(Re,{})}),e.jsx(Dt,{isOpen:C,onClose:j})]})}function ze(t){const{type:o,children:s,wrapStyle:a={h:"60px"},textStyle:r={fontSize:"16px"}}=t,i=(n,l)=>"title"in t?!1:t!=null&&t.isActive?t==null?void 0:t.isActive(n,l):n===l.value;return e.jsxs(S,{justify:"space-between",w:"100%",h:"60px",...a,children:["title"in t?e.jsx(w,{color:"text_caption",...r,children:t==null?void 0:t.title}):e.jsx(je,{type:"borderTab",tabList:t.tabs,currentTab:t.currentTab,handleChangeTab:t.onTabChange,isActive:(n,l)=>i(n,l),wrapStyle:{h:"60px",border:"none",gap:"38px",...a},itemStyle:r}),s]})}function Ps({orderInfo:t,isActiveOrder:o,pageDirect:s}){const{inCoin:a,outCoin:r}=t,{orderHistoryList:i,handleGetDcaOrderHistory:n,orderHistoryListLoading:l}=rt();p.useEffect(()=>{t!=null&&t.orderID&&n(t==null?void 0:t.orderID,9999,0,!0)},[t==null?void 0:t.orderID]);const{getExplorerUrl:c}=nt(),[x,u]=p.useState(s),d=142,C=(i==null?void 0:i.length)||0,j=(i==null?void 0:i.length)<=1?`${d*C-8}px`:`${d*C+(C-1)*32-8}px`;return e.jsxs(F,{align:"flex-start",w:"100%",gap:"32px",position:"relative",h:(i==null?void 0:i.length)>=3?"460px":"unset",overflowY:"auto",children:[!l&&e.jsx(N,{h:j,w:"1px",bg:"border",position:"absolute",left:"6px",top:"8px"}),l?e.jsx(S,{h:"100px",w:"100%",justify:"center",children:e.jsx(Re,{})}):(i==null?void 0:i.length)===0?e.jsx(ee,{type:"nodata",text:"No orders",p:"12px",bg:"none"}):i.map(b=>{const L=Me(b.inAmount,a==null?void 0:a.decimals),O=Me(b.outAmount,r==null?void 0:r.decimals),_=B(L).div(O).toString(),g=B(1).div(_).toString();return e.jsxs(F,{pl:"20px",align:"flex-start",w:"100%",children:[e.jsxs(S,{w:"100%",gap:"16px",justifyContent:"space-between",position:"relative",children:[e.jsxs(w,{h:"20px",lineHeight:"20px",children:[me((b==null?void 0:b.time)*1e3)," (UTC)"]}),e.jsx(U,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(c(b==null?void 0:b.tx,"tx"))}}),e.jsx(S,{justify:"center",h:"12px",w:"12px",bg:"primary_opacity.20",position:"absolute",left:"-20px",top:"4px",zIndex:"99999",borderRadius:"50%",children:e.jsx(N,{h:"6px",w:"6px",bg:"primary",borderRadius:"50%"})})]}),e.jsx(K,{p:"16px",borderRadius:"12px",children:e.jsxs(F,{align:"flex-start",gap:"20px",children:[e.jsxs(F,{gap:"0px",align:"flex-start",children:[e.jsx(w,{whiteSpace:"nowrap",color:"text_caption",fontSize:"16px",h:"20px",lineHeight:"20px",children:x?`${se(_)} `:`${se(g)} `}),e.jsxs(S,{children:[e.jsxs(w,{whiteSpace:"nowrap",h:"20px",fontSize:"12px",lineHeight:"20px",children:["Rate(",x?` ${a.symbol} per ${r.symbol}`:` ${r.symbol} per ${a.symbol}`,")"]}),e.jsx(U,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:()=>u(!x)})]})]}),e.jsxs(S,{w:"100%",gap:"4px",children:[e.jsx(ke,{imageUrl:a==null?void 0:a.logo_url,w:"20px",h:"20px"}),e.jsx(w,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:`${se(L)}`}),e.jsx(w,{whiteSpace:"nowrap",h:"20px",lineHeight:"20px",children:` ${a.symbol}`}),e.jsx(w,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:" â†’ "}),e.jsx(ke,{imageUrl:r==null?void 0:r.logo_url,w:"20px",h:"20px"}),e.jsx(w,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:`${se(O)}`}),e.jsx(w,{whiteSpace:"nowrap",h:"20px",lineHeight:"20px",children:`${r.symbol}`})]})]})})]},b==null?void 0:b.tx)})]})}function Rs({orderInfo:t,isActiveOrder:o,pageDirect:s,isClaimLoading:a=!1,toClaim:r}){const{inCoin:i,outCoin:n}=t;return e.jsxs(F,{children:[(t==null?void 0:t.isShowTradeTips)&&(t==null?void 0:t.orderStatus)=="Active"&&o&&e.jsx(Ds,{}),e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(lt,{orderInfo:t}),o&&r&&e.jsx(X,{isLoading:a,onClick:()=>r(t),disabled:(t==null?void 0:t.outBalance)<=0||a,h:"32px",fontSize:"12px",borderRadius:"8px",lineHeight:"32px",p:"0 8px",fontWeight:"500",children:"Claim"})]}),e.jsx(w,{fontSize:"16px",color:"text_caption",children:Ot(t,o,!0)}),e.jsx(w,{fontSize:"12px",children:"Amount Withdrawn"}),e.jsxs(S,{w:"100%",justify:"space-around",children:[e.jsxs(F,{children:[e.jsx(w,{fontSize:"16px",color:"text_caption",children:At(t)}),e.jsxs(w,{fontSize:"12px",children:["DCA ",i==null?void 0:i.symbol," Balance"]})]}),e.jsx(N,{as:"span",display:"inline-block",w:"1px",h:"20px",bg:"border"}),e.jsxs(F,{children:[e.jsx(w,{color:"text_caption",fontSize:"16px",children:Ht(t)}),e.jsxs(w,{fontSize:"12px",children:["DCA ",n==null?void 0:n.symbol," Balance "]})]})]}),e.jsxs(F,{mt:"28px",w:"100%",gap:"20px",children:[e.jsx(te,{label:"Invest Every",value:t==null?void 0:t.investEvery}),e.jsx(te,{label:"Orders Left",value:t==null?void 0:t.ofOrderLeft}),e.jsx(te,{label:"Each Order Size",value:`${t==null?void 0:t.eachOrderSize} ${i==null?void 0:i.symbol}`}),o&&e.jsx(te,{label:"Current Avg. Price",value:s?`${t==null?void 0:t.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${t==null?void 0:t.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`}),!o&&(t==null?void 0:t.currentAvgPrice)!=="--"&&e.jsx(te,{label:"Avg. Price",value:s?`${t==null?void 0:t.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${t==null?void 0:t.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`}),o&&e.jsx(te,{label:"Next Order (UTC)",value:me(t==null?void 0:t.nextCycleAtTimeStamp)||""}),e.jsx(te,{label:"Created (UTC)",value:me(t==null?void 0:t.createdAt)||""})]})]})}const Ds=()=>{const[t,o]=p.useState(!1);return e.jsxs(F,{p:"12px",align:"flex-start",bg:"primary_yellow_opacity.10",borderRadius:"8px",children:[e.jsxs(S,{align:"center",w:"100%",cursor:"pointer",onClick:()=>o(!t),children:[e.jsx(w,{fontSize:"12px",color:"primary_yellow",lineHeight:"20px",textAlign:"left",children:"The system tried to execute your order multiple times but did not get it through. This is possibly because:"}),e.jsx(U,{transform:t?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.5s",svgW:"12px",svgH:"12px",variant:"warning",xlinkHref:"#icon-icon_arrow"})]}),t&&e.jsxs(F,{align:"flex-start",w:"100%",children:[e.jsx(N,{w:"100%",h:"1px",bg:"primary_yellow_opacity.10",m:"4px 0"}),e.jsx(Ft,{})]})]})};function Os({isOpen:t,onClose:o,orderInfo:s,isActiveOrder:a,isClaimLoading:r=!1,toClaim:i}){const{isApp:n}=V(),l=[{label:"Overview",value:"overview"},{label:"Orders",value:"orders"}],[c,x]=p.useState("overview"),{inCoin:u,outCoin:d}=s,[C,j]=p.useState(!1),{getTokenRank:b}=Mt();return p.useEffect(()=>{const L=b(u,d);console.log("ðŸš€ ~ useEffectDcaItem ~ direct:",d,u,L),j(!L)},[u==null?void 0:u.coin_type,d==null?void 0:d.coin_type]),e.jsxs(Ie,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:o,isCentered:!0,children:[e.jsx(Qe,{}),e.jsxs(Ye,{minWidth:n?"300px":"482px",children:[e.jsx(Ze,{children:e.jsx(N,{w:"100%",borderBottom:"1px solid",borderColor:"border",children:e.jsx(ze,{type:"tab",currentTab:c,tabs:l,onTabChange:L=>x(L.value),textStyle:{fontSize:"16px"},wrapStyle:{bg:"none",mt:"-12px",mb:"-4px"}})})}),e.jsx(Je,{}),e.jsxs(et,{p:"0 16px 16px",textAlign:"center",children:[c=="overview"&&e.jsx(Rs,{orderInfo:s,isActiveOrder:a,pageDirect:C,isClaimLoading:r,toClaim:i}),c=="orders"&&e.jsx(Ps,{orderInfo:s,isActiveOrder:a,pageDirect:C})]})]})]})}function As({orderInfo:t,isActiveOrder:o=!0}){const{isApp:s}=V(),[a,r]=p.useState(!1),{getExplorerUrl:i}=nt(),{isClaimLoading:n,toClaim:l,closeOrderAction:c,isCloseLoading:x}=rt();return e.jsxs(e.Fragment,{children:[o&&e.jsxs(S,{justify:"flex-end",children:[e.jsx(X,{isLoading:n,onClick:()=>l(t),disabled:(t==null?void 0:t.outBalance)<=0||n,h:"32px",fontSize:"12px",borderRadius:"8px",fontWeight:"500",p:"0 8px",children:"Claim"}),e.jsx(le,{placement:"bottom-end",tooltip:e.jsxs(F,{align:"flex-start",children:[e.jsx(Se,{text:"View Details",onClick:()=>{r(!0)}}),e.jsx(Se,{text:"View on Explorer",onClick:()=>{window.open(i(t.orderID,"poolAddress"))}}),e.jsx(Se,{text:(t==null?void 0:t.outBalance)<=0?"Close":"Close and Withdraw",onClick:x?()=>{}:()=>{c(t)}})]}),children:e.jsx(I,{children:e.jsx(X,{variant:"outline",w:"32px",h:"32px",p:"0",borderRadius:"8px",sx:{_hover:{svg:{fill:"primary"}}},children:e.jsx(U,{svgFill:s?"primary":"text_paragraph",xlinkHref:"#icon-icon_more",svgW:"16px",svgH:"16px"})})})})]}),!o&&e.jsxs(S,{justify:"flex-end",children:[e.jsx(X,{onClick:()=>{r(!0)},h:"32px",fontSize:"12px",variant:"outline",borderRadius:"8px",fontWeight:"500",p:"0 8px",children:"Details"}),e.jsx(X,{onClick:u=>{wt(u),window.open(i(t.orderID,"poolAddress"))},w:"32px",p:"0",h:"32px",fontSize:"12px",borderRadius:"8px",variant:"outline",_hover:{svg:{fill:"primary"}},children:e.jsx(U,{svgW:"20px",xlinkHref:"#icon-icon_link1"})})]}),a&&e.jsx(Os,{isOpen:a,onClose:()=>r(!1),orderInfo:t,isActiveOrder:o,isClaimLoading:n,toClaim:l})]})}function Hs(){const{isAutoRefresh:t,dcaOrderListLoading:o,dcaActiveOrderList:s,dcaPastOrderList:a}=Y(),[r,i]=p.useState("activeDCAs"),n=p.useMemo(()=>[{label:"Active DCAs",value:"activeDCAs",num:!t&&o?"":s==null?void 0:s.length},{label:"Past DCAs",value:"pastDCAs",num:!t&&o?"":a==null?void 0:a.length}],[o,a,s]),l=p.useMemo(()=>r=="activeDCAs"?s:a,[r,s,a]),{isApp:c}=V(),{closeAll:x,claimAll:u,isClaimAllLoading:d,isCloseAllLoading:C}=zt(),j=p.useMemo(()=>r==="pastDCAs"||(l==null?void 0:l.length)===0?0:l==null?void 0:l.reduce((R,T)=>B(R).plus(T==null?void 0:T.outBalance),B(0)).toString(),[r,l]),[b,L]=p.useState([]),[O,_]=p.useState(0),[g,y]=p.useState(1),k=10,v=Ne(r=="activeDCAs");return p.useEffect(()=>{if((l==null?void 0:l.length)>0){const R=(g-1)*k;(l==null?void 0:l.length)<=R&&y(1)}},[l]),p.useEffect(()=>{if((l==null?void 0:l.length)>0){_(l==null?void 0:l.length);const R=(g-1)*k,T=R+k;console.log("ðŸš€ ~ useEffect ~ start:",g,l.slice(0,T),R,T),(l==null?void 0:l.length)>R&&L(l.slice(R,T))}},[g,l]),e.jsxs(F,{w:"100%",gap:"12px",children:[e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(je,{type:"outlineTab",tabList:n,currentTab:r,handleChangeTab:R=>i(R==null?void 0:R.value),isActive:(R,T)=>R===T.value,wrapStyle:{border:"none",h:"32px",gap:"8px"},itemStyle:{fontSize:"14px",borderRadius:"8px",p:"0 8px"}}),(l==null?void 0:l.length)>1&&r=="activeDCAs"&&e.jsxs(S,{children:[e.jsx(X,{h:"32px",p:"8px",fontSize:"12px",fontWeight:"500",borderRadius:"8px",isLoading:d,disabled:Number(j)===0||d,onClick:()=>{u(l)},children:"Claim All"}),e.jsx(X,{h:"32px",p:"8px",fontSize:"12px",fontWeight:"400",variant:"ghost",isLoading:C,disabled:(l==null?void 0:l.length)==0||C,onClick:()=>{x(l)},children:"Close All"})]})]}),e.jsxs(F,{w:"100%",position:"relative",gap:"20px",children:[(t||!o)&&(l==null?void 0:l.length)===0?e.jsx(ee,{type:"nodata",text:r==="activeDCAs"?"No active DCAs":"No past DCAs",noBorder:!0}):c?e.jsx(F,{w:"100%",gap:"4px",children:e.jsx(Ae,{rowKey:"orderID",columns:v,dataSource:b,loading:!t&&o,itemSkeletonLength:5,itemHeight:"30px"})}):e.jsx(He,{rowKey:"orderID",columns:Ne(r=="activeDCAs"),dataSource:b,loading:!t&&o,rowStyle:{h:"80px",cursor:"pointer"}}),(l==null?void 0:l.length)>k&&e.jsx(I,{children:e.jsx(we,{total:O,size:k,currentPage:g,onChange:R=>{y(R)}})})]})]})}const Ne=t=>[{title:e.jsx(w,{children:"Orders"}),key:"order",thConfig:{w:"18%"},render:s=>e.jsx(lt,{orderInfo:s})},{title:e.jsx(w,{textAlign:"right",children:"Price Range"}),key:"price",thConfig:{w:"20%"},render:s=>e.jsx(Bt,{orderInfo:s,isProfile:!0,isRank:!0})},{title:e.jsx(w,{textAlign:"right",children:"Filled Size"}),key:"completed",thConfig:{w:"15%"},render:s=>e.jsx(Et,{orderInfo:s,isProfile:!0})},t&&{title:e.jsx(w,{textAlign:"right",children:"Next Order (UTC)"}),key:"nextOrder",thConfig:{w:"20%"},render:({nextCycleAtTimeStamp:s})=>e.jsx(w,{color:"text_caption",children:me(s)})},{title:e.jsx(w,{textAlign:"right",children:"Actions"}),key:"actions",thConfig:{w:"15%"},render:s=>e.jsx(As,{orderInfo:s,isActiveOrder:t})}].filter(Boolean);function Fs(){const{currentAccount:t}=M(),{getLimitOrderHistory:o,historyOrderList:s,historyOrderLoading:a}=Wt(),{myOrderList:r,orderListLoading:i}=xe(),{isAutoRefresh:n,autoRefreshCount:l}=Y(),[c,x]=p.useState("openOrders"),u=p.useMemo(()=>c=="openOrders"?i:a,[c,i,a]),d=p.useMemo(()=>(console.log("ðŸš€ ~ currentList ~ myOrderList:",r,s),c=="openOrders"?r:s),[c,r,s]),C=p.useMemo(()=>[{label:"Open Orders",value:"openOrders",num:(n||!u)&&(r==null?void 0:r.length)===0?0:!n&&i?"":r==null?void 0:r.length},{label:"Orders History",value:"ordersHistory",num:(n||!u)&&(s==null?void 0:s.length)===0?0:!n&&a?"":s==null?void 0:s.length}],[i,a,r,s]),j=h=>{t!=null&&t.address&&o(t.address,h)};p.useEffect(()=>{console.log("ðŸš€ ----------------------------------------------------ðŸš€"),console.log("ðŸš€ ~ useEffect ~ autoRefreshCount:",l),console.log("ðŸš€ ----------------------------------------------------ðŸš€"),l>0&&j(!0)},[l]),p.useEffect(()=>{j(!1)},[c,t]),Qt({onRpcChange:()=>{j(!0)}});const{isApp:b}=V(),{handleCancelOrder:L,cancelOrderLoading:O}=Xt(),[_,g]=p.useState([]),[y,k]=p.useState(0),[v,R]=p.useState(1),T=10,D=zs(c=="openOrders");return p.useEffect(()=>{if((d==null?void 0:d.length)>0){const h=(v-1)*T;(d==null?void 0:d.length)<=h&&R(1)}},[d]),p.useEffect(()=>{if((d==null?void 0:d.length)>0){k(d==null?void 0:d.length);const h=(v-1)*T,P=h+T;console.log("ðŸš€ ~ useEffect ~ start:",v,d.slice(0,P),h,P),(d==null?void 0:d.length)>h&&g(d.slice(h,P))}},[v,d]),e.jsxs(F,{w:"100%",gap:"12px",children:[e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(je,{type:"outlineTab",tabList:C,currentTab:c,handleChangeTab:h=>x(h==null?void 0:h.value),isActive:(h,P)=>h===P.value,wrapStyle:{border:"none",h:"32px",gap:"8px",bg:"none"},itemStyle:{fontSize:"14px",borderRadius:"8px",p:"0 8px"}}),(d==null?void 0:d.length)>1&&c=="openOrders"&&e.jsx(S,{children:e.jsx(X,{h:"32px",p:"8px",fontSize:"12px",fontWeight:"400",variant:"ghost",isLoading:O,onClick:()=>{L(r)},children:"Cancel All"})})]}),e.jsxs(F,{w:"100%",position:"relative",gap:"20px",children:[(n||!u)&&(d==null?void 0:d.length)===0?e.jsx(ee,{type:"nodata",text:c=="openOrders"?"No open orders":"No history orders",noBorder:!0}):b?e.jsx(F,{w:"100%",gap:"4px",children:e.jsx(Ae,{rowKey:"order_id",columns:D,dataSource:_,loading:!n&&u,itemSkeletonLength:5,itemHeight:"30px"})}):e.jsx(He,{rowKey:"order_id",columns:D,dataSource:_,loading:!n&&u,rowStyle:{h:"80px",cursor:"pointer"}}),(d==null?void 0:d.length)>T&&e.jsx(I,{children:e.jsx(we,{total:y,size:T,currentPage:v,onChange:h=>{R(h)}})})]})]})}const zs=t=>[{title:e.jsx(w,{children:"Order"}),key:"order",thConfig:{w:"20%"},render:s=>e.jsx($t,{imgSize:"28px",info:s,isProfile:!0})},{title:e.jsx(w,{textAlign:"right",children:"Limit Price"}),key:"price",thConfig:{w:"20%"},render:s=>e.jsx(Nt,{info:s,isProfile:!0})},{title:e.jsx(w,{textAlign:"right",children:"Filled Size"}),key:"completed",thConfig:{w:"12%"},render:s=>e.jsx(Vt,{info:s,isProfile:!0})},{title:e.jsx(w,{textAlign:"right",children:"Expiry"}),key:"expiry",thConfig:{w:"16%"},render:s=>e.jsx(Gt,{info:s,isProfile:!0})},!t&&{title:e.jsx(w,{textAlign:"right",children:"Status"}),key:"status",thConfig:{w:"8%"},render:s=>e.jsx(qt,{historyInfo:s,openExpendItemObj:void 0,isProfile:!0})},{title:e.jsx(w,{textAlign:"right",children:"Actions"}),key:"actions",thConfig:{w:"8%"},render:s=>e.jsx(Kt,{orderInfo:s,isProfile:!0,isOpenOrder:t})}].filter(Boolean);function Bs(){const t=[{label:"Limit Orders",value:"limitOrders"},{label:"DCA",value:"dca"}],[o,s]=p.useState("limitOrders");return e.jsx(K,{p:"0 16px 16px",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",children:e.jsxs(F,{align:"flex-start",gap:"20px",children:[e.jsx(N,{w:"100%",borderBottom:"1px solid",borderColor:"border",children:e.jsx(ze,{type:"tab",currentTab:o,tabs:t,onTabChange:a=>s(a.value),textStyle:{fontSize:"16px"},wrapStyle:{bg:"none"}})}),o==="limitOrders"&&e.jsx(Fs,{}),o==="dca"&&e.jsx(Hs,{})]})})}function Es({handleRefresh:t,totalValue:o,isLoading:s}){var C,j;const{isApp:a}=V(),{currentAccount:r,accounts:i}=M(),{isShowProfileAssets:n,setIsShowProfileAssets:l}=st(),[c,x]=p.useState(!1),{onClose:u}=qe(),d=i.reduce((b,L)=>(b[L.address]=L,b),{});return e.jsxs(F,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsxs(S,{w:"100%",children:[e.jsx(w,{lineHeight:"20px",fontSize:{base:"14px",lg:"16px"},color:"text_caption",children:"Total Value"}),e.jsx(le,{showTooltip:!a,placement:"bottom-end",tooltip:e.jsx(w,{fontSize:"12px",children:n?"Hide Value":"Show Value"}),children:e.jsx(I,{children:e.jsx(U,{xlinkHref:n?"#icon-hide_eyes":"#icon-show_eyes",svgFill:"text_caption",onClick:()=>l(!n)})})})]}),e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(J,{isLoaded:!s,h:"22px",children:e.jsx(w,{mt:"-6px",letterSpacing:"1px",fontSize:"32px",lineHeight:"32px",color:"text_caption",fontWeight:"500",children:xt(ie(o,2),n)})}),e.jsxs(S,{children:[e.jsxs(S,{p:"0 8px",h:"36px",justify:"center",align:"center",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",borderRadius:"8px",border:"1px solid",borderColor:"border",cursor:"pointer",_hover:{bg:"button_outline_hov_bg",svg:{fill:"text_caption"},p:{color:"text_caption"}},onClick:()=>{x(!0)},children:[e.jsx(U,{xlinkHref:"#icon-transactions",svgW:"20px",svgH:"20px"}),e.jsx(w,{children:"Transactions"})]}),e.jsx(Yt,{handleRefresh:t,bg:"block_color_opacity.50",backdropFilter:"blur(20px)",w:"32px",h:"32px",isAutoRefresh:!0,refreshInterval:30,innerStyle:{bg:"transparent"}})]})]}),i.length>1&&e.jsxs(S,{children:[((C=d==null?void 0:d[r==null?void 0:r.address])==null?void 0:C.label)&&e.jsxs(w,{color:"primary_gray",children:[(j=d==null?void 0:d[r==null?void 0:r.address])==null?void 0:j.label," :"]}),e.jsx(Pt,{currentAccount:r,accounts:i,onClose:u,isProfile:!0})]}),c&&e.jsx(Rt,{isOpen:c,onClose:()=>x(!1)})]})}function Us(){var O;const{currentAccount:t,onWalletModal:o}=M(),{showPosListLength:s,setShowPosListLength:a,posBaseListLoading:r,posBaseListGroupByPool:i}=re(),[n,l]=p.useState([]),{isAutoRefresh:c}=Y(),[x,u]=p.useState([]),d=_=>{console.log("ðŸš€ ~ onClickIncentiveTypes ~ tokenInfo:",_),u(g=>[...g,_])},C=_=>{console.log("ðŸš€ ~ onClickIncentiveTypes ~ tokenInfo:",_),u(g=>g.filter(y=>(y==null?void 0:y.coin_type)!==(_==null?void 0:_.coin_type)))};p.useEffect(()=>{t!=null&&t.address||a("")},[t==null?void 0:t.address]),p.useEffect(()=>{var v,R,T,D;const _=(v=x[0])!=null&&v.coin_type?Z((R=x[0])==null?void 0:R.coin_type):void 0,g=(T=x[1])!=null&&T.coin_type?Z((D=x[1])==null?void 0:D.coin_type):void 0,y=Object.values(i).filter(h=>_&&g?Z(h.tokenA.coin_type)==_&&Z(h.tokenB.coin_type)==g||Z(h.tokenA.coin_type)==g&&Z(h.tokenB.coin_type)==_:_?Z(h.tokenA.coin_type)==_||Z(h.tokenB.coin_type)==_:h);console.log("ðŸš€ ~ useEffect ~ filterArr:",Object.values(i),y),l(y);const k=y.reduce((h,P)=>h+(P.list?P.list.length:0),0);t!=null&&t.address&&a(k.toString())},[x,i]),p.useEffect(()=>()=>{a("")},[]);const j=p.useMemo(()=>[{label:"Positions",value:"positions",num:Number(s)}],[s]),[b,L]=p.useState("positions");return e.jsx(K,{p:"0 16px 16px",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",children:e.jsxs(F,{gap:"16px",w:"100%",children:[e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(ze,{type:"tab",currentTab:b,tabs:j,onTabChange:_=>L(_.value),textStyle:{fontSize:"16px"},wrapStyle:{bg:"none"}}),e.jsx(os,{isProfile:!0,isPools:!1,handleRefresh:()=>{},selectCoinList:x,onClickSelectCoinList:d,onDeleteSelectCoinList:C})]}),e.jsx(N,{h:"1px",w:"100%",bg:"border",mt:"-16px"}),e.jsx(is,{}),t!=null&&t.address?!c&&r?[{},{},{},{}].map((_,g)=>e.jsx(ls,{},g)):((O=Object.values(n))==null?void 0:O.length)>0?Object.values(n).map((_,g)=>e.jsx(as,{poolInfo:_},g)):e.jsx(ee,{type:"nodata",text:"No liquidity positions",noBorder:!0}):e.jsx(ee,{type:"nowallet",onboard:()=>o(!0),noBorder:!0})]})})}function Ms({tabList:t,tabData:o,onClickTab:s}){return e.jsx(F,{w:"100%",children:t==null?void 0:t.map(a=>e.jsx(Ws,{imgUrl:a.activeImgUrl,value:o[a.value].totalValue,title:a.title,url:a.route,tooltip:a==null?void 0:a.tooltip,onClick:()=>s(a.value),isLoading:o[a.value].isLoading},a.title))})}const Ws=({imgUrl:t,value:o,title:s,url:a,tooltip:r,isLoading:i,onClick:n})=>(De(),e.jsxs(S,{bg:"bg_secondary",border:"1px solid",borderColor:"border",borderRadius:"16px",w:"100%",justify:"space-between",p:"16px 12px",onClick:n,children:[e.jsxs(S,{gap:"12px",children:[e.jsx(tt,{w:"36px",h:"36px",src:t}),e.jsxs(F,{gap:"2px",align:"flex-start",children:[e.jsx(J,{h:"24px",isLoaded:!i,children:e.jsx(w,{h:"24px",lineHeight:"24px",fontSize:"20px",fontWeight:"500",color:"text_caption",children:o})}),e.jsxs(S,{gap:"4px",children:[e.jsx(w,{fontSize:"12px",h:"15px",lineHeight:"15px",children:s}),r&&e.jsx(le,{tooltip:r,children:e.jsx(N,{children:e.jsx(U,{xlinkHref:"#icon-icon_tips"})})})]})]})]}),e.jsx(I,{bg:"primary_opacity.15",w:"24px",h:"24px",borderRadius:"50%",children:e.jsx(U,{xlinkHref:"#icon-icon_ascending",transform:"rotate(90deg)",svgFill:"primary_blue",fontSize:"20px"})})]}));function Xs({tabList:t,activeTab:o,tabData:s,onClickTab:a}){return e.jsx(S,{w:"100%",mt:"10px",children:t.map(r=>{var i,n;return e.jsxs(K,{w:"25%",p:"24px 16px",h:"94px",bgImage:o===r.value?"url(/images/tab_active.png)":"none",bgSize:"100% 100%",borderRadius:"16px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",onClick:()=>a(r.value),_hover:{bgImage:"url(/images/tab_active.png)",bgSize:"100% 100%",img:{opacity:"0.8"}},children:[e.jsxs(F,{align:"flex-start",gap:"12px",children:[e.jsx(w,{fontSize:"14px",color:"text_caption",children:r.title}),e.jsx(S,{h:"22px",children:e.jsx(le,{placement:"top",tooltip:e.jsx(w,{fontSize:"12px",lineHeight:"20px",color:"text_caption",children:r.tooltip}),showTooltip:r.showTooltip,children:e.jsx(I,{as:"button",children:e.jsx(J,{isLoaded:!((i=s[r.value])!=null&&i.isLoading),children:e.jsx(w,{fontSize:"22px",fontWeight:"500",color:"text_caption",children:(n=s[r.value])==null?void 0:n.totalValue})})})})})]}),e.jsx(tt,{w:"48px",h:"48px",src:r.activeImgUrl,opacity:o===r.value?"0.8":"0.4"})]},r.value)})})}function Ve(t){const{isApp:o}=V();return o?e.jsx(Ms,{...t}):e.jsx(Xs,{...t})}const $s=(t,o)=>({coinHoldingList:[],isCoinHoldingLoading:!0,setIsCoinHoldingLoading:s=>t({isCoinHoldingLoading:s}),setCoinHoldingList:s=>t({coinHoldingList:s}),isCoinPriceLoading:!0,setIsCoinPriceLoading:s=>t({isCoinPriceLoading:s}),holdingsTotalUsd:"0",setHoldingsTotalUsd:s=>t({holdingsTotalUsd:s}),unknownCoinCount:0,setUnknownCoinCount:s=>t({unknownCoinCount:s})}),Ce=ot($s);function ut(){const{currentAccount:t}=M(),{fetchAccountBalance:o}=ds(),{coinHoldingList:s,setCoinHoldingList:a,setIsCoinHoldingLoading:r,setIsCoinPriceLoading:i,setHoldingsTotalUsd:n,isCoinPriceLoading:l,setUnknownCoinCount:c}=Ce(),{getTokenListInfo:x}=dt(),{getTokenPrice:u}=pe(),{refreshCoinPriceInfo:d}=Fe(),C=p.useRef(t==null?void 0:t.address);p.useEffect(()=>{C.current=t==null?void 0:t.address},[t==null?void 0:t.address]);const j=async()=>{const g=C.current;if(g){r(!0);const y=await o(g,!0);if(y){const k=await x(y.filter(T=>B(T.totalBalance).gt(0)).map(T=>T.coinType));if(!k)throw r(!1),a([]),new Error("get token list info error");const v=[];let R=0;return y.forEach(T=>{const D=k.get(T.coinType);if(D){const h=T.totalBalance,P=ae(h,D.decimals).toString(),H=se(P,void 0,void 0,Ct.ROUND_DOWN).toString(),E={balance:h,balance_format:P,balance_display:H,balance_usd:"0",coin:D,coin_type:D==null?void 0:D.coin_type,price:"",price_diff_24:""};v.push(E),D.is_verified||R++}}),console.log("ðŸš€ ~ fetchCoinHoldingList ~ owner:",g),console.log("ðŸš€ ~ fetchCoinHoldingList ~ currentAccountRef.current:",C.current),g===C.current&&(a(v),c(R),b([...v])),r(!1),v}}else r(!1),a([]);return[]},b=async g=>{i(!0);try{await d(g.filter(y=>y.coin.is_verified).map(y=>y.coin.coin_type),!0)}catch(y){console.error("fetch coin price info error",y)}finally{i(!1)}},L=g=>{g.forEach(y=>{const{coin:k}=y;if(k.is_verified){const v=u(k.coin_type);v&&(y.price=v.price,y.price_diff_24=v.price_change||"",y.balance_usd=B(y.balance_format).mul(v.price).toString())}})},O=async g=>{if(console.log("ðŸš€ ~ getFilterCoinHoldingList ~ filter:",{filter:g,coinHoldingList:s,currentAccount:t}),t){const{search:y,current_sort:k,current_sort_order:v,is_show_unknown:R=!1,is_hide_small_balance:T=!0}=g;let D=[];if(R?D.push(...s):D=s.filter(h=>h.coin.is_verified),y){const h=y.toLowerCase();D=D.filter(P=>P.coin.coin_type.toLowerCase().includes(h)||P.coin.symbol.toLowerCase().includes(h)||P.coin.name.toLowerCase().includes(h))}return L(D),T&&!l&&(D=D.filter(h=>B(h.balance_usd).gt(.01))),D.sort((h,P)=>{if(k==="balance"){const H=B(h.balance_format).cmp(B(P.balance_format));if(H!==0)return v==="desc"?-H:H}if(k==="value"){const H=B(h.balance_usd).cmp(B(P.balance_usd));return H!==0?v==="desc"?-H:H:B(P.balance_format).cmp(B(h.balance_format))}if(k==="price"){const H=B(h.price).cmp(B(P.price));return H!==0?v==="desc"?-H:H:B(P.balance_format).cmp(B(h.balance_format))}return 0}),console.log("ðŸš€ ~ getFilterCoinHoldingList ~ tempList:",D),D}return[]};return p.useEffect(()=>{L(s);const g=s.reduce((y,k)=>y+Number(k.balance_usd||0),0);n(g.toString())},[s,l]),{getFilterCoinHoldingList:O,fetchCoinHoldingList:j,resetUserData:()=>{a([]),n("0"),c(0)}}}function Ns({inputValue:t,changeInputValue:o}){const s=p.useRef(null),[a,r]=p.useState(!1);return V(),e.jsxs(gt,{w:a?"203px":"32px",h:"32px",transition:"width 0.1s ease",_hover:{bg:"bg_secondary"},border:"1px solid",borderColor:"border",borderRadius:"8px",children:[e.jsx(ht,{top:"calc(50% - 10px)",left:"5px",children:e.jsx(U,{xlinkHref:"#icon-icon_search",svgHover:"text_paragraph",onClick:i=>{var n;(n=s.current)==null||n.focus(),r(!0)}})}),e.jsx(ft,{bg:"bg_secondary",ref:s,h:"30px",variant:"unstyled",outline:"none",borderRadius:"8px",value:t,onChange:i=>{o(i.target.value)},onFocus:()=>{r(!0)},onBlur:()=>{o(""),r(!1)},fontWeight:"500",textAlign:"left",fontSize:"12px",pr:"28px",pl:a?"28px":"8px"}),t?e.jsx(mt,{right:"5px",children:e.jsx(U,{xlinkHref:"#icon-icon_close",onMouseDown:i=>i.preventDefault(),onClick:i=>{o(""),setTimeout(()=>{var n;(n=s.current)==null||n.focus()},0)}})}):null]})}function Vs({inputValue:t,changeInputValue:o,isShowUnknownCoin:s,handleIsShowUnknownCoin:a,isHideLowAsset:r,handleIsHideLowAsset:i,unknownCoinCount:n}){return V(),e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(w,{fontSize:"16px",color:"text_caption",children:"Wallet Holdings"}),e.jsxs(S,{children:[e.jsx(Ns,{inputValue:t,changeInputValue:o}),e.jsx(K,{w:"unset",borderRadius:"8px",p:"0px 8px",h:"32px",children:e.jsxs(S,{h:"100%",justify:"space-between",children:[e.jsxs(w,{whiteSpace:"nowrap",fontSize:"12px",children:["Show Unknown Coin (",n,")"]}),e.jsx(Ue,{isChecked:s,onChange:a})]})}),e.jsx(K,{w:"unset",borderRadius:"8px",p:"0px 8px",h:"32px",children:e.jsxs(S,{h:"100%",justify:"space-between",children:[e.jsx(w,{whiteSpace:"nowrap",fontSize:"12px",children:"Hide Low Asset"}),e.jsx(Ue,{isChecked:r,onChange:i})]})})]})]})}function Gs(){const{isApp:t}=V(),{getFilterCoinHoldingList:o}=ut(),{isCoinHoldingLoading:s,isCoinPriceLoading:a,unknownCoinCount:r}=Ce(),{isAutoRefresh:i}=Y(),[n,l]=p.useState([]),[c,x]=p.useState({current_sort:"value",current_sort_order:"desc",search:"",is_show_unknown:!1,is_hide_small_balance:!0}),[u,d]=p.useState(!1),[C,j]=p.useState(!0),[b,L]=p.useState("desc"),[O,_]=p.useState(Pe[2]),g=m=>{console.log("ðŸš€ ~ applyFilter ~ nextFilter:",m),i||A(1),x(m),o(m).then(l)},y=m=>{g({...c,search:m})},k=(m,z)=>{g({...c,[m]:z}),m==="is_show_unknown"&&d(z),m==="is_hide_small_balance"&&j(z)},v=m=>{const z=(m==null?void 0:m.value)===(O==null?void 0:O.value),W=t||!z?"desc":b==="desc"?"asc":"desc";console.log("ðŸš€ ~ handleSortClick ~ item:",W,m),_(m),L(W),g({...c,current_sort:m.value,current_sort_order:W})};p.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ isCoinHoldingLoading:",s,a,n),!s&&!a&&g(c)},[s,a]);const R=De(),T=m=>{R(`/swap/${m}/''`)},[D,h]=p.useState([]),[P,H]=p.useState(0),[E,A]=p.useState(1),f=10;return p.useEffect(()=>{if((n==null?void 0:n.length)>0){const m=(E-1)*f;(n==null?void 0:n.length)<=m&&A(1)}},[n]),p.useEffect(()=>{if((n==null?void 0:n.length)>0){H(n==null?void 0:n.length);const m=(E-1)*f,z=m+f;console.log("ðŸš€ ~ useEffect ~ start:",E,n.slice(0,z),m,z),(n==null?void 0:n.length)>m&&h(n.slice(m,z))}else h([])},[E,n]),e.jsx(K,{p:"14px 16px 16px",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",children:e.jsxs(F,{w:"100%",align:"flex-start",gap:"16px",children:[e.jsx(Vs,{unknownCoinCount:r,inputValue:c.search||"",changeInputValue:y,isShowUnknownCoin:u,handleIsShowUnknownCoin:m=>k("is_show_unknown",m.target.checked),isHideLowAsset:C,handleIsHideLowAsset:m=>k("is_hide_small_balance",m.target.checked)}),e.jsx(N,{h:"1px",w:"100%",bg:"border",mt:"-2px"}),e.jsxs(F,{w:"100%",position:"relative",gap:"20px",children:[!s&&!a&&(n==null?void 0:n.length)===0?e.jsx(ee,{type:"nodata",text:"No tokens found",noBorder:!0}):t?e.jsxs(F,{w:"100%",gap:"4px",children:[e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsx(w,{fontSize:"24px",color:"text_caption",children:"Tokens"}),e.jsx(ws,{sortText:"Sort by",minW:"180px",currentSort:O,sortByList:Pe,onSortByChange:v,xlinkHref:b==="desc"?"#icon-icon_sort2":"#icon-icon_sort_asc1",iconOnClick:()=>L(m=>m==="desc"?"asc":"desc")})]}),e.jsx(Ae,{rowKey:"coin_type",columns:Ge(b,O,v,T,!i&&a),dataSource:D,loading:!i&&(s||a),itemSkeletonLength:5,itemHeight:"30px",onRowClick:m=>{T(m==null?void 0:m.coin_type)}})]}):e.jsx(He,{rowKey:"coin_type",columns:Ge(b,O,v,T,!i&&a),dataSource:D,skeletonLength:5,loading:!i&&(s||a),rowStyle:{h:"72px",cursor:"pointer"},onRowClick:m=>{T(m==null?void 0:m.coin_type)}}),(n==null?void 0:n.length)>f&&e.jsx(I,{children:e.jsx(we,{total:P,size:f,currentPage:E,onChange:m=>{A(m)}})})]})]})})}const Pe=[{label:"Balance",value:"balance"},{label:"Price",value:"price"},{label:"Value",value:"value"}],Te=Object.fromEntries(Pe.map(t=>[t.value,t])),Ge=(t,o,s,a,r)=>[{title:e.jsx(w,{children:"Token"}),key:"pool",thConfig:{w:"22%"},showLabel:!1,render:({coin:i})=>e.jsx(pt,{haveTooltip:!0,token:i,warningIcon:{iconW:"14px",iconH:"14px"}})},{title:e.jsx(ve,{labelInfo:Te.balance,sortRule:t,sortBy:o,clickSort:s}),key:"balance",thConfig:{w:"20%"},render:({coin:i,balance_display:n})=>e.jsxs(w,{color:"text_caption",children:[n," ",yt(i==null?void 0:i.symbol,10)]})},{title:e.jsx(ve,{labelInfo:Te.price,sortRule:t,sortBy:o,clickSort:s}),key:"price",thConfig:{w:"20%"},render:({price:i,price_diff_24:n})=>{const l=B(n).gt(0);return e.jsx(S,{justify:"flex-end",children:e.jsx(J,{isLoaded:!r,children:e.jsxs(S,{gap:"2px",children:[e.jsxs(w,{color:"text_caption",children:["$",it(i)]}),e.jsxs(w,{color:Number(n)===0?"text_caption":l?"primary_green":"primary_red",children:["(",l?"+":B(n).gt(-1e-4)&&B(n).lt(0)?"-":"",B(n).gt(-1e-4)&&B(n).lt(1e-4)?"0%":_t(B(n).mul(100).toString(),2,!1,!1),")"]})]})})})}},{title:e.jsx(ve,{labelInfo:Te.value,sortRule:t,sortBy:o,clickSort:s}),key:"balance_usd",thConfig:{w:"20%"},render:({balance_usd:i})=>e.jsx(S,{justify:"flex-end",children:e.jsx(J,{isLoaded:!r,children:e.jsx(w,{color:"text_caption",children:ie(i,2)})})})},{title:e.jsx(w,{textAlign:"right",children:"Action"}),showLabel:!1,thConfig:{w:"18%"},key:"actions",render:i=>e.jsx(X,{w:{base:"calc(100% - 32px)",lg:"unset"},p:"8px",h:"32px",fontSize:{base:"14px",lg:"12px"},borderRadius:"8px",variant:"outline",fontWeight:"500",onClick:()=>{a(i==null?void 0:i.coin_type)},children:"Swap"})}],qs=(t,o)=>({isXCetusModalOpen:!1,setIsXCetusModalOpen:s=>t({isXCetusModalOpen:s}),isXCetusLoading:!1,setIsXCetusLoading:s=>t({isXCetusLoading:s}),currentXCetusTab:"Get xCETUS",setCurrentXCetusTab:s=>t({currentXCetusTab:s})}),ye=ot(qs),Ks={cetus:{title:"CETUS Holdings",imgUrl:$.cetus_coin.logo_url,bgUrl:"/images/bg_cetus.png"},xcetus:{title:"xCETUS Holdings",imgUrl:$.x_cetus_coin.logo_url,bgUrl:"/images/bg_xcetus.png"},rewards:{title:"xCETUS Rewards",imgUrl:"/images/icon_rewards.png",bgUrl:"/images/bg_rewards.png"}};function Be({type:t,amount:o,amountUSD:s,isLoading:a,children:r}){const{title:i,imgUrl:n,bgUrl:l}=Ks[t];return e.jsx(K,{flex:"1",bg:`center / cover no-repeat url(${l})`,p:"20px",borderRadius:"16px",backdropFilter:"blur(50px)",children:e.jsxs(F,{w:"100%",align:"flex-start",h:"88px",gap:"22px",children:[e.jsxs(S,{children:[e.jsx(ke,{imageUrl:n,imgBoxStyle:{w:"20px",h:"20px",bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsx(w,{children:i})]}),e.jsxs(S,{w:"100%",justify:"space-between",children:[e.jsxs(F,{align:"flex-start",w:"100%",gap:"4px",children:[e.jsx(J,{isLoaded:!a,h:"24px",children:e.jsx(w,{color:"text_caption",h:"24px",lineHeight:"24px",fontSize:"20px",children:o})}),s!==void 0&&e.jsx(J,{isLoaded:!a,h:"17px",children:e.jsxs(w,{h:"17px",lineHeight:"17px",fontSize:"14px",children:["$",it(s,2)]})})]}),r]})]})})}function Is(){const{currentAccount:t}=M(),{balanceInfo:o}=Cs($.cetus_coin),{getTokenAmountValue:s}=pe(),{coinPriceObj:a}=Oe(),r=p.useMemo(()=>s($.cetus_coin.coin_type,ae((o==null?void 0:o.balance)||"0",$.cetus_coin.decimals)).toString(),[o==null?void 0:o.balance,t==null?void 0:t.address,a]),{setCurrentXCetusTab:i,setIsXCetusModalOpen:n}=ye(),l=()=>{n(!0),i("Get xCETUS")},{veNFT:c,veNFTLoading:x,lockCetusListLoading:u}=Q();return e.jsx(Be,{type:"cetus",amount:t?(o==null?void 0:o.balanceFormat)||"0":"--",amountUSD:r,isLoading:(u||x)&&c!==void 0,children:e.jsx(X,{onClick:l,variant:"outline",color:"primary",flex:"0 0 120px",fontSize:"12px",fontWeight:"500",children:"Convert to xCETUS"})})}function Qs(){const{lockCetusList:t,lockCetusListLoading:o}=Q(),[s,a]=p.useState([]),[r,i]=p.useState(0),[n,l]=p.useState(1),c=10;return p.useEffect(()=>{if((t==null?void 0:t.length)>0){const x=(n-1)*c;(t==null?void 0:t.length)<=x&&l(1)}},[t]),p.useEffect(()=>{if((t==null?void 0:t.length)>0){i(t==null?void 0:t.length);const x=(n-1)*c,u=x+c;console.log("ðŸš€ ~ useEffect ~ start:",n,t.slice(0,u),x,u),(t==null?void 0:t.length)>x&&a(t.slice(x,u))}},[n,t]),t&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(jt,{orientation:"horizontal"}),e.jsxs(F,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(w,{fontWeight:"500",fontSize:"14px",color:"text_caption",children:"Vesting"}),e.jsx(F,{w:"100%",gap:"12px",children:s==null?void 0:s.map(x=>e.jsx(Ys,{order:x},x==null?void 0:x.id))}),(t==null?void 0:t.length)>c&&e.jsx(I,{w:"100%",children:e.jsx(we,{total:r,size:c,currentPage:n,onChange:x=>{l(x)}})})]})]})}const Ys=({order:t})=>{const[o,s]=p.useState(!Le.isLocked(t));p.useEffect(()=>{s(!Le.isLocked(t))},[t==null?void 0:t.id]);const{cancelOrderLoading:a,handleCancelOrder:r}=ps(),{claimOrderLoading:i,handleClaimOrder:n}=xs(),{days:l,hours:c,minutes:x,seconds:u}=us(t.locked_until_time*1e3,()=>{s(!0)},"days"),d=C=>{C?n(t.id):r(t)};return e.jsxs(S,{justify:"space-between",w:"100%",h:"80px",p:"0 20px",children:[o?e.jsxs(S,{p:"8px 12px 8px 8px",borderRadius:"8px",bg:"primary_opacity.10",children:[e.jsx(U,{xlinkHref:"#icon-icon_check",svgFill:"primary",fontSize:"20px"}),e.jsx(w,{color:"primary",fontSize:"13px",children:"Available"})]}):e.jsxs(S,{p:"8px",borderRadius:"8px",bg:"text_paragraph_opacity.10",children:[e.jsx(U,{xlinkHref:"#icon-icon_time",svgFill:"text_paragraph",fontSize:"20px"}),e.jsxs(N,{as:"div",children:[e.jsxs(w,{as:"span",color:"text_paragraph",fontSize:"13px",children:["Available in"," "]}),e.jsxs(w,{as:"span",color:"text_caption",fontSize:"13px",children:[l,"d : ",c,"h : ",x,"m : ",u,"s"]})]})]}),e.jsxs(S,{gap:"12px",children:[e.jsx(gs,{xcetus_amount:t.xcetus_amount,cetus_amount:t.cetus_amount,imageSize:"20px"}),e.jsx(X,{onClick:()=>{a||i||d(o)},variant:"unstyled",border:"none",h:{base:"40px",lg:"28px"},w:{base:"168px",lg:"80px"},borderRadius:{base:"12px",lg:"8px"},fontSize:"14px",isLoading:a||i,color:o?"background":"primary_gray",bg:o?"primary":"card_bg",children:o?"Claim":"Cancel"})]})]})};function Zs({totalRewardValue:t,rewardList:o,summaryRewardList:s}){const{currentAccount:a}=M(),{veNFTLoading:r}=Q(),{claimRewardLoading:i,handleClaimReward:n}=hs(),l=()=>{i||n(o)};return V(),e.jsx(Be,{type:"rewards",amount:a?e.jsx(le,{tooltip:e.jsx(F,{w:"100%",align:"flex-start",bg:"bg_secondary",gap:"0px",children:s==null?void 0:s.map(c=>(console.log("ðŸš€ ~ {yieldList?.map ~ item:",c),e.jsxs(S,{w:"100%",p:"10px 12px",minW:"300px",justify:"space-between",children:[e.jsx(pt,{coinType:c.coin_type,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(S,{gap:"4px",children:[e.jsx(w,{fontSize:"12px",color:"text_caption",children:se(c==null?void 0:c.amount,6)}),e.jsxs(w,{fontSize:"12px",children:["(",ie(c==null?void 0:c.value,2),")"]})]})]},c.coin_type)))}),children:e.jsx(w,{textDecoration:"underline dotted",textUnderlineOffset:"3px",textDecorationColor:"text_paragraph",cursor:"pointer",color:"text_caption",h:"24px",lineHeight:"24px",fontSize:"20px",children:ie(t,2)})}):"--",isLoading:r,children:e.jsx(X,{onClick:l,variant:"unstyled",bg:"primary",border:"none",color:"background",flex:"0 0 120px",fontSize:"12px",fontWeight:"500",children:"Claim"})})}function Js(){const{currentAccount:t}=M(),{veNFT:o,veNFTLoading:s,lockCetusListLoading:a}=Q(),{getTokenAmountValue:r}=pe(),{coinPriceObj:i}=Oe(),n=p.useMemo(()=>r($.cetus_coin.coin_type,ae((o==null?void 0:o.xcetus_balance)||"0",$.x_cetus_coin.decimals)).toString(),[o==null?void 0:o.xcetus_balance,t==null?void 0:t.address,i]),{setCurrentXCetusTab:l,setIsXCetusModalOpen:c}=ye(),x=()=>{c(!0),l("Redeem CETUS")},u=(a||s)&&o!==void 0;return e.jsx(Be,{type:"xcetus",amount:t?se(ae((o==null?void 0:o.xcetus_balance)||"0",9),9).toString():"--",amountUSD:n,isLoading:u,children:e.jsx(X,{onClick:x,variant:"outline",color:"primary",flex:"0 0 120px",fontSize:"12px",fontWeight:"500",children:"Redeem"})})}const ge=[{label:"Get xCETUS",value:"Get xCETUS"},{label:"Redeem CETUS",value:"Redeem CETUS"}];function en({isOpen:t,onClose:o,availableXCetusAmount:s}){const{currentXCetusTab:a,setCurrentXCetusTab:r}=ye(),[i,n]=p.useState("#icon-a-icon_trade"),l=()=>{n("#icon-icon_swap1")},c=()=>{n("#icon-a-icon_trade")},x=()=>{var d;const u=(d=ge==null?void 0:ge.find(C=>(C==null?void 0:C.value)!==a))==null?void 0:d.value;u&&r(u)};return e.jsxs(Ie,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:o,isCentered:!0,children:[e.jsx(Qe,{}),e.jsxs(Ye,{children:[e.jsx(Ze,{p:"0 16px",children:e.jsx(N,{borderBottom:"1px solid",borderColor:"border",children:e.jsx(je,{type:"borderTab",wrapStyle:{w:"fix-content",border:"none",h:"58px",background:"transparent",gap:"40px"},itemStyle:{w:"auto",fontSize:"16px"},tabList:ge,currentTab:a,handleChangeTab:u=>{r(u==null?void 0:u.value)}})})}),e.jsx(Je,{}),e.jsxs(et,{p:"20px 16px 16px",children:[a==="Get xCETUS"&&e.jsx(fs,{onClose:o,availableXCetusAmount:s,onIconClick:x,iconParams:{xlinkHref:i,svgFill:"text_caption",transform:i==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:i==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:l,onMouseLeave:c}}),a==="Redeem CETUS"&&e.jsx(ms,{onClose:o,availableXCetusAmount:ae(s,9),onIconClick:x,iconParams:{xlinkHref:i,svgFill:"text_caption",transform:i==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:i==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:l,onMouseLeave:c}})]})]})]})}function tn(){const{isXCetusModalOpen:t,setIsXCetusModalOpen:o}=ye(),{availableXCetusAmount:s,totalRewardValue:a,rewardList:r,summaryRewardList:i}=js();return e.jsx(K,{w:"100%",bg:"block_color_opacity.50",backdropFilter:"blur(20px)",children:e.jsxs(F,{w:"100%",gap:"16px",children:[e.jsxs(S,{w:"100%",gap:"10px",children:[e.jsx(Js,{}),e.jsx(Is,{}),e.jsx(Zs,{totalRewardValue:a,rewardList:r,summaryRewardList:i})]}),e.jsx(Qs,{}),t&&e.jsx(en,{isOpen:t,onClose:()=>o(!1),availableXCetusAmount:s})]})})}function sn(){const{currentAccount:t}=M(),{orderListLoading:o,myOrderList:s}=xe(),{isAutoRefresh:a,dcaOrderListLoading:r,dcaActiveOrderList:i}=Y(),{getTokenAmountValue:n,coinPriceObj:l}=pe(),c=p.useMemo(()=>{let d=B(0);if(a||!o)return(s==null?void 0:s.length)>0&&(t!=null&&t.address)?(s.forEach(C=>{const{pay_coin:j,target_coin:b,un_claimed_amount:L,remaining_amount:O}=C,_=n(j.coin_type,O),g=n(b.coin_type,L);d=B(d).plus(_).plus(g),console.log("ðŸš€ ~ myOrderList.forEach ~ limitTotalTvl:",d.toString())}),d.toString()):"0"},[a,s,t==null?void 0:t.address,o,l]),x=p.useMemo(()=>{let d=B(0);if(a||!r)return(i==null?void 0:i.length)>0&&(t!=null&&t.address)?(i.forEach(C=>{const{inBalance:j,inCoin:b,outBalance:L,outCoin:O}=C,_=n(b.coin_type,j),g=n(O.coin_type,L);d=B(d).plus(_).plus(g),console.log("ðŸš€ ~ dcaActiveOrderList.forEach ~ total:",d.toString())}),d):"0"},[a,i,t==null?void 0:t.address,r,l]),u=p.useMemo(()=>{if(console.log("ðŸš€ ~ useGetActivityTvl ~ dcaTotalTvl, limitTotalTvl:",x,c),x&&c){let d=B(0);return d=B(d).plus(x).plus(c),d.toString()}return"--"},[x,c]);return{limitTotalTvl:c,dcaTotalTvl:x,orderTotalTvl:u}}function nn(){const{currentAccount:t}=M(),{isAutoRefresh:o}=Y(),{veNFT:s,veNFTLoading:a,lockCetusListLoading:r}=Q(),{getTokenAmountValue:i}=pe(),{coinPriceObj:n}=Oe();return{xCetusTotalTvl:p.useMemo(()=>{if(o||!a&&!r)return t!=null&&t.address&&s?i($.cetus_coin.coin_type,ae(s==null?void 0:s.xcetus_balance,$.cetus_coin.decimals)).toString():"0"},[o,s==null?void 0:s.xcetus_balance,r,a,t==null?void 0:t.address,n])}}const on="fetch-coin-holding-list",an="fetch-owner-nft",rn="fetch-active-order-list",ln="fetch-xcetus-base-info";function cn(){const{currentAccount:t}=M(),{getTokenListInfo:o}=dt(),{getLimitUserIndexer:s,getDcaUserIndexer:a}=bs(),{setOrderListLoading:r,setMyOrderList:i}=xe(),{setDcaOrderListLoading:n,setDcaActiveOrderList:l,setDcaPastOrderList:c}=Y(),{refreshCoinPriceInfo:x}=Fe(),{buildDcaOrderList:u}=Ut(),{peripherySdk:d}=be(),{formatLimitOrderList:C}=It(),j=p.useRef(t==null?void 0:t.address);p.useEffect(()=>{j.current=t==null?void 0:t.address},[t==null?void 0:t.address]);const b=async()=>{if(t){r(!0);const g=await s(t.address);if(console.log("ðŸš€ ~ fetchUserLimitOrderIds ~ indexer:",g),g)try{return(await d.ClmmSDK.fullClient.getDynamicFieldsByPage(g)).data.map(v=>v.name.value)}catch(y){console.log("ðŸš€ ~ fetchUserLimitOrderIds ~ error:",y)}}return[]},L=async()=>{if(t){n(!0);const g=await a(t.address);if(console.log("ðŸš€ ~ fetchUserDacOrderIds ~ indexer:",g),g)try{return(await d.ClmmSDK.fullClient.getDynamicFieldsByPage(g)).data.map(v=>v.name.value)}catch(y){console.log("ðŸš€ ~ fetchUserDacOrderIds ~ error:",y)}}return[]};return{fetchActiveOrderList:async()=>{try{const g=await b(),y=await L(),k=await d.ClmmSDK.fullClient.batchGetObjects([...g,...y],{showType:!0,showContent:!0}),v=k.filter(f=>{var m,z;return(z=(m=f.data)==null?void 0:m.type)==null?void 0:z.includes("limit_order::LimitOrder")}),R=k.filter(f=>{var m,z;return(z=(m=f.data)==null?void 0:m.type)==null?void 0:z.includes("order::Order")}),D=v.map(f=>St.buildLimitOrderInfo(f)).filter(f=>f!==void 0).filter(f=>f.status===We.PartialCompleted||f.status===We.Running),h=R.map(f=>{var q,ne,ce,G,de,oe,ue,Ee;const m=fe(((q=f.data)==null?void 0:q.type)||""),z=m.type_arguments[0],W=m.type_arguments[1];return{in_coin_type:z,out_coin_type:W,...(ce=(ne=f.data)==null?void 0:ne.content)==null?void 0:ce.fields,id:(ue=(oe=(de=(G=f.data)==null?void 0:G.content)==null?void 0:de.fields)==null?void 0:oe.id)==null?void 0:ue.id,version:(Ee=f.data)==null?void 0:Ee.version}}),P=new Set;for(const f of D)P.add(f.pay_coin_type),P.add(f.target_coin_type);for(const f of h)P.add(f.in_coin_type),P.add(f.out_coin_type);await o(Array.from(P));const H=await C(D);i(H);const{activeResult:E,pastResult:A}=await u(h);j.current===(t==null?void 0:t.address)&&(l(E),c(A),console.log("ðŸš€ ~ fetchActiveOrderList ~ limitOrderList:",H),console.log("ðŸš€ ~ fetchActiveOrderList ~ dcaOrderList:",h)),x(Array.from(P))}catch(g){console.log("ðŸš€ ~ fetchActiveOrderList ~ error:",g)}finally{r(!1),n(!1)}},resetUserData:()=>{console.log("ðŸš€ ~ resetUserData ~ resetUserData"),i([]),l([]),c([])}}}function dn(){const{currentAccount:t}=M(),{clmmSdk:o}=at(),{xCetusSdk:s}=be(),{buildFarmsPositionType:a,buildBurnPositionType:r}=Zt(),{setPosBaseList:i,setFullRangePosBaseList:n,setPosBaseListLoading:l}=re(),{setVeNFT:c,setVeNFTLoading:x,setLockCetusList:u,clearData:d,setLockCetusListLoading:C}=Q(),{formatPosBaseList:j}=ct(),b=p.useRef(t==null?void 0:t.address);return p.useEffect(()=>{b.current=t==null?void 0:t.address},[t==null?void 0:t.address]),{fetchOwnerNFT:async()=>{try{const _=b.current;if(_){l(!0),x(!0);const g=await o.fullClient.getOwnedObjectsByPage(_,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:$.clmm_sdk_options.clmm_pool.package_id},{StructType:a},{StructType:r},{StructType:ys},{StructType:_s}]}});let y=await j(g);i(y),l(!1),(y==null?void 0:y.length)==0&&n([]);const k=Ss(g.data);if(k&&_===b.current){c(k,_);const v=await vs(g.data,s);v.sort((R,T)=>R.locked_until_time-T.locked_until_time),console.log("ðŸš€ ~ fetchOwnerNFT ~ lockList:",v),u(v)}else C(!1);return{veNFT:k,posBaseList:y}}}catch(_){console.error("ðŸš€ ~ fetchOwnerNFT ~ error:",_),_ instanceof TypeError&&(l(!1),i([]))}finally{l(!1),x(!1)}return{veNFT:void 0,posBaseList:[]}},resetUserData:()=>{i([]),d()}}}function pn(){const{currentAccount:t}=M(),{peripherySdk:o}=be(),{clmmSdk:s}=at(),{getPosRelatedData:a,getPositionBaseList:r}=ct(),{getPosPoolsOriginalObj:i,getPosPoolsRelatedData:n}=Jt(),{getPosLiquidityData:l}=es(),{setPosLiquidityData:c,setFarmsPosRewardsData:x,setFarmsPosRewardsDataLoading:u,setPosRewardsData:d,setPosRewardsDataLoading:C,setPosFeeData:j,setPosFeeDataLoading:b}=re(),{formatFarmsRewardsData:L}=ts(),{formatPosRewardsData:O}=ss(),{formatPosFeeData:_}=ns(),{posBaseList:g,setShowPosListLength:y,setMyPosYieldValue:k}=re(),{refreshCoinPriceInfo:v}=Fe(),R=async h=>{var A;const P=h.filter(f=>f.posType==="farms"&&f.farmsPool),H=await i(h);if(n(h,H),t!=null&&t.address){const f=await r(t==null?void 0:t.address);a(f)}if(((A=Object.keys(H))==null?void 0:A.length)===0)throw c({}),new Error("No pool data found");l(h,H);const E=new vt;P.length>0&&P.forEach(f=>{o.Farms.buildCalculateFarmingReward({pool_id:f.farmsPool,position_nft_id:f.id},E)}),h.forEach(f=>{s.Rewarder.buildFetchPosFee({poolAddress:f.clmmPool,positionId:f.posId,coinTypeA:f.coinTypeA,coinTypeB:f.coinTypeB},E)}),h.filter(f=>f.posType!=="farms").forEach(f=>{const m=H[f.clmmPool];s.Rewarder.buildFetchPosReward({poolAddress:f.clmmPool,positionId:f.posId,coinTypeA:f.coinTypeA,coinTypeB:f.coinTypeB,rewarderInfo:m.rewarder_infos},E)});try{u(!0),C(!0),b(!0);const f=await s.fullClient.devInspectTransactionBlock({transactionBlock:E,sender:Tt("0x0")}),m=o.Farms.parsedPosRewardData(f),z=s.Rewarder.parsedPosRewardData(f),W=s.Rewarder.parsedPosFeeData(f);console.log("ðŸš€ ~ fetchPosRelatedData ~ parsedPosRewardData:",{farmsRewardData:m,clmmRewardData:z,clmmFeeData:W});const q=await L(m);x(q);const ne=await O(Object.values(z).map(G=>{const de=H[h.find(oe=>oe.posId===G.position_id).clmmPool];return{poolAddress:de.pool_address,positionId:G.position_id,rewarderAmountOwed:G.rewarder_amount.map((oe,ue)=>({coin_address:de.rewarder_infos[ue].coinAddress,amount_owed:new _e(oe)}))}}));d(ne);const ce=await _(Object.values(W).map(G=>({position_id:G.position_id,feeOwedA:new _e(G.fee_owned_a),feeOwedB:new _e(G.fee_owned_b)})),h);j(ce),console.log("ðŸš€ ~ fetchPosRelatedData ~ posFeeData:",{posFeeData:ce,posRewardsData:ne,posFarmsRewardsObj:q}),T(ne,q)}catch(f){console.error("ðŸš€ ~ fetchPosRelatedData ~ error:",f)}finally{u(!1),C(!1),b(!1)}},T=async(h,P)=>{const H=[];if(g.length>0){g.map(A=>{H.push(fe(A==null?void 0:A.coinTypeA).full_address),H.push(fe(A==null?void 0:A.coinTypeB).full_address);const f=h[A==null?void 0:A.posId]||[],m=P[A==null?void 0:A.id]||[],z=f.concat(m);z==null||z.map(W=>{var q;kt(W==null?void 0:W.display_amount_owed).gt(0)&&H.push(fe((q=W==null?void 0:W.token)==null?void 0:q.coin_type).full_address)})});const E=Array.from(new Set(H));console.log("ðŸš€ ~ refreshTokenPrice ~ list:",E),v(E)}};return{fetchPosRelatedData:R,resetUserData:()=>{c({}),x({}),d({}),j({})}}}function xn(){const{currentAccount:t}=M(),{setXCetusManager:o,setDividendManager:s}=Q(),{xCetusSdk:a}=be();return{fetchXCetusBaseInfo:async i=>{try{const{xcetus:n,xcetus_dividends:l}=$.xcetus_sdk_options,{dividend_manager_id:c}=Xe(l),{xcetus_manager_id:x}=Xe(n),u=await a.fullClient.batchGetObjects([x,c],{showType:!0,showContent:!0}),d=u.find(j=>{var b,L;return(L=(b=j.data)==null?void 0:b.type)==null?void 0:L.includes("xcetus::XcetusManager")});if(d){const j=$e(d),b={id:j.id.id,index:Number(j.index),has_venft:{handle:j.has_venft.fields.id.id,size:j.has_venft.fields.size},nfts:{handle:j.nfts.fields.id.id,size:j.nfts.fields.size},total_locked:j.total_locked,treasury:j.treasury.fields.total_supply.fields.value};console.log("ðŸš€ ~ fetchXCetusBaseInfo ~ xCetusManager:",b),o(b)}const C=u.find(j=>{var b,L;return(L=(b=j.data)==null?void 0:b.type)==null?void 0:L.includes("dividend::DividendManager")});if(C){const j=$e(C),b=Le.buildDividendManager(j);console.log("ðŸš€ ~ fetchXCetusBaseInfo ~ dividendManager:",b),a.XCetusModule.updateCache(`${c}_getDividendManager`,b),s(b)}}catch(n){console.log("ðŸš€ ~ fetchXCetusBaseInfo ~ error:",n)}}}}function un(t){const{currentAccount:o}=M(),{fetchCoinHoldingList:s,resetUserData:a}=ut(),{fetchPosRelatedData:r,resetUserData:i}=pn(),{fetchActiveOrderList:n,resetUserData:l}=cn(),{setAutoRefreshCount:c}=Y(),{fetchOwnerNFT:x,resetUserData:u}=dn(),{fetchXCetusBaseInfo:d}=xn(),{addTask:C,removeTask:j}=ks(),[b,L]=p.useState([]),O=p.useRef(o),{fetchOwnerLockCetusList:_}=Ts(),{setOrderListLoading:g}=xe(),{setLockCetusListLoading:y}=Q(),{setPosBaseListLoading:k}=re(),{setIsCoinHoldingLoading:v}=Ce(),R=()=>{a(),i(),l(),u()};p.useEffect(()=>{var A,f;o?((A=O.current)!=null&&A.address&&((f=O.current)==null?void 0:f.address)!==(o==null?void 0:o.address)&&(c(!1),R(),b.forEach(m=>{j(m.id)})),H()):(R(),b.forEach(m=>{j(m.id)})),O.current=o},[o==null?void 0:o.address]);const T={id:on,run:s},D={id:an,run:x,onSuccess:A=>{const{veNFT:f,posBaseList:m}=A;r(m),f&&(o!=null&&o.address)&&_(o==null?void 0:o.address)}},h={id:ln,run:d},P={id:rn,run:n},H=()=>{const A=[];g(!0),y(!0),k(!0),v(!0),t==="wallet"?A.push(T,D,P,h):t==="liquidity"?A.push(D,T,P,h):t==="orders"?A.push(P,T,D,h):A.push(D,h,T,P),L(A),A.forEach(f=>{C(f)})};return{refreshTask:()=>{o&&(b.forEach(A=>{j(A.id)}),H())}}}const he=t=>t?ie(t,2):"$--",gn=(...t)=>t.reduce((o,s)=>o.plus(s&&+s?s:0),B(0)).toString();function jo(){const{tab:t}=cs(),{currentAccount:o,onWalletModal:s}=M(),a=De(),{posBaseListLoading:r,posLiquidityDataLoading:i}=re(),{holdingsTotalUsd:n,isCoinPriceLoading:l,isCoinHoldingLoading:c}=Ce(),{clmmTotalTvl:x}=rs(),{orderTotalTvl:u}=sn(),{orderListLoading:d}=xe(),{isAutoRefresh:C,dcaOrderListLoading:j,setAutoRefreshCount:b,resetAutoRefreshCount:L}=Y(),{xCetusTotalTvl:O}=nn(),{lockCetusListLoading:_,veNFTLoading:g,veNFT:y}=Q(),k=p.useMemo(()=>t||"wallet",[t]),{refreshTask:v}=un(k),R=!C&&(c||l),T=!C&&(r||i),D=!C&&(d||j),h=!C&&(_||g),P=p.useMemo(()=>(console.log("ðŸš€ ~ ProfilePage ~ holdingsTotalUsd",n,x,u,O),{wallet:{totalValue:he(n),isLoading:R},liquidity:{totalValue:he(x),isLoading:T},orders:{totalValue:he(u),isLoading:D},xCetus:{totalValue:he(O),isLoading:h}}),[n,x,u,O,R,T,D,h]),H=[{title:"Wallet Holdings",value:"wallet",route:"/profile?tab=wallet",activeImgUrl:"/images/wallet_tab.png",showTooltip:!1},{title:"Liquidity",value:"liquidity",route:"/profile?tab=liquidity",activeImgUrl:"/images/liquidity_tab.png",showTooltip:!1},{title:"Orders",value:"orders",route:"/profile?tab=orders",activeImgUrl:"/images/order_tab.png",showTooltip:!0,tooltip:" Total amount of active orders (Limit & DCA)"},{title:"xCETUS",value:"xCetus",route:"/profile?tab=xCetus",activeImgUrl:"/images/xCetus_tab.png",showTooltip:!1}],E=p.useMemo(()=>gn(O,x,u,n),[O,x,u,n]);p.useEffect(()=>L(!1),[]);const[A,f]=p.useState(!1);p.useEffect(()=>{f(!0)},[]);const{isApp:m}=V();return m?e.jsx(Ls,{totalValue:E,onRefreshTask:v,isLoading:!C&&(g||r||d||j),children:e.jsx(Ve,{tabList:H,activeTab:k,tabData:P,onClickTab:z=>a(`/profile?tab=${z}`)})}):e.jsx(F,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",alignItems:"start",children:A?o!=null&&o.address?e.jsxs(F,{w:"100%",gap:"12px",alignItems:"start",children:[e.jsx(Es,{handleRefresh:z=>{b(!z),v()},totalValue:E,isLoading:!C&&(g||r||d||j)}),e.jsx(Ve,{tabList:H,activeTab:k,tabData:P,onClickTab:z=>a(`/profile?tab=${z}`)}),k==="wallet"&&e.jsx(Gs,{}),k==="liquidity"&&e.jsx(Us,{}),k==="orders"&&e.jsx(Bs,{}),k==="xCetus"&&e.jsx(tn,{})]}):e.jsx(ee,{type:"nowallet",mt:"20px",onboard:()=>s(!0)}):e.jsx(Ke,{h:"300px",w:"100%",justifyContent:"center",alignItems:"center",children:e.jsx(Re,{})})})}export{jo as default};
//# sourceMappingURL=Profile-DNoi2Ibf.js.map
