import{y as Qe,a as h,ak as fe,j as e,H as w,C as I,I as se,T as j,f as N,P as ve,h as _e,m as Te,n as Ce,p as z,V as M,F as ae,W as Xe,X as Ze,Y as Ke,a0 as Ie,$ as es,k as Ee,S as ss,q as ts}from"./vendor-BowHGuwE.js";import{a as Z,J as me,K as te,d as m,z as Y,a2 as X,C as rs,B as De,n as Se,a9 as Me,$ as D,aa as ns,r as ke,w as pe,R as ee,f as ue,q as Ne,Z as as,G as ze,y as cs,X as is,h as $e,I as Ue}from"./index-DOpwe9u0.js";import{u as ls,V as os,a as xs,b as ds}from"./VaultsAprBlock-DtHT6CKK.js";import{a as ps,u as us,V as gs}from"./VaultsAction-C8ZxkL3F.js";import{u as qe}from"./useAccountBalance-CdTImFR-.js";import{u as ms}from"./useInterval-BcJtT0it.js";import{P as hs}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as bs}from"./VTextLabelBox-DfMcMnQT.js";import{u as js}from"./global-DdUKxaK0.js";import{u as ce,b as ys,a as ws}from"./usePositionList-C4UKPPMR.js";import{u as Ss}from"./useTransaction-Chv0YO2G.js";import{a as Pe}from"./useWrapPoolData-BZRG_RXy.js";import{h as fs}from"./RemoveBlock-BWLskdS8.js";import{T as vs}from"./TableSortTh-CVhDzobg.js";import{b as _s}from"./useClaimPosition-BXeAf-Cg.js";import{a as Ts}from"./useNotifiSubscription-izrr9CM1.js";import{S as ge,A as He}from"./SingleTokenInfo-BZhis0DU.js";import{T as Cs}from"./TooltipIcon-Cp9kD6GX.js";import{L as ks}from"./ExpendItem-DsJtSB9o.js";import As from"./ExamplePieChart-BeuTZl4s.js";import{u as Ls}from"./useToken-7UZMCtYJ.js";function lt(){const{search:s}=Qe(),[n,o]=h.useState({});return h.useLayoutEffect(()=>{const a=new URLSearchParams(s);o(Object.fromEntries(a.entries()))},[s]),n}const ot=({tooltip:s,...n})=>{const o=fe(),{isApp:a}=Z();return e.jsx(w,{w:"20px",h:"20px",onClick:c=>{te(c),a||o("/farms")},...n,children:e.jsx(me,{placement:"top",tooltip:s||e.jsx(j,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(I,{children:e.jsx(se,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function Rs(s){const{minPrice:n,maxPrice:o,currPrice:a}=s,[c,t]=h.useState(0),[S,y]=h.useState(0),p=h.useRef(null),r=h.useRef(null);h.useEffect(()=>{const g=()=>{p.current&&t(p.current.offsetWidth),r.current&&y(r.current.offsetWidth)},f=new ResizeObserver(g),v=new ResizeObserver(g);return p.current&&f.observe(p.current),r.current&&v.observe(r.current),()=>{p.current&&f.unobserve(p.current),r.current&&v.unobserve(r.current)}},[n,o,a]);const b=h.useMemo(()=>{if(o==="âˆž")return"0px";if(a&&n&&o&&c){if(m(a).lessThanOrEqualTo(o)&&m(a).greaterThanOrEqualTo(n)){const g=m(a).sub(n).div(m(o).sub(m(n))).toString();return`${m(c).mul(g).toFixed(0)}px`}if(m(a).lt(n))return"-36px";if(m(a).gt(o))return"calc(100% + 36px)"}return"0px"},[a,n,o,c]),T=h.useMemo(()=>{const g=b.replace("px","");return Number(g)-S/2+"px"},[b,S]),{isApp:k}=Z();return e.jsx(e.Fragment,{children:n!==void 0&&o!==void 0&&a!==void 0?e.jsx(w,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(N,{w:"100%",padding:n&&m(a).lt(n)?"0 40px 0 60px":o&&m(a).gt(o)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:n&&m(a).lt(n)?"60px":"40px",fontSize:"12px",color:"text_caption",children:Y(n)}),e.jsx(N,{w:"100%",position:"relative",height:"14px",ref:p,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(ve,{isLazy:!0,placement:"top",trigger:k?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(_e,{children:e.jsx(N,{as:"button",children:e.jsx(N,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:b,ml:"-2px",zIndex:"5"})})}),e.jsx(Te,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:T,zIndex:"5",children:e.jsx(Ce,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(j,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:Y(a)})})})]})}),e.jsx(j,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:o&&m(a).gt(o)?"60px":"40px",fontSize:"12px",color:"text_caption",children:Y(o)})]})},b):e.jsx(w,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx(z,{w:"100%",h:"20px"})})})}function Fs(s){const{vaultId:n,displayTokenA:o,displayTokenB:a,feeDisplay:c,minPrice:t,maxPrice:S,currPrice:y}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:p}=ls(),r=h.useMemo(()=>{if(X(p)&&n)return p[n]},[p,n]);return e.jsxs(M,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ae,{children:[e.jsx(rs,{coinAIconUrl:o==null?void 0:o.logo_url,coinBIconUrl:a==null?void 0:a.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ae,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(N,{children:e.jsxs(ae,{alignItems:"center",children:[e.jsx(j,{fontSize:"16px",color:"text_caption",children:`${o==null?void 0:o.symbol} - ${a==null?void 0:a.symbol}`}),e.jsx(De,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(j,{fontSize:"12px",color:"primary",children:c})})]})}),e.jsx(ae,{flexDirection:"column",children:e.jsx(bs,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(os,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(Rs,{minPrice:t,maxPrice:S,currPrice:y})]})}function xt(s){const{currentAccount:n}=Se(),{isOpen:o,setIsOpen:a,vaultId:c,category:t,displayTokenA:S,displayTokenB:y,feeDisplay:p,clmmPool:r,isReverse:b}=s,{isOpenWalletModal:T}=Se(),{getCurrentVaultDetail:k,getCurrentVaultContractInfo:g}=ps(),{clearVaultsActionData:f}=us(),{fetchAccountBalance:v}=qe(),x=fe(),{vaultsPoolObj:C}=xs(),i=h.useMemo(()=>C[c],[C,c]);h.useEffect(()=>{c&&k(c)},[n==null?void 0:n.address,c]);const{getPythLastPrice:l}=ds(),u=h.useRef(!1);h.useEffect(()=>(u.current=!0,()=>{u.current=!1,f()}),[]),h.useEffect(()=>{i!=null&&i.displayCoinTypeA&&(i!=null&&i.displayCoinTypeB)&&l([i==null?void 0:i.displayCoinTypeA,i==null?void 0:i.displayCoinTypeB])},[i==null?void 0:i.displayCoinTypeA,i==null?void 0:i.displayCoinTypeB]),ms({interval:20*1e3,callback:()=>{u.current&&t=="haedal"&&l([i==null?void 0:i.displayCoinTypeA,i==null?void 0:i.displayCoinTypeB])}});const A=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),n!=null&&n.address?(v(),k(c,!0)):g(c)};return e.jsxs(Xe,{isCentered:!0,isOpen:o&&!T,onClose:()=>{a(!1)},children:[e.jsx(Ze,{}),e.jsx(Ke,{width:{base:"100%",lg:"420px"},children:e.jsx(Ie,{p:"0 0 8px",children:e.jsxs(M,{width:"100%",children:[e.jsxs(M,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(w,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(j,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(es,{})]}),e.jsx(Fs,{displayTokenA:S,displayTokenB:y,feeDisplay:p,clmmPool:r,isReverse:b,minPrice:i==null?void 0:i.minPrice,maxPrice:i==null?void 0:i.maxPrice,currPrice:i==null?void 0:i.currentPrice,category:t,vaultId:c}),e.jsx(gs,{vaultId:c,isModal:!0,autoRefresh:A})]}),e.jsxs(w,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:t=="haedal"?"space-between":"center",children:[e.jsx(hs,{mt:"0",category:t}),e.jsx(j,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{t&&c&&(f(),x(`/vaults-detail/${c}/${t}`))},children:"Vault Details >"})]})]})})})]})}function Ge(){const s=(o,a,c,t)=>{const S=Math.max(o,c),p=Math.min(a,t)-S,r=a-o,b=t-c,T=D(p.toString()),k=D(r.toString()),g=D(b.toString());return p<=0?D(0):r<=p?g.div(T):p===b?T.div(k):T.div(g).mul(T.div(k))};return{getPositionApr:(o,a,c,t)=>{if(!X(o)||!X(a)||!X(t))return;const{minPrice:S,maxPrice:y}=a,{tokenA:p,tokenB:r,miningAprList:b,feeApr:T,feeApr7d:k,feeApr30d:g,isReverse:f}=o,v=p==null?void 0:p.decimals,x=r==null?void 0:r.decimals,C=S=="0"&&y=="âˆž",i=S,l=C?2**50:y,{lower:u,upper:A}=t,F=Me.tickIndexToPrice(u,v,x).toNumber(),$=Me.tickIndexToPrice(A,v,x).toNumber(),he=f?Y(D(1).div($).toString()):Y(F),ie=f?Y(D(1).div(F).toString()):Y($),O=s(i,l,he,ie);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:71 ~ getPositionApr ~ positionMulti:ç³»æ•°",O.toString());const R=D(c=="day"?T:c=="month"?g:k).mul(O).toString(),P=[];let W=D(R);return b==null||b.forEach(E=>{const U=D(O).mul(E.apr).toString(),d=Pe(U,!0);P.push({...E,posMiningRewardApr:U,posMiningRewardAprDisplay:d}),W=W.add(U)}),{aprPercentageTotal:W.toString(),displayAprPercentageTotal:ns(W.mul(100).toNumber()),aprByFee:R,aprByFeeDisplay:Pe(R,!0),posMiningReward:P}}}}function Bs(){const[s,n]=h.useState(!1),{getPositionApr:o}=Ge(),{getTokenAmountValue:a}=ke(),{posPoolsRelatedData:c,posLiquidityData:t,posFeeData:S,farmsPosRewardsData:y,posRewardsData:p,posApiPoolData:r,poolRangeObj:b,setPosBaseList:T}=ce(),{mevProtect:k,transactionMode:g,maxCapForGas:f,customGasPrice:v}=js(),{getCloseTsPayloadAll:x}=fs(),{signAndExecuteTransaction:C,transactionConfirmation:i}=Ss(),{fetchAccountBalance:l}=qe(),{getPositionBaseList:u,getPosRelatedData:A}=ys(),{currentAccount:F}=Se(),$=async()=>{const O=await u(F==null?void 0:F.address);A(O)};return{getPositionSortList:(O,R,P)=>{if(!(P!=null&&P.length))return;const W=(d=[])=>d.map(_=>{var L;return{..._,amountUSD:a((L=_==null?void 0:_.token)==null?void 0:L.coin_type,_==null?void 0:_.display_amount_owed)}}).filter(_=>m(_.display_amount_owed).gt(0)),E=P.map(d=>{var Ae,Le,Re,Fe,Be;const _=d.posId,L=d.clmmPool,B=r[L],q=b[L],H=(Ae=q==null?void 0:q.ranges)==null?void 0:Ae.reduce((J,Q)=>(J[Q.dateType]=Q,J),{}),le=o(B,c[_],"day",H==null?void 0:H.day),V=t[_],be=a((Le=d.displayTokenA)==null?void 0:Le.coin_type,V==null?void 0:V.displayCoinAmountA),je=a((Re=d.displayTokenB)==null?void 0:Re.coin_type,V==null?void 0:V.displayCoinAmountB),re=m(be).plus(je),G=S[_],oe=a((Fe=d.displayTokenA)==null?void 0:Fe.coin_type,G==null?void 0:G.displayFeeOwedA),xe=a((Be=d.displayTokenB)==null?void 0:Be.coin_type,G==null?void 0:G.displayFeeOwedB),de=m(oe).plus(xe),ne=W(p[_]),K=W(y[d.id]),ye=[...ne,...K].reduce((J,Q)=>J.plus(Q.amountUSD),m(0)),Ve=ne.reduce((J,Q)=>J.plus(Q.display_amount_owed),m(0)),Je=K.reduce((J,Q)=>J.plus(Q.display_amount_owed),m(0));return{...d,apr:le,totalLiquidity:re.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:Ve.toString(),totalFarmingAmount:Je.toString()}}),U={apr:(d,_)=>{var q,H;const L=m(((q=d.apr)==null?void 0:q.aprPercentageTotal)??0),B=m(((H=_.apr)==null?void 0:H.aprPercentageTotal)??0);return R==="asc"?L.minus(B).toNumber():B.minus(L).toNumber()},liquidity:(d,_)=>{const L=m(d.totalLiquidity),B=m(_.totalLiquidity);return R==="asc"?L.minus(B).toNumber():B.minus(L).toNumber()},fees:(d,_)=>{const L=m(d.totalFee),B=m(_.totalFee);return R==="asc"?L.minus(B).toNumber():B.minus(L).toNumber()},rewards:(d,_)=>{const L=m(d.totalRewards),B=m(_.totalRewards);return R==="asc"?L.minus(B).toNumber():B.minus(L).toNumber()}};return U[O]&&E.sort(U[O]),E},toCloseAllAction:async O=>{n(!0);try{const R=O.map(d=>{var G,oe,xe,de,ne;const _=t[d==null?void 0:d.posId],L=p[d==null?void 0:d.posId],B=r[d.clmmPool],q=!L||(L==null?void 0:L.length)==0?(G=(B==null?void 0:B.miningRewardList)||[])==null?void 0:G.reduce((K,ye)=>(K.push(ye.coinType),K),[]):(L||[]).map(K=>K.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",d,r,B,L,q);const H=Y(_==null?void 0:_.displayCoinAmountA,void 0,!0),le=Y(_==null?void 0:_.displayCoinAmountB,void 0,!0),V=d.isReverse,[be,je]=V?[m(le).mul(pe.pow(10,(oe=d.displayTokenB)==null?void 0:oe.decimals)).toString(),m(H).mul(pe.pow(10,(xe=d.displayTokenA)==null?void 0:xe.decimals)).toString()]:[m(H).mul(pe.pow(10,(de=d.displayTokenA)==null?void 0:de.decimals)).toString(),m(le).mul(pe.pow(10,(ne=d.displayTokenB)==null?void 0:ne.decimals)).toString()],re={posId:d.posType==="farms"?d.id:d.posId,poolAddress:d.clmmPool,coinTypeA:d.coinTypeA,coinTypeB:d.coinTypeB,amountA:be,amountB:je,liquidity:d.liquidity,lowerTick:d.lowerTick,upperTick:d.upperTick,posType:d.posType,rewarderCoinTypes:q};return d.posType==="farms"&&(re.farmsPoolId=d.farmsPool,re.farmsPosId=d.id),re});console.log("ðŸš€ ~ toRemove ~ paramsList:",R);const P={getShowInfo:d=>{const _=d==="success";return{modalDescriptionText:_?"":"Close all positions",toastTitleText:_?"Close all positions successful":"Close all positions",toastDescriptionContent:_?"":void 0}}};i(P);const{tx:W,msafeParams:E}=await x(R),U=await C(W,P,{useMev:k,useFastMode:g==="Fast Mode",maxCapForGas:f,customGasPrice:v,msafeParams:E});console.log("ðŸš€ ~ toClaim ~ res:",U),U&&(l(),T([]),$())}catch(R){console.error("ðŸš€ ~ toClaim ~ error:",R)}finally{n(!1)}},isRemoveLoading:s}}const Ms=({positionInfo:s,onFeesChange:n})=>{var k,g;const[o,a]=h.useState(!1),{getTokenAmountValue:c}=ke(),{posFeeData:t,posFeeDataLoading:S}=ce(),y=t[s==null?void 0:s.posId],p=c((k=s==null?void 0:s.displayTokenA)==null?void 0:k.coin_type,y==null?void 0:y.displayFeeOwedA,"--"),r=c((g=s==null?void 0:s.displayTokenB)==null?void 0:g.coin_type,y==null?void 0:y.displayFeeOwedB,"--"),b=h.useMemo(()=>p!=="--"&&r!=="--"?ee(m(p).plus(r).toString(),2):"$--",[p,r]),{isApp:T}=Z();return h.useEffect(()=>{n==null||n(b)},[b]),e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(N,{p:"12px 0",onClick:f=>te(f),onMouseEnter:Number(p)==0&&Number(r)==0?()=>{}:()=>a(!0),onMouseLeave:()=>a(!1),children:e.jsxs(ve,{isLazy:!0,trigger:T?"click":"hover",placement:"top-start",children:[e.jsx(_e,{children:e.jsx(I,{as:"button",cursor:Number(p)==0&&Number(r)==0?"default":"help",children:e.jsx(z,{isLoaded:!!b,children:e.jsx(j,{color:"text_caption",borderColor:"text_caption",children:b})})})}),o&&b!=="--"&&e.jsx(Ee,{children:e.jsx(Te,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(Ce,{p:"8px",children:e.jsxs(M,{align:"flex-start",minW:"200px",children:[e.jsxs(w,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(y==null?void 0:y.displayFeeOwedA)}),e.jsx(j,{fontSize:"12px",children:ee(p,2)})]})]}),e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(ge,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(y==null?void 0:y.displayFeeOwedB)}),e.jsx(j,{fontSize:"12px",children:ee(r,2)})]})]})]})})})})]})})})},zs=({positionInfo:s,onRewardsChange:n})=>{var C,i;const{getTokenAmountValue:o}=ke(),{coinPriceObj:a}=Ne(),{posRewardsData:c,posRewardsDataLoading:t,posApiPoolData:S,farmsPosRewardsData:y,farmsPosRewardsDataLoading:p}=ce(),r=(C=S[s==null?void 0:s.clmmPool])==null?void 0:C.haveMining,b=(i=S[s==null?void 0:s.clmmPool])==null?void 0:i.haveFarming,T=c[s==null?void 0:s.posId],k=y[s==null?void 0:s.id],g=h.useMemo(()=>{const l=T==null?void 0:T.map(u=>{var F;console.log("ðŸš€ ~ list ~ reward:",u);const A=o((F=u==null?void 0:u.token)==null?void 0:F.coin_type,u==null?void 0:u.display_amount_owed,"--");return{...u,amountUSD:A}});return l&&l.length>0?l.filter(u=>m(u.display_amount_owed).gt(0)):[]},[s,T,a]),f=h.useMemo(()=>{const l=k==null?void 0:k.map(u=>{var F;console.log("ðŸš€ ~ list ~ reward:",u);const A=o((F=u==null?void 0:u.token)==null?void 0:F.coin_type,u==null?void 0:u.display_amount_owed,"--");return{...u,amountUSD:A}});return l&&l.length>0?l.filter(u=>m(u.display_amount_owed).gt(0)):[]},[s,k,a]),v=h.useMemo(()=>{let l;const u=g.concat(f);return console.log("ðŸš€ ~ totalUSD ~ arr:",u,g,f),(u==null?void 0:u.length)>0?(u.forEach(A=>{const F=A==null?void 0:A.amountUSD;l=F=="--"||l=="--"?"--":m(l).plus(F).toString()}),l=="--"?"$--":ee(l,2)):"$0"},[g,f]),{isApp:x}=Z();return h.useEffect(()=>{n==null||n(v)},[v]),e.jsx(e.Fragment,{children:e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(N,{p:"12px 0",onClick:l=>te(l),children:e.jsxs(ve,{isLazy:!0,trigger:x?"click":"hover",placement:"top-start",children:[e.jsx(_e,{children:e.jsx(I,{as:"button",cursor:v=="$0"?"text":"help",children:e.jsx(z,{h:"14px",isLoaded:!!v&&!t&&!p,children:e.jsx(j,{color:"text_caption",children:v})})})}),v!=="$0"&&e.jsx(Ee,{children:e.jsx(Te,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(Ce,{borderRadius:"12px",p:"8px",children:e.jsxs(M,{align:"flex-start",children:[r&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),g==null?void 0:g.map(l=>{var u;return e.jsxs(w,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:l==null?void 0:l.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(l==null?void 0:l.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",ee(l==null?void 0:l.amountUSD,2)]})]})]},(u=l==null?void 0:l.token)==null?void 0:u.coin_type)}),b&&e.jsx(j,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),f==null?void 0:f.map(l=>{var u;return e.jsxs(w,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(ge,{token:l==null?void 0:l.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{fontSize:"12px",color:"text_caption",children:ue(l==null?void 0:l.display_amount_owed)}),e.jsxs(j,{fontSize:"12px",children:[" ",ee(l==null?void 0:l.amountUSD,2)]})]})]},(u=l==null?void 0:l.token)==null?void 0:u.coin_type)})]})})})})]})})})})},Ps=({totalAprDisplay:s,farmingAprDisplay:n,placement:o="top",poolInfo:a,positionApr:c})=>{var f;const{getTokenListInfo:t}=Ls(),[S,y]=h.useState(new Map);as(()=>{var x,C;if(((x=c==null?void 0:c.posMiningReward)==null?void 0:x.length)==0)return;const v=(C=c==null?void 0:c.posMiningReward)==null?void 0:C.map(i=>i==null?void 0:i.coinType);t(v).then(i=>{i&&(i==null?void 0:i.size)>0&&y(i)})},[c==null?void 0:c.posMiningReward]);const{isApp:p}=Z(),r=D(a==null?void 0:a.feeApr).gt(0)?[{name:"Fees",value:Number(c==null?void 0:c.aprByFee),displayValue:c==null?void 0:c.aprByFeeDisplay,color:"#68FFD8"}]:[],b=["#6868FF","#FFCA68","#C8FF00","#FF562B","#0A05FF","#FF65F8","#FF3232","#842CFF","#31D829"];let T=-1;const k=(f=c==null?void 0:c.posMiningReward)==null?void 0:f.map(v=>{var A,F,$;const{symbol:x,coinType:C,posMiningRewardApr:i,posMiningRewardAprDisplay:l}=v||{},u=ze(C||"")==ze(((F=(A=cs)==null?void 0:A.sui_coin)==null?void 0:F.coin_type)||"");return T=u?T:T+1,{name:`${is(`${x||(($=S==null?void 0:S.get(C))==null?void 0:$.symbol)||""}`,8)} Rewards`,value:Number(i),displayValue:l,color:u?"#65C8FF":b[T]}}).sort((v,x)=>x.value-v.value),g=r.concat(k);return e.jsx(w,{justify:"flex-end",w:"100%",onClick:v=>{p&&te(v)},children:a!=null&&a.haveMining&&s!=="--"?e.jsx(me,{placement:o,tooltip:e.jsxs(M,{w:"100%",p:"4px",children:[e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(j,{color:"text_caption",children:"Total APR"}),e.jsx(j,{color:"text_caption",fontSize:"16px",children:s})]}),e.jsx(Os,{originData:g})]}),children:e.jsx(I,{children:e.jsx(Oe,{poolInfo:a,totalAprDisplay:s,farmingAprDisplay:n})})}):e.jsx(I,{children:e.jsx(Oe,{poolInfo:a,totalAprDisplay:s,farmingAprDisplay:n})})})},Oe=({poolInfo:s,totalAprDisplay:n,farmingAprDisplay:o})=>e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(j,{as:"span",color:"primary",cursor:s!=null&&s.haveMining?"help":"text",children:n}),(s==null?void 0:s.haveFarming)&&e.jsx(j,{fontWeight:"500",p:"2px 4px",fontSize:"12px",color:"primary_yellow",bg:"primary_yellow_opacity.10",borderRadius:"4px",children:o=="--"?"--":"+"+o})]}),Os=({originData:s})=>e.jsx(h.Suspense,{fallback:e.jsxs(w,{justify:"space-between",gap:"20px",w:"100%",children:[e.jsx(ss,{w:"64px",h:"64px"}),e.jsxs(M,{w:"calc(100% - 84px)",children:[e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(z,{w:"40%",h:"16px"}),e.jsx(z,{w:"30%",h:"16px"})]}),e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(z,{w:"40%",h:"16px"}),e.jsx(z,{w:"30%",h:"16px"})]}),e.jsxs(w,{justify:"space-between",w:"100%",children:[e.jsx(z,{w:"40%",h:"16px"}),e.jsx(z,{w:"30%",h:"16px"})]})]})]}),children:e.jsx(As,{originData:s})}),Ws="/images/icon_active_new@2x.png";function We({isActive:s,isLoading:n,imgStyle:o={},...a}){const{imgW:c="16px",imgH:t="12px"}=o;return e.jsx(ae,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...a,children:e.jsx(me,{placement:"top",tooltip:e.jsx(j,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(I,{onClick:S=>te(S),children:e.jsxs(w,{align:"center",children:[s&&e.jsx(se,{w:c,h:t,src:Ws}),e.jsx(z,{w:"100%",isLoaded:!n,children:e.jsx(j,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Es({positionInfo:s,tokenName:n,priceDirect:o,isShowIcon:a}){const{posPoolsRelatedData:c}=ce(),t=c[s==null?void 0:s.posId],S=(t==null?void 0:t.currentStatus)=="Active",{isApp:y}=Z(),p=h.useMemo(()=>t==null?void 0:t.minPriceOrigin,[t]),r=h.useMemo(()=>t==null?void 0:t.maxPriceOrigin,[t]),b=h.useMemo(()=>t==null?void 0:t.currentPriceOrigin,[t]),[T,k]=h.useState(0),g=h.useRef(null);h.useEffect(()=>{const x=()=>{g.current&&k(g.current.offsetWidth)},C=new ResizeObserver(x);return g.current&&C.observe(g.current),()=>{g.current&&C.unobserve(g.current)}},[p,r,b]);const f=h.useMemo(()=>{if(r==="âˆž")return"0px";if(b&&p&&r&&T){if(m(b).lessThanOrEqualTo(r)&&m(b).greaterThanOrEqualTo(p)){const x=m(b).sub(p).div(m(r).sub(m(p))).toString();return`${m(T).mul(x).toFixed(0)}px`}if(m(b).lt(p))return"6px";if(m(b).gt(r))return"calc(100% + 6px)"}return"0px"},[b,p,r,T]),{getExplorerUrl:v}=$e();return e.jsxs(M,{align:{base:"flex-end",lg:"flex-start"},gap:{base:"4px",lg:"8px"},w:"100%",maxW:"100%",children:[e.jsxs(w,{justify:{base:"flex-end",lg:"flex-start"},maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:{base:"0",lg:"16px"},children:[e.jsx(z,{isLoaded:!!(t!=null&&t.minPrice)&&!!(t!=null&&t.maxPrice),borderRadius:"4px",children:o?e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPrice} - ${t==null?void 0:t.maxPrice}`}):e.jsx(j,{lineHeight:"1",fontSize:"14px",color:"text_caption",textAlign:"right",children:`${t==null?void 0:t.minPriceResever} - ${t==null?void 0:t.maxPriceResever}`})}),!y&&e.jsx(We,{isActive:S,isLoading:(t==null?void 0:t.currentStatus)==""}),a&&!y&&e.jsx(w,{onClick:x=>te(x),children:e.jsx(me,{placement:"top",tooltip:e.jsxs(w,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx(z,{isLoaded:!!n,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:n==null?void 0:n.split("|")[1]})})]}),e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(He,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(v(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(I,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ue,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsxs(w,{children:[y&&e.jsx(We,{isActive:S,isLoading:(t==null?void 0:t.currentStatus)==""}),e.jsx(z,{h:"6px",isLoaded:!!(t!=null&&t.currentPriceOrigin),borderRadius:"4px",children:e.jsx(N,{w:"88px",h:"6px",bgImage:r==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(N,{w:r==="âˆž"?"88px":"56px",h:r==="âˆž"?"2px":"6px",position:"relative",ref:g,background:r==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":S?"url('/images/img_range@2x.png')":"none",ml:r==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:r!=="âˆž"&&e.jsx(N,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:f,transform:"translateY(-50%)",zIndex:"5"})})})})]})]})}function Ds({positionInfo:s,positionItemWidth:n=[],priceDirect:o,showMiningIcon:a,showFarmingIcon:c}){const{isApp:t}=Z(),{getExplorerUrl:S}=$e(),{getClmmPosName:y}=ws(),p=fe(),{setCurrentPosDetailTab:r}=Ts(),{posPoolsOriginalData:b,posPoolsRelatedData:T,posApiPoolData:k,poolRangeObj:g}=ce(),f=T[s==null?void 0:s.posId],v=k[s==null?void 0:s.clmmPool],x=h.useMemo(()=>{var R;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const P=(R=b==null?void 0:b[s==null?void 0:s.clmmPool])==null?void 0:R.index;return y(Number(s==null?void 0:s.index),P)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,b]),C=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),p(`/position-detail/${s==null?void 0:s.id}`)},[i,l]=h.useState(!1),{getPositionApr:u}=Ge(),A=h.useMemo(()=>{if(X(f)&&X(v)&&X(g)){const R=g[s==null?void 0:s.clmmPool];if(R){const P=R==null?void 0:R.ranges.reduce((W,E)=>(W[E.dateType]=E,W),{});return u(v,f,"day",P.day)}}},[f,v,s,g]);_s();const[F,$]=h.useState(null),[he,ie]=h.useState(null),O=(f==null?void 0:f.currentStatus)=="Active";return e.jsx(De,{onMouseEnter:()=>{setTimeout(()=>{l(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{l(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:C,children:e.jsx(w,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(M,{w:"100%",align:"flex-start",gap:"12px",children:[t&&e.jsxs(w,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx(z,{isLoaded:!!x,children:e.jsx(j,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:x==null?void 0:x.split("|")[1]})})]}),e.jsxs(w,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(j,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(He,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(S(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(w,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[e.jsxs(w,{w:{base:"100%",lg:n[0]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",whiteSpace:"nowrap",children:"Price Range"}),e.jsx(Es,{positionInfo:s,tokenName:x,priceDirect:o,isShowIcon:i})]}),e.jsxs(w,{w:{base:"100%",lg:n[1]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsxs(w,{gap:"2px",children:[e.jsx(j,{color:"primary_gray",children:"APR"}),e.jsx(Cs,{tooltipCon:e.jsxs("span",{children:["APR based on the past 24h historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. ",e.jsx("br",{}),"Calculations are an estimate and only for reference."]})})]}),e.jsx(z,{isLoaded:!!A,children:e.jsx(Ps,{poolInfo:v,positionApr:A,farmingAprDisplay:O?A==null?void 0:A.displayAprPercentageTotal:"0%",totalAprDisplay:O?A==null?void 0:A.displayAprPercentageTotal:"0%"})})]}),e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:n[2]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Liquidity"}),e.jsx(ks,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:n[3]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Pending Fees"}),e.jsx(Ms,{positionInfo:s,onFeesChange:$})]}),(a||c)&&e.jsxs(w,{m:"-12px 0",w:{base:"100%",lg:n[4]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(j,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(w,{gap:"4px",children:[t&&a&&e.jsx(se,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),t&&c&&e.jsx(se,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(zs,{positionInfo:s,onRewardsChange:ie})]})]})]}),t&&e.jsxs(ts,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(j,{color:"primary_gray",children:"Manage"}),e.jsx(Ue,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const we=["480px","20%","20%","20%","20%"],Ye=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Ns=Ye.reduce((s,n)=>(s[n.value]=n,s),{});function dt({poolInfo:s,priceDirect:n}){const{coinPriceObj:o}=Ne(),{getPositionSortList:a}=Bs(),[c,t]=h.useState("desc"),[S,y]=h.useState({label:"",value:""}),p=x=>{(x==null?void 0:x.value)===S.value?t(C=>C==="desc"?"asc":"desc"):(t("desc"),y(x))},[r,b]=h.useState([]),T=h.useMemo(()=>{if(!X(s))return[];const x=a(S.value,c,s.list),C=S.value?x:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",C,x),b(x),C},[S.value,c,s==null?void 0:s.list,o]),k=x=>r.some(C=>m(C[x]).gt(0)),g=h.useMemo(()=>k("totalMiningAmount"),[r]),f=h.useMemo(()=>k("totalFarmingAmount"),[r]),{isApp:v}=Z();return e.jsxs(M,{gap:"12px",w:"100%",children:[!v&&e.jsxs(w,{w:"100%",p:"0 16px",children:[e.jsx(j,{w:we[0],children:"Price Range"}),Ye.map((x,C)=>x.value!=="rewards"||g||f?e.jsxs(w,{gap:"4px",w:we[C+1],justify:"flex-end",children:[g&&x.value==="rewards"&&e.jsx(se,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),f&&x.value==="rewards"&&e.jsx(se,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(vs,{labelInfo:Ns[x.value],sortRule:c,sortBy:S,clickSort:p,tooltip:{content:x.value==="apr"?e.jsxs("span",{children:["APR based on the past 24h historical trade fees and emissions. Only positions in range earn yield. Past performance is not indicative of future results. ",e.jsx("br",{}),"Calculations are an estimate and only for reference."]}):""}})]},x.value):null)]}),e.jsx(M,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:T.map(x=>e.jsx(Ds,{positionInfo:x,positionItemWidth:we,priceDirect:n,showMiningIcon:g,showFarmingIcon:f},x==null?void 0:x.id))})]})}export{ot as F,dt as P,xt as V,Bs as a,lt as u};
//# sourceMappingURL=PositionItem-DFnnkbRi.js.map
