import{y as Ge,a as g,ak as Se,j as e,H as T,C as ae,I,T as b,f as E,P as Ae,h as ve,m as fe,n as _e,p as $,V as M,F as ne,W as Ye,X as Ve,Y as Je,a0 as Qe,$ as Ke,k as Me,q as Xe}from"./vendor-BowHGuwE.js";import{a as K,J as Te,K as ce,d,z as ie,a2 as V,C as Ze,B as Fe,n as we,a9 as ze,$ as Q,aa as Ie,r as Pe,w as ue,R as Z,f as ge,q as Oe,h as We,I as Ee}from"./index-CHh_ib_A.js";import{u as es,V as ss,a as ts,b as rs}from"./VaultsAprBlock-CvyN05r0.js";import{a as ns,u as is,V as as}from"./VaultsAction-BvkamZFO.js";import{u as Ne}from"./useAccountBalance-kA9PTpYg.js";import{u as cs}from"./useInterval-BcJtT0it.js";import{P as ls}from"./PoweredByHaedal-uLEk4Xbu.js";import{V as os}from"./VTextLabelBox-CL5tbKRG.js";import{u as xs}from"./global-jBtCojdm.js";import{u as le,b as ps,a as ds}from"./usePositionList-CyZ1ld3N.js";import{u as us}from"./useTransaction-CWfVBXqS.js";import{h as gs}from"./RemoveBlock-BOkeSWoc.js";import{T as ms}from"./TableSortTh-Be1qy-KF.js";import{b as hs}from"./useClaimPosition-CbQ6xvrE.js";import{a as bs}from"./useNotifiSubscription-DCb8u4WK.js";import{S as me,A as De}from"./SingleTokenInfo-D14D2WBC.js";import{P as ys,L as js}from"./ExpendItem-CSybeYWJ.js";function Vs(){const{search:s}=Ge(),[n,l]=g.useState({});return g.useLayoutEffect(()=>{const i=new URLSearchParams(s);l(Object.fromEntries(i.entries()))},[s]),n}const Js=({tooltip:s,...n})=>{const l=Se(),{isApp:i}=K();return e.jsx(T,{w:"20px",h:"20px",onClick:p=>{ce(p),i||l("/farms")},...n,children:e.jsx(Te,{placement:"top",tooltip:s||e.jsx(b,{fontSize:"12px",children:"Farm rewards available"}),children:e.jsx(ae,{children:e.jsx(I,{w:"100%",h:"100%",minW:"100%",src:"/images/icon_farms.png"})})})})};function ws(s){const{minPrice:n,maxPrice:l,currPrice:i}=s,[p,t]=g.useState(0),[v,h]=g.useState(0),a=g.useRef(null),r=g.useRef(null);g.useEffect(()=>{const y=()=>{a.current&&t(a.current.offsetWidth),r.current&&h(r.current.offsetWidth)},A=new ResizeObserver(y),f=new ResizeObserver(y);return a.current&&A.observe(a.current),r.current&&f.observe(r.current),()=>{a.current&&A.unobserve(a.current),r.current&&f.unobserve(r.current)}},[n,l,i]);const j=g.useMemo(()=>{if(l==="âˆž")return"0px";if(i&&n&&l&&p){if(d(i).lessThanOrEqualTo(l)&&d(i).greaterThanOrEqualTo(n)){const y=d(i).sub(n).div(d(l).sub(d(n))).toString();return`${d(p).mul(y).toFixed(0)}px`}if(d(i).lt(n))return"-36px";if(d(i).gt(l))return"calc(100% + 36px)"}return"0px"},[i,n,l,p]),_=g.useMemo(()=>{const y=j.replace("px","");return Number(y)-v/2+"px"},[j,v]),{isApp:w}=K();return e.jsx(e.Fragment,{children:n!==void 0&&l!==void 0&&i!==void 0?e.jsx(T,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0px 0px 8px",children:e.jsxs(E,{w:"100%",padding:n&&d(i).lt(n)?"0 40px 0 60px":l&&d(i).gt(l)?"0 60px 0 40px":"0 40px",position:"relative",children:[e.jsx(b,{whiteSpace:"nowrap",position:"absolute",top:"20px",left:n&&d(i).lt(n)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(n)}),e.jsx(E,{w:"100%",position:"relative",height:"14px",ref:a,bgImage:"url('/images/img_range@2x.png')",bgSize:"100% 14px",bgPosition:"center",children:e.jsxs(Ae,{isLazy:!0,placement:"top",trigger:w?"click":"hover",autoFocus:!1,returnFocusOnClose:!1,gutter:4,children:[e.jsx(ve,{children:e.jsx(E,{as:"button",children:e.jsx(E,{bg:"#fff",borderRadius:"8px",w:"4px",height:"15px",position:"absolute",top:"50%",transform:"translateY(-50%)",left:j,ml:"-2px",zIndex:"5"})})}),e.jsx(fe,{w:"fit-content",bg:"none",border:"none",ref:r,position:"absolute",top:"-32px !important",left:_,zIndex:"5",children:e.jsx(_e,{fontSize:"12px",w:"fit-content",bg:"none",border:"none",children:e.jsx(b,{whiteSpace:"nowrap",fontSize:"12px",color:"primary",children:ie(i)})})})]})}),e.jsx(b,{whiteSpace:"nowrap",position:"absolute",top:"20px",right:l&&d(i).gt(l)?"60px":"40px",fontSize:"12px",color:"text_caption",children:ie(l)})]})},j):e.jsx(T,{w:"100%",height:"60px",background:"primary_opacity.10",borderRadius:"16px",p:"0 40px",children:e.jsx($,{w:"100%",h:"20px"})})})}function Ss(s){const{vaultId:n,displayTokenA:l,displayTokenB:i,feeDisplay:p,minPrice:t,maxPrice:v,currPrice:h}=s;console.log("ðŸš€ðŸš€ðŸš€ ~ VaultInfo.tsx:25 ~ VaultInfo ~ props:",s);const{vaultListObj:a}=es(),r=g.useMemo(()=>{if(V(a)&&n)return a[n]},[a,n]);return e.jsxs(M,{width:"calc(100% + 32px)",padding:"0 16px",alignItems:"left",paddingBottom:"16px",borderBottom:"1px solid",borderColor:"border",children:[e.jsxs(ne,{children:[e.jsx(Ze,{coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"32px",h:"32px"},imgBoxStyle:{w:"32px",h:"32px"}}),e.jsxs(ne,{marginLeft:"8px",justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(E,{children:e.jsxs(ne,{alignItems:"center",children:[e.jsx(b,{fontSize:"16px",color:"text_caption",children:`${l==null?void 0:l.symbol} - ${i==null?void 0:i.symbol}`}),e.jsx(Fe,{w:"unset",p:"3px 12px 2px",borderRadius:"12px",bg:"none",borderColor:"primary",marginLeft:"8px",children:e.jsx(b,{fontSize:"12px",color:"primary",children:p})})]})}),e.jsx(ne,{flexDirection:"column",children:e.jsx(os,{wrapStyle:{gap:"2px",alignItems:"flex-end !important"},title:"APY",titleStyle:{color:"primary",fontSize:"12px"},valueTooltip:e.jsx(ss,{vaultsLstApyDisplay:r==null?void 0:r.vaultsLstApyDisplay,vaultsApyDisplay:r==null?void 0:r.vaultsApyDisplay,vaultsTotalApyDisplay:r==null?void 0:r.vaultsTotalApyDisplay,vaultsAprDisplay:r==null?void 0:r.vaultsAprDisplay,category:r==null?void 0:r.category}),value:(r==null?void 0:r.category)=="cetus"?r==null?void 0:r.vaultsTotalApyDisplay:(r==null?void 0:r.vaultsApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})})]})]}),e.jsx(ws,{minPrice:t,maxPrice:v,currPrice:h})]})}function Qs(s){const{currentAccount:n}=we(),{isOpen:l,setIsOpen:i,vaultId:p,category:t,displayTokenA:v,displayTokenB:h,feeDisplay:a,clmmPool:r,isReverse:j}=s,{isOpenWalletModal:_}=we(),{getCurrentVaultDetail:w,getCurrentVaultContractInfo:y}=ns(),{clearVaultsActionData:A}=is(),{fetchAccountBalance:f}=Ne(),m=Se(),{vaultsPoolObj:k}=ts(),u=g.useMemo(()=>k[p],[k,p]);g.useEffect(()=>{p&&w(p)},[n==null?void 0:n.address,p]);const{getPythLastPrice:c}=rs(),x=g.useRef(!1);g.useEffect(()=>(x.current=!0,()=>{x.current=!1,A()}),[]),g.useEffect(()=>{u!=null&&u.displayCoinTypeA&&(u!=null&&u.displayCoinTypeB)&&c([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])},[u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB]),cs({interval:20*1e3,callback:()=>{x.current&&t=="haedal"&&c([u==null?void 0:u.displayCoinTypeA,u==null?void 0:u.displayCoinTypeB])}});const L=()=>{console.log("ðŸš€ðŸš€ðŸš€ ~ VaultsDetailPage.tsx:142 ~ autoRefresh ~ autoRefresh:"),n!=null&&n.address?(f(),w(p,!0)):y(p)};return e.jsxs(Ye,{isCentered:!0,isOpen:l&&!_,onClose:()=>{i(!1)},children:[e.jsx(Ve,{}),e.jsx(Je,{width:{base:"100%",lg:"420px"},children:e.jsx(Qe,{p:"0 0 8px",children:e.jsxs(M,{width:"100%",children:[e.jsxs(M,{width:"100%",p:"6px 16px 16px",mb:"-16px",gap:"0",borderRadius:"16px",sx:{backgroundImage:"url('/images/vault_modal_bg@2x.png')",backgroundPosition:"top center",backgroundRepeat:"no-repeat",backgroundSize:"100% 320px"},children:[e.jsxs(T,{h:"36px",w:"100%",mb:"12px",children:[e.jsx(b,{color:"text_caption",fontWeight:"500",fontSize:"16px",children:"Auto Vault"}),e.jsx(Ke,{})]}),e.jsx(Ss,{displayTokenA:v,displayTokenB:h,feeDisplay:a,clmmPool:r,isReverse:j,minPrice:u==null?void 0:u.minPrice,maxPrice:u==null?void 0:u.maxPrice,currPrice:u==null?void 0:u.currentPrice,category:t,vaultId:p}),e.jsx(as,{vaultId:p,isModal:!0,autoRefresh:L})]}),e.jsxs(T,{borderTop:"1px solid",borderColor:"border",width:"100%",padding:"12px 16px 4px",justifyContent:t=="haedal"?"space-between":"center",children:[e.jsx(ls,{mt:"0",category:t}),e.jsx(b,{fontSize:"12px",_hover:{color:"primary"},whiteSpace:"nowrap",cursor:"pointer",onClick:()=>{t&&p&&(A(),m(`/vaults-detail/${p}/${t}`))},children:"Vault Details >"})]})]})})})]})}function Ue(){const s=(l,i,p,t)=>{const v=Math.max(l,p),a=Math.min(i,t)-v,r=i-l,j=t-p,_=Q(a.toString()),w=Q(r.toString()),y=Q(j.toString());return a<=0?Q(0):a===r?y.div(_):a===j?_.div(w):_.mul(_).div(y).div(w)};return{getPositionApr:(l,i,p,t)=>{if(!V(l)||!V(i)||!V(t))return;const{minPrice:v,minPriceResever:h,maxPrice:a,maxPriceResever:r}=i,{tokenA:j,tokenB:_,miningAprList:w,feeApr:y,feeApr7d:A,feeApr30d:f,isReverse:m}=l;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:27 ~ getPositionApr ~ isReverse:",m),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:28 ~ getPositionApr ~ feeApr30d:",A,f);const k=j==null?void 0:j.decimals,u=_==null?void 0:_.decimals,c=v=="0"&&a=="âˆž",x=m?h:v,L=c?2**50:m?r:a;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:31 ~ getPositionApr ~ lowerUserPrice:",x),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:33 ~ getPositionApr ~ upperUserPrice:",L);const{lower:R,upper:ee}=t;console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ range:",t);const se=ze.tickIndexToPrice(R,k,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:38 ~ getPositionApr ~ beforeContractPriceLowest:",se);const X=ze.tickIndexToPrice(ee,k,u).toNumber();console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:40 ~ getPositionApr ~ beforeContractPriceHighest:",X),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:42 ~ getPositionApr ~ lowerUserPrice, upperUserPrice, beforeContractPriceLowest, beforeContractPriceHighest:",x,L,se,X);const O=s(x,L,se,X);console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:41 ~ getPositionApr ~ positionMulti:",O.toString());const C=Q(p=="day"?y:p=="month"?f:A).mul(O).toString(),z=[];let F=Q(C);return w==null||w.forEach(W=>{const H=Q(O).mul(W.apr).toString();z.push({...W,posMiningRewardApr:H}),F=F.add(H)}),console.log("ðŸš€ðŸš€ðŸš€ ~ usePositionApr.ts:45 ~ getPositionApr ~",{aprPercentageTotal:F.toString(),aprByFee:C,posMiningReward:z}),{aprPercentageTotal:F.toString(),displayAprPercentageTotal:Ie(F.toNumber()*100),aprByFee:C,posMiningReward:z}}}}function As(){const[s,n]=g.useState(!1),{getPositionApr:l}=Ue(),{getTokenAmountValue:i}=Pe(),{posPoolsRelatedData:p,posLiquidityData:t,posFeeData:v,farmsPosRewardsData:h,posRewardsData:a,posApiPoolData:r,poolRangeObj:j,setPosBaseList:_}=le(),{mevProtect:w,transactionMode:y,maxCapForGas:A,customGasPrice:f}=xs(),{getCloseTsPayloadAll:m}=gs(),{signAndExecuteTransaction:k,transactionConfirmation:u}=us(),{fetchAccountBalance:c}=Ne(),{getPositionBaseList:x,getPosRelatedData:L}=ps(),{currentAccount:R}=we(),ee=async()=>{const O=await x(R==null?void 0:R.address);L(O)};return{getPositionSortList:(O,C,z)=>{if(!(z!=null&&z.length))return;const F=(o=[])=>o.map(S=>{var P;return{...S,amountUSD:i((P=S==null?void 0:S.token)==null?void 0:P.coin_type,S==null?void 0:S.display_amount_owed)}}).filter(S=>d(S.display_amount_owed).gt(0)),W=z.map(o=>{var ke,Ce,Le,Be,Re;const S=o.posId,P=o.clmmPool,B=r[P],N=j[P],D=(ke=N==null?void 0:N.ranges)==null?void 0:ke.reduce((G,Y)=>(G[Y.dateType]=Y,G),{}),oe=l(B,p[S],"week",D==null?void 0:D.week),q=t[S],he=i((Ce=o.displayTokenA)==null?void 0:Ce.coin_type,q==null?void 0:q.displayCoinAmountA),be=i((Le=o.displayTokenB)==null?void 0:Le.coin_type,q==null?void 0:q.displayCoinAmountB),te=d(he).plus(be),U=v[S],xe=i((Be=o.displayTokenA)==null?void 0:Be.coin_type,U==null?void 0:U.displayFeeOwedA),pe=i((Re=o.displayTokenB)==null?void 0:Re.coin_type,U==null?void 0:U.displayFeeOwedB),de=d(xe).plus(pe),re=F(a[S]),J=F(h[o.id]),ye=[...re,...J].reduce((G,Y)=>G.plus(Y.amountUSD),d(0)),He=re.reduce((G,Y)=>G.plus(Y.display_amount_owed),d(0)),qe=J.reduce((G,Y)=>G.plus(Y.display_amount_owed),d(0));return{...o,apr:oe,totalLiquidity:te.toString(),totalFee:de.toString(),totalRewards:ye.toString(),totalMiningAmount:He.toString(),totalFarmingAmount:qe.toString()}}),H={apr:(o,S)=>{var N,D;const P=d(((N=o.apr)==null?void 0:N.aprPercentageTotal)??0),B=d(((D=S.apr)==null?void 0:D.aprPercentageTotal)??0);return C==="asc"?P.minus(B).toNumber():B.minus(P).toNumber()},liquidity:(o,S)=>{const P=d(o.totalLiquidity),B=d(S.totalLiquidity);return C==="asc"?P.minus(B).toNumber():B.minus(P).toNumber()},fees:(o,S)=>{const P=d(o.totalFee),B=d(S.totalFee);return C==="asc"?P.minus(B).toNumber():B.minus(P).toNumber()},rewards:(o,S)=>{const P=d(o.totalRewards),B=d(S.totalRewards);return C==="asc"?P.minus(B).toNumber():B.minus(P).toNumber()}};return H[O]&&W.sort(H[O]),W},toCloseAllAction:async O=>{n(!0);try{const C=O.map(o=>{var U,xe,pe,de,re;const S=t[o==null?void 0:o.posId],P=a[o==null?void 0:o.posId],B=r[o.clmmPool],N=!P||(P==null?void 0:P.length)==0?(U=(B==null?void 0:B.miningRewardList)||[])==null?void 0:U.reduce((J,ye)=>(J.push(ye.coinType),J),[]):(P||[]).map(J=>J.coin_address);console.log("ðŸš€ ~ paramsList ~ rewarderCoinTypes:",o,r,B,P,N);const D=ie(S==null?void 0:S.displayCoinAmountA,void 0,!0),oe=ie(S==null?void 0:S.displayCoinAmountB,void 0,!0),q=o.isReverse,[he,be]=q?[d(oe).mul(ue.pow(10,(xe=o.displayTokenB)==null?void 0:xe.decimals)).toString(),d(D).mul(ue.pow(10,(pe=o.displayTokenA)==null?void 0:pe.decimals)).toString()]:[d(D).mul(ue.pow(10,(de=o.displayTokenA)==null?void 0:de.decimals)).toString(),d(oe).mul(ue.pow(10,(re=o.displayTokenB)==null?void 0:re.decimals)).toString()],te={posId:o.posType==="farms"?o.id:o.posId,poolAddress:o.clmmPool,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,amountA:he,amountB:be,liquidity:o.liquidity,lowerTick:o.lowerTick,upperTick:o.upperTick,posType:o.posType,rewarderCoinTypes:N};return o.posType==="farms"&&(te.farmsPoolId=o.farmsPool,te.farmsPosId=o.id),te});console.log("ðŸš€ ~ toRemove ~ paramsList:",C);const z={getShowInfo:o=>{const S=o==="success";return{modalDescriptionText:S?"":"Close All",toastTitleText:S?"Close All Successful":"Close All",toastDescriptionContent:S?"":void 0}}};u(z);const{tx:F,msafeParams:W}=await m(C),H=await k(F,z,{useMev:w,useFastMode:y==="Fast Mode",maxCapForGas:A,customGasPrice:f,msafeParams:W});console.log("ðŸš€ ~ toClaim ~ res:",H),H&&(c(),_([]),ee())}catch(C){console.error("ðŸš€ ~ toClaim ~ error:",C)}finally{n(!1)}},isRemoveLoading:s}}const vs=({positionInfo:s,onFeesChange:n})=>{var w,y;const[l,i]=g.useState(!1),{getTokenAmountValue:p}=Pe(),{posFeeData:t,posFeeDataLoading:v}=le(),h=t[s==null?void 0:s.posId],a=p((w=s==null?void 0:s.displayTokenA)==null?void 0:w.coin_type,h==null?void 0:h.displayFeeOwedA,"--"),r=p((y=s==null?void 0:s.displayTokenB)==null?void 0:y.coin_type,h==null?void 0:h.displayFeeOwedB,"--"),j=g.useMemo(()=>a!=="--"&&r!=="--"?Z(d(a).plus(r).toString(),2):"$--",[a,r]),{isApp:_}=K();return g.useEffect(()=>{n==null||n(j)},[j]),e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:"flex-end",flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:A=>ce(A),onMouseEnter:Number(a)==0&&Number(r)==0?()=>{}:()=>i(!0),onMouseLeave:()=>i(!1),children:e.jsxs(Ae,{isLazy:!0,trigger:_?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:Number(a)==0&&Number(r)==0?"default":"help",children:e.jsx($,{isLoaded:!!j,children:e.jsx(b,{color:"text_caption",borderColor:"text_caption",children:j})})})}),l&&j!=="--"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px ",children:e.jsx(_e,{p:"8px",children:e.jsxs(M,{align:"flex-start",minW:"200px",children:[e.jsxs(T,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:s==null?void 0:s.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(b,{fontSize:"12px",color:"text_caption",children:ge(h==null?void 0:h.displayFeeOwedA)}),e.jsx(b,{fontSize:"12px",children:Z(a,2)})]})]}),e.jsxs(T,{w:"100%",justify:"space-between",children:[e.jsx(me,{token:s==null?void 0:s.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(b,{fontSize:"12px",color:"text_caption",children:ge(h==null?void 0:h.displayFeeOwedB)}),e.jsx(b,{fontSize:"12px",children:Z(r,2)})]})]})]})})})})]})})})},fs=({positionInfo:s,onRewardsChange:n})=>{var k,u;const{getTokenAmountValue:l}=Pe(),{coinPriceObj:i}=Oe(),{posRewardsData:p,posRewardsDataLoading:t,posApiPoolData:v,farmsPosRewardsData:h,farmsPosRewardsDataLoading:a}=le(),r=(k=v[s==null?void 0:s.clmmPool])==null?void 0:k.haveMining,j=(u=v[s==null?void 0:s.clmmPool])==null?void 0:u.haveFarming,_=p[s==null?void 0:s.posId],w=h[s==null?void 0:s.id],y=g.useMemo(()=>{const c=_==null?void 0:_.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=l((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return c&&c.length>0?c.filter(x=>d(x.display_amount_owed).gt(0)):[]},[s,_,i]),A=g.useMemo(()=>{const c=w==null?void 0:w.map(x=>{var R;console.log("ðŸš€ ~ list ~ reward:",x);const L=l((R=x==null?void 0:x.token)==null?void 0:R.coin_type,x==null?void 0:x.display_amount_owed,"--");return{...x,amountUSD:L}});return c&&c.length>0?c.filter(x=>d(x.display_amount_owed).gt(0)):[]},[s,w,i]),f=g.useMemo(()=>{let c;const x=y.concat(A);return console.log("ðŸš€ ~ totalUSD ~ arr:",x,y,A),(x==null?void 0:x.length)>0?(x.forEach(L=>{const R=L==null?void 0:L.amountUSD;c=R=="--"||c=="--"?"--":d(c).plus(R).toString()}),c=="--"?"$--":Z(c,2)):"$0"},[y,A]),{isApp:m}=K();return g.useEffect(()=>{n==null||n(f)},[f]),e.jsx(e.Fragment,{children:e.jsx(M,{w:{base:"unset",lg:"unset"},justify:{base:"space-between",lg:"unset"},align:{base:"flex-end",lg:"flex-end"},flexDirection:{base:"row",lg:"column"},children:e.jsx(E,{p:"12px 0",onClick:c=>ce(c),children:e.jsxs(Ae,{isLazy:!0,trigger:m?"click":"hover",placement:"top-start",children:[e.jsx(ve,{children:e.jsx(ae,{as:"button",cursor:f=="$0"?"text":"help",children:e.jsx($,{h:"14px",isLoaded:!!f&&!t&&!a,children:e.jsx(b,{color:"text_caption",children:f})})})}),f!=="$0"&&e.jsx(Me,{children:e.jsx(fe,{zIndex:"2",w:"fit-content",p:"4px",children:e.jsx(_e,{borderRadius:"12px",p:"8px",children:e.jsxs(M,{align:"flex-start",children:[r&&e.jsx(b,{fontSize:"12px",color:"text_caption",children:"Mining Rewards"}),y==null?void 0:y.map(c=>{var x;return e.jsxs(T,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:c==null?void 0:c.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(b,{fontSize:"12px",color:"text_caption",children:ge(c==null?void 0:c.display_amount_owed)}),e.jsxs(b,{fontSize:"12px",children:[" ",Z(c==null?void 0:c.amountUSD,2)]})]})]},(x=c==null?void 0:c.token)==null?void 0:x.coin_type)}),j&&e.jsx(b,{fontSize:"12px",color:"text_caption",children:"Farming Rewards"}),A==null?void 0:A.map(c=>{var x;return e.jsxs(T,{minW:"200px",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[e.jsx(me,{token:c==null?void 0:c.token,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),e.jsxs(M,{align:"flex-end",gap:"4px",children:[e.jsx(b,{fontSize:"12px",color:"text_caption",children:ge(c==null?void 0:c.display_amount_owed)}),e.jsxs(b,{fontSize:"12px",children:[" ",Z(c==null?void 0:c.amountUSD,2)]})]})]},(x=c==null?void 0:c.token)==null?void 0:x.coin_type)})]})})})})]})})})})},_s="/images/icon_active_new@2x.png";function Ts({isActive:s,isLoading:n,imgStyle:l={},...i}){const{imgW:p="16px",imgH:t="12px"}=l;return e.jsx(ne,{borderRadius:"8px",align:"center",justifyContent:"center",bg:"bg_secondary",h:"18px",p:"0px 8px",...i,children:e.jsx(Te,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"240px",textAlign:"left",children:s?"The price of this pool is currently within your position price range.":"The price of this pool is currently out of your position price range."}),children:e.jsx(ae,{onClick:v=>ce(v),children:e.jsxs(T,{align:"center",children:[s&&e.jsx(I,{w:p,h:t,src:_s}),e.jsx($,{w:"100%",isLoaded:!n,children:e.jsx(b,{fontSize:"12px",color:s?"primary":"primary_gray",fontWeight:"500",children:s?"Active":"Inactive"})})]})})})})}function Ps({positionInfo:s,width:n,tokenName:l,priceDirect:i}){const{posPoolsRelatedData:p}=le(),t=p[s==null?void 0:s.posId],v=(t==null?void 0:t.currentStatus)=="Active";K();const h=g.useMemo(()=>t==null?void 0:t.minPriceOrigin,[t]),a=g.useMemo(()=>t==null?void 0:t.maxPriceOrigin,[t]),r=g.useMemo(()=>t==null?void 0:t.currentPriceOrigin,[t]),[j,_]=g.useState(0),w=g.useRef(null);g.useEffect(()=>{const f=()=>{w.current&&_(w.current.offsetWidth)},m=new ResizeObserver(f);return w.current&&m.observe(w.current),()=>{w.current&&m.unobserve(w.current)}},[h,a,r]);const y=g.useMemo(()=>{if(a==="âˆž")return"0px";if(r&&h&&a&&j){if(d(r).lessThanOrEqualTo(a)&&d(r).greaterThanOrEqualTo(h)){const f=d(r).sub(h).div(d(a).sub(d(h))).toString();return`${d(j).mul(f).toFixed(0)}px`}if(d(r).lt(h))return"6px";if(d(r).gt(a))return"calc(100% + 6px)"}return"0px"},[r,h,a,j]),{getExplorerUrl:A}=We();return e.jsxs(M,{align:"flex-start",w:{base:"100%",lg:n},maxW:{base:"100%",lg:n},children:[e.jsxs(T,{maxW:"100%",w:{base:"100%",lg:"unset"},borderRadius:"12px",pr:"16px",children:[e.jsx($,{isLoaded:!!(t!=null&&t.minPrice)&&!!(t!=null&&t.maxPrice),borderRadius:"4px",children:i?e.jsx(b,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${t==null?void 0:t.minPrice} - ${t==null?void 0:t.maxPrice}`}):e.jsx(b,{lineHeight:"1",fontSize:"14px",color:"text_caption",whiteSpace:"nowrap",children:`${t==null?void 0:t.minPriceResever} - ${t==null?void 0:t.maxPriceResever}`})}),e.jsx(Ts,{isActive:v,isLoading:(t==null?void 0:t.currentStatus)==""}),e.jsx(T,{onClick:f=>ce(f),children:e.jsx(Te,{placement:"top",tooltip:e.jsxs(T,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(T,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(b,{fontSize:{base:"14px",lg:"12px"},children:"ID"}),e.jsx($,{isLoaded:!!l,children:e.jsx(b,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:l==null?void 0:l.split("|")[1]})})]}),e.jsxs(T,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(b,{fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(A(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),children:e.jsx(ae,{border:"1px solid",borderColor:"border",borderRadius:"50%",children:e.jsx(Ee,{xlinkHref:"#icon-icon_info",width:"16px",height:"16px"})})})})]}),e.jsx($,{h:"6px",isLoaded:!!(t!=null&&t.currentPriceOrigin),borderRadius:"4px",children:e.jsx(E,{w:"88px",h:"6px",bgImage:a==="âˆž"?"none":"url('/images/img_inactive_bg@2x.png')",bgSize:"88px 6px",children:e.jsx(E,{w:a==="âˆž"?"88px":"56px",h:a==="âˆž"?"2px":"6px",position:"relative",ref:w,background:a==="âˆž"?"linear-gradient(135deg, #68FFD8 0%, #0091FF 100%)":v?"url('/images/img_range@2x.png')":"none",ml:a==="âˆž"?"0px":"16px",bgSize:"100% 6px",bgPosition:"center",bgRepeat:"no-repeat",children:a!=="âˆž"&&e.jsx(E,{w:"2px",h:"8px",bg:"#fff",borderRadius:"8px",position:"absolute",top:"50%",left:y,transform:"translateY(-50%)",zIndex:"5"})})})})]})}function ks({positionInfo:s,positionItemWidth:n=[],priceDirect:l,showMiningIcon:i,showFarmingIcon:p}){const{isApp:t}=K(),{getExplorerUrl:v}=We(),{getClmmPosName:h}=ds(),a=Se(),{setCurrentPosDetailTab:r}=bs(),{posPoolsOriginalData:j,posPoolsRelatedData:_,posApiPoolData:w,poolRangeObj:y}=le(),A=_[s==null?void 0:s.posId],f=w[s==null?void 0:s.clmmPool],m=g.useMemo(()=>{var C;if(s!=null&&s.tokenName)return s==null?void 0:s.tokenName;{const z=(C=j==null?void 0:j[s==null?void 0:s.clmmPool])==null?void 0:C.index;return h(Number(s==null?void 0:s.index),z)}},[s==null?void 0:s.tokenName,s==null?void 0:s.index,s==null?void 0:s.clmmPool,j]),k=()=>{console.log("ðŸš€ ~ PoolItem ~ poolInfo:",s),a(`/position-detail/${s==null?void 0:s.id}`)},[u,c]=g.useState(!1),{getPositionApr:x}=Ue(),L=g.useMemo(()=>{if(V(A)&&V(f)&&V(y)){const C=y[s==null?void 0:s.clmmPool];if(C){const z=C==null?void 0:C.ranges.reduce((F,W)=>(F[W.dateType]=W,F),{});return x(f,A,"week",z.week)}}},[A,f,s,y]);hs();const[R,ee]=g.useState(null),[se,X]=g.useState(null),O=(A==null?void 0:A.currentStatus)=="Active";return e.jsx(Fe,{onMouseEnter:()=>{setTimeout(()=>{c(!0)},40)},onMouseLeave:()=>{setTimeout(()=>{c(!1)},80)},w:"100%",bg:"position_bg",border:"none",p:{base:"16px 8px 12px",lg:"20px 16px "},borderRadius:"16px",onClick:k,children:e.jsx(T,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:e.jsxs(M,{w:"100%",align:"flex-start",gap:"12px",children:[t&&e.jsxs(T,{flexDirection:{base:"column",lg:"row"},w:{base:"100%",lg:"unset"},children:[e.jsxs(T,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(b,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},children:"NFT ID"}),e.jsx($,{isLoaded:!!m,children:e.jsx(b,{fontWeight:"500",fontSize:{base:"14px",lg:"12px"},color:"text_caption",children:m==null?void 0:m.split("|")[1]})})]}),e.jsxs(T,{w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"flex-start"},children:[e.jsx(b,{color:"primary_gray",fontSize:{base:"14px",lg:"12px"},ml:{base:"0",lg:"8px"},children:"Address"}),e.jsx(De,{fontWeight:"500",color:"text_caption",address:s==null?void 0:s.id,showLink:!1,fontSize:{base:"14px",lg:"12px"},onClickLink:()=>{window.open(v(s==null?void 0:s.id,"nftAddress"),"_blank")}})]})]}),e.jsxs(T,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},gap:{base:"12px",lg:"8px"},children:[t?e.jsx(ys,{positionInfo:s,symbolEllipsesDecimals:10,labelInfo:{text:"Price Range"}}):e.jsx(Ps,{positionInfo:s,width:n[0],tokenName:m,priceDirect:l}),e.jsxs(T,{w:{base:"100%",lg:n[1]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(b,{color:"primary_gray",children:"APR"}),e.jsx($,{isLoaded:!!L,children:e.jsx(b,{textAlign:"right",color:"primary",children:O?L==null?void 0:L.displayAprPercentageTotal:"0%"})})]}),e.jsxs(T,{m:"-12px 0",w:{base:"100%",lg:n[2]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(b,{color:"primary_gray",children:"Liquidity"}),e.jsx(js,{positionInfo:s,fontSize:"14px",isPosList:!0})]}),e.jsxs(T,{m:"-12px 0",w:{base:"100%",lg:n[3]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(b,{color:"primary_gray",children:"Pending Fees"}),e.jsx(vs,{positionInfo:s,onFeesChange:ee})]}),(i||p)&&e.jsxs(T,{m:"-12px 0",w:{base:"100%",lg:n[4]},justify:{base:"space-between",lg:"flex-end"},children:[t&&e.jsx(b,{color:"primary_gray",children:"Pending Rewards"}),e.jsxs(T,{gap:"4px",children:[t&&i&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),t&&p&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(fs,{positionInfo:s,onRewardsChange:X})]})]})]}),t&&e.jsxs(Xe,{w:{base:"100%",lg:"32px"},h:{base:"40px",lg:"90px"},borderRadius:"8px",variant:"ghost",p:"0 !important",_hover:{svg:{fill:"text_caption"}},children:[e.jsx(b,{color:"primary_gray",children:"Manage"}),e.jsx(Ee,{xlinkHref:"#icon-icon_list_token",w:"14px",h:"14px"})]})]})})})}const je=["480px","20%","20%","20%","20%"],$e=[{label:"APR",value:"apr"},{label:"Liquidity",value:"liquidity"},{label:"Pending Fees",value:"fees"},{label:"Pending Rewards",value:"rewards"}],Cs=$e.reduce((s,n)=>(s[n.value]=n,s),{});function Ks({poolInfo:s,priceDirect:n}){const{coinPriceObj:l}=Oe(),{getPositionSortList:i}=As(),[p,t]=g.useState("desc"),[v,h]=g.useState({label:"",value:""}),a=m=>{(m==null?void 0:m.value)===v.value?t(k=>k==="desc"?"asc":"desc"):(t("desc"),h(m))},[r,j]=g.useState([]),_=g.useMemo(()=>{if(!V(s))return[];const m=i(v.value,p,s.list),k=v.value?m:s.list;return console.log("ðŸš€ ~ positionList ~ sortedList:",k,m),j(m),k},[v.value,p,s==null?void 0:s.list,l]),w=m=>r.some(k=>d(k[m]).gt(0)),y=g.useMemo(()=>w("totalMiningAmount"),[r]),A=g.useMemo(()=>w("totalFarmingAmount"),[r]),{isApp:f}=K();return e.jsxs(M,{gap:"12px",w:"100%",children:[!f&&e.jsxs(T,{w:"100%",p:"0 16px",children:[e.jsx(b,{w:je[0],children:"Price Range"}),$e.map((m,k)=>m.value!=="rewards"||y||A?e.jsxs(T,{gap:"4px",w:je[k+1],justify:"flex-end",children:[y&&m.value==="rewards"&&e.jsx(I,{w:"16px",h:"16px",src:"/images/icon_mining.png"}),A&&m.value==="rewards"&&e.jsx(I,{w:"18px",h:"18px",src:"/images/icon_farms.png"}),e.jsx(ms,{labelInfo:Cs[m.value],sortRule:p,sortBy:v,clickSort:a})]},m.value):null)]}),e.jsx(M,{w:"100%",maxH:"440px",overflow:"auto",gap:"12px",children:_.map(m=>e.jsx(ks,{positionInfo:m,positionItemWidth:je,priceDirect:n,showMiningIcon:y,showFarmingIcon:A},m==null?void 0:m.id))})]})}export{Js as F,Ks as P,Qs as V,As as a,Vs as u};
//# sourceMappingURL=PositionItem-B_0mND4T.js.map
