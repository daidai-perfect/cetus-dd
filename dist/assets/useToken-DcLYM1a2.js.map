{"version":3,"file":"useToken-DcLYM1a2.js","sources":["../../../hooks/src/useToken.ts"],"sourcesContent":["import { Token } from '@cetus/types'\nimport { AllTokensTable } from '@cetus/utils'\nimport { fixCoinType } from '@cetusprotocol/common-sdk'\nimport { useDeepCompareEffect } from 'ahooks'\nimport { useState } from 'react'\nimport { useGetTokens } from './useGetTokens'\n\ntype TokenInfoType<T> = T extends string ? Token | undefined : T extends string[] ? Map<string, Token> | undefined : undefined\n\nexport function useGetToken<T extends string | string[] | undefined>(coinType?: T) {\n  const { getToken, getTokenList } = useGetTokens()\n  const [tokenInfo, setTokenInfo] = useState<TokenInfoType<T>>()\n  useDeepCompareEffect(() => {\n    if (coinType) {\n      fetchTokenInfo(coinType).then(tokenInfo => {\n        setTokenInfo(tokenInfo)\n      })\n    }\n  }, [coinType])\n\n  const fetchTokenInfo = async <K extends string | string[]>(coinType: K): Promise<TokenInfoType<K>> => {\n    try {\n      if (Array.isArray(coinType)) {\n        const tokenMap = await getTokenListInfo(coinType)\n        return tokenMap as TokenInfoType<K>\n      } else {\n        const token = await getTokenInfo(coinType)\n        if (token) {\n          return token as TokenInfoType<K>\n        }\n      }\n    } catch (error) {\n      console.log('ðŸš€ ~ file: useToken.ts:32 ~ fetchTokenInfo ~ error:', error)\n    }\n\n    return undefined as TokenInfoType<K>\n  }\n\n  const getTokenInfo = async (coinType?: string) => {\n    try {\n      if (coinType) {\n        const token = await AllTokensTable.getItem<Token>(fixCoinType(coinType, false))\n        if (token) {\n          return token\n        } else {\n          await getToken(coinType)\n          return AllTokensTable.getItem<Token>(fixCoinType(coinType, false))\n        }\n      }\n      return undefined\n    } catch (error) {\n      console.log('ðŸš€ ~ getTokenInfo ~ 51:', error)\n      return undefined\n    }\n  }\n\n  const getTokenListInfo = async (coinTypes?: string[]) => {\n    try {\n      if (coinTypes && coinTypes.length > 0) {\n        const tokenMap = new Map<string, Token>()\n        const unStoredTypes: string[] = []\n        for (const coinType of coinTypes) {\n          const token = await AllTokensTable.getItem<Token>(fixCoinType(coinType, false))\n          if (token) {\n            tokenMap.set(coinType, token)\n          } else {\n            unStoredTypes.push(coinType)\n          }\n        }\n        if (unStoredTypes.length > 0) {\n          await getTokenList(unStoredTypes)\n        }\n        for (const coinType of unStoredTypes) {\n          const _token = await AllTokensTable.getItem<Token>(fixCoinType(coinType, false))\n          if (_token) {\n            tokenMap.set(coinType, _token)\n          }\n        }\n        console.log('getTokenListInfo tokenMap', tokenMap)\n        return tokenMap\n      }\n      return undefined\n    } catch (error) {\n      console.log('ðŸš€ ~ getTokenListInfo ~ 82:', error)\n      return undefined\n    }\n  }\n\n  return {\n    tokenInfo,\n    getTokenInfo,\n    getTokenListInfo,\n    fetchTokenInfo\n  }\n}\n"],"names":["useGetToken","coinType","getToken","getTokenList","useGetTokens","tokenInfo","setTokenInfo","useState","useDeepCompareEffect","fetchTokenInfo","getTokenListInfo","token","getTokenInfo","error","AllTokensTable","fixCoinType","coinTypes","tokenMap","unStoredTypes","_token"],"mappings":"wGASO,SAASA,EAAqDC,EAAc,CACjF,KAAM,CAAE,SAAAC,EAAU,aAAAC,CAAa,EAAIC,EAAa,EAC1C,CAACC,EAAWC,CAAY,EAAIC,WAA2B,EAC7DC,EAAqB,IAAM,CACrBP,GACFQ,EAAeR,CAAQ,EAAE,KAAKI,GAAa,CACzCC,EAAaD,CAAS,CAAA,CACvB,CACH,EACC,CAACJ,CAAQ,CAAC,EAEP,MAAAQ,EAAiB,MAAoCR,GAA2C,CAChG,GAAA,CACE,GAAA,MAAM,QAAQA,CAAQ,EAEjB,OADU,MAAMS,EAAiBT,CAAQ,EAE3C,CACC,MAAAU,EAAQ,MAAMC,EAAaX,CAAQ,EACzC,GAAIU,EACK,OAAAA,CACT,QAEKE,EAAO,CACN,QAAA,IAAI,sDAAuDA,CAAK,CAAA,CAI5E,EAEMD,EAAe,MAAOX,GAAsB,CAC5C,GAAA,CACF,GAAIA,EAAU,CACZ,MAAMU,EAAQ,MAAMG,EAAe,QAAeC,EAAYd,EAAU,EAAK,CAAC,EAC9E,OAAIU,IAGF,MAAMT,EAASD,CAAQ,EAChBa,EAAe,QAAeC,EAAYd,EAAU,EAAK,CAAC,EACnE,CAEK,aACAY,EAAO,CACN,QAAA,IAAI,0BAA2BA,CAAK,EACrC,MAAA,CAEX,EAEMH,EAAmB,MAAOM,GAAyB,CACnD,GAAA,CACE,GAAAA,GAAaA,EAAU,OAAS,EAAG,CAC/B,MAAAC,MAAe,IACfC,EAA0B,CAAC,EACjC,UAAWjB,KAAYe,EAAW,CAChC,MAAML,EAAQ,MAAMG,EAAe,QAAeC,EAAYd,EAAU,EAAK,CAAC,EAC1EU,EACOM,EAAA,IAAIhB,EAAUU,CAAK,EAE5BO,EAAc,KAAKjB,CAAQ,CAC7B,CAEEiB,EAAc,OAAS,GACzB,MAAMf,EAAae,CAAa,EAElC,UAAWjB,KAAYiB,EAAe,CACpC,MAAMC,EAAS,MAAML,EAAe,QAAeC,EAAYd,EAAU,EAAK,CAAC,EAC3EkB,GACOF,EAAA,IAAIhB,EAAUkB,CAAM,CAC/B,CAEM,eAAA,IAAI,4BAA6BF,CAAQ,EAC1CA,CAAA,CAEF,aACAJ,EAAO,CACN,QAAA,IAAI,8BAA+BA,CAAK,EACzC,MAAA,CAEX,EAEO,MAAA,CACL,UAAAR,EACA,aAAAO,EACA,iBAAAF,EACA,eAAAD,CACF,CACF"}