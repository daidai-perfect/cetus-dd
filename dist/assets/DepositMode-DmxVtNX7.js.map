{"version":3,"file":"DepositMode-DmxVtNX7.js","sources":["../../src/components/vaults/modal/DepositMode.tsx"],"sourcesContent":["import vaultInterface from '@/hooks/vault-interface'\nimport { useCalculateChangeLpRate, useCalculateSlippageAmount } from '@/hooks/vaults/useVaultsHelper'\nimport useGlobalStore from '@/store/common/global'\nimport { VaultApiInfo } from '@/types'\nimport { TradeInputGroup } from '@cetus/design'\nimport useWindowWidth from '@cetus/hooks/src/useWindowWidth'\nimport { useAccountStore } from '@cetus/stores'\nimport { Token } from '@cetus/types'\nimport { Box, Button, Text, VStack } from '@chakra-ui/react'\nimport { useEffect } from 'react'\nimport { VaultsAddResult } from '../detail/VaultsAddResult'\n\ntype VaultDepositModeProps = {\n  isUnstableVault: boolean\n  displayTokenA?: Token | undefined\n  displayTokenB?: Token | undefined\n  vaultId: string\n  isReverse: boolean\n  assetAction: string\n  isCheckedZAP: boolean\n  currentActionTab: string\n  autoRefresh: () => void\n  apiVaultInfo: VaultApiInfo\n}\nexport default function VaultDepositMode(props: VaultDepositModeProps) {\n  const {\n    isUnstableVault,\n    displayTokenA,\n    displayTokenB,\n    vaultId,\n    isReverse,\n    assetAction,\n    isCheckedZAP,\n    currentActionTab,\n    autoRefresh,\n    apiVaultInfo\n  } = props\n  const useVaultsAdd = vaultInterface.useVaultsAdd(isUnstableVault)\n  const useAddButtonStatus = vaultInterface.useAddButtonStatus(isUnstableVault)\n  const useGetContractVaultInfo = vaultInterface.useGetContractVaultInfo(isUnstableVault)\n  const { currentAccount, isOpenWalletModal, onWalletModal } = useAccountStore()\n  const { contractVault, lpTokenInfo, fetchClmmPoolFromContract, fetchVaultInfoFromContract, gtAumLimit, hardCapUSD, vaultTvl } =\n    useGetContractVaultInfo(\n      apiVaultInfo?.vaultsId,\n      apiVaultInfo?.clmmPoolAddress,\n      apiVaultInfo?.tokenA,\n      apiVaultInfo?.tokenB,\n      apiVaultInfo?.isReverse\n    )\n\n  // 初始化add hook时区分 传入tokenA,B按照合约方向\n  const {\n    amountInputA,\n    amountInputB,\n    balanceInfoA,\n    balanceInfoB,\n    amountValueA,\n    amountValueB,\n    preCalculateLoading,\n    fixAmountA,\n    inputTotalValue,\n    handleAmountInputChange,\n    calculateResult,\n    showOnlySideTips,\n    doAddAction,\n    reCalculateResult,\n    overHardtop,\n    zapNumError,\n    calculateLpLoading,\n    inputTotalValueError\n  } = useVaultsAdd(\n    assetAction,\n    autoRefresh,\n    vaultId,\n    isReverse ? displayTokenB : displayTokenA,\n    isReverse ? displayTokenA : displayTokenB,\n    isReverse,\n    isCheckedZAP,\n    hardCapUSD,\n    vaultTvl\n  )\n  console.log('🚀🚀🚀 ~ DepositMode.tsx:72 ~ VaultDepositMode ~ inputTotalValueError:', inputTotalValueError)\n\n  console.log('🚀🚀🚀 ~ DepositMode.tsx:71 ~ VaultDepositMode ~ showOnlySideTips:', showOnlySideTips)\n\n  const { btnText, btnDisabled } = useAddButtonStatus(\n    isCheckedZAP,\n    assetAction,\n    true,\n    amountInputA,\n    amountInputB,\n    isReverse ? !fixAmountA : fixAmountA,\n    balanceInfoA?.balanceFormat,\n    balanceInfoB?.balanceFormat,\n    displayTokenA,\n    displayTokenB,\n    isUnstableVault,\n    zapNumError,\n    calculateResult,\n    overHardtop,\n    inputTotalValueError\n  )\n\n  const { vaultsSlippage } = useGlobalStore()\n\n  useEffect(() => {\n    if (apiVaultInfo) {\n      fetchClmmPoolFromContract(apiVaultInfo.clmmPoolAddress, true)\n    }\n  }, [apiVaultInfo?.clmmPoolAddress])\n\n  useEffect(() => {\n    if (vaultId) {\n      fetchVaultInfoFromContract(vaultId)\n    }\n  }, [vaultId])\n\n  // 最小可接收\n  const { amountLimit } = useCalculateSlippageAmount(Number(vaultsSlippage), calculateResult?.ft_amount, false)\n  // 占比 非稳 lp_token_treasury 稳定total_supply 分别表示池子总lp_token数量\n  const { lpRate } = useCalculateChangeLpRate(\n    calculateResult?.ft_amount,\n    isUnstableVault ? contractVault?.lp_token_treasury : contractVault?.total_supply\n  )\n\n  const { isApp } = useWindowWidth()\n\n  return (\n    <>\n      <Box w=\"100%\" position=\"relative\">\n        <TradeInputGroup\n          onClick={() => {}}\n          from={{\n            wrapStyle: { h: '108px' },\n            balance: balanceInfoA?.balanceFormat || '',\n            value: amountInputA,\n            amountValue: amountValueA,\n            loading: (isReverse ? fixAmountA : !fixAmountA) && preCalculateLoading && !isCheckedZAP,\n            hideSelf: assetAction !== 'both' && assetAction !== displayTokenA?.coin_type,\n            onChange: value => {\n              handleAmountInputChange(value, !isReverse, true, amountInputB)\n            },\n            selectable: false,\n            placeholder: '0.0',\n            token: displayTokenA,\n            onFocusChange: (focus: boolean) => {}\n          }}\n          to={{\n            wrapStyle: { h: '108px' },\n            balance: balanceInfoB?.balanceFormat || '',\n            value: amountInputB,\n            amountValue: amountValueB,\n            loading: (isReverse ? !fixAmountA : fixAmountA) && preCalculateLoading && !isCheckedZAP,\n            onFocusChange: (focus: boolean) => {},\n            onChange: value => {\n              handleAmountInputChange(value, isReverse, true, amountInputA)\n            },\n            selectable: false,\n            hideSelf: assetAction !== 'both' && assetAction !== displayTokenB?.coin_type,\n            placeholder: '0.0',\n            token: displayTokenB\n          }}\n          iconParams={{\n            xlinkHref: '#icon-icon_add',\n            svgFill: 'text_caption',\n            iconCursor: 'default'\n          }}\n          iconHover={false}\n        />\n      </Box>\n\n      {gtAumLimit ? (\n        <VStack w=\"100%\" alignItems=\"start\">\n          <Text\n            color=\"primary_yellow\"\n            fontSize=\"12px\"\n            textAlign=\"left\"\n            w=\"100%\"\n            bg=\"primary_yellow_opacity.10\"\n            p=\"12px\"\n            borderRadius=\"8px\"\n            lineHeight=\"20px\"\n          >\n            The vault has reached its current capacity. New deposits are not accepted at this time.\n          </Text>\n        </VStack>\n      ) : overHardtop ? (\n        <VStack w=\"100%\" alignItems=\"start\" gap=\"20px\">\n          <Text\n            color=\"primary_yellow\"\n            fontSize=\"12px\"\n            textAlign=\"left\"\n            w=\"100%\"\n            bg=\"primary_yellow_opacity.10\"\n            p=\"12px\"\n            borderRadius=\"8px\"\n            lineHeight=\"20px\"\n          >\n            Your deposit has gone over the vault capacity. Try reducing your deposit amount.\n          </Text>\n        </VStack>\n      ) : zapNumError ? (\n        <VStack w=\"100%\" pb={calculateResult || showOnlySideTips ? '0px' : '20px'} alignItems=\"start\" gap=\"20px\">\n          <Text\n            color=\"primary_yellow\"\n            fontSize=\"12px\"\n            textAlign=\"left\"\n            w=\"100%\"\n            bg=\"primary_yellow_opacity.10\"\n            p=\"12px\"\n            borderRadius=\"8px\"\n            lineHeight=\"20px\"\n          >\n            Single-asset deposit can't be higher than $10,000 at a time.\n          </Text>\n        </VStack>\n      ) : null}\n\n      <Button\n        width=\"100%\"\n        height=\"52px\"\n        borderRadius=\"12px\"\n        marginBottom=\"8px\"\n        fontWeight=\"500\"\n        fontSize={zapNumError ? (isApp ? '12px' : '15px') : '16px'}\n        isLoading={preCalculateLoading}\n        disabled={btnDisabled || preCalculateLoading || gtAumLimit || overHardtop}\n        onClick={() => (!currentAccount?.address ? onWalletModal(true) : doAddAction())}\n      >\n        {/* {btnText || currentActionTab} */}\n        {btnText || (isCheckedZAP ? 'Zap In' : 'Deposit')}\n      </Button>\n\n      {inputTotalValueError && (\n        <VStack w=\"100%\" alignItems=\"start\">\n          <Text\n            color=\"primary_red\"\n            fontSize=\"12px\"\n            textAlign=\"left\"\n            w=\"100%\"\n            bg=\"primary_red_opacity.10\"\n            p=\"12px\"\n            borderRadius=\"8px\"\n            lineHeight=\"20px\"\n          >\n            The input is too small. Zap mode is not available.\n          </Text>\n        </VStack>\n      )}\n\n      {/* 展示计算结果 */}\n      {(calculateResult || showOnlySideTips) && !inputTotalValueError && (\n        <VStack w=\"100%\" pb=\"20px\" alignItems=\"start\" gap=\"0\">\n          {assetAction !== 'both' && showOnlySideTips && (\n            <Text color=\"text_paragraph\" fontSize=\"12px\" lineHeight=\"1.8\" pb={calculateResult ? '20px' : '0'}>\n              {showOnlySideTips}\n            </Text>\n          )}\n          {calculateResult && (\n            <VaultsAddResult\n              amountLimit={amountLimit}\n              inputTotalValue={inputTotalValue}\n              preCalculateLoading={preCalculateLoading}\n              calculateLpLoading={calculateLpLoading}\n              lpRate={lpRate}\n              lpDecimals={lpTokenInfo?.decimals}\n              poolName={`${displayTokenA?.symbol} - ${displayTokenB?.symbol}`}\n              labelColor=\"primary_gray\"\n            />\n          )}\n        </VStack>\n      )}\n      {/* {calculateResult && (\n        <HStack marginBottom=\"12px\" width=\"100%\">\n          <VaultsAddResult\n            amountLimit={amountLimit}\n            inputTotalValue={inputTotalValue}\n            preCalculateLoading={preCalculateLoading}\n            calculateLpLoading={calculateLpLoading}\n            lpRate={lpRate}\n            lpDecimals={lpTokenInfo?.decimals}\n            poolName={`${displayTokenA?.symbol} - ${displayTokenB?.symbol}`}\n            labelColor=\"primary_gray\"\n          />\n        </HStack>\n      )} */}\n    </>\n  )\n}\n"],"names":["VaultDepositMode","props","isUnstableVault","displayTokenA","displayTokenB","vaultId","isReverse","assetAction","isCheckedZAP","currentActionTab","autoRefresh","apiVaultInfo","useVaultsAdd","vaultInterface","useAddButtonStatus","useGetContractVaultInfo","currentAccount","isOpenWalletModal","onWalletModal","useAccountStore","contractVault","lpTokenInfo","fetchClmmPoolFromContract","fetchVaultInfoFromContract","gtAumLimit","hardCapUSD","vaultTvl","amountInputA","amountInputB","balanceInfoA","balanceInfoB","amountValueA","amountValueB","preCalculateLoading","fixAmountA","inputTotalValue","handleAmountInputChange","calculateResult","showOnlySideTips","doAddAction","reCalculateResult","overHardtop","zapNumError","calculateLpLoading","inputTotalValueError","btnText","btnDisabled","vaultsSlippage","useGlobalStore","useEffect","amountLimit","useCalculateSlippageAmount","lpRate","useCalculateChangeLpRate","isApp","useWindowWidth","jsxs","Fragment","jsx","Box","TradeInputGroup","value","focus","VStack","Text","Button","VaultsAddResult"],"mappings":"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"}