import{aF as Ks,aG as $t,aH as Qs,aI as Xs,u as Nt,j as e,T as k,h as Ys,H as W,I as Be,b as Me,V as H,g as De,ad as Vt,as as P,e as Ot,r as j,X as Zt,C as Xe,$ as fe,l as Dt,k as Oe,f as Ce,d as Z,aJ as Jt,B as ne,U as gs,m as be,aA as Wt,Y as ms,az as Zs,ai as rt,aK as Js,S as it,a as vt,a1 as wt,aE as Ut,ae as ys,af as hs,ag as bs,ah as fs,aj as Ps,ak as js,a0 as As,W as Is,ab as yt,aL as Ss,aM as Gt,a5 as _s,aN as Pt,aO as ie,aP as ut,aQ as bt,aR as oe,a7 as er,aS as It,aT as tr,c as Kt,aU as sr,aV as rr,ar as ir,aC as nr,ao as es,aW as vs,aX as Re,aY as ar,aa as cr,an as lr,aZ as dr,a_ as or}from"./index-BXaz1_oP.js";import{A as xr}from"./AprTooltip-tSowuFwP.js";import{i as ur,R as pr,C as gr}from"./api-data-utils-B3w9psxD.js";import{u as ue}from"./index-B7uWkXbp.js";import{u as Se}from"./useQueryParams-BXYAPBGU.js";import{u as nt}from"./useDocumentSize-WySNwodi.js";import{H as mr,T as yr,a as hr,u as br,V as fr}from"./VolumeChart-CSrSSq92.js";import{N as st}from"./NoData-DRzqO0S2.js";import{A as jr}from"./AddressUnderline-Q5WGfH2-.js";import{T as Ar}from"./TvlChart-B1_64m2Q.js";import{u as Sr}from"./useBurn-DYT6bWJG.js";import{H as me}from"./HTextLabelBox-Bi89arQD.js";import{T as _r}from"./TooltipIcon-DPeif3JU.js";import{A as ws}from"./AddressCopyLink-Cb4gIROq.js";import{P as vr}from"./progress-BGoXeslz.js";import{c as Rs,d as wr,a as Rr,u as Cr}from"./usePositionList-Q0mVy6Ro.js";import{u as kr}from"./useRpcListener-D_X5H23S.js";import{a as Lr,P as Tr,F as Cs}from"./PositionListLoading-DSTxcNLB.js";import{u as ze,a as Rt,L as ks,b as Fr,c as Br,S as pt}from"./useGetContractPoolInfo-qx6UXYnu.js";import{T as Mr}from"./TradeConfirmAmountInfo-D_Jg1lTx.js";import{P as zr}from"./PositionStatus-6rNjt0M7.js";import{R as Er}from"./RangeAlerts-CZDwHDOA.js";import{u as qr}from"./global-BNIZ6VYu.js";import{c as $r,g as ft,a as jt,u as Wr}from"./useGetPoolList-C83MvO5k.js";import{u as Ls}from"./useAccountBalance-Ck7NWqV0.js";import{u as At}from"./useTokenBalance-CG6Ic6-b.js";import{u as Ur,a as Hr}from"./useTransaction-C1_yaKH5.js";import{u as Ts,m as zt,S as ts,a as Nr}from"./SelectTokenAndFeeConfirm-ZuMTF78R.js";import{u as Vr}from"./useNotifiSubscription-l8IqLO-n.js";import{u as Or}from"./usePosAdd-_cf2wNVv.js";import{L as St}from"./LockInput-BD8iGuMr.js";import{S as Fs}from"./Slippage-V3PUI_OO.js";import{P as ss,C as Bs,I as _t}from"./common-DODmqVVZ.js";import{C as ht}from"./CetusTooltip-CEyBwakd.js";import{S as Ht}from"./switch-L37R-ZHt.js";import{T as Ms}from"./TradeInputGroup-DR0cHSDG.js";import{i as Qe}from"./index-BqRncGQr.js";import{g as Dr}from"./liquidity-D0KDnjpw.js";import{d as rs,F as Gr}from"./FeeTierSelect-C1yZ1ZGU.js";import{u as zs}from"./useToken-6jXOGzJ6.js";import{R as Kr}from"./RefreshButton-BbFcEixF.js";import{C as Qr}from"./CurrentPrice-dFqRZVyr.js";import{W as Xr}from"./WarningTokenTipModal-CDx97H9T.js";import"./generateCategoricalChart-DcWbRkMd.js";import"./debounce-Db7qic3W.js";import"./throttle-BJv1YCjk.js";import"./index-BIkqHUcC.js";import"./index-Did0O7R9.js";import"./Pagination-CYaCA-9A.js";import"./tr-E_zz6vUB.js";import"./_getAllKeysIn-DdTQwZzK.js";import"./YAxis-CLzqHnVJ.js";import"./progress.utils-SoaBIn3H.js";import"./usePreviousValue-DgNtF_i1.js";import"./useCurrentPos-DbODgm3y.js";import"./PriceRange-KUuRnqg0.js";import"./SingleTokenInfo-CoJA3Nix.js";import"./RangeValue-CVgCI6vh.js";import"./ActionButton-C-Yh4XAH.js";import"./VTextLabelBox-CuxGQiTn.js";import"./index-D8EcEeMl.js";import"./Loading--MprhfyC.js";import"./useXCetusHelper-DTZ-A7aW.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-4Wy-uOr9.js";import"./icon_lock@2x-OdzkPjmc.js";import"./InputBox-728OlLJc.js";var Yr=/\s/;function Zr(t){for(var l=t.length;l--&&Yr.test(t.charAt(l)););return l}var Jr=/^\s+/;function Pr(t){return t&&t.slice(0,Zr(t)+1).replace(Jr,"")}var is=NaN,Ir=/^[-+]0x[0-9a-f]+$/i,ei=/^0b[01]+$/i,ti=/^0o[0-7]+$/i,si=parseInt;function ns(t){if(typeof t=="number")return t;if(Ks(t))return is;if($t(t)){var l=typeof t.valueOf=="function"?t.valueOf():t;t=$t(l)?l+"":l}if(typeof t!="string")return t===0?t:+t;t=Pr(t);var s=ei.test(t);return s||ti.test(t)?si(t.slice(2),s?2:8):Ir.test(t)?is:+t}var Et=function(){return Qs.Date.now()},ri="Expected a function",ii=Math.max,ni=Math.min;function Es(t,l,s){var d,x,r,y,p,i,o=0,n=!1,c=!1,f=!0;if(typeof t!="function")throw new TypeError(ri);l=ns(l)||0,$t(s)&&(n=!!s.leading,c="maxWait"in s,r=c?ii(ns(s.maxWait)||0,l):r,f="trailing"in s?!!s.trailing:f);function S(C){var A=d,z=x;return d=x=void 0,o=C,y=t.apply(z,A),y}function v(C){return o=C,p=setTimeout(g,l),n?S(C):y}function R(C){var A=C-i,z=C-o,B=l-A;return c?ni(B,r-z):B}function U(C){var A=C-i,z=C-o;return i===void 0||A>=l||A<0||c&&z>=r}function g(){var C=Et();if(U(C))return m(C);p=setTimeout(g,R(C))}function m(C){return p=void 0,f&&d?S(C):(d=x=void 0,y)}function a(){p!==void 0&&clearTimeout(p),o=0,d=i=x=p=void 0}function h(){return p===void 0?y:m(Et())}function F(){var C=Et(),A=U(C);if(d=arguments,x=this,i=C,A){if(p===void 0)return v(i);if(c)return clearTimeout(p),p=setTimeout(g,l),S(i)}return p===void 0&&(p=setTimeout(g,l)),y}return F.cancel=a,F.flush=h,F}function ai(){const{clmmSdk:t}=Xs(),{fetchByApi:l}=Nt();return{getTransactionsHistory:async x=>{try{const r=await l(ur,"GET",x);if(console.log(r,"getTransactionsHistory"),r)return r;throw new Error("no data")}catch(r){console.error(r,"getTransactionsHistory ~ error")}},getTransactionsHistoryBySDK:async(x,r)=>{try{const y=await t.Pool.getPoolTransactionList({poolId:x,paginationArgs:r,fullRpcUrl:"https://rpc-mainnet.suiscan.xyz:443"});if(console.log(y,"getTransactionsHistoryBySDK"),y)return y;throw new Error("no data")}catch(y){console.error(y,"getTransactionsHistoryBySDK ~ error")}}}}var Fe=(t=>(t.add="add_liquidity_event",t.remove="remove_liquidity_event",t.swap="swap_event",t))(Fe||{});const gt={[Fe.add]:{icon:"#icon-a-icon_add1",color:"primary_green",title:"Add Liquidity"},[Fe.remove]:{icon:"#icon-tx_remove",color:"light_coral",title:"Remove Liquidity"},[Fe.swap]:{icon:"#icon-icon_swap",color:"primary",title:"Swap"}},ci=({type:t})=>{var l,s,d,x;return e.jsxs(W,{children:[e.jsx(Be,{xlinkHref:(l=gt[t])==null?void 0:l.icon,svgFill:(s=gt[t])==null?void 0:s.color,svgHover:(d=gt[t])==null?void 0:d.color}),e.jsx(k,{color:"text_caption",children:(x=gt[t])==null?void 0:x.title})]})},li=({items:t,type:l,isReverse:s})=>{var x,r;const{isApp:d}=Me();return t?l===Fe.swap?d?e.jsxs(H,{align:"flex-end",gap:"8px",children:[e.jsx(Ke,{item:t==null?void 0:t[0]}),e.jsxs(W,{justify:"flex-end",children:[e.jsx(Be,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(Ke,{item:t==null?void 0:t[1]})]})]}):e.jsxs(W,{justify:"flex-end",gap:"8px",children:[e.jsx(Ke,{item:t==null?void 0:t[0]}),e.jsx(Be,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(Ke,{item:t==null?void 0:t[1]})]}):d?e.jsx(H,{align:"flex-end",gap:"8px 16px",flexDir:s?"column-reverse":"column",children:(x=t==null?void 0:t.filter(y=>!!+y.amount))==null?void 0:x.map(y=>e.jsx(Ke,{item:y},y==null?void 0:y.address))}):e.jsx(W,{justify:s?"flex-start":"flex-end",gap:"8px 16px",flexDir:s?"row-reverse":"row",children:(r=t==null?void 0:t.filter(y=>!!+y.amount))==null?void 0:r.map(y=>e.jsx(Ke,{item:y},y==null?void 0:y.address))}):null},Ke=({item:t})=>e.jsxs(W,{gap:"4px",children:[e.jsx(De,{imageUrl:t==null?void 0:t.url,w:"20px",h:"20px"}),e.jsx(k,{color:"text_caption",children:Vt(t==null?void 0:t.amount)}),e.jsx(k,{children:P(t==null?void 0:t.symbol,10)})]}),as=(t,l=!1)=>[{title:e.jsx(k,{children:"Event"}),key:"type",render:({type:s})=>e.jsx(ci,{type:s}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(k,{textAlign:"right",children:"Amounts"}),key:"amounts",render:({items:s,type:d})=>e.jsx(li,{items:s,type:d,isReverse:l}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(k,{textAlign:"right",children:"Transactions"}),key:"tx",render:({tx:s})=>e.jsx(jr,{address:s,color:"primary",fontSize:"14px",onClickLink:()=>{window.open(t(s,"tx"),"_blank")}}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(k,{textAlign:"right",children:"Time"}),key:"block_time",render:({block_time:s})=>e.jsx(k,{color:"text_caption",children:Ys(s)}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}}],cs=10;function di(){const{getExplorerUrl:t}=Ot(),{getTransactionsHistoryBySDK:l}=ai(),[s,d]=j.useState(!0),[x,r]=j.useState([]),[y,p]=j.useState(1),[i,o]=j.useState(),[n,c]=j.useState(!0),{apiPoolInfo:f,manualRefresh:S,setManualRefresh:v}=ue(),{poolAddress:R}=Se();j.useEffect(()=>{r([]),p(1),o(void 0),c(!0)},[R]),j.useEffect(()=>{S&&(r([]),p(1),o(void 0),c(!0),U({cursor:void 0,limit:cs}))},[R,S]),nt(()=>{U({cursor:i,limit:cs})},[y,R],{wait:500,leading:!0,trailing:!1});const U=async m=>{var a;try{if(!n)return;if(R){d(!0);const h=await l(R,{...m});if(h){const F=(a=h==null?void 0:h.data)==null?void 0:a.map(C=>{var V,O;const A=C==null?void 0:C.parsedJson,z=A!=null&&A.amount_a||A!=null&&A.atob?f==null?void 0:f.tokenA:f==null?void 0:f.tokenB,B=A!=null&&A.amount_b||A!=null&&A.atob?f==null?void 0:f.tokenB:f==null?void 0:f.tokenA;return{...C,type:(V=C.type)!=null&&V.includes("Add")?Fe.add:(O=C.type)!=null&&O.includes("Remove")?Fe.remove:Fe.swap,items:[{amount:Zt(A!=null&&A.amount_a?A==null?void 0:A.amount_a:A==null?void 0:A.amount_in,z==null?void 0:z.decimals).toString(),address:z==null?void 0:z.coin_type,url:z==null?void 0:z.logo_url,symbol:z==null?void 0:z.symbol},{amount:Zt(A!=null&&A.amount_b?A==null?void 0:A.amount_b:A==null?void 0:A.amount_out,B==null?void 0:B.decimals).toString(),address:B==null?void 0:B.coin_type,url:B==null?void 0:B.logo_url,symbol:B==null?void 0:B.symbol}]}});m!=null&&m.cursor?r(C=>[...C,...F||[]]):r(F||[]),o(h==null?void 0:h.nextCursor),c(h==null?void 0:h.hasNextPage),d(!1)}}}catch(h){console.log(h,"getTransactionsHistoryBySDK-error"),d(!1)}finally{d(!1)}},{isApp:g}=Me();return e.jsxs(H,{w:"100%",position:"relative",mt:{base:"12px",lg:"24px"},gap:"0px",children:[e.jsx(W,{w:"100%",justify:"space-between",children:e.jsx(k,{fontSize:"24px",color:"text_caption",fontWeight:"500",children:"Transactions"})}),!s&&(x==null?void 0:x.length)==0?e.jsx(st,{type:"nodata",mt:"16px",text:"No Recent Transactions"}):g?e.jsx(mr,{columns:as(t,f==null?void 0:f.isReverse),dataSource:x,loading:s&&y===1,itemSkeletonLength:5,itemHeight:"30px",wrapStyle:{gap:0},rowStyle:(m,a)=>({w:"100%",p:"0px",mt:"20px"}),onRowClick:m=>{window.open(t(m==null?void 0:m.tx,"tx"),"_blank")}}):e.jsx(yr,{columns:as(t,f==null?void 0:f.isReverse),dataSource:x,skeletonLength:10,loading:s&&y===1,onRowClick:m=>{window.open(t(m==null?void 0:m.tx,"tx"),"_blank")},rowStyle:{h:"52px",cursor:"pointer"}}),n&&e.jsx(Xe,{mt:{base:"40px",lg:"20px"},children:e.jsx(fe,{w:"120px",h:"32px",fontSize:"12px",borderRadius:"8px",bg:"button_ghost_bg",color:"primary",borderColor:"border",variant:"outline",onClick:()=>p(m=>m+1),children:s?e.jsx(Dt,{size:"sm",color:"text_caption"}):"Load More"})})]})}var qs=(t=>(t.volume="Volume",t.tvl="TVL",t.fees="Fees",t))(qs||{}),$s=(t=>(t.volume="vol",t.tvl="pure_tvl",t.fees="fee",t))($s||{}),Ws=(t=>(t.d="D",t.w="W",t.m="M",t))(Ws||{}),Us=(t=>(t.d="day",t.w="wek",t.m="mon",t))(Us||{});const oi=Object.values(qs).map(t=>({label:t})),ls=Object.values(Ws).map(t=>({label:t})),xi={D:40,W:30,M:20};function ui(){const{isApp:t}=Me(),[l,s]=j.useState("Volume"),[d,x]=j.useState("D"),[r,y]=j.useState([]),{apiPoolInfo:p}=ue(),[i,o]=j.useState(!0),[n,c]=j.useState(null),{getHistogramData:f}=hr(),{poolAddress:S}=Se();j.useLayoutEffect(()=>{y([]),s("Volume"),x("D"),c(null)},[S]);const v=async()=>{if(S)try{o(!0);const h=await f({date_type:Us[d.toLowerCase()],type:$s[l.toLowerCase()],limit:xi[d],address:S});h&&h.length&&y(h)}catch(h){throw console.error(h,"res-fetchAnalyticsData"),h}finally{o(!1)}};j.useEffect(()=>{v()},[S,l,d]);const R=j.useMemo(()=>{if(l==="Volume")return{value:p==null?void 0:p.volume24Display,title:"Volume (24H)"};if(l==="TVL")return{value:p==null?void 0:p.tvlDisplay,title:"TVL"};if(l==="Fees")return{value:p==null?void 0:p.fees24Display,title:"Fees (24H)"}},[l,p==null?void 0:p.volume24Display,p==null?void 0:p.tvlDisplay,p==null?void 0:p.fees24Display]),{getHoverTime:U,time:g}=br();j.useEffect(()=>{n!=null&&n.date&&U(n==null?void 0:n.date,d)},[n==null?void 0:n.date,d]);const m=h=>{s(h.label),h.label!==l&&y([])},a=h=>{x(h.label),h.label!==d&&y([])};return e.jsxs(H,{flex:"1",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"8px",lg:"20px"},bg:"bg_secondary",gap:"20px",children:[e.jsxs(W,{w:"100%",justify:{base:"center",lg:"space-between"},children:[e.jsx(Oe,{type:"outlineTab",tabList:oi,currentTab:l,handleChangeTab:m,wrapStyle:{h:"32px",p:"3px",borderRadius:"8px",flex:{base:"1",lg:"0 0 308px"}},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}}),!t&&e.jsx(Oe,{type:"outlineTab",tabList:ls,currentTab:d,handleChangeTab:a,wrapStyle:{h:"32px",p:"3px",borderRadius:"8px",flex:"0 0 128px"},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}})]}),e.jsxs(H,{w:"100%",align:"flex-start",children:[e.jsx(k,{color:"text_caption",fontSize:"24px",children:(n==null?void 0:n.num)!==void 0&&n!==null?Z(Jt(n.num)).gte("0.01")||Z(Jt(n.num)).equals("0")?`$${Ce(n==null?void 0:n.num,2)}`:"<$0.01":R==null?void 0:R.value}),e.jsx(k,{children:n!=null&&n.date?g:R==null?void 0:R.title}),t&&e.jsx(Oe,{type:"outlineTab",tabList:ls,currentTab:d,handleChangeTab:a,wrapStyle:{mt:"8px",h:"32px",p:"3px",borderRadius:"8px",w:"128px"},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}})]}),e.jsx(ne,{w:"100%",h:"340px",mt:"20px",children:e.jsxs(ne,{w:"100%",h:"100%",position:"relative",children:[i&&e.jsx(ne,{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%,-50%)",children:e.jsx(Dt,{})}),l==="TVL"?e.jsx(Ar,{data:r,onChangeValue:h=>c(h)}):e.jsx(fr,{data:r,onChangeValue:h=>c(h),pageFrom:"pools"})]})})]})}const pi=(t,l)=>({tokenAPrice:void 0,setTokenAPrice:s=>{t(()=>({tokenAPrice:s}))},tokenBPrice:void 0,setTokenBPrice:s=>{t(()=>({tokenBPrice:s}))},tokenAAmount:"",setTokenAAmount:s=>{t(()=>({tokenAAmount:s}))},tokenBAmount:"",setTokenBAmount:s=>{t(()=>({tokenBAmount:s}))},tokenAAmountUSD:"",setTokenAAmountUSD:s=>{t(()=>({tokenAAmountUSD:s}))},tokenBAmountUSD:"",setTokenBAmountUSD:s=>{t(()=>({tokenBAmountUSD:s}))},totalAmountUSD:"",setTotalAmountUSD:s=>{t(()=>({totalAmountUSD:s}))},tvlLoading:!0,setTvlLoading:s=>{t(()=>({tvlLoading:s}))},resetTvlInfo:()=>{t(()=>({tokenAPrice:void 0,tokenBPrice:void 0,tokenAAmount:"",tokenBAmount:"",tokenAAmountUSD:"",tokenBAmountUSD:"",totalAmountUSD:""}))}}),Qt=gs(pi);function gi(){Me();const{getBurnPositionAmountByPool:t}=Sr(),{apiPoolInfo:l,contractPoolInfo:s}=ue(),[d,x]=j.useState("0"),[r,y]=j.useState("0"),[p,i]=j.useState("0"),[o,n]=j.useState("0"),[c,f]=j.useState(!1),{poolAddress:S}=Se(),{tokenAPrice:v,tokenBPrice:R}=Qt(),U=async(g,m)=>{try{f(!0),console.log("🚀🚀🚀 ~ file: burn-position-amount 29 ~ getBurnAmount ~ getBurnAmount:");const{totalA:a,totalB:h}=await t(g,m);x(a),y(h),v&&i(Z(a).mul(v==null?void 0:v.price).toString()),R&&n(Z(h).mul(R==null?void 0:R.price).toString())}catch(a){console.log("🚀🚀🚀  ~ getBurnAmount ~ error:",a)}finally{f(!1)}};return nt(()=>{l&&(s!=null&&s.current_sqrt_price)&&U(l,s==null?void 0:s.current_sqrt_price)},[S,s==null?void 0:s.current_sqrt_price,v==null?void 0:v.price,R==null?void 0:R.price],{wait:500}),Z(d).gt(0)||Z(r).gt(0)?e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",bg:"bg_secondary",borderRadius:"16px",border:"1px solid",borderColor:"border",justify:"space-between",align:"flex-start",p:{base:"16px 8px 8px",lg:"20px 16px 20px 20px"},children:[e.jsxs(W,{children:[e.jsx(k,{fontSize:"16px",color:"text_caption",children:"Burned Liquidity"}),e.jsx(_r,{type:"burnedLiquidity"})]}),e.jsxs(be,{gap:"16px",flexDir:{base:l!=null&&l.isReverse?"column-reverse":"column",lg:l!=null&&l.isReverse?"row-reverse":"row"},w:{base:"100%",lg:"822px",xl:"862px"},children:[e.jsx(ds,{token:l==null?void 0:l.tokenA,amount:d,amountUSD:p,loading:c}),e.jsx(ds,{token:l==null?void 0:l.tokenB,amount:r,amountUSD:o,loading:c})]})]}):null}const ds=({token:t,amount:l,amountUSD:s,loading:d})=>e.jsxs(H,{flex:"1",align:"flex-start",gap:"16px",p:{base:"16px 8px",lg:"16px 20px"},borderRadius:"8px",bg:"background",border:"1px solid",borderColor:"border",children:[e.jsxs(W,{gap:"12px",children:[e.jsx(De,{imageUrl:t==null?void 0:t.logo_url,w:"28px",h:"28px"}),e.jsxs(H,{align:"flex-start",gap:"4px",children:[e.jsx(k,{color:"text_caption",fontSize:"16px",children:P(t==null?void 0:t.symbol,10)}),e.jsx(k,{fontSize:"12px",children:t==null?void 0:t.name})]})]}),e.jsx(me,{label:"Amount",labelStyle:{fontSize:"14px"},value:Vt(Wt(l,t==null?void 0:t.decimals)),valueStyle:{fontSize:"14px"},isLoading:d,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}}),e.jsx(me,{label:"Amount (USD)",labelStyle:{fontSize:"14px"},value:Z(s).gt("0")?`$${ms(Wt(s,t==null?void 0:t.decimals),2)}`:"--",valueStyle:{fontSize:"14px"},isLoading:d,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}})]}),mt=t=>t==="--"?"--":`${t}%`;function mi(){var f,S,v,R,U,g;const{apiPoolInfo:t,contractPoolInfo:l}=ue(),{getExplorerUrl:s}=Ot(),{poolAddress:d}=Se(),{tokenAAmount:x,tokenBAmount:r,tokenAAmountUSD:y,tokenBAmountUSD:p,totalAmountUSD:i,tvlLoading:o}=Qt(),n=j.useMemo(()=>{if(y&&i&&y!=="--"&&i!=="--"){const m=Zs(Z(y).div(i).mul(100).toString(),2);return m==="NaN"?"--":m}return"--"},[y,i]),c=j.useMemo(()=>n&&n!=="--"?Z(100).minus(n).toString():"--",[n]);return e.jsxs(H,{w:{base:"100%",lg:"420px",xl:"440px"},gap:{base:"20px",lg:"40px"},p:{base:"20px 8px 8px",lg:"20px 16px"},borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",minW:{base:"100%",lg:"420px"},maxW:{base:"100%",lg:"440px"},children:[e.jsxs(H,{gap:"20px",w:"100%",children:[e.jsx(W,{w:"100%",justify:"space-between",children:e.jsx(rt,{fontSize:"16px",fontWeight:"400",children:"Pool Info"})}),e.jsxs(Js,{templateColumns:{base:"repeat(1, 1fr)",lg:"repeat(2, 1fr)"},w:"100%",gap:{base:"20px",lg:"20px 36px"},children:[e.jsx(me,{label:"Pool Address",labelStyle:{fontSize:"14px",whiteSpace:"nowrap"},value:e.jsx(ws,{address:d||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(s(d,"poolAddress"))}),valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Tick Spacing",labelStyle:{whiteSpace:"nowrap",fontSize:"14px"},value:(t==null?void 0:t.tickSpacing)||"",valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Pool ID",labelStyle:{fontSize:"14px"},value:l!=null&&l.index||t!=null&&t.index?`#${(l==null?void 0:l.index)||(t==null?void 0:t.index)}`:"--",valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Fee Tier",labelStyle:{fontSize:"14px"},value:`${t==null?void 0:t.feeDisplay}`||"--",valueStyle:{fontSize:"14px"}})]})]}),e.jsxs(H,{gap:"20px",w:"100%",children:[e.jsx(W,{justify:"flex-start",w:"100%",children:e.jsx(rt,{fontSize:"16px",fontWeight:"400",children:"Pool Composition"})}),e.jsxs(H,{gap:"16px",w:"100%",children:[e.jsxs(W,{w:"100%",justify:"space-between",children:[e.jsxs(W,{gap:"12px",children:[e.jsx(De,{imageUrl:(f=t==null?void 0:t.displayTokenA)==null?void 0:f.logo_url,w:"28px",h:"28px",coinType:t!=null&&t.displayTokenA?(S=t==null?void 0:t.displayTokenA)==null?void 0:S.coin_type:""}),e.jsxs(H,{align:"flex-start",gap:"4px",children:[e.jsx(k,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:P((v=t==null?void 0:t.displayTokenA)==null?void 0:v.symbol,10)}),o?e.jsx(it,{h:"12px"}):e.jsx(k,{fontSize:"12px",fontWeight:"500",children:t!=null&&t.isReverse?mt(c):mt(n)})]})]}),e.jsx(ne,{w:"200px",children:e.jsx(vr,{value:Number(t!=null&&t.isReverse?c:n),size:"xs",h:"4px",borderRadius:"4px",bg:[n,c].includes("--")?"border":"quote_green",sx:{'div[role="progressbar"]':{bg:[n,c].includes("--")?"background":"primary"}}})}),e.jsxs(W,{gap:"12px",children:[e.jsxs(H,{align:"flex-end",gap:"4px",children:[e.jsx(k,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:P((R=t==null?void 0:t.displayTokenB)==null?void 0:R.symbol,10)}),o?e.jsx(it,{h:"12px"}):e.jsx(k,{fontSize:"12px",fontWeight:"500",children:t!=null&&t.isReverse?mt(n):mt(c)})]}),e.jsx(De,{imageUrl:(U=t==null?void 0:t.displayTokenB)==null?void 0:U.logo_url,w:"28px",h:"28px",coinType:t!=null&&t.displayTokenB?(g=t==null?void 0:t.displayTokenB)==null?void 0:g.coin_type:""})]})]}),e.jsxs(H,{w:"100%",flexDir:t!=null&&t.isReverse?"column-reverse":"column",gap:"16px",children:[e.jsx(os,{loading:o,token:t==null?void 0:t.tokenA,amount:x,amountUSD:y}),e.jsx(os,{loading:o,token:t==null?void 0:t.tokenB,amount:r,amountUSD:p})]})]})]})]})}const os=({token:t,amount:l,amountUSD:s,loading:d})=>{const{getExplorerUrl:x}=Ot();return t?e.jsxs(H,{w:"100%",p:{base:"16px 8px",lg:"16px 20px"},borderRadius:"8px",bg:"background",border:"1px solid",borderColor:"border",gap:"16px",children:[e.jsxs(W,{w:"100%",justify:"space-between",children:[e.jsxs(W,{gap:"12px",children:[e.jsx(De,{imageUrl:t==null?void 0:t.logo_url,w:"28px",h:"28px",coinType:t?t==null?void 0:t.coin_type:""}),e.jsxs(H,{align:"flex-start",gap:"4px",children:[e.jsx(k,{color:"text_caption",fontSize:"16px",children:P(t==null?void 0:t.symbol,10)}),e.jsx(k,{fontSize:"12px",children:t==null?void 0:t.name})]})]}),e.jsx(ws,{address:(t==null?void 0:t.coin_type)||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(x(t==null?void 0:t.coin_type,"coin"))})]}),e.jsx(me,{label:"Amount",labelStyle:{fontSize:"14px"},value:Vt(Wt(l||"0",t.decimals)),valueStyle:{fontSize:"14px"},isLoading:d,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}}),e.jsx(me,{label:"Amount (USD)",labelStyle:{fontSize:"14px"},value:s&&s!=="--"?`$${Ce(s)}`:"--",valueStyle:{fontSize:"14px"},isLoading:d,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}})]}):null};function yi(){return e.jsxs(H,{w:"100%",gap:"16px",minW:{base:"100%",lg:"1024px"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",children:[e.jsx(ui,{}),e.jsx(mi,{})]}),e.jsx(gi,{}),e.jsx(di,{})]})}function hi(){const t=vt(),{posBaseListLoading:l,posBaseListGroupByPool:s}=Rs(),{apiPoolInfo:d,manualRefresh:x}=ue(),{currentAccount:r,onWalletModal:y}=wt(),{getPositionBaseList:p,getPosRelatedData:i}=wr(),[o,n]=j.useState(""),{poolAddress:c}=Se(),f=async v=>{const R=await p(v);Array.isArray(R)&&i(R),typeof R=="string"&&n(R)};j.useEffect(()=>{r!=null&&r.address&&f(r==null?void 0:r.address)},[r==null?void 0:r.address]),j.useEffect(()=>{x&&(r!=null&&r.address)&&f(r==null?void 0:r.address)},[x]),kr({onRpcChange:()=>{r!=null&&r.address&&f(r==null?void 0:r.address)}});const S=j.useMemo(()=>{if(c){const v=s[c.toLowerCase()||""];return v?v==null?void 0:v.list:[]}return[]},[c,JSON.stringify(s)]);return e.jsx(H,{minW:{base:"100%",lg:"1024px"},children:r!=null&&r.address?l?[{},{}].map((v,R)=>e.jsx(Lr,{},R)):S&&(S==null?void 0:S.length)>0?S==null?void 0:S.map((v,R)=>e.jsx(Tr,{positionInfo:v},v==null?void 0:v.posId)):o?e.jsx(st,{type:"nodata",text:o}):e.jsx(st,{type:"nodata",text:"You don't have positions for this pool",children:e.jsx(fe,{borderRadius:"8px",mt:"8px",fontWeight:"500",w:"120px",h:"28px",fontSize:"12px",onClick:()=>t(`/liquidity?tab=deposit&poolAddress=${d==null?void 0:d.poolAddress}`),children:"Create Position"})}):e.jsx(st,{type:"nowallet",onboard:()=>y(!0)})})}const bi=(t,l)=>({fromAmount:"",setFromAmount:s=>{t(()=>({fromAmount:s}))},fromAmountValue:"",setFromAmountValue:s=>{t(()=>({fromAmountValue:s}))},toAmount:"",setToAmount:s=>{t(()=>({toAmount:s}))},toAmountValue:"",setToAmountValue:s=>{t(()=>({toAmountValue:s}))},liquidityAmount:"",setLiquidityAmount:s=>{t(()=>({liquidityAmount:s}))},tokenMaxA:"",setTokenMaxA:s=>{t(()=>({tokenMaxA:s}))},tokenMaxB:"",setTokenMaxB:s=>{t(()=>({tokenMaxB:s}))},byAmountIn:!0,setByAmountIn:s=>{t(()=>({byAmountIn:s}))},isTokenA:!0,setIsTokenA:s=>{t(()=>({isTokenA:s}))},percentMap:{percentA:"0",percentB:"0"},setPercentMap:s=>{t(()=>({percentMap:s}))},isFullRange:!1,setIsFullRange:s=>{t(()=>({isFullRange:s}))},fromToken:void 0,setFromToken:s=>{t(()=>({fromToken:s}))},fromTokenLock:!1,setFromTokenLock:s=>{t(()=>({fromTokenLock:s}))},toToken:void 0,setToToken:s=>{t(()=>({toToken:s}))},toTokenLock:!1,setToTokenLock:s=>{t(()=>({toTokenLock:s}))},totalAmount:void 0,setTotalAmount:s=>{t(()=>({totalAmount:s}))},autoStakePosition:!1,setAutoStakePosition:s=>{t(()=>({autoStakePosition:s}))},isFarmRewardsRange:!1,setIsFarmRewardsRange:s=>{t(()=>({isFarmRewardsRange:s}))},resetAddLiquidity:()=>{t(()=>({isFarmRewardsRange:!1,autoStakePosition:!1,totalAmount:void 0,fromTokenLock:!1,fromToken:void 0,toTokenLock:!1,toToken:void 0,isFullRange:!1,percentMap:{percentA:"0",percentB:"0"},fromAmount:"",toAmount:"",fromAmountValue:"",toAmountValue:"",liquidityAmount:"",byAmountIn:!0,isTokenA:!0}))}}),Ee=gs(bi);function fi(t){var A,z;const{onClose:l,onSubmit:s,data:{feeTier:d}}=t,{fromToken:x,toToken:r,fromAmount:y,toAmount:p,totalAmount:i,percentMap:o,fromTokenLock:n,toTokenLock:c}=Ee(),{lowerTickData:f,upperTickData:S}=ze(),{currentPriceData:v,apiPoolInfo:R}=ue(),{setIsChecked:U}=Ut(),[g,m]=j.useState(!0),a=j.useMemo(()=>{var B;return((B=R==null?void 0:R.tokenA)==null?void 0:B.coin_type)===(x==null?void 0:x.coin_type)?!g:!!g},[R,x,r,g]),h=j.useMemo(()=>g?`${P(r==null?void 0:r.symbol,10)} per ${P(x==null?void 0:x.symbol,10)}`:`${P(x==null?void 0:x.symbol,10)} per ${P(r==null?void 0:r.symbol)}`,[g,x==null?void 0:x.symbol,r==null?void 0:r.symbol]),F=Es(()=>{s(),l()},1e3,{leading:!0,trailing:!1}),{notifiStatus:C}=Ut();return e.jsxs(ys,{isOpen:!0,onClose:()=>{l(),U(!1)},isCentered:!0,children:[e.jsx(hs,{}),e.jsxs(bs,{children:[e.jsx(fs,{children:e.jsx(rt,{fontWeight:"500",fontSize:"16px",children:"Add Liquidity"})}),e.jsx(Ps,{}),e.jsx(js,{textAlign:"center",p:"0px",children:e.jsxs(H,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(W,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(W,{children:[e.jsx(As,{coinACoinType:x==null?void 0:x.coin_type,coinBCoinType:r==null?void 0:r.coin_type,coinAIconUrl:x==null?void 0:x.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(k,{fontSize:"16px",color:"text_caption",textAlign:"left",children:`${P(x==null?void 0:x.symbol,10)} - ${P(r==null?void 0:r.symbol,10)}`})]}),e.jsx(Is,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(W,{gap:"12px",children:[e.jsx(k,{whiteSpace:"nowrap",children:"Fee Tier"}),e.jsx(k,{color:"primary",children:d==null?void 0:d.feeDisplay})]})})]}),e.jsx(Mr,{coinA:{amount:y,...x},coinB:{amount:p,...r}}),e.jsxs(ne,{w:"100%",children:[e.jsxs(W,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(k,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(zr,{isActive:!n&&!c,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(W,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(k,{children:"Current Price"}),e.jsx(k,{as:"span",color:"text_caption",children:yt(a?v.reverseCurrentPrice:v==null?void 0:v.currentPrice,6)}),e.jsx(k,{children:h}),e.jsx(fe,{variant:"unstyled",onClick:()=>m(!g),children:e.jsx(Be,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(W,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(xs,{title:"Min Price",price:yt(a?S==null?void 0:S.reversePrice:f==null?void 0:f.price,6),perText:h}),e.jsx(Ss,{orientation:"vertical",h:"40px"}),e.jsx(xs,{title:"Max Price",price:yt(a?f==null?void 0:f.reversePrice:S==null?void 0:S.price,6),perText:h})]})]}),e.jsx(me,{isLoading:!1,label:"Deposit Ratio",value:`${o[(x==null?void 0:x.coin_type)===((A=R==null?void 0:R.tokenA)==null?void 0:A.coin_type)?"percentA":"percentB"]}% ${P(x==null?void 0:x.symbol,10)} / ${o[(r==null?void 0:r.coin_type)===((z=R==null?void 0:R.tokenA)==null?void 0:z.coin_type)?"percentA":"percentB"]}% ${P(r==null?void 0:r.symbol,10)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx(me,{isLoading:!1,label:"Total Amount",value:i&&+i?Gt(i):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),!n&&!c&&!((f==null?void 0:f.price)==="0"&&(S==null?void 0:S.price)==="∞")&&C=="authenticated"&&e.jsx(Er,{subscriptionSource:"AddLiquidity",title:"Range alerts for this position",description:"Subscribe to receive alerts on email, SMS, or Telegram when the price for this pool moves out of your selected range.",wrapStyle:{bg:"bg_secondary",borderRadius:"12px"}}),e.jsx(fe,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:F,children:"Add Liquidity"})]})})]})]})}const xs=({title:t,price:l,perText:s})=>e.jsxs(H,{flex:"1",children:[e.jsx(k,{children:t}),e.jsx(k,{color:"text_caption",children:l}),e.jsx(k,{children:s})]});function ji(){return{getLeverage:(l,s)=>l&&s&&l!=="0"&&s!=="∞"?ms(1/(1-Number(Z(l).div(s).toNumber()**.25)),2)+"x":"1x"}}function Ai(t,l){const{preAdd:s,getClmmCreateAddData:d,getFarmsCreateAddData:x}=Or(),[r,y]=j.useState(!1),{currentPriceData:p,apiPoolInfo:i,contractPoolInfo:o}=ue(),{lowerTickData:n,upperTickData:c}=ze(),{signAndExecuteTransaction:f,getTransactionStatus:S,transactionSuccess:v}=Ur(),{mevProtect:R,maxCapForGas:U,transactionMode:g,customGasPrice:m}=qr(),[a,h]=j.useState(!1),[F,C]=j.useState(!1),[A,z]=j.useState(""),{transactionConfirmation:B}=Hr(),{fromAmount:V,setFromAmount:O,fromAmountValue:I,setFromAmountValue:ee,toAmount:Y,setToAmount:J,toAmountValue:ce,setToAmountValue:L,byAmountIn:E,setByAmountIn:M,isTokenA:T,setIsTokenA:G,percentMap:$,setPercentMap:Q,isFullRange:q,setIsFullRange:N,fromToken:u,setFromToken:w,toToken:b,setToToken:te,totalAmount:Ye,setTotalAmount:pe,fromTokenLock:le,setFromTokenLock:X,toTokenLock:se,setToTokenLock:ye,setTokenMaxA:Ge,setTokenMaxB:at,tokenMaxA:Ze,tokenMaxB:Ct,autoStakePosition:ct,liquidityAmount:Je,setLiquidityAmount:kt}=Ee(),{getTokenAmountValue:_e}=_s();Pt(()=>{var D,xe;i&&G(((D=i==null?void 0:i.displayTokenA)==null?void 0:D.coin_type)===((xe=i==null?void 0:i.tokenA)==null?void 0:xe.coin_type))},[i]);const{isWhiteQuoteToken:Lt}=Ts(),{notifiSubscription:lt}=Vr(),{isChecked:Pe}=Ut();nt(()=>{if(q){Q({percentA:"50",percentB:"50"});return}if(i&&(i!=null&&i.tokenA)&&(i!=null&&i.tokenB)&&typeof(o==null?void 0:o.current_tick_index)=="number"&&(n==null?void 0:n.tick)!==void 0&&(c==null?void 0:c.tick)!==void 0&&p.currentSqrtPrice){if(ie(n.tick).lte(o.current_tick_index)&&ie(c.tick).gt(o.current_tick_index)){const D=Lt(i.tokenA.coin_type)?i.tokenA:i.tokenB,xe=D.coin_type===i.tokenA.coin_type,he=s({amount:ut("1",D.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:xe,lowerTick:n==null?void 0:n.tick,upperTick:c==null?void 0:c.tick,curSqrtPrice:p.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0}),ke=$r(he.coinAmountA,he.coinAmountB,p==null?void 0:p.currentPrice,q);Q(ke);return}if(ie(n.tick).gt(o.current_tick_index)){Q({percentA:"100",percentB:"0"});return}if(ie(c.tick).lte(o.current_tick_index)){Q({percentA:"0",percentB:"100"});return}}},[JSON.stringify(i),p,n==null?void 0:n.tick,c==null?void 0:c.tick,q],{wait:300});const dt=({amount:D,isTokenA:xe,isFullRange:he})=>{var ke,Ue,He,Ne;if(i&&(i!=null&&i.tokenA)&&(i!=null&&i.tokenB)&&Object.keys(p).length>0&&(n==null?void 0:n.tick)!==void 0&&(c==null?void 0:c.tick)!==void 0&&u&&b){let K;if(typeof(o==null?void 0:o.current_tick_index)=="number"&&ie(n==null?void 0:n.tick).lte(o==null?void 0:o.current_tick_index)&&ie(c==null?void 0:c.tick).gt(o==null?void 0:o.current_tick_index))K=s({amount:ut(D&&+D?D+"":"1",E?u==null?void 0:u.decimals:b==null?void 0:b.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:xe,lowerTick:n==null?void 0:n.tick,upperTick:c==null?void 0:c.tick,curSqrtPrice:p.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0});else if(le&&!se){const ae=(b==null?void 0:b.coin_type)===((ke=i==null?void 0:i.tokenA)==null?void 0:ke.coin_type);K=s({amount:ut(D?D+"":"1",b==null?void 0:b.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:ae,lowerTick:n==null?void 0:n.tick,upperTick:c==null?void 0:c.tick,curSqrtPrice:p.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0})}else if(se&&!le){const ae=(u==null?void 0:u.coin_type)===((Ue=i==null?void 0:i.tokenA)==null?void 0:Ue.coin_type);K=s({amount:ut(D?D+"":"1",u==null?void 0:u.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:ae,lowerTick:n==null?void 0:n.tick,upperTick:c==null?void 0:c.tick,curSqrtPrice:p.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0})}else le&&se&&(K=xe?{coinAmountA:D?D+"":"1",coinAmountB:"",tokenMaxA:D?D+"":"1",tokenMaxB:""}:{coinAmountA:"",coinAmountB:D?D+"":"1",tokenMaxA:"",tokenMaxB:D?D+"":"1"});if(Ge(K==null?void 0:K.tokenMaxA),at(K==null?void 0:K.tokenMaxB),D)if(ie(D).gt("0"))if(E){const ae=(b==null?void 0:b.coin_type)===((He=i==null?void 0:i.tokenA)==null?void 0:He.coin_type)?K==null?void 0:K.coinAmountA:K==null?void 0:K.coinAmountB,je=_e(u==null?void 0:u.coin_type,D+""),Ae=_e(b==null?void 0:b.coin_type,ae),Le=ie(je).plus(Ae).toString();console.log(ae,je,Ae,Le,"_totalAmountValue"),J(ae||""),ee(je),L(Ae),pe(Le)}else{const ae=(u==null?void 0:u.coin_type)===((Ne=i==null?void 0:i.tokenA)==null?void 0:Ne.coin_type)?K==null?void 0:K.coinAmountA:K==null?void 0:K.coinAmountB,je=_e(u==null?void 0:u.coin_type,ae),Ae=_e(b==null?void 0:b.coin_type,D+""),Le=ie(je).plus(Ae).toString();console.log(ae,je,Ae,Le,"_totalAmountValue"),ee(je),L(Ae),O(ae||""),pe(Le)}else E?(J(""),ee(""),L(""),pe("")):(O(""),ee(""),L(""),pe(""));else O(""),J(""),ee(""),L(""),pe("");K&&kt((K==null?void 0:K.liquidityAmount)||"")}};nt(()=>{dt({amount:E?V:Y,isTokenA:T,isFullRange:q})},[JSON.stringify(i),p,n==null?void 0:n.tick,c==null?void 0:c.tick,V,Y,E,T,le,se,q],{wait:300});const _=(D,xe,he)=>{M(xe),xe?O(D):J(D),G(he!==void 0?he:!1)},{balanceInfo:de}=At(u),{balanceInfo:ve}=At(b);Pt(()=>{var D,xe;G(E?(u==null?void 0:u.coin_type)===((D=i==null?void 0:i.tokenA)==null?void 0:D.coin_type):(b==null?void 0:b.coin_type)===((xe=i==null?void 0:i.tokenA)==null?void 0:xe.coin_type))},[i,E,u,b]),j.useEffect(()=>{(n==null?void 0:n.tick)===bt.getMinIndex(Number((n==null?void 0:n.tickSpacing)||0))&&(c==null?void 0:c.tick)===bt.getMaxIndex(Number((c==null?void 0:c.tickSpacing)||0))?N(!0):N(!1)},[n==null?void 0:n.tick,c==null?void 0:c.tick]),j.useEffect(()=>{(o==null?void 0:o.current_tick_index)!==void 0&&oe(n)&&oe(c)&&(ie(n==null?void 0:n.tick).gte(ie(c.tick))?(X(!0),ye(!0)):ie(n==null?void 0:n.tick).gt(o==null?void 0:o.current_tick_index)?(X(!l),ye(!!l)):ie(c.tick).lte(o==null?void 0:o.current_tick_index)?(X(!!l),ye(!l)):(X(!1),ye(!1)))},[n==null?void 0:n.tick,c==null?void 0:c.tick,o,l]);const{currentAccount:qe,onWalletModal:$e}=wt(),We=Es(()=>{qe?h(!0):$e(!0)},300,{leading:!0,trailing:!1}),Ie=()=>{O(""),J(""),ee(""),L(""),pe("")},{fetchAccountBalance:Gs}=Ls();return{percentMap:$,handleAmountChange:_,fromToken:u,setFromToken:w,toToken:b,setToToken:te,byAmountIn:E,setByAmountIn:M,fromAmount:V,fromAmountValue:I,setFromAmount:O,toAmount:Y,toAmountValue:ce,setToAmount:J,liquidityAmount:Je,fromBalanceInfo:de,toBalanceInfo:ve,totalAmount:Ye,fromTokenLock:le,toTokenLock:se,handleAdd:We,confirmModalOpen:a,setConfirmModalOpen:h,nftOpen:F,setNftOpen:C,relatedPosId:A,handleSubmit:async()=>{var Ae,Le,Xt;const D=E?V:Y,xe=E?u==null?void 0:u.decimals:b==null?void 0:b.decimals,he=ie(D).mul(er.pow(10,xe)).toString(),ke=E&&(u==null?void 0:u.coin_type)===((Ae=i==null?void 0:i.tokenA)==null?void 0:Ae.coin_type)?!0:(b==null?void 0:b.coin_type)===((Le=i==null?void 0:i.tokenA)==null?void 0:Le.coin_type)&&!E;let Ue,He;const Ne=n.tick,K=c.tick,ae=o==null?void 0:o.current_tick_index;Ne!==void 0&&K!==void 0&&ae!==void 0&&(ae>=Ne&&ae<=K?(Ue=ke?he:Ze,He=ke?Ct:he):ae>K?(Ue=0,He=he):ae<Ne&&(Ue=he,He=0));let je=[];if(o!=null&&o.index){const{rewarder_infos:ge}=o;je=(ge==null?void 0:ge.length)>0&&(ge==null?void 0:ge.map(et=>et.coinAddress))||[]}try{const ge={poolAddress:o==null?void 0:o.poolAddress,coinTypeA:o==null?void 0:o.coinTypeA,coinTypeB:o==null?void 0:o.coinTypeB,amountA:Ue,amountB:He,fixAmountA:ke,lowerTick:Ne,upperTick:K,currentSqrtPrice:o==null?void 0:o.current_sqrt_price,rewarderCoinTypes:je,farmsPoolId:i==null?void 0:i.farmsPoolAddress},et={getShowInfo:(re,Ve)=>{const ot=!le&&!se?`Add ${V} ${u==null?void 0:u.symbol} and ${Y} ${b==null?void 0:b.symbol}`:se?le?"Add Liquidity":`Add ${V} ${u==null?void 0:u.symbol}`:`Add ${Y} ${b==null?void 0:b.symbol}`,xt={modalDescriptionText:ot,toastTitleText:ot};if(re==="success"){let Bt=V,Mt=Y;Ve&&(Bt=It(Ve,u)||V,Mt=It(Ve,b)||Y);const Yt=!le&&!se?`Add ${Bt} ${u==null?void 0:u.symbol} and ${Mt} ${b==null?void 0:b.symbol}`:!le&&se?`Add ${Bt} ${u==null?void 0:u.symbol}`:!se&&le?`Add ${Mt} ${b==null?void 0:b.symbol}`:"Add Liquidity";xt.toastDescriptionContent=Yt,xt.modalDescriptionText=Yt,xt.toastTitleText="Supplied Successful"}return xt}};B(et);let Tt,Ft;if(ct){const re=await x(ge);Tt=re==null?void 0:re.tx,Ft=re==null?void 0:re.msafeParams}else{const re=await d(ge);Tt=re==null?void 0:re.tx,Ft=re==null?void 0:re.msafeParams}let we=await f(Tt,et,{useDevInspect:!0,useMev:R,showSuccessModal:!1,useFastMode:g==="Fast Mode",maxCapForGas:U,customGasPrice:m,msafeParams:Ft});if(we){console.log("🚀🚀🚀 ~ file: useAddLiquidity.ts:403 ~ handleSubmit ~ res:",we),console.log("🚀🚀🚀 ~ file: useAddLiquidity.ts:411 ~ handleSubmit ~ isChecked:",Pe),((Xt=we==null?void 0:we.events)==null?void 0:Xt.length)===0&&(we=await S(we.digest));const{posId:re,farmsPosId:Ve}=tr(we);if(console.log("🚀 ~ file: useAddLiquidity.ts:436 ~ handleSubmit ~ posId:",{posId:re,farmsPosId:Ve}),re?(C(!0),z(Ve||re)):v(et),Pe){const ot={subscriptionSource:"AddLiquidity",events:we.events};lt(ot)}Gs(),Ie(),t()}}catch(ge){throw console.error(ge,"handleSubmit ~ error"),new Error(ge)}}}}function Si(){const{fromAmount:t,toAmount:l,fromToken:s,toToken:d,fromTokenLock:x,toTokenLock:r,liquidityAmount:y}=Ee(),{currentAccount:p}=wt(),{balanceInfo:i}=At(s),{balanceInfo:o}=At(d),n=j.useMemo(()=>{const c={text:"Add Liquidity",disabled:!1};return p!=null&&p.address?!x&&!r&&(!t||!l||t&&!+t||l&&!+l)||x&&!r&&(!l||l&&!+l)||r&&!x&&(!t||t&&!+t)?(c.text="Enter an amount",c.disabled=!0,c):t&&+t&&Z(t).gt((i==null?void 0:i.balanceFormat)||0)?(c.disabled=!0,c.text=`Insufficient ${P(s==null?void 0:s.symbol,10)} Balance`,c):l&&+l&&Z(l).gt((o==null?void 0:o.balanceFormat)||0)?(c.disabled=!0,c.text=`Insufficient ${P(d==null?void 0:d.symbol,10)} Balance`,c):((!x&&!r&&(!t||!l)||Z(y).lte("0"))&&(c.disabled=!0),c):(c.text="Connect Wallet",c.disabled=!1,c)},[p==null?void 0:p.address,t,l,i==null?void 0:i.balanceDisplay,o==null?void 0:o.balanceDisplay,s,d,x,r,y]);return{btnText:n.text,btnDisabled:n.disabled}}function _i({onClose:t,posId:l,tokenA:s,tokenB:d,fee:x,isReverse:r}){const y=vt(),[p,i]=j.useState(!0),{lowerTickData:o,upperTickData:n}=ze();return j.useLayoutEffect(()=>{r&&i(!1)},[r]),e.jsxs(ys,{isOpen:!0,autoFocus:!1,returnFocusOnClose:!1,onClose:t,isCentered:!0,children:[e.jsx(hs,{}),e.jsxs(bs,{w:"400px",children:[e.jsx(fs,{children:e.jsxs(W,{justify:"space-between",w:"100%",children:[e.jsx(k,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Open position successful"}),e.jsx(fe,{onClick:t,variant:"unstyled",p:"0",minW:"unset",minH:"unset",w:"20px",h:"20px",children:e.jsx(Be,{xlinkHref:"#icon-icon_close"})})]})}),e.jsx(js,{children:e.jsxs(H,{gap:"36px",children:[e.jsxs(H,{gap:"16px",bg:"center / contain no-repeat url('/images/active-sui.gif') ",w:"240px",h:"240px",justify:"center",border:"1px solid",borderColor:"border",borderRadius:"16px",children:[e.jsx(As,{coinAIconUrl:s==null?void 0:s.logo_url,coinBIconUrl:d==null?void 0:d.logo_url,coinACoinType:s==null?void 0:s.coin_type,coinBCoinType:d==null?void 0:d.coin_type,w:"48px",h:"48px"}),e.jsxs(k,{fontSize:"20px",fontWeight:"500",color:"text_caption",lineHeight:"28px",children:[P(s==null?void 0:s.symbol,10)," - ",P(d==null?void 0:d.symbol,10)]}),e.jsxs(W,{bg:"bg_secondary",p:"8px 12px",border:"1px solid",borderColor:"border",borderRadius:"12px",children:[e.jsx(k,{fontSize:"14px",children:"Fee tier"}),e.jsx(k,{fontSize:"14px",color:"text_highlight",children:x})]})]}),e.jsxs(H,{w:"100%",justify:"center",borderRadius:"8px",border:"1px solid",borderColor:"border",bg:"input_bg",p:"16px 8px",children:[e.jsxs(k,{color:"text_caption",whiteSpace:"nowrap",children:[p?Ce(o==null?void 0:o.price,6):Ce(n==null?void 0:n.reversePrice,6)," - ",p?Ce(n==null?void 0:n.price,6):Ce(o==null?void 0:o.reversePrice,6)]}),e.jsxs(W,{children:[e.jsxs(W,{gap:"0",children:[e.jsx(k,{color:"primary_gray",children:P(p?r?s==null?void 0:s.symbol:d==null?void 0:d.symbol:r?d==null?void 0:d.symbol:s==null?void 0:s.symbol,10)}),e.jsx(k,{color:"primary_gray",children:" per "}),e.jsx(k,{color:"primary_gray",children:P(p?r?d==null?void 0:d.symbol:s==null?void 0:s.symbol:r?s==null?void 0:s.symbol:d==null?void 0:d.symbol,10)})]}),e.jsx(Be,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:c=>{Kt(c),i(!p)}})]})]})]})}),e.jsx(sr,{p:"20px 0 0",children:e.jsx(fe,{flex:"1",onClick:()=>y(`/position-detail/${l}`),h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",children:"View Detail"})})]})]})}function Hs({perText:t,direct:l,minPriceData:s,maxPriceData:d,isFullRange:x=!1}){const{tickDataLoading:r}=ze(),{handleAddPrice:y,handleSubPrice:p,setTickDataBasedOnPrice:i}=Rt();return e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(ss,{title:"Min Price",perText:t,data:s,direct:l,loading:r,handleAddPrice:y,handleSubPrice:p,setTickDataBasedOnPrice:i,isFullRange:x}),e.jsx(ss,{title:"Max Price",perText:t,data:d,direct:l,loading:r,handleAddPrice:y,handleSubPrice:p,setTickDataBasedOnPrice:i,isFullRange:x})]})}const Ns=({minPrice:t,maxPrice:l,perText:s,checked:d,onChange:x,loading:r})=>e.jsxs(W,{w:"100%",justify:{base:"space-between",lg:"center"},align:{base:"flex-start",lg:"center"},p:{base:"0 12px",lg:"0"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},children:[e.jsxs(W,{children:[e.jsx(Cs,{tooltip:e.jsxs(ne,{as:"div",lineHeight:"20px",fontSize:"12px",children:["Farm reward range: Only liquidity within this range is eligible to receive farming rewards of the pool.  ",e.jsx(ne,{as:"a",color:"primary",onClick:y=>{Kt(y),window.open("https://medium.com/@CetusProtocol/cetus-new-farms-everything-you-should-know-about-it-c6b60e6a6ae5")},children:"Learn More"})]})}),e.jsx(k,{children:"Farm rewards range"})]}),e.jsxs(W,{children:[r?e.jsx(it,{w:"120px",h:"14px"}):e.jsxs(k,{color:"primary_yellow",children:[t," - ",l]}),e.jsx(k,{children:s})]})]}),e.jsx(Ht,{isChecked:d,onChange:x})]}),Vs=({disabled:t,checked:l,onChange:s})=>e.jsxs(W,{p:{base:"20px 8px",lg:"24px 24px 24px 16px"},border:{base:"none",lg:"1px solid"},borderColor:{base:"transparent",lg:"border"},borderRadius:{base:"0 0 20px 20px",lg:"20px"},bg:"bg_six",gap:"12px",children:[e.jsx(Cs,{flex:"0 0 24px",h:"24px"}),e.jsx(k,{lineHeight:"20px",color:"text_caption",children:"Automatically stake your position into the farm to enjoy higher yield."}),t?e.jsx(ht,{tooltip:e.jsxs(H,{gap:"4px",align:"flex-start",children:[e.jsx(k,{fontSize:"12px",children:"Farming rewards only available"}),e.jsx(k,{fontSize:"12px",children:"for active positions."})]}),placement:"top",maxW:"198px",children:e.jsx(Ht,{isChecked:l,disabled:t,onChange:s})}):e.jsx(Ht,{isChecked:l,disabled:t,onChange:s})]}),vi=[{label:"24H",key:"24_h"},{label:"7D",key:"7_d"},{label:"30D",key:"30_d"}];function Os({direct:t,rangeMap:l,wrapStyle:s={}}){const[d,x]=j.useState({type:"30D",key:"30_d"}),{minPriceForDate:r,maxPriceForDate:y,setMinPriceForDate:p,setMaxPriceForDate:i}=ue();j.useEffect(()=>{let n="";if(oe(l)){const f=l[`before_${d==null?void 0:d.key}_contract_price_lowest`],S=t?f:Z(1).div(f).toString();n=Ce(S,6)}else n="-";p(n);let c="";if(oe(l)){const f=l[`before_${d==null?void 0:d.key}_contract_price_highest`],S=t?f:Z(1).div(f).toString();c=Ce(S,6)}else c="-";i(c)},[t,d.key,l]);const{isApp:o}=Me();return e.jsxs(W,{w:"100%",justify:"space-between",...s,children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},align:{base:"flex-start",lg:"center"},children:[e.jsxs(W,{children:[e.jsx(Xe,{borderRadius:"4px",border:"1px solid",borderColor:"border",w:"20px",h:"20px",color:"text_caption",children:e.jsx(Ss,{w:"14px",border:"1px dashed"})}),e.jsxs(k,{fontSize:"12px",whiteSpace:"nowrap",children:[d==null?void 0:d.type," Price Range"]})]}),e.jsxs(k,{color:"text_caption",fontSize:"12px",lineHeight:"12px",h:"12px",children:[t?r:y," - ",t?y:r]})]}),e.jsx(Oe,{type:"outlineTab",tabList:vi,currentTab:d,handleChangeTab:n=>{x({type:n.label,key:n.key})},isActive:(n,c)=>n.key===c.key,wrapStyle:{h:o?"28px":"20px",p:"1px",border:"1px solid",borderColor:"border",borderRadius:{base:"8px",lg:"4px"},gap:"0px",w:"auto"},itemStyle:{h:o?"24px":"16px",p:"2px 8px",fontSize:"12px",borderRadius:"4px",flex:1}})]})}function wi(){const{fetchByApi:t}=Nt(),[l,s]=j.useState(""),d=async i=>{var o,n,c,f;try{const v=await t(pr,"GET",{pool:i}),R=((n=(o=v==null?void 0:v.list)==null?void 0:o[0])==null?void 0:n.recommend_ranges)||{},U=((f=(c=v==null?void 0:v.list)==null?void 0:c[0])==null?void 0:f.type)||"";console.log("🚀🚀🚀 ~ getRecommendRanges ~ type:",U);const g={};if(R)for(const m in R){const a=R[m];(a!=null&&a.lower||a!=null&&a.upper)&&(g[m]={lower:a.lower,upper:a.upper})}return{ranges:g,type:U}}catch(S){return console.error("Error in getRecommendRanges:",S),{ranges:{},type:""}}},x=(i,o)=>({default:{lower:i,upper:o,sort:3}}),r=i=>({"full range":{lower:bt.getMinIndex(i),upper:bt.getMaxIndex(i),sort:2}}),y=(i,o,n)=>{const c=Z(n).mul(o==="unstable"?2:3).toNumber(),f=rr(Number(i),Number(n));return{custom:{lower:Z(f).sub(c).toNumber(),upper:Z(f).add(c).toNumber(),sort:1}}};return{getRecommendRanges:d,getRecommendRangesList:async i=>{try{const o=i.farmsEffectTickLower&&i.farmsEffectTickUpper?x(i.farmsEffectTickLower,i.farmsEffectTickUpper):null,n=i.farmsEffectTickLower&&i.farmsEffectTickUpper?{ranges:{},type:""}:await d(i.poolAddress);s(n.type);const c=r(i.tickSpacing),f=y(i.currentTick,n.type,i.tickSpacing),S={...o,...n.ranges,...c,...f},v=Object.entries(S).map(([R,U])=>({key:R,...U})).sort((R,U)=>U.sort-R.sort);return oe(n.ranges)||oe(o)?{rangeList:v,error:!1}:{rangeList:v,error:!0}}catch(o){return console.error("Error in getRecommendRangesList:",o),{rangeList:[],error:!0}}},poolType:l}}const qt=(t,l=!1)=>{switch(t){case"passive":return{name:"Conservative",image:l?"img_conservative_sel@2x.png":"img_conservative_nor@2x.png"};case"active":return{name:"Active",image:l?"img_active_sel@2x.png":"img_active_nor@2x.png"};case"full range":return{name:"Full Range",image:l?"img_fullrange_sel@2x.png":"img_fullrange_nor@2x.png"};case"custom":return{name:"Custom",image:l?"img_custom_sel@2x.png":"img_custom_nor@2x.png"};case"suggested":return{name:"Stable",image:l?"img_stable_sel@2x.png":"img_stable_nor@2x.png"};default:return{name:"Default",image:l?"img_stable_sel@2x.png":"img_stable_nor@2x.png"}}},Ri=t=>{switch(t){case"passive":return"Lower yields and lower impermanent loss. Less frequent rebalancing.";case"active":return"Higher yields but higher impermanent loss potentially. Requires frequent rebalancing.";case"full range":return"Full range positions are active all the time with no need to be rebalanced but may earn less fees than concentrated liquidity.";case"custom":return"Recommended only if you understand how concentrated liquidity works.";case"suggested":return"Stable range according to the price history of last 7 days.";default:return"The default range of this pool is set following the real-time valid range of its farm."}},Ci={1:"100%",2:"50%",3:"33.33%",4:"50%"};function Ds(t){const{getRecommendRangesList:l}=wi(),[s,d]=j.useState(),{poolAddress:x,currentTick:r,tickSpacing:y,farmsEffectTickLower:p,farmsEffectTickUpper:i}=t;Me();const{handleInitTickData:o}=Rt(),{apiPoolInfo:n,currentRange:c,setCurrentRange:f}=ue(),{lowerTickData:S,upperTickData:v,setLowerTickData:R,setUpperTickData:U,setTickDataLoading:g,tickDataLoading:m}=ze(),a=async()=>{var h,F,C;try{c||g(!0);const{rangeList:A,error:z}=await l(t);if(d(A),z){if(f("custom"),!c&&(n!=null&&n.tokenA)&&(n!=null&&n.tokenB)){const B=A.find(V=>V.key==="custom");B&&o(B==null?void 0:B.lower,B==null?void 0:B.upper,n)}}else f((h=A[0])==null?void 0:h.key),!c&&(n!=null&&n.tokenA)&&(n!=null&&n.tokenB)&&o((F=A[0])==null?void 0:F.lower,(C=A[0])==null?void 0:C.upper,n)}catch(A){console.error(A)}finally{g(!1)}};return nt(()=>{x&&r!==void 0&&y!==void 0&&a()},[x,y],{wait:500}),j.useEffect(()=>{if(s&&s.length>0&&oe(S)&&oe(v)){const h=s==null?void 0:s.find(F=>Z(F.lower).eq(Z(S==null?void 0:S.tick))&&Z(F.upper).eq(Z(v==null?void 0:v.tick)));h?h.key!==c&&f(h.key):f("custom")}},[S==null?void 0:S.tick,v==null?void 0:v.tick,s]),e.jsx(e.Fragment,{children:e.jsx(ir,{w:{base:"100%",lg:"124px"},flexDirection:{base:"row",lg:"column"},flexWrap:"wrap",border:"1px solid",borderColor:s&&s.length>0?"border":"transparent",borderRadius:"16px",p:"4px",rowGap:{base:"20px",lg:"0"},bg:s&&s.length>0?"background":"transparent",marginTop:"0",minH:"62px",children:s==null?void 0:s.map((h,F)=>{var C,A;return e.jsx(nr,{label:Ri(h.key),lineHeight:"1.5",placement:"top",gutter:-4,children:e.jsxs(H,{cursor:"pointer",textAlign:"center",width:{base:s!=null&&s.length?Ci[s.length+""]:"auto",lg:"auto"},p:"8px 20px",gap:"4px",onClick:()=>{h.key!==c&&(f(h.key),n!=null&&n.tokenA&&(n!=null&&n.tokenB)&&o(h.lower,h.upper,n))},bg:h.key==c?"card_bg":"transparent",borderRadius:"12px",sx:{_hover:{p:{color:"primary"}}},children:[e.jsx(es,{decoding:"async",display:h.key===c?"block":"none",src:`/images/${(C=qt(h.key,!0))==null?void 0:C.image}`,w:"72px",h:h.key===c?"22px":"0px",fallback:e.jsx(ne,{bg:"background",w:"72px",h:h.key===c?"22px":"0px",borderRadius:"4px"})}),e.jsx(es,{decoding:"async",display:h.key===c?"none":"block",src:`/images/${(A=qt(h.key,!1))==null?void 0:A.image}`,w:"72px",h:h.key===c?"0px":"22px",fallback:e.jsx(ne,{bg:"background",w:"72px",h:h.key===c?"0px":"22px",borderRadius:"4px"})}),e.jsx(k,{color:h.key==c?"primary":"primary_gray",fontSize:"12px",children:qt(h.key).name})]})},h.key)})})})}function ki({btnText:t,btnDisabled:l,handleChangeIsFarmRewardsRange:s,onReverseClick:d,leverage:x,direct:r,perText:y,rangeTabList:p,currentRangeTab:i,addressHistTokensMap:o,fromBalanceInfo:n,toBalanceInfo:c,fromAmountValue:f,toAmountValue:S,handleAmountChange:v,handleAdd:R,isFullRange:U}){var N;const{currentPriceData:g,contractPoolInfo:m,apiPoolInfo:a,resetLiquidity:h,contractPoolInfoLoading:F,apiPoolInfoLoading:C,minPriceForDate:A,maxPriceForDate:z}=ue(),{lowerTickData:B,upperTickData:V}=ze(),{autoStakePosition:O,setAutoStakePosition:I,isFarmRewardsRange:ee,fromAmount:Y,toAmount:J,byAmountIn:ce,percentMap:L,fromToken:E,toToken:M,totalAmount:T,fromTokenLock:G,toTokenLock:$}=Ee(),{poolAddress:Q}=Se(),q=u=>{I(u.target.checked)};return j.useMemo(()=>!!(a!=null&&a.haveFarming)&&!!(a!=null&&a.displayFarmsEffectMaxPrice)&&!!(a!=null&&a.displayFarmsEffectMinPrice),[a==null?void 0:a.haveFarming,a==null?void 0:a.displayFarmsEffectMaxPrice,a==null?void 0:a.displayFarmsEffectMinPrice]),e.jsxs(ne,{w:"100%",children:[e.jsx(rt,{fontSize:"16px",fontWeight:"500",mb:"16px",children:"1. Select Range"}),e.jsx(Ds,{poolAddress:Q,currentTick:m==null?void 0:m.current_tick_index,tickSpacing:m==null?void 0:m.tickSpacing,farmsEffectTickLower:a==null?void 0:a.farmsEffectiveTickLower,farmsEffectTickUpper:a==null?void 0:a.farmsEffectiveTickUpper}),C?e.jsx(it,{mt:"20px",h:"40px",borderRadius:"8px",w:"100%"}):e.jsx(Oe,{type:"outlineTab",tabList:p,currentTab:i,handleChangeTab:u=>d(u),wrapStyle:{mt:"20px",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"12px"},itemStyle:{flex:1,h:"32px",borderRadius:"4px",gap:"4px"}}),e.jsx(Bs,{price:vs(r?g==null?void 0:g.currentPrice:g.reverseCurrentPrice,6),perText:y,loading:F,wrapStyle:{mt:"28px",gap:"12px"}}),e.jsx(H,{flex:"1",h:"180px",pos:"relative",mt:"20px",children:e.jsx(ks,{handleClickRefresh:()=>{},direct:r,minPriceData:r?B:V,maxPriceData:r?V:B,dashedMarkerLine:[A,z]})}),e.jsx(Os,{direct:r,rangeMap:o,wrapStyle:{mt:"90px",align:"center",gap:"20px"}}),e.jsxs(H,{borderRadius:"20px",border:"1px solid",borderColor:"border",bg:"bg_six",mt:"20px",mb:"20px",p:"8px",gap:"12px",children:[e.jsx(Hs,{perText:y,direct:r,isFullRange:U,minPriceData:r?B:V,maxPriceData:r?V:B}),G&&$&&e.jsx(Xe,{w:"100%",fontSize:"12px",color:"primary_red",bg:"primary_red_opacity.10",h:"32px",borderRadius:"8px",children:"The max price should be higher than min price."})]}),e.jsxs(H,{mb:"20px",gap:"16px",children:[e.jsx(_t,{label:"Leverage",tooltip:"This parameter indicates the concentration rate of your liquidity relative to a full range position.",wrapStyle:{flexDir:"row",gap:"8px",p:"0 12px 0"},children:e.jsx(k,{color:"text_caption",children:G&&$?"--":x})}),(a==null?void 0:a.haveFarming)&&(a==null?void 0:a.displayFarmsEffectMaxPrice)&&(a==null?void 0:a.displayFarmsEffectMinPrice)&&e.jsx(Ns,{minPrice:r?ft(a==null?void 0:a.displayFarmsEffectMinPrice):jt(a==null?void 0:a.displayFarmsEffectMaxPrice),maxPrice:r?ft(a==null?void 0:a.displayFarmsEffectMaxPrice):jt(a==null?void 0:a.displayFarmsEffectMinPrice),loading:C,perText:y,checked:ee,onChange:s})]}),e.jsxs(ne,{w:"100%",bg:"bg_secondary",borderRadius:"20px",border:"1px solid",borderColor:"border",children:[e.jsxs(H,{w:"calc(100% + 2px)",gap:"16px",p:"16px 8px",bg:"bg_six",border:"1px solid",borderColor:"border",borderRadius:"20px",margin:"-1px -1px 0 -1px",children:[e.jsxs(W,{w:"100%",justify:"space-between",children:[e.jsx(rt,{fontSize:"16px",fontWeight:"500",children:"2. Deposit Amounts"}),e.jsx(W,{children:e.jsx(Fs,{})})]}),e.jsxs(H,{w:"100%",gap:"12px",children:[e.jsxs(ne,{w:"100%",position:"relative",children:[e.jsx(Ms,{onClick:d,from:{wrapStyle:{h:"108px"},balance:(n==null?void 0:n.balanceFormat)||"",value:Y+"",amountValue:f,loading:!1,onChange:u=>{var w;v(u,!0,(E==null?void 0:E.coin_type)===((w=a==null?void 0:a.tokenA)==null?void 0:w.coin_type))},selectable:!1,placeholder:"0.0",token:E,onFocusChange:u=>{var w;u&&+(Y+"")&&!ce&&v(Y+"",!0,(E==null?void 0:E.coin_type)===((w=a==null?void 0:a.tokenA)==null?void 0:w.coin_type))}},to:{wrapStyle:{h:"108px"},balance:(c==null?void 0:c.balanceFormat)||"",value:J+"",amountValue:S,loading:!1,onFocusChange:u=>{var w;u&&+(J+"")&&ce&&v(J+"",!1,(M==null?void 0:M.coin_type)===((w=a==null?void 0:a.tokenA)==null?void 0:w.coin_type))},onChange:u=>{var w;v(u,!1,(M==null?void 0:M.coin_type)===((w=a==null?void 0:a.tokenA)==null?void 0:w.coin_type))},selectable:!1,placeholder:"0.0",token:M},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"}}),G&&$&&e.jsx(St,{position:"absolute",h:"224px",top:"0px",left:"0",zIndex:9999,borderRadius:"16px"}),((N=[G,$].filter(Boolean))==null?void 0:N.length)===1&&e.jsx(St,{position:"absolute",top:G?"0px":"116px",h:"108px",left:"0",p:"16px",borderRadius:"16px",text:"The market price is outside your specified price range. Single-asset deposit only."})]}),!!(a!=null&&a.poolAddress)&&e.jsx(e.Fragment,{children:e.jsxs(H,{gap:"12px",w:"100%",borderRadius:"20px",border:"1px solid",borderColor:"border",bg:"background",p:"20px 8px",children:[e.jsx(me,{isLoading:!1,label:"Total Amount",value:T&&+T?Gt(T):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",h:"20px"},skeletonStyle:{valueW:"128px"}}),e.jsx(_t,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(H,{justify:"flex-end",gap:"4px",children:[E,M].filter(Boolean).map((u,w)=>{var b;return e.jsxs(W,{gap:"4px",justify:"flex-end",w:"100%",children:[e.jsx(De,{imageUrl:u==null?void 0:u.logo_url,coinType:u==null?void 0:u.coin_type,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(k,{color:w===0?"primary":"primary_green",fontSize:"14px",whiteSpace:"nowrap",children:[P(u==null?void 0:u.symbol,10)," ",G&&$?"--":L[(u==null?void 0:u.coin_type)===((b=a==null?void 0:a.tokenA)==null?void 0:b.coin_type)?"percentA":"percentB"],"%"]})]},u==null?void 0:u.coin_type)})})})]})})]}),!!(a!=null&&a.poolAddress)&&e.jsx(fe,{w:"100%",h:"52px",fontSize:"20px",fontWeight:"500",borderRadius:"16px",isDisabled:l,isLoading:!1,onClick:R,children:t})]}),(a==null?void 0:a.haveFarming)&&e.jsx(Vs,{disabled:G||$,checked:O,onChange:q})]})]})}function us({children:t,title:l,wrapStyle:s={}}){return e.jsxs(H,{gap:"8px",p:"10px 16px 16px",border:"1px solid",borderColor:"border",borderRadius:"16px",bg:"bg_six",...s,children:[e.jsxs(W,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(k,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:l}),t==null?void 0:t[0]]}),t==null?void 0:t[1]]})}function Li({btnText:t,btnDisabled:l,handleChangeIsFarmRewardsRange:s,onReverseClick:d,leverage:x,direct:r,perText:y,rangeTabList:p,currentRangeTab:i,addressHistTokensMap:o,fromBalanceInfo:n,toBalanceInfo:c,fromAmountValue:f,toAmountValue:S,handleAmountChange:v,handleAdd:R,isFullRange:U}){var u;const{currentPriceData:g,contractPoolInfo:m,apiPoolInfo:a,resetLiquidity:h,contractPoolInfoLoading:F,apiPoolInfoLoading:C,minPriceForDate:A,maxPriceForDate:z,currentRange:B}=ue(),{lowerTickData:V,upperTickData:O}=ze(),{autoStakePosition:I,setAutoStakePosition:ee,isFarmRewardsRange:Y,fromAmount:J,toAmount:ce,byAmountIn:L,percentMap:E,fromToken:M,toToken:T,totalAmount:G,fromTokenLock:$,toTokenLock:Q}=Ee(),{poolAddress:q}=Se(),N=w=>{ee(w.target.checked)};return e.jsx(e.Fragment,{children:e.jsxs(W,{gap:"12px",align:"flex-start",children:[e.jsxs(us,{title:"1. Select Range",wrapStyle:{flex:1,minW:"588px",gap:"0"},children:[!p||!p.length?e.jsx(it,{h:"32px",borderRadius:"8px",w:"180px"}):e.jsx(Oe,{type:"outlineTab",tabList:p,currentTab:i,handleChangeTab:w=>d(w),wrapStyle:{h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}}),e.jsxs(H,{w:"100%",gap:"12px",children:[e.jsx(W,{w:"100%",justify:"space-between",gap:"32px",mt:"16px",children:e.jsxs(H,{flex:"1",pos:"relative",gap:"0px",children:[e.jsx(W,{w:"100%",h:"24px",justify:"flex-start",children:e.jsx(Bs,{loading:C,price:oe(g)?vs(r?g==null?void 0:g.currentPrice:g.reverseCurrentPrice,6):"--",perText:y,wrapStyle:{ml:"156px",zIndex:99}})}),e.jsxs(W,{w:"100%",gap:"32px",children:[e.jsxs(H,{gap:"20px",children:[e.jsx(Xe,{h:"226px",mt:"10px",children:e.jsx(Ds,{poolAddress:q,currentTick:m==null?void 0:m.current_tick_index,tickSpacing:m==null?void 0:m.tickSpacing,farmsEffectTickLower:a==null?void 0:a.farmsEffectiveTickLower,farmsEffectTickUpper:a==null?void 0:a.farmsEffectiveTickUpper})}),oe(V)&&oe(O)&&e.jsx(e.Fragment,{children:e.jsx(_t,{label:"Leverage",tooltip:"This parameter indicates the concentration rate of your liquidity relative to a full range position.",wrapStyle:{flexDir:"column",align:"center",width:"auto",gap:"2px"},children:e.jsx(k,{color:"text_caption",children:$&&Q?"--":x})})})]}),e.jsxs(H,{w:"100%",gap:"32px",children:[e.jsx(ne,{w:"100%",h:"230px",children:e.jsx(ks,{handleClickRefresh:()=>{},direct:r,minPriceData:r?V:O,maxPriceData:r?O:V,dashedMarkerLine:[A,z],currentRange:B})}),oe(V)&&oe(O)&&e.jsx(Os,{direct:r,rangeMap:o,wrapStyle:{w:"100%"}})]})]})]})}),e.jsx(Hs,{perText:y,direct:r,isFullRange:U,minPriceData:r?V:O,maxPriceData:r?O:V}),$&&Q&&e.jsx(Xe,{w:"100%",fontSize:"12px",color:"primary_red",bg:"primary_red_opacity.10",h:"32px",borderRadius:"8px",children:"The max price should be higher than min price."}),(a==null?void 0:a.haveFarming)&&(a==null?void 0:a.displayFarmsEffectMaxPrice)&&(a==null?void 0:a.displayFarmsEffectMinPrice)&&e.jsx(Ns,{minPrice:r?ft(a==null?void 0:a.displayFarmsEffectMinPrice):jt(a==null?void 0:a.displayFarmsEffectMaxPrice),maxPrice:r?ft(a==null?void 0:a.displayFarmsEffectMaxPrice):jt(a==null?void 0:a.displayFarmsEffectMinPrice),loading:C,perText:y,checked:Y,onChange:s})]})]}),e.jsxs(H,{gap:"8px",minW:"420px",maxW:"460px",w:"460px",children:[e.jsxs(us,{title:"2. Deposit Amounts",wrapStyle:{gap:"16px",w:"100%"},children:[e.jsx(W,{children:e.jsx(Fs,{})}),e.jsxs(ne,{w:"100%",position:"relative",children:[e.jsx(Ms,{onClick:d,from:{wrapStyle:{h:"108px"},balance:(n==null?void 0:n.balanceFormat)||"",value:J,amountValue:f,loading:!1,onChange:w=>{var b;v(w,!0,(M==null?void 0:M.coin_type)===((b=a==null?void 0:a.tokenA)==null?void 0:b.coin_type))},selectable:!1,placeholder:"0.0",token:M,onFocusChange:w=>{var b;w&&+(J+"")&&!L&&v(J+"",!0,(M==null?void 0:M.coin_type)===((b=a==null?void 0:a.tokenA)==null?void 0:b.coin_type))}},to:{wrapStyle:{h:"108px"},balance:(c==null?void 0:c.balanceFormat)||"",value:ce,amountValue:S,loading:!1,onFocusChange:w=>{var b;w&&+(ce+"")&&L&&v(ce+"",!1,(T==null?void 0:T.coin_type)===((b=a==null?void 0:a.tokenA)==null?void 0:b.coin_type))},onChange:w=>{var b;v(w,!1,(T==null?void 0:T.coin_type)===((b=a==null?void 0:a.tokenA)==null?void 0:b.coin_type))},selectable:!1,placeholder:"0.0",token:T},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"}}),$&&Q&&e.jsx(St,{position:"absolute",h:"224px",top:"0px",left:"0",zIndex:9999,borderRadius:"16px"}),((u=[$,Q].filter(Boolean))==null?void 0:u.length)===1&&e.jsx(St,{position:"absolute",top:$?"0px":"116px",h:"108px",left:"0",text:"The market price is outside your specified price range. Single-asset deposit only.",borderRadius:"16px"})]})]}),e.jsxs(e.Fragment,{children:[e.jsx(H,{w:"100%",gap:"8px",children:!!(a!=null&&a.poolAddress)&&(!$||!Q)&&e.jsxs(H,{gap:"12px",w:"100%",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_six",p:a!=null&&a.displayTokenA&&(a!=null&&a.displayTokenB)?"0 16px 16px":"0 16px",children:[e.jsx(fe,{w:"calc(100% + 34px)",h:"52px",margin:"-1px -1px 5px",fontSize:"18px",fontWeight:"500",borderRadius:"16px",isDisabled:l,isLoading:!1,onClick:R,children:t}),(a==null?void 0:a.displayTokenA)&&(a==null?void 0:a.displayTokenB)&&e.jsxs(e.Fragment,{children:[e.jsx(me,{isLoading:!1,label:"Total Amount",value:G&&+G?Gt(G):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",h:"20px"},skeletonStyle:{valueW:"128px"}}),e.jsx(_t,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",wrapStyle:{gap:"0px"},children:e.jsx(W,{gap:"12px",children:[M,T].filter(Boolean).map((w,b)=>{var te;return e.jsxs(W,{gap:"4px",children:[e.jsx(De,{imageUrl:w==null?void 0:w.logo_url,coinType:w?w==null?void 0:w.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(k,{color:b===0?"primary":"primary_green",fontSize:"14px",whiteSpace:"nowrap",children:[P(w==null?void 0:w.symbol,10)," ",$&&Q?"--":E[(w==null?void 0:w.coin_type)===((te=a==null?void 0:a.tokenA)==null?void 0:te.coin_type)?"percentA":"percentB"],"%"]})]},w==null?void 0:w.coin_type)})})})]})]})}),(a==null?void 0:a.haveFarming)&&e.jsx(Vs,{disabled:$||Q,checked:I,onChange:N})]})]})]})})}function Ti({rangeTabList:t,currentFeeTier:l,addressHistTokensMap:s,getList:d,getPrice:x}){var le;const{apiPoolInfo:r}=ue(),[y,p]=j.useState();j.useEffect(()=>{var X;r&&p((X=r==null?void 0:r.displayTokenA)==null?void 0:X.coin_type)},[r==null?void 0:r.poolAddress]);const i=j.useMemo(()=>{var X;return y===((X=r==null?void 0:r.tokenA)==null?void 0:X.coin_type)},[y,(le=r==null?void 0:r.tokenA)==null?void 0:le.coin_type]),o=j.useMemo(()=>{var X,se,ye,Ge;return!(r!=null&&r.tokenA)||!(r!=null&&r.tokenB)?"":i?`${P((X=r==null?void 0:r.tokenB)==null?void 0:X.symbol,10)} per ${P((se=r==null?void 0:r.tokenA)==null?void 0:se.symbol,10)}`:`${P((ye=r==null?void 0:r.tokenA)==null?void 0:ye.symbol,10)} per ${P((Ge=r==null?void 0:r.tokenB)==null?void 0:Ge.symbol,10)}`},[i,r==null?void 0:r.tokenA,r==null?void 0:r.tokenB]),{lowerTickData:n,upperTickData:c}=ze(),{handleInitTickData:f}=Rt(),{getLeverage:S}=ji(),v=j.useMemo(()=>{const X=n==null?void 0:n.price,se=c==null?void 0:c.price;return S(X,se)},[n==null?void 0:n.price,c==null?void 0:c.price]),{handleAmountChange:R,fromToken:U,setFromToken:g,toToken:m,setToToken:a,byAmountIn:h,setByAmountIn:F,fromAmount:C,setFromAmount:A,toAmount:z,setToAmount:B,fromAmountValue:V,toAmountValue:O,fromBalanceInfo:I,toBalanceInfo:ee,fromTokenLock:Y,toTokenLock:J,confirmModalOpen:ce,setConfirmModalOpen:L,relatedPosId:E,nftOpen:M,setNftOpen:T,handleAdd:G,handleSubmit:$}=Ai(d,i),{setAutoStakePosition:Q,setIsFarmRewardsRange:q}=Ee();j.useEffect(()=>{oe(r)&&(g(r==null?void 0:r.displayTokenA),a(r==null?void 0:r.displayTokenB))},[r==null?void 0:r.poolAddress]);const N=X=>{var se;X&&(X!=null&&X.coin_type)?p(X==null?void 0:X.coin_type):p((se=t==null?void 0:t.find(ye=>ye.key!==y))==null?void 0:se.key),g(m),a(U),F(!h),h?(B(C),A("")):(A(z),B(""))};j.useEffect(()=>{r!=null&&r.haveFarming&&Q(!(Y||J))},[Y,J,r==null?void 0:r.haveFarming]),j.useEffect(()=>{h&&Y&&!J&&(A(""),B("")),!h&&!Y&&J&&(A(""),B("")),h&&!Y&&J&&B(""),!h&&Y&&!J&&A(""),Y&&J&&(A(""),B(""))},[Y,J]);const u=X=>{q(X.target.checked),X.target.checked&&(r!=null&&r.farmsEffectiveTickLower)&&(r!=null&&r.farmsEffectiveTickUpper)&&f(r==null?void 0:r.farmsEffectiveTickLower,r==null?void 0:r.farmsEffectiveTickUpper,r)};j.useEffect(()=>{ie(n==null?void 0:n.tick).eq(ie(r==null?void 0:r.farmsEffectiveTickLower))&&ie(c==null?void 0:c.tick).eq(ie(r==null?void 0:r.farmsEffectiveTickUpper))?q(!0):q(!1)},[n==null?void 0:n.tick,c==null?void 0:c.tick,r==null?void 0:r.farmsEffectiveTickLower,r==null?void 0:r.farmsEffectiveTickUpper]);const w=j.useMemo(()=>(n==null?void 0:n.price)==="0"&&(c==null?void 0:c.price)==="∞",[n==null?void 0:n.price,c==null?void 0:c.price]),{btnText:b,btnDisabled:te}=Si(),{isApp:Ye}=Me(),pe={btnText:b,btnDisabled:te,handleChangeIsFarmRewardsRange:u,onReverseClick:N,leverage:v,direct:i,perText:o,rangeTabList:t,currentRangeTab:y,addressHistTokensMap:s,fromBalanceInfo:I,toBalanceInfo:ee,fromAmountValue:V,toAmountValue:O,handleAmountChange:R,handleAdd:G,isFullRange:w};return e.jsxs(e.Fragment,{children:[Ye?e.jsx(ki,{...pe}):e.jsx(Li,{...pe}),ce&&e.jsx(fi,{onClose:()=>L(!1),data:{feeTier:l},onSubmit:$}),M&&E&&oe(r)&&e.jsx(_i,{onClose:()=>T(!1),tokenA:r==null?void 0:r.displayTokenA,tokenB:r==null?void 0:r.displayTokenB,posId:E,fee:r==null?void 0:r.feeDisplay,isReverse:r==null?void 0:r.isReverse})]})}function Fi(){var ee,Y,J,ce;const{tab:t,poolAddress:l,from:s,to:d,fee:x}=Se(),{getPoolList:r}=Wr(),[y,p]=j.useState([]),{apiPoolInfo:i,setApiPoolInfo:o,setApiPoolInfoLoading:n,apiPoolInfoLoading:c,setNetError:f}=ue(),[S,v]=j.useState(),{fetchByApi:R}=Nt(),U=vt(),{fetchTokenInfo:g}=zs(),{quoteWhiteTokenList:m}=Ts(),{fromToken:a,toToken:h}=Ee(),{fetchTokenPrices:F}=_s(),C=async({poolAddress:L,from:E,to:M})=>{var T,G,$,Q;try{n(!0);let q,N;if(L&&L!=="undefined"){const u=await r({pool:L});u&&u.list&&u.list.length?(N=u.list[0],q=await r({coin_type:`${(T=N==null?void 0:N.displayTokenA)==null?void 0:T.coin_type},${(G=N==null?void 0:N.displayTokenB)==null?void 0:G.coin_type}`,is_vaults:!1,display_all_pools:!0,has_mining:!0,has_farming:!0,no_incentives:!0,order_by:"-vol",offset:0})):i&&oe(i)?(N=i,q={list:y}):(N={poolAddress:L,displayTokenA:void 0,displayTokenB:void 0},q={list:[]}),n(!1)}else if(E&&M&&E!=="undefined"&&M!=="undefined"&&E!==M){const u=await r({coin_type:`${E},${M}`,is_vaults:!1,display_all_pools:!0,has_mining:!0,has_farming:!0,no_incentives:!0,order_by:"-vol",offset:0});if(console.log(u,"res_getPoolList"),u&&u.list&&u.list.length)if(x&&x!=="undefined"){const w=($=u==null?void 0:u.list)==null?void 0:$.find(b=>Z(b==null?void 0:b.feeRate).eq(x));if(w)U(t?`/liquidity?tab=${t}&poolAddress=${w==null?void 0:w.poolAddress}`:`/liquidity?poolAddress=${w==null?void 0:w.poolAddress}`);else{const b=zt(u==null?void 0:u.list,te=>Number((te==null?void 0:te.tvl)||"0"));U(t?`/liquidity?tab=${t}&poolAddress=${b==null?void 0:b.poolAddress}`:`/liquidity?poolAddress=${b==null?void 0:b.poolAddress}`)}}else{let w=zt(u==null?void 0:u.list,b=>Number((b==null?void 0:b.tvl)||"0"));w||(w=zt(u==null?void 0:u.list,b=>{var te;return Number(((te=b==null?void 0:b.object)==null?void 0:te.liquidity)||"0")}),w||(w=u==null?void 0:u.list[0])),U(t?`/liquidity?tab=${t}&poolAddress=${w==null?void 0:w.poolAddress}`:`/liquidity?poolAddress=${w==null?void 0:w.poolAddress}`)}else{const w=await g(E),b=await g(M);N={poolAddress:void 0,displayTokenA:w,displayTokenB:b},q={list:[]},n(!1)}}else(!E||E==="undefined")&&M&&M!=="undefined"&&(N={poolAddress:void 0,displayTokenA:void 0,displayTokenB:await g(M)}),(!M||M==="undefined")&&E&&E!=="undefined"&&(N={poolAddress:void 0,displayTokenA:await g(E),displayTokenB:void 0}),q={list:[]},n(!1);q&&(f(!1),p(q==null?void 0:q.list),console.log(N,"setApiPoolInfo"),N&&(N!=null&&N.poolAddress&&L?(N==null?void 0:N.poolAddress)===L&&o(N):o(N))),n(!1)}catch(q){if(q!=null&&q.list&&((Q=q==null?void 0:q.list)==null?void 0:Q.length)===1){f(!0);const N=q==null?void 0:q.list[0];console.log(q==null?void 0:q.list,"setApiPoolInfo"),o(N),p([]),n(!1)}}};j.useEffect(()=>{l&&l==="undefined"||C({poolAddress:l,from:s,to:d})},[l,s,d]);const A=j.useMemo(()=>{var E,M;const L=Dr(y);return L?i!=null&&i.tokenA&&(i!=null&&i.tokenB)?(E=rs)==null?void 0:E.map(T=>{var $,Q;const G=(($=L.find(q=>q.feeRate===T.feeRate))==null?void 0:$.title)||T.title;return{...T,title:G,poolAddress:(Q=L.find(q=>q.feeRate===T.feeRate))==null?void 0:Q.poolAddress,disabled:G==="Not Created"&&!Qe(i==null?void 0:i.tokenA,m)&&!Qe(i==null?void 0:i.tokenB,m)}}):(M=rs)==null?void 0:M.map(T=>{var $,Q;const G=(($=L.find(q=>q.feeRate===T.feeRate))==null?void 0:$.title)||T.title;return{...T,title:G,poolAddress:(Q=L.find(q=>q.feeRate===T.feeRate))==null?void 0:Q.poolAddress,disabled:!Qe(i==null?void 0:i.displayTokenA,m)&&!Qe(i==null?void 0:i.displayTokenB,m)}}):[]},[JSON.stringify(y),JSON.stringify(m),(ee=i==null?void 0:i.displayTokenA)==null?void 0:ee.coin_type,(Y=i==null?void 0:i.displayTokenB)==null?void 0:Y.coin_type]),z=j.useMemo(()=>i?[i==null?void 0:i.displayTokenA,i==null?void 0:i.displayTokenB].filter(Boolean).map(L=>({label:L==null?void 0:L.symbol,key:L==null?void 0:L.coin_type,isToken:!0,imgInfo:{src:L==null?void 0:L.logo_url,w:"16px",h:"16px",coinType:L?L==null?void 0:L.coin_type:"",showTagWidth:"8px",showTagHeight:"8px"}})):[],[(J=i==null?void 0:i.displayTokenA)==null?void 0:J.symbol,(ce=i==null?void 0:i.displayTokenB)==null?void 0:ce.symbol]),B=j.useMemo(()=>{const L=A==null?void 0:A.find(E=>E.poolAddress===l);return L||i},[JSON.stringify(A),l,JSON.stringify(i)]),V=async L=>{console.log("🚀 ~ setAddressHistTokens ~ this.addressHistTokens:🚀 ~ getContractPrices ~ address:",L);let E=[];const M=await R(gr,"GET",{pool:L});console.log(M,"resVal"),E=Object.fromEntries(M.list.map(T=>[T.swap_account,T])),v(E)};j.useEffect(()=>{l&&V(l)},[l]);const O=j.useMemo(()=>{var L,E,M;return S&&l&&((L=S==null?void 0:S[l])!=null&&L.data)?Object.fromEntries((M=(E=S==null?void 0:S[l])==null?void 0:E.data)==null?void 0:M.map(T=>[T.key,T.value])):{}},[JSON.stringify(S)]),I=()=>{const L=[];a&&L.push(a.coin_type),h&&L.push(h.coin_type),L.length>0&&F(L)};return j.useEffect(()=>{I()},[a==null?void 0:a.coin_type,h==null?void 0:h.coin_type]),{getList:C,feeTierList:A,apiPoolInfo:i,rangeTabList:z,currentFeeTier:B,addressHistTokensMap:O,apiPoolInfoLoading:c,quoteWhiteTokenList:m,refreshMarketPrice:I}}const ps=(t,l,s)=>t&&l&&s?Z(t).mul(l).div(Z(10).pow(s)).toString():"--";function Bi(){var C,A;const{tokenAPrice:t,setTokenAPrice:l,tokenBPrice:s,setTokenBPrice:d,tokenAAmount:x,setTokenAAmount:r,tokenBAmount:y,setTokenBAmount:p,tokenAAmountUSD:i,setTokenAAmountUSD:o,tokenBAmountUSD:n,setTokenBAmountUSD:c,totalAmountUSD:f,setTotalAmountUSD:S,resetTvlInfo:v,tvlLoading:R,setTvlLoading:U}=Qt(),{apiPoolInfo:g,contractPoolInfo:m}=ue(),a=async z=>{var B,V;try{const O=(B=Re(z))==null?void 0:B.full_address,I=O=="0x2::sui::SUI"?"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":O,{prices:ee}=await ar(`${(V=cr)==null?void 0:V.cetus_api}/v2/sui/price?base_symbol_address=${I}`);return ee==null?void 0:ee[0]}catch(O){return console.log("🚀🚀🚀 ~ file: useRate.ts:31 ~ getAmountPrice ~ error:",O),"--"}},{poolAddress:h}=Se(),F=async()=>{var z,B,V,O;U(!0);try{if((z=g==null?void 0:g.tokenA)!=null&&z.coin_type){const I=await a((B=g==null?void 0:g.tokenA)==null?void 0:B.coin_type);I&&l(I)}if((V=g==null?void 0:g.tokenB)!=null&&V.coin_type){const I=await a((O=g==null?void 0:g.tokenB)==null?void 0:O.coin_type);I&&d(I)}}catch(I){console.log("🚀 ~ PoolInfo ~ handleRefresh:",I)}finally{U(!1)}};return j.useEffect(()=>{v()},[h]),j.useEffect(()=>()=>{v()},[]),j.useEffect(()=>{F()},[g==null?void 0:g.tvl,(C=g==null?void 0:g.tokenA)==null?void 0:C.coin_type,(A=g==null?void 0:g.tokenB)==null?void 0:A.coin_type]),j.useEffect(()=>{m!=null&&m.coinAmountA&&r(Z(m==null?void 0:m.coinAmountA).sub((m==null?void 0:m.fee_protocol_coin_a)||"0").toString())},[m==null?void 0:m.coinAmountA,m==null?void 0:m.fee_protocol_coin_a]),j.useEffect(()=>{m!=null&&m.coinAmountB&&p(Z(m==null?void 0:m.coinAmountB).sub((m==null?void 0:m.fee_protocol_coin_b)||"0").toString())},[m==null?void 0:m.coinAmountB,m==null?void 0:m.fee_protocol_coin_b]),j.useEffect(()=>{x&&(t!=null&&t.price)&&(g!=null&&g.tokenA.decimals)&&!Number.isNaN(Number(g==null?void 0:g.tokenA.decimals))&&o(ps(x,t==null?void 0:t.price,g==null?void 0:g.tokenA.decimals))},[x,t]),j.useEffect(()=>{y&&(s!=null&&s.price)&&(g!=null&&g.tokenB.decimals)&&!Number.isNaN(Number(g==null?void 0:g.tokenB.decimals))&&c(ps(y,s==null?void 0:s.price,g==null?void 0:g.tokenB.decimals))},[y,s]),j.useEffect(()=>{S(i&&n&&i!=="--"&&n!=="--"?Z(i).plus(n).toString():"--")},[i,n]),{tokenAPrice:t,tokenBPrice:s,tokenAAmount:x,tokenBAmount:y,tokenAAmountUSD:i,tokenBAmountUSD:n,totalAmountUSD:f,setTotalAmountUSD:S,tvlLoading:R}}var tt=(t=>(t.deposit="Provide Liquidity",t.positions="My Positions",t.analytics="Analytics",t))(tt||{});const Te=[{label:"Provide Liquidity",key:"deposit"},{label:"My Positions",key:"positions"},{label:"Analytics",key:"analytics"}];function Xn(){var lt,Pe,dt;const t=vt(),{currentAccount:l}=wt(),{apiPoolInfo:s,apiPoolInfoLoading:d,currentPriceData:x,resetLiquidity:r,contractPoolInfo:y,setApiPoolInfo:p,netError:i,manualRefresh:o,setManualRefresh:n}=ue(),{feeTierList:c,currentFeeTier:f,rangeTabList:S,addressHistTokensMap:v,getList:R,quoteWhiteTokenList:U,refreshMarketPrice:g}=Fi(),[m,a]=j.useState(Te),{tab:h,poolAddress:F,from:C,to:A}=Se(),[z,B]=j.useState(((lt=Te==null?void 0:Te.find(_=>_.key===h))==null?void 0:lt.key)||Te[0].key),{handleResetRange:V}=Rt(),{resetAddLiquidity:O,fromToken:I,toToken:ee,setFromToken:Y,setToToken:J}=Ee(),{fetchAccountBalance:ce}=Ls(),{getContractPoolInfo:L}=Fr(),{getCurrentPrice:E}=Br(),{getTokenInfo:M}=zs(),[T,G]=j.useState(),[$,Q]=j.useState();j.useLayoutEffect(()=>{h&&h!==z&&B(h)},[h]),j.useEffect(()=>{G(s==null?void 0:s.displayTokenA),Q(s==null?void 0:s.displayTokenB)},[(Pe=s==null?void 0:s.displayTokenA)==null?void 0:Pe.coin_type,(dt=s==null?void 0:s.displayTokenB)==null?void 0:dt.coin_type]);const q=async()=>{if(F&&s&&F===(s==null?void 0:s.poolAddress)){const _=await L(F);_&&E(_==null?void 0:_.current_sqrt_price,s)}};j.useEffect(()=>{F&&(s==null?void 0:s.poolAddress)!==F&&(V(),O(),r()),F&&F===(s==null?void 0:s.poolAddress)&&q()},[F,s==null?void 0:s.poolAddress]),j.useEffect(()=>(l!=null&&l.address&&ce(),()=>{V(),O(),r()}),[]);const{isApp:N}=Me(),{addFavorites:u,removeFavorites:w}=Rr(),{poolFavoriteIds:b}=Cr();lr();const te=j.useMemo(()=>b==null?void 0:b.includes(F||""),[JSON.stringify(b),F]),Ye=_=>{Kt(_),F&&(te?w(F):u(F))},pe=async _=>{console.log("🚀 ~ handleRefresh ~ handleRefresh111:"),_&&n(!0),F&&F!=="undefined"&&await R({poolAddress:F}),l!=null&&l.address&&await ce(),Lt(),n(!1)},{posBaseListGroupByPool:le}=Rs(),X=j.useMemo(()=>{if(F&&F!=="undefined"){const _=le[F.toLowerCase()||""];return _&&(_!=null&&_.list)&&(_==null?void 0:_.list.length)>0?_==null?void 0:_.list.length:void 0}},[JSON.stringify(le),F]);j.useEffect(()=>{a(Te==null?void 0:Te.map(_=>({..._,num:_.label==="My Positions"&&z==="positions"?X:void 0})))},[X,z]);const se=j.useMemo(()=>{const _=[];return s!=null&&s.displayTokenA&&_.push(s==null?void 0:s.displayTokenA),s!=null&&s.displayTokenB&&_.push(s==null?void 0:s.displayTokenB),_},[JSON.stringify(s==null?void 0:s.displayTokenA),JSON.stringify(s==null?void 0:s.displayTokenB)]),{isOpen:ye,onOpen:Ge,onClose:at}=dr(),[Ze,Ct]=j.useState(),ct=()=>{var _,de;t(`/create-pool/${(_=s==null?void 0:s.displayTokenA)==null?void 0:_.coin_type}/${(de=s==null?void 0:s.displayTokenB)==null?void 0:de.coin_type}/${Ze==null?void 0:Ze.feeRate}`)},{totalAmountUSD:Je,tvlLoading:kt,setTotalAmountUSD:_e}=Bi(),Lt=()=>{g==null||g(),q==null||q()};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{w:"100%",mt:"20px",children:[e.jsxs(W,{w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",children:[e.jsx(or,{text:"Pools",onClick:()=>t("/pools")}),F&&(s==null?void 0:s.tokenA)&&(s==null?void 0:s.tokenB)&&e.jsxs(W,{gap:"8px",children:[e.jsx(ht,{placement:"top",tooltip:te?"Remove from Watchlist":"Add to Watchlist",children:e.jsx(fe,{variant:"outline",w:"32px",h:"32px",lineHeight:"32px",onClick:Ye,p:"0 6px",borderRadius:"8px",color:"text_paragraph",bg:"background",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:te?"primary":"text_caption"}}},children:e.jsx(Be,{xlinkHref:te?"#icon-icon_star_sel":"#icon-icon_star",svgFill:te?"primary_blue":"text_paragraph",svgHover:te?"primary":"text_caption",fontSize:"18px"})})}),e.jsx(ht,{placement:"top",tooltip:"Trade",children:e.jsx(fe,{variant:"outline",bg:"background",h:"32px",w:"32px",onClick:()=>{var _,de;return t(`/swap/${(_=s==null?void 0:s.displayTokenA)==null?void 0:_.coin_type}/${(de=s==null?void 0:s.displayTokenB)==null?void 0:de.coin_type}`)},borderRadius:"8px",p:"0 6px",color:"text_paragraph",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:"text_caption"}}},children:e.jsx(Be,{xlinkHref:"#icon-icon_swap1",fontSize:"16px"})})}),e.jsx(ht,{placement:"top",tooltip:"Refresh",children:e.jsx(ne,{children:e.jsx(Kr,{handleRefresh:pe,isAutoRefresh:!0,refreshInterval:60,innerStyle:{bg:"background"},w:"32px",h:"32px",borderRadius:"8px",bg:"background"},F)})})]})]}),e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",mt:"20px",gap:{base:"20px",lg:"8px"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"8px"},align:{base:"flex-start",lg:"center"},children:[e.jsxs(W,{gap:"12px",children:[e.jsx(ts,{value:T||(C?M(C):void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:i,onChange:_=>{var ve,qe,$e,We;const de=Object.keys(tt).find(Ie=>Ie===z);if($!=null&&$.coin_type||(ve=M(A))!=null&&ve.coin_type)if(Re(_==null?void 0:_.coin_type).full_address===Re(($==null?void 0:$.coin_type)||((qe=M(A))==null?void 0:qe.coin_type)||"").full_address)G($),Q(T);else{if(Re(_==null?void 0:_.coin_type).full_address===Re((T==null?void 0:T.coin_type)||(($e=M(C))==null?void 0:$e.coin_type)||"").full_address)return;t(`/liquidity?tab=${de}&from=${_==null?void 0:_.coin_type}&to=${($==null?void 0:$.coin_type)||((We=M(A))==null?void 0:We.coin_type)}`),p(null),_e("")}else t(`/liquidity?tab=${de}&from=${_==null?void 0:_.coin_type}`),p(null),_e("")},tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!T&&d}),e.jsx(ts,{value:$||(A?M(A):void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:i,onChange:_=>{var ve,qe,$e,We;const de=Object.keys(tt).find(Ie=>Ie===z);if(T!=null&&T.coin_type||(ve=M(C))!=null&&ve.coin_type)if(Re(_==null?void 0:_.coin_type).full_address===Re((T==null?void 0:T.coin_type)||((qe=M(C))==null?void 0:qe.coin_type)||"").full_address)G($),Q(T);else{if(Re(_==null?void 0:_.coin_type).full_address===Re(($==null?void 0:$.coin_type)||(($e=M(A))==null?void 0:$e.coin_type)||"").full_address)return;t(`/liquidity?tab=${de}&from=${(T==null?void 0:T.coin_type)||((We=M(C))==null?void 0:We.coin_type)}&to=${_==null?void 0:_.coin_type}`),p(null),_e("")}else t(`/liquidity?tab=${de}&to=${_==null?void 0:_.coin_type}`),p(null),_e("")},tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!$&&d})]}),e.jsx(Gr,{value:f,loading:!f&&d,feeTierList:c,disabled:i,onChange:_=>{_!=null&&_.poolAddress?t(`/liquidity?poolAddress=${_==null?void 0:_.poolAddress}`):(Ct(_),Ge())}})]}),F&&(s==null?void 0:s.tokenA)&&(s==null?void 0:s.tokenB)&&e.jsxs(be,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"28px"},children:[e.jsx(pt,{label:"Pool APR",value:e.jsx(xr,{poolInfo:s,placement:"bottom",children:e.jsxs(W,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[e.jsx(k,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:s!=null&&s.farmingAprDisplay||s!=null&&s.miningAprList&&(s==null?void 0:s.miningAprList.length)>0?"help":"text",children:s==null?void 0:s.feeAndMiningAprDisplay}),(s==null?void 0:s.haveFarming)&&e.jsxs(k,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",s==null?void 0:s.farmingAprDisplay]})]})})}),e.jsx(pt,{label:"TVL",value:Je&&Je!=="--"?`$${Ce(Je,2)}`:"--",loading:d||kt}),e.jsx(pt,{label:"Volume (24H)",value:(s==null?void 0:s.volume24Display)||"",loading:d}),e.jsx(pt,{label:"Fees (24H)",value:(s==null?void 0:s.fees24Display)||"",loading:d})]})]}),F&&(s!=null&&s.tokenA)&&(s!=null&&s.tokenB)?e.jsxs(e.Fragment,{children:[e.jsxs(be,{w:"100%",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},minW:{base:"100%",lg:"1024px"},children:[e.jsx(Oe,{type:"borderTab",tabList:m,currentTab:z,handleChangeTab:_=>{const de=Object.keys(tt).find(ve=>tt[ve]===_.label);F&&t(`/liquidity?tab=${de}&poolAddress=${F}`),B(de)},wrapStyle:{w:{base:"100%",lg:"auto"},justify:{base:"space-between",lg:"flex-start"},p:{base:"0 12px",lg:"0"},bg:{base:"bg_secondary",lg:"transparent"},h:N?"60px":"58px",gap:{base:"8px",lg:"45px"},border:{base:"1px solid",lg:"none"},borderColor:{base:"border",lg:"transparent"},borderRadius:{base:"16px",lg:"unset"},mt:{base:"20px",lg:"12px"}},itemStyle:{fontSize:N?"14px":"16px",fontWeight:"500"}}),z!=="deposit"&&s&&e.jsxs(be,{w:N?"100%":"auto",mt:{base:"4px",lg:"12px"},gap:"12px",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},children:[e.jsx(k,{children:"Current Price"}),e.jsx(Qr,{noCenter:!!N,fromToken:s==null?void 0:s.displayTokenA,toToken:s==null?void 0:s.displayTokenB,fromValue:"1",toValue:yt(s!=null&&s.isReverse?x==null?void 0:x.reverseCurrentPrice:x==null?void 0:x.currentPrice,6,!0).toString(),color:"text_caption",wrapStyle:N?{w:"100%"}:{}})]})]}),e.jsx(ne,{h:{base:"20px",lg:"8px"}}),z==="deposit"&&e.jsx(Ti,{rangeTabList:S,getList:pe,getPrice:q,currentFeeTier:f,addressHistTokensMap:v}),z==="positions"&&e.jsx(hi,{}),z==="analytics"&&e.jsx(yi,{})]}):e.jsx(ne,{mt:"20px",children:!s&&d?e.jsx(Xe,{w:"100%",h:"480px",background:"bg_secondary",borderRadius:"12px",border:"1px solid",borderColor:"border",children:e.jsx(Dt,{})}):e.jsx(st,{type:"custom",imgUrl:"/images/img_create_pool.png",h:"480px",children:e.jsx(H,{children:T&&$?Qe(T,U)||Qe($,U)?e.jsxs(e.Fragment,{children:[e.jsx(k,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",fontWeight:"500",children:"This Pool has not been initialized"}),e.jsx(k,{fontSize:"14px",children:"Do you want to initialize it?"}),e.jsx(fe,{mt:"12px",w:"120px",h:"32px",borderRadius:"8px",colorScheme:"blue",fontSize:"14px",fontWeight:"500",onClick:()=>{at(),ct()},children:"Initialized Pool"})]}):e.jsx(k,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"No liquidity data"}):e.jsx(k,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"Select the token you want to provide liquidity for."})})})})]}),(s==null?void 0:s.displayTokenA)&&(s==null?void 0:s.displayTokenB)&&e.jsx(Xr,{tokensInfo:se,waringModalCancel:_=>{t("/pools")}}),e.jsx(Nr,{title:"This Pool has not been initialized",subTitle:"Do you want to initialize it?",btnText:"Initialized Pool",isOpen:ye,onClose:at,onConfirm:ct})]})}export{Xn as default};
