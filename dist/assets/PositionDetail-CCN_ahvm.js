import{a as x,j as i,a7 as Ze,T as h,V as J,H as n,u as ae,am as Si,v as qe,R as vi,f as Oe,ab as Ci,az as _i}from"./vendor-DsVemle5.js";import{A as Ri}from"./index-Cy9bHcqq.js";import{C as Li}from"./CoinPairInfo-CkfLTRmv.js";import{S as Fi}from"./Slippage-DGLr6udB.js";import{u as Mi,L as Ei,S as Fe}from"./LiquidityRangeChart-COyiBQfD.js";import{u as di,a as Di}from"./useTransaction-CjlygSkT.js";import{u as Wi,a as Vi,P as zi}from"./PositionCurrentPrice-DM5OTcOh.js";import{a as ue,b as Ue}from"./useNotifiSubscription-rM7Fm_-w.js";import{c as Gi,d as Ni,u as he,a as oi,e as Hi,f as Zi}from"./usePositionList-DMAeOMoO.js";import{n as Ee,A as pe,a as Ye,B as me,c as Pe,$ as Ae,R as xi,d as xe,e as mi,r as $e,x as qi,a3 as Oi,l as ei,a5 as Ui,w as Yi,a6 as ii,a2 as $i,a1 as Qi,a4 as Ji,ac as Ki,m as Xi,z as si,i as fi}from"./index-DIvDX_Yh.js";import{u as Qe}from"./useAccountBalance-CBRzIpkZ.js";import{S as Bi,A as Ii}from"./SingleTokenInfo-CBKDT-57.js";import{L as Pi}from"./PriceRange-Cn5wVyeV.js";import{c as es,e as is,a as ss,g as ls,Z as ts,R as as,b as ps}from"./ZapSwitch-CQHx5PCq.js";import{u as ds,T as os,F as xs,R as ms}from"./RemoveBlock-Ca9Nfy3r.js";import{u as cs}from"./global-CXwwb5OW.js";import{f as Me}from"./index-D6pLRAs4.js";import{u as li}from"./useTokenBalance-Dt87YmUP.js";import{u as ns}from"./useInsufficientBalanceToast-QGj3IVLD.js";import{u as gs}from"./usePosAdd-BOdxQXZJ.js";import{v as ti}from"./v4-C6aID195.js";import{T as rs}from"./TradeInputGroup-CW7tw1iX.js";import{T as bs}from"./TooltipIcon-DEf7niQQ.js";import{P as hs}from"./PositionStatus-Z20d5_GT.js";import{R as js}from"./RangeValue-BR10AKaI.js";import{u as ys}from"./index-DnKQwi__.js";import{b as ws,u as Ts}from"./useGetPoolList-CqBccx4u.js";import{u as ks}from"./swapWidget-xhK2LVCn.js";import{B as As}from"./BackButton-Drt4zAgT.js";import{R as ai}from"./RefreshButton-DvOwcCPC.js";import{u as us}from"./useRpcListener-BP45ghaH.js";import"./PoweredByHaedal-CSYJZkP0.js";import"./HTextLabelBox-C4-LQHuG.js";import"./VTextLabelBox-BJc5Qo4D.js";import"./linear-DYpwdEgO.js";import"./liquidity-Bk_xTH0l.js";import"./usePreviousValue-CMQTRdbk.js";import"./ActionButton-jhLrxiBB.js";import"./useTrack-DRz2Qk0R.js";import"./useSigner-Brm2Toqu.js";import"./useBurn-CEpl1TJm.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-BvO73E9q.js";import"./useXCetusHelper-CgocXtBx.js";import"./useToken-YYj-bY2H.js";import"./index-CB7ViKlR.js";import"./debounce-Bdyap_Ai.js";import"./index-BzFku5sE.js";import"./useFavoritePool-BJLivj5m.js";import"./useWrapPoolData-D5Mp0awk.js";import"./CopyButton-D-DvrQ9Z.js";import"./DepositRatio-CYJIi_w0.js";import"./FreshProgressV2-ZPylifaE.js";import"./usePriceImpact-DY73T9z-.js";import"./useSwapHelper-BOLbfc9y.js";import"./ErrorTips-BZCXKHj3.js";import"./ExpendItem-n-_qpxU7.js";import"./_getAllKeysIn-BgIYPgua.js";function Ss(){var f,B,G,Z,Y,Q;const{tokenAmountAfterA:e,tokenAmountAfterB:o,currentPosDetailTab:d,curPosContractPoolInfo:t}=ue(),{getPosFeeData:W}=Gi(),{getPosRewardsData:c}=Ni(),{currentAccount:g}=Ee(),{currentPosBaseInfo:s,posFeeData:j,posRewardsData:b,posLiquidityData:R,currentPosBaseInfoLoading:V,posFeeDataLoading:C,posRewardsDataLoading:M}=he();Ue();const a=x.useMemo(()=>R[s==null?void 0:s.posId],[R,s==null?void 0:s.posId]),l=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",j[s==null?void 0:s.posId]),j[s==null?void 0:s.posId]),[j,s==null?void 0:s.posId]),L=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",b[s==null?void 0:s.posId]),b[s==null?void 0:s.posId]),[b,s==null?void 0:s.posId]);pe(a==null?void 0:a.displayCoinAmountA,void 0,!0),pe(a==null?void 0:a.displayCoinAmountB,void 0,!0);const[S,_]=x.useState(!1),[z,T]=x.useState("--"),{signAndExecuteTransaction:E}=di(),{getPosClaimFeeAndRewardTxPayload:D}=Wi(),{calculatePendingYield:F}=Vi();x.useEffect(()=>{if(!V&&!C&&!M){const{total:w}=F([s],j,b);T(w)}},[V,C,M]);const{fetchAccountBalance:H}=Qe(),O=async()=>{_(!0);try{const w=(L==null?void 0:L.map(N=>N.coin_address))||[],de={posType:s==null?void 0:s.posType,id:s==null?void 0:s.id,clmmPool:s==null?void 0:s.clmmPool,coinTypeA:s==null?void 0:s.coinTypeA,coinTypeB:s==null?void 0:s.coinTypeB,rewarderCoinTypes:w,account:g==null?void 0:g.address};console.log("ðŸš€ ~ toClaim ~ params.currentPosBaseInfo:",de,s);const{tx:A,msafeParams:q}=await D(de);console.log("ðŸš€ ~ toClaim ~ tx:",A);const y=await E(A,{getShowInfo:N=>{const m={modalDescriptionText:"",toastTitleText:""};return N==="success"&&(m.toastTitleText="Claim Successful"),m}},{msafeParams:q});console.log("ðŸš€ ~ toClaim ~ res:",y),y&&setTimeout(()=>{H(),W([s]),c([s],{[t.poolAddress]:t})},2e3),_(!1)}catch(w){_(!1),console.log("ðŸš€ ~ toClaim ~ error:",w)}},U=e!==""||o!=="",{isApp:k}=Ye();return i.jsxs(me,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(me,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(Ze,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(Ze,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(h,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(Pi,{positionInfo:s,haveTooltip:!1})]}),i.jsxs(J,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(n,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(n,{gap:"4px",children:[i.jsx(Pe,{imageUrl:(f=s==null?void 0:s.displayTokenA)==null?void 0:f.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(B=s==null?void 0:s.displayTokenA)==null?void 0:B.coin_type:""}),i.jsx(ae,{isLoaded:!!s&&!!a,children:i.jsxs(n,{gap:"4px",children:[i.jsx(h,{color:"primary",children:Ae((G=s==null?void 0:s.displayTokenA)==null?void 0:G.symbol)}),i.jsxs(h,{color:"primary",children:[a==null?void 0:a.displayPercentA,"%"]})]})})]}),i.jsxs(n,{gap:"4px",children:[i.jsx(Pe,{imageUrl:(Z=s==null?void 0:s.displayTokenB)==null?void 0:Z.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(Y=s==null?void 0:s.displayTokenB)==null?void 0:Y.coin_type:""}),i.jsx(ae,{isLoaded:!!s&&!!a,children:i.jsxs(n,{gap:"4px",children:[i.jsx(h,{color:"primary_green",children:Ae((Q=s==null?void 0:s.displayTokenB)==null?void 0:Q.symbol)}),i.jsxs(h,{color:"primary_green",children:[a==null?void 0:a.displayPercentB,"%"]})]})})]})]}),i.jsx(Si,{w:"200px",h:"4px",value:a==null?void 0:a.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(n,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(ke,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:a==null?void 0:a.displayCoinAmountA,afterAmount:e}),i.jsx(ke,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:a==null?void 0:a.displayCoinAmountB,afterAmount:o})]}),i.jsx(me,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(n,{w:"100%",justify:"space-between",children:[i.jsxs(Ze,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(h,{color:"primary_gray",children:"Pending Yield"}),i.jsx(ae,{isLoaded:!!z&&!!s&&!!j&&!!b,children:i.jsx(h,{color:"text_caption",fontSize:"16px",children:xi(z,2)})})]}),i.jsx(qe,{isLoading:S,disabled:Number(z)==0||C||M||S||!l,onClick:O,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(n,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(ke,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:l==null?void 0:l.displayFeeOwedA,afterAmount:U?"0":""}),i.jsx(ke,{label:k?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:l==null?void 0:l.displayFeeOwedB,afterAmount:U?"0":""}),L==null?void 0:L.map((w,de)=>i.jsx(vi.Fragment,{children:xe(w.amount_owed).gt(0)&&i.jsx(ke,{label:k?de==0?"Mining Rewards":"":"Mining Rewards",token:w==null?void 0:w.token,amount:w==null?void 0:w.display_amount_owed,afterAmount:U?"0":""})},w==null?void 0:w.coin_address))]})]})}const ke=({label:e,token:o,amount:d,afterAmount:t,isLoading:W})=>{const{isApp:c}=Ye(),{getExplorerUrl:g}=mi();return i.jsxs(J,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(n,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(h,{color:"primary_gray",children:e}),i.jsxs(n,{children:[i.jsx(Oe,{onClick:c?()=>window.open(g(o==null?void 0:o.coin_type,"coin")):()=>{},children:i.jsx(Bi,{haveTooltip:!c,coinType:o?o==null?void 0:o.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(ae,{isLoaded:!W&&!!d,children:i.jsx(h,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:pe(d)})}),i.jsx(h,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:Ae(o==null?void 0:o.symbol)})]})]}),t!==""&&t&&i.jsxs(n,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(h,{color:"primary",children:pe(t)}),i.jsx(h,{color:"primary",children:"after"})]})]})};function vs(){const{currentPosBaseInfo:e,posPoolsOriginalData:o,posPoolsRelatedData:d,posRewardsData:t,posLiquidityData:W}=he(),c=t[e==null?void 0:e.posId],{getTokenAmountValue:g}=$e(),{transactionConfirmation:s}=Di(),{preAdd:j,getAddTsPayload:b,getClmmCreateAddData:R,getFarmsCreateAddData:V}=gs(),{getTokenALock:C,getTokenBLock:M}=oi(),{getCurrentPosBaseInfo:a}=Ue(),{setTokenAmountAfterA:l,setTokenAmountAfterB:L,currentPoolSqrtPrice:S,isFixedDisplayTokenA:_,setIsFixedDisplayTokenA:z,curPosContractPoolInfo:T,currentPosDetailTab:E,isPosDetailRefresh:D,useZapIn:F}=ue(),{getZapDepositToastInfo:H,getZapDepositTx:O,reCalculateZapData:U}=es(),{preDepositeData:k,setZapAmount:f,setPreDepositeData:B}=is(),[G,Z]=x.useState(!1),[Y,Q]=x.useState(""),[w,de]=x.useState(""),[A,q]=x.useState(""),[y,N]=x.useState(""),m=x.useMemo(()=>W[e==null?void 0:e.posId],[W,e==null?void 0:e.posId]),$=pe(m==null?void 0:m.displayCoinAmountA,void 0,!0),De=pe(m==null?void 0:m.displayCoinAmountB,void 0,!0);x.useEffect(()=>{if(+A||+y){const p=+A,r=+y;l(xe(p).plus($).toString()),L(xe(r).plus(De).toString())}else l(""),L("")},[A,y]);const v=e==null?void 0:e.displayTokenA,u=e==null?void 0:e.displayTokenB,{mevProtect:Se,maxCapForGas:I,transactionMode:ci,customGasPrice:ni}=cs(),{balanceInfo:je}=li(v),{balanceInfo:ye}=li(u),gi=g(v==null?void 0:v.coin_type,A),ri=g(u==null?void 0:u.coin_type,y),[We,Ve]=x.useState(""),Je=x.useRef("");x.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",We),Je.current=We},[We]);const we=()=>{q(""),N(""),Z(!1),Ve("")},ve=x.useMemo(()=>C(e,T),[T==null?void 0:T.current_tick_index,e]),Ce=x.useMemo(()=>M(e,T),[T==null?void 0:T.current_tick_index,e]),ze=e!=null&&e.isReverse?Ce:ve,Ge=e!=null&&e.isReverse?ve:Ce;x.useEffect(()=>{we()},[ze,Ge]);const Ke=qi((p,r,K)=>{var be,ee;if(E!=="increase")return;const X=r?(be=e==null?void 0:e.displayTokenA)==null?void 0:be.decimals:(ee=e==null?void 0:e.displayTokenB)==null?void 0:ee.decimals,Te=Oi(p,X),Re=e==null?void 0:e.tokenA,ie=e==null?void 0:e.tokenB,se=e==null?void 0:e.lowerTick,ce=e==null?void 0:e.upperTick,ne=e==null?void 0:e.isReverse,le={amount:Te,tokenA:Re,tokenB:ie,isTokenA:ne?!r:r,lowerTick:se,upperTick:ce,curSqrtPrice:S,isReverse:ne,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",le);const{displayCoinAmountA:oe,displayCoinAmountB:ge,tokenMaxA:re,tokenMaxB:te}=j(le);Je.current===K?(Q(re),de(te),r?N(ge||""):q(oe||"")):we(),Z(!1)},500),_e=()=>{if((A||y)&&Ui(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const p=_?A:y;if(+p){const r=ti();Ve(r),Ke(p,_,r)}}};x.useEffect(()=>{E=="increase"&&D&&_e()},[D]);const bi=(p,r)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!p,+p,p),!p){we();return}if(z(r),r?q(p):N(p),+p){Z(!0);const K=ti();Ve(K),console.log("ðŸš€ ~ handleAmountChange ~ params:",p),Ke(p,r,K)}else r?N(""):q("")},{currentAccount:P}=Ee(),hi=x.useMemo(()=>{const p={text:"Add More Liquidity",disabled:!1};return P!=null&&P.address?!+A&&!+y?(p.text="Enter an amount",p.disabled=!0,p):!ze&&A&&xe(A).gt((je==null?void 0:je.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${Ae(v==null?void 0:v.symbol,10)} Balance`,p):!Ge&&y&&xe(y).gt((ye==null?void 0:ye.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${Ae(u==null?void 0:u.symbol,10)} Balance`,p):((!ve&&!Ce&&(!+A||!+y)||(e==null?void 0:e.posType)=="burn")&&(p.disabled=!0),p):(p.text="Connect Wallet",p.disabled=!1,p)},[A,y,je,ye,P==null?void 0:P.address]),{signAndExecuteTransaction:ji}=di(),{getContractPoolInfo:yi}=ss(),[wi,Ne]=x.useState(!1),{fetchAccountBalance:Ti}=Qe(),{showInsufficientBalanceToast:ki}=ns(),Ai=async()=>{var p;Ne(!0);try{let r,K,X;const Te=(p=c||[])==null?void 0:p.reduce((ie,se)=>(xe(se==null?void 0:se.amount_owed).gt(0)&&ie.push(se.coin_address),ie),[]);if(F)X=H(),s(X),r=await O(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:Te});else{const ie=_?A:y,se=_?v.decimals:u.decimals,ce=xe(ie).mul(Yi.pow(10,se)).toString(),ne=e!=null&&e.isReverse?!_:_;let le,oe;const ge=e==null?void 0:e.lowerTick,re=e==null?void 0:e.upperTick,te=T==null?void 0:T.current_tick_index;te!==void 0&&ge!==void 0&&re!==void 0&&(te>=ge&&te<=re?(le=ne?ce:Y,oe=ne?w:ce):te>re?(le=0,oe=ce):te<ge&&(le=ce,oe=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",ge,re,te),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,le,oe),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",c,Te);const be={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:le,amountB:oe,fixAmountA:ne,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:S,posType:e==null?void 0:e.posType,rewarderCoinTypes:Te,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(be.farmsPoolId=e==null?void 0:e.farmsPool),X={getShowInfo:(ui,He)=>{const Xe="Add "+[Me(A,v==null?void 0:v.symbol),Me(y,u==null?void 0:u.symbol)].filter(Boolean).join(" and "),Le={modalDescriptionText:Xe,toastTitleText:Xe};if(ui==="success"){let fe=A,Be=y;He&&(fe=ii(He,v)||A,Be=ii(He,u)||y);const Ie="Add "+[Me(fe,v==null?void 0:v.symbol),Me(Be,u==null?void 0:u.symbol)].filter(Boolean).join(" and ");Le.toastDescriptionContent=Ie,Le.modalDescriptionText=Ie,Le.toastTitleText="Supplied Successful"}return Le}},s(X),console.log("ðŸš€ ~ toAdd ~ params:",be);const ee=await b(be);r=ee==null?void 0:ee.tx,K=ee==null?void 0:ee.msafeParams}const Re=await ji(r,X,{useMev:Se,useFastMode:ci==="Fast Mode",maxCapForGas:I,customGasPrice:ni,msafeParams:K});console.log("ðŸš€ ~ toClaim ~ res:",Re),Re?(Ti(),we(),f(""),a(P==null?void 0:P.address,e==null?void 0:e.id,!0)):e&&yi(e==null?void 0:e.clmmPool).then(ie=>{console.log("ðŸš€ ~ toClaim ~ res:",ie),F?U():_e()}),Ne(!1)}catch(r){console.log("ðŸš€ ~ toClaim ~ error:",r),F?U():_e(),ki(String(r)),Ne(!1)}};return x.useEffect(()=>{if(E==="increase"&&F){if(k!=null&&k.amount_a||k!=null&&k.amount_b){const p=e==null?void 0:e.tokenA,r=e==null?void 0:e.tokenB,K=ei(k==null?void 0:k.amount_a,p==null?void 0:p.decimals),X=ei(k==null?void 0:k.amount_b,r==null?void 0:r.decimals);q(e!=null&&e.isReverse?X:K),N(e!=null&&e.isReverse?K:X);return}q(""),N("")}},[F,k,e==null?void 0:e.isReverse]),x.useEffect(()=>(q(""),N(""),()=>{B(void 0)}),[]),{tokenAmountA:A,tokenAmountB:y,reCalculateResult:_e,preAddLoading:G,preAdd:j,getAddTsPayload:b,displayTokenA:v,displayTokenB:u,tokenABalanceInfo:je,tokenBBalanceInfo:ye,tokenAmountValueA:gi,tokenAmountValueB:ri,handleAmountChange:bi,resetInputAmount:we,btnStatusText:hi,toAdd:Ai,isAddLoading:wi,showTokenALock:ve,showTokenBLock:Ce,showDisplayTokenALock:ze,showDisplayTokenBLock:Ge,getClmmCreateAddData:R,getFarmsCreateAddData:V,currentPoolSqrtPrice:S}}function Cs(){var Y;const{currentPosBaseInfo:e,posPoolsRelatedData:o,posApiPoolData:d}=he(),{currentAccount:t,onWalletModal:W}=Ee(),{isFixedDisplayTokenA:c,curPosContractPoolInfo:g,useZapIn:s,currentPosPoolInfo:j}=ue(),{tokenAmountA:b,tokenAmountB:R,displayTokenA:V,displayTokenB:C,tokenABalanceInfo:M,tokenBBalanceInfo:a,tokenAmountValueA:l,tokenAmountValueB:L,handleAmountChange:S,preAddLoading:_,btnStatusText:z,toAdd:T,isAddLoading:E,showDisplayTokenALock:D,showDisplayTokenBLock:F,resetInputAmount:H,currentPoolSqrtPrice:O}=vs();x.useEffect(()=>()=>{H()},[]);const{getTokenAmountValue:U}=$e(),k=U(V==null?void 0:V.coin_type,b,"--"),f=U(C==null?void 0:C.coin_type,R,"--"),B=k=="--"||f=="--"?"--":$i(l).plus(L).toString(),G=o[e==null?void 0:e.posId],{currentApiPoolInfo:Z}=ds(e,d);return i.jsxs(J,{w:"100%",gap:"8px",children:[i.jsxs(Oe,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(Z==null?void 0:Z.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!D&&!F&&i.jsx(os,{action:"Deposit",resetInputAmount:H}),s?i.jsx(ls,{action:"Deposit",apiPoolInfo:Z,currentSqrtPrice:O,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(rs,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(M==null?void 0:M.balanceFormat)||"",value:b,amountValue:l,loading:!c&&_,onChange:Q=>{S(Q,!0)},placeholder:"0.0",token:V,lock:{isLock:e&&g&&D,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(a==null?void 0:a.balanceFormat)||"",value:R,amountValue:L,loading:c&&_,onChange:Q=>{S(Q,!1)},placeholder:"0.0",token:C,lock:{isLock:e&&g&&F,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:D||F?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!g||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),s?i.jsx(ts,{action:"Deposit",onClick:T,hideDepositRatio:!0,otherLoading:E}):i.jsxs(i.Fragment,{children:[i.jsx(qe,{onClick:()=>{t?T():W(!0)},isLoading:E,disabled:z.disabled||E,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:z.text}),B&&i.jsx(me,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(n,{w:"100%",justify:"space-between",children:[i.jsx(h,{children:"Total Amount"}),i.jsx(h,{color:"text_caption",children:xi(B,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&(j==null?void 0:j.farmsRewarderList)&&((Y=j==null?void 0:j.farmsRewarderList)==null?void 0:Y.length)>0&&i.jsx(xs,{}),G&&(G==null?void 0:G.minPrice)!=="0"&&(G==null?void 0:G.maxPrice)!=="âˆž"&&i.jsx(as,{subscriptionSource:"PositionDetail"})]})}function _s(){const{currentPosBaseInfo:e}=he(),{currentPosPoolInfo:o,curPosContractPoolInfo:d}=ue(),{setContractPoolInfo:t,setApiPoolInfo:W}=ys(),{lowerTickData:c,upperTickData:g,setLowerTickData:s,setUpperTickData:j}=Mi();Qi(()=>{W(o)},[o]);const b=(C,M,a)=>{var D,F;const l=(D=a==null?void 0:a.tokenA)==null?void 0:D.decimals,L=(F=a==null?void 0:a.tokenB)==null?void 0:F.decimals;let S;Math.abs(C)==Math.abs(Ji.getMinIndex(Number(a.tickSpacing)))?S=M==="lower"?"0":"âˆž":S=Ki.tickIndexToPrice(C,l,L).toString();const _=S==="âˆž"?"âˆž":pe(S,6),z=ws(S),T=z==="âˆž"?"âˆž":pe(z,6),E={id:M,tokenA:a==null?void 0:a.tokenA,tokenB:a==null?void 0:a.tokenB,tick:C,price:S,displayPrice:_,reversePrice:z,displayReversePrice:T,tickSpacing:a==null?void 0:a.tickSpacing,pool:a==null?void 0:a.poolAddress};M==="lower"?s({...E}):j({...E})},{getCurrentPrice:R}=ps();x.useEffect(()=>{e!=null&&e.lowerTick&&(d!=null&&d.current_sqrt_price)&&(o!=null&&o.poolAddress)&&(b(e==null?void 0:e.lowerTick,"lower",o),b(e==null?void 0:e.upperTick,"upper",o),R(d==null?void 0:d.current_sqrt_price,o),t(d))},[e==null?void 0:e.lowerTick,d==null?void 0:d.current_sqrt_price,o==null?void 0:o.poolAddress]);const V=x.useMemo(()=>(e==null?void 0:e.posId)&&(c==null?void 0:c.pool)&&(g==null?void 0:g.pool),[c==null?void 0:c.pool,g==null?void 0:g.pool,e==null?void 0:e.posId]);return i.jsx(Oe,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:V&&i.jsx(Ei,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?g:c,maxPriceData:e!=null&&e.isReverse?c:g,readonly:!0})})}function Rs(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posPoolsOriginalData:d}=he(),t=o[e==null?void 0:e.posId],{getClmmPosName:W}=oi(),c=x.useMemo(()=>{var b;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const R=(b=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:b.index;return W(e==null?void 0:e.index,R)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]);(t==null?void 0:t.displayFee)+"";const g=(t==null?void 0:t.currentStatus)=="Active",s=x.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",t);const b=t==null?void 0:t.minPriceOrigin,R=t==null?void 0:t.maxPriceOrigin;return b!=="0"&&R!=="âˆž"?Xi(1/(1-Number((b/R)**.25)),2)+"x":"1x"},[t==null?void 0:t.minPriceOrigin,t==null?void 0:t.maxPriceOrigin]),{getExplorerUrl:j}=mi();return i.jsxs(me,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(me,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(n,{justify:"space-between",children:[i.jsxs(n,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(n,{w:{base:"100%",lg:"unset"},children:[i.jsx(h,{children:"Position ID"}),i.jsx(ae,{isLoaded:!!c,children:i.jsx(h,{color:"text_caption",children:c==null?void 0:c.split("|")[1]})})]}),i.jsxs(n,{w:{base:"100%",lg:"unset"},children:[i.jsx(h,{children:"Position NFT"}),i.jsx(ae,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Ii,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(j(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),t&&i.jsx(hs,{isActive:g,isLoading:(t==null?void 0:t.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(n,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(J,{gap:{base:"16px",lg:"32px"},children:[i.jsxs(J,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(h,{color:"primary_gray",children:"Current Price"}),i.jsx(zi,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs(J,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(h,{color:"primary_gray",children:"Position Range"}),i.jsx(js,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:t==null?void 0:t.minPrice,maxPrice:t==null?void 0:t.maxPrice,minPriceResever:t==null?void 0:t.minPriceResever,maxPriceResever:t==null?void 0:t.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs(J,{gap:"0",children:[i.jsx(_s,{}),i.jsx(J,{zIndex:"9",children:i.jsxs(n,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(h,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(bs,{type:"leverage"}),i.jsx(ae,{ml:"4px",isLoaded:!!s&&!!t,children:i.jsx(h,{color:"primary",children:s})})]})})]})]})]})}function Dl(){var y,N;const e=Ci(),{fetchAccountBalance:o}=Qe(),{currentAccount:d}=Ee(),{position_nft_id:t}=_i(),{getCurrentPosBaseInfo:W}=Ue(),{curPosContractPoolInfo:c,currentPosDetailTab:g,currentPosPoolInfo:s,setCurrentPosDetailTab:j,setCurrentPosPoolInfo:b,setCurrentPoolSqrtPrice:R,setCurPosContractPoolInfo:V,setIsPosDetailRefresh:C,setUseZapIn:M}=ue(),{posPoolsRelatedData:a,currentPosBaseInfo:l,setCurrentPosBaseInfo:L,farmsPosRewardsData:S,posRewardsData:_}=he();console.log(l,"currentPosBaseInfo");const z=(((y=a[l==null?void 0:l.posId])==null?void 0:y.displayFee)||"--")+"%",T=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],E=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),C(!0),D(!0),f(),U(),o(),Y(),setTimeout(()=>{C(!1)},1e3)},D=(m=!1)=>{d!=null&&d.address&&t&&W(d==null?void 0:d.address,t,m)};x.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",t),D()},[d==null?void 0:d.address,t]),x.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:F}=$e(),H=S[l==null?void 0:l.id],O=_[l==null?void 0:l.posId],U=()=>{var u,Se;const m=(O==null?void 0:O.map(I=>I==null?void 0:I.coin_address))||[],$=(H==null?void 0:H.map(I=>I==null?void 0:I.rewarder_type))||[],De=[(u=l==null?void 0:l.tokenA)==null?void 0:u.coin_type,(Se=l==null?void 0:l.tokenB)==null?void 0:Se.coin_type].filter(Boolean),v=Array.from(new Set([...m,...De,...$]));F(v)};x.useEffect(()=>{U()},[l==null?void 0:l.posId,O==null?void 0:O.length,H==null?void 0:H.length]);const{getPoolList:k}=Ts(),f=async()=>{if(!(l!=null&&l.clmmPool))return;const m=await k({pool:l==null?void 0:l.clmmPool});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,m),m)return b(m==null?void 0:m.list[0])},{getPosPoolsOriginalObj:B,getPosPoolsRelatedData:G}=Hi(),{getPosLiquidityData:Z}=Zi(),Y=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const m=await B([l]);G([l],m);const $=m[l==null?void 0:l.clmmPool];console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo[currentPosBaseInfo?.clmmPool]:",$,c),($==null?void 0:$.current_sqrt_price)!==(c==null?void 0:c.current_sqrt_price)&&Z([l],m),m&&(R($==null?void 0:$.current_sqrt_price),V($))}},{setFromCoin:Q,setToCoin:w,fromCoin:de,toCoin:A}=ks();x.useEffect(()=>{f(),Y();let m;return l!=null&&l.clmmPool&&(m=setInterval(()=>{Y()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(Q(l==null?void 0:l.displayTokenA),w(l==null?void 0:l.displayTokenB)),()=>{clearInterval(m),Q(si.clmm_swap.from_coin),w(si.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),x.useEffect(()=>(j("increase"),d!=null&&d.address&&o(),()=>{V(null),L(null),b(null),M(!1)}),[]),us({onRpcChange:()=>{D(!0),Y(),d!=null&&d.address&&o()}});const{isApp:q}=Ye();return i.jsxs(J,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(n,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(n,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(As,{}),q&&i.jsxs(n,{children:[i.jsx(pi,{}),i.jsx(ai,{handleRefresh:E,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(n,{w:{base:"100%",lg:"unset"},children:[i.jsx(qe,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:m=>{e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!q&&i.jsx(ai,{handleRefresh:E,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(n,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(ae,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Li,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:z,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(n,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Fe,{label:"Pool APR",value:i.jsx(Ri,{poolInfo:s,children:i.jsxs(n,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(h,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:s!=null&&s.farmingAprDisplay||((N=s==null?void 0:s.miningAprList)==null?void 0:N.length)>0?"help":"text",children:s==null?void 0:s.feeAndMiningAprDisplay}),(s==null?void 0:s.haveFarming)&&i.jsxs(h,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",s==null?void 0:s.farmingAprDisplay]})]})}),loading:!(s!=null&&s.poolAddress)}),i.jsx(Fe,{label:"TVL",value:(s==null?void 0:s.tvlDisplay)||"",loading:!(s!=null&&s.poolAddress)}),i.jsx(Fe,{label:"Volume (24H)",value:(s==null?void 0:s.volume24Display)||"",loading:!(s!=null&&s.poolAddress)}),i.jsx(Fe,{label:"Fees (24H)",value:(s==null?void 0:s.fees24Display)||"",loading:!(s!=null&&s.poolAddress)})]})]}),i.jsxs(n,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(J,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(Rs,{}),i.jsx(Ss,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs(J,{w:{base:"100%",lg:"40%"},children:[i.jsx(me,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(n,{w:"100%",p:"0 16px",children:[i.jsx(fi,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:T,currentTab:g=="increase"?"Increase":"Remove",handleChangeTab:m=>{j(m==null?void 0:m.value)}}),!q&&i.jsx(pi,{})]})}),g=="increase"&&i.jsx(Cs,{}),g=="remove"&&i.jsx(ms,{})]})]})]})}const pi=()=>i.jsx(n,{children:i.jsx(Fi,{})});export{Dl as default};
//# sourceMappingURL=PositionDetail-CCN_ahvm.js.map
