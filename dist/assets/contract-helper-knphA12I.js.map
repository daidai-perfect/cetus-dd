{"version":3,"file":"contract-helper-knphA12I.js","sources":["../../src/hooks/burn/useBurn.ts","../../src/utils/contract-helper.ts"],"sourcesContent":["import { PoolApiInfo, PosBaseInfo } from '@/types'\nimport { useSdk } from '@cetus/sdk-factory'\nimport { Token } from '@cetus/types'\nimport { convertScientificToDecimal, d } from '@cetus/utils'\nimport { ClmmPoolUtil, TickMath } from '@cetusprotocol/common-sdk'\nimport { BN } from 'bn.js'\n\nexport default function useBurn() {\n  const burnSdk = useSdk('burn')\n\n  /**\n   * 获取Burn操作tx paylaod\n   * @param posBaseInfo\n   * @returns\n   */\n  const getBurnTxPayload = (posBaseInfo: PosBaseInfo) => {\n    const { posId, clmmPool, coinTypeA, coinTypeB } = posBaseInfo\n    const params = {\n      pos_id: posId,\n      pool_id: clmmPool,\n      coin_type_a: coinTypeA,\n      coin_type_b: coinTypeB\n    }\n\n    const tx = burnSdk!.Burn.createBurnPayload(params)\n\n    return tx\n  }\n\n  /**\n   * 获取Burn仓位Claim操作tx payload\n   * @param params\n   * @returns\n   */\n  const getBurnClaimTxPayload = (params: {\n    poolAddress: string\n    posId: string\n    coinTypeA: string\n    coinTypeB: string\n    account: string\n    rewarderCoinTypes: any\n  }) => {\n    const { poolAddress, posId, coinTypeA, coinTypeB, account, rewarderCoinTypes } = params\n\n    const txb = burnSdk!.Burn.createCollectFeesPayload([\n      {\n        pool_id: poolAddress,\n        pos_id: posId,\n        coin_type_a: coinTypeA,\n        coin_type_b: coinTypeB,\n        account\n      }\n    ])\n\n    const tx = burnSdk!.Burn.crateCollectRewardsPayload(\n      [\n        {\n          pool_id: poolAddress,\n          pos_id: posId,\n          coin_type_a: coinTypeA,\n          coin_type_b: coinTypeB,\n          rewarder_coin_types: rewarderCoinTypes,\n          account\n        }\n      ],\n      txb\n    )\n\n    return tx\n  }\n\n  const getCoinAmountFromLiquidity = (params: {\n    liquidity: string\n    lowerTick: number\n    upperTick: number\n    currentSqrtPrice: string\n    roundUp: boolean\n    defaultCoinA: Token\n    defaultCoinB: Token\n  }) => {\n    console.log('🚀🚀🚀 ~ file: usePositionList.ts:71 ~ getCoinAmountFromLiquidity ~ params:', params)\n    const lowerSqrtPrice = TickMath.tickIndexToSqrtPriceX64(params.lowerTick)\n    const upperSqrtPrice = TickMath.tickIndexToSqrtPriceX64(params.upperTick)\n    const result = ClmmPoolUtil.getCoinAmountFromLiquidity(\n      new BN(params.liquidity),\n      new BN(params.currentSqrtPrice),\n      lowerSqrtPrice,\n      upperSqrtPrice,\n      params.roundUp\n    )\n\n    const coinAAmount = convertScientificToDecimal(result.coin_amount_a.toString(), params.defaultCoinA?.decimals)\n    const coinBAmount = convertScientificToDecimal(result.coin_amount_b.toString(), params.defaultCoinB?.decimals)\n\n    return {\n      coinAAmount,\n      coinBAmount\n    }\n  }\n  const getBurnPositionAmountByPool = async (poolInfo: PoolApiInfo, current_sqrt_price: string) => {\n    const { poolAddress } = poolInfo\n    // const contractPoolInfo = await clmmSDK.Pool.getPool(address)\n    const positionList = (await burnSdk!.Burn.getPoolBurnPositionList(poolAddress)) || []\n    console.log('🚀🚀🚀 ~ file: useBurn.ts:92 ~ getBurnPositionAmountByPool ~ positionList:', positionList)\n    let totalA = d(0)\n    let totalB = d(0)\n    for (let i = 0; i < positionList?.length; i++) {\n      const position = positionList[i]\n      // 计算tokenA B数量\n      const { tick_lower_index, tick_upper_index, liquidity } = position\n      // const { current_sqrt_price } = contractPoolInfo\n      const defaultCoinA = poolInfo?.tokenA\n      const defaultCoinB = poolInfo?.tokenB\n      const { coinAAmount, coinBAmount } = getCoinAmountFromLiquidity({\n        lowerTick: tick_lower_index,\n        upperTick: tick_upper_index,\n        currentSqrtPrice: current_sqrt_price as string,\n        roundUp: false,\n        liquidity,\n        defaultCoinA: defaultCoinA as Token,\n        defaultCoinB: defaultCoinB as Token\n      })\n      totalA = d(totalA).add(d(coinAAmount))\n      totalB = d(totalB).add(d(coinBAmount))\n    }\n    return {\n      totalA: totalA.toString(),\n      totalB: totalB.toString()\n    }\n  }\n\n  return {\n    getBurnTxPayload,\n    getBurnClaimTxPayload,\n    getBurnPositionAmountByPool\n  }\n}\n","import { asIntN } from '@cetusprotocol/common-sdk'\nimport BN from 'bn.js'\n\nexport const deleteOx = (address: string) => {\n  if (address.startsWith('0x')) {\n    return address.slice(2)\n  }\n  return address\n}\n\nexport function getTickDataFromUrlData(ticks: any) {\n  const tickdatas: any[] = []\n  for (const tick of ticks) {\n    const td: any = {\n      objectId: tick.objectId,\n      index: Number(asIntN(BigInt(tick.index)).toString()),\n      sqrtPrice: tick.sqrtPrice,\n      liquidityNet: new BN(BigInt.asIntN(128, BigInt(BigInt(tick.liquidityNet.toString()))).toString()),\n      liquidityGross: tick.liquidityGross,\n      feeGrowthOutsideA: tick.feeGrowthOutsideA,\n      feeGrowthOutsideB: tick.feeGrowthOutsideB,\n      rewardersGrowthOutside: [new BN(tick.rewardersGrowthOutside[0]), new BN(tick.rewardersGrowthOutside[1]), new BN(tick.rewardersGrowthOutside[2])]\n    }\n    tickdatas.push(td)\n  }\n  return tickdatas\n}\n"],"names":["useBurn","burnSdk","useSdk","getBurnTxPayload","posBaseInfo","posId","clmmPool","coinTypeA","coinTypeB","params","getBurnClaimTxPayload","poolAddress","account","rewarderCoinTypes","txb","getCoinAmountFromLiquidity","lowerSqrtPrice","TickMath","upperSqrtPrice","result","ClmmPoolUtil","BN","coinAAmount","convertScientificToDecimal","_a","coinBAmount","_b","poolInfo","current_sqrt_price","positionList","totalA","d","totalB","i","position","tick_lower_index","tick_upper_index","liquidity","defaultCoinA","defaultCoinB","deleteOx","address","getTickDataFromUrlData","ticks","tickdatas","tick","td","asIntN"],"mappings":"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"}