import{h as C,e as I,i as L,M as x,a2 as F,aa as M,aD as h,d as _,r as v,q as S,W as O,aP as E,a0 as B,aQ as X,aR as $}from"./index-fbeVIhEM.js";import{a as q}from"./vendor-DYqnJE5Q.js";import{u as N}from"./useToken-DDjE5wHP.js";import{a as K}from"./useFavoritePool-DihHB75h.js";import{d as W,c as V,f as j,e as Y}from"./useGetPoolList-BbPXt71I.js";const U=(c,R)=>({showPosListLength:"",setShowPosListLength:r=>{c(()=>({showPosListLength:r}))},posApiPoolData:{},setPosApiPoolData:r=>{c(()=>({posApiPoolData:r}))},myPosYieldValue:"",setMyPosYieldValue:r=>{c(()=>({myPosYieldValue:r}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:r=>{const k=r.reduce((l,a)=>{var d,i,o;return l[a.clmmPool]||(l[a.clmmPool]={list:[]}),(d=l[a.clmmPool])!=null&&d.tokenA||(l[a.clmmPool].isReverse=a==null?void 0:a.isReverse,l[a.clmmPool].tokenA=a==null?void 0:a.tokenA,l[a.clmmPool].tokenB=a==null?void 0:a.tokenB,l[a.clmmPool].displayTokenA=a==null?void 0:a.displayTokenA,l[a.clmmPool].displayTokenB=a==null?void 0:a.displayTokenB,l[a.clmmPool].clmmPoolAddress=a.clmmPool),(o=(i=l[a.clmmPool])==null?void 0:i.list)==null||o.push(a),l},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",k),c(()=>({posBaseList:r,posBaseListGroupByPool:k,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:r=>{c(()=>({posBaseListLoading:r}))},setPosBaseListIsLoading:r=>{c(()=>({posBaseListLoading:r}))},fullRangePosBaseList:[],setFullRangePosBaseList:r=>{c(()=>({fullRangePosBaseList:r,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:r=>{c(()=>({fullRangePosBaseListLoading:r}))},posPoolsOriginalData:{},setPosPoolOriginalData:r=>{c(()=>({posPoolsOriginalData:r}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:r=>{c(()=>({posPoolsRelatedData:r,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:r=>{c(()=>({posPoolsRelatedDataLoading:r}))},posLiquidityData:{},setPosLiquidityData:r=>{c(()=>({posLiquidityData:r,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:r=>{c(()=>({posLiquidityDataLoading:r}))},posRewardsData:{},setPosRewardsData:r=>{c(()=>({posRewardsData:r,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:r=>{c(()=>({posRewardsDataLoading:r}))},farmsPosRewardsData:{},setFarmsPosRewardsData:r=>{c(()=>({farmsPosRewardsData:r,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:r=>{c(()=>({farmsPosRewardsDataLoading:r}))},posFeeData:{},setPosFeeData:r=>{c(()=>({posFeeData:r,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:r=>{c(()=>({posFeeDataLoading:r}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:r=>{c(()=>({currentPosBaseInfo:r,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:r=>{c(()=>({currentPosBaseInfoLoading:r}))}}),b=C(U);function H(){const{peripherySdk:c}=I(),{getTokenInfo:R}=N(),{setFarmsPosRewardsData:r,setFarmsPosRewardsDataLoading:k}=b(),l=q.useRef(c);return q.useEffect(()=>{l.current=c},[c.ClmmSDK.senderAddress]),{getFarmsRewardsData:async d=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",d),k(!0);const i=d==null?void 0:d.filter(o=>o.posType==="farms").map(o=>({pool_id:o.farmsPool,position_nft_id:o.id}));try{let o={},t={};if(i&&i.length>0&&(o=await l.current.Farms.calculateFarmingRewards(i),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",o,l.current.ClmmSDK.senderAddress,i),o)){const e=Object.entries(o).map(([g,n])=>({id:g,rewarderAmountOwed:n}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",e),t=Object.fromEntries(e.map((g,n)=>{for(const s of g.rewarderAmountOwed){const{rewarder_amount:m,rewarder_type:f}=s,P=R(f);s.display_amount_owed=L(m.toString(),(P==null?void 0:P.decimals)||0),s.amount_owed=m.toString(),s.token=P}return[g.id,g.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",t),r(t)}catch(o){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",o)}}}}function Q(){const{setPosApiPoolData:c}=b(),{getFavoritePoolList:R}=K();return{getPosApiPoolData:async k=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",k);const a={needLocalData:!1,pools:Array.from(new Set(k==null?void 0:k.map(o=>o.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",a);const d=await R(a)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",d);const i=d==null?void 0:d.list.reduce((o,t)=>(o[t.poolAddress]=t,o),{});c(i)}catch(l){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",l)}}}}function z(){const{clmmSdk:c}=x(),{setPosFeeData:R,setPosFeeDataLoading:r}=b();return{getPosFeeData:async l=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",l),r(!0);const a=l==null?void 0:l.map(o=>({poolAddress:o.clmmPool,positionId:o.posId,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",a);const d=await c.Position.fetchPosFeeAmount(a)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",d);const i=Object.fromEntries(d.map((o,t)=>{var s,m;const e=l[t],g=L(e.isReverse?o.feeOwedB.toString():o.feeOwedA.toString(),((s=e==null?void 0:e.displayTokenA)==null?void 0:s.decimals)||0),n=L(e.isReverse?o.feeOwedA.toString():o.feeOwedB.toString(),((m=e==null?void 0:e.displayTokenB)==null?void 0:m.decimals)||0);return[o.position_id,{feeOwedA:o.feeOwedA.toString(),feeOwedB:o.feeOwedB.toString(),displayFeeOwedA:g,displayFeeOwedB:n}]}));console.log("getPosFeeData ~ posFeesData:",i),R(i)}}}function J(){const{setPosLiquidityData:c,setPosLiquidityDataLoading:R}=b(),r=({tokenA:l,tokenB:a,liquidity:d,currentSqrtPrice:i,lowerTick:o,upperTick:t,roundUp:e})=>{const g=F.tickIndexToSqrtPriceX64(o),n=F.tickIndexToSqrtPriceX64(t),s=M.getCoinAmountFromLiquidity(new h(d),new h(i),g,n,e),m=s.coinA.toString(),f=s.coinB.toString(),P=l.decimals,y=a.decimals,p=L(m,P||0),u=L(f,y||0);return{coinAmountA:m,coinAmountB:f,amountA:p,amountB:u}};return{getPosLiquidityData:async(l,a)=>{R(!0);const d={};for(let i=0;i<l.length;i++){const o=l[i],t=a==null?void 0:a[o.clmmPool],{coinAmountA:e,coinAmountB:g,amountA:n,amountB:s}=r({tokenA:o.tokenA,tokenB:o.tokenB,liquidity:o.liquidity,currentSqrtPrice:t==null?void 0:t.current_sqrt_price,lowerTick:o.lowerTick,upperTick:o.upperTick,roundUp:!0}),m=W(o.lowerTick,o.upperTick),f=o.tokenA.decimals,P=o.tokenB.decimals,y=F.sqrtPriceX64ToPrice(new h(t==null?void 0:t.current_sqrt_price),f,P).toString(),{percentA:p,percentB:u}=V(n,s,y,m),A=L(e,f),D=L(g,P),T=_(D).div(y).add(A).toString(),w=_(A).mul(y).add(D).toString();d[o.posId]={coinAmountA:e,coinAmountB:g,displayCoinAmountA:o.isReverse?s:n,displayCoinAmountB:o.isReverse?n:s,displayPercentA:o.isReverse?u:p,displayPercentB:o.isReverse?p:u,onlyAmountA:T,onlyAmountB:w}}console.log("getPosLisuidityData ~ posLiquidityData:",d),c(d)},getCoinAmountFromLiquidity:r}}function Z(){const{clmmSdk:c}=x(),{setPosPoolOriginalData:R,setPosPoolsRelatedData:r,setPosPoolsRelatedDataLoading:k,setFullRangePosBaseList:l,setFullRangePosBaseListLoading:a}=b();return{getPosPoolsOriginalObj:async o=>{const t=o==null?void 0:o.map(n=>n.clmmPool),e=[...new Set([...t])];let g={};if(e&&e.length>0){const n=await c.Pool.getPools(e,0,1e3);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",n),g=Object.fromEntries(n==null?void 0:n.map(s=>{const m=o.find(u=>u.clmmPool===(s==null?void 0:s.poolAddress)),f=m.tokenA.decimals,P=m.tokenB.decimals,y=F.sqrtPriceX64ToPrice(new h(s==null?void 0:s.current_sqrt_price),f,P).toString(),p=_(1).div(y).toString();return[s==null?void 0:s.poolAddress,{...s,currentPrice:y,currentPriceReverse:p}]}))}return R(g),g},getPosPoolsRelatedData:(o,t)=>{k(!0),a(!0);const e={},g=[];o.forEach(n=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",n);const s=t[n.clmmPool],m=n.tokenA.decimals,f=n.tokenB.decimals,P=F.sqrtPriceX64ToPrice(new h(s==null?void 0:s.current_sqrt_price),m,f).toString(),y=_(1).div(P).toString();let p="0",u="0";j(n.lowerTick,"min")?p="0":p=F.tickIndexToPrice(Number(n.lowerTick),m,f).toString(),j(n.upperTick,"max")?u="âˆž":u=F.tickIndexToPrice(Number(n.upperTick),m,f).toString();let A,D;u!=="âˆž"?D=_(1).div(_(u)).toString():D="0",p!=="0"?A=_(1).div(_(p)).toString():A="âˆž";let T="";s!=null&&s.is_pause?T="Closed":Number(P)>=Number(p)&&(u==="âˆž"||Number(P)<=Number(u))?T="Active":(Number(P)>Number(u)||Number(P)<Number(p))&&(T="Inactive"),(p==="0"&&u==="âˆž"||A==="0"&&D==="âˆž")&&n.posType==="clmm"&&g.push(n);const w=n.isReverse;e[n.posId]={currentPrice:s?v(w?y:P).toString():"",currentPriceReverse:s?v(w?P:y).toString():"",minPrice:v(w?D:p).toString(),minPriceResever:v(w?p:D).toString(),maxPrice:v(w?A:u).toString(),maxPriceResever:v(w?u:A).toString(),minPriceOrigin:s?w?D:p:"",maxPriceOrigin:s?w?A:u:"",currentStatus:s?T:"",fee:s==null?void 0:s.fee_rate,displayFee:_(s==null?void 0:s.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:s==null?void 0:s.tickSpacing,currentTickIndex:s==null?void 0:s.current_tick_index,curSqrtPrice:s==null?void 0:s.current_sqrt_price,liquidity:s==null?void 0:s.liquidity}}),r(e),l(g)}}}function ee(){const{clmmSdk:c}=x(),{getTokenInfo:R}=N(),{setPosRewardsData:r,setPosRewardsDataLoading:k}=b();return{getPosRewardsData:async(a,d)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",a),k(!0);const i=a==null?void 0:a.filter(t=>t.posType!=="farms").map(t=>{const e=d[t.clmmPool];return{poolAddress:t.clmmPool,positionId:t.posId,coinTypeA:t.coinTypeA,coinTypeB:t.coinTypeB,rewarderInfo:e.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",i);let o={};if(i&&i.length>0)try{const t=await c.Rewarder.fetchPosRewardersAmount(i);o=Object.fromEntries(t.map((e,g)=>{for(const n of e.rewarderAmountOwed){const{amount_owed:s,coin_address:m}=n,f=R(m);n.display_amount_owed=L(s.toString(),(f==null?void 0:f.decimals)||0),n.amount_owed=s.toString(),n.token=f}return[e.positionId,e.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",o)}catch(t){console.log("getPosRewardsData ~ error:",t)}r(o)}}}function G(){const c=(d,i)=>{if(i||i==0)return`Cetus LP | Pool${i}-${d}`},R=q.useMemo(()=>`${S.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[S]),r=q.useMemo(()=>`${S.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[S]),k=q.useMemo(()=>`${S.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[S]);return{getClmmPosName:c,buildPositionType:R,buildFarmsPositionType:r,buildBurnPositionType:k,getTokenALock:(d,i)=>{if(O(d)&&O(i)){const{lowerTick:o,upperTick:t}=d,e=i==null?void 0:i.current_tick_index;if(e!==void 0&&o!==void 0&&t!==void 0)return e>=o&&e<t?!1:e>=t?!0:!(e<o)}return!1},getTokenBLock:(d,i)=>{if(O(d)&&O(i)){const{lowerTick:o,upperTick:t}=d,e=i==null?void 0:i.current_tick_index;if(e!==void 0&&o!==void 0&&t!==void 0)return e>=o&&e<t||e>=t?!1:(e<o,!0)}return!1}}}function oe(){const{buildPositionType:c,buildFarmsPositionType:R,buildBurnPositionType:r}=G(),{getTokenInfo:k}=N(),l=(t,e)=>{const g=!Y(t,e),n=k(t),s=k(e);return{isReverse:g,tokenA:n,tokenB:s,displayTokenA:g?s:n,displayTokenB:g?n:s}},a=t=>{var u;const e=E(t),g=B(e.coin_type_a).full_address,n=B(e.coin_type_b).full_address,{isReverse:s,tokenA:m,tokenB:f,displayTokenA:P,displayTokenB:y}=l(g,n),p=((u=t==null?void 0:t.data)==null?void 0:u.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:g,coinTypeB:n,posType:"clmm",tokenName:"",tokenA:m,tokenB:f,displayTokenA:P,displayTokenB:y,isReverse:s,version:p}},d=t=>{var u;const e=X.buildFramsPositionNFT(t),g=((u=t==null?void 0:t.data)==null?void 0:u.version)||"0",n=B(e.coinTypeA).full_address,s=B(e.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:P,displayTokenA:y,displayTokenB:p}=l(n,s);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:n,coinTypeB:s,posType:"farms",tokenName:e.name,isReverse:m,tokenA:f,tokenB:P,displayTokenA:y,displayTokenB:p,version:g}},i=t=>{var u,A,D;const e=$.buildBurnPositionNFT((A=(u=t==null?void 0:t.data)==null?void 0:u.content)==null?void 0:A.fields),g=((D=t==null?void 0:t.data)==null?void 0:D.version)||"0",n=B(e.coinTypeA).full_address,s=B(e.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:P,displayTokenA:y,displayTokenB:p}=l(n,s);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:n,coinTypeB:s,posType:"burn",tokenName:e.name,isReverse:m,tokenA:f,tokenB:P,displayTokenA:y,displayTokenB:p,version:g}};return{wrapClmmPosBaseInfo:a,wrapBurnPosBaseInfo:i,wrapFarmsPosBaseInfo:d,buildPosBaseInfo:t=>{const e=B(t.data.type);return e.full_address===c?a(t):e.full_address===R?d(t):e.full_address===r?i(t):null}}}function ie(){const{clmmSdk:c}=x(),{buildFarmsPositionType:R,buildBurnPositionType:r}=G(),{buildPosBaseInfo:k}=oe(),{setPosBaseList:l,setFullRangePosBaseList:a,setPosBaseListLoading:d}=b(),{getPosPoolsOriginalObj:i,getPosPoolsRelatedData:o}=Z(),{getPosLiquidityData:t}=J(),{getPosFeeData:e}=z(),{getPosApiPoolData:g}=Q(),{getPosRewardsData:n}=ee(),{getFarmsRewardsData:s}=H();return{getPositionBaseList:async(P,y)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",y),d(!0);try{const p=await c.fullClient.getOwnedObjectsByPage(P,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:S.clmm_sdk_options.clmm_pool.package_id},{StructType:R},{StructType:r}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",p);const u=[];for(const T of p.data){const w=k(T);_(w==null?void 0:w.liquidity).lte(0)||!(w!=null&&w.displayTokenA)||!(w!=null&&w.displayTokenB)||w&&u.push(w)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",u);const A=u.sort((T,w)=>w.version-T.version);let D=[];return y?D=A==null?void 0:A.filter(T=>T.clmmPool===y):D=A,l(D),d(!1),(D==null?void 0:D.length)==0&&a([]),D}catch(p){if(console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",p),p instanceof TypeError)return d(!1),l([]),"Something went wrong, please change the rpc node and try again"}},getPosRelatedData:async(P,y=!1)=>{var p;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",y,P),s(P),y||(g(P),e(P));try{const u=await i(P);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",u),o(P,u),((p=Object.keys(u))==null?void 0:p.length)>0&&(t(P,u),y||n(P,u))}catch(u){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",u)}}}}export{b as a,ie as b,z as c,ee as d,H as e,J as f,oe as g,G as u};
//# sourceMappingURL=usePositionList-D05K6WzV.js.map
