import{cw as se,r as H,dc as ie,bV as te,a0 as ne,cd as ae,d as Q,cM as de,cN as ue,dd as Z,de as le,aK as fe,al as ge,e as be,c$ as he,cy as Te,df as xe,dg as Se,dh as we}from"./index-B-qrdBiq.js";function me(e){try{return e&&e.includes("user")&&e.includes("reject")}catch{return!1}}function Ee(e){const t=String(e);return t.indexOf('Some("create_pool_internal")')>-1&&t.indexOf(" }, 1")>-1}function Ie(e){const t=String(e);return t.indexOf("withdraw_with_proof")>-1||t.indexOf("check_coin_threshold")>-1||t.indexOf('Identifier("balance")')>-1||t.indexOf("remove_liquidity")>-1&&(t.indexOf("in command 1")>-1||t.indexOf("in command 2")>-1||t.indexOf("in command 4")>-1||t.indexOf("in command 5")>-1)||t.indexOf("repay_add_liquidity")>-1&&(t.indexOf("in command 1")>-1||t.indexOf("in command 2")>-1||t.indexOf("in command 3")>-1||t.indexOf("in command 4")>-1||t.indexOf("in command 5")>-1)}function ve(e){return!!String(e).includes("Could not find the referenced transaction")}function Me(e){return!!String(e).includes("TRPCClientError:")}function je(e){const t=e.status,n=String(e);return!!([429,503,502,400].includes(t)||n.includes("Could not find the referenced object"))}function pe(e){return!!String(e).includes("Max cap reached.")}function Ae(e){return!!String(e).includes("Fast Mode service error")}function ke(e){return!!String(e).includes("The current operation does not support msafe wallet")}const ye=[{matcher:me,message:"User rejected the request"},{matcher:ve,message:"Oops. Failed to sync data from your txid. Please check your txn status from explorer or from your wallet."},{matcher:Me,message:e=>String(e).split(":")[1]},{matcher:je,message:"RPC loading failed. Try resubmission or check your network. You can also switch an RPC in settings to try again."},{matcher:pe,message:"Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed."},{matcher:Ae,message:"Fast Mode service error, please switch to the Default Transaction Mode or try again later."},{matcher:ke,message:"The current operation does not support msafe wallet."},{matcher:e=>String(e).includes("Transaction validator signing failed"),message:"Oops. Failed to pull your txid. Please check your txn status from explorer or from your wallet."},{matcher:Ie,message:"Exceeded price slippage"},{matcher:Ee,message:"Pool already exists"}];function Ce(e){for(const{matcher:t,message:n}of ye)if(t(e))return typeof n=="function"?n(e):n;return"Transaction failed"}const $={CETUS:"a",DEEPBOOK:"b",DEEPBOOKV3:"c",KRIYA:"d",KRIYAV3:"e",FLOWX:"f",FLOWXV3:"g",AFTERMATH:"h",TURBOS:"i",HAEDAL:"j",HAEDALPMM:"k",VOLO:"l",AFSUI:"m",BLUEMOVE:"n",SCALLOP:"o",SPRINGSUI:"p",BLUEFIN:"q",ALPHAFI:"r",STEAMM:"s",METASTABLE:"t",OBRIC:"u"};function oe(e,t,n){typeof window<"u"&&window.gtag&&window.gtag("event","track_shio_status",{operation_type:e,shio_enabled:t,tx_hash:n})}function Oe(e){console.log("ðŸš€ ~ file: gtag.ts:30 ~ trackTransaction ~ data:",e);const n=e.providers.map(o=>$==null?void 0:$[o]).join("");console.log("ðŸš€ ~ file: gtsag.ts:30 ~ trackTransaction ~ final data:",{...e,providers:n}),typeof window<"u"&&window.gtag&&window.gtag("event","track_transaction",{...e,providers:n})}function Fe(){const{setTransactionData:e,setTransactionModalVisible:t,manualCloseIdList:n}=se(),o=H.useRef(n);H.useEffect(()=>{o.current=n},[n]);const s=r=>{if(r){const S=o.current.includes(r);return S&&t(!1),S}return!1};return{transactionConfirmation:r=>{s(r.transactionId)||(e({...r,status:"confirmation"}),t(!0))},transactionSubmitted:r=>{s(r.transactionId)||(t(!1),e({...r,status:"submitted"}),t(!0))},transactionSuccess:r=>{s(r.transactionId)||(t(!1),e({...r,status:"success"}),t(!0))},transactionRejected:(r,S=n)=>{console.log("ðŸš€ ~ file: useTransactionModal.ts:10 ~ useTransactionModal ~ id 55:",n),!s(r.transactionId)&&(t(!1),e({...r,status:"rejected"}),t(!0))},closeTransactionModal:()=>{t(!1)}}}const Be="0x2::sui::SUI",_e="https://rpc.getshio.com/fast",Re="0x1889977f0fb56ae730e7bda8e8e32859ce78874458c74910d36121a81a615123",ee=[{objectId:"0xc32ce42eac951759666cbc993646b72387ec2708a2917c2c6fb7d21f00108c18",version:72869622},{objectId:"0x0289acae0edcdf1fe3aedc2e886bc23064d41c359e0179a18152a64d1c1c2b3e",version:327637282},{objectId:"0x03132160e8c2c45208abf3ccf165e82edcc42fee2e614afe54582f9740a808b8",version:327637282},{objectId:"0x072ae7307459e535379f422995a0d10132f12a3450298f8cf0cc07bd164f9999",version:327637282},{objectId:"0x1c1a96a2f4a34ea09ab15b8ff98f4b6b4338ce89f4158eb7d3eb2cd4dcbd6d86",version:327637282},{objectId:"0x20d76f37ad9f2421a9e6afaf3bb204250b1c2241c50e8a955e86a1a48767d06f",version:327637282},{objectId:"0x213ed368233cc7480fcb6336e70c5ae7ee106b2317ba02ccb5d0478e45bcc046",version:327637282},{objectId:"0x22ce1e80937354eba5549fed2937dc6e2b24026d03505bb51a3e4a64aa4142f6",version:327637282},{objectId:"0x26188cb7ce5ae633279f440f66081cb65cc585e428de18e194f8843e866f799f",version:327637282},{objectId:"0x38642f01422480128388d3e2948d3dc1b2680f9914077edb6bd3451ae1c5bcf0",version:327637282},{objectId:"0x3dd85b6424aea1cae9eff6e55456ca783e056226325f1362106eca8b3ed04ca0",version:327637282},{objectId:"0x42f8adc490542369d9c3b95e9f6eb70b2583102900feb7e103072ed49ba7fc3d",version:327637282},{objectId:"0x46b8158c82fa6bda7230d31a127d934c7295a0042083b4900f3096e9191f6f3f",version:327637282},{objectId:"0x6ebac88a8c3f7a4a9fb05ea49d188a1fe8520ae59ee736e0473004d3033512a4",version:327637282},{objectId:"0x6f55ad6cb40cfc124c11b11c19be0a80237b104acd955e7b52ccb7bf9046fe33",version:327637282},{objectId:"0x71aafb8bac986e82e5f78846bf3b36c2a82505585625207324140227a27ff279",version:327637282},{objectId:"0x7fe9b08680d4179de5672f213b863525b21f10604ca161538075e9338d1d2324",version:327637282},{objectId:"0x81538ef2909a3e0dd3d7f38bcbee191509bae4e8666272938ced295672e2ee8d",version:327637282},{objectId:"0x828eb6b3354ad68a23dd792313a16a0d888b7ea4fdb884bb22bd569f8e61319e",version:327637282},{objectId:"0x9705a332b8c1650dd7fe687ef9f9a9638afb51c30c0b34db150d60b920bc07eb",version:327637282},{objectId:"0x9918f73797a9390e9888b55454f2b31bc01de1a4634acab08f80641c4248e8a5",version:327637282},{objectId:"0x9cd4c08bdf2e132ec2cc77b0f03be60a94951e046d8e82ed5494f44e609edd2f",version:327637282},{objectId:"0xac8ce2033571140509788337c8a1f3aa8941a320ecd7047acda310d39cad9e03",version:327637282},{objectId:"0xbcd4527035265461a9a7b4f1e57c63ea7a6bdf0dc223c66033c218d880f928b1",version:327637282},{objectId:"0xbfdb691b8cc0b3c3a3b7a654f6682f3e53b164d9ee00b9582cdb4d0a353440a9",version:327637282},{objectId:"0xc2559d5c52ae04837ddf943a8c2cd53a5a0b512cee615d30d3abe25aa339465e",version:327637282},{objectId:"0xc56db634d02511e66d7ca1254312b71c60d64dc44bf67ea46b922c52d8aebba6",version:327637282},{objectId:"0xc84545cbff1b36b874ab2b69d11a3d108f23562e87550588c0bda335b27101e0",version:327637282},{objectId:"0xcc141659b5885043f9bfcfe470064819ab9ac667953bcedd1000e0652e90ee76",version:327637282},{objectId:"0xef6bf4952968d25d3e79f7e4db1dc38f2e9d99d61ad38f3829acb4100fe6383a",version:327637282},{objectId:"0xf2ed8d00ef829de5c4a3c5adf2d6b0f41f7fec005fb9c88e5616b98173b2fd66",version:327637282},{objectId:"0xfce73f3c32c3f56ddb924a04cabd44dd870b72954bbe7c3d7767c3b8c25c4326",version:327637282}];async function De(e){const t=e.client,n=await e.transaction.build({client:t,onlyTransactionKind:!0});let o=e.sender??e.transaction.getData().sender;if(!o)throw new Error("Sender need to be either set in options or in transaction data");return await t.call("shio_estimateFastModeFee",[o,e.transaction.getData().gasData.price,ie.from(n).toString("base64")])}function Le(){return ee[Math.floor(Math.random()*ee.length)]}async function Ue(e,t,n){return await e.executeTransactionBlock({transactionBlock:t.bytes,signature:t.signature,options:n})}async function qe(e,t,n){let o=e.moveCall({package:"0x2",module:"coin",function:"into_balance",typeArguments:[Be],arguments:[t]});return Ke(e,o,n)}async function Ke(e,t,n){let o=Le();e.moveCall({package:Re,module:"auctioneer",function:"submit_bid",arguments:[e.sharedObjectRef({objectId:o.objectId,mutable:!0,initialSharedVersion:o.version}),e.pure.u64(n),t]})}function Ne(){const{signTransactionBlock:e}=te(),{currentAccount:t}=ne(),n=async(o,s,i)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ useFastModeTransaction.ts:12 ~ getFastModeTx ~ getFastModeTx:",n);let b,T,x;try{const l=new ae({url:_e});o.setSender(t==null?void 0:t.address),o.setGasPrice(Number(i));const r=await De({transaction:o,client:l});console.log("ðŸš€ ~ getFastModeTx ~ estimatedFee:",r);const S=Q(s).mul(Math.pow(10,9)).toString();if(Q(r.gasBudget).gt(S))throw Error("Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed.");o.setGasBudget(r.gasBudget),console.log(r);const F=o.splitCoins(o.gas,[r.tipAmount]);qe(o,F[0],r.tipAmount);const A=await o.build({client:l}),I=await e(A);console.log("ðŸš€ ~ file: useTransaction.tsx:94 ~ useTransaction ~ signTx:",I);const{bytes:B,signature:k}=I;x=B,console.log("ðŸš€ ~ getFastModeTx ~ signTx:",I),T=new Date().getTime(),b=await Ue(l,I,{showEffects:!0,showEvents:!0}),console.log("ðŸš€ ~ getFastModeTx ~ result:",b)}catch(l){throw console.log("ðŸš€ ~ getFastModeTx ~ error:",l),console.log("ðŸš€ ~ getFastModeTx ~ String(error).includes(Failed to fetch):",String(l).includes("Failed to fetch")),String(l).includes("Failed to fetch")?Error("Fast Mode service error"):l}return{result:b,startExecuteTime:T,transactionBlockBytes:x}};return{getFastModeTx:n}}function Ve(){const e=de(),t=ue(),n=H.useMemo(()=>{if(!e.currentWallet)return null;const s=e.currentWallet.features["sui:signAndExecuteTransactionBlock"];return s?s.signAndExecuteTransactionBlock:null},[e]);return{getMsafeRes:async(s,i)=>{if(!t||!n)throw new Error("No account information");return s.setSender(t==null?void 0:t.address),await n({transactionBlock:s,account:t,chain:t==null?void 0:t.chains[0],action:i==null?void 0:i.action,txbParams:i==null?void 0:i.txbParams})}}}function We(){return{trackShio:(n,o,s)=>{const i=n==null?void 0:n.action;if(["FarmingOpenAndAddLiquidity","FarmingIncreaseLiquidity","FarmingDecreaseLiquidity","FarmingRemoveLiquidity","FarmingRemoveLiquidity","OpenAndAddLiquidity","IncreaseLiquidity","RemoveLiquidity","DecreaseLiquidity","AddVaultsPosition","RemoveVaultsPosition","AggregatorSwap"].includes(i))try{oe(i,o,s)}catch(T){console.log("ðŸš€ ~ useTransaction ~ trackShioEvent error:",T)}},trackSwap:(n,o,s)=>{var i,b,T,x;if(console.log("ðŸš€ ~ trackSwap ~ params:",n),console.log("ðŸš€ ~ trackSwap ~ error:",o),console.log("ðŸš€ ~ trackSwap ~ txHash:",s),o!=="User rejected the request")try{const l="Swap",r=new Date().getTime(),S=((i=n==null?void 0:n.providerKey)==null?void 0:i.length)>1,F=!!((b=n==null?void 0:n.routerData)!=null&&b.isDowngrade),A=(n==null?void 0:n.providerKey)||[],I=`${n==null?void 0:n.from}-${(T=n==null?void 0:n.routerData)==null?void 0:T.fromAmountUi}`,B=`${n==null?void 0:n.to}-${(x=n==null?void 0:n.routerData)==null?void 0:x.toAmountUi}`,k=!!o,v={action:l,actionTime:r,txHash:s,isOpenAggregator:S,isDowngrade:F,providers:A,fromCoin:I,toCoin:B,isError:!!o},_=String(o),y=_.length;if(v.errorMsgLength=y,y>100){let M=1;for(;M<=5;)v[`errorMsg${M}`]=_.slice((M-1)*100,(M-1)*100+100),M++}else k&&(v.errorMsg1=_);console.log("useTrack ðŸš€ ~ trackSwap ~ data:",v),Oe(v)}catch(l){console.log("ðŸš€ ~ useTrack ~ error:",l)}}}}var G={},Ye=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(G,"__esModule",{value:!0});var $e=G.executeAuction=ce;const He=Ye(le),Ge="https://rpc.getshio.com",Xe=500,Pe=300;function ce(e,t,n=Xe){const o={jsonrpc:"2.0",method:"shio_executeAuction",params:[e,t],id:1};return new Promise((s,i)=>{setTimeout(s,n),He.default.post(Ge,o,{headers:{"Content-Type":"application/json"},timeout:n}).then(b=>{console.log("Shio executeAuction response:",b.data),setTimeout(s,Pe)}).catch(i)})}G.default={executeAuction:ce};function Je(){const{signTransactionBlock:e,executeTransactionBlock:t,signAndExecuteTransactionBlock:n}=te(),{currentAccount:o}=ne(),{clmmSdk:s}=fe(),{transactionConfirmation:i,transactionSubmitted:b,transactionSuccess:T,transactionRejected:x,closeTransactionModal:l}=Fe(),{submittedTsToast:r,failedTsToast:S,successTsToast:F,closeToast:A}=ge();be();const{getFastModeTx:I}=Ne(),{getMsafeRes:B}=Ve(),{trackSwap:k}=We(),v=5,_=2e3;async function y(a,c=1){console.log("ðŸš€ ~ file: useTransaction.tsx:24 ~ getTransactionStatus ~ Checking transaction status, attempt:",c);try{let d;try{d=await s.fullClient.getTransactionBlock({digest:a,options:{showEvents:!0,showEffects:!0,showBalanceChanges:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0}})}catch{d=await s.fullClient.getTransactionBlock({digest:a,options:{showEvents:!0,showEffects:!0}})}if(console.log("ðŸš€ ~ file: useTransaction.tsx:28 ~ getTransactionStatus ~ response:",d),d)return d;throw new Error("Empty response")}catch(d){if(console.error(`Attempt ${c} failed:`,d),c>=v)throw new Error("Failed to fetch transaction status after maximum retries.");return await he(_),y(a,c+1)}}const M=async(a,c,{useDevInspect:d=!1,useMev:w=!1,txAction:j="signTransactionBlock",showSuccessModal:re=!0,useFastMode:K=!1,maxCapForGas:N="",customGasPrice:V="",msafeParams:m,otherParams:D}={})=>{var X,P,z,J;console.log("ðŸš€ ~ useTransaction ~ msafeParams:",m),console.log("ðŸš€ ~ useTransaction ~ otherParams:",D),console.log("ðŸš€ ~ file: useTransaction.tsx:76 ~ useTransaction ~ option:",{useDevInspect:d,useMev:w,txAction:j,tx:a,toastType:c,useFastMode:K,maxCapForGas:N,customGasPrice:V,msafeParams:m});const L=c.transactionId?c.transactionId:new Date().getTime().toString();c.transactionId=L,i(c);const W=(m==null?void 0:m.action)==="AggregatorSwap";let h="";try{let u,C,O;typeof a=="function"?O=await a():O=a;let R;if(K&&N&&V){console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:135 ~ useTransaction ~ res:");const g=await I(O,N,V);u=g.result,R=g.startExecuteTime,C=g.transactionBlockBytes}else if((X=Te)!=null&&X.inMSafeWallet())if(m)u=await B(O,m);else throw Error("The current operation does not support msafe wallet");else if(j==="signTransactionBlock"){const g=await e(O);R=new Date().getTime(),console.log("ðŸš€ ~ file: useTransaction.tsx:94 ~ useTransaction ~ signTx:",g);const{bytes:E,signature:p}=g;if(C=g.bytes,w)try{const U=await $e(E,p,500);console.log("ðŸš€ ~ file: useTransaction.tsx:92 ~ useTransaction ~ shioRes: success",U)}catch(U){console.log("ðŸš€ ~ file: useTransaction.tsx:95 ~ useTransaction ~ shioRes : error:",U)}console.log("ðŸš€ ~ useTransaction ~ useMev:",w),u=await t(E,p,d),console.log("ðŸš€ ~ useTransaction ~ response:",u)}else u=await n(O,d);if(h=u==null?void 0:u.digest,console.log("ðŸš€ ~ file: useTransaction.tsx:24 ~ signAndExecuteTransaction ~ response:",u),!h&&C){const g=xe(C);h=Se.getDigestFromBytes(g)}c.tx=h,b(c),c.isSwapWidget||r(c),A(L);let f;if(((P=u==null?void 0:u.effects)==null?void 0:P.status.status)==="success"?f=u:(console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:191 ~ useTransaction ~ digest:",h),f=await y(h,0)),!f||((z=f.effects)==null?void 0:z.status.status)==="failure"){const g=q(c,(J=f.effects)==null?void 0:J.status.error);W&&k(D,g,h)}else{if(R){const E=new Date().getTime(),p=(f==null?void 0:f.timestampMs)||0,Y=(p&&Number(p)>R?Math.min(E,Number(p)):E)-R;console.log("ðŸš€ ~ useTransaction ~ executeTime:",Y),Y<1e3&&(c.executeTime=Y)}const g=we(f,o==null?void 0:o.address,!1);if(console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:165 ~ useTransaction ~ res:",f),console.log("ðŸš€ ~ file: useTransaction.tsx:48 ~ signAndExecuteTransaction ~ balanceChanges:",g),c.getShowInfo){const E=c.getShowInfo("success",g,f);c.getShowInfo=p=>E}if(re?T(c):l(),c.isSwapWidget||(c.transactionId=void 0,F(c)),f&&!f.digest&&h&&(f.digest=h),m)try{oe(m.action,K||w,h)}catch(E){console.log("ðŸš€ ~ useTransaction ~ trackShioEvent error:",E)}return W&&k(D,"",h),f}}catch(u){console.log("ðŸš€ðŸš€ðŸš€ ~ useTransaction.tsx:253 ~ useTransaction ~ error:",u),L&&A(L);const C=q(c,u);W&&k(D,C,h)}},q=(a,c)=>{const d=Ce(c);if(console.error("ðŸš€ ~ file: useTransaction.tsx:270 ~ handleError ~ error:",{error:c,errorString:d}),a.getShowInfo){const w=a.getShowInfo("rejected");a.getShowInfo=j=>(w.toastDescriptionContent=d,w.modalDescriptionText=d,w),x(a),a.isSwapWidget||S(a)}else a.getShowInfo=w=>{const j={};return j.toastDescriptionContent=d,j.modalDescriptionText=d,j},x(a),a.isSwapWidget||S(a);return d};return{signAndExecuteTransaction:M,transactionSuccess:T,getTransactionStatus:y,transactionConfirmation:i,transactionRejected:x,handleError:q}}export{Fe as a,Je as u};
