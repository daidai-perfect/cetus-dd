import{a as i,j as e,V as F,T as C,f as N,u as j,v as $,H as R,S as X}from"./vendor-DYqnJE5Q.js";import{u as as}from"./ExpendItem-D8nrSWF5.js";import{a as Y,b as D}from"./usePositionList-DKv7WJr0.js";import{k as A,H as is,d as E,m as M,l as O,I as ns,a as q,c as ds}from"./index-WWPS4_2e.js";import{N as Z}from"./NoData-B27RAtoz.js";import{A as xs}from"./index-rlvi-7_T.js";import{V as ms,R as ps,S as gs,T as cs,F as hs,a as us}from"./FarmsTable-BmcBsNl6.js";import{R as bs}from"./RefreshButton-wIjLAatj.js";import{S as fs}from"./SortDropBlock-CwWGT2uK.js";import{u as js}from"./useGetPoolList-CMRSGTVw.js";import{u as Ls}from"./useAccountBalance-Bh-NvyHs.js";import{u as Ss}from"./useRpcListener-BZmBHZRe.js";import"./useTransaction-B0xyNeQf.js";import"./useSigner-rKW8msZz.js";import"./msafe-oYBkW7LJ.js";import"./SingleTokenInfo-BmePh6gD.js";import"./useToken-DKo5fk0k.js";import"./CopyButton-D1sHEEd7.js";import"./PriceRange-Bhwm_iq4.js";import"./PositionStatus-O7YT_I-Q.js";import"./RangeValue-C3CNy31o.js";import"./useFavoritePool-CnJfzn94.js";import"./useWrapPoolData-C8NJOF2n.js";import"./CoinPairInfo-DxzxlP2G.js";import"./PoweredByHaedal-COe4fDWI.js";import"./usePreviousValue-COG3o_Rs.js";function ys(s){const{totalRewards:n}=s,{currentAccount:r}=A(),{posBaseList:o}=Y(),{getPositionBaseList:p}=D(),{toClaimAllPos:l,claimLoading:g}=as(),c=i.useRef(null),d=async()=>{r!=null&&r.address&&await p(r==null?void 0:r.address)},L=()=>{l(o,d)};return i.useEffect(()=>{c!=null&&c.current&&(c.current.textContent=is(n,2))},[n]),e.jsx(F,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(F,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(C,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(C,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(r==null?void 0:r.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(j,{isLoaded:!!n,children:e.jsx(C,{color:"primary",fontSize:"20px",fontWeight:"500",ref:c})})}),(r==null?void 0:r.address)&&e.jsx($,{isLoading:g,disabled:g||n=="--"?!0:E(n).lte(0),h:"28px",fontSize:"14px",borderRadius:"8px",onClick:L,children:"Claim All Rewards"})]})})}function Ts({dataList:s,showSkeletonLoading:n,currTabLabel:r}){const{currentAccount:o,onWalletModal:p}=A();return e.jsx(e.Fragment,{children:r=="Your Farms"&&!(o!=null&&o.address)?e.jsx(Z,{type:"nowallet",onboard:()=>{p(!0)}}):n?e.jsx(Rs,{}):s.length===0?e.jsx(Z,{type:"nodata",text:"No farms found"}):e.jsx(F,{w:"100%",children:s.map(l=>e.jsx(vs,{apiInfo:l},l==null?void 0:l.poolAddress))})})}const vs=({apiInfo:s})=>{const{getTokenAmountValue:n}=M(),{coinPriceObj:r}=O();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:o,onWalletModal:p}=A(),[l,g]=i.useState({}),{farmsPosRewardsDataLoading:c,farmsPosRewardsData:d,posBaseListLoading:L,posBaseListGroupByPool:b}=Y(),_=i.useMemo(()=>{var S;if(!(o!=null&&o.address)||!(s!=null&&s.poolAddress))return"--";if(!L&&!c)return(((S=b[s.poolAddress])==null?void 0:S.list)||[]).reduce((h,x)=>{const T=d[x==null?void 0:x.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",h,T);const m=T.reduce((W,v)=>{if(W==="--")return"--";const f=n(v==null?void 0:v.token.coin_type,v==null?void 0:v.display_amount_owed,"--");return f==="--"?"--":E(W).plus(f).toString()},"0");return h==="--"||m==="--"?"--":E(h).plus(m).toString()},"0")},[L,d,c,r,o==null?void 0:o.address]),k=i.useMemo(()=>{var y,h;const S=((h=(y=b==null?void 0:b[s==null?void 0:s.poolAddress])==null?void 0:y.list)==null?void 0:h.filter(x=>x.posType!=="burn").sort((x,T)=>Number(T.liquidity)-Number(x.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",S),S},[s==null?void 0:s.poolAddress,b]);return e.jsxs(F,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(ms,{apiInfo:s}),e.jsx(V,{label:"Staked TVL",value:e.jsx(C,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(V,{label:"APR",value:e.jsx(xs,{poolInfo:s,isPosition:!0})}),e.jsx(V,{label:"Rewards / day",value:e.jsx(ps,{apiInfo:s})}),e.jsx(V,{label:"Your Staked",value:e.jsx(gs,{apiInfo:s})}),e.jsx(V,{label:"Your Earned",value:e.jsx(cs,{totalEarned:_,apiInfo:s,disabled:_=="--"?!0:E(_).lte(0)})}),e.jsx($,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{l[s==null?void 0:s.poolAddress]?l[s==null?void 0:s.poolAddress]=!1:l[s==null?void 0:s.poolAddress]=!0,g({...l})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(ns,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:l[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),l[s==null?void 0:s.poolAddress]&&e.jsx(hs,{expendList:k,apiInfo:s})]})},V=({label:s,value:n})=>e.jsxs(R,{w:"100%",justify:"space-between",children:[e.jsx(C,{children:s}),n]}),Rs=()=>e.jsx(F,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,n)=>e.jsxs(F,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(R,{gap:"0",children:[e.jsx(X,{size:"9"}),e.jsx(X,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(j,{height:"4",width:"150px"})]}),e.jsxs(R,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(j,{height:"4",width:"120px"}),e.jsx(j,{height:"4",width:"120px"})]}),e.jsxs(R,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(j,{height:"4",width:"120px"}),e.jsx(j,{height:"4",width:"120px"})]}),e.jsxs(R,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(j,{height:"4",width:"120px"}),e.jsx(j,{height:"4",width:"120px"})]}),e.jsxs(R,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(j,{height:"4",width:"120px"}),e.jsx(j,{height:"4",width:"120px"})]})]},n))});function ks(s){const{sortByList:n,currTab:r,tabList:o,handleChangeTab:p,currSortType:l,onSortByChange:g,sortRule:c,handleRefresh:d,handleChangeSortRule:L}=s,{isApp:b}=q();return e.jsxs(R,{w:"100%",mt:{base:"20px",lg:"40px"},justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[e.jsx(ds,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"415px"},h:"46px",borderRadius:{base:"8px",lg:"12px"}},itemStyle:{w:"50%",fontSize:"16px"},tabList:o,currentTab:r.label,handleChangeTab:p}),e.jsxs(R,{w:{base:"100%",lg:"unset"},children:[e.jsx(fs,{sortText:"Sort by",xlinkHref:c=="desc"?"#icon-icon_sort2":"#icon-icon_sort_asc1",iconOnClick:()=>{L(c==="asc"?"desc":"asc")},minW:b?"calc(100vw - 126px)":"120px",currentSort:l,sortByList:n,onSortByChange:g,wrapStyle:{borderRadius:{base:"8px",lg:"12px"}}}),e.jsx(bs,{handleRefresh:d,borderRadius:{base:"8px",lg:"12px"}})]})]})}function ws(){const{getPoolList:s}=js();return{getFarmList:async(r="-tvl")=>{var p;const o=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",o),(p=o==null?void 0:o.list)==null?void 0:p.sort((l,g)=>r==="-apr"?g.feeAndFarmsApr-l.feeAndFarmsApr:r==="apr"?l.feeAndFarmsApr-g.feeAndFarmsApr:r==="-tvl"?g.farmsStatedTvl-l.farmsStatedTvl:l.farmsStatedTvl-g.farmsStatedTvl)}}}function se(){const{currentAccount:s}=A(),{getPositionBaseList:n,getPosRelatedData:r}=D(),{posBaseList:o,posBaseListLoading:p,farmsPosRewardsData:l,farmsPosRewardsDataLoading:g}=Y(),{getFarmList:c}=ws(),[d,L]=i.useState([]),[b,_]=i.useState([]),[k,S]=i.useState([]),[y,h]=i.useState(!0),[x,T]=i.useState([]);Ls();const[m,W]=i.useState({label:"Live"}),v=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[f,G]=i.useState({sortRule:"desc",sortType:"tvl"}),[I,ss]=i.useState({label:"TVL",value:"tvl"}),es=i.useMemo(()=>{const t=[];return t.push({label:"Live",num:y?void 0:b.length.toString()}),t.push({label:"Your Farms",num:k.length>0&&(s!=null&&s.address)&&!y?k.length.toString():void 0}),t},[m.label,y,b,k,s==null?void 0:s.address]),J=async()=>{s!=null&&s.address?(await n(s==null?void 0:s.address),console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address)):T([])};i.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ posBaseList:",o),r(o,!0)},[JSON.stringify(o)]);const z=async t=>{const a=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,w=await c(a);w&&L(w)};i.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",x),d.length>0){if(m.label=="Live"&&(_(d),h(!1)),s!=null&&s.address&&(x==null?void 0:x.length)>0){const t=d.filter(a=>(x==null?void 0:x.filter(u=>(u==null?void 0:u.posType)==="farms")).some(u=>(a==null?void 0:a.poolAddress)===(u==null?void 0:u.clmmPool)));S(t)}else S([]);p||h(!1)}else _([]),S([])},[m.label,d,s==null?void 0:s.address,x,p]),i.useEffect(()=>{z(f),s!=null&&s.address?(h(!0),J()):T([])},[s==null?void 0:s.address]),i.useEffect(()=>{T(o)},[o]);const Q=()=>{h(!0),z(f),J()};Ss({onRpcChange:()=>{Q()}});const{fetchTokenPrices:ts}=M(),os=()=>{const t=[];d==null||d.forEach(a=>{var w,u;t.includes(a.tokenA.coin_type)||t.push(a.tokenA.coin_type),t.includes(a.tokenB.coin_type)||t.push(a.tokenB.coin_type),((w=a==null?void 0:a.farmsRewarderList)==null?void 0:w.length)>0&&((u=a==null?void 0:a.farmsRewarderList)==null||u.forEach(P=>{t.push(P==null?void 0:P.coinType)}))}),t.length>0&&ts(Array.from(new Set(t)))};i.useEffect(()=>{(d==null?void 0:d.length)>0&&os()},[d]);const{getTokenAmountValue:rs}=M(),{coinPriceObj:ls}=O(),K=i.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!p&&!g)return o.reduce((t,a)=>{const u=(l[a==null?void 0:a.id]||[]).reduce((P,B)=>{if(P==="--")return"--";const U=rs(B==null?void 0:B.token.coin_type,B==null?void 0:B.display_amount_owed,"--");return U==="--"?"--":E(P).plus(U).toString()},"0");return t==="--"||u==="--"?"--":E(t).plus(u).toString()},"0")},[p,l,g,ls,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",K);const{isApp:H}=q();return e.jsxs(F,{gap:"20px",w:"100%",children:[e.jsx(ys,{totalRewards:K}),e.jsx(N,{h:"220px"}),e.jsx(ks,{sortByList:v,currTab:m,tabList:es,handleChangeTab:t=>{W(t)},currSortType:I,onSortByChange:t=>{h(!0),f.sortType=t.value,G({...f}),ss(t),z(f)},sortRule:f.sortRule,handleChangeSortRule:t=>{h(!0),f.sortRule=t,G({...f}),z(f)},handleRefresh:Q}),H&&e.jsx(C,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!H&&e.jsx(us,{dataList:m.label=="Live"?b:k,showSkeletonLoading:y,currTabLabel:m==null?void 0:m.label}),H&&e.jsx(Ts,{dataList:m.label=="Live"?b:k,showSkeletonLoading:y,currTabLabel:m==null?void 0:m.label})]})}export{se as default};
//# sourceMappingURL=Farms-etWJf34u.js.map
