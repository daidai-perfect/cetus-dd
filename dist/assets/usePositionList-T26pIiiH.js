import{Q as $,l as q,r as b,a8 as S,aQ as V,aJ as v,d as T,x as B,aH as C,v as x,b9 as W,ba as Y,a1 as h,bb as H,p as L,bc as Q,bd as J}from"./index-kSv1GEZK.js";import{a as j}from"./vendor-BFGDaAdA.js";import{u as O}from"./useToken-D3gZx9-B.js";import{u as M}from"./useFavoritePool-CZ2tR_8p.js";import{d as U,c as Z,C as z,f as G,e as K}from"./useGetPoolList-CK7rGDcp.js";const ee=(p,D)=>({showPosListLength:"",setShowPosListLength:n=>{p(()=>({showPosListLength:n}))},posApiPoolData:{},setPosApiPoolData:n=>{const _=D().posApiPoolData;p(()=>({posApiPoolData:{..._,...n}}))},myPosYieldValue:"",setMyPosYieldValue:n=>{p(()=>({myPosYieldValue:n}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:n=>{const _=n.reduce((y,i)=>{var c,d,a;return y[i.clmmPool]||(y[i.clmmPool]={list:[]}),(c=y[i.clmmPool])!=null&&c.tokenA||(y[i.clmmPool].isReverse=i==null?void 0:i.isReverse,y[i.clmmPool].tokenA=i==null?void 0:i.tokenA,y[i.clmmPool].tokenB=i==null?void 0:i.tokenB,y[i.clmmPool].displayTokenA=i==null?void 0:i.displayTokenA,y[i.clmmPool].displayTokenB=i==null?void 0:i.displayTokenB,y[i.clmmPool].clmmPoolAddress=i.clmmPool),(a=(d=y[i.clmmPool])==null?void 0:d.list)==null||a.push(i),y},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",_),p(()=>({posBaseList:n,posBaseListGroupByPool:_,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:n=>{p(()=>({posBaseListLoading:n}))},fullRangePosBaseList:[],setFullRangePosBaseList:n=>{p(()=>({fullRangePosBaseList:n,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:n=>{p(()=>({fullRangePosBaseListLoading:n}))},posPoolsOriginalData:{},setPosPoolOriginalData:n=>{p(()=>({posPoolsOriginalData:n}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:n=>{const _=D().posPoolsRelatedData;p(()=>({posPoolsRelatedData:{..._,...n},posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:n=>{p(()=>({posPoolsRelatedDataLoading:n}))},posLiquidityData:{},setPosLiquidityData:n=>{const _=D().posLiquidityData;p(()=>({posLiquidityData:{..._,...n},posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:n=>{p(()=>({posLiquidityDataLoading:n}))},posRewardsData:{},setPosRewardsData:n=>{const _=D().posRewardsData;p(()=>({posRewardsData:{..._,...n},posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:n=>{p(()=>({posRewardsDataLoading:n}))},farmsPosRewardsData:{},setFarmsPosRewardsData:n=>{p(()=>({farmsPosRewardsData:n,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:n=>{p(()=>({farmsPosRewardsDataLoading:n}))},posFeeData:{},setPosFeeData:n=>{const _=D().posFeeData;p(()=>({posFeeData:{..._,...n},posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:n=>{p(()=>({posFeeDataLoading:n}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:n=>{p(()=>({currentPosBaseInfo:n,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:n=>{p(()=>({currentPosBaseInfoLoading:n}))}}),F=$(ee);function oe(){const p=q("farms"),{getTokenListInfo:D}=O(),{setFarmsPosRewardsData:n,setFarmsPosRewardsDataLoading:_}=F();return{getFarmsRewardsData:async c=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",c),_(!0);const d=c==null?void 0:c.filter(a=>a.posType==="farms").map(a=>({pool_id:a.farmsPool,position_nft_id:a.id}));try{let a={};if(d&&d.length>0){const s=await p.Farms.calculateFarmingRewards(d);if(console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",s,p.getSenderAddress(),d),s){const e=Object.entries(s).map(([o,u])=>({id:o,rewarderAmountOwed:u}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",e);const r=e.map(o=>o.rewarderAmountOwed.map(u=>u.rewarder_type)).flat(),t=await D(r);a=Object.fromEntries(e.map((o,u)=>{for(const f of o.rewarderAmountOwed){const{rewarder_amount:m,rewarder_type:w}=f,g=t==null?void 0:t.get(w);f.display_amount_owed=b(m.toString(),(g==null?void 0:g.decimals)||0),f.amount_owed=m.toString(),f.token=g}return[o.id,o.rewarderAmountOwed]}))}}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",a),n(a)}catch(a){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",a)}},formatFarmsRewardsData:async c=>{let d={};const a=Object.entries(c).map(([r,t])=>({id:r,rewarderAmountOwed:t}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",a);const s=a.map(r=>r.rewarderAmountOwed.map(t=>t.rewarder_type)).flat(),e=await D(s);return d=Object.fromEntries(a.map((r,t)=>{for(const o of r.rewarderAmountOwed){const{rewarder_amount:u,rewarder_type:f}=o,m=e==null?void 0:e.get(f);o.display_amount_owed=b(u.toString(),(m==null?void 0:m.decimals)||0),o.amount_owed=u.toString(),o.token=m}return[r.id,r.rewarderAmountOwed]})),d}}}function se(){const{setPosApiPoolData:p}=F(),{getFavoritePoolList:D}=M();return{getPosApiPoolData:async _=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",_);const i={needLocalData:!1,pools:Array.from(new Set(_==null?void 0:_.map(a=>a.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",i);const c=await D(i)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",c);const d=c==null?void 0:c.list.reduce((a,s)=>(a[s.poolAddress]=s,a),{});p(d)}catch(y){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",y)}}}}function te(){const p=q("clmm"),{setPosFeeData:D,setPosFeeDataLoading:n}=F(),_=async i=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",i),n(!0);const c=i==null?void 0:i.map(s=>({pool_id:s.clmmPool,position_id:s.posId,coin_type_a:s.coinTypeA,coin_type_b:s.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",c);const d=await p.Position.fetchPosFeeAmount(c)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",d);const a=await y(d,i);console.log("getPosFeeData ~ posFeesData:",a),D(a)},y=async(i,c)=>Object.fromEntries(i.map((a,s)=>{var o,u;const e=c[s],r=b(e.isReverse?a.fee_owned_b.toString():a.fee_owned_a.toString(),((o=e==null?void 0:e.displayTokenA)==null?void 0:o.decimals)||0),t=b(e.isReverse?a.fee_owned_a.toString():a.fee_owned_b.toString(),((u=e==null?void 0:e.displayTokenB)==null?void 0:u.decimals)||0);return[a.position_id,{feeOwedA:a.fee_owned_a.toString(),feeOwedB:a.fee_owned_b.toString(),displayFeeOwedA:r,displayFeeOwedB:t}]}));return{getPosFeeData:_,formatPosFeeData:y}}function ae(){const{setPosLiquidityData:p,setPosLiquidityDataLoading:D}=F(),{getTokenInfo:n}=O(),_=({tokenA:i,tokenB:c,liquidity:d,currentSqrtPrice:a,lowerTick:s,upperTick:e,roundUp:r})=>{const t=S.tickIndexToSqrtPriceX64(s),o=S.tickIndexToSqrtPriceX64(e),u=V.getCoinAmountFromLiquidity(new v(d),new v(a),t,o,r),f=u.coin_amount_a.toString(),m=u.coin_amount_b.toString(),w=i.decimals,g=c.decimals,l=b(f,w||0),P=b(m,g||0);return{coinAmountA:f,coinAmountB:m,amountA:l,amountB:P}};return{getPosLiquidityData:async(i,c)=>{var a,s;D(!0);const d={};for(let e=0;e<i.length;e++){const r=i[e],t=c==null?void 0:c[r.clmmPool],{coinAmountA:o,coinAmountB:u,amountA:f,amountB:m}=_({tokenA:r.tokenA,tokenB:r.tokenB,liquidity:r.liquidity,currentSqrtPrice:t==null?void 0:t.current_sqrt_price,lowerTick:r.lowerTick,upperTick:r.upperTick,roundUp:!0}),w=U(r.lowerTick,r.upperTick);let g=r.tokenA.decimals,l=r.tokenB.decimals;g==null&&(g=(a=await n(r.tokenA.coin_type))==null?void 0:a.decimals),l==null&&(l=(s=await n(r.tokenB.coin_type))==null?void 0:s.decimals);const P=S.sqrtPriceX64ToPrice(new v(t==null?void 0:t.current_sqrt_price),g,l).toString(),{percentA:k,percentB:A}=Z(f,m,P,w),R=b(o,g),N=b(u,l),I=T(N).div(P).add(R).toString(),X=T(R).mul(P).add(N).toString();d[r.posId]={coinAmountA:o,coinAmountB:u,displayCoinAmountA:r.isReverse?m:f,displayCoinAmountB:r.isReverse?f:m,displayPercentA:r.isReverse?A:k,displayPercentB:r.isReverse?k:A,onlyAmountA:I,onlyAmountB:X}}console.log("getPosLisuidityData ~ posLiquidityData:",d),p(d)},getCoinAmountFromLiquidity:_}}function re(){const p=q("clmm"),{setPosPoolOriginalData:D,setPosPoolsRelatedData:n,setPosPoolsRelatedDataLoading:_,setFullRangePosBaseList:y,setFullRangePosBaseListLoading:i}=F();return{getPosPoolsOriginalObj:async a=>{const s=a==null?void 0:a.map(t=>t.clmmPool),e=[...new Set([...s])];let r={};if(e&&e.length>0){const t=await p.Pool.getAssignPools(e);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",t),r=Object.fromEntries(t==null?void 0:t.map(o=>{var l;const u=a.find(P=>P.clmmPool===(o==null?void 0:o.id)),f=u.tokenA.decimals,m=u.tokenB.decimals,w=S.sqrtPriceX64ToPrice(new v(o==null?void 0:o.current_sqrt_price),f,m).toString(),g=T(1).div(w).toString();return[o==null?void 0:o.id,{...o,currentPrice:w,currentPriceReverse:g,coinAmountA:String(o.coin_amount_a),coinAmountB:String(o.coin_amount_b),coinTypeA:o.coin_type_a,coinTypeB:o.coin_type_b,poolAddress:o.id,poolType:o.pool_type,tickSpacing:Number(o.tick_spacing),current_sqrt_price:String(o.current_sqrt_price),fee_growth_global_a:String(o.fee_growth_global_a),fee_growth_global_b:String(o.fee_growth_global_b),fee_protocol_coin_a:String(o.fee_protocol_coin_a),fee_protocol_coin_b:String(o.fee_protocol_coin_b),fee_rate:((l=z)==null?void 0:l[o.id])||String(o.fee_rate),liquidity:String(o.liquidity),rewarder_infos:o.rewarder_infos.map(P=>({coinAddress:P.coin_type,emissionsEveryDay:P.emissions_per_second,emissions_per_second:String(P.emissions_per_second),growth_global:String(P.growth_global)}))}]}))}return D(r),r},getPosPoolsRelatedData:(a,s)=>{_(!0),i(!0);const e={},r=[];a.forEach(t=>{const o=s[t.clmmPool],u=t.tokenA.decimals,f=t.tokenB.decimals,m=S.sqrtPriceX64ToPrice(new v(o==null?void 0:o.current_sqrt_price),u,f).toString(),w=T(1).div(m).toString();let g="0",l="0";G(t.lowerTick,"min")?g="0":g=S.tickIndexToPrice(Number(t.lowerTick),u,f).toString(),G(t.upperTick,"max")?l="âˆž":l=S.tickIndexToPrice(Number(t.upperTick),u,f).toString();let P,k;l!=="âˆž"?k=T(1).div(T(l)).toString():k="0",g!=="0"?P=T(1).div(T(g)).toString():P="âˆž";let A="";o!=null&&o.is_pause?A="Closed":Number(m)>=Number(g)&&(l==="âˆž"||Number(m)<=Number(l))?A="Active":(Number(m)>Number(l)||Number(m)<Number(g))&&(A="Inactive"),(g==="0"&&l==="âˆž"||P==="0"&&k==="âˆž")&&t.posType==="clmm"&&r.push(t);const R=t.isReverse;e[t.posId]={currentPrice:o?B(R?w:m).toString():"",currentPriceReverse:o?B(R?m:w).toString():"",minPrice:B(R?k:g).toString(),minPriceResever:B(R?g:k).toString(),maxPrice:B(R?P:l).toString(),maxPriceResever:B(R?l:P).toString(),minPriceOrigin:o?R?k:g:"",maxPriceOrigin:o?R?P:l:"",currentStatus:o?A:"",fee:o==null?void 0:o.fee_rate,displayFee:T(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),n(e),y(r)}}}function ne(){const p=q("clmm"),{getTokenListInfo:D}=O(),{setPosRewardsData:n,setPosRewardsDataLoading:_}=F();return{formatPosRewardsData:async c=>{let d={};const a=c==null?void 0:c.map(e=>e.rewarderAmountOwed.map(r=>r.coin_address)).flat(),s=await D(a);return d=Object.fromEntries(c.map(e=>{for(const r of e.rewarderAmountOwed){const{amount_owed:t,coin_address:o}=r,u=s==null?void 0:s.get(o);r.display_amount_owed=b(t.toString(),(u==null?void 0:u.decimals)||0),r.amount_owed=t.toString(),r.token=u}return[e.positionId,e.rewarderAmountOwed]})),d},getPosRewardsData:async(c,d)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",c),_(!0);const a=c==null?void 0:c.filter(e=>e.posType!=="farms").map(e=>{var t;const r=d[e.clmmPool];return{pool_id:e.clmmPool,position_id:e.posId,coin_type_a:e.coinTypeA,coin_type_b:e.coinTypeB,rewarder_types:(t=r.rewarder_infos)==null?void 0:t.map(o=>o.coinAddress)}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",a);let s={};if(a&&a.length>0)try{const e=await p.Rewarder.fetchPosRewardersAmount(a),r=e==null?void 0:e.map(u=>u.rewarder_amounts.map(f=>f.coin_type)).flat(),t=await D(r);let o;s=Object.fromEntries(e.map((u,f)=>{o=[];for(const m of u.rewarder_amounts){const{amount_owned:w,coin_type:g}=m,l=t==null?void 0:t.get(g);o.push({...m,display_amount_owed:b(w.toString(),(l==null?void 0:l.decimals)||0),amount_owed:w.toString(),token:l,coin_address:g})}return[u.position_id,o]})),console.log("getPosRewardsData ~ posRewardsData:",s)}catch(e){console.log("getPosRewardsData ~ error:",e)}n(s)}}}function E(){const p=(c,d)=>{if(d||d==0)return`Cetus LP | Pool${d}-${c}`},D=j.useMemo(()=>`${C.clmm_pool.package_id}::position::Position`,[x]),n=j.useMemo(()=>`${W.farms.package_id}::pool::WrappedPositionNFT`,[x]),_=j.useMemo(()=>`${Y.burn.package_id}::lp_burn::CetusLPBurnProof`,[x]);return{getClmmPosName:p,buildPositionType:D,buildFarmsPositionType:n,buildBurnPositionType:_,getTokenALock:(c,d)=>{if(h(c)&&h(d)){const{lowerTick:a,upperTick:s}=c,e=d==null?void 0:d.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s?!1:e>=s?!0:!(e<a)}return!1},getTokenBLock:(c,d)=>{if(h(c)&&h(d)){const{lowerTick:a,upperTick:s}=c,e=d==null?void 0:d.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s||e>=s?!1:(e<a,!0)}return!1}}}function ie(){const{buildPositionType:p,buildFarmsPositionType:D,buildBurnPositionType:n}=E(),{getTokenListInfo:_}=O(),y=async(s,e)=>{const r=!K(s,e),t=await _([s,e]),o=t==null?void 0:t.get(s),u=t==null?void 0:t.get(e);return{isReverse:r,tokenA:o,tokenB:u,displayTokenA:r?u:o,displayTokenB:r?o:u}},i=async s=>{var l;const e=H(s),r=L(e.coin_type_a).full_address,t=L(e.coin_type_b).full_address,{isReverse:o,tokenA:u,tokenB:f,displayTokenA:m,displayTokenB:w}=await y(r,t),g=((l=s==null?void 0:s.data)==null?void 0:l.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:r,coinTypeB:t,posType:"clmm",tokenName:"",tokenA:u,tokenB:f,displayTokenA:m,displayTokenB:w,isReverse:o,version:g}},c=async s=>{var l;const e=Q.buildFarmsPositionNFT(s),r=((l=s==null?void 0:s.data)==null?void 0:l.version)||"0",t=L(e.coin_type_a).full_address,o=L(e.coin_type_b).full_address,{isReverse:u,tokenA:f,tokenB:m,displayTokenA:w,displayTokenB:g}=await y(t,o);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:t,coinTypeB:o,posType:"farms",tokenName:e.name,isReverse:u,tokenA:f,tokenB:m,displayTokenA:w,displayTokenB:g,version:r}},d=async s=>{var l,P,k;const e=J.buildBurnPositionNFT((P=(l=s==null?void 0:s.data)==null?void 0:l.content)==null?void 0:P.fields),r=((k=s==null?void 0:s.data)==null?void 0:k.version)||"0",t=L(e.coin_type_a).full_address,o=L(e.coin_type_b).full_address,{isReverse:u,tokenA:f,tokenB:m,displayTokenA:w,displayTokenB:g}=await y(t,o);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:t,coinTypeB:o,posType:"burn",tokenName:e.name,isReverse:u,tokenA:f,tokenB:m,displayTokenA:w,displayTokenB:g,version:r}};return{wrapClmmPosBaseInfo:i,wrapBurnPosBaseInfo:d,wrapFarmsPosBaseInfo:c,buildPosBaseInfo:async s=>{const e=L(s.data.type);return e.full_address===p?await i(s):e.full_address===D?await c(s):e.full_address===n?await d(s):null}}}function Pe(){const p=q("clmm"),{buildFarmsPositionType:D,buildBurnPositionType:n}=E(),{buildPosBaseInfo:_}=ie(),{setPosBaseList:y,setFullRangePosBaseList:i,setPosBaseListLoading:c}=F(),{getPosPoolsOriginalObj:d,getPosPoolsRelatedData:a}=re(),{getPosLiquidityData:s}=ae(),{getPosFeeData:e}=te(),{getPosApiPoolData:r}=se(),{getPosRewardsData:t}=ne(),{getFarmsRewardsData:o}=oe(),u=async(w,g)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",g),c(!0);try{const l=await p.FullClient.getOwnedObjectsByPage(w,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:C.clmm_pool.package_id},{StructType:D},{StructType:n}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",l);let P=await f(l,g);return y(P),c(!1),(P==null?void 0:P.length)==0&&i([]),P}catch(l){return console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",l),l instanceof TypeError?(c(!1),y([]),[]):[]}},f=async(w,g)=>{const l=[];for(const A of w.data){const R=await _(A);T(R==null?void 0:R.liquidity).lte(0)||!(R!=null&&R.displayTokenA)||!(R!=null&&R.displayTokenB)||R&&l.push(R)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",l);const P=l.sort((A,R)=>R.version-A.version);let k=[];return g?k=P==null?void 0:P.filter(A=>A.clmmPool===g):k=P,k};return{formatPosBaseList:f,getPositionBaseList:u,getPosRelatedData:async(w,g=!1)=>{var l;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",g,w),o(w),g||(console.log("ðŸš€ ~ getPosRelatedData ~ isFarms:",w),r(w),e(w));try{const P=await d(w);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",P),a(w,P),((l=Object.keys(P))==null?void 0:l.length)>0&&(s(w,P),g||t(w,P))}catch(P){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",P)}}}}export{F as a,te as b,ne as c,E as d,re as e,ae as f,se as g,oe as h,ie as i,Pe as u};
//# sourceMappingURL=usePositionList-T26pIiiH.js.map
