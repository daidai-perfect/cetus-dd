import{P as T,A as w}from"./index-ChSVVHaJ.js";import"./vendor-BFGDaAdA.js";function S(){const{notifiClient:n}=T(),{setDefaultTargetGroup:g,setEmailTarget:p,setTelegramTarget:m,setSmsTarget:d,setNotifiLoginLoading:u}=T(),c=e=>{e.emailTargets&&e.emailTargets.length>0&&p(e.emailTargets.slice(-1)[0]),e.telegramTargets&&(e==null?void 0:e.telegramTargets.length)>0&&m(e.telegramTargets.slice(-1)[0]),e.smsTargets&&(e==null?void 0:e.smsTargets.length)>0&&d(e.smsTargets.slice(-1)[0])};return{getNotifiTargetGroups:async e=>{try{const s=e?await e.getTargetGroups():await n.getTargetGroups();if(console.log("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:8 ~ getNotifiTargetGroups ~ targetGroup:",s),(s==null?void 0:s.length)>0){const o=s[0];console.log("ðŸš€ðŸš€ðŸš€ ~ First target group:",o),c(o)}return g(s),s}catch(s){return console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:20 ~ getNotifiTargetGroups ~ error:",s),{}}},ensureTargetGroup:async e=>{try{u(!0);const s={...e},o=await n.ensureTargetGroup({name:"Default",...s});o!=null&&o.id&&c(o),g([o]),u(!1)}catch(s){u(!1),console.error("ðŸš€ðŸš€ðŸš€ ~ useGetNotifiTargetGroups.ts:45 ~ ensureTargetGroup ~ error:",s)}}}}function F(){const{notifiClient:n}=T(),{defaultTargetGroup:g,setNotifiAlerts:p,setNotifiSourceGroups:m,setNotifiSources:d,setIsChecked:u,setNotifiSubscriptionLoading:c}=T(),{showCommonToast:f}=w(),{getNotifiTargetGroups:h}=S(),e=async()=>{let r=g.filter(t=>t.name==="Default");return r.length||(r=(await h()).filter(t=>t.name==="Default")),r[0]},s=r=>{const t=[],a=[],l=[];return r.forEach(i=>{(i.sourceGroup.name.includes("position")||i.name.includes("Position Range Alerts"))&&i.name!=="Fusion Source Filter"&&i.name!=="defaultAlert"&&(t.push(i.sourceGroup),a.push(...i.sourceGroup.sources.map(N=>({...N,alertID:i.id})))),l.push(...i.sourceGroup.sources.map(N=>({...N,alertName:i.name})))}),l.some(i=>i.alertName==="defaultAlert")||b(),{sourceGroup:t,sources:a}},o=async r=>{try{const t=r?await r.getAlerts():await n.getAlerts();console.log("ðŸš€ ~ getNotifiAlerts ~ alerts:",t);const{sourceGroup:a,sources:l}=s(t);p(t),m(a),d(l),c(!1)}catch(t){console.error("ðŸš€ ~ getNotifiAlerts ~ error:",t)}},G=async r=>{console.log("ðŸš€ ~ deleteNotifiAlerts ~ id:",r);try{await n.deleteAlert({id:r}),f("Unsubscribed","success","You'll no longer receive alerts when the price goes out of range."),o(),c(!1)}catch(t){console.error("ðŸš€ ~ deleteNotifiAlerts ~ error:",t),f("There was an error unsubscribe alert","rejected",String(t)),c(!1)}},y=async(r,t)=>{try{const a=await e(),l={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:r&&t?`Position Range Alerts${new Date().getTime()}`:"defaultAlert",targetGroupId:a.id,subscriptionValue:r&&t?JSON.stringify({pool_address:r,position_index:String(t)}):"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]},A=await n.ensureFusionAlerts(l);console.log("ðŸš€ ~ createNotifiAlert ~ alerts:",A),f("Subscribed to Alerts!","success","Verify your notification channels to receive alerts when the price goes out of range. To edit your alert settings, click the bell icon in the top nav."),o()}catch(a){console.error("ðŸš€ ~ createNotifiAlert ~ error:",a),f("There was an error subscribe alert","rejected",String(a)),u(!1),c(!1)}},b=async()=>{try{const t={alerts:[{fusionEventId:"0192d2ba2cc371e5b6583e43295a3272",name:"defaultAlert",targetGroupId:(await e()).id,subscriptionValue:"*",filterOptions:JSON.stringify('{"version":1,"input":{}}')}]};await n.ensureFusionAlerts(t),o()}catch(r){console.error("ðŸš€ ~ initDefaultAlert ~ error:",r)}};return{getNotifiAlerts:o,createNotifiAlert:y,deleteNotifiAlerts:G}}export{S as a,F as u};
//# sourceMappingURL=useNotifiAlerts-D4u5IY5V.js.map
