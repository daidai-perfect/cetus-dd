import{r as o,d as f,j as t,ar as Le,V as W,T as S,S as qe,H as C,bG as Ge,Y as E,a7 as Ye,B as Ke,ao as wt,C as $e,b as rt,W as ce,bo as _t,g as de,aB as pe,as as oe,m as Te,aO as Je,I as Ct,bj as je,bq as Rt,ae as Pt,af as zt,ag as Dt,ah as Mt,ai as Lt,aj as Wt,ak as $t,a0 as it,$ as Qe,a5 as ot,R as lt,a8 as nt,aA as ae,bH as We,a9 as Re,bI as ve,aS as Fe,a1 as Ae,k as at,e as Tt,bc as Ft,a_ as Et}from"./index-c8x0neDx.js";import{S as At}from"./Slippage-D4t4y3eq.js";import{d as Ot,b as ct,e as ut,f as he,g as pt,h as xt,i as Ie,C as ke,u as Ut,c as Ht}from"./useGetVaultList-B6yZUlmD.js";import{R as Nt}from"./RefreshButton-S2zh08Pz.js";import{u as qt}from"./useAccountBalance-CZOHOa8D.js";import{H as le}from"./HTextLabelBox-C9FZcI0L.js";import{V as me}from"./VTextLabelBox-dt-U3a_S.js";import{i as Gt}from"./icon_currentprice@2x-DeObnx8l.js";import{T as Yt}from"./TradeConfirmAmountInfo-Dmeoy8BX.js";import{u as Xe}from"./global-DLT0J0mI.js";import{M as dt}from"./msafe-oYBkW7LJ.js";import{u as et}from"./useTokenBalance-eq1GEE9D.js";import{u as mt}from"./useTransaction-DAoWoqXP.js";import{v as Ee}from"./index-9_VNld9X.js";import{T as ft}from"./TradeInputGroup-DQRm61m2.js";import{P as Kt}from"./progress-BaDu_ehH.js";import{A as tt}from"./AddressCopyLink-CXikOUHz.js";import{C as st}from"./CetusTooltip-CGhijhrv.js";import{P as Jt}from"./RemoveBlock-CY8GubRl.js";import{u as Qt}from"./useFindBestRouting-BkIS3pga.js";import"./TooltipIcon-B5wViqRg.js";import"./switch-81cBGCWx.js";import"./useGetPoolList-COr9_t00.js";import"./api-data-utils-0d_jjn6h.js";import"./useToken-D-6xB-ST.js";import"./_getAllKeysIn-C6E0GMPP.js";import"./progress.utils-lPdRWm8i.js";import"./AddressUnderline-D-OGLlr6.js";import"./LockInput-C6EUUthc.js";import"./icon_lock@2x-OdzkPjmc.js";import"./usePositionList-jMKEHL_-.js";import"./useCurrentPos-Bg9_OBWV.js";import"./useNotifiSubscription-La67Z7V_.js";import"./useXCetusHelper-C-BGnfq1.js";import"./usePosAdd-3nc6fJ9x.js";import"./useInsufficientBalanceToast-CiJ4SaVO.js";import"./AprTooltip-CSg3mjFm.js";import"./generateCategoricalChart-BQB8abrb.js";import"./debounce-Cbctf6FT.js";import"./throttle-Ci4i6U0I.js";import"./index-DwhjM_Xa.js";import"./ExpendItem-CMlZ1emu.js";import"./SingleTokenInfo-DeVv6bgN.js";import"./PriceRange-lF99gfNF.js";import"./PositionStatus-BMJM4Hh1.js";import"./RangeValue-qMaWWfA-.js";import"./RangeAlerts-CxUCJldo.js";function Xt(a){const{displayMaxPrice:i,displayMinPrice:e,displayPrice:r,isLoading:s}=a,[x,l]=o.useState(0),n=o.useRef(null);o.useEffect(()=>{const p=()=>{n.current&&l(n.current.offsetWidth)};p();const c=new ResizeObserver(p);return n.current&&c.observe(n.current),()=>{n.current&&c.unobserve(n.current)}},[]);const d=o.useMemo(()=>{if(i==="âˆž")return"center";if(r&&e&&i){if(f(r).greaterThanOrEqualTo(i))return"end";if(f(e).greaterThanOrEqualTo(r))return"start"}return"center"},[r,e,i]),u=o.useMemo(()=>{if(i==="âˆž")return"0px";if(r&&e&&i&&f(r).lessThanOrEqualTo(i)&&f(r).greaterThanOrEqualTo(e)){const p=f(i).add(e).div(2),c=f(r).gt(p);let h=f(0);if(c){const b=f(p).sub(e);h=f(r).sub(p).div(b)}else{const b=f(i).sub(p);h=f(r).sub(e).div(b)}return c?`${f(x).mul(h).toFixed(0)}px`:`-${f(x).mul(f(1).sub(h)).toFixed(0)}px`}return"0px"},[r,e,i,x]);return t.jsxs(Le,{w:"100%",direction:"column",alignItems:d,children:[t.jsxs(W,{w:{md:"100%",lg:"max-content"},justifyContent:"center",mb:"-22px",gap:"8px",ml:u,children:[t.jsxs(W,{p:"6px 24px",borderRadius:"8px",bg:"bg_secondary",gap:"4px",children:[t.jsx(S,{fontSize:"xs",h:"14px",children:"Current Price"}),s?t.jsx(Le,{h:"18px",align:"center",children:t.jsx(qe,{})}):t.jsx(C,{children:t.jsx(S,{fontSize:"16px",color:"text_highlight",children:t.jsx(Ge,{value:E(r,6,!0,Ye.ROUND_DOWN)})})})]}),d==="center"&&t.jsxs(W,{zIndex:"100",children:[t.jsx(Ke,{w:"2px",h:"98px",bg:"#76C8FF"}),t.jsx(wt,{src:Gt,w:"30px",h:"30px",mt:"-18px"})]}),d!=="center"&&t.jsx(Ke,{h:"25px"})]}),t.jsx($e,{zIndex:"99",mt:"-48px",ref:n,pl:"60px",pr:"60px",h:"50px",w:"90%",bg:"linear-gradient( 180deg, rgba(22,22,22,0) 0%, #191919 100%)",borderBottom:"1px solid",borderBottomColor:"border",children:t.jsx($e,{w:"100%",h:"48px",bg:"linear-gradient( 180deg, rgba(22,22,22,0) 0%, #1A5780 100%)"})}),t.jsxs(C,{justifyContent:"space-between",pl:{md:"0",lg:"14px"},pr:"2px",mt:"8px",w:"90%",children:[t.jsxs(W,{pl:"16px",pr:"16px",pt:"5px",pb:"5px",borderRadius:"8px",bg:"bg_secondary",gap:"6px",maxW:{md:"48%",lg:"auto"},children:[t.jsx(S,{fontSize:"12px",children:"Min Price"}),s?t.jsx(Le,{h:"18px",align:"center",children:t.jsx(qe,{})}):t.jsx(S,{fontSize:"14px",fontWeight:"500",color:"text_caption",maxW:{md:"100%",lg:"auto"},children:t.jsx(Ge,{value:E(e,6,!0,Ye.ROUND_DOWN)})})]}),t.jsxs(W,{pl:"16px",pr:"24px",pt:"5px",pb:"5px",borderRadius:"8px",bg:"bg_secondary",gap:"6px",maxW:{md:"48%",lg:"auto"},children:[t.jsx(S,{fontSize:"12px",children:"Max Price"}),s?t.jsx(Le,{h:"18px",align:"center",children:t.jsx(qe,{})}):t.jsx(S,{fontSize:"14px",fontWeight:"500",color:"text_caption",maxW:{md:"100%",lg:"auto"},children:t.jsx(Ge,{value:E(i,6,!0,Ye.ROUND_DOWN)})})]})]})]})}function Zt(a){const{getVaultList:i,getVaultListFromCache:e}=Ot(),[r,s]=o.useState(void 0),[x,l]=o.useState(!1),n=async(u,p)=>{var b;(r===void 0||p)&&l(!0);const c=await i({sortRule:"desc",sortType:"apr"}),h=((b=c==null?void 0:c.filter(w=>w.vaultsId===u))==null?void 0:b[0])||null;return l(!0),h&&s(h),h},d=u=>{var h;const p=e({sortRule:"desc",sortType:"apr"});return((h=p==null?void 0:p.filter(b=>b.vaultsId===u))==null?void 0:h[0])||null};return o.useEffect(()=>{if(a){const u=d(a);u&&s(u),n(a,!1)}},[a]),{vaultInfoLoading:x,apiVaultInfo:r,getApiVaultInfo:n}}function Vt(a){const{holdCoinAmounts:i,lpLogoUrl:e,displayTokenA:r,displayTokenB:s,sharePoolRate:x,balanceInfo:l,totalValue:n,isReverse:d,holdCoinAValue:u,holdCoinBValue:p,rewardPerA:c,rewardPerB:h}=a,b=o.useMemo(()=>d?p:u,[d,u,p]),w=o.useMemo(()=>d?u:p,[d,u,p]),{isApp:R}=rt();return t.jsx(ce,{p:{base:"16px 8px",lg:"20px 16px"},children:t.jsxs(W,{w:"100%",gap:{base:"24px",lg:"8px"},children:[t.jsxs(C,{w:"100%",justifyContent:"space-between",children:[t.jsx(C,{children:t.jsx(S,{textAlign:"start",fontSize:"16px",color:"text_caption",children:"Your Liquidity"})}),t.jsxs(C,{gap:"8px",children:[t.jsx(S,{whiteSpace:"nowrap",children:"Your share of pool"}),t.jsx(S,{color:"text_highlight",fontWeight:"500",children:_t(x,6)})]})]}),R?t.jsxs(W,{w:"100%",gap:"16px",children:[t.jsx(le,{label:"LP Token Balance",labelStyle:{fontSize:"13px"},value:t.jsxs(C,{children:[t.jsx(de,{imageUrl:e,w:"28px",h:"28px",imageStyle:{w:"20px",h:"20px"}}),t.jsxs(S,{color:"text_caption",ml:"4px",fontWeight:"500",fontSize:"13px",children:[E(l==null?void 0:l.balanceFormat,9)," LP"]})]}),subValue:t.jsx(S,{children:pe(n,2)}),subValueStyle:{fontSize:"13px"}}),t.jsx(le,{label:oe(r==null?void 0:r.symbol,10),labelStyle:{fontSize:"13px"},value:t.jsxs(C,{children:[t.jsx(de,{imageUrl:r==null?void 0:r.logo_url,coinType:r==null?void 0:r.coin_type,w:"28px",h:"28px",imageStyle:{w:"20px",h:"20px"}}),t.jsx(S,{fontSize:"13px",color:"text_caption",fontWeight:"500",children:`${E(i==null?void 0:i.displayCoinA,6)} ${oe(r==null?void 0:r.symbol,10)}`})]}),subValue:pe(b,2),subValueStyle:{fontSize:"13px"}}),t.jsx(le,{label:oe(s==null?void 0:s.symbol,10),labelStyle:{fontSize:"13px"},value:t.jsxs(C,{children:[t.jsx(de,{imageUrl:s==null?void 0:s.logo_url,coinType:s==null?void 0:s.coin_type,w:"28px",h:"28px",imageStyle:{w:"20px",h:"20px"}}),t.jsx(S,{fontSize:"13px",color:"text_caption",fontWeight:"500",children:`${E(i==null?void 0:i.displayCoinB,6)} ${oe(s==null?void 0:s.symbol,10)}`})]}),subValue:pe(w,2),subValueStyle:{fontSize:"13px"}})]}):t.jsxs(t.Fragment,{children:[t.jsxs(Te,{flexDir:{base:"column",lg:"row"},mt:"16px",gap:{base:"8px",lg:"4px"},align:"center",children:[t.jsx(S,{children:"LP Token Balance"}),t.jsxs(S,{color:"text_caption",ml:"4px",fontWeight:"500",children:[E(l==null?void 0:l.balanceFormat,9)," LP"]}),t.jsx(S,{children:pe(n,2)})]}),t.jsxs(C,{w:{base:"100%",lg:"90%"},mt:"12px",justifyContent:"space-between",pos:"relative",bg:"linear-gradient(270deg, #0F0F0F 0%, #252525 50%, #0F0F0F 100%)",borderRadius:"69px",gap:"0",children:[t.jsxs(W,{flex:"1",h:"106px",justifyContent:"center",alignItems:"start",children:[t.jsxs(C,{children:[t.jsx(de,{imageUrl:r==null?void 0:r.logo_url,coinType:r==null?void 0:r.coin_type,imageStyle:{w:"28px",h:"28px"}}),t.jsx(S,{color:"text_caption",fontSize:"16px",fontWeight:"600",children:oe(r==null?void 0:r.symbol,10)})]}),t.jsx(me,{wrapStyle:{gap:"4px",w:"calc(100% - 60px)"},title:`${E(i==null?void 0:i.displayCoinA,6)} ${oe(r==null?void 0:r.symbol,10)}`,titleStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_caption",whiteSpace:"wrap",lineHeight:{base:"16px",lg:"14px"},wordBreak:"break-all",fontWeight:500},value:pe(b,2),valueStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_paragraph",whiteSpace:"wrap",lineHeight:{base:"16px",lg:"14px"},wordBreak:"break-all",fontWeight:500}})]}),t.jsxs(W,{flex:"1",h:"106px",justifyContent:"center",alignItems:"end",children:[t.jsxs(C,{children:[t.jsx(S,{color:"text_caption",fontSize:"16px",fontWeight:"600",children:oe(s==null?void 0:s.symbol,10)}),t.jsx(de,{imageUrl:s==null?void 0:s.logo_url,coinType:s==null?void 0:s.coin_type,imageStyle:{w:"28px",h:"28px"}})]}),t.jsx(me,{wrapStyle:{gap:"4px",alignItems:"flex-end",w:"calc(100% - 60px)"},title:`${E(i==null?void 0:i.displayCoinB,6)} ${oe(s==null?void 0:s.symbol,10)}`,titleStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_caption",whiteSpace:"wrap",lineHeight:{base:"16px",lg:"14px"},wordBreak:"break-all",fontWeight:500},value:pe(w,2),valueStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_paragraph",whiteSpace:"wrap",lineHeight:{base:"16px",lg:"14px"},wordBreak:"break-all",fontWeight:500}})]}),t.jsx(ce,{pos:"absolute",left:"calc(50% - 52px)",w:"104px",h:"104px",borderRadius:"70px",p:"8px 0px",children:t.jsxs(W,{justify:"center",gap:"4px",children:[t.jsx(de,{imageUrl:e,imgBoxStyle:{w:"58px",h:"58px"}}),t.jsx(S,{color:"#8BAABE",fontSize:"12px",children:"Pooled Assets"})]})})]})]})]})})}function Bt(a){const{price:i,changeSide:e}=a;return{displayPrice:o.useMemo(()=>{if(i)return e?E(Je(1).div(i).toString(),10,!0).toString():i},[i,e])}}function It(a){const{minPrice:i,maxPrice:e,changeSide:r}=a,s=o.useMemo(()=>{if(i&&e)return r?i==="0"||i==="âˆž"?"0":E(Je(1).div(e).toString(),10,!0).toString():i},[i,e,r]),x=o.useMemo(()=>{if(i&&e)return r?e==="0"||e==="âˆž"?"âˆž":E(Je(1).div(i).toString(),10,!0).toString():e},[i,e,r]);return{displayMinPrice:s,displayMaxPrice:x}}function kt(a){const[i,e]=o.useState(!1),{currentPrice:r,minPrice:s,maxPrice:x,displayTokenA:l,displayTokenB:n,isLoading:d,isReverse:u}=a,{displayPrice:p}=Bt({price:r,changeSide:i}),{displayMaxPrice:c,displayMinPrice:h}=It({minPrice:s,maxPrice:x,changeSide:i});o.useEffect(()=>{e(u)},[u]);const b=o.useMemo(()=>i?n:l,[l,n,i]);return t.jsx(ce,{p:{base:"16px 8px",lg:"20px 16px"},children:t.jsxs(W,{w:"100%",children:[t.jsxs(C,{w:"100%",justifyContent:"space-between",mb:"6px",children:[t.jsx(S,{fontSize:"16px",color:"text_caption",children:"Position Range"}),t.jsxs(C,{gap:"0px",children:[t.jsx(de,{imageUrl:b==null?void 0:b.logo_url,imageStyle:{w:"20px",h:"20px"}}),t.jsxs(S,{color:"text_caption",children:[" ",b==null?void 0:b.symbol]}),t.jsxs(C,{ml:"8px",gap:"4px",cursor:"pointer",onClick:()=>e(!i),children:[t.jsx(S,{fontSize:"12px",children:" Base coin"}),t.jsx(Ct,{xlinkHref:"#icon-icon_swap1"})]})]})]}),t.jsx(Xt,{displayPrice:p,displayMaxPrice:c,displayMinPrice:h})]})})}function gt(a){const{poolName:i,amountLimit:e,lpRate:r,inputTotalValue:s,preCalculateLoading:x}=a;return t.jsxs(W,{w:"100%",gap:"20px",children:[t.jsx(le,{label:"Total Amount",labelStyle:{fontSize:"14px"},value:pe(s,2),valueStyle:{fontSize:"14px",h:"14px"},isLoading:x}),t.jsx(le,{label:"Share of Pool",labelStyle:{fontSize:"14px"},value:r,isLoading:x,valueStyle:{fontSize:"14px",h:"14px"}}),t.jsx(le,{label:"Minimum Received LP",labelStyle:{fontSize:"14px"},value:`${je(E(Rt(e||"0",9)).toString(),9)} ${i}`,valueStyle:{fontSize:"14px",h:"14px"},isLoading:x})]})}function es(a){const{isOpen:i,onClose:e,data:r,onSubmitClick:s}=a,{feeTier:x,displayTokenA:l,displayTokenB:n,displayAmountA:d,displayAmountB:u,totalAmountValue:p,sharePool:c,lpAmountLimit:h}=r;return t.jsxs(Pt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:i,onClose:e,isCentered:!0,children:[t.jsx(zt,{}),t.jsxs(Dt,{children:[t.jsx(Mt,{children:t.jsx(Lt,{fontWeight:"500",fontSize:"16px",children:"Deposit"})}),t.jsx(Wt,{}),t.jsx($t,{textAlign:"center",p:"0px",children:t.jsxs(W,{w:"100%",gap:"20px",p:"16px",pb:"0px",pos:"relative",children:[t.jsxs(C,{w:"100%",justifyContent:"space-between",children:[t.jsxs(C,{children:[t.jsx(it,{coinAIconUrl:l==null?void 0:l.logo_url,coinBIconUrl:n==null?void 0:n.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),t.jsx(S,{fontSize:"16px",color:"text_caption",children:`${l==null?void 0:l.symbol} - ${n==null?void 0:n.symbol}`})]}),t.jsx(ce,{w:"unset",p:"6px 8px",borderRadius:"12px",ml:"4px",children:t.jsxs(C,{children:[t.jsx(S,{children:"Fee Tier"}),t.jsx(S,{color:"primary",children:x})]})})]}),t.jsx(Yt,{coinA:{amount:d,...l},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},coinB:{amount:u,...n}}),t.jsx(gt,{amountLimit:h,inputTotalValue:p,preCalculateLoading:!1,lpRate:c,poolName:`${l==null?void 0:l.symbol} - ${n==null?void 0:n.symbol}`}),t.jsx(Ke,{h:"52px"}),t.jsx(Qe,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{s()},children:"Deposit"})]})})]})]})}function ts(a,i,e,r,s){const{fetchTokenPrices:x,getTokenAmountValue:l}=ot(),{setDetailRefreshCount:n}=ct(),{vaultsSdk:d}=lt(),{vaultsSlippage:u,mevProtect:p,maxCapForGas:c,transactionMode:h,customGasPrice:b}=Xe(),[w,R]=o.useState(""),[y,H]=o.useState(""),[z,F]=o.useState(!0),[_,D]=o.useState(""),N=o.useRef(""),M=o.useRef(!0),$=o.useRef(""),Q=o.useRef("");o.useEffect(()=>{N.current=_},[_]),o.useEffect(()=>{M.current=z},[z]),o.useEffect(()=>{$.current=w},[w]),o.useEffect(()=>{Q.current=y},[y]),o.useEffect(()=>{const g=[];r&&s&&(g.push(r.coin_type),g.push(s.coin_type)),g.length>0&&x(g)},[r==null?void 0:r.coin_type,s==null?void 0:s.coin_type]);const{balanceInfo:q}=et(r),{balanceInfo:se}=et(s),X=l(r==null?void 0:r.coin_type,w),Z=l(s==null?void 0:s.coin_type,y),ue=o.useMemo(()=>f(X||"0").add(Z||"0").toString(),[X,Z]),[ee,K]=o.useState(!1),[G,V]=o.useState(void 0),Y=nt(async(g,v,O)=>{if(r&&s&&e)try{K(!0),n(0);const k=Re(g,(v?r:s).decimals).toFixed(0),re={vault_id:e,fix_amount_a:v,input_amount:k,slippage:Number(u),request_id:O,side:a==="both"?ve.Both:ve.OneSide};console.log("ðŸš€ ~ preCalculate ~ params:",re,O);const te=await d.Vaults.calculateDepositAmount(re,!1,!0);console.log("ðŸš€ ~ preCalculate ~ res:",{...te,uuid:O,assetAction:a,"+amountInputARef.current":+$.current}),N.current===O&&(a==="both"&&(v?+$.current?(H(ae(te.amount_b.toString(),s.decimals).toString()),V(te)):H(""):+Q.current?(R(ae(te.amount_a.toString(),r.decimals).toString()),V(te)):R("")),a!=="both"&&V(te))}catch(U){console.log("ðŸš€ ~ preCalculate ~ error:",U),V(void 0)}finally{K(!1)}},500),L=(g,v,O=!0)=>{if(F(v),v?(R(g),O&&H("")):(H(g),O&&R("")),+g){const U=We.isSuiCoin(a);if(U&&f(g).lt(3)){D(""),V(void 0),K(!1);return}if(!U){const re=l(a,g);if(f(re).gt(1e4)){D(""),V(void 0),K(!1);return}}const k=Ee();D(k),a==="both"&&K(!0),Y(g,v,k)}else Ce()},J=()=>{const g=M.current?$.current:Q.current;if(+g){const v=Ee();D(v),Y(g,M.current,v)}};o.useEffect(()=>{Ce()},[a]);const[I,we]=o.useState(!1),{signAndExecuteTransaction:ne,transactionConfirmation:ge,transactionRejected:xe}=mt(),_e=async()=>{if(e){we(!0);const g=Re(z?w:y,9),v={vault_id:e,side:a==="both"?ve.Both:ve.OneSide,fix_amount_a:z,input_amount:g.toString(),slippage:Number(u)};console.log("ðŸš€ ~ doAddAction ~ params:",v);const O={getShowInfo:(U,k)=>{const re="Deposit "+[he(w,r==null?void 0:r.symbol),he(y,s==null?void 0:s.symbol)].filter(Boolean).join(" and "),te={modalDescriptionText:re,toastTitleText:re};if(U==="success"){let Ue=w,Pe=y;k&&(Ue=f(w).gt(0)?Fe(k,r)||w:"",Pe=f(y).gt(0)?Fe(k,s)||y:"");const ze="Deposit "+[he(Ue,r==null?void 0:r.symbol),he(Pe,s==null?void 0:s.symbol)].filter(Boolean).join(" and ");te.toastDescriptionContent=ze,te.modalDescriptionText=ze}return te}};try{await ne(async()=>await d.Vaults.deposit(v),O,{useMev:p,txAction:"signTransactionBlock",useFastMode:h==="Fast Mode",maxCapForGas:c,customGasPrice:b,msafeParams:{action:dt.AddVaultsPosition,txbParams:v}})?(Ce(),i()):J()}catch(U){console.log("ðŸš€ ~ doAddAction ~ error:",U),xe(O)}}},Ce=()=>{R(""),H(""),K(!1),V(void 0),D("")},{stakeProtocolName:Oe}=ut(M.current?s==null?void 0:s.coin_type:r==null?void 0:r.coin_type),be=o.useMemo(()=>{if(a!=="both"&&r&&s){const g=M.current?w:y,v=M.current?r:s,O=M.current?s:r;if(G&&G.swap_result){const U=ae(G.swap_result.swap_in_amount,v.decimals),k=ae(f(G.swap_result.swap_out_amount).mul(1-Number(u)).toString(),O.decimals);return We.isSuiCoin(v.coin_type)?`By depositing ${je(E(g,9).toString(),9)} SUI, ${je(E(U,9).toString(),9)} SUI will be converted to ${O==null?void 0:O.symbol} via ${Oe} liquid staking and added to the pool together.`:`By depositing ${je(E(g,9).toString(),9)} ${v==null?void 0:v.symbol}, ${je(E(U,9).toString(),9)} ${v==null?void 0:v.symbol} will be traded for ${je(E(k,9).toString(),9)} ${O==null?void 0:O.symbol} and then added to the pool together.`}else if(!We.isSuiCoin(a)){const U=l(a,g);if(f(U).gt(1e4))return"Single-asset deposit can't be higher than $10,000 at a time."}}},[a,G,w,y]);return{handleAmountInputChange:L,fixAmountA:z,amountInputA:w,amountInputB:y,balanceInfoA:q,balanceInfoB:se,amountValueA:X,amountValueB:Z,preCalculateLoading:ee,inputTotalValue:ue,calculateResult:G,showOnlySideTips:be,doAddAction:_e,reCalculateResult:J}}function ht(a,i,e,r,s,x,l,n,d){const{currentAccount:u}=Ae(),p=o.useMemo(()=>{const c={text:void 0,disabled:!1};if(!(u!=null&&u.address))return c.text="Connect Wallet",c.disabled=!1,c;if(!n||!d)return c.disabled=!0,c;if(a==="both"&&!+e&&!+r)return c.text="Enter an amount",c.disabled=!0,c;if(a!=="both"){if(!(+e||+r))return c.text="Enter an amount",c.disabled=!0,c;if(i){const h=We.isSuiCoin(a);if(h&&a===(n==null?void 0:n.coin_type)&&f(e).lt(3)||h&&a===(d==null?void 0:d.coin_type)&&f(r).lt(3))return c.text="Minimum deposit 3 SUI",c.disabled=!0,c}}if(a==="both"){if(f(e).gt(x||"0"))return c.disabled=!0,c.text=i?`Insufficient ${n==null?void 0:n.symbol} Balance`:"Invalid Amount",c;if(f(r).gt(l||"0"))return c.disabled=!0,c.text=i?`Insufficient ${d==null?void 0:d.symbol} Balance`:"Invalid Amount",c}if(a!=="both"){if(s&&f(e).gt(x||"0"))return c.disabled=!0,c.text=i?`Insufficient ${n==null?void 0:n.symbol} Balance`:"Invalid Amount",c;if(!s&&f(r).gt(l||"0"))return c.disabled=!0,c.text=i?`Insufficient ${d==null?void 0:d.symbol} Balance`:"Invalid Amount",c}return c},[u==null?void 0:u.address,a,e,r,x,l]);return{btnText:p.text,btnDisabled:p.disabled}}const ss="You can also choose to deposit in only one asset type. In that case,the vault will convert your asset to the required propositions using Cetus.Please note that trading fees & slippage will be applied. When slippage is involved,a certain amount of post-swap dust (no loss of funds) will be returned to you.",rs=(a,i)=>`When you deposit in only SUI tokens, a part of your SUI amount will be converted to ${i} via ${a} liquid staking services to match required liquidity compositions of the liquidity pool on Cetus. A certain amount of dust (no loss of funds) will be returned to you if slippage is involved.`;function bt(a){const{displayTokenA:i,displayTokenB:e,onSelectAssetTab:r,showAfterIcon:s=!1,label:x="Deposit Amounts",handleRefreshClick:l}=a,{stakeProtocolName:n}=ut(i==null?void 0:i.coin_type),d=o.useMemo(()=>i&&e?[{label:`${i.symbol}+${e.symbol}`,action:"both"},{label:`${i.symbol} only`,action:i.coin_type,afterIcon:s?{xlinkHref:"#icon-icon_tips"}:void 0,tooltip:ss},{label:`${e.symbol} only`,action:e.coin_type,afterIcon:s?{xlinkHref:"#icon-icon_tips"}:void 0,tooltip:rs(n,i==null?void 0:i.symbol)}]:[],[i,n]),[u,p]=o.useState("both"),c=o.useMemo(()=>{if(d.length!==0)return u===(i==null?void 0:i.coin_type)?d[1].label:u===(e==null?void 0:e.coin_type)?d[2].label:d[0].label},[u,d]);return t.jsx(ce,{borderRadius:"12px",p:{base:"16px 8px 8px",lg:"16px"},children:t.jsxs(W,{w:"100%",gap:"16px",children:[t.jsx(C,{w:"100%",justifyContent:"space-between",children:t.jsx(S,{fontWeight:"500",children:x})}),t.jsx(at,{wrapStyle:{w:"100%",h:"48px",borderRadius:"8px",p:"3px"},itemStyle:{w:"50%",fontSize:"14px",borderRadius:"6px",fontWeight:"500"},type:"outlineTab",currentTab:c,tabList:d,handleChangeTab:h=>{p(h.action),r(h.action)}})]})})}function is(a){const{apiVaultInfo:i,tokenA:e,tokenB:r,isReverse:s,vaultsId:x,totalLp:l,feeTier:n,handleRefreshClick:d}=a,[u,p]=o.useState("both"),{currentAccount:c,onWalletModal:h}=Ae(),{amountInputA:b,amountInputB:w,balanceInfoA:R,balanceInfoB:y,amountValueA:H,amountValueB:z,preCalculateLoading:F,fixAmountA:_,inputTotalValue:D,handleAmountInputChange:N,calculateResult:M,showOnlySideTips:$,doAddAction:Q,reCalculateResult:q}=ts(u,d,x,e,r),{vaultsSlippage:se}=Xe(),{btnText:X,btnDisabled:Z}=ht(u,!0,b,w,_,R==null?void 0:R.balanceFormat,y==null?void 0:y.balanceFormat,e,r),{lpRate:ue}=pt(M==null?void 0:M.ft_amount,l),{amountLimit:ee}=xt(Number(se),M==null?void 0:M.ft_amount,!1),[K,G]=o.useState(!1),V=o.useMemo(()=>s?y:R,[R==null?void 0:R.balance,y==null?void 0:y.balance,s]),fe=o.useMemo(()=>s?R:y,[R==null?void 0:R.balance,y==null?void 0:y.balance,s]),Y=o.useMemo(()=>s?r:e,[s,e,r]),L=o.useMemo(()=>s?e:r,[s,e,r]),J=()=>({feeTier:n||"",displayTokenA:Y,displayTokenB:L,displayAmountA:s?w:b,displayAmountB:s?b:w,totalAmountValue:D,sharePool:ue,lpAmountLimit:ee||"0"});return o.useEffect(()=>{q()},[i]),t.jsxs(W,{gap:"8px",w:"100%",align:"flex-start",children:[t.jsx(bt,{showAfterIcon:!0,displayTokenB:s?e:r,displayTokenA:s?r:e,onSelectAssetTab:p,handleRefreshClick:()=>{d(),q()}}),t.jsx(ft,{borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px",h:"unset",p:{base:"20px 8px",lg:"20px 16px"}},hideSelf:u!=="both"&&u!==(Y==null?void 0:Y.coin_type),balance:(V==null?void 0:V.balanceFormat)||"",value:s?w:b,amountValue:s?z:H,loading:!_&&F,onChange:I=>{N(I,!s)},selectable:!1,placeholder:"0.0",token:Y},to:{wrapStyle:{borderRadius:"12px",h:"unset",p:{base:"20px 8px",lg:"20px 16px"}},hideSelf:u!=="both"&&u!==(L==null?void 0:L.coin_type),balance:(fe==null?void 0:fe.balanceFormat)||"",value:s?b:w,amountValue:s?H:z,loading:_&&F,onChange:I=>{N(I,s)},selectable:!1,placeholder:"0.0",token:L},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"}}),t.jsx(ce,{borderRadius:"12px",p:"0px",children:t.jsxs(W,{w:"100%",gap:"20px",children:[t.jsx(Qe,{m:"-1px",isLoading:F,w:"100%",borderRadius:"12px",h:"52px",fontSize:"18px",fontWeight:"500",disabled:Z||F,onClick:()=>{c?G(!0):h(!0)},children:X||"Deposit"}),(M||$)&&t.jsxs(W,{w:"100%",pb:"20px",pl:"16px",pr:"16px",gap:"20px",alignItems:"start",children:[u!=="both"&&t.jsx(S,{color:"text_paragraph",fontSize:"12px",lineHeight:"1.8",children:$}),M&&t.jsx(gt,{amountLimit:ee,inputTotalValue:D,preCalculateLoading:F,lpRate:ue,poolName:`${Y==null?void 0:Y.symbol} - ${L==null?void 0:L.symbol}`})]})]})}),K&&t.jsx(es,{data:J(),isOpen:K,onClose:()=>{G(!1)},onSubmitClick:()=>{G(!1),Q()}})]})}function os(a){const{vaultsCoinPercent:i,displayTokenB:e,displayTokenA:r,vaultCoinAmounts:s,vaultsCoinAValue:x,vaultsCoinBValue:l,isReverse:n}=a,d=o.useMemo(()=>n?l:x,[n,x,l]),u=o.useMemo(()=>n?x:l,[n,x,l]),p=o.useMemo(()=>n?i==null?void 0:i.percentB:i==null?void 0:i.percentA,[n,i]),c=o.useMemo(()=>n?i==null?void 0:i.percentA:i==null?void 0:i.percentB,[n,i]);return t.jsx(ce,{p:{base:"16px 8px",lg:"20px 16px"},children:t.jsxs(W,{w:"100%",gap:"0px",children:[t.jsx(S,{w:"100%",textAlign:"start",fontSize:"16px",color:"text_caption",children:"Vault Composition"}),t.jsxs(C,{w:{base:"96%",lg:"90%"},justifyContent:"space-between",mt:"20px",children:[t.jsxs(C,{children:[t.jsx(de,{imageUrl:r==null?void 0:r.logo_url,imageStyle:{w:"28px",h:"28px"}}),t.jsx(me,{wrapStyle:{gap:"4px"},title:oe(r==null?void 0:r.symbol,10)||"",titleStyle:{fontSize:"16px",color:"text_caption",fontWeight:"600"},value:`${p}%`,valueStyle:{fontSize:"12px",color:"text_paragraph",fontWeight:"500"}})]}),t.jsx(Kt,{ml:"16px",mr:"16px",flex:"1",h:"4px",value:p,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}}),t.jsxs(C,{children:[t.jsx(me,{wrapStyle:{gap:"4px",alignItems:"flex-end"},title:oe(e==null?void 0:e.symbol,10)||"",titleStyle:{fontSize:"16px",color:"text_caption",fontWeight:"600"},value:`${c}%`,valueStyle:{fontSize:"12px",color:"text_paragraph",fontWeight:"500"}}),t.jsx(de,{imageUrl:e==null?void 0:e.logo_url,coinType:e==null?void 0:e.coin_type})]})]}),t.jsxs(C,{w:{base:"100%",lg:"90%"},justifyContent:"space-between",mt:"12px",children:[t.jsx(me,{wrapStyle:{gap:{base:"8px",lg:"4px"}},title:`${E(s==null?void 0:s.displayCoinA,6)} ${oe(r==null?void 0:r.symbol,10)}`,titleStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_caption",fontWeight:"500"},value:pe(d,2),valueStyle:{color:"text_paragraph",fontSize:{base:"12px",lg:"14px"},fontWeight:"500"}}),t.jsx(me,{wrapStyle:{gap:{base:"8px",lg:"4px"},alignItems:"flex-end"},title:`${E(s==null?void 0:s.displayCoinB,6)} ${oe(e==null?void 0:e.symbol,10)}`,titleStyle:{fontSize:{base:"12px",lg:"14px"},color:"text_caption",fontWeight:"500"},value:pe(u,2),valueStyle:{color:"text_paragraph",fontSize:{base:"12px",lg:"14px"},fontWeight:"500"}})]})]})})}function ls(a){var s,x,l,n,d,u;const{isApp:i}=rt(),{apiVaultInfo:e}=a,{getExplorerUrl:r}=Tt();return t.jsxs(Te,{flexDir:{base:"column",lg:"row"},w:"100%",justifyContent:"space-between",children:[t.jsxs(C,{children:[t.jsx(it,{coinACoinType:(s=e==null?void 0:e.displayTokenA)==null?void 0:s.coin_type,coinBCoinType:(x=e==null?void 0:e.displayTokenB)==null?void 0:x.coin_type,coinAIconUrl:(l=e==null?void 0:e.displayTokenA)==null?void 0:l.logo_url,coinBIconUrl:(n=e==null?void 0:e.displayTokenB)==null?void 0:n.logo_url}),t.jsx(S,{fontSize:"16px",color:"text_caption",fontWeight:"500",children:(e==null?void 0:e.name)||`${(d=e==null?void 0:e.displayTokenA)==null?void 0:d.symbol} - ${(u=e==null?void 0:e.displayTokenB)==null?void 0:u.symbol}`}),t.jsx(ce,{w:"unset",p:{base:"8px 12px",lg:"4px 6px"},borderRadius:"12px",ml:"4px",children:t.jsx(C,{children:t.jsx(S,{fontSize:{base:"14px",lg:"12px"},color:"primary",children:e==null?void 0:e.feeDisplay})})}),!i&&t.jsxs(C,{ml:"12px",gap:"4px",children:[t.jsx(S,{fontSize:"14px",children:"Vault Address"}),t.jsx(tt,{fontSize:"14px",address:(e==null?void 0:e.vaultsId)||"",onClickLink:()=>{window.open(r(e==null?void 0:e.vaultsId,"poolAddress"),"_blank")}})]})]}),t.jsx(Te,{flexDir:{base:"column",lg:"row"},gap:{base:"8px",lg:"60px"},children:i?t.jsxs(t.Fragment,{children:[t.jsx(le,{label:"Vault Address",labelStyle:{fontSize:"14px"},value:t.jsx(tt,{fontSize:"14px",color:"text_caption",address:(e==null?void 0:e.vaultsId)||"",onClickLink:()=>{window.open(r(e==null?void 0:e.vaultsId,"poolAddress"),"_blank")}})}),t.jsx(le,{wrapStyle:{gap:"6px"},label:"APY",labelStyle:{fontSize:"14px"},rightValueTip:t.jsx(Ie,{vaultsLstApyDisplay:e==null?void 0:e.vaultsLstApyDisplay,vaultsApyDisplay:e==null?void 0:e.vaultsApyDisplay,vaultsTotalApyDisplay:e==null?void 0:e.vaultsTotalApyDisplay}),value:(e==null?void 0:e.vaultsTotalApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}}),t.jsx(le,{wrapStyle:{gap:"6px"},label:"Rewards",labelStyle:{fontSize:"14px"},value:t.jsx(st,{placement:"top",tooltip:t.jsx(S,{fontSize:"12px",lineHeight:"20px",maxW:"240px",children:"Rewards will be auto harvested and compounded to your position."}),children:t.jsx($e,{children:t.jsx(C,{w:"100px",justifyContent:"end",children:e==null?void 0:e.vaultsRewards.map(p=>t.jsx(ke,{coinType:p},p))})})}),valueStyle:{h:"20px",lineHeight:"20px"}}),t.jsx(le,{wrapStyle:{gap:"6px"},label:"TVL",labelStyle:{fontSize:"14px"},value:(e==null?void 0:e.vaultsTvlDisplay)||"-",valueStyle:{color:"text_caption",h:"20px",lineHeight:"20px",fontSize:"14px",fontWeight:"500"}})]}):t.jsxs(t.Fragment,{children:[t.jsx(me,{wrapStyle:{alignItems:"flex-end",gap:"6px"},title:"APY",titleStyle:{fontSize:"12px"},valueTooltip:t.jsx(Ie,{vaultsLstApyDisplay:e==null?void 0:e.vaultsLstApyDisplay,vaultsApyDisplay:e==null?void 0:e.vaultsApyDisplay,vaultsTotalApyDisplay:e==null?void 0:e.vaultsTotalApyDisplay}),value:(e==null?void 0:e.vaultsTotalApyDisplay)||"-",valueStyle:{color:"text_highlight",h:"20px",lineHeight:"20px",fontWeight:"500"}}),t.jsx(me,{wrapStyle:{gap:"6px",alignItems:"flex-end"},title:"Rewards",titleStyle:{fontSize:"12px"},value:t.jsx(st,{placement:"top",tooltip:t.jsx(S,{fontSize:"12px",lineHeight:"20px",maxW:"240px",children:"Rewards will be auto harvested and compounded to your position."}),children:t.jsx($e,{children:t.jsx(C,{w:"100px",justifyContent:"end",children:e==null?void 0:e.vaultsRewards.map(p=>t.jsx(ke,{coinType:p},p))})})}),valueStyle:{h:"20px"}}),t.jsx(me,{wrapStyle:{alignItems:"flex-end",gap:"6px"},title:"TVL",titleStyle:{fontSize:"12px"},value:(e==null?void 0:e.vaultsTvlDisplay)||"-",valueStyle:{color:"text_caption",h:"20px",lineHeight:"20px",fontWeight:"500"}})]})})]})}function ns(a,i,e,r,s,x,l,n){const{setDetailRefreshCount:d}=ct(),{fetchTokenPrices:u,getTokenAmountValue:p}=ot(),{vaultsSdk:c}=lt(),{vaultsSlippage:h,mevProtect:b,maxCapForGas:w,transactionMode:R,customGasPrice:y}=Xe(),{findBestRouters:H}=Qt(),[z,F]=o.useState(""),[_,D]=o.useState(""),[N,M]=o.useState(!0),[$,Q]=o.useState(""),[q,se]=o.useState(!1),[X,Z]=o.useState(0),ue=o.useRef($),ee=o.useRef(N),K=o.useRef(z),G=o.useRef(_),V=o.useRef(q),fe=o.useRef(X);o.useEffect(()=>{fe.current=X},[X]),o.useEffect(()=>{V.current=q},[q]),o.useEffect(()=>{ue.current=$},[$]),o.useEffect(()=>{ee.current=N},[N]),o.useEffect(()=>{K.current=z},[z]),o.useEffect(()=>{G.current=_},[_]),o.useEffect(()=>{const m=[];l&&n&&(m.push(l.coin_type),m.push(n.coin_type)),m.length>0&&u(m)},[l==null?void 0:l.coin_type,n==null?void 0:n.coin_type]);const[Y,L]=o.useState("0"),[J,I]=o.useState("0"),[we,ne]=o.useState(!1);o.useEffect(()=>{De(),ge()},[a]),o.useEffect(()=>{ge()},[e.coinAmountA]);const ge=()=>{const{coinAmountA:m,coinAmountB:P}=e;if(console.log("ðŸš€ ~ useEffect ~ holdCoinAmounts:",e),ne(!1),a==="both"){L(m),I(P);return}const j=a===(l==null?void 0:l.coin_type),A=j?P:m;let T=j?m:P;const ie=j?n:l,Se=j?l:n;f(A).gt(0)?(ne(!0),L("0"),I("0"),H({fromToken:ie,toToken:Se,amount:Re(A,ie.decimals).toString(),providersKeys:c.sdkOptions.aggregator.providers,by_amount_in:!0,uuid:$}).then(ye=>{console.log("ðŸš€ ~ calculateAvailableAmount ~ uuid:",{result:ye}),ye.toAmountUi&&(T=f(T).add(ye.toAmountUi).toString()),j?L(T):I(T)}).finally(()=>{ne(!1)})):j?L(T):I(T)},xe=p(l==null?void 0:l.coin_type,z),_e=p(n==null?void 0:n.coin_type,_),Ce=o.useMemo(()=>f(xe||"0").add(_e||"0").toString(),[xe,_e]),[Oe,be]=o.useState(!1),[g,v]=o.useState(void 0),U=nt(async(m,P,j,A,T)=>{var ie,Se;if(l&&n&&x&&s){if(!T){if(j){if(f(m).gt(Y)){Q(""),v(void 0),be(!1);return}}else if(f(m).gt(J)){Q(""),v(void 0),be(!1);return}}d(0),(+K.current||+G.current||T)&&be(!0);const Me=P?m:Re(m,(j?l:n).decimals).toFixed(0),Ze={vault_id:x,fix_amount_a:j,input_amount:Me,slippage:Number(h),request_id:A,side:a==="both"?ve.Both:ve.OneSide,is_ft_input:P,max_ft_amount:s};console.log("ðŸš€ ~ preCalculate ~ params:",Ze,A,T);try{const B=await c.Vaults.calculateWithdrawAmount(Ze);if(console.log("ðŸš€ ~ preCalculate ~ res:",{...B,uuid:A,assetAction:a}),ue.current===A){const He=ae(B.amount_a.toString(),l.decimals).toString(),Ne=ae(B.amount_b.toString(),n.decimals).toString();if(a==="both"&&(P?(D(Ne),F(He),T===100&&(L(He),I(Ne)),v(B)):j?+K.current?(D(Ne),v(B)):D(""):+G.current?(F(He),v(B)):F("")),a!=="both"){if(T){const Ve=ae(f(B.amount_a).add(((ie=B.swap_result)==null?void 0:ie.swap_out_amount)||"0").toString(),l.decimals).toString();if(j)F(Ve),D(""),T===100&&(B.burn_ft_amount=s,L(Ve));else{const Be=ae(f(B.amount_b).add(((Se=B.swap_result)==null?void 0:Se.swap_out_amount)||"0").toString(),n.decimals).toString();F(""),D(Be),T===100&&(B.burn_ft_amount=s,I(Be))}}v(B)}}}catch(B){console.log("ðŸš€ ~ preCalculate ~ error:",B),v(void 0)}finally{be(!1)}}},500),k=(m,P,j=!1,A=!1,T=!0)=>{if(j){re(100);return}if(A){re(50);return}if(M(P),se(!1),P?(F(m),T&&D("")):(D(m),T&&F("")),+m){const ie=Ee();Q(ie),U(m,!1,P,ie)}else De()},re=m=>{if(se(!0),Z(m),s&&+s)if(m===0)De();else{const P=a===(l==null?void 0:l.coin_type);if(M(P),m===100||a==="both"){const j=Ee();Q(j);const A=m===100?s:f(s).mul(m).div(100).toFixed(0);U(A,!0,P,j,m)}else{M(P);const j=f(a===(l==null?void 0:l.coin_type)?Y:J).mul(m).div(100).toFixed();U(j,!1,P,$,m)}}},te=()=>{if(console.log("ðŸš€ ~ reCalculateResult ~ isPercentInput:",{isPercentInput:q,removePercent:X}),q)re(X);else{const m=ee.current?K.current:G.current;k(m,ee.current)}};o.useEffect(()=>{if(!q)if(g&&s&&+s){let m=Number(f(g.burn_ft_amount).div(s).mul(100));m>100&&(m=100),Z(m)}else Z(0)},[g==null?void 0:g.burn_ft_amount]);const[Ue,Pe]=o.useState(!1),{signAndExecuteTransaction:ze,transactionConfirmation:St,transactionRejected:yt}=mt(),jt=async()=>{if(x&&g&&s){Pe(!0);let m;if(a==="both")m={vault_id:x,ft_amount:g==null?void 0:g.burn_ft_amount,slippage:Number(h)};else{const j=a===(l==null?void 0:l.coin_type);if(X===100)m={vault_id:x,is_ft_input:!0,input_amount:s,slippage:Number(h),max_ft_amount:s,fix_amount_a:j};else{const A=Re(N?z:_,9);m={vault_id:x,is_ft_input:!1,input_amount:A.toString(),slippage:Number(h),max_ft_amount:s,fix_amount_a:j}}}console.log("ðŸš€ ~ doRemoveAction ~ params:",m);const P={getShowInfo:(j,A)=>{const T="Withdraw "+[he(z,l==null?void 0:l.symbol),he(_,n==null?void 0:n.symbol)].filter(Boolean).join(" and "),ie={modalDescriptionText:T,toastDescriptionContent:T};if(j==="success"){let Se=z,ye=_;A&&(Se=f(z).gt(0)?Fe(A,l)||z:"",ye=f(_).gt(0)?Fe(A,n)||_:"");const Me="Removed "+[he(Se,l==null?void 0:l.symbol),he(ye,n==null?void 0:n.symbol)].filter(Boolean).join(" and ");ie.toastDescriptionContent=Me,ie.modalDescriptionText=Me}return ie}};St(P);try{const j=await c.Vaults.withdraw(m);await ze(j,P,{useMev:b,txAction:"signTransactionBlock",useFastMode:R==="Fast Mode",maxCapForGas:w,customGasPrice:y,msafeParams:{action:dt.RemoveVaultsPosition,txbParams:m}})?De():te(),i()}catch(j){console.log("ðŸš€ ~ doAddAction ~ error:",j),yt(P)}}},De=()=>{F(""),D(""),Z(0),be(!1),v(void 0),Q("")},vt=o.useMemo(()=>{if(g&&g.swap_result&&a!=="both"&&l&&n){const m=N?z:_,P=ee.current?l:n,j=ee.current?n:l,A=ae(g.swap_result.swap_in_amount,P.decimals),T=ae(f(g.swap_result.swap_out_amount).mul(1-Number(h)).toString(),j.decimals);return console.log("vaultsSlippage: ",{vaultsSlippage:h,calculateResult:g,swapOutAmount:T}),`To withdraw ${m} ${P==null?void 0:P.symbol}, ${A} ${j==null?void 0:j.symbol} in the pool will be traded for ${T} ${P==null?void 0:P.symbol}`}},[a,g,z,_]);return{handleAmountInputChange:k,fixAmountA:N,amountInputA:z,amountInputB:_,availableAmountA:Y,availableAmountB:J,amountValueA:xe,amountValueB:_e,preCalculateLoading:Oe,inputTotalValue:Ce,calculateResult:g,showOnlySideTips:vt,doRemoveAction:jt,handlePercentInputChange:re,isPercentInput:q,removePercent:X,reCalculateResult:te,calculateAvailableAmount:ge,calculateAvailableLoading:we}}function as(a){const{apiVaultInfo:i,tokenA:e,tokenB:r,isReverse:s,vaultsId:x,totalLp:l,holdCoinAmounts:n,holdLpAmount:d,handleRefreshClick:u}=a,[p,c]=o.useState("both"),{currentAccount:h,onWalletModal:b}=Ae(),{amountInputA:w,amountInputB:R,availableAmountA:y,availableAmountB:H,amountValueA:z,amountValueB:F,preCalculateLoading:_,fixAmountA:D,inputTotalValue:N,handleAmountInputChange:M,calculateResult:$,showOnlySideTips:Q,doRemoveAction:q,handlePercentInputChange:se,removePercent:X,isPercentInput:Z,reCalculateResult:ue,calculateAvailableLoading:ee}=ns(p,u,n,l,d,x,e,r),{btnText:K,btnDisabled:G}=ht(p,!1,w,R,D,y,H,e,r);pt($==null?void 0:$.burn_ft_amount,l);const{amountLimit:V}=xt(0,$==null?void 0:$.burn_ft_amount,!1),fe=o.useMemo(()=>s?H:y,[H,y,s]),Y=o.useMemo(()=>s?y:H,[y,H,s]),L=o.useMemo(()=>s?r:e,[s,e,r]),J=o.useMemo(()=>s?e:r,[s,e,r]),I=o.useMemo(()=>_?Z?!0:s?D:!D:!1,[_,Z]),we=o.useMemo(()=>_?Z?!0:s?!D:D:!1,[_,Z]);return o.useEffect(()=>{ue()},[i]),t.jsxs(W,{gap:"8px",w:"100%",align:"flex-start",children:[t.jsx(bt,{label:"Remove Amounts",displayTokenB:s?e:r,displayTokenA:s?r:e,onSelectAssetTab:c,handleRefreshClick:()=>{u(),ue()}}),t.jsx(ft,{borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px",h:"unset",p:{base:"20px 8px",lg:"20px 16px"}},calculateAvailableLoading:ee,hideSelf:p!=="both"&&p!==(L==null?void 0:L.coin_type),balance:fe||"",value:s?R:w,amountValue:s?F:z,loading:I,onChange:(ne,ge,xe)=>{M(ne,!s,ge,xe)},needRemainBalance:!1,selectable:!1,placeholder:"0.0",token:L,balanceLabel:"Available"},to:{wrapStyle:{borderRadius:"12px",h:"unset",p:{base:"20px 8px",lg:"20px 16px"}},balanceLabel:"Available",calculateAvailableLoading:ee,needRemainBalance:!1,hideSelf:p!=="both"&&p!==(J==null?void 0:J.coin_type),balance:Y||"",value:s?w:R,amountValue:s?z:F,loading:we,onChange:(ne,ge,xe)=>{M(ne,s,ge,xe)},selectable:!1,placeholder:"0.0",token:J}}),t.jsxs(ce,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[t.jsx(S,{color:"primary_gray",children:"Amount"}),t.jsx(Jt,{percentage:X,onChange:ne=>{se(Number(ne.toString().replace("%","")))}})]}),t.jsx(ce,{borderRadius:"12px",p:"0px",children:t.jsxs(W,{w:"100%",gap:"20px",children:[t.jsx(Qe,{m:"-1px",isLoading:_,w:"100%",borderRadius:"12px",h:"52px",fontSize:"18px",fontWeight:"500",disabled:G||_,onClick:()=>{h?q():b(!0)},children:K||"Withdraw"}),$&&t.jsxs(W,{w:"100%",pb:"20px",pl:"16px",pr:"16px",gap:"20px",children:[p!=="both"&&t.jsx(S,{color:"text_paragraph",fontSize:"12px",lineHeight:"1.8",children:Q}),t.jsxs(W,{w:"100%",gap:"20px",children:[t.jsx(le,{label:"Total Withdraw",labelStyle:{fontSize:"14px"},value:pe(N,2),valueStyle:{fontSize:"14px"},isLoading:_}),t.jsx(le,{label:"LP Burn Amount",value:`${E(ae(V||"0",9),9)} ${`${L==null?void 0:L.symbol} - ${J==null?void 0:J.symbol}`}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},isLoading:_})]})]})]})})]})}const cs=[{label:"Deposit",value:"Deposit"},{label:"Withdraw",value:"Withdraw"}];function rr(){const{vaultId:a}=Ft(),{currentAccount:i}=Ae(),{apiVaultInfo:e,getApiVaultInfo:r}=Zt(a),{fetchAccountBalance:s}=qt(),{contractVault:x,lpTokenInfo:l,minPrice:n,maxPrice:d,vaultCoinAmounts:u,vaultsCoinAValue:p,vaultsCoinBValue:c,currPrice:h,balanceInfo:b,totalValue:w,fetchClmmPoolFromContract:R,fetchVaultInfoFromContract:y,vaultsCoinPercent:H,sharePoolRate:z,holdCoinAmounts:F,holdCoinAValue:_,holdCoinBValue:D}=Ut(e==null?void 0:e.vaultsId,e==null?void 0:e.clmmPoolAddress,e==null?void 0:e.tokenA,e==null?void 0:e.tokenB,e==null?void 0:e.isReverse),[N,M]=o.useState("Deposit"),{rewardPerA:$,rewardPerB:Q}=Ht(b==null?void 0:b.balanceFormat,e);o.useEffect(()=>{a&&y(a,!0)},[a]),o.useEffect(()=>{e&&R(e.clmmPoolAddress,!0)},[e==null?void 0:e.clmmPoolAddress]),o.useEffect(()=>{i!=null&&i.address&&s()},[]);const q=()=>{s(),e&&R(e.clmmPoolAddress,!0),a&&(y(a,!0),r(a,!0))};return t.jsxs(W,{gap:"20px",w:"100%",pt:"40px",align:"flex-start",children:[t.jsxs(C,{w:"100%",justify:"space-between",children:[t.jsx(Et,{}),t.jsx(Nt,{handleRefresh:q,isAutoRefresh:!0,refreshInterval:20,innerStyle:{bg:"background"},w:"32px",h:"32px",borderRadius:"8px",bg:"background"})]}),t.jsx(ls,{apiVaultInfo:e}),t.jsxs(Te,{flexDir:{base:"column-reverse",lg:"row"},w:"100%",justifyContent:"space-between",gap:"16px",alignItems:"start",children:[t.jsxs(W,{w:{base:"100%",lg:"auto"},flex:"1",gap:"8px",children:[t.jsx(kt,{minPrice:n,maxPrice:d,currentPrice:h,displayTokenB:e==null?void 0:e.displayTokenB,displayTokenA:e==null?void 0:e.displayTokenA,isReverse:(e==null?void 0:e.isReverse)||!1}),t.jsx(os,{vaultCoinAmounts:u,vaultsCoinAValue:p,vaultsCoinBValue:c,displayTokenB:e==null?void 0:e.displayTokenB,displayTokenA:e==null?void 0:e.displayTokenA,isReverse:(e==null?void 0:e.isReverse)||!1,vaultsCoinPercent:H}),t.jsx(Vt,{sharePoolRate:z,balanceInfo:b,totalValue:w,displayTokenB:e==null?void 0:e.displayTokenB,displayTokenA:e==null?void 0:e.displayTokenA,lpLogoUrl:l==null?void 0:l.logo_url,holdCoinAmounts:F,holdCoinAValue:_,holdCoinBValue:D,isReverse:(e==null?void 0:e.isReverse)||!1,rewardPerA:$,rewardPerB:Q})]}),t.jsxs(W,{w:{base:"100%",lg:"40%"},justifyContent:"start",gap:"8px",children:[t.jsx(ce,{p:"0",borderRadius:"12px",children:t.jsxs(C,{w:"100%",p:{base:"0 8px",lg:"0 16px"},children:[t.jsx(at,{type:"borderTab",wrapStyle:{w:"100%",h:"60px",border:"none"},itemStyle:{fontSize:"16px",mr:"28px"},tabList:cs,currentTab:N,handleChangeTab:se=>{M(se==null?void 0:se.value)}}),t.jsx(At,{slippageType:"vaults",compact:!0})]})}),N==="Deposit"&&t.jsx(is,{apiVaultInfo:e,feeTier:e==null?void 0:e.feeDisplay,tokenA:e==null?void 0:e.tokenA,tokenB:e==null?void 0:e.tokenB,isReverse:(e==null?void 0:e.isReverse)||!1,vaultsId:e==null?void 0:e.vaultsId,totalLp:x==null?void 0:x.total_supply,handleRefreshClick:q}),N==="Withdraw"&&t.jsx(as,{apiVaultInfo:e,holdCoinAmounts:F,tokenA:e==null?void 0:e.tokenA,tokenB:e==null?void 0:e.tokenB,isReverse:(e==null?void 0:e.isReverse)||!1,vaultsId:e==null?void 0:e.vaultsId,totalLp:x==null?void 0:x.total_supply,holdLpAmount:b==null?void 0:b.balance,handleRefreshClick:q})]})]})]})}export{rr as default};
