import{m as mt,n as Zt,o as It,r as m,p as wt,v as ft,q as es,t as ts,w as ss,x as as,y as ns,z as is,A as qe,D as xt,E as jt,F as dt,G as cs,J as et,K as ls,L as os,M as rs,j as t,N as $t,O as tt,P as St,Q as Qe,R as us,u as bt,b as ct,e as zt,V as K,i as Lt,U as Ke,S as it,d as b,H as N,W as gt,X as F,T as E,Y as Ie,I as ke,C as _t,Z as We,B as Wt,$ as ps,a0 as lt,a1 as Pt,a2 as ms,a3 as xs,a4 as ds,a5 as Ae,a6 as st,a7 as ht,a8 as Tt,a9 as Ye,aa as gs,c as hs,ab as at,ac as ys,ad as vs,ae as Ss,af as bs,ag as _s,ah as Ds,ai as ws,aj as fs,ak as js,al as Ps,am as Ts,an as As}from"./index-BMYxc9Od.js";import{M as ks,C as Os}from"./MenuDropBlock-mTfClXtQ.js";import{L as Cs,T as Rs,a as Ns}from"./LimitPriceChart-C_60Gpet.js";import{P as Bt}from"./Pagination-C3G2xW7V.js";import{N as yt}from"./NoData-CQ4OWoZo.js";import{R as At}from"./RefreshButton-BJxOoBp4.js";import{u as ot}from"./useTransaction-CfK3pLEn.js";import{u as Ht,R as Vt}from"./RangeValue-Cv8ui1Wd.js";import{D as Ms,e as Es,g as $s}from"./api-data-utils-Ddy-a3WS.js";import{H as _e}from"./HTextLabelBox-DAS3uNTR.js";import{u as Dt}from"./useAccountBalance-7Ju_sYta.js";import{P as zs}from"./progress-qOaxYcSf.js";import{u as Ls}from"./useInsufficientBalanceToast-CfqXK2Kq.js";import{A as Ws}from"./aggregator-C9fZ1bsJ.js";import{u as Bs,A as kt}from"./useFindBestRouting-C22H3oMB.js";import{u as Ot}from"./useTokenBalance-Cj_lT5nh.js";import{u as Ut}from"./useToken-Bvs0Ung1.js";import{i as Hs}from"./icon_currentprice@2x-DeObnx8l.js";import{C as Vs}from"./CurrentPrice-CwZzYz2q.js";import{T as Us}from"./TooltipIcon-ByUA4JrQ.js";import{T as Fs}from"./TradeInputGroup-DZEf1SXK.js";import{W as Gs}from"./WarningTokenTipModal-DQAOf22M.js";import{S as Ct}from"./SingleTokenInfo-YXdPNl3G.js";import{I as Ft}from"./InputBox-CJv-5X-2.js";import{u as qs}from"./global-VD-aBjBV.js";import{u as Ys}from"./useRpcListener-BR_hP-SR.js";import"./IconBg-Ci7ISIQC.js";import"./progress.utils-CSV6fYbb.js";import"./useGetPoolList-DKPSLTZh.js";import"./_getAllKeysIn-DYEwfs_x.js";import"./AddressUnderline-Bhd4IXQA.js";import"./usePreviousValue-B64GMDoH.js";function Ks(a){const{min:s=0,max:e=100,onChange:h,value:o,defaultValue:c,isReversed:i,direction:n="ltr",orientation:x="horizontal",id:l,isDisabled:g,isReadOnly:p,onChangeStart:D,onChangeEnd:d,step:u=1,getAriaValueText:v,"aria-valuetext":A,"aria-label":T,"aria-labelledby":z,name:G,focusThumbOnChange:L=!0,minStepsBetweenThumbs:k=0,...Q}=a,J=mt(D),Z=mt(d),B=mt(v),te=Zt({isReversed:i,direction:n,orientation:x}),[ne,$]=It({value:o,defaultValue:c??[25,75],onChange:h});if(!Array.isArray(ne))throw new TypeError(`[range-slider] You passed an invalid value for \`value\` or \`defaultValue\`, expected \`Array\` but got \`${typeof ne}\``);const[M,O]=m.useState(!1),[H,se]=m.useState(!1),[_,S]=m.useState(-1),C=!(g||p),I=m.useRef(ne),w=ne.map(y=>wt(y,s,e)),V=k*u,X=Qs(w,s,e,V),q=m.useRef({eventSource:null,value:[],valueBounds:[]});q.current.value=w,q.current.valueBounds=X;const de=w.map(y=>e-y+s),Ce=(te?de:w).map(y=>ft(y,s,e)),Re=x==="vertical",me=m.useRef(null),Se=m.useRef(null),Ne=m.useId(),R=as(l??Ne),De=m.useCallback(y=>{var ge;if(!me.current)return;q.current.eventSource="pointer";const j=me.current.getBoundingClientRect(),{clientX:f,clientY:W}=((ge=y.touches)==null?void 0:ge[0])??y,Y=Re?j.bottom-W:f-j.left,xe=Re?j.height:j.width;let ae=Y/xe;return te&&(ae=1-ae),es(ae,s,e)},[Re,te,e,s]),Me=(e-s)/10,ue=u||(e-s)/100,ee=m.useMemo(()=>({setValueAtIndex(y,j){if(!C)return;const f=q.current.valueBounds[y];j=parseFloat(ts(j,f.min,ue)),j=wt(j,f.min,f.max);const W=[...q.current.value];W[y]=j,$(W)},setActiveIndex:S,stepUp(y,j=ue){const f=q.current.value[y],W=te?f-j:f+j;ee.setValueAtIndex(y,W)},stepDown(y,j=ue){const f=q.current.value[y],W=te?f+j:f-j;ee.setValueAtIndex(y,W)},reset(){$(I.current)}}),[ue,te,$,C]),we=m.useCallback(y=>{const j=y.key,W={ArrowRight:()=>ee.stepUp(_),ArrowUp:()=>ee.stepUp(_),ArrowLeft:()=>ee.stepDown(_),ArrowDown:()=>ee.stepDown(_),PageUp:()=>ee.stepUp(_,Me),PageDown:()=>ee.stepDown(_,Me),Home:()=>{const{min:Y}=X[_];ee.setValueAtIndex(_,Y)},End:()=>{const{max:Y}=X[_];ee.setValueAtIndex(_,Y)}}[j];W&&(y.preventDefault(),y.stopPropagation(),W(y),q.current.eventSource="keyboard")},[ee,_,Me,X]),{getThumbStyle:fe,rootStyle:He,trackStyle:Ee,innerTrackStyle:je}=m.useMemo(()=>ss({isReversed:te,orientation:x,thumbPercents:Ce}),[te,x,Ce]),$e=m.useCallback(y=>{var f;const j=y??_;if(j!==-1&&L){const W=R.getThumb(j),Y=(f=Se.current)==null?void 0:f.ownerDocument.getElementById(W);Y&&setTimeout(()=>Y.focus())}},[L,_,R]);ns(()=>{q.current.eventSource==="keyboard"&&(Z==null||Z(q.current.value))},[w,Z]);const Xe=y=>{const j=De(y)||0,f=q.current.value.map(ge=>Math.abs(ge-j)),W=Math.min(...f);let Y=f.indexOf(W);const xe=f.filter(ge=>ge===W);xe.length>1&&j>q.current.value[Y]&&(Y=Y+xe.length-1),S(Y),ee.setValueAtIndex(Y,j),$e(Y)},ye=y=>{if(_==-1)return;const j=De(y)||0;S(_),ee.setValueAtIndex(_,j),$e(_)};is(Se,{onPanSessionStart(y){C&&(O(!0),Xe(y),J==null||J(q.current.value))},onPanSessionEnd(){C&&(O(!1),Z==null||Z(q.current.value))},onPan(y){C&&ye(y)}});const Pe=m.useCallback((y={},j=null)=>({...y,...Q,id:R.root,ref:jt(j,Se),tabIndex:-1,"aria-disabled":xt(g),"data-focused":qe(H),style:{...y.style,...He}}),[Q,g,H,He,R]),ze=m.useCallback((y={},j=null)=>({...y,ref:jt(j,me),id:R.track,"data-disabled":qe(g),style:{...y.style,...Ee}}),[g,Ee,R]),ve=m.useCallback((y={},j=null)=>({...y,ref:j,id:R.innerTrack,style:{...y.style,...je}}),[je,R]),Je=m.useCallback((y,j=null)=>{const{index:f,...W}=y,Y=w[f];if(Y==null)throw new TypeError(`[range-slider > thumb] Cannot find value at index \`${f}\`. The \`value\` or \`defaultValue\` length is : ${w.length}`);const xe=X[f];return{...W,ref:j,role:"slider",tabIndex:C?0:void 0,id:R.getThumb(f),"data-active":qe(M&&_===f),"aria-valuetext":(B==null?void 0:B(Y))??(A==null?void 0:A[f]),"aria-valuemin":xe.min,"aria-valuemax":xe.max,"aria-valuenow":Y,"aria-orientation":x,"aria-disabled":xt(g),"aria-readonly":xt(p),"aria-label":T==null?void 0:T[f],"aria-labelledby":T!=null&&T[f]||z==null?void 0:z[f],style:{...y.style,...fe(f)},onKeyDown:dt(y.onKeyDown,we),onFocus:dt(y.onFocus,()=>{se(!0),S(f)}),onBlur:dt(y.onBlur,()=>{se(!1),S(-1)})}},[R,w,X,C,M,_,B,A,x,g,p,T,z,fe,we,se]),Ve=m.useCallback((y={},j=null)=>({...y,ref:j,id:R.output,htmlFor:w.map((f,W)=>R.getThumb(W)).join(" "),"aria-live":"off"}),[R,w]),pe=m.useCallback((y,j=null)=>{const{value:f,...W}=y,Y=!(f<s||f>e),xe=f>=w[0]&&f<=w[w.length-1];let ae=ft(f,s,e);ae=te?100-ae:ae;const ge={position:"absolute",pointerEvents:"none",...cs({orientation:x,vertical:{bottom:`${ae}%`},horizontal:{left:`${ae}%`}})};return{...W,ref:j,id:R.getMarker(y.value),role:"presentation","aria-hidden":!0,"data-disabled":qe(g),"data-invalid":qe(!Y),"data-highlighted":qe(xe),style:{...y.style,...ge}}},[g,te,e,s,x,w,R]),Ue=m.useCallback((y,j=null)=>{const{index:f,...W}=y;return{...W,ref:j,id:R.getInput(f),type:"hidden",value:w[f],name:Array.isArray(G)?G[f]:`${G}-${f}`}},[G,w,R]);return{state:{value:w,isFocused:H,isDragging:M,getThumbPercent:y=>Ce[y],getThumbMinValue:y=>X[y].min,getThumbMaxValue:y=>X[y].max},actions:ee,getRootProps:Pe,getTrackProps:ze,getInnerTrackProps:ve,getThumbProps:Je,getMarkerProps:pe,getInputProps:Ue,getOutputProps:Ve}}function Qs(a,s,e,h){return a.map((o,c)=>{const i=c===0?s:a[c-1]+h,n=c===a.length-1?e:a[c+1]-h;return{min:i,max:n}})}const[Xs,rt]=$t({name:"SliderContext",errorMessage:"useSliderContext: `context` is undefined. Seems you forgot to wrap all slider components within <RangeSlider />"}),[Js,ut]=$t({name:"RangeSliderStylesContext",errorMessage:`useRangeSliderStyles returned is 'undefined'. Seems you forgot to wrap the components in "<RangeSlider />" `}),Gt=et(function(s,e){const h={orientation:"horizontal",...s},o=ls("Slider",h),c=os(h),{direction:i}=rs();c.direction=i;const{getRootProps:n,...x}=Ks(c),l=m.useMemo(()=>({...x,name:h.name}),[x,h.name]);return t.jsx(Xs,{value:l,children:t.jsx(Js,{value:o,children:t.jsx(tt.div,{...n({},e),className:"chakra-slider",__css:o.container,children:h.children})})})});Gt.displayName="RangeSlider";const vt=et(function(s,e){const{getThumbProps:h,getInputProps:o,name:c}=rt(),i=ut(),n=h(s,e);return t.jsxs(tt.div,{...n,className:St("chakra-slider__thumb",s.className),__css:i.thumb,children:[n.children,c&&t.jsx("input",{...o({index:s.index})})]})});vt.displayName="RangeSliderThumb";const qt=et(function(s,e){const{getTrackProps:h}=rt(),o=ut(),c=h(s,e);return t.jsx(tt.div,{...c,className:St("chakra-slider__track",s.className),__css:o.track,"data-testid":"chakra-range-slider-track"})});qt.displayName="RangeSliderTrack";const Yt=et(function(s,e){const{getInnerTrackProps:h}=rt(),o=ut(),c=h(s,e);return t.jsx(tt.div,{...c,className:"chakra-slider__filled-track",__css:o.filledTrack})});Yt.displayName="RangeSliderFilledTrack";const Zs=et(function(s,e){const{getMarkerProps:h}=rt(),o=ut(),c=h(s,e);return t.jsx(tt.div,{...c,className:St("chakra-slider__marker",s.className),__css:o.mark})});Zs.displayName="RangeSliderMark";function Kt(){const{peripherySdk:a}=Qe();return{dcaCloseOrderPayload:async e=>await a.Dca.dcaCloseOrderPayload(e)}}function Qt(){const{peripherySdk:a}=Qe();return{dcaWithdrawPayload:async e=>(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDcaClaim.ts:12 ~ params:",e),await a.Dca.withdrawAll(e))}}const Is=(a,s)=>({upperPriceSize:"0%",setUpperPriceSize:e=>{a(()=>({upperPriceSize:e}))},lowerPriceSize:"0%",setLowerPriceSize:e=>{a(()=>({lowerPriceSize:e}))},dcaMode:"total",setDcaMode:e=>{a(()=>({dcaMode:e}))},isDcaRefresh:!1,setIsDcaRefresh:e=>{a(()=>({isDcaRefresh:e}))},pageDirect:!1,setPageDirect:e=>{a(()=>({pageDirect:e}))},sellTotalAmount:"",setSellTotalAmount:e=>{a(()=>({sellTotalAmount:e}))},sellAmount:"",setSellAmount:e=>{a(()=>({sellAmount:e}))},buyAmount:"",setBuyAmount:e=>{a(()=>({buyAmount:e}))},sellCoin:void 0,setSellCoin:e=>{a(()=>({sellCoin:e}))},buyCoin:void 0,setBuyCoin:e=>{a(()=>({buyCoin:e}))},orderNum:"2",setOrderNum:e=>{a(()=>({orderNum:e}))},investNum:"1",setInvestNum:e=>{a(()=>({investNum:e}))},currentCoinKey:"sellCoin",setCurrentCoinKey:e=>{a(()=>({currentCoinKey:e}))},currentInvest:"Hour",setCurrentInvest:e=>{a(()=>({currentInvest:e}))},pageLoading:!0,setPageLoading:e=>{a(()=>({pageLoading:e}))},dcaConfig:{},setDcaConfig:e=>{a(()=>({dcaConfig:e}))},dcaQuote:{},setDcaQuote:e=>{a(()=>({dcaQuote:e}))},orderHistoryObj:{},setOrderHistoryObj:e=>{a(()=>({orderHistoryObj:{...s().orderHistoryObj,...e}}))},inCoinWhiteList:[],setInCoinWhiteList:e=>{a(()=>({inCoinWhiteList:e}))},outCoinWhiteList:[],setOutCoinWhiteList:e=>{a(()=>({outCoinWhiteList:e}))}}),he=us(Is);function ea(){const{fetchByApi:a}=bt(),{setOrderHistoryObj:s}=he();return{getDcaOrderHistory:async({orderId:h,limit:o,offset:c})=>{var n;const i=await a(Ms,"GET",{order_id:h,limit:o,offset:c});if(console.log("ðŸš€ ~ file: useGetDcaOrderHistory.ts:16 ~ useGetDcaOrderHistory ~ res:",i),i!=null&&i.list){const x={[h]:{list:((n=i==null?void 0:i.list)==null?void 0:n.map(l=>({inAmount:l==null?void 0:l.in_amount,outAmount:l==null?void 0:l.out_amount,inCoinType:l==null?void 0:l.in_coin,outCoinType:l==null?void 0:l.out_coin,time:l==null?void 0:l.execution_at,tx:l==null?void 0:l.tx})))||[],total:(i==null?void 0:i.total)||0}};return s(x),x}}}}function ta({isDetail:a,currentTabVal:s,orderInfo:e,handleRefresh:h,pageDirect:o}){const{isApp:c}=ct(),{inCoin:i,outCoin:n}=e,{getDcaOrderHistory:x}=ea(),[l,g]=m.useState(o),[p,D]=m.useState(o),d=10,[u,v]=m.useState([]),[A,T]=m.useState(0),[z,G]=m.useState(1),[L,k]=m.useState(!1),[Q,J]=m.useState({label:"Overview",value:"overview"}),Z=m.useMemo(()=>[{label:"Overview",value:"overview"},{label:L||Number(A)===0?"Orders":`Orders (${A})`,value:"orders"}],[A]),B=S=>{J(S),e!=null&&e.orderID&&ne(e==null?void 0:e.orderID,d,0,!1)};m.useEffect(()=>{a&&(e!=null&&e.orderID)&&ne(e==null?void 0:e.orderID,d,0,!1)},[e,a]);const te=S=>{console.log("ðŸš€ ~ handleCurrentPage ~ page:",S);const C=(S-1)*d;ne(e==null?void 0:e.orderID,d,C,!1),G(S)},ne=async(S,C,I,w=!1)=>{var X,q,de,Oe;console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ loading:",w),k(w);const V=await x({orderId:S,limit:C,offset:I});console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ res?.list:",V,V[S]),(X=V[S])!=null&&X.list&&v((q=V[S])==null?void 0:q.list),(de=V[S])!=null&&de.total&&T((Oe=V[S])==null?void 0:Oe.total),k(!1),console.log("ðŸš€ ~ file: TestData.tsx:170 ~ handleGetDcaOrderHistory ~ res:",V)},[$,M]=m.useState(!1),{dcaWithdrawPayload:O}=Qt();Dt();const{signAndExecuteTransaction:H}=ot(),se=async()=>{M(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",e);const S=[],C={order_id:e==null?void 0:e.orderID,in_coin_type:e==null?void 0:e.inCoin.coin_type,out_coin_type:e==null?void 0:e.outCoin.coin_type};S.push(C),console.log("ðŸš€ ~ toClaim ~ claimOrderParams:",S);const I=await O(S),w=await H(I,{getShowInfo:V=>{var q,de;const X={modalDescriptionText:`${(q=e==null?void 0:e.outCoin)==null?void 0:q.symbol} Claimed`,toastTitleText:`${(de=e==null?void 0:e.outCoin)==null?void 0:de.symbol} Claimed`};return V==="success"&&(X.toastDescriptionContent=""),X}});w&&(console.log("ðŸš€ ~ toClaim ~ res:",w),setTimeout(()=>{h()},2e3)),M(!1)}catch(S){console.log("ðŸš€ ~ toClaim ~ error:",S),M(!1)}},{getExplorerUrl:_}=zt();return t.jsxs(K,{w:"100%",gap:"20px",children:[t.jsx(Lt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:Z,currentTab:Q.label,handleChangeTab:B}),t.jsxs(Ke,{p:"30px 8px 20px",mt:"-42px",borderRadius:"8px",zIndex:"0",bg:"bg_primary",children:[Q.value=="orders"&&(L?t.jsx(it,{height:"4",width:"100%"}):(u==null?void 0:u.length)===0?t.jsx(yt,{type:"nodata",text:"No orders",noBorder:!0,p:"12px",bg:"none"}):t.jsxs(K,{w:"100%",align:"flex-start",gap:"16px",mt:"12px",children:[!c&&t.jsxs(N,{w:"100%",flexDirection:{base:"column",lg:"row"},children:[t.jsx(re,{label:"Order info",value:"",w:{base:"100%",lg:"40%"}}),t.jsx(re,{label:"Rate",value:"",w:{base:"100%",lg:"calc(32% - 16px)"},direct:p,onChangeDirect:()=>D(!p)}),t.jsx(re,{label:"Time (UTC)",value:"",w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]}),u==null?void 0:u.map(S=>{console.log("ðŸš€ ~ {orderHistoryList?.map ~ orderHistory:",S);const C=gt(S.inAmount,i==null?void 0:i.decimals),I=gt(S.outAmount,n==null?void 0:n.decimals),w=b(C).div(I).toString(),V=b(1).div(w).toString();return t.jsxs(N,{w:"100%",flexDirection:{base:"column",lg:"row"},borderBottom:c?"1px solid":"none",pb:c?"16px":"0",borderColor:"border",_last:{borderBottom:"none",pb:"0"},children:[t.jsx(re,{label:c?"Order info":"",value:`${F(C)} ${i.symbol} â†’ ${F(I)} ${n.symbol}`,w:{base:"100%",lg:"40%"}}),t.jsx(re,{label:c?"Rate":"",value:p?`${F(w)} ${i.symbol} per ${n.symbol}`:`${F(V)} ${n.symbol} per ${i.symbol}`,w:{base:"100%",lg:"calc(32% - 16px)"},direct:p,showDirectIcon:!!c,onChangeDirect:()=>D(!p)}),t.jsx(re,{label:c?"Time (UTC)":"",value:t.jsxs(N,{h:"12px",children:[t.jsx(E,{fontSize:"12px",color:"text_caption",children:Ie((S==null?void 0:S.time)*1e3,"YMDHM")}),t.jsx(ke,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(_(S==null?void 0:S.tx,"tx"))}})]}),w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]},S==null?void 0:S.time)}),b(A).gt(d)&&t.jsx(_t,{w:"100%",children:t.jsx(Bt,{total:A,size:d,currentPage:z,onChange:te})})]})),Q.value=="overview"&&t.jsxs(K,{align:"flex-start",gap:"20px",children:[(e==null?void 0:e.isShowTradeTips)&&(e==null?void 0:e.orderStatus)=="Active"&&s=="active"&&t.jsx(sa,{}),t.jsxs(K,{w:"100%",borderRadius:"8px",p:"12px",bg:"card_bg",gap:"12px",children:[t.jsx(_e,{isLoading:!1,label:`DCA  ${i==null?void 0:i.symbol} Balance`,value:`${F(e==null?void 0:e.inBalance,2)||"0"} ${i==null?void 0:i.symbol}`,skeletonStyle:{valueW:"128px"}}),t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsxs(E,{fontSize:"12px",children:["DCA ",n==null?void 0:n.symbol," Balance"]}),t.jsxs(N,{children:[t.jsxs(E,{color:"text_caption",fontSize:"12px",children:[(e==null?void 0:e.outBalance)>0?F(e==null?void 0:e.outBalance):e==null?void 0:e.outBalance," ",n==null?void 0:n.symbol]}),s=="active"&&t.jsx(We,{isLoading:$,onClick:se,disabled:(e==null?void 0:e.outBalance)<=0||$,w:"60px",h:"20px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),t.jsx(_e,{isLoading:!1,label:"Amount Withdrawn",value:s=="active"?`${F(e==null?void 0:e.outWithdraw,2)}`:(e==null?void 0:e.orderStatus)=="PartialDeal"||(e==null?void 0:e.orderStatus)=="Close"?b(e==null?void 0:e.outWithdraw).gt(0)?`${F(e==null?void 0:e.inWithdrawn)} ${i==null?void 0:i.symbol} ${F(e==null?void 0:e.outWithdraw)} ${n==null?void 0:n.symbol}`:`${F(e==null?void 0:e.inWithdrawn)} ${i==null?void 0:i.symbol}`:`${F(e==null?void 0:e.outWithdraw)} ${n==null?void 0:n.symbol}`,skeletonStyle:{valueW:"128px"}})]}),t.jsxs(N,{flexWrap:"wrap",p:{base:"0",lg:"0 12px"},mt:{base:"-12px",lg:"-28px"},sx:{">div":{mt:{base:"12px",lg:"28px"},w:{base:"100%",lg:"calc((100% - 66px)/3)"},"&:nth-child(3n+1)":{mr:{base:"0",lg:"50px"}}}},children:[t.jsx(re,{label:"Invest Every",value:e==null?void 0:e.investEvery}),t.jsx(re,{label:"# of Orders Left",value:e==null?void 0:e.ofOrderLeft}),t.jsx(re,{label:"Each Order Size",value:`${e==null?void 0:e.eachOrderSize} ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right"}),t.jsx(re,{label:"Minimum Price",value:l?`${e==null?void 0:e.minPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.minPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,direct:l,onChangeDirect:()=>g(!l)}),t.jsx(re,{label:"Maximum Price",value:l?`${e==null?void 0:e.maxPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.maxPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,direct:l,onChangeDirect:()=>g(!l)}),s=="active"&&t.jsx(re,{label:"Current Avg. Price",value:l?`${e==null?void 0:e.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right",direct:l,onChangeDirect:()=>g(!l)}),s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"&&t.jsx(re,{label:"Avg. Price",value:l?`${e==null?void 0:e.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right",direct:l,onChangeDirect:()=>g(!l)}),s=="active"&&t.jsx(re,{label:"Next Order (UTC)",value:e==null?void 0:e.nextCycleAt}),t.jsx(re,{label:"Created (UTC)",value:e==null?void 0:e.createAt,align:s=="active"||s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"?"flex-start":"flex-end"})]})]})]})]})}const re=({label:a,value:s,direct:e,onChangeDirect:h,textAlign:o="left",showDirectIcon:c=!0,...i})=>t.jsxs(K,{align:"flex-start",flexDirection:{base:"row",lg:"column"},w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"unset"},...i,children:[a!==""&&t.jsxs(N,{h:"12px",children:[t.jsx(E,{fontSize:"12px",children:a}),h&&c&&t.jsx(ke,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:h})]}),s!==""&&t.jsx(Wt,{fontSize:"12px",color:"text_caption",textAlign:o,children:s})]}),sa=()=>t.jsxs(K,{p:"12px 12px 0",align:"flex-start",children:[t.jsxs(N,{children:[t.jsx(ke,{xlinkHref:"#icon-icon-warning",variant:"warning",cursor:"text"}),t.jsx(E,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"The system tried to execute your order multiple times but did not get it through. This is possibly because:"})]}),t.jsx(E,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market price is not in your required price range"}),t.jsx(E,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market no longer exit"}),t.jsx(E,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market is extremely volatile"}),t.jsx(E,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"This DCA will continue to be attempted and the estimated end date may be extended until your order is fully executed."})]});function aa({currentTabVal:a,orderInfo:s,handleRefresh:e}){const{isApp:h}=ct(),{inCoin:o,outCoin:c}=s,[i,n]=m.useState(!1),[x,l]=m.useState(!1);m.useEffect(()=>{n(!1)},[a]);const{getTokenRank:g}=Ht(),[p,D]=m.useState(!1);m.useEffect(()=>{const T=g(o,c);console.log("ðŸš€ ~ useEffectDcaItem ~ direct:",c,o,T),D(!T)},[o==null?void 0:o.coin_type,c==null?void 0:c.coin_type]);const{dcaCloseOrderPayload:d}=Kt(),{signAndExecuteTransaction:u}=ot(),v=async()=>{l(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",s);const T=[{order_id:s==null?void 0:s.orderID,in_coin_type:s==null?void 0:s.inCoin.coin_type,out_coin_type:s==null?void 0:s.outCoin.coin_type}];console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-order-card.vue:280 ~ closeOrder ~ closeOrderParams:",T);const z=await d(T),G=await u(z,{getShowInfo:L=>{const k={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return L==="success"&&(k.modalDescriptionText="DCA Order Closed",k.toastDescriptionContent="",k.toastTitleText="DCA Order Closed"),k}});console.log("ðŸš€ ~ closeOrder ~ res:",G),G&&setTimeout(()=>{e()},2e3),l(!1)}catch(T){console.log("ðŸš€ ~ closeOrder ~ error:",T),l(!1)}},{getExplorerUrl:A}=zt();return t.jsxs(K,{w:"100%",gap:"12px",align:"flex-start",children:[t.jsxs(N,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"flex-start",lg:"center"},children:[t.jsxs(N,{children:[t.jsx(ps,{coinAIconUrl:o==null?void 0:o.logo_url,coinBIconUrl:c==null?void 0:c.logo_url,coinACoinType:o==null?void 0:o.coin_type,coinBCoinType:c==null?void 0:c.coin_type,w:"28px",h:"28px"}),t.jsxs(E,{color:"text_caption",children:[o==null?void 0:o.symbol," â†’ ",c==null?void 0:c.symbol]}),t.jsx(ke,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(A(s==null?void 0:s.orderID,"poolAddress"))}})]}),!h&&t.jsx(Rt,{currentTabVal:a,isCloseLoading:x,closeOrder:v,orderInfo:s,isDetail:i,onClickDetail:()=>n(!i)})]}),t.jsxs(N,{children:[t.jsxs(E,{color:"text_caption",fontSize:"12px",children:[F(s==null?void 0:s.inDepositedOut)," ",o==null?void 0:o.symbol]}),t.jsxs(E,{color:"primary_gray",fontSize:"12px",children:["/ ",F(s==null?void 0:s.inDeposited)," ",o==null?void 0:o.symbol]}),t.jsxs(E,{color:"primary_gray",fontSize:"12px",children:["(",s==null?void 0:s.inBalanceRatio,"%)"]}),t.jsx(zs,{w:"50px",h:"4px",value:s==null?void 0:s.inBalanceRatio,bg:"#282828",sx:{'div[role="progressbar"]':{bg:"primary"}}})]}),t.jsxs(N,{w:"100%",children:[t.jsx(E,{color:"primary_gray",fontSize:"12px",children:"Price Range"}),t.jsx(Vt,{displayTokenA:c,displayTokenB:o,isRank:!0,priceInfo:{minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,minPriceResever:s==null?void 0:s.minPriceResever,maxPriceResever:s==null?void 0:s.maxPriceResever},fontSize:"12px"})]}),h&&t.jsx(Rt,{currentTabVal:a,isCloseLoading:x,closeOrder:v,orderInfo:s,isDetail:i,onClickDetail:()=>n(!i)}),i&&t.jsx(ta,{pageDirect:p,isDetail:i,currentTabVal:a,orderInfo:s,handleRefresh:e})]})}const Rt=({currentTabVal:a,isCloseLoading:s,closeOrder:e,orderInfo:h,isDetail:o,onClickDetail:c})=>t.jsxs(N,{w:{base:"100%",lg:"unset"},flexDirection:{base:"column",lg:"row"},children:[a=="active"&&t.jsx(We,{w:{base:"100%",lg:"unset"},isLoading:s,disabled:s,onClick:e,h:"32px",minH:"unset",p:"0px 12px",fontSize:"14px",borderRadius:"8px",variant:"outline",children:(h==null?void 0:h.outBalance)<=0?"Close":"Close and Withdraw"}),t.jsx(We,{w:{base:"100%",lg:"unset"},h:"32px",borderRadius:"8px",minH:"unset",p:"0px 12px",fontSize:"14px",variant:"ghost",rightIcon:t.jsx(ke,{svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",transform:o?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.5s",ml:"-4px",mr:"-4px"}),onClick:c,children:"Details"})]});function Nt({handleRefresh:a,activeList:s,pastList:e,isOrderLoading:h}){const[c,i]=m.useState([]),[n,x]=m.useState([]),[l,g]=m.useState(0),[p,D]=m.useState(1),{currentAccount:d,onWalletModal:u}=lt(),[v,A]=m.useState({label:"Active DCAs",value:"active"}),T=m.useMemo(()=>[{label:"Active DCAs",value:"active",num:(s==null?void 0:s.length)>0?s==null?void 0:s.length:void 0},{label:"Past DCAs",value:"past",num:(e==null?void 0:e.length)>0?e==null?void 0:e.length:void 0}],[v==null?void 0:v.value,s,e]),z=O=>{D(1),A(O)};m.useEffect(()=>{const O=(v==null?void 0:v.value)==="active"?s:e;i(O),g(O==null?void 0:O.length)},[v==null?void 0:v.value,s,e]),m.useEffect(()=>{const O=(p-1)*10,H=O+10;x(c==null?void 0:c.slice(O,H))},[p,c,v==null?void 0:v.value]);const G=m.useMemo(()=>(v==null?void 0:v.value)==="past"||(c==null?void 0:c.length)===0?0:c==null?void 0:c.reduce((O,H)=>b(O).plus(H==null?void 0:H.outBalance),b(0)).toString(),[v==null?void 0:v.value,c]),[L,k]=m.useState(!1),[Q,J]=m.useState(!1),{dcaWithdrawPayload:Z}=Qt(),{dcaCloseOrderPayload:B}=Kt(),{signAndExecuteTransaction:te}=ot(),ne=async()=>{J(!0);try{const O=c==null?void 0:c.map(_=>({order_id:_==null?void 0:_.orderID,in_coin_type:_==null?void 0:_.inCoin.coin_type,out_coin_type:_==null?void 0:_.outCoin.coin_type}));console.log("ðŸš€ ~ const closeOrderParams:any=pageList.map ~ closeOrderParams:",O);const H=await B(O),se=await te(H,{getShowInfo:_=>{const S={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return _==="success"&&(S.modalDescriptionText="DCA Order Closed",S.toastDescriptionContent="",S.toastTitleText="DCA Order Closed"),S}});console.log("ðŸš€ ~ closeAll ~ res:",se),se&&setTimeout(()=>{a(!0)},2e3),J(!1)}catch(O){console.log("ðŸš€ ~ closeAll ~ error:",O),J(!1)}},$=async()=>{k(!0);try{const O=c==null?void 0:c.map(_=>({order_id:_==null?void 0:_.orderID,in_coin_type:_==null?void 0:_.inCoin.coin_type,out_coin_type:_==null?void 0:_.outCoin.coin_type}));console.log("ðŸš€ ~ const claimOrderParams:any=pageList.map ~ claimOrderParams:",O);const H=await Z(O),se=await te(H,{getShowInfo:_=>{const S={modalDescriptionText:"DCA Order Claimed",toastTitleText:"DCA Order Claimed"};return _==="success"&&(S.toastDescriptionContent=""),S}});console.log("ðŸš€ ~ claimAll ~ res:",se),se&&setTimeout(()=>{a(!0)},2e3),k(!1)}catch(O){console.log("ðŸš€ ~ claimAll ~ error:",O),k(!1)}},{isApp:M}=ct();return t.jsxs(K,{w:"100%",children:[t.jsxs(N,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(N,{w:{base:"100%",lg:"unset"},justify:"space-between",children:[t.jsx(Lt,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"300px"},h:"52px",gap:"32px",bg:"none",border:"none",mb:"8px"},itemStyle:{fontSize:"16px"},tabList:T,currentTab:v.label,handleChangeTab:z}),M&&t.jsx(At,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),t.jsxs(N,{w:{base:"100%",lg:"unset"},children:[v.value==="active"&&(c==null?void 0:c.length)>0&&(d==null?void 0:d.address)&&t.jsx(We,{w:{base:"50%",lg:"unset"},h:"28px",minH:"unset",p:"0 10px",fontSize:"14px",borderRadius:"8px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},isLoading:L,disabled:Number(G)===0||L,onClick:$,leftIcon:t.jsx(ke,{xlinkHref:"#icon-icon_incentive",svgFill:"primary",mr:"-4px",ml:"-4px"}),children:"Claim all"}),v.value==="active"&&(c==null?void 0:c.length)>0&&(d==null?void 0:d.address)&&t.jsx(We,{w:{base:"50%",lg:"unset"},isLoading:Q,disabled:(c==null?void 0:c.length)==0||Q,h:"28px",borderRadius:"8px",minH:"unset",p:"0 12px",fontSize:"14px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},onClick:ne,children:"Close All"}),!M&&t.jsx(At,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),d!=null&&d.address?h?t.jsx(Ke,{children:t.jsx(K,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((O,H)=>t.jsx(na,{},H))})}):(c==null?void 0:c.length)===0?t.jsx(yt,{type:"nodata",text:(v==null?void 0:v.value)==="active"?"No active orders":"No closed orders"}):t.jsxs(Ke,{h:(n==null?void 0:n.length)>8?"927px":"unset",overflowY:"auto",p:{base:"12px",lg:"20px 16px"},children:[t.jsx(K,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:n==null?void 0:n.map(O=>t.jsx(aa,{handleRefresh:()=>a(!0),currentTabVal:v.value,orderInfo:O},O==null?void 0:O.orderID))}),!h&&(c==null?void 0:c.length)>10&&t.jsx(_t,{mt:"28px",children:t.jsx(Bt,{total:l,size:10,currentPage:p,onChange:D})})]}):t.jsx(yt,{type:"nowallet",onboard:()=>u(!0)})]})}const na=()=>t.jsxs(K,{w:"100%",gap:"16px",align:"flex-start",children:[t.jsxs(N,{w:"100%",gap:"0",justify:"space-between",children:[t.jsxs(N,{gap:"0",children:[t.jsxs(N,{gap:"0px",mr:"8px",align:"flex-start",children:[t.jsx(Pt,{size:"8"}),t.jsx(Pt,{size:"8"})]}),t.jsx(it,{height:"4",width:"100px"})]}),t.jsx(it,{height:"4",width:"150px"})]}),t.jsx(it,{height:"4",width:"180px"})]});function ia(){const{fetchByApi:a}=bt(),{peripherySdk:s}=Qe(),{setDcaConfig:e}=he(),h=async()=>await a(Es,"GET")||null,o=async()=>await s.Dca.getDcaGlobalConfig();return{getDcaConfig:async()=>{const i={};try{const n=await h();n&&(i.minCycleAmountInUsd=n==null?void 0:n.min_amount_in_usd)}catch(n){console.log("ðŸš€ ~ file: useDcaConfig.ts:22 ~ getDcaConfig ~ error:",n)}try{const n=await o();i.minCycleCount=n==null?void 0:n.min_cycle_count,i.minCycleFrequency=n==null?void 0:n.min_cycle_frequency,i.whitelistMode=n==null?void 0:n.whitelist_mode}catch(n){console.log("ðŸš€ ~ file: useDcaConfig.ts:32 ~ getDcaConfig ~ error:",n)}return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDcaConfig.ts:45 ~ getDcaConfig ~ dcaConfig:",i),e(i),i}}}function Xt(){const{fetchByApi:a}=bt(),{setDcaQuote:s}=he();return{getDcaQuote:async({inCoin:h,freq:o,count:c,sender:i})=>{try{const n=await a($s,"GET",{in_coin:h,freq:o,count:c,sender:i});if(n){const x={amountInLimitPerCycle:n==null?void 0:n.amount_in_limit_per_cycle,coinType:n==null?void 0:n.coin_type,feeRate:n==null?void 0:n.fee_rate,signature:n==null?void 0:n.signature,signer:n==null?void 0:n.signer,timestamp:n==null?void 0:n.timestamp};return s(x),x}}catch(n){console.log("getDcaQuote ~ error:",n)}return null}}}function ca(){var oe,Fe;const{sellCoin:a,buyCoin:s,setSellCoin:e,setBuyCoin:h,sellAmount:o,buyAmount:c,setBuyAmount:i,setSellAmount:n,dcaConfig:x,setCurrentCoinKey:l,currentCoinKey:g,investNum:p,currentInvest:D,orderNum:d,dcaQuote:u,setInvestNum:v,setOrderNum:A,setCurrentInvest:T,setPageDirect:z,pageDirect:G,dcaMode:L,sellTotalAmount:k,setSellTotalAmount:Q,setLowerPriceSize:J,setUpperPriceSize:Z}=he(),{currentAccount:B}=lt(),{getDcaConfig:te}=ia(),{getDcaQuote:ne}=Xt(),{coinPriceObj:$}=ms(),{fetchTokenPrices:M,getTokenAmountValue:O}=xs(),[H,se]=m.useState(""),_=m.useRef(H);m.useEffect(()=>{_.current=H},[H]);const S=()=>{console.log("ðŸš€ ~ initiaTokenSelect ~ setSellCoin:"),e(Tt.clmm_swap.from_coin),h(Tt.clmm_swap.to_coin)};m.useEffect(()=>(J("0%"),Z("0%"),S(),te(),()=>{me()}),[]);const[C,I]=m.useState(""),[w,V]=m.useState(""),{balanceInfo:X}=Ot(a),{balanceInfo:q}=Ot(s),de=O(a==null?void 0:a.coin_type,o),Oe=r=>{l("sellCoin"),n(r),y()};m.useEffect(()=>{+o&&+d?L=="total"?Q(o):Q(b(o).mul(d).toString()):Q("")},[o,L,d]);const Ce=()=>{const r=G?a==null?void 0:a.decimals:s==null?void 0:s.decimals;if(z(!G),C&&w){const U=C,ie=b(1).div(w).toString(),be=b(1).div(U).toString();I(Ye(ie,r,!0).toString()),V(Ye(be,r,!0).toString())}},Re=(r,U=!0)=>{var ie,be,Ge,Le;I(""),V(""),U?(((ie=r==null?void 0:r.coin_type)==null?void 0:ie.toLowerCase())===((be=s==null?void 0:s.coin_type)==null?void 0:be.toLowerCase())?Se():e(r),l("sellCoin")):(((Ge=r==null?void 0:r.coin_type)==null?void 0:Ge.toLowerCase())===((Le=a==null?void 0:a.coin_type)==null?void 0:Le.toLowerCase())?Se():h(r),l("buyCoin"))},me=()=>{n(""),I(""),V(""),se(""),v("1"),A("2"),T("Hour")},Se=()=>{e(s),h(a)},Ne=m.useMemo(()=>{const r=x==null?void 0:x.whitelistMode;return console.log("ðŸš€ ~ useDcaHook ~ whitelistMode:",r),r===3?!0:r===0?!1:g==="sellCoin"?r===1:g==="buyCoin"?r===2:!1},[x==null?void 0:x.whitelistMode]),Be=((oe=$[ds(a==null?void 0:a.coin_type).full_address])==null?void 0:oe.price)||0,R=m.useMemo(()=>k&&d?b(k).div(d).toString():0,[k,d]),De=m.useMemo(()=>k&&d&&Be&&b(k).div(d).mul(Be).toString()||0,[k,d,Be]),Me=b(u==null?void 0:u.feeRate).div(Ae.pow(10,6)).mul(100).toString()+"%"||"0%",ue=m.useMemo(()=>{if(u!=null&&u.amountInLimitPerCycle&&(a!=null&&a.decimals))return gt(u==null?void 0:u.amountInLimitPerCycle,a==null?void 0:a.decimals)},[u==null?void 0:u.amountInLimitPerCycle]),ee=m.useMemo(()=>(console.log("ðŸš€ ~ orderSizeError ~ sellPerOrder:",R,ue),x!=null&&x.minCycleAmountInUsd&&d&&o&&ue&&Number(R)<Number(ue)?{status:!0,tips:`Each order size should be higher than $${x==null?void 0:x.minCycleAmountInUsd}.`}:o&&d&&Number(De)>1e4?{status:!0,tips:"Each order size should be less than $10,000"}:{status:!1,tips:""}),[L,ue,d,R,o,De,x==null?void 0:x.minCycleAmountInUsd]),we=m.useMemo(()=>(console.log("ðŸš€ ~ orderInputError ~ orderNum:",d,d&&Number(d)<Number(x==null?void 0:x.minCycleCount)),x!=null&&x.minCycleCount&&d&&Number(d)<Number(x==null?void 0:x.minCycleCount)?{status:!0,tips:`Number of Orders cannot be lower than ${x==null?void 0:x.minCycleCount}.`}:d&&Number(p)<=0?{status:!0,tips:"Please enter an interval above 0"}:d&&p&&Number(p)>1e4?{status:!0,tips:"The maximum interval is 10,000."}:{status:!1,tips:""}),[d,x==null?void 0:x.minCycleCount,p]),fe=m.useMemo(()=>C&&Number(C)==0||w&&Number(w)==0?{status:!0,tips:"Please enter a price greater than 0."}:C&&w&&Number(C)>=Number(w)?{status:!0,tips:"The max price should be higher than min price."}:{status:!1,tips:""},[C,w]),[He,Ee]=m.useState(""),[je,$e]=m.useState({status:!1,tips:""}),Xe=()=>{const r=new Date().getTime();let U=0;switch(console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-detail.vue:34 ~ estEndDate ~ currentTime.value:",D),D){case"Minute":U=Number(p)*60*1e3*(Number(d)-1)+6e4;break;case"Hour":U=Number(p)*60*60*1e3*(Number(d)-1)+6e4;break;case"Day":U=Number(p)*60*60*24*1e3*(Number(d)-1)+6e4;break;case"Week":U=Number(p)*60*60*24*7*1e3*(Number(d)-1)+6e4;break;case"Month":U=Number(p)*60*60*24*30*1e3*(Number(d)-1)+6e4;break}console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-detail.vue:46 ~ estEndDate ~ date + investTime:",d,r,U,U>60*60*24*365*1e3);const ie=Ie(r+U,"YMDHM");console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:303 ~ getEstEndDate ~ result:",ie),Ee(ie),ie=="NaN-NaN-NaN NaN:NaN"&&Ee("--"),U>60*60*24*365*1e3?$e({status:!0,tips:"The maximum execution period is 1 year"}):$e({status:!1,tips:"The maximum execution period is 1 year"})};m.useEffect(()=>{Xe()},[o,p,d,C,w,D]);const ye=m.useMemo(()=>{let r=0;switch(D){case"Minute":r=Number(p)*60;break;case"Hour":r=Number(p)*60*60;break;case"Day":r=Number(p)*60*60*24;break;case"Week":r=Number(p)*60*60*24*7;break;case"Month":r=Number(p)*60*60*24*30;break}return console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:333 ~ cycleFrequency ~ investTime:",r),r},[D,p]);m.useEffect(()=>{a!=null&&a.coin_type&&ye&&d&&ze(a==null?void 0:a.coin_type,ye,d,B==null?void 0:B.address)},[a==null?void 0:a.coin_type,ye,d,B==null?void 0:B.address]);const Pe=async(r,U,ie,be)=>{const Ge=be||"0x0000000000000000000000000000000000000000000000000000000000000000";try{const Le=await ne({inCoin:r,freq:U,count:ie,sender:Ge});return console.log("ðŸš€ ~ queryDcaQuote ~ result:",Le),Le}catch(Le){console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:344 ~ queryDcaQuote ~ error:",Le)}},ze=st((r,U,ie,be)=>{Pe(r,U,ie,be)},500),{findBestRouters:ve}=Bs(),[Je,Ve]=m.useState(!1),[pe,Ue]=m.useState(void 0),{getTokenRank:Ze}=Ht();m.useEffect(()=>{W();const r=Ze(a,s);console.log("ðŸš€ ~ useEffect ~ direct:",r),z(r)},[a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]),m.useEffect(()=>{y()},[R,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]);const y=()=>{b(R).gt(0)&&(a!=null&&a.coin_type)&&(s!=null&&s.coin_type)&&(Ve(!0),console.log("ðŸš€ ~ useDcaHook ~ sellAmountDebounce:",Number(R)>0,R,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type,d),j())},j=st(()=>{f()},500),f=async()=>{if(console.log("ðŸš€ ~ findAvailableRouter ~ findAvailableRouter:",R),a&&s){const r=`${a.coin_type}_${s.coin_type}`;se(r);const U=Object.entries(Ws).map(([be,Ge])=>Ge.id),ie=await ve({fromToken:a,toToken:s,amount:ht(R||1,a==null?void 0:a.decimals).toFixed(0),providersKeys:U,by_amount_in:!0,uuid:r});console.log("ðŸš€ ~ findAvailableRouter ~ newUuid:",r,H,ie),r===_.current&&(Ue(ie),i(ie==null?void 0:ie.toAmountUi),Ve(!1))}},W=()=>{const r=((a==null?void 0:a.coin_type)||(s==null?void 0:s.coin_type))&&Array.from(new Set([a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]));M(r||[])},Y=m.useMemo(()=>{console.log("ðŸš€ ~ btnStatus ~ routerData:",pe);const r={text:"Create DCA Order",disabled:!1};return B!=null&&B.address?!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)?(r.disabled=!0,r.text="Select a token",r):!o||Number(o)==0?(r.disabled=!0,r.text="Enter an amount",r):b(k).gt((X==null?void 0:X.balanceFormat)||0)?(r.disabled=!0,r.text=`Insufficient ${a==null?void 0:a.symbol} balance`,r):b(x==null?void 0:x.minCycleCount).gt(d||0)?(r.disabled=!0,r.text=`Minimum ${x==null?void 0:x.minCycleCount} orders`,r):b(ue).gt(R||0)?(r.disabled=!0,r.text=`Minimum $${x==null?void 0:x.minCycleAmountInUsd} per order`,r):ee.status||we.status||fe.status||je.status||!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)||!d||!p||!C||!w?(r.disabled=!0,r.text="Create DCA Order",r):(console.log("ðŸš€ ~ btnStatus ~ routerData:",pe),pe&&pe.errorCode&&(pe.errorCode===kt.NoRouter||pe.errorCode===kt.HoneyPot)&&(r.text="No Available Route",r.disabled=!0),r):(r.text="Connect Wallet",r.disabled=!1,r)},[B==null?void 0:B.address,X,ee,we,fe,je,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type,k,p,d,C,w,(Fe=pe==null?void 0:pe.routes)==null?void 0:Fe.length]),xe=m.useMemo(()=>{const r=[];return s&&r.push(s),a&&r.push(a),r},[s,a]),ae=m.useMemo(()=>G&&c&&R?F(b(c).div(R).toString(),s==null?void 0:s.decimals,!0):!G&&c&&R?F(b(R).div(c).toString(),a==null?void 0:a.decimals,!0):"",[G,R,c]),ge=st(r=>{I(r)},500),pt=st(r=>{V(r)},500),P=r=>{console.log("ðŸš€ ~ handleMinInputChange ~ val:",r),ge(r)},ce=r=>{console.log("ðŸš€ ~ handleMaxInputChange ~ val:",r),pt(r)};m.useEffect(()=>{Te(C)},[C,ae]),m.useEffect(()=>{le(w)},[w,ae]);const Te=r=>{if(console.log("ðŸš€ ~ changeLowerPriceSize ~ val:",r),ae&&r){const U=b(r).div(ae).sub(1).mul(100).toString();console.log("ðŸš€ ~ handleMaxInputChange ~ upperPrice:",U),J(b(U).gt(1e4)?">10,000%":`${F(U,1,!1,Ae.ROUND_HALF_DOWN)}%`)}},le=r=>{if(ae&&r){const U=b(r).div(ae).sub(1).mul(100).toString();console.log("ðŸš€ ~ handleMaxInputChange ~ upperPrice:",U),Z(b(U).gt(1e4)?">10,000%":`${F(U,1,!1,Ae.ROUND_HALF_DOWN)}%`)}};return{currentPrice:ae,handleMinInputChange:P,handleMaxInputChange:ce,warningTokenList:xe,resetInputAmount:me,cycleFrequency:ye,btnStatus:Y,fetchFindAvailableRouterDebounce:y,queryDcaQuote:Pe,findRouterLoading:Je,platformFee:Me,estEndDate:He,sellPerOrder:R,isDcaSelect:Ne,onReverseClick:Se,sellBalanceInfo:X,buyBalanceInfo:q,sellAmountValue:de,handleAmountChange:Oe,handleSelectToken:Re,minPriceValue:C,maxPriceValue:w,handlePageToggleDirect:Ce,orderSizeError:ee,orderInputError:we,priceError:fe,orderTimeError:je}}function la(){const{peripherySdk:a}=Qe(),{getTokenInfo:s}=Ut(),{setFilterTokenLoading:e}=gs(),{setInCoinWhiteList:h,setOutCoinWhiteList:o}=he();return{getDcaCoinWhiteList:async i=>{var n,x;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:44 ~ getDcaCoinWhiteList ~ getDcaCoinWhiteList:");try{e(!0);const{inCoinList:l,outCoinList:g}=await a.Dca.getDcaCoinWhiteList(i);console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:18 ~ getDcaCoinWhiteList ~ outCoinList:",g),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:18 ~ getDcaCoinWhiteList ~ inCoinList:",l);const p=[],D=[];for(let d=0;d<l.length;d++){const u=await s(l[d]);p.push({...u,labels:((n=u==null?void 0:u.labels)==null?void 0:n.length)>0?u.labels:""})}for(let d=0;d<g.length;d++){const u=await s(g[d]);D.push({...u,labels:((x=u==null?void 0:u.labels)==null?void 0:x.length)>0?u.labels:""})}console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDca.ts:351 ~ getDcaCoinWhiteList ~ outList:",D),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDca.ts:351 ~ getDcaCoinWhiteList ~ inList:",p),h(p),o(D),e(!1)}catch(l){h([]),o([]),e(!1),console.log("ðŸš€ ~ file: useGetDcaTokenList.ts:35 ~ getDcaCoinWhiteList ~ error:",l)}}}}function oa(){const{peripherySdk:a}=Qe(),{getDcaQuote:s}=Xt(),e=(c,i,n,x,l,g)=>{const p=b(ht(c,n)).div(i),D=b(p).div(b(l)),d=b(p).div(b(g));let u,v;if(n>x){const A=Ae.pow(10,n-x);u=d.div(A).ceil().toString(),v=D.div(A).ceil().toString()}else if(n<x){const A=Ae.pow(10,x-n);u=d.mul(A).ceil().toString(),v=D.mul(A).ceil().toString()}else u=d.ceil().toString(),v=D.ceil().toString();return{perCycleMinOutAmount:u,perCycleMaxOutAmount:v,cycleCountAmount:p}},h=(c,i,n,x)=>{const{in_coin:l,in_coin_amount:g,freq:p,cycle_count:D,out_coin:d}=c;return{in_coin_amount:String(ht(g,l.decimals)),in_coin_type:l.coin_type,out_coin_type:d.coin_type,cycle_frequency:p,cycle_count:D,per_cycle_min_out_amount:n,per_cycle_max_out_amount:x,per_cycle_in_amount_limit:i.amountInLimitPerCycle,fee_rate:i.feeRate,timestamp:i.timestamp,signature:i.signature}};return{openDcaOrder:async c=>{const{in_coin:i,out_coin:n,in_coin_amount:x,cycle_count:l,min_price:g,max_price:p,freq:D}=c,d=a.ClmmSDK.senderAddress||"0x0000000000000000000000000000000000000000000000000000000000000000",u=await s({inCoin:i.coin_type,freq:D,count:l,sender:d});if(!u)throw new Error("Request timed out");const{perCycleMinOutAmount:v,perCycleMaxOutAmount:A}=e(x,l,i.decimals,n.decimals,g,p),T=h(c,u,v,A);console.log("ðŸš€ðŸš€ðŸš€ ~ file: useOpenDcaOrder.ts:91 ~ openDcaOrder ~ dcaOpenOrderPayloadParams:",T);const z=await a.Dca.dcaOpenOrderPayload(T);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useOpenDcaOrder.ts:55 ~ openDcaOrder ~ tx:",z),z}}}function Jt({detailsData:a,isConfirm:s=!1}){const{sellPerOrder:e,estEndDate:h,platformFee:o,minPriceValue:c,maxPriceValue:i,minPriceResever:n,maxPriceResever:x}=a,{sellCoin:l,buyCoin:g,sellTotalAmount:p,investNum:D,currentInvest:d,pageDirect:u}=he();return console.log("ðŸš€ ~ DetailsBlock ~ investNum:",a,D),t.jsxs(K,{w:"100%",gap:s?"20px":"16px",children:[t.jsx(_e,{isLoading:!1,label:"Sell total",value:p?`${F(p,l==null?void 0:l.decimals)} ${l==null?void 0:l.symbol}`:`-- ${l==null?void 0:l.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(_e,{isLoading:!1,label:"Sell per order",value:e?`${F(e,l==null?void 0:l.decimals)} ${l==null?void 0:l.symbol}`:`-- ${l==null?void 0:l.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),!s&&t.jsx(_e,{isLoading:!1,label:"Receive",value:t.jsxs(N,{gap:"4px",children:[t.jsx(hs,{imageUrl:g==null?void 0:g.logo_url,w:"20px",h:"20px",coinType:g==null?void 0:g.coin_type,showTagHeight:"10px",showTagWidth:"10px"}),t.jsx(E,{color:"text_caption",children:g==null?void 0:g.symbol})]}),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx(E,{textAlign:"left",whiteSpace:"nowrap",children:"Price range"}),t.jsx(Vt,{displayTokenA:g,displayTokenB:l,isRank:!0,justify:"flex-end",priceInfo:{minPrice:at(c).toString(),maxPrice:at(i).toString(),minPriceResever:at(n).toString(),maxPriceResever:at(x).toString()},fontSize:"14px",color:"text_caption"})]}),t.jsx(_e,{isLoading:!1,label:"Invest every",value:Number(D)>1?`${D} ${d}s`:`${D} ${d}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsx(_e,{isLoading:!1,label:"Start date",value:String(Ie(Date.now(),"YMDHM")),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(_e,{isLoading:!1,label:"Est. end date(UTC)",value:h,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(_e,{isLoading:!1,label:"Platform fee",value:o,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}})]})}const ra=({confirmData:a,isOpen:s,onClose:e,toOpenDca:h,toOpenDcaLoading:o})=>{const{sellCoin:c,buyCoin:i}=he();return t.jsxs(ys,{autoFocus:!1,returnFocusOnClose:!1,isOpen:s,onClose:e,isCentered:!0,children:[t.jsx(vs,{}),t.jsxs(Ss,{children:[t.jsx(bs,{children:t.jsx(_s,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),t.jsx(Ds,{}),t.jsx(ws,{textAlign:"center",p:"0px",children:t.jsxs(K,{w:"100%",gap:"16px",p:"16px",children:[t.jsxs(Ke,{borderRadius:"8px",position:"relative",p:"0 12px",children:[t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsxs(K,{align:"flex-start",w:"calc(50% - 24px)",children:[t.jsx(E,{children:"Sell"}),t.jsx(Ct,{portal:!1,token:c,haveName:!1,symbolEllipsesDecimals:10})]}),t.jsx(Wt,{w:"1px",h:"100px",bg:"border"}),t.jsxs(K,{align:"flex-end",w:"calc(50% - 24px)",children:[t.jsx(E,{children:"Buy"}),t.jsx(Ct,{portal:!1,token:i,haveName:!1,symbolEllipsesDecimals:10})]})]}),t.jsx(_t,{w:"36px",h:"36px",borderRadius:"50%",position:"absolute",left:"calc(50% - 18px)",top:"calc(50% - 18px)",border:"1px solid",borderColor:"border",boxShadow:"trade_icon_shadow",bg:"input_bg",children:t.jsx(ke,{mt:"-1px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",transform:"rotate(-90deg)"})})]}),t.jsx(Jt,{detailsData:a,isConfirm:!0}),t.jsx(We,{mt:"12px",onClick:()=>{h(),e()},disabled:o,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Create DCA Order"})]})})]})]})};function ua({detailsData:a}){return t.jsx(Ke,{children:t.jsxs(K,{gap:"20px",children:[t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx(E,{color:"text_caption",children:"Details"}),t.jsx(E,{fontSize:"12px",children:"Your first invest cycle will begin immediately"})]}),t.jsx(Jt,{detailsData:a})]})})}function Mt({title:a,label:s,inputValue:e,inputChange:h=()=>{},list:o=[],onListItemClick:c=()=>{}}){const i=n=>{const x=n.target.value.replace(/[^\d]/g,"");h(x)};return t.jsx(Ft,{w:"50%",borderRadius:"16px",children:t.jsxs(K,{gap:"16px",align:"flex-start",children:[typeof a=="string"?t.jsx(E,{fontWeight:"500",lineHeight:"18px",fontSize:"13px",children:a}):a,t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx(fs,{value:e,onChange:i,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),o.length>0?t.jsx(ks,{label:s,list:o,onListItemClick:c}):t.jsx(E,{color:"text_caption",children:s})]})]})})}function Et({direct:a,text:s,align:e,inputValue:h,inputChange:o=()=>{}}){const{sellCoin:c,buyCoin:i}=he();return t.jsx(Ft,{w:"unset",borderRadius:"8px",children:t.jsx(N,{children:t.jsxs(K,{align:e,children:[t.jsx(js,{value:h,placeholder:"0.0",decimals:18,onChange:n=>o(n),style:{width:"calc(100% - 8px)",textAlign:e=="flex-start"?"left":"right",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx(E,{fontSize:"12px",fontWeight:"500",children:a?`${i==null?void 0:i.symbol} per ${c==null?void 0:c.symbol}`:`${c==null?void 0:c.symbol} per ${i==null?void 0:i.symbol}`}),s&&t.jsx(E,{fontSize:"12px",fontWeight:"500",children:s})]})]})})})}function pa({handleGetDcaOrderList:a}){const{sellCoin:s,buyCoin:e,sellAmount:h,buyAmount:o,setInvestNum:c,setOrderNum:i,investNum:n,orderNum:x,currentInvest:l,setCurrentInvest:g,pageDirect:p,isDcaRefresh:D,dcaMode:d,setDcaMode:u,sellTotalAmount:v,upperPriceSize:A,lowerPriceSize:T,setLowerPriceSize:z,setUpperPriceSize:G}=he(),{currentPrice:L,btnStatus:k,findRouterLoading:Q,sellBalanceInfo:J,buyBalanceInfo:Z,sellAmountValue:B,handleAmountChange:te,handleSelectToken:ne,minPriceValue:$,maxPriceValue:M,handleMinInputChange:O,handleMaxInputChange:H,handlePageToggleDirect:se,onReverseClick:_,orderSizeError:S,orderInputError:C,orderTimeError:I,priceError:w,sellPerOrder:V,estEndDate:X,platformFee:q,fetchFindAvailableRouterDebounce:de,cycleFrequency:Oe,resetInputAmount:Ce,warningTokenList:Re}=ca();m.useEffect(()=>{D&&de()},[D]);const{currentAccount:me,onWalletModal:Se}=lt(),[Ne,Be]=m.useState("#icon-a-icon_trade"),R=["Minute","Hour","Day","Week","Month"],De=P=>Be(P?"#icon-icon_swap1":"#icon-a-icon_trade"),{openDcaOrder:Me}=oa(),[ue,ee]=m.useState(!1),{fetchCoinBalance:we}=Dt(),{signAndExecuteTransaction:fe,transactionRejected:He,transactionConfirmation:Ee}=ot(),{failedTsToast:je}=Ps(),{showInsufficientBalanceToast:$e}=Ls(),Xe=async()=>{ee(!0);const P={getShowInfo:le=>{`${F(v)}${s==null?void 0:s.symbol}${e==null?void 0:e.symbol}${x}`;const oe={modalDescriptionText:"Creating DCA Order",toastTitleText:"Creating DCA Order"};return le==="success"&&(oe.modalDescriptionText="DCA Order Created",oe.toastDescriptionContent="",oe.toastTitleText="DCA Order Created"),oe}};Ee(P);const ce=p?b(1).div(M).toString():$,Te=p?b(1).div($).toString():M;try{const le={in_coin:s,out_coin:e,in_coin_amount:v,cycle_count:x,min_price:ce,max_price:Te,freq:Oe};console.log("ðŸš€ ~ toOpenDca ~ params:",!p,$,M,ce,Te,le);const oe=await Me(le);console.log("ðŸš€ ~ toOpenDca ~ tx:",oe);const Fe=await fe(oe,P);console.log("ðŸš€ ~ toOpenDca ~ res:",Fe),Fe&&(Ce(),setTimeout(()=>{we(me==null?void 0:me.address,s==null?void 0:s.coin_type),a(me==null?void 0:me.address)},2e3)),ee(!1)}catch(le){const oe={getShowInfo:Fe=>{const r={};return String(le)==="Error: Each order size should be higher than $10"&&(r.toastTitleText="Transaction Submission Error",r.toastDescriptionContent="Each order size should be higher than $10."),String(le)==="Error: Request timed out"&&(r.toastTitleText="Request timed out",r.toastDescriptionContent="Please confirm the network status and resubmit the transaction."),String(le)==="Error: minPrice error"&&(r.toastTitleText="DCA order submission failed",r.toastDescriptionContent="Your nominated prices are out of scope. Please modify your accepted price range and submit it again."),r}};console.log("ðŸš€ ~ toOpenDca ~ error:",le),console.error("Open DCA Order Error: ",le),$e(String(le)),He(oe),je(oe),ee(!1)}},{currentCoinKey:ye,inCoinWhiteList:Pe,outCoinWhiteList:ze,dcaConfig:ve}=he(),{getDcaCoinWhiteList:Je}=la(),[Ve,pe]=m.useState([]);m.useEffect(()=>{ye=="sellCoin"?pe(Pe):pe(ze)},[ye,Pe,ze]),m.useEffect(()=>{ve&&(ve.whitelistMode||ve.whitelistMode==0)&&(console.log("ðŸš€ðŸš€ðŸš€ ~ file: DcaInputBlock.tsx:101 ~ DcaInputBlock ~ dcaConfig:",ve),Je(ve.whitelistMode))},[ve]);const[Ue,Ze]=m.useState(!1),y=m.useMemo(()=>{const P=p?e==null?void 0:e.decimals:s==null?void 0:s.decimals;let ce="",Te="",le="",oe="";return $&&M&&(ce=p?Ye(b(1).div(M).toString(),P,!0).toString():$,Te=p?Ye(b(1).div($).toString(),P,!0).toString():M,le=p?$:Ye(b(1).div(M).toString(),P,!0).toString(),oe=p?M:Ye(b(1).div($).toString(),P,!0).toString()),{estEndDate:X,sellPerOrder:V,platformFee:q,minPriceValue:ce,maxPriceValue:Te,minPriceResever:le,maxPriceResever:oe}},[p,X,V,q,$,M]),j=[{label:"Total",value:"total"},{label:"Per Order",value:"perOrder"}],[f,W]=m.useState([0,0]),[Y,xe]=m.useState(0),[ae,ge]=m.useState(0),pt=P=>{console.log("ðŸš€ ~ handleSlider ~ val:",P),W(P),O(P[0].toString()),H(P[1].toString())};return m.useEffect(()=>{if($&&M){const P=Number($),ce=Number(M);W([P,ce]),console.log("ðŸš€ ~ useEffect ~ start:",P,ce)}$||z("0%"),M||G("0%")},[$,M]),m.useEffect(()=>{if(L){const P=b("-100").div(100).plus(1).mul(L).toNumber(),ce=b("100").div(100).plus(1).mul(L).toNumber();console.log("ðŸš€ ~ useEffect ~ min:",P,ce),xe(P),ge(ce)}},[L]),t.jsxs(K,{w:"100%",children:[t.jsx(Fs,{onClick:_,currentCoinKey:ye,whiteTokenList:Ve,from:{inputTabOptions:{type:"outlineTab",tabList:j,currentTab:d=="total"?"Total":"Per Order",handleChangeTab:P=>{u(P==null?void 0:P.value)},wrapStyle:{w:"168px",h:"28px",p:"3px",borderRadius:"10px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px",borderRadius:"6px"}},title:"You Pay",balance:(J==null?void 0:J.balanceFormat)||"",value:h,amountValue:B,loading:!1,onChange:te,selectable:!0,placeholder:"0.0",token:s,whiteTokenList:Pe,onTokenChange:P=>ne(P,!0)},to:{isDcaTo:!0,wrapStyle:{backgroundColor:"bg_secondary",h:"94px"},title:"You Receive",inputAllowed:!1,balance:(Z==null?void 0:Z.balanceFormat)||"",value:"",amountValue:"",loading:!1,onChange:()=>{},token:e,whiteTokenList:ze,onTokenChange:P=>ne(P,!1),selectable:!0,placeholder:"",half:!1,max:!1},iconParams:{xlinkHref:Ne,svgFill:"text_caption",transform:Ne==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:Ne==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>De(!0),onMouseLeave:()=>De(!1)}}),(S==null?void 0:S.status)&&t.jsx(nt,{tips:S==null?void 0:S.tips}),t.jsxs(N,{w:"100%",children:[t.jsx(Mt,{title:"Invest Every",label:l,inputValue:n,list:R,onListItemClick:P=>{g(P)},inputChange:P=>{console.log("ðŸš€ ~ DcaInputBlock ~ item:",P),c(P)}}),t.jsx(Mt,{title:t.jsx(Us,{type:"over",children:t.jsx(E,{fontSize:"13px",fontWeight:"500",mr:"4px",children:"Over"})}),label:"Orders",inputValue:x,inputChange:P=>{i(P),de()}})]}),(C==null?void 0:C.status)&&t.jsx(nt,{tips:C==null?void 0:C.tips}),(I==null?void 0:I.status)&&t.jsx(nt,{tips:I==null?void 0:I.tips}),t.jsxs(Ke,{zIndex:"1",p:"16px",borderRadius:"16px",children:[t.jsxs(K,{align:"flex-start",children:[t.jsx(E,{color:"text_caption",children:"Set Price Range"}),t.jsx(E,{lineHeight:"16px",fontSize:"12px",m:{base:"4px 0",lg:"0"},mb:{base:h?"4px":"0"},children:"DCA will only be executed if the price falls within the range of your pricing strategy."}),h&&V&&t.jsxs(N,{mt:"8px",w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"align",lg:"center"},children:[t.jsx(E,{children:"Current Rate"}),t.jsx(K,{align:{base:"flex-start",lg:"flex-end"},children:t.jsx(Vs,{color:"text_caption",pageDirect:p,handlePageToggleDirect:se,fromToken:s,toToken:e,fromValue:V,toValue:o,isLoading:Q||!o||!V})})]})]}),t.jsxs(N,{justify:"space-between",gap:"8px",mt:"20px",children:[t.jsx(Et,{direct:p,text:h&&$?T:"",inputValue:$,inputChange:P=>O(P),align:"flex-start"}),t.jsx(E,{color:"text_caption",children:"-"}),t.jsx(Et,{direct:p,text:h&&M?A:"",inputValue:M,inputChange:P=>H(P),align:"flex-start"})]}),!Q&&h&&$&&M&&Number(M)>=Number($)&&(k==null?void 0:k.text)!=="No Available Route"&&t.jsxs(K,{w:"100%",gap:"0",mt:"20px",children:[t.jsxs(Gt,{min:Y,max:ae,step:.1,value:f,onChange:P=>{pt(P)},colorScheme:"teal",children:[t.jsx(qt,{children:t.jsx(Yt,{})}),t.jsx(vt,{index:0}),t.jsx(vt,{index:1})]}),t.jsx(Ts,{src:Hs,w:"32px",h:"32px"}),t.jsx(N,{w:"100%",h:"14px",justify:"center",mt:"-2px",children:t.jsx(E,{children:"Current Rate"})})]})]}),(w==null?void 0:w.status)&&t.jsx(nt,{tips:w==null?void 0:w.tips}),t.jsx(We,{isLoading:ue,disabled:(k==null?void 0:k.disabled)||ue,w:"100%",h:"52px",fontSize:"18px",fontWeight:"500",onClick:(k==null?void 0:k.text)=="Connect Wallet"?()=>Se(!0):()=>Ze(!0),children:k==null?void 0:k.text}),h&&t.jsx(ua,{detailsData:y}),Ue&&t.jsx(ra,{confirmData:y,isOpen:Ue,onClose:()=>Ze(!1),toOpenDca:Xe,toOpenDcaLoading:ue}),(e||s)&&t.jsx(Gs,{addToken:!0,tokensInfo:Re,waringModalCancel:P=>{P.forEach(ce=>{(ce.coin_type===(e==null?void 0:e.coin_type)||ce.coin_type===(s==null?void 0:s.coin_type))&&ne(void 0,ce.coin_type===(e==null?void 0:e.coin_type))})}})]})}const nt=({tips:a})=>t.jsxs(N,{w:"100%",bg:"primary_red_bg",p:"12px",borderRadius:"12px",children:[t.jsx(ke,{svgW:"16px",svgH:"16px",variant:"error",xlinkHref:"#icon-icon-warning",cursor:"text"}),t.jsx(E,{color:"primary_red",lineHeight:"20px",children:a})]});function ma(a){const i=Math.floor(a/2592e3);a%=2592e3;const n=Math.floor(a/604800);a%=604800;const x=Math.floor(a/86400);a%=86400;const l=Math.floor(a/3600);a%=3600;const g=Math.floor(a/60);a%=60;const p=[];return i>0&&p.push(`${i} Month${i>1?"s":""}`),n>0&&p.push(`${n} Week${n>1?"s":""}`),x>0&&p.push(`${x} Day${x>1?"s":""}`),l>0&&p.push(`${l} Hour${l>1?"s":""}`),g>0&&p.push(`${g} Minute${g>1?"s":""}`),p.join(" ")}function xa(){const{getTokenInfo:a}=Ut(),{peripherySdk:s}=Qe(),e=async l=>{console.log("ðŸš€ ~ getDcaOrderList ~ walletAddress:",l);try{const g=await s.Dca.getDcaOrders(l);return console.log("ðŸš€ ~ getDcaOrderList ~ list:",g),await x(g==null?void 0:g.data)}catch(g){console.log("ðŸš€ ~ getDcaOrderList ~ error:",g)}},h=async l=>{const g=await a(l),p=Ae.pow(10,g==null?void 0:g.decimals);return{token:g,decimalsPow:p}},o=(l,g,p,D,d)=>{const u=b(l).div(g).div(b(D).div(p)).toString(),v=b(l).div(g).div(b(d).div(p)).toString();return{minPrice:u,maxPrice:v,minPriceResever:b(1).div(b(v)).toString(),maxPriceResever:b(1).div(b(u)).toString()}},c=l=>l.in_withdrawn>0&&l.in_withdrawn==l.in_deposited?"Close":l.in_withdrawn>0&&l.out_withdrawn>0?"PartialDeal":l.amount_left_next_cycle==0&&l.next_cycle_at==0?"AllDeal":"Active",i=(l,g,p,D,d,u,v)=>{const A=T=>T==="--"?"--":b(1).div(T).toString();switch(l){case"Close":return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"};case"PartialDeal":{const T=g.sub(p).div(u).toString(),z=g.sub(p).div(g).mul(100).toDP(2,Ae.ROUND_HALF_UP).toString();return console.log("ðŸš€ ~ useGetDcaOrderList ~ inDeposited:",p,g),{currentAvgPrice:T,currentAvgPriceResever:A(T),inBalanceRatio:z,inDepositedOut:g.sub(p).toString()}}case"AllDeal":{const T=g.div(u).toString();return{currentAvgPrice:T,currentAvgPriceResever:A(T),inBalanceRatio:"100",inDepositedOut:g.sub(D).toString()}}case"Active":{const T=d.gt(0)||u.gt(0)?g.sub(D).div(d.add(u)).toString():"--",z=g.sub(D).div(g).mul(100).toDP(2,Ae.ROUND_HALF_UP).toString();return{currentAvgPrice:T,currentAvgPriceResever:A(T),inBalanceRatio:z,inDepositedOut:g.sub(D).toString()}}default:return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"}}},n=(l,g,p,D)=>{const d=Date.now()/1e3,u=b(d).sub(l).div(g),v=p.lte(0)&&b(D).lte(0);return u.gt(3)&&v},x=async l=>{const g=[],p=[];for(const u of l){const{token:v,decimalsPow:A}=await h(u.in_coin_type),{token:T,decimalsPow:z}=await h(u.out_coin_type),G=b(u.in_deposited).div(A);console.log("ðŸš€ ~ buildDcaOrderList ~ order.in_deposited:",u.in_deposited,A);const L=b(u.in_deposited).div(u.in_amount_per_cycle).floor().toString(),k=b(u.in_amount_per_cycle).div(A).toString(),Q=b(u.in_balance).div(A),J=b(u.in_withdrawn).div(A),Z=b(u.out_balance).gt(0)?b(u.out_balance).div(z):b(0),B=b(u.out_withdrawn).div(z),te=F(G.div(L).toString()),ne=Q.div(k).floor().toNumber(),{minPrice:$,maxPrice:M,minPriceResever:O,maxPriceResever:H}=o(u.in_amount_per_cycle,A,z,u.max_out_amount_per_cycle,u.min_out_amount_per_cycle),se=c(u),{currentAvgPrice:_,currentAvgPriceResever:S,inBalanceRatio:C,inDepositedOut:I}=i(se,G,J,Q,Z,B),w=n(u.created_at,u.cycle_frequency,Z,B),V={createAt:Ie(u.created_at*1e3,"YMDHM"),cycleFrequency:u.cycle_frequency,orderID:u.id,inAmountPerCycle:k,nextCycleAt:Ie(u.next_cycle_at*1e3,"YMDHM"),inDeposited:G.toString(),cycleCount:L,inDepositedOut:I,inBalance:Q.toString(),minPrice:F($),maxPrice:F(M),minPriceResever:F(O),maxPriceResever:F(H),inCoin:v,outCoin:T,outBalance:Z.toString(),inBalanceRatio:C,outWithdraw:B.toString(),investEvery:ma(u.cycle_frequency),eachOrderSize:te,currentAvgPrice:_==="--"?"--":F(_,T.decimals),currentAvgPriceResever:_==="--"?"--":F(S,v.decimals),orderStatus:se,inWithdrawn:J.toString(),ofOrderLeft:ne,isShowTradeTips:w,next_cycle_at:u.created_at+ne*u.cycle_frequency,created_at:u.created_at,version:u.version};se==="Active"?g.push(V):p.push(V)}const D=g==null?void 0:g.sort((u,v)=>v.version-u.version),d=p==null?void 0:p.sort((u,v)=>v.version-u.version);return console.log("ðŸš€ ~ buildDcaOrderList ~ activeResult, pastResult:",D,d,g,p),{activeResult:D,pastResult:d}};return{getDcaOrderList:e}}function qa(){const[a,s]=m.useState([]),[e,h]=m.useState([]),{currentAccount:o}=lt(),{sellCoin:c,buyCoin:i,setIsDcaRefresh:n}=he(),[x,l]=m.useState(!0),{isShowTradeChart:g,isShowTradeOrders:p}=qs(),{getDcaOrderList:D}=xa(),{fetchAccountBalance:d}=Dt(),u=async(L,k=!1)=>{if(!p)return;k&&l(!0);const{activeResult:Q,pastResult:J}=await D(L);s(Q),h(J),l(!1),console.log("ðŸš€ ~ handleGetDcaOrderList ~ list:",Q,J)};m.useEffect(()=>{o!=null&&o.address?u(o==null?void 0:o.address,!0):(s([]),h([]))},[o==null?void 0:o.address,p]);const v=(L=!0)=>{G(0),n(!0),setTimeout(()=>{n(!1)},1e3),o!=null&&o.address&&(L||d(),u(o==null?void 0:o.address,L))};Ys({onRpcChange:()=>{v()}}),m.useEffect(()=>{o!=null&&o.address&&d()},[o==null?void 0:o.address]);const{isApp:A,windowWidth:T}=ct(),[z,G]=m.useState(0);return As({interval:1e3,callback:()=>{G(z+1),z>=20&&v(!1)}}),t.jsxs(N,{mt:T&&T<1024?"28px":"42px",className:A||g||p?"":"bg_img",w:"100%",gap:"16px",justify:"center",align:"flex-start",flexDirection:{base:"column",lg:"row"},children:[(p||g)&&t.jsxs(K,{w:{base:"100%",lg:"calc(100% - 470px)"},mt:A&&!g?"-16px":"0",children:[g&&t.jsx(Cs,{baseToken:c,quoteToken:i}),p&&!A&&t.jsx(Nt,{handleRefresh:v,activeList:a,pastList:e,isOrderLoading:x})]}),t.jsxs(K,{w:{base:"100%",lg:"470px"},children:[t.jsxs(N,{w:"100%",justify:"space-between",mb:"8px",children:[t.jsx(Rs,{currTradeTab:Ns.DCA}),t.jsx(Os,{})]}),t.jsx(pa,{handleGetDcaOrderList:L=>u(L)})]}),A&&p&&t.jsx(K,{w:{base:"100%",lg:"calc(100% - 470px)"},children:t.jsx(Nt,{handleRefresh:v,activeList:a,pastList:e,isOrderLoading:x})})]})}export{qa as default};
