import{an as v,aE as I,d as A,a1 as O,bS as D}from"./index-Bms7VPPn.js";import{a as E}from"./useXCetusHelper-Dedtp_QL.js";import{a as j}from"./useCurrentPos-YsnSDeCn.js";function k(){const{fetchOwnerVeNFT:S}=E(),{showCommonToast:s}=v(),{notifiSources:p}=I();return{createNotifiSubscriptionVerify:async()=>{try{const i=await S();if(i!=null&&i.xcetus_balance){if(A(i.xcetus_balance).div(Math.pow(10,9)).lessThan(1e3))return s("Price alerts are currently open to users who hold 1000+ xCETUS.","rejected"),!1}else return s("Unable to fetch xCetus information.","rejected"),!1;return p.length>=5?(s("Price alerts can only be enabled for up to 5 positions for an account at the same time.","rejected"),!1):!0}catch(i){return console.error("ğŸš€ ~ createNotifiSubscriptionVerify ~ error:",i),s("An error occurred while verifying the subscription.","rejected"),!1}},getPositionNotifiStatus:(i,u)=>{try{const c=p.find(b=>{const{pool_address:N,position_index:g}=JSON.parse(b.blockchainAddress);return N===i&&g===u});return{isSubscription:!!c,alertID:(c==null?void 0:c.alertID)||""}}catch(c){return console.error("ğŸš€ ~ getPositionNotifiStatus ~ error:",c),{isSubscription:!1,alertID:""}}}}}function F(){const{getCurrentPosByPosId:S}=j(),{currentAccount:s}=O(),{createNotifiAlert:p,getNotifiAlerts:_,deleteNotifiAlerts:y}=D(),{setIsChecked:i,setNotifiSubscriptionLoading:u,notifiClient:c}=I(),{createNotifiSubscriptionVerify:b,getPositionNotifiStatus:N}=k(),g=async o=>{if(u(!0),!await b())return i(!1),!1;const{subscriptionSource:e,position:r,posIndex:d,events:l}=o;console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:30 ~ notifiSubscription ~ notifiSubscriptionParams:",o);try{if(e=="PositionDetail")x(String(r),String(d));else{const a=l.filter(h=>h.type.indexOf("OpenPositionEvent")>-1)[0],t=l.filter(h=>h.type.indexOf("DepositEvent")>-1)[0],{position:f,pool:w}=a.parsedJson,P=t?t.parsedJson.wrapped_position_id:a.parsedJson.position,m=await S(s==null?void 0:s.address,P);m&&(console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:36 ~ notifiSubscription ~ currentPosInfo.index:",m.index),x(f,String(m.index)))}}catch(a){u(!1),console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:45 ~ notifiSubscription ~ error:",a)}},x=async(o,n)=>{p(o,n)},T=async(o,n,e)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:57 ~ notifiUnSubscription ~ posId:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:58 ~ notifiUnSubscription ~ posIndex:",e);const{alertID:r}=N(o,String(e));r&&y(r)};return{notifiSubscription:g,notifiUnSubscription:T,getNotifiPositionTransfer:(o,n,e)=>{if(n&&n.userState&&n.userState.status=="authenticated"){console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:62 ~ getNotifiPositionTransfer ~ notifiSources:",e);for(let r=0;r<e.length;r++){const{pool_address:d,position_index:l}=JSON.parse(e[r].blockchainAddress);let a=!1,t;for(let f=0;f<o.length;f++){const{posId:w,index:P}=o[f];d==w&&Number(P)==Number(l)&&(a=!0),t={pool_address:d,position_index:l,clmmPool:o[f].clmmPool}}a||T(t==null?void 0:t.pool_address,t==null?void 0:t.clmmPool,t==null?void 0:t.position_index)}}console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiSources:",e),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ posBaseList:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiClient:",n.us)}}}export{k as a,F as u};
