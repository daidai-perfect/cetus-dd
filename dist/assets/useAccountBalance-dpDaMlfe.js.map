{"version":3,"file":"useAccountBalance-dpDaMlfe.js","sources":["../../../hooks/src/useAccountBalance.ts"],"sourcesContent":["import { useSdk } from '@cetus/sdk-factory'\nimport { useAccountStore } from '@cetus/stores'\nimport useTokenBalanceStore from '@cetus/stores/src/tokenBalance'\nimport { extractStructTagFromType, fixCoinType } from '@cetusprotocol/common-sdk'\nimport { CoinBalance } from '@mysten/sui/client'\nimport { useEffect, useRef } from 'react'\n\nexport function useAccountBalance() {\n  const { currentAccount } = useAccountStore()\n  const clmmSdk = useSdk('clmm')\n  const { setTokenBalanceObj, clearData, setIsLoading, isLoading, ownerAddress } = useTokenBalanceStore()\n  const currentAcc = useRef(currentAccount?.address)\n  useEffect(() => {\n    currentAcc.current = currentAccount?.address\n  }, [currentAccount?.address])\n\n  const fetchAccountBalance = async (account: string = currentAccount?.address || '', forceRefresh: boolean = false) => {\n    try {\n      if (isLoading && !forceRefresh) {\n        return []\n      }\n\n      if (account) {\n        setIsLoading(true)\n        const res = await clmmSdk!.FullClient.getOwnerCoinBalances(account)\n        const obj: Record<string, CoinBalance> = {}\n        res.forEach(coin => {\n          coin.coinType = fixCoinType(coin.coinType, false)\n          obj[extractStructTagFromType(coin.coinType).full_address] = coin\n        })\n        if (account == currentAcc.current) {\n          setTokenBalanceObj(obj, account)\n        }\n        return res\n      }\n    } catch (error) {\n      console.log('ðŸš€ ~ file: useAccountBalance.ts:18 ~ fetchAccountBalance ~ error:', error)\n      if (ownerAddress !== account) {\n        clearData()\n      }\n      return undefined\n    } finally {\n      setIsLoading(false)\n    }\n    return []\n  }\n\n  const fetchCoinBalance = async (account: string = currentAccount?.address || '', coinType?: string) => {\n    try {\n      if (account && coinType) {\n        const res = await clmmSdk!.FullClient.getOwnerCoinBalances(account, coinType)\n        const obj: Record<string, CoinBalance> = {}\n\n        res.forEach(coin => {\n          obj[extractStructTagFromType(coin.coinType).full_address] = coin\n        })\n        if (account == currentAcc.current) {\n          setTokenBalanceObj(obj, account)\n        }\n        return obj\n      }\n    } catch (error) {\n      console.log('ðŸš€ ~ file: useAccountBalance.ts:18 ~ fetchCoinBalance ~ error:', error)\n    }\n  }\n\n  useEffect(() => {\n    if (!currentAccount) {\n      clearData()\n      setIsLoading(false)\n    }\n  }, [currentAccount?.address])\n\n  return {\n    fetchAccountBalance,\n    fetchCoinBalance,\n    isLoading\n  }\n}\n"],"names":["useAccountBalance","currentAccount","useAccountStore","clmmSdk","useSdk","setTokenBalanceObj","clearData","setIsLoading","isLoading","ownerAddress","useTokenBalanceStore","currentAcc","useRef","useEffect","fetchAccountBalance","account","forceRefresh","res","obj","coin","fixCoinType","extractStructTagFromType","error","fetchCoinBalance","coinType"],"mappings":"8GAOO,SAASA,GAAoB,CAC5B,KAAA,CAAE,eAAAC,CAAe,EAAIC,EAAgB,EACrCC,EAAUC,EAAO,MAAM,EACvB,CAAE,mBAAAC,EAAoB,UAAAC,EAAW,aAAAC,EAAc,UAAAC,EAAW,aAAAC,GAAiBC,EAAqB,EAChGC,EAAaC,EAAAA,OAAOX,GAAA,YAAAA,EAAgB,OAAO,EACjDY,EAAAA,UAAU,IAAM,CACdF,EAAW,QAAUV,GAAA,YAAAA,EAAgB,OAAA,EACpC,CAACA,GAAA,YAAAA,EAAgB,OAAO,CAAC,EAE5B,MAAMa,EAAsB,MAAOC,GAAkBd,GAAA,YAAAA,EAAgB,UAAW,GAAIe,EAAwB,KAAU,CAChH,GAAA,CACE,GAAAR,GAAa,CAACQ,EAChB,MAAO,CAAC,EAGV,GAAID,EAAS,CACXR,EAAa,EAAI,EACjB,MAAMU,EAAM,MAAMd,EAAS,WAAW,qBAAqBY,CAAO,EAC5DG,EAAmC,CAAC,EAC1C,OAAAD,EAAI,QAAgBE,GAAA,CAClBA,EAAK,SAAWC,EAAYD,EAAK,SAAU,EAAK,EAChDD,EAAIG,EAAyBF,EAAK,QAAQ,EAAE,YAAY,EAAIA,CAAA,CAC7D,EACGJ,GAAWJ,EAAW,SACxBN,EAAmBa,EAAKH,CAAO,EAE1BE,CAAA,QAEFK,EAAO,CACN,QAAA,IAAI,oEAAqEA,CAAK,EAClFb,IAAiBM,GACTT,EAAA,EAEL,MAAA,QACP,CACAC,EAAa,EAAK,CAAA,CAEpB,MAAO,CAAC,CACV,EAEMgB,EAAmB,MAAOR,GAAkBd,GAAA,YAAAA,EAAgB,UAAW,GAAIuB,IAAsB,CACjG,GAAA,CACF,GAAIT,GAAWS,EAAU,CACvB,MAAMP,EAAM,MAAMd,EAAS,WAAW,qBAAqBY,EAASS,CAAQ,EACtEN,EAAmC,CAAC,EAE1C,OAAAD,EAAI,QAAgBE,GAAA,CAClBD,EAAIG,EAAyBF,EAAK,QAAQ,EAAE,YAAY,EAAIA,CAAA,CAC7D,EACGJ,GAAWJ,EAAW,SACxBN,EAAmBa,EAAKH,CAAO,EAE1BG,CAAA,QAEFI,EAAO,CACN,QAAA,IAAI,iEAAkEA,CAAK,CAAA,CAEvF,EAEAT,OAAAA,EAAAA,UAAU,IAAM,CACTZ,IACOK,EAAA,EACVC,EAAa,EAAK,EACpB,EACC,CAACN,GAAA,YAAAA,EAAgB,OAAO,CAAC,EAErB,CACL,oBAAAa,EACA,iBAAAS,EACA,UAAAf,CACF,CACF"}