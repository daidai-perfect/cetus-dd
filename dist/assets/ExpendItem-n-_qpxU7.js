import{a as R,j as s,H as T,T as j,ab as M,V as L,v,u as W,R as V}from"./vendor-DsVemle5.js";import{u as $}from"./useTransaction-CjlygSkT.js";import{u as K}from"./useAccountBalance-CBRzIpkZ.js";import{j as G,U as J,n as D,a as Q,a2 as k,I as X,K as Y,J as Z}from"./index-DIvDX_Yh.js";import{M as H}from"./msafe-oYBkW7LJ.js";import{u as O,b as f,a as I}from"./usePositionList-DMAeOMoO.js";import{S as aa}from"./SingleTokenInfo-CBKDT-57.js";import{u as ea}from"./useToken-YYj-bY2H.js";import{P as sa,L as ta}from"./PriceRange-Cn5wVyeV.js";function ra(){const{peripherySdk:a}=G();return{getStakeTxPayload:async(c,d)=>{const l={pool_id:d,clmm_position_id:c},o=await a.Farms.depositPayload(l),t={action:H.FarmingStake,txbParams:l};return{tx:o,msafeParams:t}},getUnstakeTxPayload:async(c,d)=>{const l={pool_id:c,position_nft_id:d},o=await a.Farms.withdrawPayload(l),t={action:H.FarmingUnstake,txbParams:l};return{tx:o,msafeParams:t}},getHarvestFarmsTxPayload:async(c,d)=>{const l={pool_id:c,position_nft_id:d},o=await a.Farms.harvestPayload(l),t={action:H.FarmingHarvest,txbParams:l};return{tx:o,msafeParams:t}},getBatchHarvestFarmsTxPayload:async c=>({tx:await a.Farms.batchHarvestPayload(c),msafeParams:{action:"FarmingBatchHarvest",txbParams:c}})}}function la(){const{getBatchHarvestFarmsTxPayload:a,getStakeTxPayload:x,getUnstakeTxPayload:b,getHarvestFarmsTxPayload:i}=ra(),{signAndExecuteTransaction:u}=$(),[c,d]=R.useState(!1),[l,o]=R.useState(!1),{fetchAccountBalance:t}=K();return{toStakePos:async(y,w,n,g)=>{o(!0);try{const{tx:m,msafeParams:P}=await x(y,w);console.log("ðŸš€ ~ toStakePos ~ tx:",m);const r=await u(m,{getShowInfo:()=>({modalDescriptionText:`Stake ${n}`,toastTitleText:"Stake"})},{msafeParams:P});r&&(console.log("ðŸš€ ~ toStakePos ~ res:",r),g(r.events)),o(!1)}catch(m){console.log("ðŸš€ ~ toStakePos ~ error:",m),o(!1)}},toUnStakePos:async(y,w,n,g)=>{o(!0);try{const{tx:m,msafeParams:P}=await b(w,y);console.log("ðŸš€ ~ toUnstack ~ tx:",m);const r=await u(m,{getShowInfo:()=>({modalDescriptionText:`Unstake ${n}`,toastTitleText:"Unstake"})},{msafeParams:P});console.log("ðŸš€ ~ toUnStakePos ~ res:",r),r&&(t(),g()),o(!1)}catch(m){console.log("ðŸš€ ~ toUnStakePos ~ error:",m),o(!1)}},toClaimPos:async(y,w,n)=>{d(!0);try{const{tx:g,msafeParams:m}=await i(w,y);console.log("ðŸš€ ~ toClaimPos ~ tx:",g);const P=await u(g,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:m});console.log("ðŸš€ ~ toClaimPos ~ res:",P),P&&(t(),n()),d(!1)}catch(g){d(!1),console.log("ðŸš€ ~ toClaimPos ~ error:",g)}},toClaimAllPos:async(y,w)=>{d(!0);try{const n=[];y.forEach(r=>{r!=null&&r.farmsPool&&n.push({pool_id:r.farmsPool,position_nft_id:r.id})}),console.log("ðŸš€ ~ list.forEach  toClaimAllPos ~ params:",n);const{tx:g,msafeParams:m}=await a(n);console.log("ðŸš€ ~ toClaimAllPos ~ tx:",g);const P=await u(g,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:m});console.log("ðŸš€ ~ toClaimAllPos ~ res:",P),P&&setTimeout(async()=>{t(),w()},2e3),d(!1)}catch(n){d(!1),console.log("ðŸš€ ~ toClaimAllPos ~ error:",n)}},claimLoading:c,unstakeLoading:l}}function Pa({positionInfo:a,apiInfo:x}){var F,E;const{farmsPosRewardsData:b,posPoolsRelatedData:i,posPoolsOriginalData:u}=O(),{getPositionBaseList:c,getPosRelatedData:d}=f(),{currentAccount:l}=D(),{isApp:o}=Q(),t=b[a==null?void 0:a.id],C=t==null?void 0:t.reduce((e,h)=>e+h.display_amount_owed,0),p=i[a==null?void 0:a.posId],A=(p==null?void 0:p.currentStatus)=="Active",{getClmmPosName:U}=I(),y=R.useMemo(()=>{var e;if(a!=null&&a.tokenName)return a==null?void 0:a.tokenName;{const h=(e=u==null?void 0:u[a==null?void 0:a.clmmPool])==null?void 0:e.index;return U(a==null?void 0:a.index,h)}},[a==null?void 0:a.tokenName,a==null?void 0:a.index,a==null?void 0:a.clmmPool,u]),w=M(),n=()=>{setTimeout(async()=>{const e=await c(l==null?void 0:l.address);d(e,!0)},2e3)},{toStakePos:g,toUnStakePos:m,toClaimPos:P,unstakeLoading:r,claimLoading:S}=la(),N=async e=>{g(a==null?void 0:a.id,x==null?void 0:x.farmsPoolAddress,y,n)},q=async()=>{m(a==null?void 0:a.id,a==null?void 0:a.farmsPool,y,n)},B=async()=>{P(a==null?void 0:a.id,a==null?void 0:a.farmsPool,n)},_=R.useMemo(()=>(t==null?void 0:t.length)>0?t.reduce((e,h)=>k(e).plus(h==null?void 0:h.display_amount_owed).toString(),"0"):"0",[t,l==null?void 0:l.address,S,r]);return console.log("ðŸš€ ~ totalAmount ~ totalAmount:",_),s.jsxs(T,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:"12px",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[s.jsx(sa,{positionInfo:a,symbolEllipsesDecimals:10,labelInfo:{text:y,style:{color:"text_caption",mb:"-2px"}},children:s.jsxs(T,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:e=>{Y(e),w(`/position-detail/${a==null?void 0:a.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[s.jsx(j,{fontSize:"12px",color:"primary",children:"Manage position"}),s.jsx(X,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),s.jsxs(T,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[s.jsxs(L,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[s.jsx(j,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),s.jsx(ta,{positionInfo:a,fontSize:"14px"})]}),s.jsxs(L,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[s.jsxs(T,{gap:"4px",children:[s.jsx(j,{color:"primary_gray",children:"Earnings"}),!o&&s.jsx(v,{isLoading:S,disabled:r||S||k(C).eq(0),onClick:r||S||k(C).eq(0)?()=>{}:B,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),s.jsxs(T,{children:[s.jsx(W,{isLoaded:!!_,children:s.jsx(L,{align:"flex-end",children:t&&(t==null?void 0:t.length)>0&&k(_).gt(0)?t==null?void 0:t.map(e=>{var h;return console.log("ðŸš€ ~ ExpendItem ~ posFarmsData && posFarmsData?.length > 0 && d(totalAmount).gt(0) :",t,(t==null?void 0:t.length)>0,_,k(_).gt(0)),s.jsx(V.Fragment,{children:k(e==null?void 0:e.display_amount_owed).gt(0)&&s.jsx(z,{coinType:(h=e==null?void 0:e.token)==null?void 0:h.coin_type,amount:(e==null?void 0:e.display_amount_owed)||0,tokenInfo:e==null?void 0:e.token},e==null?void 0:e.coinType)},e==null?void 0:e.rewarder_type)}):((F=x==null?void 0:x.farmsRewarderList)==null?void 0:F.length)>0?(E=x==null?void 0:x.farmsRewarderList)==null?void 0:E.map(e=>(console.log("ðŸš€ ~ apiInfo?.farmsRewarderList?.map ~ item:",e),s.jsx(z,{coinType:e==null?void 0:e.coinType,amount:"0"},e==null?void 0:e.coinType))):s.jsx(j,{textColor:"text_caption",textAlign:"right",children:"--"})})}),o&&s.jsx(v,{isLoading:S,disabled:r||S||k(C).eq(0),onClick:r||S||k(C).eq(0)?()=>{}:B,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),s.jsxs(L,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(a==null?void 0:a.posType)=="farms"&&s.jsx(v,{disabled:r,isLoading:r,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:q,children:"Unstake"}),(a==null?void 0:a.posType)=="clmm"&&!A&&s.jsx(Z,{placement:"top",tooltip:s.jsx(j,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:s.jsx(v,{disabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),(a==null?void 0:a.posType)=="clmm"&&A&&s.jsx(v,{disabled:r,isLoading:r,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:N,children:"Stake"})]})]})]})}const z=({coinType:a,amount:x,tokenInfo:b,boxStyle:i,textAlign:u="right"})=>{console.log("ðŸš€ ~ RewardsCon ~ coinType:",a,x,J(a));const{tokenInfo:c}=ea(a);return s.jsxs(T,{...i,children:[s.jsx(aa,{token:b||c,coinType:a,imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),s.jsxs(j,{textColor:"text_caption",textAlign:u,children:[x," ",(b==null?void 0:b.symbol)||(c==null?void 0:c.symbol)]})]})};export{Pa as E,z as R,la as u};
//# sourceMappingURL=ExpendItem-n-_qpxU7.js.map
