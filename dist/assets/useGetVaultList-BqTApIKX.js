import{c as ro,u as lo}from"./useGetPoolList-DmV38xks.js";import{u as X}from"./useToken-C-8_jnEM.js";import{u as to}from"./useTokenBalance-DgQuOgL6.js";import{U as ao,bJ as no,r as i,ab as $,d as L,a7 as F,bo as so,R as uo,a5 as eo,aO as U,bK as co,bb as O,bg as E,bh as io,bq as W,j as d,V as po,H as K,T as J,C as yo,g as fo,u as vo,s as go}from"./index-B0zUQ3Cp.js";import{H}from"./HTextLabelBox-BLoxKcLW.js";import{C as Y}from"./CetusTooltip-Dg4BiRP-.js";import{a as z}from"./api-data-utils-CKHHanFA.js";const _o=(r,o)=>({detailRefreshCount:0,contractClmmPoolObjLoading:!1,contractVaultObjLoading:!1,vaultBaseListLoading:!1,vaultStatsLoading:!1,holdVaultsObj:{},holdTotalValue:{},vaultStatsObj:{},contractClmmPoolObj:{},contractVaultObj:{},setVaultStatsObj:l=>{r(()=>({vaultStatsObj:l}))},vaultBaseList:[],setVaultBaseList:l=>{r(()=>({vaultBaseList:l}))},setVaultBaseListLoading:l=>{r(()=>({vaultBaseListLoading:l}))},setVaultStatsLoading:l=>{r(()=>({vaultStatsLoading:l}))},setContractVaultObj:l=>{const n=o().contractVaultObj;n[l.id]=l,r(()=>({contractVaultObj:{...n}}))},setContractVaultObjLoading:l=>{r(()=>({contractVaultObjLoading:l}))},setContractClmmPoolObjLoading:l=>{r(()=>({contractClmmPoolObjLoading:l}))},setContractClmmPoolObj:l=>{const n=o().contractClmmPoolObj;n[l.poolAddress]=l,r(()=>({contractClmmPoolObj:{...n}}))},setHoldTotalValue:(l,n)=>{const y=o().holdTotalValue;y[l]=n,r(()=>({holdTotalValue:{...y}}))},setDetailRefreshCount:l=>{r(()=>({detailRefreshCount:l}))}}),R=ao(no(_o,{name:"useVaultsStore",partialize:r=>{const{vaultBaseList:o,vaultStatsObj:l,contractVaultObj:n,contractClmmPoolObj:y}=r;return{vaultBaseList:o,vaultStatsObj:l,contractVaultObj:n,contractClmmPoolObj:y}}}));function Do(r,o){return{lpRate:i.useMemo(()=>r&&o?L(o).eq(0)?"100%":so(L(r).div(L(r).add(o)).mul(100).toString(),9):"0%",[r,o])}}function Bo(r,o,l=!1){return{amountLimit:i.useMemo(()=>{if(o)return L(o).mul(l?1+r:1-r).toString()},[o,r,l])}}function Co(r){const{contractVaultObj:o}=R();return{contractVault:i.useMemo(()=>{if(r)return o[r]},[o,r])}}function So(r){const{contractClmmPoolObj:o}=R();return{contractClmmInfo:i.useMemo(()=>{if(r)return o[r]},[o,r])}}function Ro(r){return{stakeProtocolName:i.useMemo(()=>{if(r){if(r.includes("HASUI"))return"Haedal";if(r.includes("AFSUI"))return"Aftermath";if(r.includes("CERT"))return"Volo"}},[r])}}function qo(r,o){const l=i.useMemo(()=>{if(o&&r)return`${$(L(o.amountPerLpA).mul(r).toFixed(18,F.ROUND_DOWN),o.displayTokenA.decimals)}  ${o==null?void 0:o.displayTokenA.symbol}`},[o==null?void 0:o.amountPerLpA,r]),n=i.useMemo(()=>{if(o&&r)return`${$(L(o.amountPerLpB).mul(r).toFixed(18,F.ROUND_DOWN),o.displayTokenB.decimals)}  ${o==null?void 0:o.displayTokenB.symbol}`},[o==null?void 0:o.amountPerLpB,r]);return{rewardPerA:l,rewardPerB:n}}function Mo(r,o,l,n,y=!1){const{vaultsSdk:h}=uo(),{getTokenAmountValue:x}=eo(),{setContractVaultObjLoading:j,setContractVaultObj:w,setContractClmmPoolObj:m,setContractClmmPoolObjLoading:D,setHoldTotalValue:B,holdTotalValue:T}=R(),f=async(_,V=!1)=>{j(!0);const P=await h.Vaults.getVault(_,V);console.log("ðŸš€ ~ file: useGetVaultInfo.ts:13 ~ fetchVaultInfoFromContract ~ info:",P),P&&w(P),j(!1)},u=async(_,V=!1)=>{D(!0);const P=await h.Pool.getPool(_,V);console.log("ðŸš€ ~ file: useGetVaultInfo.ts:33 ~ fetchClmmPoolFromContract ~ info:",P),P&&m(P),D(!1)},{contractVault:a}=Co(r),{tokenInfo:t}=X(a==null?void 0:a.lp_token_type),{balanceInfo:c}=to(t),C=i.useMemo(()=>a&&c?U(c.balance).div(a.total_supply).mul(100).toString():"0",[a,c]),{contractClmmInfo:s}=So(o),p=_=>{if(a&&s&&l&&n&&y!==void 0){const V=new E(s.current_sqrt_price),P=O.tickIndexToSqrtPriceX64(a.position.tick_lower_index),oo=O.tickIndexToSqrtPriceX64(a.position.tick_upper_index),N=io.getCoinAmountFromLiquidity(new E(_),V,P,oo,!1),M=W(N.coinA.toString(),l.decimals).toString(),G=W(N.coinB.toString(),n.decimals).toString();return{coinAmountA:M,coinAmountB:G,displayCoinA:y?G:M,displayCoinB:y?M:G}}},g=i.useMemo(()=>{if(a&&c&&s){const _=co.get_share_liquidity_by_amount(a,c.balance),V=p(_);if(V)return V}return{coinAmountA:"0",coinAmountB:"0",displayCoinA:"0",displayCoinB:"0"}},[c==null?void 0:c.balance,s==null?void 0:s.current_sqrt_price]),e=i.useMemo(()=>{if(a&&s){const _=p(a.liquidity);if(_)return _}},[a==null?void 0:a.liquidity,s==null?void 0:s.current_sqrt_price]),v=i.useMemo(()=>{if(s&&l&&n)return O.sqrtPriceX64ToPrice(new E(s.current_sqrt_price),l.decimals,n.decimals).toString()},[s==null?void 0:s.current_sqrt_price,l==null?void 0:l.decimals]),S=i.useMemo(()=>{if(a&&l&&n)return O.tickIndexToPrice(a.position.tick_lower_index,l.decimals,n.decimals).toString()},[a==null?void 0:a.position.tick_lower_index,l==null?void 0:l.decimals]),b=i.useMemo(()=>{if(a&&l&&n)return O.tickIndexToPrice(a.position.tick_upper_index,l.decimals,n.decimals).toString()},[a==null?void 0:a.position.tick_upper_index,l==null?void 0:l.decimals]),A=x(l==null?void 0:l.coin_type,g.coinAmountA),q=x(n==null?void 0:n.coin_type,g.coinAmountB),Q=x(l==null?void 0:l.coin_type,e==null?void 0:e.coinAmountA),Z=x(n==null?void 0:n.coin_type,e==null?void 0:e.coinAmountB),k=i.useMemo(()=>{if(v&&e)return ro(e.coinAmountA,e.coinAmountB,v,!1)},[v,e]);i.useEffect(()=>{r&&B(r,U(A).add(q).toString())},[A,q,r]);const I=i.useMemo(()=>{if(r)return T[r]},[T,r]);return{fetchVaultInfoFromContract:f,contractVault:a,lpTokenInfo:t,balanceInfo:c,sharePoolRate:C,fetchClmmPoolFromContract:u,holdCoinAmounts:g,totalValue:I,maxPrice:b,currPrice:v,minPrice:S,vaultCoinAmounts:e,vaultsCoinAValue:Q,vaultsCoinBValue:Z,vaultsCoinPercent:k,holdCoinAValue:A,holdCoinBValue:q,calculateCoinAmounts:p}}function Go({vaultsLstApyDisplay:r,vaultsApyDisplay:o,vaultsTotalApyDisplay:l}){return d.jsx(Y,{tooltip:d.jsx(Po,{vaultsApyDisplay:o,vaultsLstApyDisplay:r,vaultsTotalApyDisplay:l}),children:d.jsx(J,{textColor:"text_caption",textAlign:"right",fontWeight:"500",textDecoration:"underline dotted",color:"primary",children:l})})}const Po=({vaultsLstApyDisplay:r,vaultsApyDisplay:o,vaultsTotalApyDisplay:l})=>d.jsxs(po,{gap:"12px",w:"100%",pt:"8px",pb:"8px",children:[d.jsx(H,{label:"Total APY",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},wrapStyle:{gap:"16px"},value:l}),d.jsx(K,{h:"1px",w:"100%",backgroundColor:"border"}),d.jsx(H,{label:"Fees and Rewards",labelStyle:{fontSize:"12px"},valueStyle:{fontSize:"12px"},wrapStyle:{gap:"16px"},value:o}),d.jsx(H,{label:"LST",labelStyle:{fontSize:"12px"},wrapStyle:{gap:"16px"},value:r,valueStyle:{fontSize:"12px"}})]});function Eo({rewardList:r}){return d.jsx(Y,{tooltip:d.jsx(J,{fontSize:"12px",lineHeight:"20px",children:"Rewards will be auto harvested and compounded to your position."}),children:d.jsx(K,{justifyContent:"end",gap:"4px",children:r.map(o=>d.jsx(Vo,{coinType:o},o))})})}function Vo({coinType:r}){const{tokenInfo:o}=X(r);return d.jsx(yo,{children:d.jsx(fo,{imageUrl:o==null?void 0:o.logo_url,w:"20px",h:"20px"})})}function xo(r,o){return{...r,vaultsTvl:(o==null?void 0:o.vaultsTvl)||"--",vaultsTvlDisplay:(o==null?void 0:o.vaultsTvlDisplay)||"--",vaultsApy:(o==null?void 0:o.vaultsApy)||"--",vaultsApyDisplay:(o==null?void 0:o.vaultsApyDisplay)||"--",vaultsTotalApy:(o==null?void 0:o.vaultsTotalApy)||"--",vaultsTotalApyDisplay:(o==null?void 0:o.vaultsTotalApyDisplay)||"--",vaultsLstApy:(o==null?void 0:o.vaultsLstApy)||"--",vaultsLstApyDisplay:(o==null?void 0:o.vaultsLstApyDisplay)||"--",vaultsId:(o==null?void 0:o.vaultsId)||"",clmmPoolAddress:(o==null?void 0:o.clmmPoolAddress)||"",amountPerLpA:(o==null?void 0:o.amountPerLpA)||"0",amountPerLpB:(o==null?void 0:o.amountPerLpB)||"0"}}const Ho=(r,o)=>L(r).gt(0)?`${r} ${o}`:"";function zo(){const{fetchByApi:r}=vo(),{getPoolList:o}=lo(),{setVaultStatsObj:l,setVaultBaseList:n,vaultBaseList:y,vaultStatsObj:h,setVaultStatsLoading:x,setVaultBaseListLoading:j}=R(),w=async(f=!0)=>{try{(f||y.length===0)&&j(!0);const u=await o({is_vaults:!0,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0}),a=u==null?void 0:u.list.map(t=>{var g,e,v,S;const c=[(g=t==null?void 0:t.tokenA)==null?void 0:g.coin_type,(e=t==null?void 0:t.tokenB)==null?void 0:e.coin_type],C=(v=t==null?void 0:t.miningRewardList)==null?void 0:v.map(b=>t==null?void 0:t.coinType),s=(S=t==null?void 0:t.miningRewardList)==null?void 0:S.map(b=>t==null?void 0:t.coinType),p=Array.from(new Set([...c,...C,...s]));return{...t,vaultsRewards:p}});return console.log("ðŸš€ ~ file: useGetVaultList.ts:42 ~ getVaultBaseList ~ list:",a),a.length>0&&n(a),a}catch(u){console.log("getVaultBaseList Error:",u)}finally{j(!1)}return[]},m=async()=>{var f;try{x(!0);const u=await r("/v2/sui/auto_pools","GET"),a={};if(u!=null&&u.pools)return(f=u==null?void 0:u.pools)==null||f.forEach(t=>{const c=t==null?void 0:t.clmm_pool,C=t==null?void 0:t.object_id,s=t==null?void 0:t.total_apy,p=z(s,!0),g=t==null?void 0:t.apr,e=z(g,!0),v=t==null?void 0:t.lst_apy,S=z(v,!0),b=t==null?void 0:t.tvl,A=go(b,"$");a[c]={vaultsApy:g,vaultsApyDisplay:e,vaultsTotalApy:s,vaultsTotalApyDisplay:p,vaultsLstApy:v,vaultsLstApyDisplay:S,clmmPoolAddress:c,vaultsId:C,vaultsTvl:b,vaultsTvlDisplay:A,amountPerLpA:t.reward_per_lp.amount_a_per_lp,amountPerLpB:t.reward_per_lp.amount_b_per_lp}}),l(a),a}catch(u){return console.error("getVaultsStats Error:",u),h}finally{x(!1)}return{}},D=async f=>{try{const u=y.length>0?y:await w(),a=await m();return T(f,u,a)}catch(u){return console.error("getVaultList Error:",u),B(f)}return[]},B=f=>{try{return T(f,y,h)}catch(u){console.error("getVaultListFromCache Error:",u)}return[]},T=(f,u,a)=>{const{sortRule:t,sortType:c}=f,C=u==null?void 0:u.map(s=>{const p=a==null?void 0:a[s.poolAddress];return xo(s,p)});return C==null?void 0:C.sort((s,p)=>{var g,e,v,S;return c==="apr"?t==="desc"?((g=p.vaultsTotalApyDisplay)==null?void 0:g.replace("%",""))-((e=s.vaultsTotalApyDisplay)==null?void 0:e.replace("%","")):((v=s.vaultsTotalApyDisplay)==null?void 0:v.replace("%",""))-((S=p.vaultsTotalApyDisplay)==null?void 0:S.replace("%","")):t==="desc"?p.vaultsTvl-s.vaultsTvl:s.vaultsTvl-p.vaultsTvl})};return{getVaultBaseList:w,getVaultsStats:m,getVaultListFromCache:B,getVaultList:D}}export{Vo as C,Go as V,Eo as a,R as b,qo as c,zo as d,Ro as e,Ho as f,Do as g,Bo as h,Po as i,Mo as u};
