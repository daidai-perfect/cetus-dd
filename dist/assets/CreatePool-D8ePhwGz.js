import{r as d,a4 as rt,d as ue,as as z,j as e,ad as it,ae as nt,af as st,ag as ot,ah as we,ai as ct,aj as lt,V as B,H as O,a0 as Oe,T as C,W as $e,B as ee,bk as Ce,Y as pt,$ as te,I as ye,aM as Ne,aN as at,an as vt,a1 as xt,aO as G,m as he,g as At,b as dt,k as Je,bl as Rt,al as Dt,bm as It,ac as de,aQ as J,bc as k,aV as Ie,aa as se,a as ut,bd as Ft,bn as Wt,bo as Xe,a9 as Qe,a6 as zt,aS as Me,aZ as Fe}from"./index-D49RffYW.js";import{b as $t,u as Nt,a as Pt}from"./SelectTokenAndFeeConfirm-DRca-sN7.js";import{P as Ot}from"./PositionStatus-Cy2qCSNc.js";import{c as ht,b as We}from"./useGetPoolList-DBJielhS.js";import{H as Pe}from"./HTextLabelBox-DVxTk_Ir.js";import{T as Lt}from"./TradeConfirmAmountInfo-BVFeG-79.js";import{I as Et,P as qe}from"./common-Cb0tCgZ_.js";import{u as Te}from"./useTokenBalance-Cc02jFZo.js";import{T as Ht}from"./TradeInputGroup-C7m7R_Tz.js";import{L as ke}from"./LockInput-D8hYvbJh.js";import{u as Vt,a as Ut}from"./useCreatePoolHelper-BoHxuyfh.js";import{I as Gt}from"./InputBox-cvzQCj0g.js";import{i as be}from"./index-BzKWeyUu.js";import{d as Bt}from"./FeeTierSelect-D2y7F8IR.js";import{u as gt}from"./useAccountBalance-D-weOZgA.js";import{u as Kt}from"./useDocumentSize-Dm5SO9Fm.js";import{u as et}from"./useToken-BlS8b5ft.js";import{u as Yt}from"./usePreviousValue-D4m5LJZe.js";import{u as Zt}from"./useTransaction-i5gFyneH.js";import{R as Jt}from"./RefreshButton-C1kwCG7k.js";import"./index-drVjB88T.js";import"./Loading-DBRuHM4S.js";import"./SingleTokenInfo-Cvcahm1q.js";import"./AddressCopyLink-BnCAac35.js";import"./AddressUnderline-CPGiMg8E.js";import"./CetusTooltip-7TnGbJNH.js";import"./TooltipIcon-BGEWyiwk.js";import"./api-data-utils-D656F-wl.js";import"./ActionButton-CAHJhAqM.js";import"./_getAllKeysIn-Caqnu8Ck.js";import"./icon_lock@2x-OdzkPjmc.js";import"./usePosAdd-vnaoQeks.js";import"./global-iZ7St_zm.js";import"./usePositionList-CyCzZNts.js";import"./useCurrentPos-CwMCqO3d.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-oZJ3kO4O.js";import"./liquidity-C80wvFzz.js";import"./debounce-B0JWIAw5.js";import"./index-CosTxpEh.js";function Xt(h){const{isOpen:g,onClose:u,onSubmit:l,data:i}=h,{baseToken:t,quoteToken:r,feeDisplay:x,baseAmount:s,quoteAmount:n,isReverse:b,initPrice:o,minPrice:f,maxPrice:a,isFullRange:_}=i,[y,E]=d.useState(!0),{getTokenAmountValue:L}=rt(),H=L(t==null?void 0:t.coin_type,s),V=L(r==null?void 0:r.coin_type,n),$=d.useMemo(()=>ue(H||"0").plus(V||"0").toString(),[H,V]),p=d.useMemo(()=>ht(s,n,o,_),[s,n]),N=d.useMemo(()=>y?`${z(r==null?void 0:r.symbol)} per ${z(t==null?void 0:t.symbol)}`:`${z(t==null?void 0:t.symbol)} per ${z(r==null?void 0:r.symbol)}`,[y,t==null?void 0:t.symbol,r==null?void 0:r.symbol]),w=d.useMemo(()=>_?"0":b?y?f==null?void 0:f.displayReversePrice:a.displayPrice:y?f==null?void 0:f.displayPrice:a.displayReversePrice,[y]),Y=d.useMemo(()=>_?"∞":b?y?a==null?void 0:a.displayReversePrice:f.displayPrice:y?a==null?void 0:a.displayPrice:f.displayReversePrice,[y]);return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(nt,{}),e.jsxs(st,{children:[e.jsx(ot,{children:e.jsx(we,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(ct,{}),e.jsx(lt,{textAlign:"center",p:"0px",children:e.jsxs(B,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(O,{children:[e.jsx(Oe,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:r==null?void 0:r.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(C,{fontSize:"16px",color:"text_caption",children:`${z(t==null?void 0:t.symbol)} - ${z(r==null?void 0:r.symbol)}`})]}),e.jsx($e,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(O,{gap:"12px",children:[e.jsx(C,{children:"Fee Tier"}),e.jsx(C,{color:"primary",children:x})]})})]}),e.jsx(Lt,{coinA:{amount:s,...t},coinB:{amount:n,...r}}),e.jsxs(ee,{w:"100%",children:[e.jsxs(O,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(C,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(Ot,{isActive:!0,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(O,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(C,{children:"Current Price"}),e.jsx(C,{as:"span",color:"text_caption",children:Ce(y?o:pt(ue(1).div(o).toFixed(18),18,!0).toString(),18)}),e.jsx(C,{children:N}),e.jsx(te,{variant:"unstyled",onClick:()=>E(!y),children:e.jsx(ye,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(O,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(tt,{title:"Min Price",price:w,perText:N}),e.jsx(Ne,{orientation:"vertical",h:"40px"}),e.jsx(tt,{title:"Max Price",price:Y,perText:N})]})]}),e.jsx(Pe,{isLoading:!1,label:"Deposit Ratio",value:`${p.percentA}% ${z(t==null?void 0:t.symbol)} / ${p.percentB}% ${z(r==null?void 0:r.symbol)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx(Pe,{isLoading:!1,label:"Total Amount",value:$&&+$?at($):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(te,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:l,children:"Create and Add Liquidity"})]})})]})]})}const tt=({title:h,price:g,perText:u})=>e.jsxs(B,{flex:"1",children:[e.jsx(C,{children:h}),e.jsx(C,{color:"text_caption",children:g}),e.jsx(C,{children:u})]});function Qt(h){const{isOpen:g,onClose:u,data:l}=h,{baseToken:i,quoteToken:t,feeDisplay:r}=l;return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(nt,{}),e.jsxs(st,{children:[e.jsx(ot,{}),e.jsx(ct,{}),e.jsx(lt,{children:e.jsx(B,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(B,{gap:"8px",children:[e.jsx(vt,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(B,{mt:"-155px",gap:"10px",children:[e.jsxs(O,{children:[e.jsx(Oe,{coinACoinType:i==null?void 0:i.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:i==null?void 0:i.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(C,{fontSize:"14px",color:"text_caption",children:`${i==null?void 0:i.symbol} - ${t==null?void 0:t.symbol}`})]}),e.jsx($e,{w:"unset",p:"4px 6px",borderRadius:"12px",children:e.jsxs(C,{fontSize:"12px",color:"primary",children:["Fee Tier ",r]})})]}),e.jsx($e,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(C,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(te,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{u()},children:"OK"})]})})})]})]})}function Mt(h,g,u,l,i,t){const{currentAccount:r}=xt(),x=d.useMemo(()=>{const s={text:"Create",disabled:!1};return r!=null&&r.address?!h||!g||h&&!+h||g&&!+g?(s.text="Enter an amount",s.disabled=!0,s):h&&+h&&ue(h).gt((i==null?void 0:i.balanceFormat)||0)?(s.disabled=!0,s.text=`Insufficient ${z(u==null?void 0:u.symbol)} Balance`,s):g&&+g&&ue(g).gt((t==null?void 0:t.balanceFormat)||0)?(s.disabled=!0,s.text=`Insufficient ${z(l==null?void 0:l.symbol)} Balance`,s):((!h||!g)&&(s.disabled=!0),s):(s.text="Connect Wallet",s.disabled=!1,s)},[r==null?void 0:r.address,h,g,i==null?void 0:i.balanceDisplay,t==null?void 0:t.balanceDisplay,u==null?void 0:u.coin_type,l==null?void 0:l.coin_type]);return{btnText:x.text,btnDisabled:x.disabled}}function qt({currentStep:h,editStep:g,onCreate:u,baseToken:l,quoteToken:i,baseAmount:t,quoteAmount:r,onBaseAmountChange:x,onQuoteAmountChange:s,isReverse:n,percentMap:b}){const{balanceInfo:o}=Te(l),{balanceInfo:f}=Te(i),{btnText:a,btnDisabled:_}=Mt(t,r,l,i,o,f),{fetchTokenPrices:y,getTokenAmountValue:E}=rt(),L=()=>{const p=[];l!=null&&l.coin_type&&p.push(l==null?void 0:l.coin_type),i!=null&&i.coin_type&&p.push(i==null?void 0:i.coin_type),p.length>0&&y(p)};d.useEffect(()=>{L()},[l==null?void 0:l.coin_type,i==null?void 0:i.coin_type]);const H=E(l==null?void 0:l.coin_type,t),V=E(i==null?void 0:i.coin_type,r),$=d.useMemo(()=>{if(+H&&+V)return G(H||"0").plus(V||"0").toString()},[H,V]);return e.jsx(e.Fragment,{children:h===3&&g===3?e.jsxs(B,{w:"100%",gap:"12px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),e.jsx(Ht,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(o==null?void 0:o.balanceFormat)||"",value:t,amountValue:H,loading:!1,onChange:p=>{x(p)},selectable:!1,placeholder:"0.0",token:l},to:{wrapStyle:{h:"108px"},balance:(f==null?void 0:f.balanceFormat)||"",value:r,amountValue:V,loading:!1,onChange:p=>{s(p)},selectable:!1,placeholder:"0.0",token:i}}),e.jsxs(B,{gap:"16px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(Pe,{isLoading:!1,label:"Total Amount",value:$&&+$?at($):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(Et,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(he,{flexDir:{base:"column",lg:"row"},gap:{base:"4px",lg:"12px"},children:b&&[l,i].filter(Boolean).map((p,N)=>e.jsxs(O,{gap:"4px",justify:"flex-end",children:[e.jsx(At,{imageUrl:p==null?void 0:p.logo_url,coinType:p?p==null?void 0:p.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(C,{color:N===0?"primary":"primary_green",fontSize:"14px",children:[z(p==null?void 0:p.symbol)," ",b[N===0?n?"percentB":"percentA":n?"percentA":"percentB"],"%"]})]},p==null?void 0:p.coin_type))})})]}),e.jsx(te,{w:"100%",onClick:u,h:"48px",fontSize:"16px",borderRadius:"12px",disabled:_,children:a})]}):null})}function ft({onEdit:h,children:g}){return e.jsxs(O,{w:"100%",p:{base:"16px 8px",lg:"20px 32px"},border:"0px solid",borderColor:"border",borderRadius:"12px",bg:"bg_fifth",justify:"space-between",children:[g,e.jsxs(te,{onClick:h,variant:"unstyled",border:"1px solid",borderColor:"border",cursor:"pointer",borderRadius:"8px",p:"5px 8px",display:"flex",h:"32px",alignItems:"center",gap:"8px",minW:"auto",_hover:{p:{color:"#fff"},svg:{fill:"#fff"}},children:[e.jsx(ye,{xlinkHref:"#icon-icon_edit"}),e.jsx(C,{fontSize:"12px",fontWeight:"500",children:"Edit"})]})]})}function Tt({onEdit:h,editStep:g,currentStep:u,onContinue:l,baseToken:i,quoteToken:t,onBaseTokenChange:r,onQuoteTokenChange:x,feeTier:s,feeTierList:n,onFeeTierChange:b,quoteWhiteTokenList:o}){return e.jsx(e.Fragment,{children:g===1||u===1?e.jsx($t,{title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:l,baseToken:i,onBaseTokenChange:r,quoteToken:t,onQuoteTokenChange:x,quoteWhiteTokenList:o,feeTier:s,feeTierList:n,onFeeTierChange:b,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool"}):e.jsx(ft,{onEdit:h,children:e.jsxs(O,{gap:"12px",children:[e.jsx(Oe,{coinAIconUrl:i==null?void 0:i.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,coinACoinType:i==null?void 0:i.coin_type,coinBCoinType:t==null?void 0:t.coin_type,w:"36px",h:"36px"}),e.jsxs(O,{children:[e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${z(i==null?void 0:i.symbol)}-${z(t==null?void 0:t.symbol)}`}),e.jsx(ee,{h:"16px",p:"1px 8px",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:e.jsx(C,{fontSize:"12px",fontWeight:"500",color:"text_highlight",children:typeof s=="string"?`${ue(s).div(100).toString()}%`:s==null?void 0:s.feeDisplay})})]})]})})})}const kt=[{label:"Full Range"},{label:"Custom Range"}];function er({editStep:h,currTick:g,currentStep:u,onEdit:l,onContinue:i,displayBaseToken:t,displayQuoteToken:r,initPrice:x,onInitPriceChange:s,displayMinPrice:n,onMinPriceChange:b,displayMaxPrice:o,onMaxPriceChange:f,isFullRange:a,isReverse:_,handleRangeModeChange:y,handleSwitchDirectionChange:E,handlePriceAction:L}){const[H,V]=d.useState("Full Range"),{isApp:$}=dt(),p=d.useMemo(()=>n?[n.tokenA,n.tokenB].filter(Boolean).map(m=>({label:m==null?void 0:m.symbol,isToken:!0,imgInfo:{src:m==null?void 0:m.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[n==null?void 0:n.tokenA,n==null?void 0:n.tokenB]),N=d.useMemo(()=>`${z(r==null?void 0:r.symbol)} per ${z(t==null?void 0:t.symbol)}`,[t==null?void 0:t.symbol,r==null?void 0:r.symbol]),w=d.useMemo(()=>{var m;return a?!0:((m=n==null?void 0:n.tokenA)==null?void 0:m.coin_type)===(t==null?void 0:t.coin_type)},[a,n==null?void 0:n.tokenA,n==null?void 0:n.tokenB,t==null?void 0:t.coin_type]),{showInputPriceWarn:Y,showPriceRangeWarn:Q}=Vt(a,g,_?o.tick:n.tick,_?n.tick:o.tick),re=d.useMemo(()=>(n==null?void 0:n.price)==="0"&&(o==null?void 0:o.price)==="∞",[n==null?void 0:n.price,o==null?void 0:o.price]);return e.jsx(e.Fragment,{children:u>=2?h===2||u===2?e.jsxs(B,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(B,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set initial Price"}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:"center",children:[e.jsx(C,{fontSize:"12px",children:"Please set an initial price for this new pool to start."}),e.jsx(Je,{type:"outlineTab",tabList:p,currentTab:t==null?void 0:t.symbol,handleChangeTab:m=>{m.label!==(t==null?void 0:t.symbol)&&E()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(Gt,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(Rt,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(Dt,{value:x?Ce(x,18):"",onChange:m=>{s==null||s(m)},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(It,{children:e.jsx(C,{children:N})})]})}),x&&e.jsxs(O,{h:"20px",w:"100%",children:[e.jsxs(C,{color:"text_caption",fontSize:"12px",children:["Current Price: 1 ",z(t==null?void 0:t.symbol)," = ",de(Ce(x,18))," ",z(r==null?void 0:r.symbol)]}),e.jsx(ye,{w:"16px",h:"16px",svgW:"16px",svgH:"16px",xlinkHref:"#icon-icon_swap1",fontSize:"12px",onClick:E})]})]}),e.jsxs(B,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set Price Range"}),e.jsx(C,{fontSize:"12px",children:"Please specify a price range that you want to provide your liquidity within."}),e.jsx(Je,{type:"outlineTab",tabList:kt,currentTab:a?"Full Range":"Custom Range",handleChangeTab:m=>{V(m==null?void 0:m.label),y((m==null?void 0:m.label)==="Full Range")},wrapStyle:{w:"100%",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"12px",gap:"4px"},itemStyle:{flex:"1",h:"32px",p:"8px",borderRadius:"8px",fontSize:"14px"}}),e.jsxs(he,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(qe,{title:"Min Price",perText:N,data:n,direct:w,loading:!1,handleAddPrice:m=>L("Add",m),handleSubPrice:m=>L("Sub",m),setTickDataBasedOnPrice:b,isFullRange:re}),e.jsx(qe,{title:"Max Price",perText:N,data:o,direct:w,loading:!1,handleAddPrice:m=>L("Add",m),handleSubPrice:m=>L("Sub",m),setTickDataBasedOnPrice:f,isFullRange:re}),!+x&&!a&&e.jsx(ke,{position:"absolute",top:"0px",left:"0",h:"80px",borderRadius:"12px",text:""}),$&&!+x&&!a&&e.jsx(ke,{position:"absolute",top:"88px",left:"0",h:"80px",borderRadius:"12px",text:""})]}),!a&&Y&&!Q&&e.jsx(ee,{w:"100%",p:"8px 16px",borderRadius:"8px",bg:"primary_yellow_opacity.10",children:e.jsx(C,{fontSize:"12px",lineHeight:"16px",color:"primary_yellow",children:"To create a new pool, the initial price you set must be within your price range."})}),!a&&Q&&e.jsx(ee,{h:"28px",lineHeight:"28px",p:"0 16px",w:"100%",borderRadius:"8px",bg:"primary_red_opacity.10",children:e.jsx(C,{fontSize:"12px",color:"primary_red",children:"The max price should be higher than min price."})}),e.jsx(te,{mt:"4px",w:"100%",onClick:i,disabled:!x||!+x||!n.price||!o.price||Y||Q,h:"48px",fontSize:"16px",borderRadius:"12px",children:!x||!+x?"Enter initial price":"Continue"})]})]}):e.jsx(ft,{onEdit:l,children:e.jsxs(B,{gap:"12px",align:"flex-start",children:[e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Initial Price"}),e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${Ce(x,18)} ${N}`})]}),e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Price Range"}),e.jsxs(C,{color:"text_caption",fontWeight:"500",children:[a?"0 - ∞":`${_?n.displayReversePrice:n==null?void 0:n.displayPrice} - ${_?o==null?void 0:o.displayReversePrice:o==null?void 0:o.displayPrice} `," ",`${N}`," "]})]})]})}):null})}function tr({currentStep:h,handleStepClick:g}){const{isApp:u}=dt();return e.jsxs(he,{flexDir:{base:"row",lg:"column"},gap:"12px",flex:{base:"1",lg:"0 0 258px"},w:{base:"100%",lg:"258px"},p:{base:"12px",lg:"32px"},justify:"center",align:{base:"center",lg:"flex-start"},bg:"bg_fifth",borderRadius:"12px",children:[e.jsx(ze,{step:1,title:"Select token & fee tier",isActive:h>=1,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(Ne,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(ze,{step:2,title:"Set initial price & range",isActive:h>=2,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(Ne,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(ze,{step:3,title:"Enter deposit amounts",isActive:h>=3})]})}function ze({step:h,title:g,isActive:u,handleStepClick:l}){return e.jsxs(O,{w:{base:"32px",lg:"100%"},cursor:l&&u?"pointer":"unset",onClick:()=>{l&&u&&l(h)},children:[e.jsx(ee,{as:"div",flex:"0 0 32px",h:"32px",lineHeight:"32px",textAlign:"center",border:"1px solid",fontSize:"12px",fontWeight:"500",color:u?"text_highlight":"text_paragraph",borderColor:"border",borderRadius:"8px",bg:u?"primary_disabled":"transparent",children:h}),e.jsxs(B,{align:"flex-start",display:{base:"none",lg:"flex"},children:[e.jsxs(C,{fontSize:"14px",color:u?"text_caption":"text_paragraph",fontWeight:"500",children:["Step  ",h]}),e.jsx(C,{fontSize:"12px",color:u?"primary":"text_paragraph",fontWeight:"500",children:g})]})]})}function rr(){const h=(i,t,r,x,s)=>{const n=r.decimals,b=x.decimals;let o;Math.abs(i)==Math.abs(J.getMinIndex(s))?o=t==="lower"?"0":"∞":o=k.tickIndexToPrice(i,n,b).toString();const f=o==="∞"?"∞":se(o,6).toString(),a=We(o),_=a==="∞"?"∞":se(a,6).toString();return{id:t,tokenA:r,tokenB:x,tick:i,price:o,displayPrice:f,reversePrice:a,displayReversePrice:_,tickSpacing:s.toString(),pool:"1"}},g=(i,t)=>{const r=i.tokenA,x=i.tokenB;if(!r||!x||t.length===0)return;let s,n="";if(t==="∞")s=J.getMaxIndex(Number(i.tickSpacing)),n="∞";else if(G(t).equals(0))s=J.getMinIndex(Number(i.tickSpacing)),n="0";else if(G(t).gt(0)){const a=k.priceToTickIndex(G(t),r.decimals,x.decimals);s=Ie(Number(a),Number(i.tickSpacing)),n=k.tickIndexToPrice(Number(s),r.decimals,x.decimals).toString()}const b=n==="∞"?"∞":se(n,6),o=We(n),f=o==="∞"?"∞":se(o,6);if(s!==void 0)return{...i,tick:s,price:n,displayPrice:b.toString(),reversePrice:o,displayReversePrice:f.toString()}},u=(i,t="Add")=>{const{tokenA:r,tokenB:x,tick:s,tickSpacing:n}=i;if(r&&x&&n){const b=t==="Add"?G(s).add(n).toNumber():G(s).sub(n).toNumber();if(G(b).gt(J.getMaxIndex(Number(i.tickSpacing)))||G(b).lt(J.getMinIndex(Number(i.tickSpacing))))return;const o=k.tickIndexToPrice(b,r.decimals,x.decimals).toString(),f=o==="∞"?"∞":se(o,6);if(f===i.displayPrice){const a=Number(i.tickSpacing)<20?40:1;return u({...i,tick:t==="Add"?G(s).add(Number(n)*a).toNumber():G(s).sub(Number(n)*a).toNumber()},t)}else{const a=We(o),_=a==="∞"?"∞":se(a,6);return{id:i.id,tick:b,price:o.toString(),displayPrice:f.toString(),reversePrice:a.toString(),displayReversePrice:_.toString(),tokenA:r,tokenB:x,tickSpacing:n,pool:"1"}}}};return{calcInitPriceRange:(i,t,r,x,s,n,b)=>{try{if(r&&x&&s){const o=J.getMaxIndex(r),f=J.getMinIndex(r);if(i){const a={id:"lower",tokenA:x,tokenB:s,tick:f,price:"0",displayPrice:"0",reversePrice:"∞",displayReversePrice:"∞",tickSpacing:r.toString(),pool:new Date().getTime().toString()},_={id:"upper",tokenA:x,tokenB:s,tick:o,price:"∞",displayPrice:"∞",reversePrice:"0",displayReversePrice:"0",tickSpacing:r.toString(),pool:new Date().getTime().toString()};if(t&&+t){const y=k.priceToTickIndex(G(t),x.decimals,s.decimals);return{minData:a,maxData:_,currTick:y}}return{minData:a,maxData:_,currTick:void 0}}else if(t&&+t){const a=k.priceToTickIndex(G(t),x.decimals,s.decimals),_=n||Ie(Number(a-r*5),Number(r));_<f&&(n=f);const y=b||Ie(Number(a+r*5),Number(r));y>o&&(b=o);const E=h(_,"lower",x,s,r),L=h(y,"upper",x,s,r);return{minData:E,maxData:L,currTick:a}}}}catch{}},handleActionPrice:u,updateTickDataBasedOnPrice:g}}function ir(){ut();const{base:h,quote:g,fee:u}=Ft(),{tokenInfo:l}=et(h),{tokenInfo:i}=et(g),[t,r]=d.useState(void 0),[x,s]=d.useState([]),[n,b]=d.useState(1),[o,f]=d.useState(0),{signAndExecuteTransaction:a,transactionConfirmation:_,transactionRejected:y}=Zt(),{fetchAccountBalance:E}=gt(),{preAddPool:L,fetchFeeTierList:H,getCreatePoolTxPayload:V}=Ut(),{quoteWhiteTokenList:$}=Nt(),[p,N]=d.useState(),[w,Y]=d.useState(),[Q,re]=d.useState(!0);d.useEffect(()=>{E()},[]);const m=d.useMemo(()=>{if(!(p&&w&&be(p,$)&&be(w,$))&&!(!p&&!w)&&!(p&&!w&&be(p,$))&&!(w&&!p&&be(w,$)))return[...$]},[p==null?void 0:p.coin_type,w==null?void 0:w.coin_type,$]),[v,M]=d.useState(),[D,Z]=d.useState(),[P,ie]=d.useState(""),[U,oe]=d.useState(!0),[A,ce]=d.useState({}),[W,le]=d.useState({}),[ge,pe]=d.useState(),[_e,fe]=d.useState(void 0),F=d.useMemo(()=>v&&D?Wt(Xe(v.coin_type),Xe(D.coin_type)):!1,[v,D]),[me,Se]=d.useState(void 0),{calcInitPriceRange:ve,handleActionPrice:Ae,updateTickDataBasedOnPrice:Re}=rr(),[R,X]=d.useState(""),[ae,je]=d.useState("");d.useEffect(()=>{N(l),M(l),Z(i||Qe.sui_coin),Y(i||Qe.sui_coin)},[l==null?void 0:l.coin_type,i==null?void 0:i.coin_type]),d.useEffect(()=>{Le()},[p==null?void 0:p.coin_type,w==null?void 0:w.coin_type]);const Le=()=>{var c;p&&w?H(p.coin_type,w.coin_type).then(j=>{s(j);const S=j.filter(K=>K.poolAddress===void 0),I=S.find(K=>K.feeRate===u)||S.find(K=>K.feeRate==="25")||(S.length>0?S[0]:void 0)||(j.length>0?j[0]:void 0);I&&Ee(I)}):(s((c=Bt)==null?void 0:c.map(j=>({...j,title:""}))),r(void 0))},mt=(c,j=!0)=>{De(1),j?(N(c),M(c),Z(w),(c==null?void 0:c.coin_type)===(w==null?void 0:w.coin_type)&&(Y(void 0),Z(void 0))):(Y(c),Z(c),M(p),(c==null?void 0:c.coin_type)===(p==null?void 0:p.coin_type)&&(N(void 0),M(void 0)))},Ee=c=>{r(c),b(1),_t(),q(!0)},St=()=>{const c=v;if(M(D),Z(c),+P){const S=pt(G(1).div(P).toFixed(18),18,!0).toString();ie(S)}};d.useEffect(()=>{He(U)},[P,t==null?void 0:t.tickSpacing]);const He=(c,j,S)=>{ne();const I=ve(c,P&&+P?F?(1/Number(P)).toString():P:"",Number((t==null?void 0:t.tickSpacing)||0),F?D:v,F?v:D,j,S);I?(le(I.maxData),ce(I.minData),pe(I.currTick)):pe(void 0)};d.useMemo(()=>{if(t&&v&&D)return k.tickIndexToPrice(J.getMaxIndex(20),6,6).toFixed(9,zt.ROUND_DOWN)},[t==null?void 0:t.tickSpacing,v==null?void 0:v.decimals,D==null?void 0:D.decimals]);const jt=c=>{ie(c)},q=(c,j,S)=>{oe(c),ne(),He(c,j,S)},Ve=d.useMemo(()=>U?A:F?W:A,[U,A,W,F]),Ue=d.useMemo(()=>U?W:F?A:W,[U,A,W,F]),bt=(c,j)=>{ne();const S=Ae(j,c);S&&((S==null?void 0:S.id)===(A==null?void 0:A.id)?ce(S):le(S))},Ct=Yt(U),wt=(c,j,S)=>{const I=Re(c,j);if(I){I.pool=new Date().getTime().toString();let K=A==null?void 0:A.tick,T=W==null?void 0:W.tick;I.id==="lower"?(ce({...I}),K=I.tick):(le({...I}),T=I.tick),K!==void 0&&T!==void 0&&t?Ct&&(J.getMaxIndex(Number(t.tickSpacing))!==T||J.getMinIndex(Number(t.tickSpacing))!==K?q(!1):q(!0)):q(!1,K,T)}else q(!1)},yt=(c,j)=>{re(j),j?X(c):je(c);const S=Ge(c,j);S?(Se(S),j?je(F?S.coinAmountA:S.coinAmountB):X(F?S.coinAmountB:S.coinAmountA)):(j?je(""):X(""),Se(void 0))},De=c=>{c===1?(b(1),f(1),ie(""),q(!0),ne()):c===2?(b(2),f(2),ne()):(b(3),f(3))},Ge=(c,j,S)=>{if(D&&v&&P&&t&&c&&+c&&(A!=null&&A.price)&&(W!=null&&W.price))try{return L({realTokenA:F?D:v,realTokenB:F?v:D,needReverse:A.tokenA.coin_type!==v.coin_type,tickSpacing:Number(t.tickSpacing),amount:c,amountCoinType:j?v.coin_type:D.coin_type,maxPrice:U?W.price:F?A.reversePrice:W.price,minPrice:U?A.price:F?W.reversePrice:A.price,price:F?G(1).div(P).toString():P})}catch{}};Kt(()=>{const c=Ge("1",!0);if(c){const j=ht(c==null?void 0:c.coinAmountA,c==null?void 0:c.coinAmountB,F?(1/Number(P)).toString():P,U);fe(j)}else fe(void 0)},[P,A.tick,W.tick,U,F,t==null?void 0:t.tickSpacing],{wait:500});const _t=()=>{ie(""),ne(),oe(!0)},ne=()=>{X(""),je("")};return{baseToken:p,quoteToken:w,handleSelectTokenChange:mt,displayQuoteWhiteTokenList:m,feeTier:t,setFeeTier:r,feeTierList:x,currentStep:n,editStep:o,setCurrentStep:b,setEditStep:f,displayBaseToken:v,displayQuoteToken:D,handleSwitchDirectionChange:St,initPrice:P,handleInitPriceChange:jt,isFullRange:U,handleRangeModeChange:q,minTickData:A,maxTickData:W,isReverse:F,handleFeeTierChange:Ee,handlePriceAction:bt,baseAmount:R,quoteAmount:ae,handleAmountChange:yt,getConfirmData:()=>({isReverse:F,baseToken:v,quoteToken:D,baseAmount:R,quoteAmount:ae,minPrice:Ve,maxPrice:Ue,initPrice:P,feeDisplay:t.feeDisplay,isFullRange:U}),handleCreateAction:async()=>{const c=A.tokenA;A.tokenB,c.coin_type,Q?v.coin_type:D.coin_type;const j={getShowInfo:(S,I)=>{const K=z(v==null?void 0:v.symbol),T=z(D==null?void 0:D.symbol),Be=`Add ${de(R)} ${K} and ${de(ae)} ${T}`,xe={modalDescriptionText:Be,toastTitleText:Be};if(S==="success"){let Ke=R,Ye=ae;I&&(Ke=Me(I,v)||R,Ye=Me(I,D)||ae);const Ze=`Add ${de(Ke)} ${K} and ${de(Ye)} ${T}`;xe.toastDescriptionContent=Ze,xe.modalDescriptionText=Ze,xe.toastTitleText="Create Success"}return S==="rejected"&&(xe.toastTitleText="Create pool"),xe}};_(j);try{const S=await V(me);if(await a(S,j,{showSuccessModal:!1,useDevInspect:!0,txAction:"signAndExecuteTransactionBlock"}))return E(),Le(),De(1),t.feeDisplay}catch{y(j)}},percentMap:_e,currTick:ge,displayMinPrice:Ve,displayMaxPrice:Ue,handleTickPriceChange:wt,handleStepClick:De,fetchFeeTierList:H}}function Zr(){const h=ut(),{baseToken:g,quoteToken:u,feeTier:l,currentStep:i,setCurrentStep:t,editStep:r,setEditStep:x,feeTierList:s,handleSelectTokenChange:n,displayQuoteWhiteTokenList:b,displayBaseToken:o,displayQuoteToken:f,handleSwitchDirectionChange:a,initPrice:_,handleInitPriceChange:y,isFullRange:E,handleRangeModeChange:L,handleTickPriceChange:H,isReverse:V,handleFeeTierChange:$,handlePriceAction:p,baseAmount:N,quoteAmount:w,handleAmountChange:Y,getConfirmData:Q,handleCreateAction:re,percentMap:m,currTick:v,displayMinPrice:M,displayMaxPrice:D,handleStepClick:Z,fetchFeeTierList:P}=ir(),{currentAccount:ie,onWalletModal:U}=xt(),{isOpen:oe,onOpen:A,onClose:ce}=Fe(),{isOpen:W,onOpen:le,onClose:ge}=Fe(),{isOpen:pe,onOpen:_e,onClose:fe}=Fe(),{fetchAccountBalance:F}=gt(),[me,Se]=d.useState(),ve=()=>{g&&u&&l&&h(`/liquidity?tab=deposit&poolAddress=${l==null?void 0:l.poolAddress}`,{replace:!0})},Ae=()=>({baseToken:o,quoteToken:f,feeDisplay:me}),Re=()=>{g&&u&&P(g.coin_type,u.coin_type),F()};return e.jsxs(B,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",children:[e.jsxs(te,{variant:"outline",h:"32px",onClick:()=>h("/pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(ye,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(C,{fontSize:"12px",children:"Back"})]}),e.jsx(Jt,{handleRefresh:Re,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(tr,{currentStep:i,handleStepClick:Z}),e.jsxs(B,{w:"100%",gap:"16px",children:[e.jsx(Tt,{editStep:r,currentStep:i,onEdit:()=>{Z(1)},onContinue:()=>{l&&(l.poolAddress?A():Z(2))},baseToken:g,onBaseTokenChange:R=>n(R,!0),quoteToken:u,onQuoteTokenChange:R=>n(R,!1),feeTier:l,feeTierList:s,quoteWhiteTokenList:b,onFeeTierChange:R=>$(R),fromSource:"createPool"}),e.jsx(er,{editStep:r,currentStep:i,onEdit:()=>Z(2),onContinue:()=>{Z(3)},displayBaseToken:o,displayQuoteToken:f,initPrice:_,currTick:v,isReverse:V,onInitPriceChange:R=>y(R),handlePriceAction:p,displayMinPrice:M,onMinPriceChange:(R,X)=>{H(R,X,!0)},displayMaxPrice:D,onMaxPriceChange:(R,X)=>{H(R,X,!1)},handleSwitchDirectionChange:a,isFullRange:E,handleRangeModeChange:L}),e.jsx(qt,{currentStep:i,editStep:r,onCreate:()=>{ie?le():U(!0)},percentMap:m,baseToken:o,quoteToken:f,baseAmount:N,quoteAmount:w,onBaseAmountChange:R=>Y(R,!0),onQuoteAmountChange:R=>Y(R,!1),isReverse:V})]})]}),oe&&e.jsx(Pt,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:oe,onClose:ce,onConfirm:ve}),W&&e.jsx(Xt,{isOpen:W,onClose:ge,onSubmit:async()=>{ge();const R=await re();R&&(Se(R),_e())},data:Q()}),pe&&me&&e.jsx(Qt,{isOpen:pe,onClose:fe,data:Ae()})]})}export{Zr as default};
