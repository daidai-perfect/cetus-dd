{"version":3,"file":"useXCetusHelper-CYzVxYUT.js","sources":["../../src/hooks/xcetus/useXCetusHelper.ts"],"sourcesContent":["import useXCetusStore from '@/store/xcetus/useXCetus'\nimport { XCetusRewardInfo } from '@/types/xcetus'\nimport { useGetToken } from '@cetus/hooks/src/useToken'\nimport useTokenPrice from '@cetus/hooks/src/useTokenPrice'\nimport { useAccountStore } from '@cetus/stores'\nimport useTokenPriceStore from '@cetus/stores/src/tokenPrice'\nimport usePeripherySDKStore from '@cetus/stores/src/usePeripherySDKStore'\nimport envConfigs from '@cetus/types/src/config/envConfigs'\nimport { d } from '@cetus/utils'\nimport { fixCoinType } from '@cetusprotocol/cetus-burn-sdk'\nimport { DividendReward, PhaseDividendInfo, VeNFT, XCetusUtil } from '@cetusprotocol/cetus-periphery-sdk'\nimport { buildNFT, extractStructTagFromType, fromDecimalsAmount, getMoveObjectType } from '@cetusprotocol/cetus-sui-clmm-sdk'\nimport CetusXcetusSDK, { DividendManager, LockCetus } from '@cetusprotocol/cetus-xcetus-sdk'\nimport { useDebounceEffect } from 'ahooks'\nimport { useCallback, useEffect, useState } from 'react'\n\n/**\n *  è·å–æˆ‘çš„xcetus è®¢å•\n * @returns\n */\nexport function useGetOwnerLockCetusList() {\n  const { xCetusSdk } = usePeripherySDKStore()\n  const { currentAccount } = useAccountStore()\n\n  const { setLockCetusListLoading, clearData, setLockCetusList } = useXCetusStore()\n\n  const fetchOwnerLockCetusList = async (address = currentAccount?.address) => {\n    if (!address) {\n      setLockCetusListLoading(false)\n      clearData()\n      return\n    }\n    try {\n      setLockCetusListLoading(true)\n      const lockList = await xCetusSdk.XCetusModule.getOwnerRedeemLockList(address)\n      console.log('ğŸš€ ~ fetchOwnerLockCetusList ~ lockList:', lockList, address)\n      if (address === currentAccount?.address) {\n        lockList.sort((a, b) => a.locked_until_time - b.locked_until_time)\n        setLockCetusList(lockList)\n      }\n    } catch (error) {\n      console.log('ğŸš€ ~ fetchOwnerLockCetusList ~ error:', error)\n    } finally {\n      setLockCetusListLoading(false)\n    }\n  }\n\n  return {\n    fetchOwnerLockCetusList\n  }\n}\n\n/**\n *  è·å–ç”¨æˆ·çš„åˆ†çº¢ä¿¡æ¯\n */\nexport function useGetVeNFTDividendInfo() {\n  const { xCetusSdk } = usePeripherySDKStore()\n\n  const { setDividendRewardList } = useXCetusStore()\n\n  const fetchVeNFTDividendInfo = async (veNftId: string) => {\n    try {\n      const dividendInfo = await xCetusSdk.XCetusModule.getVeNFTDividendInfo(veNftId)\n      console.log('ğŸš€ ~ file: useXCetusHelper.ts:62 ~ fetchVeNFTDividendInfo ~ dividendInfo:', dividendInfo)\n\n      if (dividendInfo) {\n        setDividendRewardList(dividendInfo.rewards)\n      }\n    } catch (error) {\n      console.log('ğŸš€ ~ fetchVeNFTDividendInfo ~ error:', error, veNftId)\n    }\n  }\n\n  return { fetchVeNFTDividendInfo }\n}\n\nexport function useGetOwnerVeNFT() {\n  const { xCetusSdk } = usePeripherySDKStore()\n  const { currentAccount } = useAccountStore()\n\n  const { setVeNFTLoading, clearData, setVeNFT } = useXCetusStore()\n\n  const fetchOwnerVeNFT = async (address = currentAccount?.address, forceRefresh?: boolean) => {\n    if (!address) {\n      setVeNFTLoading(false)\n      clearData()\n      return\n    }\n\n    setVeNFTLoading(true)\n\n    try {\n      const veNFT = await xCetusSdk.XCetusModule.getOwnerVeNFT(address, forceRefresh)\n      console.log('ğŸš€ ~ fetchOwnerVeNFT ~ veNFT:', veNFT)\n      if (veNFT) {\n        setVeNFT(veNFT, address)\n        return veNFT\n      }\n    } catch (error) {\n      console.log('ğŸš€ ~ fetchOwnerVeNFT ~ error:', error)\n    } finally {\n      setVeNFTLoading(false)\n    }\n  }\n\n  return { fetchOwnerVeNFT }\n}\n\n/**\n * è·å–å½“å‰æœŸæ•°å’Œä¸‹ä¸€æœŸå¼€å§‹æ—¶é—´\n */\nexport function useGetCurrPeriod() {\n  const { dividendManager } = useXCetusStore()\n  const [currentPeriod, setCurrentPeriod] = useState<number | undefined>()\n  const [nextStartTime, setNextStartTime] = useState<number | undefined>()\n\n  const calculateCurrPeriod = (dividendManager: DividendManager) => {\n    const currentTime = Date.now() / 1000\n    const { start_time, interval_day } = dividendManager\n\n    const nextStartTime = Number(XCetusUtil.getNextStartTime(dividendManager).toString())\n\n    const currentPeriod =\n      envConfigs.env == 'testnet'\n        ? Math.ceil((currentTime - start_time) / (interval_day * 60))\n        : Math.ceil((currentTime - start_time) / (interval_day * 24 * 3600))\n\n    setCurrentPeriod(currentPeriod)\n    setNextStartTime(nextStartTime)\n  }\n\n  useEffect(() => {\n    if (dividendManager) {\n      calculateCurrPeriod(dividendManager)\n    }\n  }, [dividendManager])\n\n  return {\n    currentPeriod,\n    nextStartTime,\n    calculateCurrPeriod\n  }\n}\n\n/**\n * è®¡ç®—APR\n */\nexport function useGetXCetusApr(phaseDividendInfo?: PhaseDividendInfo, treasury?: string) {\n  const { fetchTokenInfo } = useGetToken()\n  const { getTokenAmountValue } = useTokenPrice()\n  const { coinPriceObj } = useTokenPriceStore()\n  const [cetusApr, setCetusApr] = useState<string>('0')\n  const calculateAPR = useCallback(async () => {\n    if (!phaseDividendInfo || !treasury) return\n\n    try {\n      const bonusList = phaseDividendInfo.bonus\n      const coinTypeList = bonusList.map(bonus => fixCoinType(bonus.name, false))\n      const tokenMap = await fetchTokenInfo<string[]>(coinTypeList)\n      // å¹¶è¡Œè·å–æ‰€æœ‰ä»£å¸ä¿¡æ¯å’Œé‡‘é¢ä»·å€¼\n      const totalBonusAmountValue = bonusList\n        .map(bonus => {\n          const coinType = fixCoinType(bonus.name, false)\n          const coinInfo = tokenMap?.get(coinType)\n          if (coinInfo) {\n            const amount = fromDecimalsAmount(bonus.value, coinInfo.decimals).toString()\n            const value = getTokenAmountValue(coinType, amount)\n            // console.log('ğŸš€ ---------------------------------------------------------------ğŸš€')\n            // console.log('ğŸš€ ~ file: useXCetusHelper.ts:158 ~ calculateAPR ~ value:', value, coinType)\n            // console.log('ğŸš€ ---------------------------------------------------------------ğŸš€')\n            return value\n          }\n          return '0'\n        })\n        .reduce((acc, value) => acc.add(value), d(0)) // æ±‡æ€»ä»·å€¼\n      // è·å– Cetus çš„æ€»ä»·å€¼\n      const cetusValue = getTokenAmountValue(envConfigs.cetus_coin.coin_type, fromDecimalsAmount(treasury, 9).toString())\n\n      // è®¡ç®— APR\n      const apr = d(cetusValue).gt(0) ? totalBonusAmountValue.div(7).mul(365).div(cetusValue).mul(100).toFixed(2) : '0'\n\n      setCetusApr(Number(apr) > 0 && Number(apr) < 0.01 ? '0.01' : apr.toString())\n    } catch (error) {\n      console.error('Error calculating APR:', error)\n      setCetusApr('0.01') // å¤„ç†é”™è¯¯æ—¶è®¾ç½®é»˜è®¤å€¼\n    }\n  }, [phaseDividendInfo?.bonus, treasury, coinPriceObj])\n\n  useDebounceEffect(() => {\n    calculateAPR()\n  }, [phaseDividendInfo?.bonus, treasury, coinPriceObj])\n\n  return { cetusApr }\n}\n\n/**\n * è·å–ç”¨æˆ·çš„å¥–åŠ±ä¿¡æ¯\n */\nexport function useGetUserRewards(currentPeriod?: number) {\n  const { dividendRewardList } = useXCetusStore()\n  const { fetchTokenInfo } = useGetToken()\n  const { getTokenAmountValue } = useTokenPrice()\n  const [summaryRewardList, setSummaryRewardList] = useState<XCetusRewardInfo[]>([])\n  const [rewardList, setRewardList] = useState<DividendReward[]>([])\n  const [totalRewardValue, setTotalRewardValue] = useState<string>('0')\n\n  const calculateRewards = useCallback(async () => {\n    let totalValue = d(0)\n\n    // è¿‡æ»¤æ‰å¥–åŠ±å…¨ä¸º0çš„ å’Œ  å½“æœŸçš„å¥–åŠ±\n    const filteredList = dividendRewardList.filter(item => {\n      if (item.period === currentPeriod) {\n        return false\n      }\n      if (item.rewards.find(reward => d(reward.amount).eq(0))) {\n        return false\n      }\n      return true\n    })\n\n    console.log('ğŸš€ ~ file: useXCetusHelper.ts:107 ~ calculateRewards ~ filteredList:', {\n      filteredList,\n      dividendRewardList,\n      currentPeriod\n    })\n\n    setRewardList(filteredList)\n\n    const rewardMap: Record<string, XCetusRewardInfo> = {}\n    const coinTypeList = filteredList.flatMap(item => item.rewards.map(reward => fixCoinType(reward.coin_type, false)))\n    const tokenMap = await fetchTokenInfo<string[]>(coinTypeList)\n\n    filteredList.forEach(item => {\n      for (const reward of item.rewards) {\n        const coinType = fixCoinType(reward.coin_type, false)\n        const coinInfo = tokenMap?.get(coinType)\n        if (coinInfo) {\n          const amount = fromDecimalsAmount(reward.amount, coinInfo.decimals).toString()\n\n          const amountValue = getTokenAmountValue(coinType, amount)\n          // console.log('ğŸš€ -------------------------------------------------------------------------------ğŸš€')\n          // console.log('ğŸš€ ~ file: useXCetusHelper.ts:213 ~ calculateRewards ~ amountValue:', amountValue, coinType)\n          // console.log('ğŸš€ -------------------------------------------------------------------------------ğŸš€')\n\n          totalValue = totalValue.add(amountValue)\n\n          // æ›´æ–° rewardMap\n          rewardMap[coinType] = rewardMap[coinType]\n            ? {\n                ...rewardMap[coinType],\n                amount: d(rewardMap[coinType].amount).add(amount).toString(),\n                value: d(rewardMap[coinType].value).add(amountValue).toString()\n              }\n            : {\n                amount,\n                coin_type: coinType,\n                value: amountValue\n              }\n        }\n      }\n    })\n    setSummaryRewardList(\n      Object.values(rewardMap)\n        .filter(item => d(item.amount).gt(0))\n        .sort((a, b) => d(b.value).sub(a.value).toNumber())\n    )\n    setTotalRewardValue(totalValue.toString())\n  }, [dividendRewardList, getTokenAmountValue, currentPeriod])\n\n  useEffect(() => {\n    if (currentPeriod) {\n      calculateRewards()\n    }\n  }, [dividendRewardList, currentPeriod])\n\n  return {\n    summaryRewardList,\n    rewardList,\n    totalRewardValue\n  }\n}\n\nexport const XCetusVeNFTType = `${envConfigs.xcetus_sdk_options.xcetus.package_id}::xcetus::VeNFT`\nexport const XCetusLockCetusType = `${envConfigs.xcetus_sdk_options.xcetus.package_id}::lock_coin::LockedCoin<${envConfigs.cetus_coin.coin_type}>`\n\nexport function buildVeNFT(dataList: any[]) {\n  let veNFT: VeNFT | undefined\n  dataList.forEach(item => {\n    if (item) {\n      const type = extractStructTagFromType(getMoveObjectType(item) as string).source_address\n      if (type === XCetusVeNFTType && item.data && item.data.content) {\n        const { fields } = item.data.content\n\n        veNFT = {\n          ...buildNFT(item),\n          id: fields.id.id,\n          index: fields.index,\n          type,\n          xcetus_balance: fields.xcetus_balance\n        }\n        return veNFT\n      }\n    }\n  })\n  return veNFT\n}\n\nexport async function buildLockCetus(dataList: any[], xCetusSdk: CetusXcetusSDK) {\n  const lockCetusList: LockCetus[] = []\n  for (let i = 0; i < dataList.length; i++) {\n    const item = dataList[i]\n    if (item) {\n      const type = extractStructTagFromType(getMoveObjectType(item) as string).source_address\n      if (type === XCetusLockCetusType && item.data) {\n        const lockCetus = XCetusUtil.buildLockCetus(item.data.content)\n        lockCetus.xcetus_amount = await xCetusSdk.XCetusModule.getXCetusAmount(lockCetus.id)\n        lockCetusList.push(lockCetus)\n      }\n    }\n  }\n  return lockCetusList\n}\n"],"names":["useGetOwnerLockCetusList","xCetusSdk","usePeripherySDKStore","currentAccount","useAccountStore","setLockCetusListLoading","clearData","setLockCetusList","useXCetusStore","address","lockList","b","error","useGetVeNFTDividendInfo","setDividendRewardList","veNftId","dividendInfo","useGetOwnerVeNFT","setVeNFTLoading","setVeNFT","forceRefresh","veNFT","useGetCurrPeriod","dividendManager","currentPeriod","setCurrentPeriod","useState","nextStartTime","setNextStartTime","calculateCurrPeriod","currentTime","start_time","interval_day","XCetusUtil","envConfigs","useEffect","useGetXCetusApr","phaseDividendInfo","treasury","fetchTokenInfo","useGetToken","getTokenAmountValue","useTokenPrice","coinPriceObj","useTokenPriceStore","cetusApr","setCetusApr","calculateAPR","useCallback","bonusList","coinTypeList","bonus","fixCoinType","tokenMap","totalBonusAmountValue","coinType","coinInfo","amount","fromDecimalsAmount","acc","value","d","cetusValue","apr","useDebounceEffect","useGetUserRewards","dividendRewardList","summaryRewardList","setSummaryRewardList","rewardList","setRewardList","totalRewardValue","setTotalRewardValue","calculateRewards","totalValue","filteredList","item","reward","rewardMap","amountValue","a","XCetusVeNFTType","XCetusLockCetusType","buildVeNFT","dataList","type","extractStructTagFromType","getMoveObjectType","fields","buildNFT","buildLockCetus","lockCetusList","i","lockCetus"],"mappings":"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"}