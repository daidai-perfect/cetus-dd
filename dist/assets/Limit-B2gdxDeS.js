import{j as e,H as j,T as _,a as d,V as P,W as ze,X as Ne,Y as De,Z as Be,a7 as gt,$ as We,a0 as $e,q as I,p as K,C as je,S as rt,f as ht,R as Oe,as as U,at as z,av as jt,aw as bt,ax as X,ar as ft,ak as _t,ay as Jt,O as at,a9 as Kt}from"./vendor-BowHGuwE.js";import{C as Xt,f as W,t as Ve,aa as wt,h as yt,a as re,B as Y,I as ee,K as Ge,m as Re,l as St,n as se,k as ge,aq as Se,ar as ie,as as Ct,$ as Z,d as F,j as Lt,N as Ot,e as Zt,J as Ye,y as Ce,r as Ue,E as ot,M as qt,G as ne,X as ct,z as It,u as es,at as ts}from"./index-DkhaBol7.js";import{P as ve}from"./Pagination-y-5Jwnn6.js";import{N as te}from"./NoData-DwPvHKvw.js";import{u as ss}from"./RangeValue-cqIfNCEg.js";import{u as he}from"./useTransaction-CQ6nsjEW.js";import{u as Te}from"./useAccountBalance-cKNVEwao.js";import{u as Qe}from"./useToken-CSCz_gGn.js";import{S as is}from"./SingleTokenInfo-BERFh5bF.js";import{b as vt}from"./FarmsTable-DK-wz6kE.js";import{A as ns}from"./aggregator-BiEWppLU.js";import{A as lt}from"./useSwapHelper-DVNtAVfI.js";import{u as dt}from"./useTokenBalance-M4XeKsrZ.js";import{u as rs}from"./useInsufficientBalanceToast-kaaOFfAF.js";import{u as as}from"./useFindBestRouting-BXoN_bhe.js";import{T as os}from"./TradeInputGroup-CrAMmnqi.js";import{W as cs}from"./WarningTokenTipModal-FLYP29DR.js";import{M as ls,C as ds}from"./MenuDropBlock-7XxSUspL.js";import{T as ps,a as xs}from"./TradeTab-Bo6q4wlf.js";import"./AggregatorModal-B2pF4Y2j.js";import{u as us}from"./global-BC-faoA7.js";import"./swapConfig-RUj6136v.js";import"./swap-b-mhmzNm.js";import"./FreshProgressV2-CJ86JnvM.js";import{T as ms}from"./TradeConfirmAmountInfo-C3FkLGZz.js";import{I as Le}from"./InputBox-DcOfvTu8.js";import{LimitPriceChart as gs}from"./LimitPriceChart-DMwy6Gk3.js";import{u as hs}from"./useInterval-BcJtT0it.js";import{u as js}from"./useRpcListener-CldyS34K.js";import{R as pt}from"./RefreshButton-DqaUEVBY.js";import"./useTrack-Bd5XC9Ob.js";import"./useSigner-DSfRMpjC.js";import"./CopyButton-xu19-Yfe.js";import"./usePositionList-GdZyH6-4.js";import"./useFavoritePool-Bc73iqoi.js";import"./useGetPoolList-_YHw7VK4.js";import"./useWrapPoolData-DnehZCL4.js";import"./index-Dm6oW2kx.js";import"./ExpendItem-UYXtS0Zs.js";import"./msafe-oYBkW7LJ.js";import"./PositionStatus-DB_bAZQs.js";import"./CoinPairInfo-BXcGfsjU.js";import"./PoweredByHaedal-uLEk4Xbu.js";import"./_getAllKeysIn-B0eKCz8b.js";import"./CheckBox-CNrzffkS.js";import"./IconBg-BaIL-Zyp.js";import"./TooltipIcon--AUMzVZ8.js";import"./usePreviousValue-ChnvxeJQ.js";const be=({info:t,imgSize:n="32px"})=>{const{pay_coin:r,target_coin:m,total_pay_amount:x,expect_obtain_amount:p}=t;return e.jsxs(j,{children:[e.jsx(Xt,{w:n,h:n,coinAIconUrl:r.logo_url,coinBIconUrl:m.logo_url}),e.jsxs(_,{color:"text_caption",children:[W(x)," ",r.symbol," â†’ ",W(p)," ",m.symbol]})]})},fe=({info:t})=>e.jsx(j,{justifyContent:"end",gap:"2px",children:e.jsxs(_,{color:"text_caption",children:[Ve(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),_e=({info:t})=>{const{pay_coin:n,total_pay_amount:r,deal_amount:m,deal_rate:x}=t;return e.jsxs(j,{justifyContent:"end",gap:"2px",children:[e.jsxs(_,{color:"text_caption",children:[W(m),"/",W(r)," ",n.symbol]}),e.jsxs(_,{color:"primary_gray",children:["(",wt(Number(x)*100),")"]})]})},Tt=({historyInfo:t,type:n,...r})=>{const{getExplorerUrl:m}=yt(),{pay_coin:x,target_coin:p}=t,g=d.useMemo(()=>(t==null?void 0:t.events)||[],[t]),h=o=>{const l=o==null?void 0:o.event_type;return l.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${W(Re(o==null?void 0:o.amount,x==null?void 0:x.decimals))}`}:l.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:p,num:`+${W(Re(o==null?void 0:o.amount,p==null?void 0:p.decimals))}`}:l.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${W(Re(o==null?void 0:o.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=re();return e.jsx(Y,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...r,children:e.jsx(P,{align:"flex-start",children:g.map(o=>{const{tokenInfo:l,text:i,icon:s,color:c,num:b}=h(o);return e.jsxs(P,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(j,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(j,{gap:n=="card"?"4px":"8px",flexDirection:n=="card"?"column":"row",align:n=="card"?"flex-start":"center",children:[e.jsxs(j,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(ee,{svgW:"14px",xlinkHref:s,svgFill:c,svgHover:c}),e.jsx(_,{color:c,children:i})]}),!a&&e.jsxs(_,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[b,"Â ",l==null?void 0:l.symbol]})]}),e.jsxs(j,{gap:n=="card"?"4px":"20px",flexDirection:n=="card"&&!a?"column":"row",align:n=="card"?"flex-end":"center",children:[e.jsxs(_,{h:"20px",lineHeight:"20px",children:[Ve(Number(o.block_time),"")," (UTC)"]}),e.jsxs(j,{gap:"4px",cursor:"pointer",onClick:f=>{Ge(f),window.open(m(o.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(_,{color:"text_caption",children:"View Transaction"}),e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(_,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[b,"Â ",l==null?void 0:l.symbol]})]},o==null?void 0:o.tx)})})})},le=({info:t})=>{const[n,r]=d.useState(!0),{getTokenRank:m}=ss();d.useEffect(()=>{const a=m(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),r(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:p,price:g,reseverPrice:h}=t;return e.jsxs(j,{justifyContent:"end",children:[n?e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(_,{color:"text_caption",lineHeight:"1",children:W(g)}),e.jsxs(_,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[p.symbol," per ",x.symbol]})]}):e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(_,{color:"text_caption",children:W(h)}),e.jsxs(_,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",p.symbol]})]}),e.jsx(ee,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{Ge(a),r(!n)}})]})},Pt=({historyInfo:t,openExpendItemObj:n})=>e.jsxs(j,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(ee,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(_,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(ee,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:n[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),bs=(t,n)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:r=>{t(()=>({orderListLoading:r}))},setMyOrderList:r=>{t(()=>({myOrderList:r}))}}),Pe=St(bs);function ke(){const{currentAccount:t,addressChangeVersion:n}=se(),r=ge("limit"),{setOrderListLoading:m,setMyOrderList:x,myOrderList:p,orderListLoading:g}=Pe(),{getTokenListInfo:h}=Qe(),a=async(l=t==null?void 0:t.address,i)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",l);try{if(!l){m(!1),x([]);return}i&&m(!0);const s=await r.LimitOrder.getOwnerLimitOrderList(l,"all"),c=await o(s.data.filter(b=>b.status===Se.PartialCompleted||b.status===Se.Running));x(c),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",c)}catch(s){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",s)}finally{m(!1)}},o=async l=>{const i=[],s=[];for(const b of l)s.push(b.pay_coin_type),s.push(b.target_coin_type);const c=await h(s);for(const b of l){const[f,L]=[c==null?void 0:c.get(b.pay_coin_type),c==null?void 0:c.get(b.target_coin_type)];if(f&&L){const{total_pay_amount:O,pay_balance:v,rate:M,obtained_amount:y,claimed_amount:S,target_balance:w,created_ts:H,expire_ts:N,status:E,id:Q}=b,D=ie(O,f.decimals).toString(),V=ie(v,f.decimals).toString(),T=ie(y,L.decimals).toString(),$=ie(S,L.decimals).toString(),k=ie(w,L.decimals).toString(),C=Ct.rateToPrice(M.toString(),f.decimals,L.decimals),q=Z(1).div(C).toString(),de=ie(Z(O).sub(v).toFixed(0),f.decimals).toString(),Me={order_id:Q,pay_coin:f,target_coin:L,price:C,reseverPrice:q,total_pay_amount:D,expect_obtain_amount:Z(D).mul(C).toString(),remaining_amount:V,deal_amount:de,deal_rate:Z(de).div(D).toString(),obtained_amount:T,claimed_amount:$,un_claimed_amount:Z(k).sub($).toString(),created_ts:H,expire_ts:N,status:E};i.push(Me)}}return i.sort((b,f)=>f.created_ts-b.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:g,myOrderList:p}}function kt(){const{fetchAccountBalance:t}=Te(),{fetchMyLimitOrder:n}=ke(),{signAndExecuteTransaction:r}=he(),m=ge("limit"),[x,p]=d.useState(!1),{transactionConfirmation:g}=he();return{handleCancelOrder:async a=>{p(!0);const o={getShowInfo:c=>{const b="Canceling order",f={modalDescriptionText:b,toastTitleText:b};return c==="success"&&(f.toastDescriptionContent="Order cancelled successfully",f.modalDescriptionText="Order cancelled successfully",f.toastTitleText="Order cancelled"),f}};g(o);const l=a.map(c=>({pay_coin_type:c.pay_coin.coin_type,target_coin_type:c.target_coin.coin_type,order_id:c.order_id})),i=await m.LimitOrder.cancelOrdersByOwner(l),s=await r(i,o);p(!1),s&&setTimeout(()=>{t(),n()},2e3)},cancelOrderLoading:x}}function fs(){const{fetchAccountBalance:t}=Te(),{fetchMyLimitOrder:n}=ke(),{signAndExecuteTransaction:r}=he(),m=ge("limit"),[x,p]=d.useState(!1),[g,h]=d.useState(!1);return{handleClaimOrder:async(l,i)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",l),p(!0);const s={pay_coin_type:l.pay_coin.coin_type,target_coin_type:l.target_coin.coin_type,order_id:l.order_id},c=await m.LimitOrder.claimTargetCoin(s),b=await r(c,{getShowInfo:(f,L)=>{var M;const O=`Claim ${W(i)} ${(M=l==null?void 0:l.target_coin)==null?void 0:M.symbol}`,v={modalDescriptionText:O,toastTitleText:O};return f==="success"&&(v.toastDescriptionContent="",v.modalDescriptionText="",v.toastTitleText="Claim successfully"),v}});p(!1),b&&setTimeout(()=>{t(),n()},2e3)},getLimitOrderClaimHistory:async l=>{console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ order:",l),h(!0);const i=await m.LimitOrder.getLimitOrderClaimLogs(l.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",l,i),i?(h(!1),i.map(s=>{var b;const c=F(s.parsed_json.claimed_amount).div(Math.pow(10,(b=l.target_coin)==null?void 0:b.decimals));return{...s,...s.parsed_json,claimed_amount:c}})):[]},isClaimHistoryLoading:g,claimLoading:x}}const _s=({orderInfo:t,isOpen:n,onClose:r,handleClaim:m,claimLoading:x,getLimitOrderClaimHistory:p,isClaimHistoryLoading:g})=>{const{getExplorerUrl:h}=yt(),[a,o]=d.useState(""),[l,i]=d.useState([]),[s,c]=d.useState({label:"Claim",value:"claim"}),b=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],f=y=>{c(y),(y==null?void 0:y.value)=="history"&&L()},L=async()=>{const y=await p();y&&i(y)},O=d.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:F(a).gt(t.un_claimed_amount)||F(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[v,M]=d.useState(!0);return d.useEffect(()=>{v&&(M(!1),o(t.un_claimed_amount))},[v,t.un_claimed_amount]),console.log("claimModal###history###",history),e.jsxs(ze,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:r,isCentered:!0,children:[e.jsx(Ne,{}),e.jsxs(De,{children:[e.jsx(Be,{children:e.jsx(gt,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(We,{}),e.jsx($e,{textAlign:"center",p:"0px",children:e.jsxs(P,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(Y,{borderRadius:"8px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(be,{info:t,imgSize:"28px"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(le,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(_e,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(fe,{info:t})]}),e.jsx(Lt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:b,currentTab:s.label,handleChangeTab:f}),(s==null?void 0:s.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(P,{gap:"16px",align:"flex-start",children:[e.jsx(_,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(Ot,{value:a?W(a).toString():"",onChange:y=>{o(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(j,{children:e.jsx(is,{token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(I,{onClick:()=>{m(a),r()},disabled:O.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:O.text})]}),(s==null?void 0:s.value)=="history"&&e.jsx(P,{w:"100%",gap:"12px",children:g?e.jsxs(Y,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(j,{justify:"space-between",children:[e.jsx(K,{height:"4",width:"150px"}),e.jsx(K,{height:"4",width:"150px"})]}),e.jsxs(j,{justify:"space-between",mt:"16px",children:[e.jsx(K,{height:"4",width:"150px"}),e.jsx(K,{height:"4",width:"150px"})]})]}):(l==null?void 0:l.length)==0?e.jsx(te,{type:"nodata",text:"No History.",p:"20px"}):l==null?void 0:l.map(y=>{var S,w;return e.jsx(Y,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(P,{gap:"16px",align:"flex-start",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Amount"}),e.jsxs(j,{gap:"4px",children:[e.jsx(Zt,{imageUrl:(S=t==null?void 0:t.target_coin)==null?void 0:S.logo_url,w:"20px",h:"20px"}),e.jsxs(_,{color:"text_caption",lineHeight:"18px",children:[W(y==null?void 0:y.claimed_amount)," ",(w=t==null?void 0:t.target_coin)==null?void 0:w.symbol]})]})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Time"}),e.jsxs(j,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:H=>{Ge(H),window.open(h(y.digest,"tx"))},children:[e.jsxs(_,{color:"text_caption",children:[Ve(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},Fe=({orderInfo:t})=>{const{handleCancelOrder:n,cancelOrderLoading:r}=kt(),{handleClaimOrder:m,claimLoading:x,getLimitOrderClaimHistory:p,isClaimHistoryLoading:g}=fs(),[h,a]=d.useState(),[o,l]=d.useState(!1),i=(s,c)=>{a(s),c==="cancel"&&n([s]),c==="claim"&&l(!0)};return re(),e.jsxs(j,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[F(t==null?void 0:t.obtained_amount).lte(0)&&F(t.un_claimed_amount).lte(0)?e.jsx(Ye,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(je,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(I,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(I,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||i(t,"claim")},children:"Claim"}),e.jsx(I,{isLoading:r,disabled:r,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{r||i(t,"cancel")},children:"Cancel"}),o&&e.jsx(_s,{orderInfo:t,claimLoading:x,isOpen:o,onClose:()=>l(!1),handleClaim:s=>m(t,s),getLimitOrderClaimHistory:()=>p(t),isClaimHistoryLoading:g})]})};function xt(){const{currentAccount:t,onWalletModal:n}=se(),{myOrderList:r,orderListLoading:m}=Pe(),x=10,[p,g]=d.useState([]),[h,a]=d.useState(0),[o,l]=d.useState(1);return d.useEffect(()=>{if((r==null?void 0:r.length)>0){a(r==null?void 0:r.length);const i=(o-1)*x,s=i+x;g(r.slice(i,s))}},[o,r]),e.jsx(P,{w:"100%",children:t!=null&&t.address?m?e.jsx(Y,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((i,s)=>e.jsx(Mt,{},s))})}):r.length===0?e.jsx(te,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(Y,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(p==null?void 0:p.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:p==null?void 0:p.map(i=>e.jsx(ws,{orderInfo:i},i==null?void 0:i.order_id))}),!m&&(r==null?void 0:r.length)>x&&e.jsx(je,{mt:"12px",children:e.jsx(ve,{total:h,size:x,currentPage:o,onChange:l})})]}):e.jsx(te,{type:"nowallet",onboard:()=>n(!0),borderRadius:"16px"})})}const ws=({orderInfo:t})=>{const{isApp:n}=re();return e.jsxs(P,{w:"100%",gap:"16px",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(be,{info:t,imgSize:"28px"}),!n&&e.jsx(Fe,{orderInfo:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(le,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(_e,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(fe,{info:t})]}),n&&e.jsx(Fe,{orderInfo:t})]})},Mt=()=>e.jsxs(P,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(j,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(j,{gap:"0",children:[e.jsxs(j,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(rt,{size:"8"}),e.jsx(rt,{size:"8"})]}),e.jsx(K,{height:"4",width:"100px"})]})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(K,{height:"4",width:"180px"}),e.jsx(K,{height:"4",width:"150px"})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(K,{height:"4",width:"180px"}),e.jsx(K,{height:"4",width:"150px"})]})]});function ut(t){const{historyOrderList:n,historyOrderLoading:r}=t,{currentAccount:m,onWalletModal:x}=se();console.log("ðŸš€ ~ OrderTableList ~ historyOrderList:",n);const p=10,[g,h]=d.useState([]),[a,o]=d.useState(0),[l,i]=d.useState(1);return d.useEffect(()=>{if((n==null?void 0:n.length)>0){o(n==null?void 0:n.length);const s=(l-1)*p,c=s+p;h(n.slice(s,c))}},[l,n]),e.jsx(P,{w:"100%",children:m!=null&&m.address?r?e.jsx(Y,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,c)=>e.jsx(Mt,{},c))})}):n.length===0?e.jsx(te,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(Y,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(g==null?void 0:g.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(P,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:g==null?void 0:g.map(s=>e.jsx(ys,{historyInfo:s},s==null?void 0:s.order_id))}),!r&&(n==null?void 0:n.length)>p&&e.jsx(je,{mt:"12px",children:e.jsx(ve,{total:a,size:p,currentPage:l,onChange:i})})]}):e.jsx(te,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const ys=({historyInfo:t})=>{const[n,r]=d.useState({});return e.jsxs(P,{w:"100%",gap:"16px",children:[e.jsx(j,{w:"100%",justify:"space-between",children:e.jsx(be,{info:t,imgSize:"28px"})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Limit Price"}),e.jsx(le,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(fe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(_e,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Status"}),e.jsx(ht,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,r({...n})},children:e.jsx(Pt,{historyInfo:t,openExpendItemObj:n})})]}),n[t==null?void 0:t.order_id]&&e.jsx(Tt,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function Ss({historyInfo:t}){const[n,r]=d.useState({});return e.jsxs(Oe.Fragment,{children:[e.jsxs(U,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,r({...n})},sx:{td:{pb:n[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(be,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(le,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(_e,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(Pt,{historyInfo:t,openExpendItemObj:n})})]}),!n[t==null?void 0:t.order_id]&&e.jsx(U,{h:"16px"}),e.jsx(U,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:n[t==null?void 0:t.order_id]&&e.jsx(z,{colSpan:5,children:e.jsx(Tt,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function Cs(t){const{historyOrderList:n,historyOrderLoading:r}=t;console.log("ðŸš€ ~ HistoryTableList ~ historyOrderList:",n);const{currentAccount:m,onWalletModal:x}=se(),p=10,[g,h]=d.useState([]),[a,o]=d.useState(0),[l,i]=d.useState(1);return d.useEffect(()=>{if((n==null?void 0:n.length)>0){o(n==null?void 0:n.length);const s=(l-1)*p,c=s+p;h(n.slice(s,c))}},[l,n]),e.jsxs(jt,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(bt,{children:e.jsxs(U,{children:[e.jsx(X,{children:"Order Info"}),e.jsx(X,{textAlign:"right",children:"Limit Price"}),e.jsx(X,{textAlign:"right",children:"Expiry"}),e.jsx(X,{textAlign:"right",children:"Filled Size"}),e.jsx(X,{textAlign:"right",children:"Status"})]})}),e.jsx(ft,{children:m!=null&&m.address?r?e.jsx(vt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(U,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(Oe.Fragment,{children:[g.map(s=>e.jsx(Ss,{historyInfo:s},s.order_id)),!r&&(n==null?void 0:n.length)>p&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(je,{w:"100%",children:e.jsx(ve,{total:a,size:p,currentPage:l,onChange:i})})})]}):e.jsx(U,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const Ls=(t,n)=>({quoteToken:void 0,payCoin:Ce.clmm_swap.from_coin,targetCoin:Ce.clmm_swap.to_coin,setPayCoin:r=>{t(()=>({payCoin:r}))},setTargetCoin:r=>{t(()=>({targetCoin:r}))},setQuoteToken:r=>{t(()=>({quoteToken:r}))},expiresIn:"7 Days",setExpiresIn:r=>{t(()=>({expiresIn:r}))},customExpiresVal:null,setCustomExpiresVal:r=>{t(()=>({customExpiresVal:r}))},refreshPriceLoading:!1,setRefreshPriceLoading:r=>{t(()=>({refreshPriceLoading:r}))}}),ae=St(Ls);function Os(t,n){const{getTokenPrice:r}=Ue(),m=r(t),x=r(n),p=d.useMemo(()=>{if(m&&x){const g=Z(m.price).div(x.price).toString(),h=g.toString();return{price:g,displayPrice:h}}},[m,x]);return{price:p==null?void 0:p.price,displayPrice:p==null?void 0:p.displayPrice}}function Ht(){const{payCoin:t,targetCoin:n,setRefreshPriceLoading:r}=ae(),{fetchTokenPrices:m}=Ue();return{refreshCoinMarketPrice:()=>{const p=[];t&&p.push(t.coin_type),n&&p.push(n.coin_type),p.length>0&&(r(!0),m(p).finally(()=>{r(!1)}))}}}function vs(){const{refreshCoinMarketPrice:t}=Ht(),{fetchAccountBalance:n}=Te(),{fetchMyLimitOrder:r}=ke(),{signAndExecuteTransaction:m}=he(),x=ge("limit"),{findBestRouters:p}=as(),{getTokenAmountValue:g}=Ue(),h=_t(),{pay:a,target:o}=Jt(),{getTokenListInfo:l}=Qe(),{payCoin:i,targetCoin:s,quoteToken:c,expiresIn:b,setPayCoin:f,setTargetCoin:L,setQuoteToken:O,customExpiresVal:v,setExpiresIn:M,setRefreshPriceLoading:y}=ae(),[S,w]=d.useState(""),[H,N]=d.useState(""),[E,Q]=d.useState(!0),[D,V]=d.useState(!0),[T,$]=d.useState(""),{displayPrice:k}=Os((c==null?void 0:c.coin_type)===(i==null?void 0:i.coin_type)?s==null?void 0:s.coin_type:i==null?void 0:i.coin_type,c==null?void 0:c.coin_type),{balanceInfo:C}=dt(i),{balanceInfo:q}=dt(s),de=g(i==null?void 0:i.coin_type,S),Me=g(s==null?void 0:s.coin_type,H),[He,Et]=d.useState(""),Je=d.useRef(He);d.useEffect(()=>{Je.current=He},[He]);const[pe,Ke]=d.useState(void 0),[xe,Xe]=d.useState(""),At=d.useRef(S),Rt=d.useRef(H);d.useEffect(()=>{At.current=S},[S]),d.useEffect(()=>{Rt.current=H},[H]),d.useEffect(()=>{(async()=>{const A=[a,o].filter(Boolean),B=await l(A),G=B==null?void 0:B.get(a||"");f(G||Ce.clmm_swap.from_coin);const J=B==null?void 0:B.get(o||"");L(J||Ce.clmm_swap.to_coin)})()},[a,o]),d.useEffect(()=>{if(Ke(void 0),t(),Ft(),i&&s){const u=i.extensions&&i.extensions.rank||"0",A=s.extensions&&s.extensions.rank||"0";console.log("ðŸš€ ~ useEffect ~ payCoinRank:",i,s),F(u).gte(A)?O({...i}):O({...s})}},[i==null?void 0:i.coin_type,s==null?void 0:s.coin_type]);const Ft=async()=>{if(i&&s){const u=`${i.coin_type}_${s.coin_type}`;Et(u);const A=Object.entries(ns).map(([G,J])=>J.id),B=await p({fromToken:i,toToken:s,amount:ot(1,i.decimals).toFixed(0),providersKeys:A,by_amount_in:!0,uuid:u});u===Je.current&&Ke(B)}};d.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",D,k),D?$(k||""):qe()},[k]),d.useEffect(()=>{c&&!D&&+T&&$(W(F(1).div(T).toFixed(c.decimals)).toString())},[c]),d.useEffect(()=>{Ie(E?S:H,E),qe()},[T]);const[ue,zt]=d.useState({tooltip:"",color:"",text:"",bg:""}),[Nt,Ze]=d.useState(!1),qe=()=>{var u,A;if(!D&&k&&T){Ze(!0);const B=F(T).sub(k).div(k).mul(100).toFixed(2);Xe(B);const G=F(B).gt(0),J=G?B:B.split("-")[1],R={tooltip:"",color:"",text:"",bg:""};R.tooltip=`Limit order price is ${J}% ${G?"higher":"lower"} than the market.`,((u=c==null?void 0:c.coin_type)==null?void 0:u.toLowerCase())==((A=s==null?void 0:s.coin_type)==null?void 0:A.toLowerCase())?Number(T)>Number(k)?(R.text="",R.color="#68FFD8"):Number(k)>Number(T)&&(R.text=`Your limit order price is ${J}% ${G?"higher":"lower"} than market. You are selling at a much ${G?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(T)>Number(k)?(R.text=`Your limit order price is ${J}% ${G?"higher":"lower"} than market. You are buying at a much ${G?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(k)>Number(T)&&(R.text="",R.color="#68FFD8"),zt(R),Ze(!1);return}Xe("")},Dt=(u=!0)=>{console.log("ðŸš€ ~ handleMarketPriceClick ~ marketPrice:",k),V(u),u&&($(k||""),t())},Ie=(u,A)=>{if(Q(A),A?w(u):N(u),c&&i&&s&&+T&&+u)if(A){c.coin_type===i.coin_type?N(F(u).div(T).toString().toString()):N(F(u).mul(T).toString().toString());return}else{c.coin_type===s.coin_type?w(F(u).div(T).toString().toString()):w(F(u).mul(T).toString().toString());return}A?N(""):w("")},et=(u,A)=>{tt(),Q(A),V(!0),A?ne(u==null?void 0:u.coin_type)===ne(s.coin_type)?h(`/limit/${u==null?void 0:u.coin_type}/${i==null?void 0:i.coin_type}`):h(`/limit/${u==null?void 0:u.coin_type}/${s==null?void 0:s.coin_type}`):ne(u==null?void 0:u.coin_type)===ne(i.coin_type)?h(`/limit/${s==null?void 0:s.coin_type}/${u==null?void 0:u.coin_type}`):h(`/limit/${i==null?void 0:i.coin_type}/${u==null?void 0:u.coin_type}`)},Bt=async()=>{$(k||""),s&&(et(s,!0),w(H),N(S))},tt=()=>{w(""),N("")};d.useEffect(()=>()=>{M("7 Days")},[]);const[Wt,Ee]=d.useState(!1),$t=u=>{switch(u){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:Vt}=rs(),{transactionConfirmation:Gt}=he(),Yt=ge("clmm"),{addToken:st}=qt(),Ut=async()=>{const u={getShowInfo:(ce,nt)=>{const ye="Creating order",me={modalDescriptionText:ye,toastTitleText:ye};return ce==="success"&&(me.toastDescriptionContent="",me.modalDescriptionText="Created order successfully",me.toastTitleText="Created order successfully"),ce==="rejected"&&(me.toastTitleText="Create order"),me}};Gt(u);const A=Date.parse(new Date().toString())+($t(b)||v);console.log(" ~ handleSubmitOrder ~ expired_ts:",A),Ee(!0);const B=await Yt.CetusConfig.getTokenListByCoinTypes([i.coin_type,s.coin_type]),G=i.decimals,J=s.decimals,R=B[i.coin_type].decimals,we=B[s.coin_type].decimals;i&&G!==R&&st({...i,decimals:R}),s&&J!==we&&st({...s,decimals:we});let Ae;(c==null?void 0:c.coin_type)===(s==null?void 0:s.coin_type)?Ae=T:Ae=F(1).div(T).toFixed(we);try{const ce={pay_coin_type:i.coin_type,target_coin_type:s.coin_type,expired_ts:A,target_decimal:we,pay_decimal:R,price:Number(Ae),pay_coin_amount:Number(ot(S,R).toFixed(0))},nt=await x.LimitOrder.placeLimitOrder(ce),ye=await m(nt,u);Ee(!1),ye&&(n(),r(),tt())}catch(ce){Vt(String(ce)),Ee(!1)}},{currentAccount:oe}=se(),it=d.useMemo(()=>{const u=g(i==null?void 0:i.coin_type,S);return Number(u)==0&&Number(S)>0?!1:Number(u)<5},[i,S]),Qt=d.useMemo(()=>{const u={text:"Place Limit Order",disabled:!1};return oe!=null&&oe.address?!i||!s?(u.disabled=!0,u.text=" Select a token",u):!Number(S)||!Number(H)?(u.disabled=!0,u.text="Enter an amount",u):it?(u.disabled=!0,u.text="Order size should be higher than $5",u):Number(S)>Number(C==null?void 0:C.balanceFormat)||!(C!=null&&C.balanceFormat)?(u.disabled=!0,u.text=`Insufficient ${i==null?void 0:i.symbol} balance`,u):pe&&pe.errorCode&&(pe.errorCode===lt.NoRouter||pe.errorCode===lt.HoneyPot)?(u.text="No Available Route",u.disabled=!0,u):(console.log("ðŸš€ ~ buttonTextStatus ~ priceImpact:",12,ue.color,ue,xe),ue.color.toLowerCase()=="#ffb62d"&&(Number(xe)<-10||Number(xe)>10)&&(u.disabled=!0),u):(u.disabled=!1,u.text="Connect Wallet",u)},[oe==null?void 0:oe.address,i,s,pe,S,H,it,C,JSON.stringify(ue),xe]);return{priceImpactInfoLoading:Nt,priceImpactInfo:ue,fixPayCoin:E,onReverseClick:Bt,handleSelectToken:et,marketPrice:k,payCoin:i,targetCoin:s,handleAmountChange:Ie,payAmount:S,targetAmount:H,payBalanceInfo:C,targetBalanceInfo:q,payAmountValue:de,targetAmountValue:Me,useMarketPrice:D,handleMarketPriceClick:Dt,inputPrice:T,setInputPrice:$,priceImpact:xe,quoteToken:c,setQuoteToken:O,handleSubmitOrder:Ut,submitOrderLoading:Wt,buttonTextStatus:Qt}}const Ts=({confirmData:t,isOpen:n,onClose:r,handleSubmitOrder:m,submitOrderLoading:x})=>{const{payAmount:p,targetAmount:g,payCoin:h,targetCoin:a,inputPrice:o,expiresIn:l,quoteToken:i}=t,s=d.useMemo(()=>{var b,f;return console.log("ðŸš€ ~ price ~ inputPrice:",o),o?((b=i==null?void 0:i.coin_type)==null?void 0:b.toLowerCase())==((f=a==null?void 0:a.coin_type)==null?void 0:f.toLowerCase())?o:F(1).div(o).toString():""},[i,a,o]),c=d.useMemo(()=>{var b,f;return o?((b=i==null?void 0:i.coin_type)==null?void 0:b.toLowerCase())==((f=a==null?void 0:a.coin_type)==null?void 0:f.toLowerCase())?F(1).div(o).toString():o:""},[i,a,o]);return e.jsxs(ze,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:r,isCentered:!0,children:[e.jsx(Ne,{}),e.jsxs(De,{children:[e.jsx(Be,{children:e.jsx(gt,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(We,{}),e.jsx($e,{textAlign:"center",p:"0px",children:e.jsxs(P,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(ms,{coinA:{amount:W(p,h==null?void 0:h.decimals).toString()||"0",...h},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:W(g,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(K,{isLoaded:!!o,children:e.jsx(le,{info:{pay_coin:h,target_coin:a,price:s,reseverPrice:c}})})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expires in"}),e.jsx(_,{color:"text_caption",children:l})]}),e.jsx(Y,{borderRadius:"12px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(Y,{borderRadius:"12px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(I,{onClick:()=>{m(),r()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},Ps=({isOpen:t,onClose:n})=>{const{isApp:r}=re(),{setCustomExpiresVal:m,setExpiresIn:x}=ae(),[p,g]=d.useState(""),[h,a]=d.useState(""),o=L=>{const O=L.target.value.replace(/[^\d]/g,"");g(O)},l=L=>{const O=L.target.value.replace(/[^\d]/g,"");a(O)},[i,s]=d.useState({}),c=(L,O)=>{const v=Number(L||0)*60+Number(O||0),M=Math.floor(v/(60*24)),y=Math.floor(v%(60*24)/60),S=v%60;let w="";M>0&&(w+=M+"d "),y>0&&(w+=y+"h "),S>0&&(w+=S+"m "),s({timeText:w.trim()||"0 m",time:v*60*1e3})};d.useEffect(()=>{c(p,h)},[p,h]);const b=d.useMemo(()=>!p&&!h||Number(p)==0&&!h||Number(h)==0&&!p||Number(p)==0&&Number(h)==0,[p,h]),f=()=>{x(i==null?void 0:i.timeText),m(i==null?void 0:i.time),n()};return e.jsxs(ze,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:n,isCentered:!0,children:[e.jsx(Ne,{}),e.jsxs(De,{maxW:"1200px",w:r?"calc(100vw - 32px)":"440px",children:[e.jsx(Be,{mr:"-10px",children:e.jsxs(j,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(_,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(j,{gap:"0",align:"center",children:e.jsx(We,{mt:"0",position:"static"})})]})}),e.jsx($e,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(P,{w:"100%",children:[e.jsx(Le,{children:e.jsxs(j,{children:[e.jsx(at,{value:p,onChange:o,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(_,{children:"Hours"})]})}),e.jsx(Le,{children:e.jsxs(j,{children:[e.jsx(at,{value:h,onChange:l,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(_,{children:"Minutes"})]})}),e.jsx(I,{onClick:f,disabled:b,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function ks(t){const{expiresIn:n,setExpiresIn:r}=ae(),[m,x]=d.useState(!1),p=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(Le,{w:"156px",borderRadius:"16px",children:[e.jsxs(P,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(Ye,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(j,{gap:"4px",children:[e.jsx(_,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(ee,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(ls,{label:n||"",list:p,onListItemClick:g=>{g=="Custom"?x(!0):r(g)}})]}),m&&e.jsx(Ps,{isOpen:m,onClose:()=>x(!1)})]})}function Ms(t){re();const{marketPrice:n,priceImpactInfo:r,priceImpactInfoLoading:m,priceImpact:x,inputPrice:p,handleMarketPriceClick:g,setInputPrice:h}=t,{payCoin:a,targetCoin:o,quoteToken:l,refreshPriceLoading:i,setQuoteToken:s}=ae();return e.jsx(Le,{w:"calc(100% - 156px)",children:e.jsxs(P,{w:"100%",gap:"20px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsxs(j,{children:[e.jsx(_,{fontSize:"13px",fontWeight:"500",children:(l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${ct(o==null?void 0:o.symbol,10)} at rate`:`Sell ${ct(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!i&&(m?e.jsx(Kt,{size:"sm"}):e.jsx(Ye,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:r.tooltip}),children:e.jsxs(_,{color:r.color,children:[F(x).gt(0)?"+":"",Number(x)>1e4?">10000%":wt(x)]})}))]}),(n||i)&&e.jsx(I,{isLoading:i,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>g(!0),children:"Market"})]}),e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsx(Ot,{value:p?It(p).toString():"",onChange:c=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",p,c),g(!1),h(c)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(j,{gap:"4px",children:[e.jsx(_,{textColor:"text_caption",children:l==null?void 0:l.symbol}),e.jsx(ee,{xlinkHref:"#icon-icon_swap1",onClick:()=>{o&&a&&((l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?s(o):s(a))}})]})]})]})})}function Hs(){const{expiresIn:t}=ae(),{buttonTextStatus:n,payBalanceInfo:r,targetBalanceInfo:m,payAmountValue:x,targetAmountValue:p,payAmount:g,targetAmount:h,payCoin:a,targetCoin:o,marketPrice:l,handleAmountChange:i,handleMarketPriceClick:s,handleSelectToken:c,inputPrice:b,setInputPrice:f,priceImpact:L,quoteToken:O,handleSubmitOrder:v,submitOrderLoading:M,onReverseClick:y,priceImpactInfoLoading:S,priceImpactInfo:w}=vs(),H=d.useMemo(()=>({payAmount:g,targetAmount:h,payCoin:a,targetCoin:o,inputPrice:b,expiresIn:t,quoteToken:O}),[g,h,a,o,b,t,O]),{onWalletModal:N}=se(),[E,Q]=d.useState("#icon-a-icon_trade"),D=C=>Q(C?"#icon-icon_swap1":"#icon-a-icon_trade"),[V,T]=d.useState(!1),$=_t(),k=d.useMemo(()=>{const C=[];return a&&C.push(a),o&&C.push(o),C},[a,o]);return e.jsxs(P,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(ps,{currTradeTab:xs.Limit}),e.jsx(ds,{})]}),e.jsx(os,{onClick:y,from:{title:"You Pay",balance:(r==null?void 0:r.balanceFormat)||"",value:g,amountValue:x,onChange:C=>{i(C,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:C=>{c(C,!0)}},to:{title:"You Receive",balance:(m==null?void 0:m.balanceFormat)||"",value:h,amountValue:p,onTokenChange:C=>{c(C,!1)},onChange:C=>{i(C,!1)},selectable:!0,placeholder:"0.0",token:o,half:!1,max:!1},iconParams:{xlinkHref:E,svgFill:"text_caption",transform:E==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:E==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1)}}),e.jsxs(j,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(Ms,{marketPrice:l,priceImpactInfoLoading:S,priceImpactInfo:w,priceImpact:L,inputPrice:b,setInputPrice:f,handleMarketPriceClick:s}),e.jsx(ks,{})]}),(w==null?void 0:w.text)&&l&&Number(L)!==0&&b&&e.jsxs(_,{color:w==null?void 0:w.color,lineHeight:"20px",bg:w==null?void 0:w.bg,p:"12px",borderRadius:"8px",children:[w==null?void 0:w.text,"Â ",e.jsx(_,{color:w==null?void 0:w.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>$(`/swap/${a==null?void 0:a.coin_type}/${o==null?void 0:o.coin_type}`),children:"Cetus Swap"}),"Â instead."]}),e.jsx(I,{disabled:(n==null?void 0:n.disabled)||M,isLoading:M,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(n==null?void 0:n.text)=="Connect Wallet"?()=>N(!0):()=>T(!0),children:n==null?void 0:n.text}),V&&e.jsx(Ts,{confirmData:H,isOpen:V,onClose:()=>T(!1),handleSubmitOrder:v,submitOrderLoading:M}),(a||o)&&e.jsx(cs,{addToken:!0,tokensInfo:k,waringModalCancel:C=>{C.forEach(q=>{(q.coin_type===(a==null?void 0:a.coin_type)||q.coin_type===(o==null?void 0:o.coin_type))&&c(void 0,q.coin_type===(a==null?void 0:a.coin_type))})}})]})}function Es({orderInfo:t}){return e.jsxs(Oe.Fragment,{children:[e.jsxs(U,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(be,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(le,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(_e,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(Fe,{orderInfo:t})})]}),e.jsx(U,{h:"16px"})]},t==null?void 0:t.order_id)}function As(){const{currentAccount:t,onWalletModal:n}=se(),{myOrderList:r,orderListLoading:m}=Pe(),x=10,[p,g]=d.useState([]),[h,a]=d.useState(0),[o,l]=d.useState(1);return d.useEffect(()=>{if((r==null?void 0:r.length)>0){a(r==null?void 0:r.length);const i=(o-1)*x,s=i+x;g(r.slice(i,s))}},[o,r]),e.jsxs(jt,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(bt,{children:e.jsxs(U,{children:[e.jsx(X,{children:"Order Info"}),e.jsx(X,{textAlign:"right",children:"Price"}),e.jsx(X,{textAlign:"right",children:"Filled Size"}),e.jsx(X,{textAlign:"right",children:"Expiry"}),e.jsx(X,{textAlign:"right",children:"Action"})]})}),e.jsx(ft,{children:t!=null&&t.address?m?e.jsx(vt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):r.length===0?e.jsx(U,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(Oe.Fragment,{children:[p.map(i=>e.jsx(Es,{orderInfo:i},i.order_id)),!m&&(r==null?void 0:r.length)>x&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(je,{w:"100%",children:e.jsx(ve,{total:h,size:x,currentPage:o,onChange:l})})})]}):e.jsx(U,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nowallet",onboard:()=>{n(!0)},borderRadius:"16px"})})})})]})}function Rs(){const{fetchByApi:t}=es(),{getTokenListInfo:n}=Qe(),{currentAccount:r}=se(),[m,x]=d.useState(!1),[p,g]=d.useState([]);d.useEffect(()=>{g([])},[r==null?void 0:r.address]);const h=async(o,l)=>{var i;try{l&&x(!0);const s=await t(ts,"GET",{wallet_address:o});if(console.log(s,"getLimitOrderHistory"),s!=null&&s.list&&((i=s==null?void 0:s.list)==null?void 0:i.length)>0){const c=await a((s==null?void 0:s.list)||[]);return g(c),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",c),c}return[]}catch(s){return console.log("getLimitOrderHistory ~ error:",s),[]}finally{x(!1)}},a=async o=>{const l=[],i=[];for(const c of o)i.push(ne(c.pay_coin,!1)),i.push(ne(c.target_coin,!1));const s=await n(i);for(const c of o){const[b,f]=[s==null?void 0:s.get(ne(c.pay_coin,!1)),s==null?void 0:s.get(ne(c.target_coin,!1))];if(b&&f){const{total_pay_amount:L,remaining_amount:O,rate:v,obtained_amount:M,claimed_amount:y,target_balance:S,created_ts:w,expire_ts:H,cancel_reason:N,events:E}=c,Q=E;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",c,Q),Q.sort((C,q)=>q.block_time-C.block_time);const D=ie(L,b.decimals).toString(),V=Ct.rateToPrice(v.toString(),b.decimals,f.decimals),T=Z(1).div(V).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",V,T);const $=ie(Z(L).sub(O).toFixed(0),b.decimals).toString(),k={order_id:c.order_id,pay_coin:b,target_coin:f,price:V,reseverPrice:T,total_pay_amount:D,remaining_amount:O,deal_amount:$,deal_rate:Z($).div(D).toString(),expect_obtain_amount:Z(D).mul(V).toString(),obtained_amount:M,claimed_amount:y,un_claimed_amount:"0",created_ts:w,expire_ts:H,status:Number(N)===0?Se.Completed:Se.Cancelled,events:Q};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",k),l.push(k)}}return l.sort((c,b)=>b.created_ts=c.created_ts),l};return{getLimitOrderHistory:h,historyOrderLoading:m,historyOrderList:p}}function ki(){const{currentAccount:t}=se(),{getLimitOrderHistory:n,historyOrderList:r,historyOrderLoading:m}=Rs(),{fetchMyLimitOrder:x}=ke(),{setMyOrderList:p,myOrderList:g,orderListLoading:h}=Pe(),{payCoin:a,targetCoin:o}=ae(),{fetchAccountBalance:l}=Te();d.useEffect(()=>{t!=null&&t.address&&l()},[]);const{isShowTradeChart:i,isShowTradeOrders:s}=us(),[c,b]=d.useState([]),[f,L]=d.useState({label:"Open Orders"}),O=d.useMemo(()=>{console.log("ðŸš€ ~ Limit ~ myOrderList:",g);const E=[];return E.push({label:"Open Orders",num:f.label==="Open Orders"&&g.length>0&&!h?g.length.toString():void 0}),E.push({label:"Order History",num:f.label==="Order History"&&c.length>0&&!m?c.length.toString():void 0}),E},[f.label,g,c,m,h]);d.useEffect(()=>{v(!0)},[f.label,t,s]),js({onRpcChange:()=>{v(!0),t!=null&&t.address&&l()}});const v=E=>{s&&(N(0),console.log("ðŸš€  ~ currentAccount:",f.label==="Open Orders",t==null?void 0:t.address),t!=null&&t.address&&(f.label==="Open Orders"?x(t.address,E):(console.log("ðŸš€ ~  ~ currentAccount:",t),n(t.address,E))))};d.useEffect(()=>{t!=null&&t.address&&(r==null?void 0:r.length)>0?b(r):(b([]),p([]))},[r,t==null?void 0:t.address]);const M=E=>{L(E)},{windowWidth:y,isApp:S}=re(),{refreshCoinMarketPrice:w}=Ht(),[H,N]=d.useState(0);return hs({interval:1e3,callback:()=>{N(H+1),H>=20&&(N(0),w(),t!=null&&t.address&&l(),v(!1))}}),e.jsxs(P,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:S||i||s?"":"bg_img",children:[e.jsxs(j,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:i?"column":"column-reverse",lg:"row"},children:[(s||i)&&e.jsx(j,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:i?e.jsx(gs,{baseToken:a,quoteToken:o}):e.jsxs(P,{w:"100%",children:[e.jsx(mt,{tabList:O,currTab:f,myOrderList:g,handleChangeTab:M,handleGetOrderList:v}),f.label==="Open Orders"&&e.jsx(xt,{}),f.label==="Order History"&&e.jsx(ut,{historyOrderList:c,historyOrderLoading:m})]})}),e.jsx(Hs,{})]}),s&&i&&e.jsxs(P,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(mt,{handleGetOrderList:()=>v(!0),tabList:O,currTab:f,myOrderList:g,handleChangeTab:M}),S&&e.jsx(ht,{h:"16px"}),f.label==="Open Orders"&&(S?e.jsx(xt,{}):e.jsx(As,{})),f.label==="Order History"&&(S?e.jsx(ut,{historyOrderList:c,historyOrderLoading:m}):e.jsx(Cs,{historyOrderList:c,historyOrderLoading:m}))]})]})}const mt=({tabList:t,currTab:n,myOrderList:r,handleChangeTab:m,handleGetOrderList:x})=>{const{handleCancelOrder:p,cancelOrderLoading:g}=kt(),{isApp:h}=re(),a=n.label==="Open Orders"&&r.length>1;return e.jsxs(j,{w:"100%",justifyContent:"space-between",flexDirection:{base:n.label==="Open Orders"&&r.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(j,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(Lt,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:n.label,handleChangeTab:m}),h&&e.jsx(pt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),(!h||a)&&e.jsxs(j,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(I,{onClick:()=>{p(r)},disabled:g,isLoading:g,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!h&&e.jsx(pt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]})};export{ki as default};
//# sourceMappingURL=Limit-B2gdxDeS.js.map
