import{j as e,H as j,a0 as $t,T as b,Y as N,Z as Ae,bo as ct,e as lt,r as p,b as re,W as U,V as T,I,c as Ee,X as Me,U as dt,a1 as X,R as Se,bp as _e,bq as ne,br as pt,aO as K,d as F,ae as Re,af as Fe,ag as ze,ah as Ne,ai as xt,aj as De,ak as Be,k as ut,am as mt,$ as ee,S as q,g as Vt,C as ae,a3 as Xe,B as gt,a$ as Ce,aa as we,a5 as We,a as ht,bc as Yt,a9 as qe,al as Ie,as as et,l as Ut,ab as Gt,u as Qt,a2 as Jt}from"./index-BcNGwLrK.js";import{P as Le}from"./Pagination-D27b5weN.js";import{N as te}from"./NoData-Dz8lPrBG.js";import{u as Kt}from"./RangeValue-BQ7Nvz-a.js";import{u as he}from"./useAccountBalance-BrVw4-U4.js";import{u as me}from"./useTransaction-DC6wdpVV.js";import{u as $e}from"./useToken-DXKcTUhY.js";import{C as ge}from"./CetusTooltip-BNvdxWOU.js";import{S as Zt}from"./SingleTokenInfo-BQLzzRRp.js";import{b as jt}from"./FarmsTable-DQmRoRmT.js";import{a as G,b as z,c as bt,d as ft,e as Z,T as _t}from"./tr-BLmb-ReS.js";import{A as Xt}from"./aggregator-Bm0e2atI.js";import{u as qt,A as tt}from"./useFindBestRouting-CCGY2t7C.js";import{u as st}from"./useTokenBalance-DfhR4t56.js";import{u as It}from"./useInsufficientBalanceToast-B-IxWgw7.js";import{u as wt}from"./global-BTFbAXTs.js";import{I as it}from"./IconBg-BWNLvmW1.js";import{T as es}from"./TradeInputGroup-C6tZ282_.js";import{W as ts}from"./WarningTokenTipModal-DbL7reaI.js";import{T as ss,a as is,L as ns}from"./LimitPriceChart-1PKJoIHz.js";import"./Swap-dj6nShvw.js";import{T as rs}from"./TradeConfirmAmountInfo-B7QLkhLB.js";import{I as ye}from"./InputBox-jApi5KS2.js";import{M as as,F as os}from"./MenuDropBlock-BcHMVtBE.js";import{L as cs}from"./api-data-utils-CdGXOKL3.js";import{u as ls}from"./useRpcListener-aLb2nNkO.js";import"./AddressCopyLink-DbwV-boc.js";import"./AddressUnderline-m81qB_am.js";import"./usePositionList-ClfGYfIY.js";import"./useGetPoolList-T54lS1Pj.js";import"./AprTooltip-Byc9-jP4.js";import"./generateCategoricalChart-CxVPLjPj.js";import"./debounce-CX1VLpbY.js";import"./throttle-DpK58b_A.js";import"./index-BikKgE_T.js";import"./ExpendItem-C3Qk4uRQ.js";import"./msafe-oYBkW7LJ.js";import"./PriceRange-CP0m5ZaY.js";import"./PositionStatus-DjYxOS9p.js";import"./CoinPairInfo-Bu8FrDH8.js";import"./_getAllKeysIn-qgRe5Oek.js";import"./SwapConfirmBlock-D3QNFLNb.js";import"./index-CmigsJod.js";import"./CurrentPrice-DkEMH2i1.js";import"./HighlightText-DF-e4i1G.js";import"./HTextLabelBox-CIlBSc6E.js";import"./swap-BbRo5cp9.js";import"./Slippage-CpdSFVrz.js";import"./TooltipIcon-D9b6rWIU.js";import"./switch-fLn16X8M.js";import"./index-CmVHNqiw.js";import"./circular-progress-NdSpOXav.js";import"./progress.utils-BiNCSLXH.js";import"./usePreviousValue-CpwomGQd.js";const je=({info:t,imgSize:r="32px"})=>{const{pay_coin:n,target_coin:u,total_pay_amount:x,expect_obtain_amount:o}=t;return e.jsxs(j,{children:[e.jsx($t,{w:r,h:r,coinAIconUrl:n.logo_url,coinBIconUrl:u.logo_url}),e.jsxs(b,{color:"text_caption",children:[N(x)," ",n.symbol," â†’ ",N(o)," ",u.symbol]})]})},be=({info:t})=>e.jsx(j,{justifyContent:"end",gap:"2px",children:e.jsxs(b,{color:"text_caption",children:[Ae(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),fe=({info:t})=>{const{pay_coin:r,total_pay_amount:n,deal_amount:u,deal_rate:x}=t;return e.jsxs(j,{justifyContent:"end",gap:"2px",children:[e.jsxs(b,{color:"text_caption",children:[N(u),"/",N(n)," ",r.symbol]}),e.jsxs(b,{color:"primary_gray",children:["(",ct(Number(x)*100),")"]})]})},yt=({historyInfo:t,type:r,...n})=>{const{getExplorerUrl:u}=lt(),{pay_coin:x,target_coin:o}=t,m=p.useMemo(()=>(t==null?void 0:t.events)||[],[t]),h=l=>{const c=l==null?void 0:l.event_type;return c.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${N(Me(l==null?void 0:l.amount,x==null?void 0:x.decimals))}`}:c.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:o,num:`+${N(Me(l==null?void 0:l.amount,o==null?void 0:o.decimals))}`}:c.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${N(Me(l==null?void 0:l.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=re();return e.jsx(U,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...n,children:e.jsx(T,{align:"flex-start",children:m.map(l=>{const{tokenInfo:c,text:s,icon:i,color:d,num:_}=h(l);return e.jsxs(T,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(j,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(j,{gap:r=="card"?"4px":"8px",flexDirection:r=="card"?"column":"row",align:r=="card"?"flex-start":"center",children:[e.jsxs(j,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(I,{svgW:"14px",xlinkHref:i,svgFill:d,svgHover:d}),e.jsx(b,{color:d,children:s})]}),!a&&e.jsxs(b,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[_,"Â ",c==null?void 0:c.symbol]})]}),e.jsxs(j,{gap:r=="card"?"4px":"20px",flexDirection:r=="card"&&!a?"column":"row",align:r=="card"?"flex-end":"center",children:[e.jsxs(b,{h:"20px",lineHeight:"20px",children:[Ae(Number(l.block_time),"")," (UTC)"]}),e.jsxs(j,{gap:"4px",cursor:"pointer",onClick:w=>{Ee(w),window.open(u(l.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(b,{color:"text_caption",children:"View Transaction"}),e.jsx(I,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(b,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[_,"Â ",c==null?void 0:c.symbol]})]},l==null?void 0:l.tx)})})})},xe=({info:t})=>{const[r,n]=p.useState(!0),{getTokenRank:u}=Kt();p.useEffect(()=>{const a=u(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),n(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:o,price:m,reseverPrice:h}=t;return e.jsxs(j,{justifyContent:"end",children:[r?e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(b,{color:"text_caption",lineHeight:"1",children:N(m)}),e.jsxs(b,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[o.symbol," per ",x.symbol]})]}):e.jsxs(j,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(b,{color:"text_caption",children:N(h)}),e.jsxs(b,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",o.symbol]})]}),e.jsx(I,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{Ee(a),n(!r)}})]})},St=({historyInfo:t,openExpendItemObj:r})=>e.jsxs(j,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(I,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(I,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(b,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(I,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:r[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),ds=(t,r)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:n=>{t(()=>({orderListLoading:n}))},setMyOrderList:n=>{t(()=>({myOrderList:n}))}}),ve=dt(ds);function Oe(){const{currentAccount:t,addressChangeVersion:r}=X(),{peripherySdk:n}=Se(),{setOrderListLoading:u,setMyOrderList:x,myOrderList:o,orderListLoading:m}=ve(),{fetchTokenInfo:h}=$e(),a=async(c=t==null?void 0:t.address,s)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",c);try{if(!c){u(!1),x([]);return}s&&u(!0);const i=await n.LimitOrder.getOwnerLimitOrderList(c,"all"),d=await l(i.data.filter(_=>_.status===_e.PartialCompleted||_.status===_e.Running));x(d),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",d)}catch(i){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",i)}finally{u(!1)}},l=async c=>{const s=[];for(const i of c){const[d,_]=await Promise.all([h(i.pay_coin_type),h(i.target_coin_type)]);if(d&&_){const{total_pay_amount:w,pay_balance:O,rate:C,obtained_amount:v,claimed_amount:P,target_balance:y,created_ts:S,expire_ts:f,status:M,id:H}=i,$=ne(w,d.decimals).toString(),D=ne(O,d.decimals).toString(),V=ne(v,_.decimals).toString(),Q=ne(P,_.decimals).toString(),L=ne(y,_.decimals).toString(),Y=pt.rateToPrice(C.toString(),d.decimals,_.decimals),k=K(1).div(Y).toString(),B=ne(K(w).sub(O).toFixed(0),d.decimals).toString(),ce={order_id:H,pay_coin:d,target_coin:_,price:Y,reseverPrice:k,total_pay_amount:$,expect_obtain_amount:K($).mul(Y).toString(),remaining_amount:D,deal_amount:B,deal_rate:K(B).div($).toString(),obtained_amount:V,claimed_amount:Q,un_claimed_amount:K(L).sub(Q).toString(),created_ts:S,expire_ts:f,status:M};s.push(ce)}}return s.sort((i,d)=>d.created_ts-i.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:m,myOrderList:o}}function Ct(){const{fetchAccountBalance:t}=he(),{fetchMyLimitOrder:r}=Oe(),{signAndExecuteTransaction:n}=me(),{peripherySdk:u}=Se(),[x,o]=p.useState(!1),{transactionConfirmation:m}=me();return{handleCancelOrder:async a=>{o(!0);const l={getShowInfo:d=>{const _="Canceling order",w={modalDescriptionText:_,toastTitleText:_};return d==="success"&&(w.toastDescriptionContent="Order cancelled successfully",w.modalDescriptionText="Order cancelled successfully",w.toastTitleText="Order cancelled"),w}};m(l);const c=a.map(d=>({pay_coin_type:d.pay_coin.coin_type,target_coin_type:d.target_coin.coin_type,order_id:d.order_id})),s=await u.LimitOrder.cancelOrdersByOwner(c),i=await n(s,l);o(!1),i&&setTimeout(()=>{t(),r()},2e3)},cancelOrderLoading:x}}function ps(){const{fetchAccountBalance:t}=he(),{fetchMyLimitOrder:r}=Oe(),{signAndExecuteTransaction:n}=me(),{peripherySdk:u}=Se(),[x,o]=p.useState(!1),[m,h]=p.useState(!1);return{handleClaimOrder:async(c,s)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",c),o(!0);const i={pay_coin_type:c.pay_coin.coin_type,target_coin_type:c.target_coin.coin_type,order_id:c.order_id},d=await u.LimitOrder.claimTargetCoin(i),_=await n(d,{getShowInfo:(w,O)=>{var P;const C=`Claim ${N(s)} ${(P=c==null?void 0:c.target_coin)==null?void 0:P.symbol}`,v={modalDescriptionText:C,toastTitleText:C};return w==="success"&&(v.toastDescriptionContent="",v.modalDescriptionText="",v.toastTitleText="Claim successfully"),v}});o(!1),_&&setTimeout(()=>{t(),r()},2e3)},getLimitOrderClaimHistory:async c=>{h(!0);const s=await u.LimitOrder.getLimitOrderClaimLogs(c.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",c,s),s?(h(!1),s.map(i=>{var _;const d=F(i.parsedJson.claimed_amount).div(Math.pow(10,(_=c.target_coin)==null?void 0:_.decimals));return{...i,...i.parsedJson,claimed_amount:d}})):[]},isClaimHistoryLoading:m,claimLoading:x}}const xs=({orderInfo:t,isOpen:r,onClose:n,handleClaim:u,claimLoading:x,getLimitOrderClaimHistory:o,isClaimHistoryLoading:m})=>{const{getExplorerUrl:h}=lt(),[a,l]=p.useState(""),[c,s]=p.useState([]),[i,d]=p.useState({label:"Claim",value:"claim"}),_=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],w=y=>{d(y),(y==null?void 0:y.value)=="history"&&O()},O=async()=>{const y=await o();y&&s(y)},C=p.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:F(a).gt(t.un_claimed_amount)||F(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[v,P]=p.useState(!0);return p.useEffect(()=>{v&&(P(!1),l(t.un_claimed_amount))},[v,t.un_claimed_amount]),e.jsxs(Re,{autoFocus:!1,returnFocusOnClose:!1,isOpen:r,onClose:n,isCentered:!0,children:[e.jsx(Fe,{}),e.jsxs(ze,{children:[e.jsx(Ne,{children:e.jsx(xt,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(De,{}),e.jsx(Be,{textAlign:"center",p:"0px",children:e.jsxs(T,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(je,{info:t,imgSize:"28px"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(xe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(be,{info:t})]}),e.jsx(ut,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:_,currentTab:i.label,handleChangeTab:w}),(i==null?void 0:i.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(T,{gap:"16px",align:"flex-start",children:[e.jsx(b,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(mt,{value:a?N(a).toString():"",onChange:y=>{l(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(j,{children:e.jsx(Zt,{portal:!1,token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(ee,{onClick:()=>{u(a),n()},disabled:C.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:C.text})]}),(i==null?void 0:i.value)=="history"&&e.jsx(T,{w:"100%",gap:"12px",children:m?e.jsxs(U,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(j,{justify:"space-between",children:[e.jsx(q,{height:"4",width:"150px"}),e.jsx(q,{height:"4",width:"150px"})]}),e.jsxs(j,{justify:"space-between",mt:"16px",children:[e.jsx(q,{height:"4",width:"150px"}),e.jsx(q,{height:"4",width:"150px"})]})]},history==null?void 0:history.id):(c==null?void 0:c.length)==0?e.jsx(te,{type:"nodata",text:"No History.",p:"20px"}):c==null?void 0:c.map(y=>{var S,f;return e.jsx(U,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(T,{gap:"16px",align:"flex-start",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Amount"}),e.jsxs(j,{gap:"4px",children:[e.jsx(Vt,{imageUrl:(S=t==null?void 0:t.target_coin)==null?void 0:S.logo_url,w:"20px",h:"20px"}),e.jsxs(b,{color:"text_caption",lineHeight:"18px",children:[N(y==null?void 0:y.claimed_amount)," ",(f=t==null?void 0:t.target_coin)==null?void 0:f.symbol]})]})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Time"}),e.jsxs(j,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:M=>{Ee(M),window.open(h(y.digest,"tx"))},children:[e.jsxs(b,{color:"text_caption",children:[Ae(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(I,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},He=({orderInfo:t})=>{const{handleCancelOrder:r,cancelOrderLoading:n}=Ct(),{handleClaimOrder:u,claimLoading:x,getLimitOrderClaimHistory:o,isClaimHistoryLoading:m}=ps(),[h,a]=p.useState(),[l,c]=p.useState(!1),s=(i,d)=>{a(i),d==="cancel"&&r([i]),d==="claim"&&c(!0)};return re(),e.jsxs(j,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[F(t==null?void 0:t.obtained_amount).lte(0)&&F(t.un_claimed_amount).lte(0)?e.jsx(ge,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(ae,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(ee,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(ee,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||s(t,"claim")},children:"Claim"}),e.jsx(ee,{isLoading:n,disabled:n,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{n||s(t,"cancel")},children:"Cancel"}),l&&e.jsx(xs,{orderInfo:t,claimLoading:x,isOpen:l,onClose:()=>c(!1),handleClaim:i=>u(t,i),getLimitOrderClaimHistory:()=>o(t),isClaimHistoryLoading:m})]})};function nt(){const{currentAccount:t,onWalletModal:r}=X(),{myOrderList:n,orderListLoading:u}=ve();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",n);const x=10,[o,m]=p.useState([]),[h,a]=p.useState(0),[l,c]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){a(n==null?void 0:n.length);const s=(l-1)*x,i=s+x;m(n.slice(s,i))}},[l,n]),e.jsx(T,{w:"100%",children:t!=null&&t.address?u?e.jsx(U,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(T,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,i)=>e.jsx(Lt,{},i))})}):n.length===0?e.jsx(te,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(U,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(o==null?void 0:o.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(T,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:o==null?void 0:o.map(s=>e.jsx(us,{orderInfo:s},s==null?void 0:s.order_id))}),!u&&(n==null?void 0:n.length)>x&&e.jsx(ae,{mt:"12px",children:e.jsx(Le,{total:h,size:x,currentPage:l,onChange:c})})]}):e.jsx(te,{type:"nowallet",onboard:()=>r(!0),borderRadius:"16px"})})}const us=({orderInfo:t})=>{const{isApp:r}=re();return e.jsxs(T,{w:"100%",gap:"16px",children:[e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(je,{info:t,imgSize:"28px"}),!r&&e.jsx(He,{orderInfo:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(xe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(be,{info:t})]}),r&&e.jsx(He,{orderInfo:t})]})},Lt=()=>e.jsxs(T,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(j,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(j,{gap:"0",children:[e.jsxs(j,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(Xe,{size:"8"}),e.jsx(Xe,{size:"8"})]}),e.jsx(q,{height:"4",width:"100px"})]})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(q,{height:"4",width:"180px"}),e.jsx(q,{height:"4",width:"150px"})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(q,{height:"4",width:"180px"}),e.jsx(q,{height:"4",width:"150px"})]})]});function rt(t){const{historyOrderList:r,historyOrderLoading:n}=t,{currentAccount:u,onWalletModal:x}=X();console.log("ðŸš€ ~ OrderTableList ~ historyOrderList:",r);const o=10,[m,h]=p.useState([]),[a,l]=p.useState(0),[c,s]=p.useState(1);return p.useEffect(()=>{if((r==null?void 0:r.length)>0){l(r==null?void 0:r.length);const i=(c-1)*o,d=i+o;h(r.slice(i,d))}},[c,r]),e.jsx(T,{w:"100%",children:u!=null&&u.address?n?e.jsx(U,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(T,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((i,d)=>e.jsx(Lt,{},d))})}):r.length===0?e.jsx(te,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(U,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(m==null?void 0:m.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(T,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:m==null?void 0:m.map(i=>e.jsx(ms,{historyInfo:i},i==null?void 0:i.order_id))}),!n&&(r==null?void 0:r.length)>o&&e.jsx(ae,{mt:"12px",children:e.jsx(Le,{total:a,size:o,currentPage:c,onChange:s})})]}):e.jsx(te,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const ms=({historyInfo:t})=>{const[r,n]=p.useState({});return e.jsxs(T,{w:"100%",gap:"16px",children:[e.jsx(j,{w:"100%",justify:"space-between",children:e.jsx(je,{info:t,imgSize:"28px"})}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Limit Price"}),e.jsx(xe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expiry"}),e.jsx(be,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Status"}),e.jsx(gt,{cursor:"pointer",onClick:()=>{r[t==null?void 0:t.order_id]?r[t==null?void 0:t.order_id]=!1:r[t==null?void 0:t.order_id]=!0,n({...r})},children:e.jsx(St,{historyInfo:t,openExpendItemObj:r})})]}),r[t==null?void 0:t.order_id]&&e.jsx(yt,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function gs({historyInfo:t}){const[r,n]=p.useState({});return e.jsxs(Ce.Fragment,{children:[e.jsxs(G,{cursor:"pointer",onClick:()=>{r[t==null?void 0:t.order_id]?r[t==null?void 0:t.order_id]=!1:r[t==null?void 0:t.order_id]=!0,n({...r})},sx:{td:{pb:r[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(je,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(xe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(be,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(St,{historyInfo:t,openExpendItemObj:r})})]}),!r[t==null?void 0:t.order_id]&&e.jsx(G,{h:"16px"}),e.jsx(G,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:r[t==null?void 0:t.order_id]&&e.jsx(z,{colSpan:5,children:e.jsx(yt,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function hs(t){const{historyOrderList:r,historyOrderLoading:n}=t;console.log("ðŸš€ ~ HistoryTableList ~ historyOrderList:",r);const{currentAccount:u,onWalletModal:x}=X(),o=10,[m,h]=p.useState([]),[a,l]=p.useState(0),[c,s]=p.useState(1);return p.useEffect(()=>{if((r==null?void 0:r.length)>0){l(r==null?void 0:r.length);const i=(c-1)*o,d=i+o;h(r.slice(i,d))}},[c,r]),e.jsxs(bt,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(ft,{children:e.jsxs(G,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Limit Price"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Status"})]})}),e.jsx(_t,{children:u!=null&&u.address?n?e.jsx(jt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):r.length===0?e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(Ce.Fragment,{children:[m.map(i=>e.jsx(gs,{historyInfo:i},i.order_id)),!n&&(r==null?void 0:r.length)>o&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(ae,{w:"100%",children:e.jsx(Le,{total:a,size:o,currentPage:c,onChange:s})})})]}):e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const js=(t,r)=>({quoteToken:void 0,payCoin:we.clmm_swap.from_coin,targetCoin:we.clmm_swap.to_coin,setPayCoin:n=>{t(()=>({payCoin:n}))},setTargetCoin:n=>{t(()=>({targetCoin:n}))},setQuoteToken:n=>{t(()=>({quoteToken:n}))},expiresIn:"7 Days",setExpiresIn:n=>{t(()=>({expiresIn:n}))},customExpiresVal:null,setCustomExpiresVal:n=>{t(()=>({customExpiresVal:n}))},refreshPriceLoading:!1,setRefreshPriceLoading:n=>{t(()=>({refreshPriceLoading:n}))}}),oe=dt(js);function bs(t,r){const{getTokenPrice:n}=We(),u=n(t),x=n(r),o=p.useMemo(()=>{if(u&&x){const m=K(u.price).div(x.price).toString(),h=m.toString();return{price:m,displayPrice:h}}},[u,x]);return{price:o==null?void 0:o.price,displayPrice:o==null?void 0:o.displayPrice}}function vt(){const{payCoin:t,targetCoin:r,setRefreshPriceLoading:n}=oe(),{fetchTokenPrices:u}=We();return{refreshCoinMarketPrice:()=>{const o=[];t&&o.push(t.coin_type),r&&o.push(r.coin_type),o.length>0&&(n(!0),u(o).finally(()=>{n(!1)}))}}}function fs(){const{refreshCoinMarketPrice:t}=vt(),{fetchAccountBalance:r}=he(),{fetchMyLimitOrder:n}=Oe(),{signAndExecuteTransaction:u}=me(),{peripherySdk:x}=Se(),{findBestRouters:o}=qt(),{getTokenAmountValue:m}=We(),h=ht(),{pay:a,target:l}=Yt(),{getTokenInfo:c}=$e(),{payCoin:s,targetCoin:i,quoteToken:d,expiresIn:_,setPayCoin:w,setTargetCoin:O,setQuoteToken:C,customExpiresVal:v,setExpiresIn:P,setRefreshPriceLoading:y}=oe(),[S,f]=p.useState(""),[M,H]=p.useState(""),[$,D]=p.useState(!0),[V,Q]=p.useState(!0),[L,Y]=p.useState(""),{displayPrice:k}=bs((d==null?void 0:d.coin_type)===(s==null?void 0:s.coin_type)?i==null?void 0:i.coin_type:s==null?void 0:s.coin_type,d==null?void 0:d.coin_type),{balanceInfo:B}=st(s),{balanceInfo:ce}=st(i),Te=m(s==null?void 0:s.coin_type,S),ke=m(i==null?void 0:i.coin_type,M),[se,A]=p.useState(""),le=p.useRef(se);p.useEffect(()=>{le.current=se},[se]);const[de,Ve]=p.useState(void 0),[Ot,Ye]=p.useState(""),Tt=p.useRef(S),kt=p.useRef(M);p.useEffect(()=>{Tt.current=S},[S]),p.useEffect(()=>{kt.current=M},[M]),p.useEffect(()=>{w(c(a)||we.clmm_swap.from_coin),O(c(l)||we.clmm_swap.to_coin)},[a,l]),p.useEffect(()=>{if(Ve(void 0),t(),Pt(),s&&i){const g=s.extensions&&s.extensions.rank||"0",E=i.extensions&&i.extensions.rank||"0";console.log("ðŸš€ ~ useEffect ~ payCoinRank:",s,i),F(g).gte(E)?C({...s}):C({...i})}},[s==null?void 0:s.coin_type,i==null?void 0:i.coin_type]);const Pt=async()=>{if(s&&i){const g=`${s.coin_type}_${i.coin_type}`;A(g);const E=Object.entries(Xt).map(([W,ie])=>ie.id),J=await o({fromToken:s,toToken:i,amount:qe(1,s.decimals).toFixed(0),providersKeys:E,by_amount_in:!0,uuid:g});g===le.current&&Ve(J)}};p.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",V,k),V?Y(k||""):Ge()},[k]),p.useEffect(()=>{d&&!V&&+L&&Y(N(F(1).div(L).toFixed(d.decimals)).toString())},[d]),p.useEffect(()=>{Qe($?S:M,$),Ge()},[L]);const[Mt,Ht]=p.useState({tooltip:"",color:"",text:"",bg:""}),[At,Ue]=p.useState(!1),Ge=()=>{var g,E;if(!V&&k&&L){Ue(!0);const J=F(L).sub(k).div(k).mul(100).toFixed(2);Ye(J);const W=F(J).gt(0),ie=W?J:J.split("-")[1],R={tooltip:"",color:"",text:"",bg:""};R.tooltip=`Limit order price is ${ie}% ${W?"higher":"lower"} than the market.`,((g=d==null?void 0:d.coin_type)==null?void 0:g.toLowerCase())==((E=i==null?void 0:i.coin_type)==null?void 0:E.toLowerCase())?Number(L)>Number(k)?(R.text="",R.color="#68FFD8"):Number(k)>Number(L)&&(R.text=`Your limit order price is ${ie}% ${W?"higher":"lower"} than market. You are selling at a much ${W?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(L)>Number(k)?(R.text=`Your limit order price is ${ie}% ${W?"higher":"lower"} than market. You are buying at a much ${W?"higher":"lower"} rate. We recommend you to use`,R.color="#ffb62d",R.bg="rgba(255,202,104,0.1)"):Number(k)>Number(L)&&(R.text="",R.color="#68FFD8"),Ht(R),Ue(!1);return}Ye("")},Et=(g=!0)=>{console.log("ðŸš€ ~ handleMarketPriceClick ~ marketPrice:",k),Q(g),g&&(Y(k||""),t())},Qe=(g,E)=>{if(D(E),E?f(g):H(g),d&&s&&i&&+L&&+g)if(E){d.coin_type===s.coin_type?H(F(g).div(L).toString().toString()):H(F(g).mul(L).toString().toString());return}else{d.coin_type===i.coin_type?f(F(g).div(L).toString().toString()):f(F(g).mul(L).toString().toString());return}E?H(""):f("")},Je=(g,E)=>{Ke(),D(E),Q(!0),E?g.coin_type===(i==null?void 0:i.coin_type)?h(`/limit/${g==null?void 0:g.coin_type}/${s==null?void 0:s.coin_type}`):h(`/limit/${g==null?void 0:g.coin_type}/${i==null?void 0:i.coin_type}`):g.coin_type===(s==null?void 0:s.coin_type)?h(`/limit/${i==null?void 0:i.coin_type}/${g==null?void 0:g.coin_type}`):h(`/limit/${s==null?void 0:s.coin_type}/${g==null?void 0:g.coin_type}`)},Rt=async()=>{i&&(Je(i,!0),f(M),H(S))},Ke=()=>{f(""),H("")};p.useEffect(()=>()=>{P("7 Days")},[]);const[Ft,Pe]=p.useState(!1),zt=g=>{switch(g){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:Nt}=It(),{transactionConfirmation:Dt}=me(),Bt=async()=>{const g={getShowInfo:(W,ie)=>{const R="Creating order",ue={modalDescriptionText:R,toastTitleText:R};return W==="success"&&(ue.toastDescriptionContent="",ue.modalDescriptionText="Created order successfully",ue.toastTitleText="Created order successfully"),W==="rejected"&&(ue.toastTitleText="Create order"),ue}};Dt(g);const E=Date.parse(new Date().toString())+(zt(_)||v);console.log(" ~ handleSubmitOrder ~ expired_ts:",E),Pe(!0);let J;(d==null?void 0:d.coin_type)===(i==null?void 0:i.coin_type)?J=L:J=F(1).div(L).toFixed(i.decimals);try{const W={pay_coin_type:s.coin_type,target_coin_type:i.coin_type,expired_ts:E,target_decimal:i.decimals,pay_decimal:s.decimals,price:Number(J),pay_coin_amount:Number(qe(S,s.decimals).toFixed(0))},ie=await x.LimitOrder.placeLimitOrder(W),R=await u(ie,g);Pe(!1),R&&(r(),n(),Ke())}catch(W){Nt(String(W)),Pe(!1)}},{currentAccount:pe}=X(),Ze=p.useMemo(()=>{const g=m(s==null?void 0:s.coin_type,S);return Number(g)==0&&Number(S)>0?!1:Number(g)<5},[s,S]),Wt=p.useMemo(()=>{const g={text:"Place Limit Order",disabled:!1};return pe!=null&&pe.address?!s||!i?(g.disabled=!0,g.text=" Select a token",g):!Number(S)||!Number(M)?(g.disabled=!0,g.text="Enter an amount",g):Ze?(g.disabled=!0,g.text="Order size should be higher than $5",g):Number(S)>Number(B==null?void 0:B.balanceFormat)||!(B!=null&&B.balanceFormat)?(g.disabled=!0,g.text=`Insufficient ${s==null?void 0:s.symbol} balance`,g):(de&&de.errorCode&&(de.errorCode===tt.NoRouter||de.errorCode===tt.HoneyPot)&&(g.text="No Available Route",g.disabled=!0),g):(g.disabled=!1,g.text="Connect Wallet",g)},[pe==null?void 0:pe.address,s,i,de,S,M,Ze,B]);return{priceImpactInfoLoading:At,priceImpactInfo:Mt,fixPayCoin:$,onReverseClick:Rt,handleSelectToken:Je,marketPrice:k,payCoin:s,targetCoin:i,handleAmountChange:Qe,payAmount:S,targetAmount:M,payBalanceInfo:B,targetBalanceInfo:ce,payAmountValue:Te,targetAmountValue:ke,useMarketPrice:V,handleMarketPriceClick:Et,inputPrice:L,setInputPrice:Y,priceImpact:Ot,quoteToken:d,setQuoteToken:C,handleSubmitOrder:Bt,submitOrderLoading:Ft,buttonTextStatus:Wt}}const _s=({confirmData:t,isOpen:r,onClose:n,handleSubmitOrder:u,submitOrderLoading:x})=>{var _,w,O,C;const{payAmount:o,targetAmount:m,payCoin:h,targetCoin:a,inputPrice:l,expiresIn:c,quoteToken:s}=t,i=((_=s==null?void 0:s.coin_type)==null?void 0:_.toLowerCase())==((w=a==null?void 0:a.coin_type)==null?void 0:w.toLowerCase())?l:F(1).div(l).toString(),d=((O=s==null?void 0:s.coin_type)==null?void 0:O.toLowerCase())==((C=a==null?void 0:a.coin_type)==null?void 0:C.toLowerCase())?F(1).div(l).toString():l;return e.jsxs(Re,{autoFocus:!1,returnFocusOnClose:!1,isOpen:r,onClose:n,isCentered:!0,children:[e.jsx(Fe,{}),e.jsxs(ze,{children:[e.jsx(Ne,{children:e.jsx(xt,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(De,{}),e.jsx(Be,{textAlign:"center",p:"0px",children:e.jsxs(T,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(rs,{coinA:{amount:N(o,h==null?void 0:h.decimals).toString()||"0",...h},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:N(m,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Price"}),e.jsx(xe,{info:{pay_coin:h,target_coin:a,price:i,reseverPrice:d}})]}),e.jsxs(j,{w:"100%",justify:"space-between",children:[e.jsx(b,{children:"Expires in"}),e.jsx(b,{color:"text_caption",children:c})]}),e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(U,{borderRadius:"8px",p:"8px",children:e.jsx(b,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(ee,{onClick:()=>{u(),n()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},ws=({isOpen:t,onClose:r})=>{const{isApp:n}=re(),{setCustomExpiresVal:u,setExpiresIn:x}=oe(),[o,m]=p.useState(""),[h,a]=p.useState(""),l=O=>{const C=O.target.value.replace(/[^\d]/g,"");m(C)},c=O=>{const C=O.target.value.replace(/[^\d]/g,"");a(C)},[s,i]=p.useState({}),d=(O,C)=>{const v=Number(O||0)*60+Number(C||0),P=Math.floor(v/(60*24)),y=Math.floor(v%(60*24)/60),S=v%60;let f="";P>0&&(f+=P+"d "),y>0&&(f+=y+"h "),S>0&&(f+=S+"m "),i({timeText:f.trim()||"0 m",time:v*60*1e3})};p.useEffect(()=>{d(o,h)},[o,h]);const _=p.useMemo(()=>!o&&!h||Number(o)==0&&!h||Number(h)==0&&!o||Number(o)==0&&Number(h)==0,[o,h]),w=()=>{x(s==null?void 0:s.timeText),u(s==null?void 0:s.time),r()};return e.jsxs(Re,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:r,isCentered:!0,children:[e.jsx(Fe,{}),e.jsxs(ze,{maxW:"1200px",w:n?"calc(100vw - 32px)":"440px",children:[e.jsx(Ne,{mr:"-10px",children:e.jsxs(j,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(b,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(j,{gap:"0",align:"center",children:e.jsx(De,{mt:"0",position:"static"})})]})}),e.jsx(Be,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(T,{w:"100%",children:[e.jsx(ye,{children:e.jsxs(j,{children:[e.jsx(Ie,{value:o,onChange:l,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:"Hours"})]})}),e.jsx(ye,{children:e.jsxs(j,{children:[e.jsx(Ie,{value:h,onChange:c,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:"Minutes"})]})}),e.jsx(ee,{onClick:w,disabled:_,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function ys(t){const{expiresIn:r,setExpiresIn:n}=oe(),[u,x]=p.useState(!1),o=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(ye,{w:"156px",borderRadius:"16px",children:[e.jsxs(T,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(ge,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(j,{gap:"4px",children:[e.jsx(b,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(I,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(as,{label:r,list:o,onListItemClick:m=>{m=="Custom"?x(!0):n(m)}})]}),u&&e.jsx(ws,{isOpen:u,onClose:()=>x(!1)})]})}function Ss(t){re();const{marketPrice:r,priceImpactInfo:n,priceImpactInfoLoading:u,priceImpact:x,inputPrice:o,handleMarketPriceClick:m,setInputPrice:h}=t,{payCoin:a,targetCoin:l,quoteToken:c,refreshPriceLoading:s,setQuoteToken:i}=oe();return e.jsx(ye,{w:"calc(100% - 156px)",children:e.jsxs(T,{w:"100%",gap:"20px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsxs(j,{children:[e.jsx(b,{fontSize:"13px",fontWeight:"500",children:(c==null?void 0:c.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${et(l==null?void 0:l.symbol,10)} at rate`:`Sell ${et(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!s&&(u?e.jsx(Ut,{size:"sm"}):e.jsx(ge,{placement:"top",tooltip:e.jsx(b,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:n.tooltip}),children:e.jsxs(b,{color:n.color,children:[F(x).gt(0)?"+":"",Number(x)>1e4?">10000%":ct(x)]})}))]}),(r||s)&&e.jsx(ee,{isLoading:s,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>m(!0),children:"Market"})]}),e.jsxs(j,{w:"100%",justifyContent:"space-between",children:[e.jsx(mt,{value:o?Gt(o).toString():"",onChange:d=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",o,d),m(!1),h(d)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(j,{gap:"4px",children:[e.jsx(b,{textColor:"text_caption",children:c==null?void 0:c.symbol}),e.jsx(I,{xlinkHref:"#icon-icon_swap1",onClick:()=>{l&&a&&((c==null?void 0:c.coin_type)===(a==null?void 0:a.coin_type)?i(l):i(a))}})]})]})]})})}function Cs(){const{expiresIn:t}=oe(),{buttonTextStatus:r,payBalanceInfo:n,targetBalanceInfo:u,payAmountValue:x,targetAmountValue:o,payAmount:m,targetAmount:h,payCoin:a,targetCoin:l,marketPrice:c,handleAmountChange:s,handleMarketPriceClick:i,handleSelectToken:d,inputPrice:_,setInputPrice:w,priceImpact:O,quoteToken:C,handleSubmitOrder:v,submitOrderLoading:P,onReverseClick:y,priceImpactInfoLoading:S,priceImpactInfo:f}=fs(),M=p.useMemo(()=>({payAmount:m,targetAmount:h,payCoin:a,targetCoin:l,inputPrice:_,expiresIn:t,quoteToken:C}),[m,h,a,l,_,t,C]),{isShowTradeChart:H,setIsShowTradeChart:$,isShowTradeOrders:D,setIsShowTradeOrders:V}=wt(),{onWalletModal:Q}=X(),[L,Y]=p.useState("#icon-a-icon_trade"),k=A=>Y(A?"#icon-icon_swap1":"#icon-a-icon_trade"),[B,ce]=p.useState(!1),Te=ht(),ke=p.useMemo(()=>{const A=[];return a&&A.push(a),l&&A.push(l),A},[a,l]),{isApp:se}=re();return e.jsxs(T,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(j,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(ss,{currTradeTab:is.Limit}),e.jsxs(j,{children:[e.jsx(ge,{showTooltip:!se,placement:"bottom-end",tooltip:e.jsx(b,{fontSize:"12px",children:H?"Hide reference price":"View reference price"}),children:e.jsx(ae,{children:e.jsx(it,{w:"28px",h:"28px",borderRadius:"8px",variant:"",xlinkHref:"#icon-icon_kline",svgFill:H?"primary":"",svgHover:H?"primary":se?"text_paragraph":"text_caption",onClick:()=>$(!H)})})}),e.jsx(ge,{showTooltip:!se,placement:"bottom-end",tooltip:e.jsx(b,{fontSize:"12px",children:D?"Hide Orders":"View Orders"}),children:e.jsx(ae,{children:e.jsx(it,{w:"28px",h:"28px",borderRadius:"8px",variant:"",xlinkHref:"#icon-icon_order",svgFill:D?"primary":"",svgHover:D?"primary":se?"text_paragraph":"text_caption",onClick:()=>V(!D)})})})]})]}),e.jsx(es,{onClick:y,from:{title:"You Pay",balance:(n==null?void 0:n.balanceFormat)||"",value:m,amountValue:x,onChange:A=>{s(A,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:A=>{d(A,!0)}},to:{title:"You Receive",balance:(u==null?void 0:u.balanceFormat)||"",value:h,amountValue:o,onTokenChange:A=>{d(A,!1)},onChange:A=>{s(A,!1)},selectable:!0,placeholder:"0.0",token:l,half:!1,max:!1},iconParams:{xlinkHref:L,svgFill:"text_caption",transform:L==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:L==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1)}}),e.jsxs(j,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(Ss,{marketPrice:c,priceImpactInfoLoading:S,priceImpactInfo:f,priceImpact:O,inputPrice:_,setInputPrice:w,handleMarketPriceClick:i}),e.jsx(ys,{})]}),(f==null?void 0:f.text)&&c&&Number(O)!==0&&_&&e.jsxs(b,{color:f==null?void 0:f.color,lineHeight:"20px",bg:f==null?void 0:f.bg,p:"12px",borderRadius:"8px",children:[f==null?void 0:f.text,"Â ",e.jsx(b,{color:f==null?void 0:f.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>Te(`/swap/${a==null?void 0:a.coin_type}/${l==null?void 0:l.coin_type}`),children:"Cetus Swap"}),"Â instead."]}),e.jsx(ee,{disabled:(r==null?void 0:r.disabled)||P,isLoading:P,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(r==null?void 0:r.text)=="Connect Wallet"?()=>Q(!0):()=>ce(!0),children:r==null?void 0:r.text}),B&&e.jsx(_s,{confirmData:M,isOpen:B,onClose:()=>ce(!1),handleSubmitOrder:v,submitOrderLoading:P}),(a||l)&&e.jsx(ts,{addToken:!0,tokensInfo:ke,waringModalCancel:A=>{A.forEach(le=>{(le.coin_type===(a==null?void 0:a.coin_type)||le.coin_type===(l==null?void 0:l.coin_type))&&d(void 0,le.coin_type===(a==null?void 0:a.coin_type))})}})]})}function Ls({orderInfo:t}){return e.jsxs(Ce.Fragment,{children:[e.jsxs(G,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(z,{w:"30%",children:e.jsx(je,{info:t})}),e.jsx(z,{w:"20%",textAlign:"right",children:e.jsx(xe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(be,{info:t})}),e.jsx(z,{textAlign:"right",children:e.jsx(He,{orderInfo:t})})]}),e.jsx(G,{h:"16px"})]},t==null?void 0:t.order_id)}function vs(){const{currentAccount:t,onWalletModal:r}=X(),{myOrderList:n,orderListLoading:u}=ve();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",n);const x=10,[o,m]=p.useState([]),[h,a]=p.useState(0),[l,c]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){a(n==null?void 0:n.length);const s=(l-1)*x,i=s+x;m(n.slice(s,i))}},[l,n]),e.jsxs(bt,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(ft,{children:e.jsxs(G,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Price"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Action"})]})}),e.jsx(_t,{children:t!=null&&t.address?u?e.jsx(jt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(Ce.Fragment,{children:[o.map(s=>e.jsx(Ls,{orderInfo:s},s.order_id)),!u&&(n==null?void 0:n.length)>x&&e.jsx(z,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(ae,{w:"100%",children:e.jsx(Le,{total:h,size:x,currentPage:l,onChange:c})})})]}):e.jsx(G,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(z,{colSpan:5,w:"100%",children:e.jsx(te,{type:"nowallet",onboard:()=>{r(!0)},borderRadius:"16px"})})})})]})}function Os(){const{fetchByApi:t}=Qt(),{fetchTokenInfo:r}=$e(),{currentAccount:n}=X(),[u,x]=p.useState(!1),[o,m]=p.useState([]);p.useEffect(()=>{m([])},[n==null?void 0:n.address]);const h=async(l,c)=>{try{c&&x(!0);const s=await t(cs,"GET",{wallet_address:l});if(s!=null&&s.list){const i=await a((s==null?void 0:s.list)||[]);return m(i),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",i),i}}catch(s){console.log("getLimitOrderHistory ~ error:",s)}finally{x(!1)}},a=async l=>{const c=[];for(const s of l){const[i,d]=await Promise.all([r(s.pay_coin),r(s.target_coin)]);if(i&&d){const{total_pay_amount:_,remaining_amount:w,rate:O,obtained_amount:C,claimed_amount:v,target_balance:P,created_ts:y,expire_ts:S,cancel_reason:f,events:M}=s,H=M;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",s,H),H.sort((Y,k)=>k.block_time-Y.block_time);const $=ne(_,i.decimals).toString(),D=pt.rateToPrice(O.toString(),i.decimals,d.decimals),V=K(1).div(D).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",D,V);const Q=ne(K(_).sub(w).toFixed(0),i.decimals).toString(),L={order_id:s.order_id,pay_coin:i,target_coin:d,price:D,reseverPrice:V,total_pay_amount:$,remaining_amount:w,deal_amount:Q,deal_rate:K(Q).div($).toString(),expect_obtain_amount:K($).mul(D).toString(),obtained_amount:C,claimed_amount:v,un_claimed_amount:"0",created_ts:y,expire_ts:S,status:Number(f)===0?_e.Completed:_e.Cancelled,events:H};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",L),c.push(L)}}return c.sort((s,i)=>i.created_ts=s.created_ts),c};return{getLimitOrderHistory:h,historyOrderLoading:u,historyOrderList:o}}function Ti(){const{currentAccount:t}=X(),{getLimitOrderHistory:r,historyOrderList:n,historyOrderLoading:u}=Os(),{fetchMyLimitOrder:x}=Oe(),{setMyOrderList:o,myOrderList:m,orderListLoading:h}=ve(),{payCoin:a,targetCoin:l}=oe(),{fetchAccountBalance:c}=he();p.useEffect(()=>{t!=null&&t.address&&c()},[]);const{isShowTradeChart:s,isShowTradeOrders:i}=wt(),[d,_]=p.useState([]),[w,O]=p.useState({label:"Open Orders"}),C=p.useMemo(()=>{console.log("ðŸš€ ~ Limit ~ myOrderList:",m);const f=[];return f.push({label:"Open Orders",num:w.label==="Open Orders"&&m.length>0&&!h?m.length.toString():void 0}),f.push({label:"Order History",num:w.label==="Order History"&&d.length>0&&!u?d.length.toString():void 0}),f},[w.label,m,d,u,h]);p.useEffect(()=>{v(!0)},[w.label,t]),ls({onRpcChange:()=>{v(!0),t!=null&&t.address&&c()}});const v=f=>{console.log("ðŸš€ ~ getOrderList ~ currentAccount:",w.label==="Open Orders",t==null?void 0:t.address),t!=null&&t.address&&(w.label==="Open Orders"?x(t.address,f):(console.log("ðŸš€ ~ getOrderList ~ currentAccount:",t),r(t.address,f)))};p.useEffect(()=>{t!=null&&t.address&&(n==null?void 0:n.length)>0?_(n):(_([]),o([]))},[n,t==null?void 0:t.address]);const P=f=>{O(f)},{windowWidth:y,isApp:S}=re();return e.jsxs(T,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:S||s||i?"":"bg_img",children:[e.jsxs(j,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:s?"column":"column-reverse",lg:"row"},children:[(i||s)&&e.jsx(j,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:s?e.jsx(ns,{baseToken:a,quoteToken:l}):e.jsxs(T,{w:"100%",children:[e.jsx(at,{tabList:C,currTab:w,myOrderList:m,handleChangeTab:P,getOrderList:v}),w.label==="Open Orders"&&e.jsx(nt,{}),w.label==="Order History"&&e.jsx(rt,{historyOrderList:d,historyOrderLoading:u})]})}),e.jsx(Cs,{})]}),i&&s&&e.jsxs(T,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(at,{getOrderList:v,tabList:C,currTab:w,myOrderList:m,handleChangeTab:P}),S&&e.jsx(gt,{h:"16px"}),w.label==="Open Orders"&&(S?e.jsx(nt,{}):e.jsx(vs,{})),w.label==="Order History"&&(S?e.jsx(rt,{historyOrderList:d,historyOrderLoading:u}):e.jsx(hs,{historyOrderList:d,historyOrderLoading:u}))]})]})}const at=({tabList:t,currTab:r,myOrderList:n,handleChangeTab:u,getOrderList:x})=>{const{handleCancelOrder:o,cancelOrderLoading:m}=Ct(),{isApp:h}=re(),a=r.label==="Open Orders"&&n.length>1;return e.jsxs(j,{w:"100%",justifyContent:"space-between",flexDirection:{base:r.label==="Open Orders"&&n.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(j,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(ut,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:r.label,handleChangeTab:u}),h&&e.jsx(ot,{getOrderList:x})]}),(!h||a)&&e.jsxs(j,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(ee,{onClick:()=>{o(n)},disabled:m,isLoading:m,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!h&&e.jsx(ot,{getOrderList:x})]})]})},ot=({getOrderList:t})=>{const{refreshCoinMarketPrice:r}=vt(),[n,u]=p.useState(0);Jt({interval:1e3,callback:()=>{u(n+1),n>=20&&m()}});const{currentAccount:x}=X(),{fetchAccountBalance:o}=he(),m=h=>{u(0),t(h),r(),x!=null&&x.address&&o()};return e.jsx(os,{value:n,min:0,max:20,onClick:()=>m(!0)})};export{Ti as default};
