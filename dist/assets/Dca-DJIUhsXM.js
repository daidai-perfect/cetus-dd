import{a as g,j as t,V as L,u as Ve,H as T,T as N,C as ut,v as ye,f as jt,am as $t,S as mt,X as Lt,Y as zt,Z as Wt,$ as Bt,a8 as Ht,a0 as Ut,a1 as Ft,O as Gt,an as Vt,ao as qt,ap as Yt,aq as gt,I as Kt}from"./vendor-DsVemle5.js";import{M as Qt,C as Xt}from"./MenuDropBlock-Den2aKsR.js";import{T as Zt,a as Jt}from"./TradeTab-JtLCjiGr.js";import{u as qe}from"./useTransaction-_40Gj-Xj.js";import{j as fe,k as It,u as pt,D as es,a as Ye,e as ft,i as Ot,B as je,d as _,l as lt,m as E,t as $e,I as Oe,C as ts,n as Ke,o as ss,p as as,q as is,r as ns,v as cs,w as ge,x as Fe,y as ot,z as dt,A as we,E as ls,c as os,F as Ge,N as rs,G as us}from"./index-ptnn7YYs.js";import{P as Pt}from"./Pagination-D3S2cm5E.js";import{N as rt}from"./NoData-HfG491EP.js";import{R as ht}from"./RefreshButton-WcxAkxJ5.js";import{u as At,R as Tt}from"./RangeValue-rGit3VvP.js";import{H as ue}from"./HTextLabelBox-BSdt2JjM.js";import{E as Ee}from"./ErrorTips-BCywB7U6.js";import{u as xt}from"./useAccountBalance-BlkjpDIb.js";import{u as ps}from"./useInsufficientBalanceToast-BjqRjKwn.js";import{A as xs}from"./aggregator-BE05R8Nv.js";import{A as yt}from"./useSwapHelper-CkdGRiyG.js";import{u as _t}from"./useTokenBalance-BmzoUDH9.js";import{u as ms}from"./useFindBestRouting-DsIA0n5P.js";import{u as Ct}from"./useToken-D0Y8EMfE.js";import{i as gs}from"./icon_currentprice@2x-DeObnx8l.js";import{C as ds}from"./CurrentPrice-BdO6dfIz.js";import{T as hs}from"./TooltipIcon-Cc-8Tse6.js";import{T as ys}from"./TradeInputGroup-cjeY54io.js";import{W as _s}from"./WarningTokenTipModal-DgtdCV7o.js";import{S as St}from"./SingleTokenInfo-BK4bHte8.js";import{I as kt}from"./InputBox-B9mQGWx1.js";import{LimitPriceChart as Ss}from"./LimitPriceChart-1LW5B6UQ.js";import{u as bs}from"./global-XGPon1rE.js";import{u as vs}from"./useInterval-DHQ0XTt3.js";import{u as Ds}from"./useRpcListener-zb5WjE9D.js";import"./IconBg-DXu28HXx.js";import"./useTrack-DUPD-CMT.js";import"./useSigner-CA1OjupR.js";import"./useGetPoolList-BWUJTUb5.js";import"./useWrapPoolData-Dtc_nARB.js";import"./_getAllKeysIn-BPxU3Eca.js";import"./CheckBox-DBtbKikX.js";import"./CopyButton-BDbKvN3H.js";import"./usePreviousValue-CMQTRdbk.js";function Nt(){const{peripherySdk:a}=fe();return{dcaCloseOrderPayload:async e=>await a.Dca.dcaCloseOrderPayload(e)}}function Rt(){const{peripherySdk:a}=fe();return{dcaWithdrawPayload:async e=>(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDcaClaim.ts:12 ~ params:",e),await a.Dca.withdrawAll(e))}}const ws=(a,s)=>({upperPriceSize:"0%",setUpperPriceSize:e=>{a(()=>({upperPriceSize:e}))},lowerPriceSize:"0%",setLowerPriceSize:e=>{a(()=>({lowerPriceSize:e}))},dcaMode:"total",setDcaMode:e=>{a(()=>({dcaMode:e}))},isDcaRefresh:!1,setIsDcaRefresh:e=>{a(()=>({isDcaRefresh:e}))},pageDirect:!1,setPageDirect:e=>{a(()=>({pageDirect:e}))},sellTotalAmount:"",setSellTotalAmount:e=>{a(()=>({sellTotalAmount:e}))},sellAmount:"",setSellAmount:e=>{a(()=>({sellAmount:e}))},buyAmount:"",setBuyAmount:e=>{a(()=>({buyAmount:e}))},sellCoin:void 0,setSellCoin:e=>{a(()=>({sellCoin:e}))},buyCoin:void 0,setBuyCoin:e=>{a(()=>({buyCoin:e}))},orderNum:"2",setOrderNum:e=>{a(()=>({orderNum:e}))},investNum:"1",setInvestNum:e=>{a(()=>({investNum:e}))},currentCoinKey:"sellCoin",setCurrentCoinKey:e=>{a(()=>({currentCoinKey:e}))},currentInvest:"Hour",setCurrentInvest:e=>{a(()=>({currentInvest:e}))},pageLoading:!0,setPageLoading:e=>{a(()=>({pageLoading:e}))},dcaConfig:{},setDcaConfig:e=>{a(()=>({dcaConfig:e}))},dcaQuote:{},setDcaQuote:e=>{a(()=>({dcaQuote:e}))},orderHistoryObj:{},setOrderHistoryObj:e=>{a(()=>({orderHistoryObj:{...s().orderHistoryObj,...e}}))},inCoinWhiteList:[],setInCoinWhiteList:e=>{a(()=>({inCoinWhiteList:e}))},outCoinWhiteList:[],setOutCoinWhiteList:e=>{a(()=>({outCoinWhiteList:e}))}}),ie=It(ws);function js(){const{fetchByApi:a}=pt(),{setOrderHistoryObj:s}=ie();return{getDcaOrderHistory:async({orderId:S,limit:u,offset:r})=>{var i;const n=await a(es,"GET",{order_id:S,limit:u,offset:r});if(console.log("ðŸš€ ~ file: useGetDcaOrderHistory.ts:16 ~ useGetDcaOrderHistory ~ res:",n),n!=null&&n.list){const x={[S]:{list:((i=n==null?void 0:n.list)==null?void 0:i.map(c=>({inAmount:c==null?void 0:c.in_amount,outAmount:c==null?void 0:c.out_amount,inCoinType:c==null?void 0:c.in_coin,outCoinType:c==null?void 0:c.out_coin,time:c==null?void 0:c.execution_at,tx:c==null?void 0:c.tx})))||[],total:(n==null?void 0:n.total)||0}};return s(x),x}}}}function fs({isDetail:a,currentTabVal:s,orderInfo:e,handleRefresh:S,pageDirect:u}){const{isApp:r}=Ye(),{inCoin:n,outCoin:i}=e,{getDcaOrderHistory:x}=js(),[c,m]=g.useState(u),[l,b]=g.useState(u),p=10,[y,h]=g.useState([]),[d,v]=g.useState(0),[j,H]=g.useState(1),[R,f]=g.useState(!1),[F,G]=g.useState({label:"Overview",value:"overview"}),I=g.useMemo(()=>[{label:"Overview",value:"overview"},{label:R||Number(d)===0?"Orders":`Orders (${d})`,value:"orders"}],[d]),B=D=>{G(D),e!=null&&e.orderID&&Z(e==null?void 0:e.orderID,p,0,!1)};g.useEffect(()=>{a&&(e!=null&&e.orderID)&&Z(e==null?void 0:e.orderID,p,0,!1)},[e,a]);const se=D=>{console.log("ðŸš€ ~ handleCurrentPage ~ page:",D);const P=(D-1)*p;Z(e==null?void 0:e.orderID,p,P,!1),H(D)},Z=async(D,P,U,C=!1)=>{var K,te,ne,_e;console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ loading:",C),f(C);const z=await x({orderId:D,limit:P,offset:U});console.log("ðŸš€ ~ handleGetDcaOrderHistory ~ res?.list:",z,z[D]),(K=z[D])!=null&&K.list&&h((te=z[D])==null?void 0:te.list),(ne=z[D])!=null&&ne.total&&v((_e=z[D])==null?void 0:_e.total),f(!1),console.log("ðŸš€ ~ file: TestData.tsx:170 ~ handleGetDcaOrderHistory ~ res:",z)},[$,k]=g.useState(!1),{dcaWithdrawPayload:O}=Rt();xt();const{signAndExecuteTransaction:W}=qe(),ee=async()=>{k(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",e);const D=[],P={order_id:e==null?void 0:e.orderID,in_coin_type:e==null?void 0:e.inCoin.coin_type,out_coin_type:e==null?void 0:e.outCoin.coin_type};D.push(P),console.log("ðŸš€ ~ toClaim ~ claimOrderParams:",D);const U=await O(D),C=await W(U,{getShowInfo:z=>{var te,ne;const K={modalDescriptionText:`${(te=e==null?void 0:e.outCoin)==null?void 0:te.symbol} Claimed`,toastTitleText:`${(ne=e==null?void 0:e.outCoin)==null?void 0:ne.symbol} Claimed`};return z==="success"&&(K.toastDescriptionContent=""),K}});C&&(console.log("ðŸš€ ~ toClaim ~ res:",C),setTimeout(()=>{S()},2e3)),k(!1)}catch(D){console.log("ðŸš€ ~ toClaim ~ error:",D),k(!1)}},{getExplorerUrl:A}=ft();return t.jsxs(L,{w:"100%",gap:"20px",children:[t.jsx(Ot,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:I,currentTab:F.label,handleChangeTab:B}),t.jsxs(je,{p:"30px 8px 20px",mt:"-42px",borderRadius:"8px",zIndex:"0",bg:"bg_primary",children:[F.value=="orders"&&(R?t.jsx(Ve,{height:"4",width:"100%"}):(y==null?void 0:y.length)===0?t.jsx(rt,{type:"nodata",text:"No orders",noBorder:!0,p:"12px",bg:"none"}):t.jsxs(L,{w:"100%",align:"flex-start",gap:"16px",mt:"12px",children:[!r&&t.jsxs(T,{w:"100%",flexDirection:{base:"column",lg:"row"},children:[t.jsx(J,{label:"Order info",value:"",w:{base:"100%",lg:"40%"}}),t.jsx(J,{label:"Rate",value:"",w:{base:"100%",lg:"calc(32% - 16px)"},direct:l,onChangeDirect:()=>b(!l)}),t.jsx(J,{label:"Time (UTC)",value:"",w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]}),y==null?void 0:y.map(D=>{console.log("ðŸš€ ~ {orderHistoryList?.map ~ orderHistory:",D);const P=lt(D.inAmount,n==null?void 0:n.decimals),U=lt(D.outAmount,i==null?void 0:i.decimals),C=_(P).div(U).toString(),z=_(1).div(C).toString();return t.jsxs(T,{w:"100%",flexDirection:{base:"column",lg:"row"},borderBottom:r?"1px solid":"none",pb:r?"16px":"0",borderColor:"border",_last:{borderBottom:"none",pb:"0"},children:[t.jsx(J,{label:r?"Order info":"",value:`${E(P)} ${n.symbol} â†’ ${E(U)} ${i.symbol}`,w:{base:"100%",lg:"40%"}}),t.jsx(J,{label:r?"Rate":"",value:l?`${E(C)} ${n.symbol} per ${i.symbol}`:`${E(z)} ${i.symbol} per ${n.symbol}`,w:{base:"100%",lg:"calc(32% - 16px)"},direct:l,showDirectIcon:!!r,onChangeDirect:()=>b(!l)}),t.jsx(J,{label:r?"Time (UTC)":"",value:t.jsxs(T,{h:"12px",children:[t.jsx(N,{fontSize:"12px",color:"text_caption",children:$e((D==null?void 0:D.time)*1e3,"YMDHM")}),t.jsx(Oe,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(A(D==null?void 0:D.tx,"tx"))}})]}),w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]},D==null?void 0:D.time)}),_(d).gt(p)&&t.jsx(ut,{w:"100%",children:t.jsx(Pt,{total:d,size:p,currentPage:j,onChange:se})})]})),F.value=="overview"&&t.jsxs(L,{align:"flex-start",gap:"20px",children:[(e==null?void 0:e.isShowTradeTips)&&(e==null?void 0:e.orderStatus)=="Active"&&s=="active"&&t.jsx(Os,{}),t.jsxs(L,{w:"100%",borderRadius:"8px",p:"12px",bg:"card_bg",gap:"12px",children:[t.jsx(ue,{isLoading:!1,label:`DCA  ${n==null?void 0:n.symbol} Balance`,value:`${E(e==null?void 0:e.inBalance,2)||"0"} ${n==null?void 0:n.symbol}`,skeletonStyle:{valueW:"128px"}}),t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsxs(N,{fontSize:"12px",children:["DCA ",i==null?void 0:i.symbol," Balance"]}),t.jsxs(T,{children:[t.jsxs(N,{color:"text_caption",fontSize:"12px",children:[(e==null?void 0:e.outBalance)>0?E(e==null?void 0:e.outBalance):e==null?void 0:e.outBalance," ",i==null?void 0:i.symbol]}),s=="active"&&t.jsx(ye,{isLoading:$,onClick:ee,disabled:(e==null?void 0:e.outBalance)<=0||$,w:"60px",h:"20px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),t.jsx(ue,{isLoading:!1,label:"Amount Withdrawn",value:s=="active"?`${E(e==null?void 0:e.outWithdraw,2)}`:(e==null?void 0:e.orderStatus)=="PartialDeal"||(e==null?void 0:e.orderStatus)=="Close"?_(e==null?void 0:e.outWithdraw).gt(0)?`${E(e==null?void 0:e.inWithdrawn)} ${n==null?void 0:n.symbol} ${E(e==null?void 0:e.outWithdraw)} ${i==null?void 0:i.symbol}`:`${E(e==null?void 0:e.inWithdrawn)} ${n==null?void 0:n.symbol}`:`${E(e==null?void 0:e.outWithdraw)} ${i==null?void 0:i.symbol}`,skeletonStyle:{valueW:"128px"}})]}),t.jsxs(T,{flexWrap:"wrap",p:{base:"0",lg:"0 12px"},mt:{base:"-12px",lg:"-28px"},sx:{">div":{mt:{base:"12px",lg:"28px"},w:{base:"100%",lg:"calc((100% - 66px)/3)"},"&:nth-child(3n+1)":{mr:{base:"0",lg:"50px"}}}},children:[t.jsx(J,{label:"Invest Every",value:e==null?void 0:e.investEvery}),t.jsx(J,{label:"# of Orders Left",value:e==null?void 0:e.ofOrderLeft}),t.jsx(J,{label:"Each Order Size",value:`${e==null?void 0:e.eachOrderSize} ${n==null?void 0:n.symbol}`,align:"flex-end",textAlign:"right"}),t.jsx(J,{label:"Minimum Price",value:c?`${e==null?void 0:e.minPrice} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`:`${e==null?void 0:e.minPriceResever} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`,direct:c,onChangeDirect:()=>m(!c)}),t.jsx(J,{label:"Maximum Price",value:c?`${e==null?void 0:e.maxPrice} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`:`${e==null?void 0:e.maxPriceResever} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`,direct:c,onChangeDirect:()=>m(!c)}),s=="active"&&t.jsx(J,{label:"Current Avg. Price",value:c?`${e==null?void 0:e.currentAvgPrice} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`,align:"flex-end",textAlign:"right",direct:c,onChangeDirect:()=>m(!c)}),s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"&&t.jsx(J,{label:"Avg. Price",value:c?`${e==null?void 0:e.currentAvgPrice} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`,align:"flex-end",textAlign:"right",direct:c,onChangeDirect:()=>m(!c)}),s=="active"&&t.jsx(J,{label:"Next Order (UTC)",value:e==null?void 0:e.nextCycleAt}),t.jsx(J,{label:"Created (UTC)",value:e==null?void 0:e.createAt,align:s=="active"||s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"?"flex-start":"flex-end"})]})]})]})]})}const J=({label:a,value:s,direct:e,onChangeDirect:S,textAlign:u="left",showDirectIcon:r=!0,...n})=>t.jsxs(L,{align:"flex-start",flexDirection:{base:"row",lg:"column"},w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"unset"},...n,children:[a!==""&&t.jsxs(T,{h:"12px",children:[t.jsx(N,{fontSize:"12px",children:a}),S&&r&&t.jsx(Oe,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:S})]}),s!==""&&t.jsx(jt,{fontSize:"12px",color:"text_caption",textAlign:u,children:s})]}),Os=()=>t.jsxs(L,{p:"12px 12px 0",align:"flex-start",children:[t.jsx(T,{children:t.jsx(Ee,{tips:"The system tried to execute your order multiple times but did not get it through. This is possibly because:",type:"warning",tipsFontSize:"12px",p:"0",bg:"none",svgW:"20px",svgH:"20px"})}),t.jsx(N,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market price is not in your required price range"}),t.jsx(N,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market no longer exit"}),t.jsx(N,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market is extremely volatile"}),t.jsx(N,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"This DCA will continue to be attempted and the estimated end date may be extended until your order is fully executed."})]});function Ps({currentTabVal:a,orderInfo:s,handleRefresh:e}){const{isApp:S}=Ye(),{inCoin:u,outCoin:r}=s,[n,i]=g.useState(!1),[x,c]=g.useState(!1);g.useEffect(()=>{i(!1)},[a]);const{getTokenRank:m}=At(),[l,b]=g.useState(!1);g.useEffect(()=>{const v=m(u,r);console.log("ðŸš€ ~ useEffectDcaItem ~ direct:",r,u,v),b(!v)},[u==null?void 0:u.coin_type,r==null?void 0:r.coin_type]);const{dcaCloseOrderPayload:p}=Nt(),{signAndExecuteTransaction:y}=qe(),h=async()=>{c(!0);try{console.log("ðŸš€ ~ closeOrder ~ orderInfo:",s);const v=[{order_id:s==null?void 0:s.orderID,in_coin_type:s==null?void 0:s.inCoin.coin_type,out_coin_type:s==null?void 0:s.outCoin.coin_type}];console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-order-card.vue:280 ~ closeOrder ~ closeOrderParams:",v);const j=await p(v),H=await y(j,{getShowInfo:R=>{const f={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return R==="success"&&(f.modalDescriptionText="DCA Order Closed",f.toastDescriptionContent="",f.toastTitleText="DCA Order Closed"),f}});console.log("ðŸš€ ~ closeOrder ~ res:",H),H&&setTimeout(()=>{e()},2e3),c(!1)}catch(v){console.log("ðŸš€ ~ closeOrder ~ error:",v),c(!1)}},{getExplorerUrl:d}=ft();return t.jsxs(L,{w:"100%",gap:"12px",align:"flex-start",children:[t.jsxs(T,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"flex-start",lg:"center"},children:[t.jsxs(T,{children:[t.jsx(ts,{coinAIconUrl:u==null?void 0:u.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,coinACoinType:u==null?void 0:u.coin_type,coinBCoinType:r==null?void 0:r.coin_type,w:"28px",h:"28px"}),t.jsxs(N,{color:"text_caption",children:[u==null?void 0:u.symbol," â†’ ",r==null?void 0:r.symbol]}),t.jsx(Oe,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(d(s==null?void 0:s.orderID,"poolAddress"))}})]}),!S&&t.jsx(bt,{currentTabVal:a,isCloseLoading:x,closeOrder:h,orderInfo:s,isDetail:n,onClickDetail:()=>i(!n)})]}),t.jsxs(T,{children:[t.jsxs(N,{color:"text_caption",fontSize:"12px",children:[E(s==null?void 0:s.inDepositedOut)," ",u==null?void 0:u.symbol]}),t.jsxs(N,{color:"primary_gray",fontSize:"12px",children:["/ ",E(s==null?void 0:s.inDeposited)," ",u==null?void 0:u.symbol]}),t.jsxs(N,{color:"primary_gray",fontSize:"12px",children:["(",s==null?void 0:s.inBalanceRatio,"%)"]}),t.jsx($t,{w:"50px",h:"4px",value:s==null?void 0:s.inBalanceRatio,bg:"#282828",sx:{'div[role="progressbar"]':{bg:"primary"}}})]}),t.jsxs(T,{w:"100%",children:[t.jsx(N,{color:"primary_gray",fontSize:"12px",children:"Price Range"}),t.jsx(Tt,{displayTokenA:r,displayTokenB:u,isRank:!0,priceInfo:{minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,minPriceResever:s==null?void 0:s.minPriceResever,maxPriceResever:s==null?void 0:s.maxPriceResever},fontSize:"12px"})]}),S&&t.jsx(bt,{currentTabVal:a,isCloseLoading:x,closeOrder:h,orderInfo:s,isDetail:n,onClickDetail:()=>i(!n)}),n&&t.jsx(fs,{pageDirect:l,isDetail:n,currentTabVal:a,orderInfo:s,handleRefresh:e})]})}const bt=({currentTabVal:a,isCloseLoading:s,closeOrder:e,orderInfo:S,isDetail:u,onClickDetail:r})=>t.jsxs(T,{w:{base:"100%",lg:"unset"},flexDirection:{base:"column",lg:"row"},children:[a=="active"&&t.jsx(ye,{w:{base:"100%",lg:"unset"},isLoading:s,disabled:s,onClick:e,h:"32px",minH:"unset",p:"0px 12px",fontSize:"14px",borderRadius:"8px",variant:"outline",children:(S==null?void 0:S.outBalance)<=0?"Close":"Close and Withdraw"}),t.jsx(ye,{w:{base:"100%",lg:"unset"},h:"32px",borderRadius:"8px",minH:"unset",p:"0px 12px",fontSize:"14px",variant:"ghost",rightIcon:t.jsx(Oe,{svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",transform:u?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.5s",ml:"-4px",mr:"-4px"}),onClick:r,children:"Details"})]});function vt({handleRefresh:a,activeList:s,pastList:e,isOrderLoading:S}){const[r,n]=g.useState([]),[i,x]=g.useState([]),[c,m]=g.useState(0),[l,b]=g.useState(1),{currentAccount:p,onWalletModal:y}=Ke(),[h,d]=g.useState({label:"Active DCAs",value:"active"}),v=g.useMemo(()=>[{label:"Active DCAs",value:"active",num:(s==null?void 0:s.length)>0?s==null?void 0:s.length:void 0},{label:"Past DCAs",value:"past",num:(e==null?void 0:e.length)>0?e==null?void 0:e.length:void 0}],[h==null?void 0:h.value,s,e]),j=O=>{b(1),d(O)};g.useEffect(()=>{const O=(h==null?void 0:h.value)==="active"?s:e;n(O),m(O==null?void 0:O.length)},[h==null?void 0:h.value,s,e]),g.useEffect(()=>{const O=(l-1)*10,W=O+10;x(r==null?void 0:r.slice(O,W))},[l,r,h==null?void 0:h.value]);const H=g.useMemo(()=>(h==null?void 0:h.value)==="past"||(r==null?void 0:r.length)===0?0:r==null?void 0:r.reduce((O,W)=>_(O).plus(W==null?void 0:W.outBalance),_(0)).toString(),[h==null?void 0:h.value,r]),[R,f]=g.useState(!1),[F,G]=g.useState(!1),{dcaWithdrawPayload:I}=Rt(),{dcaCloseOrderPayload:B}=Nt(),{signAndExecuteTransaction:se}=qe(),Z=async()=>{G(!0);try{const O=r==null?void 0:r.map(A=>({order_id:A==null?void 0:A.orderID,in_coin_type:A==null?void 0:A.inCoin.coin_type,out_coin_type:A==null?void 0:A.outCoin.coin_type}));console.log("ðŸš€ ~ const closeOrderParams:any=pageList.map ~ closeOrderParams:",O);const W=await B(O),ee=await se(W,{getShowInfo:A=>{const D={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return A==="success"&&(D.modalDescriptionText="DCA Order Closed",D.toastDescriptionContent="",D.toastTitleText="DCA Order Closed"),D}});console.log("ðŸš€ ~ closeAll ~ res:",ee),ee&&setTimeout(()=>{a(!0)},2e3),G(!1)}catch(O){console.log("ðŸš€ ~ closeAll ~ error:",O),G(!1)}},$=async()=>{f(!0);try{const O=r==null?void 0:r.map(A=>({order_id:A==null?void 0:A.orderID,in_coin_type:A==null?void 0:A.inCoin.coin_type,out_coin_type:A==null?void 0:A.outCoin.coin_type}));console.log("ðŸš€ ~ const claimOrderParams:any=pageList.map ~ claimOrderParams:",O);const W=await I(O),ee=await se(W,{getShowInfo:A=>{const D={modalDescriptionText:"DCA Order Claimed",toastTitleText:"DCA Order Claimed"};return A==="success"&&(D.toastDescriptionContent=""),D}});console.log("ðŸš€ ~ claimAll ~ res:",ee),ee&&setTimeout(()=>{a(!0)},2e3),f(!1)}catch(O){console.log("ðŸš€ ~ claimAll ~ error:",O),f(!1)}},{isApp:k}=Ye();return t.jsxs(L,{w:"100%",children:[t.jsxs(T,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(T,{w:{base:"100%",lg:"unset"},justify:"space-between",children:[t.jsx(Ot,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"300px"},h:"52px",gap:"32px",bg:"none",border:"none",mb:"8px"},itemStyle:{fontSize:"16px"},tabList:v,currentTab:h.label,handleChangeTab:j}),k&&t.jsx(ht,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),t.jsxs(T,{w:{base:"100%",lg:"unset"},children:[h.value==="active"&&(r==null?void 0:r.length)>0&&(p==null?void 0:p.address)&&t.jsx(ye,{w:{base:"50%",lg:"unset"},h:"28px",minH:"unset",p:"0 10px",fontSize:"14px",borderRadius:"8px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},isLoading:R,disabled:Number(H)===0||R,onClick:$,leftIcon:t.jsx(Oe,{xlinkHref:"#icon-icon_incentive",svgFill:"primary",mr:"-4px",ml:"-4px"}),children:"Claim all"}),h.value==="active"&&(r==null?void 0:r.length)>0&&(p==null?void 0:p.address)&&t.jsx(ye,{w:{base:"50%",lg:"unset"},isLoading:F,disabled:(r==null?void 0:r.length)==0||F,h:"28px",borderRadius:"8px",minH:"unset",p:"0 12px",fontSize:"14px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},onClick:Z,children:"Close All"}),!k&&t.jsx(ht,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),p!=null&&p.address?S?t.jsx(je,{children:t.jsx(L,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((O,W)=>t.jsx(As,{},W))})}):(r==null?void 0:r.length)===0?t.jsx(rt,{type:"nodata",text:(h==null?void 0:h.value)==="active"?"No active orders":"No closed orders"}):t.jsxs(je,{h:(i==null?void 0:i.length)>8?"927px":"unset",overflowY:"auto",p:{base:"12px",lg:"20px 16px"},children:[t.jsx(L,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:i==null?void 0:i.map(O=>t.jsx(Ps,{handleRefresh:()=>a(!0),currentTabVal:h.value,orderInfo:O},O==null?void 0:O.orderID))}),!S&&(r==null?void 0:r.length)>10&&t.jsx(ut,{mt:"28px",children:t.jsx(Pt,{total:c,size:10,currentPage:l,onChange:b})})]}):t.jsx(rt,{type:"nowallet",onboard:()=>y(!0)})]})}const As=()=>t.jsxs(L,{w:"100%",gap:"16px",align:"flex-start",children:[t.jsxs(T,{w:"100%",gap:"0",justify:"space-between",children:[t.jsxs(T,{gap:"0",children:[t.jsxs(T,{gap:"0px",mr:"8px",align:"flex-start",children:[t.jsx(mt,{size:"8"}),t.jsx(mt,{size:"8"})]}),t.jsx(Ve,{height:"4",width:"100px"})]}),t.jsx(Ve,{height:"4",width:"150px"})]}),t.jsx(Ve,{height:"4",width:"180px"})]});function Ts(){const{fetchByApi:a}=pt(),{peripherySdk:s}=fe(),{setDcaConfig:e}=ie(),S=async()=>await a(ss,"GET")||null,u=async()=>await s.Dca.getDcaGlobalConfig();return{getDcaConfig:async()=>{const n={};try{const i=await S();i&&(n.minCycleAmountInUsd=i==null?void 0:i.min_amount_in_usd)}catch(i){console.log("ðŸš€ ~ file: useDcaConfig.ts:22 ~ getDcaConfig ~ error:",i)}try{const i=await u();n.minCycleCount=i==null?void 0:i.min_cycle_count,n.minCycleFrequency=i==null?void 0:i.min_cycle_frequency,n.whitelistMode=i==null?void 0:i.whitelist_mode}catch(i){console.log("ðŸš€ ~ file: useDcaConfig.ts:32 ~ getDcaConfig ~ error:",i)}return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDcaConfig.ts:45 ~ getDcaConfig ~ dcaConfig:",n),e(n),n}}}function Mt(){const{fetchByApi:a}=pt(),{setDcaQuote:s}=ie();return{getDcaQuote:async({inCoin:S,freq:u,count:r,sender:n})=>{try{const i=await a(as,"GET",{in_coin:S,freq:u,count:r,sender:n});if(i){const x={amountInLimitPerCycle:i==null?void 0:i.amount_in_limit_per_cycle,coinType:i==null?void 0:i.coin_type,feeRate:i==null?void 0:i.fee_rate,signature:i==null?void 0:i.signature,signer:i==null?void 0:i.signer,timestamp:i==null?void 0:i.timestamp};return s(x),x}}catch(i){console.log("getDcaQuote ~ error:",i)}return null}}}function Cs(){var X,ve;const{sellCoin:a,buyCoin:s,setSellCoin:e,setBuyCoin:S,sellAmount:u,buyAmount:r,setBuyAmount:n,setSellAmount:i,dcaConfig:x,setCurrentCoinKey:c,currentCoinKey:m,investNum:l,currentInvest:b,orderNum:p,dcaQuote:y,setInvestNum:h,setOrderNum:d,setCurrentInvest:v,setPageDirect:j,pageDirect:H,dcaMode:R,sellTotalAmount:f,setSellTotalAmount:F,setLowerPriceSize:G,setUpperPriceSize:I}=ie(),{currentAccount:B}=Ke(),{getDcaConfig:se}=Ts(),{getDcaQuote:Z}=Mt(),{coinPriceObj:$}=is(),{fetchTokenPrices:k,getTokenAmountValue:O}=ns(),[W,ee]=g.useState(""),A=g.useRef(W);g.useEffect(()=>{A.current=W},[W]);const D=()=>{console.log("ðŸš€ ~ initiaTokenSelect ~ setSellCoin:"),e(dt.clmm_swap.from_coin),S(dt.clmm_swap.to_coin)};g.useEffect(()=>(G("0%"),I("0%"),D(),se(),()=>{ce()}),[]);const[P,U]=g.useState(""),[C,z]=g.useState(""),{balanceInfo:K}=_t(a),{balanceInfo:te}=_t(s),ne=O(a==null?void 0:a.coin_type,u),_e=o=>{c("sellCoin"),i(o),be()};g.useEffect(()=>{+u&&+p?R=="total"?F(u):F(_(u).mul(p).toString()):F("")},[u,R,p]);const Qe=()=>{const o=H?a==null?void 0:a.decimals:s==null?void 0:s.decimals;if(j(!H),P&&C){const M=P,q=_(1).div(C).toString(),re=_(1).div(M).toString();U(we(q,o,!0).toString()),z(we(re,o,!0).toString())}},Xe=(o,M=!0)=>{var q,re,De,he;U(""),z(""),M?(((q=o==null?void 0:o.coin_type)==null?void 0:q.toLowerCase())===((re=s==null?void 0:s.coin_type)==null?void 0:re.toLowerCase())?Pe():e(o),c("sellCoin")):(((De=o==null?void 0:o.coin_type)==null?void 0:De.toLowerCase())===((he=a==null?void 0:a.coin_type)==null?void 0:he.toLowerCase())?Pe():S(o),c("buyCoin"))},ce=()=>{i(""),U(""),z(""),ee(""),h("1"),d("2"),v("Hour")},Pe=()=>{e(s),S(a)},Ae=g.useMemo(()=>{const o=x==null?void 0:x.whitelistMode;return console.log("ðŸš€ ~ useDcaHook ~ whitelistMode:",o),o===3?!0:o===0?!1:m==="sellCoin"?o===1:m==="buyCoin"?o===2:!1},[x==null?void 0:x.whitelistMode]),Te=((X=$[cs(a==null?void 0:a.coin_type).full_address])==null?void 0:X.price)||0,V=g.useMemo(()=>f&&p?_(f).div(p).toString():0,[f,p]),Ce=g.useMemo(()=>f&&p&&Te&&_(f).div(p).mul(Te).toString()||0,[f,p,Te]),Ze=_(y==null?void 0:y.feeRate).div(ge.pow(10,6)).mul(100).toString()+"%"||"0%",le=g.useMemo(()=>{if(y!=null&&y.amountInLimitPerCycle&&(a!=null&&a.decimals))return lt(y==null?void 0:y.amountInLimitPerCycle,a==null?void 0:a.decimals)},[y==null?void 0:y.amountInLimitPerCycle]),de=g.useMemo(()=>(console.log("ðŸš€ ~ orderSizeError ~ sellPerOrder:",V,le),x!=null&&x.minCycleAmountInUsd&&p&&u&&le&&Number(V)<Number(le)?{status:!0,tips:`Each order size should be higher than $${x==null?void 0:x.minCycleAmountInUsd}.`}:u&&p&&Number(Ce)>1e4?{status:!0,tips:"Each order size should be less than $10,000"}:{status:!1,tips:""}),[R,le,p,V,u,Ce,x==null?void 0:x.minCycleAmountInUsd]),ke=g.useMemo(()=>(console.log("ðŸš€ ~ orderInputError ~ orderNum:",p,p&&Number(p)<Number(x==null?void 0:x.minCycleCount)),x!=null&&x.minCycleCount&&p&&Number(p)<Number(x==null?void 0:x.minCycleCount)?{status:!0,tips:`Number of Orders cannot be lower than ${x==null?void 0:x.minCycleCount}.`}:p&&Number(l)<=0?{status:!0,tips:"Please enter an interval above 0"}:p&&l&&Number(l)>1e4?{status:!0,tips:"The maximum interval is 10,000."}:{status:!1,tips:""}),[p,x==null?void 0:x.minCycleCount,l]),Ne=g.useMemo(()=>P&&Number(P)==0||C&&Number(C)==0?{status:!0,tips:"Please enter a price greater than 0."}:P&&C&&Number(P)>=Number(C)?{status:!0,tips:"The max price should be higher than min price."}:{status:!1,tips:""},[P,C]),[Je,Le]=g.useState(""),[Re,ze]=g.useState({status:!1,tips:""}),Ie=()=>{const o=new Date().getTime();let M=0;switch(console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-detail.vue:34 ~ estEndDate ~ currentTime.value:",b),b){case"Minute":M=Number(l)*60*1e3*(Number(p)-1)+6e4;break;case"Hour":M=Number(l)*60*60*1e3*(Number(p)-1)+6e4;break;case"Day":M=Number(l)*60*60*24*1e3*(Number(p)-1)+6e4;break;case"Week":M=Number(l)*60*60*24*7*1e3*(Number(p)-1)+6e4;break;case"Month":M=Number(l)*60*60*24*30*1e3*(Number(p)-1)+6e4;break}console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-detail.vue:46 ~ estEndDate ~ date + investTime:",p,o,M,M>60*60*24*365*1e3);const q=$e(o+M,"YMDHM");console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:303 ~ getEstEndDate ~ result:",q),Le(q),q=="NaN-NaN-NaN NaN:NaN"&&Le("--"),M>60*60*24*365*1e3?ze({status:!0,tips:"The maximum execution period is 1 year"}):ze({status:!1,tips:"The maximum execution period is 1 year"})};g.useEffect(()=>{Ie()},[u,l,p,P,C,b]);const pe=g.useMemo(()=>{let o=0;switch(b){case"Minute":o=Number(l)*60;break;case"Hour":o=Number(l)*60*60;break;case"Day":o=Number(l)*60*60*24;break;case"Week":o=Number(l)*60*60*24*7;break;case"Month":o=Number(l)*60*60*24*30;break}return console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:333 ~ cycleFrequency ~ investTime:",o),o},[b,l]);g.useEffect(()=>{a!=null&&a.coin_type&&pe&&p&&Me(a==null?void 0:a.coin_type,pe,p,B==null?void 0:B.address)},[a==null?void 0:a.coin_type,pe,p,B==null?void 0:B.address]);const Se=async(o,M,q,re)=>{const De=re||"0x0000000000000000000000000000000000000000000000000000000000000000";try{const he=await Z({inCoin:o,freq:M,count:q,sender:De});return console.log("ðŸš€ ~ queryDcaQuote ~ result:",he),he}catch(he){console.log("ðŸš€ðŸš€ðŸš€ ~ file: dca-data.ts:344 ~ queryDcaQuote ~ error:",he)}},Me=Fe((o,M,q,re)=>{Se(o,M,q,re)},500),{findBestRouters:xe}=ms(),[et,We]=g.useState(!1),[ae,Be]=g.useState(void 0),{getTokenRank:He}=At();g.useEffect(()=>{Ue();const o=He(a,s);console.log("ðŸš€ ~ useEffect ~ direct:",o),j(o)},[a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]),g.useEffect(()=>{be()},[V,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]);const be=()=>{_(V).gt(0)&&(a!=null&&a.coin_type)&&(s!=null&&s.coin_type)&&(We(!0),console.log("ðŸš€ ~ useDcaHook ~ sellAmountDebounce:",Number(V)>0,V,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type,p),tt())},tt=Fe(()=>{st()},500),st=async()=>{if(console.log("ðŸš€ ~ findAvailableRouter ~ findAvailableRouter:",V),a&&s){const o=`${a.coin_type}_${s.coin_type}`;ee(o);const M=Object.entries(xs).map(([re,De])=>De.id),q=await xe({fromToken:a,toToken:s,amount:ot(V||1,a==null?void 0:a.decimals).toFixed(0),providersKeys:M,by_amount_in:!0,uuid:o});console.log("ðŸš€ ~ findAvailableRouter ~ newUuid:",o,W,q),o===A.current&&(Be(q),n(q==null?void 0:q.toAmountUi),We(!1))}},Ue=()=>{const o=((a==null?void 0:a.coin_type)||(s==null?void 0:s.coin_type))&&Array.from(new Set([a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]));(o==null?void 0:o.length)>0&&k(o)},at=g.useMemo(()=>{console.log("ðŸš€ ~ btnStatus ~ routerData:",ae);const o={text:"Create DCA Order",disabled:!1};return B!=null&&B.address?!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)?(o.disabled=!0,o.text="Select a token",o):!u||Number(u)==0?(o.disabled=!0,o.text="Enter an amount",o):_(f).gt((K==null?void 0:K.balanceFormat)||0)?(o.disabled=!0,o.text=`Insufficient ${a==null?void 0:a.symbol} balance`,o):_(x==null?void 0:x.minCycleCount).gt(p||0)?(o.disabled=!0,o.text=`Minimum ${x==null?void 0:x.minCycleCount} orders`,o):_(le).gt(V||0)?(o.disabled=!0,o.text=`Minimum $${x==null?void 0:x.minCycleAmountInUsd} per order`,o):de.status||ke.status||Ne.status||Re.status||!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)||!p||!l||!P||!C?(o.disabled=!0,o.text="Create DCA Order",o):(console.log("ðŸš€ ~ btnStatus ~ routerData:",ae),ae&&ae.errorCode&&(ae.errorCode===yt.NoRouter||ae.errorCode===yt.HoneyPot)&&(o.text="No Available Route",o.disabled=!0),o):(o.text="Connect Wallet",o.disabled=!1,o)},[B==null?void 0:B.address,K,de,ke,Ne,Re,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type,f,l,p,P,C,(ve=ae==null?void 0:ae.routes)==null?void 0:ve.length]),it=g.useMemo(()=>{const o=[];return s&&o.push(s),a&&o.push(a),o},[s,a]),oe=g.useMemo(()=>H&&r&&V?E(_(r).div(V).toString(),s==null?void 0:s.decimals,!0):!H&&r&&V?E(_(V).div(r).toString(),a==null?void 0:a.decimals,!0):"",[H,V,r]),nt=Fe(o=>{U(o)},500),ct=Fe(o=>{z(o)},500),w=o=>{console.log("ðŸš€ ~ handleMinInputChange ~ val:",o),nt(o)},Y=o=>{console.log("ðŸš€ ~ handleMaxInputChange ~ val:",o),ct(o)};g.useEffect(()=>{me(P)},[P,oe]),g.useEffect(()=>{Q(C)},[C,oe]);const me=o=>{if(console.log("ðŸš€ ~ changeLowerPriceSize ~ val:",o),oe&&o){const M=_(o).div(oe).sub(1).mul(100).toString();console.log("ðŸš€ ~ handleMaxInputChange ~ upperPrice:",M),G(_(M).gt(1e4)?">10,000%":`${E(M,1,!1,ge.ROUND_HALF_DOWN)}%`)}},Q=o=>{if(oe&&o){const M=_(o).div(oe).sub(1).mul(100).toString();console.log("ðŸš€ ~ handleMaxInputChange ~ upperPrice:",M),I(_(M).gt(1e4)?">10,000%":`${E(M,1,!1,ge.ROUND_HALF_DOWN)}%`)}};return{currentPrice:oe,handleMinInputChange:w,handleMaxInputChange:Y,warningTokenList:it,resetInputAmount:ce,cycleFrequency:pe,btnStatus:at,fetchFindAvailableRouterDebounce:be,queryDcaQuote:Se,findRouterLoading:et,platformFee:Ze,estEndDate:Je,sellPerOrder:V,isDcaSelect:Ae,onReverseClick:Pe,sellBalanceInfo:K,buyBalanceInfo:te,sellAmountValue:ne,handleAmountChange:_e,handleSelectToken:Xe,minPriceValue:P,maxPriceValue:C,handlePageToggleDirect:Qe,orderSizeError:de,orderInputError:ke,priceError:Ne,orderTimeError:Re}}function ks(){const{peripherySdk:a}=fe(),{getTokenListInfo:s}=Ct(),{setFilterTokenLoading:e}=ls(),{setInCoinWhiteList:S,setOutCoinWhiteList:u}=ie();return{getDcaCoinWhiteList:async n=>{var i,x;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:44 ~ getDcaCoinWhiteList ~ getDcaCoinWhiteList:");try{e(!0);const{inCoinList:c,outCoinList:m}=await a.Dca.getDcaCoinWhiteList(n);console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:18 ~ getDcaCoinWhiteList ~ outCoinList:",m),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useGetDcaTokenList.ts:18 ~ getDcaCoinWhiteList ~ inCoinList:",c);const l=[],b=[],p=c.map(v=>v),y=await s(p);if(y)for(let v=0;v<c.length;v++){const j=y.get(c[v]);l.push({...j,labels:((i=j==null?void 0:j.labels)==null?void 0:i.length)>0?j==null?void 0:j.labels:""})}const h=m.map(v=>v),d=await s(h);if(d)for(let v=0;v<m.length;v++){const j=d.get(m[v]);b.push({...j,labels:((x=j==null?void 0:j.labels)==null?void 0:x.length)>0?j==null?void 0:j.labels:""})}console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDca.ts:351 ~ getDcaCoinWhiteList ~ outList:",b),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useDca.ts:351 ~ getDcaCoinWhiteList ~ inList:",l),S(l),u(b),e(!1)}catch(c){S([]),u([]),e(!1),console.log("ðŸš€ ~ file: useGetDcaTokenList.ts:35 ~ getDcaCoinWhiteList ~ error:",c)}}}}function Ns(){const{peripherySdk:a}=fe(),{getDcaQuote:s}=Mt(),e=(r,n,i,x,c,m)=>{const l=_(ot(r,i)).div(n),b=_(l).div(_(c)),p=_(l).div(_(m));let y,h;if(i>x){const d=ge.pow(10,i-x);y=p.div(d).ceil().toString(),h=b.div(d).ceil().toString()}else if(i<x){const d=ge.pow(10,x-i);y=p.mul(d).ceil().toString(),h=b.mul(d).ceil().toString()}else y=p.ceil().toString(),h=b.ceil().toString();return{perCycleMinOutAmount:y,perCycleMaxOutAmount:h,cycleCountAmount:l}},S=(r,n,i,x)=>{const{in_coin:c,in_coin_amount:m,freq:l,cycle_count:b,out_coin:p}=r;return{in_coin_amount:String(ot(m,c.decimals)),in_coin_type:c.coin_type,out_coin_type:p.coin_type,cycle_frequency:l,cycle_count:b,per_cycle_min_out_amount:i,per_cycle_max_out_amount:x,per_cycle_in_amount_limit:n.amountInLimitPerCycle,fee_rate:n.feeRate,timestamp:n.timestamp,signature:n.signature}};return{openDcaOrder:async r=>{const{in_coin:n,out_coin:i,in_coin_amount:x,cycle_count:c,min_price:m,max_price:l,freq:b}=r,p=a.ClmmSDK.senderAddress||"0x0000000000000000000000000000000000000000000000000000000000000000",y=await s({inCoin:n.coin_type,freq:b,count:c,sender:p});if(!y)throw new Error("Request timed out");const{perCycleMinOutAmount:h,perCycleMaxOutAmount:d}=e(x,c,n.decimals,i.decimals,m,l),v=S(r,y,h,d);console.log("ðŸš€ðŸš€ðŸš€ ~ file: useOpenDcaOrder.ts:91 ~ openDcaOrder ~ dcaOpenOrderPayloadParams:",v);const j=await a.Dca.dcaOpenOrderPayload(v);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useOpenDcaOrder.ts:55 ~ openDcaOrder ~ tx:",j),j}}}function Et({detailsData:a,isConfirm:s=!1}){const{sellPerOrder:e,estEndDate:S,platformFee:u,minPriceValue:r,maxPriceValue:n,minPriceResever:i,maxPriceResever:x}=a,{sellCoin:c,buyCoin:m,sellTotalAmount:l,investNum:b,currentInvest:p,pageDirect:y}=ie();return console.log("ðŸš€ ~ DetailsBlock ~ investNum:",a,b),t.jsxs(L,{w:"100%",gap:s?"20px":"16px",children:[t.jsx(ue,{isLoading:!1,label:"Sell total",value:l?`${E(l,c==null?void 0:c.decimals)} ${c==null?void 0:c.symbol}`:`-- ${c==null?void 0:c.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(ue,{isLoading:!1,label:"Sell per order",value:e?`${E(e,c==null?void 0:c.decimals)} ${c==null?void 0:c.symbol}`:`-- ${c==null?void 0:c.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),!s&&t.jsx(ue,{isLoading:!1,label:"Receive",value:t.jsxs(T,{gap:"4px",children:[t.jsx(os,{imageUrl:m==null?void 0:m.logo_url,w:"20px",h:"20px",coinType:m==null?void 0:m.coin_type,showTagHeight:"10px",showTagWidth:"10px"}),t.jsx(N,{color:"text_caption",children:m==null?void 0:m.symbol})]}),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsx(N,{textAlign:"left",whiteSpace:"nowrap",children:"Price range"}),t.jsx(Tt,{displayTokenA:m,displayTokenB:c,isRank:!0,justify:"flex-end",priceInfo:{minPrice:Ge(r).toString(),maxPrice:Ge(n).toString(),minPriceResever:Ge(i).toString(),maxPriceResever:Ge(x).toString()},fontSize:"14px",color:"text_caption"})]}),t.jsx(ue,{isLoading:!1,label:"Invest every",value:Number(b)>1?`${b} ${p}s`:`${b} ${p}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsx(ue,{isLoading:!1,label:"Start date",value:String($e(Date.now(),"YMDHM")),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(ue,{isLoading:!1,label:"Est. end date(UTC)",value:S,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(ue,{isLoading:!1,label:"Platform fee",value:u,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}})]})}const Rs=({confirmData:a,isOpen:s,onClose:e,toOpenDca:S,toOpenDcaLoading:u})=>{const{sellCoin:r,buyCoin:n}=ie();return t.jsxs(Lt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:s,onClose:e,isCentered:!0,children:[t.jsx(zt,{}),t.jsxs(Wt,{children:[t.jsx(Bt,{children:t.jsx(Ht,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),t.jsx(Ut,{}),t.jsx(Ft,{textAlign:"center",p:"0px",children:t.jsxs(L,{w:"100%",gap:"16px",p:"16px",children:[t.jsxs(je,{borderRadius:"12px",position:"relative",p:"0 12px",children:[t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsxs(L,{align:"flex-start",w:"calc(50% - 24px)",children:[t.jsx(N,{children:"Sell"}),t.jsx(St,{token:r,haveName:!1,symbolEllipsesDecimals:10})]}),t.jsx(jt,{w:"1px",h:"100px",bg:"border"}),t.jsxs(L,{align:"flex-end",w:"calc(50% - 24px)",children:[t.jsx(N,{children:"Buy"}),t.jsx(St,{token:n,haveName:!1,symbolEllipsesDecimals:10})]})]}),t.jsx(ut,{w:"36px",h:"36px",borderRadius:"50%",position:"absolute",left:"calc(50% - 18px)",top:"calc(50% - 18px)",border:"1px solid",borderColor:"border",boxShadow:"trade_icon_shadow",bg:"input_bg",children:t.jsx(Oe,{mt:"-1px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",transform:"rotate(-90deg)"})})]}),t.jsx(Et,{detailsData:a,isConfirm:!0}),t.jsx(ye,{mt:"12px",onClick:()=>{S(),e()},disabled:u,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Create DCA Order"})]})})]})]})};function Ms({detailsData:a}){return t.jsx(je,{children:t.jsxs(L,{gap:"20px",children:[t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsx(N,{color:"text_caption",children:"Details"}),t.jsx(N,{fontSize:"12px",children:"Your first invest cycle will begin immediately"})]}),t.jsx(Et,{detailsData:a})]})})}function Dt({title:a,label:s,inputValue:e,inputChange:S=()=>{},list:u=[],onListItemClick:r=()=>{}}){const n=i=>{const x=i.target.value.replace(/[^\d]/g,"");S(x)};return t.jsx(kt,{w:"50%",borderRadius:"16px",children:t.jsxs(L,{gap:"16px",align:"flex-start",children:[typeof a=="string"?t.jsx(N,{fontWeight:"500",lineHeight:"18px",fontSize:"13px",children:a}):a,t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsx(Gt,{value:e,onChange:n,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),u.length>0?t.jsx(Qt,{label:s,list:u,onListItemClick:r}):t.jsx(N,{color:"text_caption",children:s})]})]})})}function wt({direct:a,text:s,align:e,inputValue:S,inputChange:u=()=>{}}){const{sellCoin:r,buyCoin:n}=ie();return t.jsx(kt,{w:"unset",borderRadius:"8px",children:t.jsx(T,{children:t.jsxs(L,{align:e,children:[t.jsx(rs,{value:S,placeholder:"0.0",decimals:18,onChange:i=>u(i),style:{width:"calc(100% - 8px)",textAlign:e=="flex-start"?"left":"right",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),t.jsxs(T,{w:"100%",justify:"space-between",children:[t.jsx(N,{fontSize:"12px",fontWeight:"500",children:a?`${n==null?void 0:n.symbol} per ${r==null?void 0:r.symbol}`:`${r==null?void 0:r.symbol} per ${n==null?void 0:n.symbol}`}),s&&t.jsx(N,{fontSize:"12px",fontWeight:"500",children:s})]})]})})})}function Es({handleGetDcaOrderList:a}){const{sellCoin:s,buyCoin:e,sellAmount:S,buyAmount:u,setInvestNum:r,setOrderNum:n,investNum:i,orderNum:x,currentInvest:c,setCurrentInvest:m,pageDirect:l,isDcaRefresh:b,dcaMode:p,setDcaMode:y,sellTotalAmount:h,upperPriceSize:d,lowerPriceSize:v,setLowerPriceSize:j,setUpperPriceSize:H}=ie(),{currentPrice:R,btnStatus:f,findRouterLoading:F,sellBalanceInfo:G,buyBalanceInfo:I,sellAmountValue:B,handleAmountChange:se,handleSelectToken:Z,minPriceValue:$,maxPriceValue:k,handleMinInputChange:O,handleMaxInputChange:W,handlePageToggleDirect:ee,onReverseClick:A,orderSizeError:D,orderInputError:P,orderTimeError:U,priceError:C,sellPerOrder:z,estEndDate:K,platformFee:te,fetchFindAvailableRouterDebounce:ne,cycleFrequency:_e,resetInputAmount:Qe,warningTokenList:Xe}=Cs();g.useEffect(()=>{b&&ne()},[b]);const{currentAccount:ce,onWalletModal:Pe}=Ke(),[Ae,Te]=g.useState("#icon-a-icon_trade"),V=["Minute","Hour","Day","Week","Month"],Ce=w=>Te(w?"#icon-icon_swap1":"#icon-a-icon_trade"),{openDcaOrder:Ze}=Ns(),[le,de]=g.useState(!1),{fetchCoinBalance:ke}=xt(),{signAndExecuteTransaction:Ne,transactionRejected:Je,transactionConfirmation:Le}=qe(),{failedTsToast:Re}=us(),{showInsufficientBalanceToast:ze}=ps(),Ie=async()=>{de(!0);const w={getShowInfo:Q=>{`${E(h)}${s==null?void 0:s.symbol}${e==null?void 0:e.symbol}${x}`;const X={modalDescriptionText:"Creating DCA Order",toastTitleText:"Creating DCA Order"};return Q==="success"&&(X.modalDescriptionText="DCA Order Created",X.toastDescriptionContent="",X.toastTitleText="DCA Order Created"),X}};Le(w);const Y=l?_(1).div(k).toString():$,me=l?_(1).div($).toString():k;try{const Q={in_coin:s,out_coin:e,in_coin_amount:h,cycle_count:x,min_price:Y,max_price:me,freq:_e};console.log("ðŸš€ ~ toOpenDca ~ params:",!l,$,k,Y,me,Q);const X=await Ze(Q);console.log("ðŸš€ ~ toOpenDca ~ tx:",X);const ve=await Ne(X,w);console.log("ðŸš€ ~ toOpenDca ~ res:",ve),ve&&(Qe(),setTimeout(()=>{ke(ce==null?void 0:ce.address,s==null?void 0:s.coin_type),a(ce==null?void 0:ce.address)},2e3)),de(!1)}catch(Q){const X={getShowInfo:ve=>{const o={};return String(Q)==="Error: Each order size should be higher than $10"&&(o.toastTitleText="Transaction Submission Error",o.toastDescriptionContent="Each order size should be higher than $10."),String(Q)==="Error: Request timed out"&&(o.toastTitleText="Request timed out",o.toastDescriptionContent="Please confirm the network status and resubmit the transaction."),String(Q)==="Error: minPrice error"&&(o.toastTitleText="DCA order submission failed",o.toastDescriptionContent="Your nominated prices are out of scope. Please modify your accepted price range and submit it again."),o}};console.log("ðŸš€ ~ toOpenDca ~ error:",Q),console.error("Open DCA Order Error: ",Q),ze(String(Q)),Je(X),Re(X),de(!1)}},{currentCoinKey:pe,inCoinWhiteList:Se,outCoinWhiteList:Me,dcaConfig:xe}=ie(),{getDcaCoinWhiteList:et}=ks(),[We,ae]=g.useState([]);g.useEffect(()=>{pe=="sellCoin"?ae(Se):ae(Me)},[pe,Se,Me]),g.useEffect(()=>{xe&&(xe.whitelistMode||xe.whitelistMode==0)&&(console.log("ðŸš€ðŸš€ðŸš€ ~ file: DcaInputBlock.tsx:101 ~ DcaInputBlock ~ dcaConfig:",xe),et(xe.whitelistMode))},[xe]);const[Be,He]=g.useState(!1),be=g.useMemo(()=>{const w=l?e==null?void 0:e.decimals:s==null?void 0:s.decimals;let Y="",me="",Q="",X="";return $&&k&&(Y=l?we(_(1).div(k).toString(),w,!0).toString():$,me=l?we(_(1).div($).toString(),w,!0).toString():k,Q=l?$:we(_(1).div(k).toString(),w,!0).toString(),X=l?k:we(_(1).div($).toString(),w,!0).toString()),{estEndDate:K,sellPerOrder:z,platformFee:te,minPriceValue:Y,maxPriceValue:me,minPriceResever:Q,maxPriceResever:X}},[l,K,z,te,$,k]),tt=[{label:"Total",value:"total"},{label:"Per Order",value:"perOrder"}],[st,Ue]=g.useState([0,0]),[at,it]=g.useState(0),[oe,nt]=g.useState(0),ct=w=>{console.log("ðŸš€ ~ handleSlider ~ val:",w),Ue(w),O(w[0].toString()),W(w[1].toString())};return g.useEffect(()=>{if($&&k){const w=Number($),Y=Number(k);Ue([w,Y]),console.log("ðŸš€ ~ useEffect ~ start:",w,Y)}$||j("0%"),k||H("0%")},[$,k]),g.useEffect(()=>{if(R){const w=_("-100").div(100).plus(1).mul(R).toNumber(),Y=_("100").div(100).plus(1).mul(R).toNumber();console.log("ðŸš€ ~ useEffect ~ min:",w,Y),it(w),nt(Y)}},[R]),t.jsxs(L,{w:"100%",children:[t.jsx(ys,{onClick:A,currentCoinKey:pe,whiteTokenList:We,from:{inputTabOptions:{type:"outlineTab",tabList:tt,currentTab:p=="total"?"Total":"Per Order",handleChangeTab:w=>{y(w==null?void 0:w.value)},wrapStyle:{w:"168px",h:"28px",p:"3px",borderRadius:"10px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px",borderRadius:"6px"}},title:"You Pay",balance:(G==null?void 0:G.balanceFormat)||"",value:S,amountValue:B,loading:!1,onChange:se,selectable:!0,placeholder:"0.0",token:s,whiteTokenList:Se,onTokenChange:w=>Z(w,!0)},to:{isDcaTo:!0,wrapStyle:{backgroundColor:"bg_secondary",h:"94px"},title:"You Receive",inputAllowed:!1,balance:(I==null?void 0:I.balanceFormat)||"",value:"",amountValue:"",loading:!1,onChange:()=>{},token:e,whiteTokenList:Me,onTokenChange:w=>Z(w,!1),selectable:!0,placeholder:"",half:!1,max:!1},iconParams:{xlinkHref:Ae,svgFill:"text_caption",transform:Ae==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:Ae==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>Ce(!0),onMouseLeave:()=>Ce(!1)}}),(D==null?void 0:D.status)&&t.jsx(Ee,{tips:D==null?void 0:D.tips,bg:"primary_red_bg"}),t.jsxs(T,{w:"100%",children:[t.jsx(Dt,{title:"Invest Every",label:c,inputValue:i,list:V,onListItemClick:w=>{m(w)},inputChange:w=>{console.log("ðŸš€ ~ DcaInputBlock ~ item:",w),r(w)}}),t.jsx(Dt,{title:t.jsx(hs,{type:"over",children:t.jsx(N,{fontSize:"13px",fontWeight:"500",mr:"4px",children:"Over"})}),label:"Orders",inputValue:x,inputChange:w=>{n(w),ne()}})]}),(P==null?void 0:P.status)&&t.jsx(Ee,{tips:P==null?void 0:P.tips,bg:"primary_red_bg"}),(U==null?void 0:U.status)&&t.jsx(Ee,{tips:U==null?void 0:U.tips,bg:"primary_red_bg"}),t.jsxs(je,{zIndex:"1",p:"16px",borderRadius:"16px",children:[t.jsxs(L,{align:"flex-start",children:[t.jsx(N,{color:"text_caption",children:"Set Price Range"}),t.jsx(N,{lineHeight:"16px",fontSize:"12px",m:{base:"4px 0",lg:"0"},mb:{base:S?"4px":"0"},children:"DCA will only be executed if the price falls within the range of your pricing strategy."}),S&&z&&t.jsxs(T,{mt:"8px",w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"align",lg:"center"},children:[t.jsx(N,{children:"Current Rate"}),t.jsx(L,{align:{base:"flex-start",lg:"flex-end"},children:t.jsx(ds,{color:"text_caption",pageDirect:l,handlePageToggleDirect:ee,fromToken:s,toToken:e,fromValue:z,toValue:u,isLoading:F||!u||!z})})]})]}),t.jsxs(T,{justify:"space-between",gap:"8px",mt:"20px",children:[t.jsx(wt,{direct:l,text:S&&$?v:"",inputValue:$,inputChange:w=>O(w),align:"flex-start"}),t.jsx(N,{color:"text_caption",children:"-"}),t.jsx(wt,{direct:l,text:S&&k?d:"",inputValue:k,inputChange:w=>W(w),align:"flex-start"})]}),!F&&S&&$&&k&&Number(k)>=Number($)&&(f==null?void 0:f.text)!=="No Available Route"&&t.jsxs(L,{w:"100%",gap:"0",mt:"20px",children:[t.jsxs(Vt,{min:at,max:oe,step:.1,value:st,onChange:w=>{ct(w)},colorScheme:"teal",children:[t.jsx(qt,{children:t.jsx(Yt,{})}),t.jsx(gt,{index:0}),t.jsx(gt,{index:1})]}),t.jsx(Kt,{src:gs,w:"32px",h:"32px"}),t.jsx(T,{w:"100%",h:"14px",justify:"center",mt:"-2px",children:t.jsx(N,{children:"Current Rate"})})]})]}),(C==null?void 0:C.status)&&t.jsx(Ee,{tips:C==null?void 0:C.tips,bg:"primary_red_bg"}),t.jsx(ye,{isLoading:le,disabled:(f==null?void 0:f.disabled)||le,w:"100%",h:"52px",fontSize:"18px",fontWeight:"500",onClick:(f==null?void 0:f.text)=="Connect Wallet"?()=>Pe(!0):()=>He(!0),children:f==null?void 0:f.text}),S&&t.jsx(Ms,{detailsData:be}),Be&&t.jsx(Rs,{confirmData:be,isOpen:Be,onClose:()=>He(!1),toOpenDca:Ie,toOpenDcaLoading:le}),(e||s)&&t.jsx(_s,{addToken:!0,tokensInfo:Xe,waringModalCancel:w=>{w.forEach(Y=>{(Y.coin_type===(e==null?void 0:e.coin_type)||Y.coin_type===(s==null?void 0:s.coin_type))&&Z(void 0,Y.coin_type===(e==null?void 0:e.coin_type))})}})]})}function $s(a){const n=Math.floor(a/2592e3);a%=2592e3;const i=Math.floor(a/604800);a%=604800;const x=Math.floor(a/86400);a%=86400;const c=Math.floor(a/3600);a%=3600;const m=Math.floor(a/60);a%=60;const l=[];return n>0&&l.push(`${n} Month${n>1?"s":""}`),i>0&&l.push(`${i} Week${i>1?"s":""}`),x>0&&l.push(`${x} Day${x>1?"s":""}`),c>0&&l.push(`${c} Hour${c>1?"s":""}`),m>0&&l.push(`${m} Minute${m>1?"s":""}`),l.join(" ")}function Ls(){const{getTokenListInfo:a}=Ct(),{peripherySdk:s}=fe(),e=async c=>{var m;console.log("ðŸš€ ~ getDcaOrderList ~ walletAddress:",c);try{const l=await s.Dca.getDcaOrders(c);return console.log("ðŸš€ ~ getDcaOrderList ~ list:",l),l&&(l!=null&&l.data)&&((m=l==null?void 0:l.data)==null?void 0:m.length)>0?await x(l==null?void 0:l.data):{activeResult:[],pastResult:[]}}catch(l){return console.log("ðŸš€ ~ getDcaOrderList ~ error:",l),{activeResult:[],pastResult:[]}}},S=async c=>{try{const m=await a(c),l=new Map;return m==null||m.forEach((b,p)=>{const y=ge.pow(10,b==null?void 0:b.decimals);l.set(p,{token:b,decimalsPow:y})}),l}catch(m){console.log("ðŸš€ ~ getTokenListDetails ~ error:",m)}},u=(c,m,l,b,p)=>{const y=_(c).div(m).div(_(b).div(l)).toString(),h=_(c).div(m).div(_(p).div(l)).toString();return{minPrice:y,maxPrice:h,minPriceResever:_(1).div(_(h)).toString(),maxPriceResever:_(1).div(_(y)).toString()}},r=c=>c.in_withdrawn>0&&c.in_withdrawn==c.in_deposited?"Close":c.in_withdrawn>0&&c.out_withdrawn>0?"PartialDeal":c.amount_left_next_cycle==0&&c.next_cycle_at==0?"AllDeal":"Active",n=(c,m,l,b,p,y,h)=>{const d=v=>v==="--"?"--":_(1).div(v).toString();switch(c){case"Close":return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"};case"PartialDeal":{const v=m.sub(l).div(y).toString(),j=m.sub(l).div(m).mul(100).toDP(2,ge.ROUND_HALF_UP).toString();return console.log("ðŸš€ ~ useGetDcaOrderList ~ inDeposited:",l,m),{currentAvgPrice:v,currentAvgPriceResever:d(v),inBalanceRatio:j,inDepositedOut:m.sub(l).toString()}}case"AllDeal":{const v=m.div(y).toString();return{currentAvgPrice:v,currentAvgPriceResever:d(v),inBalanceRatio:"100",inDepositedOut:m.sub(b).toString()}}case"Active":{const v=p.gt(0)||y.gt(0)?m.sub(b).div(p.add(y)).toString():"--",j=m.sub(b).div(m).mul(100).toDP(2,ge.ROUND_HALF_UP).toString();return{currentAvgPrice:v,currentAvgPriceResever:d(v),inBalanceRatio:j,inDepositedOut:m.sub(b).toString()}}default:return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"}}},i=(c,m,l,b)=>{const p=Date.now()/1e3,y=_(p).sub(c).div(m),h=l.lte(0)&&_(b).lte(0);return y.gt(3)&&h},x=async c=>{const m=[],l=[],b=[];c==null||c.forEach(d=>{b.push(d.in_coin_type),b.push(d.out_coin_type)});const p=await S(b);if(p)for(const d of c){const{token:v,decimalsPow:j}=p.get(d.in_coin_type),{token:H,decimalsPow:R}=p.get(d.out_coin_type),f=_(d.in_deposited).div(j);console.log("ðŸš€ ~ buildDcaOrderList ~ order.in_deposited:",d.in_deposited,j);const F=_(d.in_deposited).div(d.in_amount_per_cycle).floor().toString(),G=_(d.in_amount_per_cycle).div(j).toString(),I=_(d.in_balance).div(j),B=_(d.in_withdrawn).div(j),se=_(d.out_balance).gt(0)?_(d.out_balance).div(R):_(0),Z=_(d.out_withdrawn).div(R),$=E(f.div(F).toString()),k=I.div(G).floor().toNumber(),{minPrice:O,maxPrice:W,minPriceResever:ee,maxPriceResever:A}=u(d.in_amount_per_cycle,j,R,d.max_out_amount_per_cycle,d.min_out_amount_per_cycle),D=r(d),{currentAvgPrice:P,currentAvgPriceResever:U,inBalanceRatio:C,inDepositedOut:z}=n(D,f,B,I,se,Z),K=i(d.created_at,d.cycle_frequency,se,Z),te={createAt:$e(d.created_at*1e3,"YMDHM"),cycleFrequency:d.cycle_frequency,orderID:d.id,inAmountPerCycle:G,nextCycleAt:$e(d.next_cycle_at*1e3,"YMDHM"),inDeposited:f.toString(),cycleCount:F,inDepositedOut:z,inBalance:I.toString(),minPrice:E(O),maxPrice:E(W),minPriceResever:E(ee),maxPriceResever:E(A),inCoin:v,outCoin:H,outBalance:se.toString(),inBalanceRatio:C,outWithdraw:Z.toString(),investEvery:$s(d.cycle_frequency),eachOrderSize:$,currentAvgPrice:P==="--"?"--":E(P,H.decimals),currentAvgPriceResever:P==="--"?"--":E(U,v.decimals),orderStatus:D,inWithdrawn:B.toString(),ofOrderLeft:k,isShowTradeTips:K,next_cycle_at:d.created_at+k*d.cycle_frequency,created_at:d.created_at,version:d.version};D==="Active"?m.push(te):l.push(te)}const y=m==null?void 0:m.sort((d,v)=>v.version-d.version),h=l==null?void 0:l.sort((d,v)=>v.version-d.version);return console.log("ðŸš€ ~ buildDcaOrderList ~ activeResult, pastResult:",y,h,m,l),{activeResult:y,pastResult:h}};return{getDcaOrderList:e}}function Da(){const[a,s]=g.useState([]),[e,S]=g.useState([]),{currentAccount:u}=Ke(),{sellCoin:r,buyCoin:n,setIsDcaRefresh:i}=ie(),[x,c]=g.useState(!0),{isShowTradeChart:m,isShowTradeOrders:l}=bs(),{getDcaOrderList:b}=Ls(),{fetchAccountBalance:p}=xt(),y=async(R,f=!1)=>{if(!l)return;f&&c(!0);const{activeResult:F,pastResult:G}=await b(R);s(F),S(G),c(!1),console.log("ðŸš€ ~ handleGetDcaOrderList ~ list:",F,G)};g.useEffect(()=>{u!=null&&u.address?y(u==null?void 0:u.address,!0):(s([]),S([]))},[u==null?void 0:u.address,l]);const h=(R=!0)=>{H(0),i(!0),setTimeout(()=>{i(!1)},1e3),u!=null&&u.address&&(R||p(),y(u==null?void 0:u.address,R))};Ds({onRpcChange:()=>{h()}}),g.useEffect(()=>{u!=null&&u.address&&p()},[u==null?void 0:u.address]);const{isApp:d,windowWidth:v}=Ye(),[j,H]=g.useState(0);return vs({interval:1e3,callback:()=>{H(j+1),j>=20&&h(!1)}}),t.jsxs(T,{mt:v&&v<1024?"28px":"42px",className:d||m||l?"":"bg_img",w:"100%",gap:"16px",justify:"center",align:"flex-start",flexDirection:{base:"column",lg:"row"},children:[(l||m)&&t.jsxs(L,{w:{base:"100%",lg:"calc(100% - 470px)"},mt:d&&!m?"-16px":"0",children:[m&&t.jsx(Ss,{baseToken:r,quoteToken:n}),l&&!d&&t.jsx(vt,{handleRefresh:h,activeList:a,pastList:e,isOrderLoading:x})]}),t.jsxs(L,{w:{base:"100%",lg:"470px"},children:[t.jsxs(T,{w:"100%",justify:"space-between",mb:"8px",children:[t.jsx(Zt,{currTradeTab:Jt.DCA}),t.jsx(Xt,{})]}),t.jsx(Es,{handleGetDcaOrderList:R=>y(R)})]}),d&&l&&t.jsx(L,{w:{base:"100%",lg:"calc(100% - 470px)"},children:t.jsx(vt,{handleRefresh:h,activeList:a,pastList:e,isOrderLoading:x})})]})}export{Da as default};
//# sourceMappingURL=Dca-DJIUhsXM.js.map
