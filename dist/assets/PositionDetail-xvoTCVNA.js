import{a as n,j as i,a6 as qe,T as w,V as U,H as m,p as de,ap as Si,q as Oe,R as vi,f as Ue,aa as Ci,ar as _i}from"./vendor-BFGDaAdA.js";import{A as Ri}from"./index-GyGBrh10.js";import{C as Li}from"./CoinPairInfo-OoAbQ1TG.js";import{v as ei,S as Fi}from"./usePriceImpact-4JS4N4m1.js";import{u as Mi,L as Ei,S as Ee}from"./LiquidityRangeChart-CaQVA8Ps.js";import{u as oi,a as Di}from"./useTransaction-Qu1VUoVV.js";import{u as Vi,a as Wi,P as Gi}from"./PositionCurrentPrice-C8GroK-R.js";import{a as Se,b as Ye}from"./useNotifiSubscription-HYhRq0hn.js";import{b as Ni,c as Zi,a as je,d as xi,e as Hi,f as zi}from"./usePositionList-T26pIiiH.js";import{k as Ve,x as oe,a as $e,B as ce,e as ii,V as ue,O as ni,d as ne,h as ci,o as Qe,t as qi,$ as Oi,r as si,a1 as Ui,q as Yi,a2 as li,Z as $i,Y as Qi,a0 as Ji,a8 as Ki,f as Xi,v as ti,j as fi}from"./index-kSv1GEZK.js";import{u as Je}from"./useAccountBalance-ipW6zvru.js";import{S as Bi,A as Ii}from"./SingleTokenInfo-CxDnrq5B.js";import{L as Pi}from"./ExpendItem-339athyV.js";import{c as es,e as is,a as ss,h as ls,T as ts,g as as,Z as ps,F as ds,R as os,b as xs,i as ns}from"./RemoveBlock-RjaYWG-3.js";import{u as cs}from"./global-TqpROtN0.js";import{f as De}from"./index-BCDZ3trS.js";import{u as ai}from"./useTokenBalance-wBMA8Bie.js";import{u as ms}from"./useInsufficientBalanceToast-Dk7T_RPj.js";import{u as gs}from"./usePosAdd-D57w7PWP.js";import{T as rs}from"./TradeInputGroup-nd2gMior.js";import{T as hs}from"./TooltipIcon-BqjAFCHw.js";import{P as bs}from"./PositionStatus-D1_wkFL8.js";import{R as js}from"./RangeValue-DPvLoGIA.js";import{u as ys}from"./index-q9FPWOOz.js";import{b as ws,u as Ts}from"./useGetPoolList-CK7rGDcp.js";import{u as ks}from"./swapWidget-DYt9dBnI.js";import{B as As}from"./BackButton-Bpkh5RkE.js";import{R as pi}from"./RefreshButton-CZiIdImI.js";import{u as us}from"./useRpcListener-B60ohF0u.js";import"./PoweredByHaedal-Bke0Bj0w.js";import"./useSwapHelper-BUyTnJPg.js";import"./useToken-D3gZx9-B.js";import"./HTextLabelBox-DY5pCUoP.js";import"./VTextLabelBox-B3-EojAL.js";import"./contract-helper-Cr1Xq0aQ.js";import"./linear-DYpwdEgO.js";import"./liquidity-Bdpb-W9f.js";import"./usePreviousValue-DoVr3Y3V.js";import"./ActionButton-D6JEowp_.js";import"./useTrack-DQcyJcyc.js";import"./useSigner-K03QZbUa.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-DQN13C6D.js";import"./useXCetusHelper-CzuY9fAF.js";import"./index-D1m9ooSc.js";import"./debounce-B8kzHASh.js";import"./index-BLCSsYSf.js";import"./useFavoritePool-CZ2tR_8p.js";import"./useWrapPoolData-DlhDhx9m.js";import"./CopyButton-CuWPyIpT.js";import"./DepositRatio-BcGYqJxD.js";import"./FreshProgressV2-VhYu_mZQ.js";import"./ErrorTips-CGuX2lAc.js";import"./_getAllKeysIn-BUPGwtle.js";function Ss(){var ie,Y,N,z,$,X;const{tokenAmountAfterA:e,tokenAmountAfterB:x,currentPosDetailTab:d,curPosContractPoolInfo:t}=Se(),{getPosFeeData:D}=Ni(),{getPosRewardsData:r}=Zi(),{currentAccount:c}=Ve(),{currentPosBaseInfo:s,posFeeData:a,posRewardsData:j,posLiquidityData:_,currentPosBaseInfoLoading:H,posFeeDataLoading:R,posRewardsDataLoading:M}=je();Ye();const p=n.useMemo(()=>_[s==null?void 0:s.posId],[_,s==null?void 0:s.posId]),L=n.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",a[s==null?void 0:s.posId]),a[s==null?void 0:s.posId]),[a,s==null?void 0:s.posId]),l=n.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",j[s==null?void 0:s.posId]),j[s==null?void 0:s.posId]),[j,s==null?void 0:s.posId]);oe(p==null?void 0:p.displayCoinAmountA,void 0,!0),oe(p==null?void 0:p.displayCoinAmountB,void 0,!0);const[S,F]=n.useState(!1),[V,A]=n.useState("--"),{signAndExecuteTransaction:W}=oi(),{getPosClaimFeeAndRewardTxPayload:G}=Vi(),{calculatePendingYield:v}=Wi();n.useEffect(()=>{if(!H&&!R&&!M){const{total:k}=v([s],a,j);A(k)}},[H,R,M]);const{fetchAccountBalance:ee}=Je(),q=async()=>{F(!0);try{const k=(l==null?void 0:l.map(Z=>Z.coin_address))||[],f={posType:s==null?void 0:s.posType,id:s==null?void 0:s.id,clmmPool:s==null?void 0:s.clmmPool,coinTypeA:s==null?void 0:s.coinTypeA,coinTypeB:s==null?void 0:s.coinTypeB,rewarderCoinTypes:k,account:c==null?void 0:c.address};console.log("ðŸš€ ~ toClaim ~ params.currentPosBaseInfo:",f,s);const{tx:u,msafeParams:Q}=await G(f);console.log("ðŸš€ ~ toClaim ~ tx:",u);const y=await W(u,{getShowInfo:Z=>{const O={modalDescriptionText:"",toastTitleText:""};return Z==="success"&&(O.toastTitleText="Claim Successful"),O}},{msafeParams:Q});console.log("ðŸš€ ~ toClaim ~ res:",y),y&&setTimeout(()=>{ee(),D([s]),r([s],{[t.poolAddress]:t})},2e3),F(!1)}catch(k){F(!1),console.log("ðŸš€ ~ toClaim ~ error:",k)}},E=e!==""||x!=="",{isApp:T}=$e();return i.jsxs(ce,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(ce,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(qe,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(w,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(Pi,{positionInfo:s,haveTooltip:!1})]}),i.jsxs(U,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(m,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(m,{gap:"4px",children:[i.jsx(ii,{imageUrl:(ie=s==null?void 0:s.displayTokenA)==null?void 0:ie.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(Y=s==null?void 0:s.displayTokenA)==null?void 0:Y.coin_type:""}),i.jsx(de,{isLoaded:!!s&&!!p,children:i.jsxs(m,{gap:"4px",children:[i.jsx(w,{color:"primary",children:ue((N=s==null?void 0:s.displayTokenA)==null?void 0:N.symbol)}),i.jsxs(w,{color:"primary",children:[p==null?void 0:p.displayPercentA,"%"]})]})})]}),i.jsxs(m,{gap:"4px",children:[i.jsx(ii,{imageUrl:(z=s==null?void 0:s.displayTokenB)==null?void 0:z.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?($=s==null?void 0:s.displayTokenB)==null?void 0:$.coin_type:""}),i.jsx(de,{isLoaded:!!s&&!!p,children:i.jsxs(m,{gap:"4px",children:[i.jsx(w,{color:"primary_green",children:ue((X=s==null?void 0:s.displayTokenB)==null?void 0:X.symbol)}),i.jsxs(w,{color:"primary_green",children:[p==null?void 0:p.displayPercentB,"%"]})]})})]})]}),i.jsx(Si,{w:"200px",h:"4px",value:p==null?void 0:p.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(m,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ae,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:p==null?void 0:p.displayCoinAmountA,afterAmount:e}),i.jsx(Ae,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:p==null?void 0:p.displayCoinAmountB,afterAmount:x})]}),i.jsx(ce,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(m,{w:"100%",justify:"space-between",children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(w,{color:"primary_gray",children:"Pending Yield"}),i.jsx(de,{isLoaded:!!V&&!!s&&!!a&&!!j,children:i.jsx(w,{color:"text_caption",fontSize:"16px",children:ni(V,2)})})]}),i.jsx(Oe,{isLoading:S,disabled:Number(V)==0||R||M||S||!L,onClick:q,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(m,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ae,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:L==null?void 0:L.displayFeeOwedA,afterAmount:E?"0":""}),i.jsx(Ae,{label:T?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:L==null?void 0:L.displayFeeOwedB,afterAmount:E?"0":""}),l==null?void 0:l.map((k,f)=>i.jsx(vi.Fragment,{children:ne(k.amount_owed).gt(0)&&i.jsx(Ae,{label:T?f==0?"Mining Rewards":"":"Mining Rewards",token:k==null?void 0:k.token,amount:k==null?void 0:k.display_amount_owed,afterAmount:E?"0":""})},k==null?void 0:k.coin_address))]})]})}const Ae=({label:e,token:x,amount:d,afterAmount:t,isLoading:D})=>{const{isApp:r}=$e(),{getExplorerUrl:c}=ci();return i.jsxs(U,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(m,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(w,{color:"primary_gray",children:e}),i.jsxs(m,{children:[i.jsx(Ue,{onClick:r?()=>window.open(c(x==null?void 0:x.coin_type,"coin")):()=>{},children:i.jsx(Bi,{haveTooltip:!r,coinType:x?x==null?void 0:x.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(de,{isLoaded:!D&&!!d,children:i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:oe(d)})}),i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:ue(x==null?void 0:x.symbol)})]})]}),t!==""&&t&&i.jsxs(m,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",children:oe(t)}),i.jsx(w,{color:"primary",children:"after"})]})]})};function vs(){const{currentPosBaseInfo:e,posPoolsOriginalData:x,posPoolsRelatedData:d,posRewardsData:t,posLiquidityData:D}=je(),r=t[e==null?void 0:e.posId],{getTokenAmountValue:c}=Qe(),{transactionConfirmation:s}=Di(),{preAdd:a,getAddTsPayload:j,getClmmCreateAddData:_,getFarmsCreateAddData:H}=gs(),{getTokenALock:R,getTokenBLock:M}=xi(),{getCurrentPosBaseInfo:p}=Ye(),{setTokenAmountAfterA:L,setTokenAmountAfterB:l,currentPoolSqrtPrice:S,isFixedDisplayTokenA:F,setIsFixedDisplayTokenA:V,curPosContractPoolInfo:A,currentPosDetailTab:W,isPosDetailRefresh:G,useZapIn:v}=Se(),{getZapDepositToastInfo:ee,getZapDepositTx:q,reCalculateZapData:E}=es(),{preDepositeData:T,setZapAmount:ie,setPreDepositeData:Y}=is(),[N,z]=n.useState(!1),[$,X]=n.useState(""),[k,f]=n.useState(""),[u,Q]=n.useState(""),[y,Z]=n.useState(""),O=n.useMemo(()=>D[e==null?void 0:e.posId],[D,e==null?void 0:e.posId]),h=oe(O==null?void 0:O.displayCoinAmountA,void 0,!0),se=oe(O==null?void 0:O.displayCoinAmountB,void 0,!0);n.useEffect(()=>{if(+u||+y){const o=+u,b=+y;L(ne(o).plus(h).toString()),l(ne(b).plus(se).toString())}else L(""),l("")},[u,y]);const g=e==null?void 0:e.displayTokenA,C=e==null?void 0:e.displayTokenB,{mevProtect:ve,maxCapForGas:Ce,transactionMode:B,customGasPrice:mi}=cs(),{balanceInfo:ye}=ai(g),{balanceInfo:we}=ai(C),gi=c(g==null?void 0:g.coin_type,u),ri=c(C==null?void 0:C.coin_type,y),[We,Ge]=n.useState(""),Ke=n.useRef("");n.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",We),Ke.current=We},[We]);const Te=()=>{Q(""),Z(""),z(!1),Ge("")},_e=n.useMemo(()=>R(e,A),[A==null?void 0:A.current_tick_index,e]),Re=n.useMemo(()=>M(e,A),[A==null?void 0:A.current_tick_index,e]),Ne=e!=null&&e.isReverse?Re:_e,Ze=e!=null&&e.isReverse?_e:Re;n.useEffect(()=>{Te()},[Ne,Ze]);const Xe=qi((o,b,J)=>{var be,P;if(W!=="increase")return;const K=b?(be=e==null?void 0:e.displayTokenA)==null?void 0:be.decimals:(P=e==null?void 0:e.displayTokenB)==null?void 0:P.decimals,ke=Oi(o,K),Fe=e==null?void 0:e.tokenA,le=e==null?void 0:e.tokenB,te=e==null?void 0:e.lowerTick,me=e==null?void 0:e.upperTick,ge=e==null?void 0:e.isReverse,ae={amount:ke,tokenA:Fe,tokenB:le,isTokenA:ge?!b:b,lowerTick:te,upperTick:me,curSqrtPrice:S,isReverse:ge,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",ae);const{displayCoinAmountA:xe,displayCoinAmountB:re,tokenMaxA:he,tokenMaxB:pe}=a(ae);Ke.current===J?(X(he),f(pe),b?Z(re||""):Q(xe||"")):Te(),z(!1)},500),Le=()=>{if((u||y)&&Ui(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const o=F?u:y;if(+o){const b=ei();Ge(b),Xe(o,F,b)}}};n.useEffect(()=>{W=="increase"&&G&&Le()},[G]);const hi=(o,b)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!o,+o,o),!o){Te();return}if(V(b),b?Q(o):Z(o),+o){z(!0);const J=ei();Ge(J),console.log("ðŸš€ ~ handleAmountChange ~ params:",o),Xe(o,b,J)}else b?Z(""):Q("")},{currentAccount:I}=Ve(),bi=n.useMemo(()=>{const o={text:"Add More Liquidity",disabled:!1};return I!=null&&I.address?!+u&&!+y?(o.text="Enter an amount",o.disabled=!0,o):!Ne&&u&&ne(u).gt((ye==null?void 0:ye.balanceFormat)||0)?(o.disabled=!0,o.text=`Insufficient ${ue(g==null?void 0:g.symbol,10)} Balance`,o):!Ze&&y&&ne(y).gt((we==null?void 0:we.balanceFormat)||0)?(o.disabled=!0,o.text=`Insufficient ${ue(C==null?void 0:C.symbol,10)} Balance`,o):((!_e&&!Re&&(!+u||!+y)||(e==null?void 0:e.posType)=="burn")&&(o.disabled=!0),o):(o.text="Connect Wallet",o.disabled=!1,o)},[u,y,ye,we,I==null?void 0:I.address]),{signAndExecuteTransaction:ji}=oi(),{getContractPoolInfo:yi}=ss(),[wi,He]=n.useState(!1),{fetchAccountBalance:Ti}=Je(),{showInsufficientBalanceToast:ki}=ms(),Ai=async()=>{var o;He(!0);try{let b,J,K;const ke=(o=r||[])==null?void 0:o.reduce((le,te)=>(ne(te==null?void 0:te.amount_owed).gt(0)&&le.push(te.coin_address),le),[]);if(v)K=ee(),s(K),b=await q(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:ke});else{const le=F?u:y,te=F?g.decimals:C.decimals,me=ne(le).mul(Yi.pow(10,te)).toString(),ge=e!=null&&e.isReverse?!F:F;let ae,xe;const re=e==null?void 0:e.lowerTick,he=e==null?void 0:e.upperTick,pe=A==null?void 0:A.current_tick_index;pe!==void 0&&re!==void 0&&he!==void 0&&(pe>=re&&pe<=he?(ae=ge?me:$,xe=ge?k:me):pe>he?(ae=0,xe=me):pe<re&&(ae=me,xe=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",re,he,pe),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,ae,xe),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",r,ke);const be={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:ae,amountB:xe,fixAmountA:ge,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:S,posType:e==null?void 0:e.posType,rewarderCoinTypes:ke,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(be.farmsPoolId=e==null?void 0:e.farmsPool),K={getShowInfo:(ui,ze)=>{const fe="Add "+[De(u,g==null?void 0:g.symbol),De(y,C==null?void 0:C.symbol)].filter(Boolean).join(" and "),Me={modalDescriptionText:fe,toastTitleText:fe};if(ui==="success"){let Be=u,Ie=y;ze&&(Be=li(ze,g)||u,Ie=li(ze,C)||y);const Pe="Add "+[De(Be,g==null?void 0:g.symbol),De(Ie,C==null?void 0:C.symbol)].filter(Boolean).join(" and ");Me.toastDescriptionContent=Pe,Me.modalDescriptionText=Pe,Me.toastTitleText="Supplied Successful"}return Me}},s(K),console.log("ðŸš€ ~ toAdd ~ params:",be);const P=await j(be);b=P==null?void 0:P.tx,J=P==null?void 0:P.msafeParams}const Fe=await ji(b,K,{useMev:ve,useFastMode:B==="Fast Mode",maxCapForGas:Ce,customGasPrice:mi,msafeParams:J});console.log("ðŸš€ ~ toClaim ~ res:",Fe),Fe?(Ti(),Te(),ie(""),p(I==null?void 0:I.address,e==null?void 0:e.id,!0)):e&&yi(e==null?void 0:e.clmmPool).then(le=>{console.log("ðŸš€ ~ toClaim ~ res:",le),v?E():Le()}),He(!1)}catch(b){console.log("ðŸš€ ~ toClaim ~ error:",b),v?E():Le(),ki(String(b)),He(!1)}};return n.useEffect(()=>{if(W==="increase"&&v){if(T!=null&&T.amount_a||T!=null&&T.amount_b){const o=e==null?void 0:e.tokenA,b=e==null?void 0:e.tokenB,J=si(T==null?void 0:T.amount_a,o==null?void 0:o.decimals),K=si(T==null?void 0:T.amount_b,b==null?void 0:b.decimals);Q(e!=null&&e.isReverse?K:J),Z(e!=null&&e.isReverse?J:K);return}Q(""),Z("")}},[v,T,e==null?void 0:e.isReverse]),n.useEffect(()=>(Q(""),Z(""),()=>{Y(void 0)}),[]),{tokenAmountA:u,tokenAmountB:y,reCalculateResult:Le,preAddLoading:N,preAdd:a,getAddTsPayload:j,displayTokenA:g,displayTokenB:C,tokenABalanceInfo:ye,tokenBBalanceInfo:we,tokenAmountValueA:gi,tokenAmountValueB:ri,handleAmountChange:hi,resetInputAmount:Te,btnStatusText:bi,toAdd:Ai,isAddLoading:wi,showTokenALock:_e,showTokenBLock:Re,showDisplayTokenALock:Ne,showDisplayTokenBLock:Ze,getClmmCreateAddData:_,getFarmsCreateAddData:H,currentPoolSqrtPrice:S}}function Cs(){const{currentPosBaseInfo:e,posPoolsRelatedData:x,posApiPoolData:d}=je(),{currentAccount:t,onWalletModal:D}=Ve(),{isFixedDisplayTokenA:r,curPosContractPoolInfo:c,useZapIn:s,currentPosPoolInfo:a}=Se(),{tokenAmountA:j,tokenAmountB:_,displayTokenA:H,displayTokenB:R,tokenABalanceInfo:M,tokenBBalanceInfo:p,tokenAmountValueA:L,tokenAmountValueB:l,handleAmountChange:S,preAddLoading:F,btnStatusText:V,toAdd:A,isAddLoading:W,showDisplayTokenALock:G,showDisplayTokenBLock:v,resetInputAmount:ee,currentPoolSqrtPrice:q}=vs();n.useEffect(()=>()=>{ee()},[]);const{getTokenAmountValue:E}=Qe(),T=E(H==null?void 0:H.coin_type,j,"--"),ie=E(R==null?void 0:R.coin_type,_,"--"),Y=T=="--"||ie=="--"?"--":$i(L).plus(l).toString(),N=x[e==null?void 0:e.posId],{currentApiPoolInfo:z}=ls(e,d);return i.jsxs(U,{w:"100%",gap:"8px",children:[i.jsxs(Ue,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(z==null?void 0:z.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!G&&!v&&i.jsx(ts,{action:"Deposit",resetInputAmount:ee}),s?i.jsx(as,{action:"Deposit",apiPoolInfo:z,currentSqrtPrice:q,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(rs,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(M==null?void 0:M.balanceFormat)||"",value:j,amountValue:L,loading:!r&&F,onChange:$=>{S($,!0)},placeholder:"0.0",token:H,lock:{isLock:e&&c&&G,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(p==null?void 0:p.balanceFormat)||"",value:_,amountValue:l,loading:r&&F,onChange:$=>{S($,!1)},placeholder:"0.0",token:R,lock:{isLock:e&&c&&v,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:G||v?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!c||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),s?i.jsx(ps,{action:"Deposit",onClick:A,hideDepositRatio:!0,otherLoading:W,isReverse:e==null?void 0:e.isReverse}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>{t?A():D(!0)},isLoading:W,disabled:V.disabled||W,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:V.text}),Y&&i.jsx(ce,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(m,{w:"100%",justify:"space-between",children:[i.jsx(w,{children:"Total Amount"}),i.jsx(w,{color:"text_caption",children:ni(Y,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&i.jsx(ds,{haveFarming:a==null?void 0:a.haveFarming}),N&&(N==null?void 0:N.minPrice)!=="0"&&(N==null?void 0:N.maxPrice)!=="âˆž"&&i.jsx(os,{subscriptionSource:"PositionDetail"})]})}function _s(){const{currentPosBaseInfo:e}=je(),{currentPosPoolInfo:x,curPosContractPoolInfo:d}=Se(),{setContractPoolInfo:t,setApiPoolInfo:D}=ys(),{lowerTickData:r,upperTickData:c,setLowerTickData:s,setUpperTickData:a}=Mi();Qi(()=>{D(x)},[x]);const j=(R,M,p)=>{var G,v;const L=(G=p==null?void 0:p.tokenA)==null?void 0:G.decimals,l=(v=p==null?void 0:p.tokenB)==null?void 0:v.decimals;let S;Math.abs(R)==Math.abs(Ji.getMinIndex(Number(p.tickSpacing)))?S=M==="lower"?"0":"âˆž":S=Ki.tickIndexToPrice(R,L,l).toString();const F=S==="âˆž"?"âˆž":oe(S,6),V=ws(S),A=V==="âˆž"?"âˆž":oe(V,6),W={id:M,tokenA:p==null?void 0:p.tokenA,tokenB:p==null?void 0:p.tokenB,tick:R,price:S,displayPrice:F,reversePrice:V,displayReversePrice:A,tickSpacing:p==null?void 0:p.tickSpacing,pool:p==null?void 0:p.poolAddress};M==="lower"?s({...W}):a({...W})},{getCurrentPrice:_}=xs();n.useEffect(()=>{e!=null&&e.lowerTick&&(d!=null&&d.current_sqrt_price)&&(x!=null&&x.poolAddress)&&(j(e==null?void 0:e.lowerTick,"lower",{...x,tickSpacing:d.tickSpacing}),j(e==null?void 0:e.upperTick,"upper",{...x,tickSpacing:d.tickSpacing}),_(d==null?void 0:d.current_sqrt_price,x),t(d))},[e==null?void 0:e.lowerTick,d==null?void 0:d.current_sqrt_price,x==null?void 0:x.poolAddress]);const H=n.useMemo(()=>(e==null?void 0:e.posId)&&(r==null?void 0:r.pool)&&(c==null?void 0:c.pool),[r==null?void 0:r.pool,c==null?void 0:c.pool,e==null?void 0:e.posId]);return i.jsx(Ue,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:H&&i.jsx(Ei,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?c:r,maxPriceData:e!=null&&e.isReverse?r:c,readonly:!0})})}function Rs(){const{currentPosBaseInfo:e,posPoolsRelatedData:x,posPoolsOriginalData:d}=je(),t=x[e==null?void 0:e.posId],{getClmmPosName:D}=xi(),r=n.useMemo(()=>{var j;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const _=(j=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:j.index;return D(e==null?void 0:e.index,_)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]);(t==null?void 0:t.displayFee)+"";const c=(t==null?void 0:t.currentStatus)=="Active",s=n.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",t);const j=t==null?void 0:t.minPriceOrigin,_=t==null?void 0:t.maxPriceOrigin;return j!=="0"&&_!=="âˆž"?Xi(1/(1-Number((j/_)**.25)),2)+"x":"1x"},[t==null?void 0:t.minPriceOrigin,t==null?void 0:t.maxPriceOrigin]),{getExplorerUrl:a}=ci();return i.jsxs(ce,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(ce,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(m,{justify:"space-between",children:[i.jsxs(m,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(m,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position ID"}),i.jsx(de,{isLoaded:!!r,children:i.jsx(w,{color:"text_caption",children:r==null?void 0:r.split("|")[1]})})]}),i.jsxs(m,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position NFT"}),i.jsx(de,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Ii,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(a(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),t&&i.jsx(bs,{isActive:c,isLoading:(t==null?void 0:t.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(m,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(U,{gap:{base:"16px",lg:"32px"},children:[i.jsxs(U,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Current Price"}),i.jsx(Gi,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs(U,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Position Range"}),i.jsx(js,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:t==null?void 0:t.minPrice,maxPrice:t==null?void 0:t.maxPrice,minPriceResever:t==null?void 0:t.minPriceResever,maxPriceResever:t==null?void 0:t.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs(U,{gap:"0",children:[i.jsx(_s,{}),i.jsx(U,{zIndex:"9",children:i.jsxs(m,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(hs,{type:"leverage"}),i.jsx(de,{ml:"4px",isLoaded:!!s&&!!t,children:i.jsx(w,{color:"primary",children:s})})]})})]})]})]})}function Ll(){var Z,O;const e=Ci(),{fetchAccountBalance:x}=Je(),{currentAccount:d}=Ve(),{position_nft_id:t}=_i(),{getCurrentPosBaseInfo:D,getCurrentPosByPosId:r}=Ye(),{curPosContractPoolInfo:c,currentPosDetailTab:s,currentPosPoolInfo:a,setCurrentPosDetailTab:j,setCurrentPosPoolInfo:_,setCurrentPoolSqrtPrice:H,setCurPosContractPoolInfo:R,setIsPosDetailRefresh:M,setUseZapIn:p}=Se(),{posPoolsRelatedData:L,currentPosBaseInfo:l,setCurrentPosBaseInfo:S,farmsPosRewardsData:F,posRewardsData:V}=je();console.log(l,"currentPosBaseInfo");const A=(((Z=L[l==null?void 0:l.posId])==null?void 0:Z.displayFee)||"--")+"%",W=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],G=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),M(!0),v(!0),Y(),T(),x(),X(),setTimeout(()=>{M(!1)},1e3)},v=(h=!1)=>{d!=null&&d.address&&t&&D(d==null?void 0:d.address,t,h)};n.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",t),v()},[d==null?void 0:d.address,t]),n.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:ee}=Qe(),q=F[l==null?void 0:l.id],E=V[l==null?void 0:l.posId],T=()=>{var ve,Ce;const h=(E==null?void 0:E.map(B=>B==null?void 0:B.coin_address))||[],se=(q==null?void 0:q.map(B=>B==null?void 0:B.rewarder_type))||[],g=[(ve=l==null?void 0:l.tokenA)==null?void 0:ve.coin_type,(Ce=l==null?void 0:l.tokenB)==null?void 0:Ce.coin_type].filter(Boolean),C=Array.from(new Set([...h,...g,...se]));ee(C)};n.useEffect(()=>{T()},[l==null?void 0:l.posId,E==null?void 0:E.length,q==null?void 0:q.length]);const{getPoolList:ie}=Ts(),Y=async()=>{if(!(l!=null&&l.clmmPool))return;const h=await ie({pool:l==null?void 0:l.clmmPool,display_all_pools:!0});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,h),h)return _(h==null?void 0:h.list[0])},{getPosPoolsOriginalObj:N,getPosPoolsRelatedData:z}=Hi(),{getPosLiquidityData:$}=zi(),X=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const h=await r(d==null?void 0:d.address,t),se=await N([h]);z([h],se);const g=se[h==null?void 0:h.clmmPool];console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo[currentPosBaseInfo?.clmmPool]:",g,c),(g==null?void 0:g.current_sqrt_price)!==(c==null?void 0:c.current_sqrt_price)&&$([h],se),se&&(H(g==null?void 0:g.current_sqrt_price),R(g))}},{setFromCoin:k,setToCoin:f,fromCoin:u,toCoin:Q}=ks();n.useEffect(()=>{Y(),X();let h;return l!=null&&l.clmmPool&&(h=setInterval(()=>{X()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(k(l==null?void 0:l.displayTokenA),f(l==null?void 0:l.displayTokenB)),()=>{clearInterval(h),k(ti.clmm_swap.from_coin),f(ti.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),n.useEffect(()=>(j("increase"),d!=null&&d.address&&x(),()=>{R(null),S(null),_(null),p(!1)}),[]),us({onRpcChange:()=>{v(!0),X(),d!=null&&d.address&&x()}});const{isApp:y}=$e();return i.jsxs(U,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(m,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(m,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(As,{}),y&&i.jsxs(m,{children:[i.jsx(di,{}),i.jsx(pi,{handleRefresh:G,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(m,{w:{base:"100%",lg:"unset"},children:[i.jsx(Oe,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:h=>{e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!y&&i.jsx(pi,{handleRefresh:G,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(m,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(de,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Li,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:A,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(m,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ee,{label:"Pool APR",value:i.jsx(Ri,{poolInfo:a,children:i.jsxs(m,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(w,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:a!=null&&a.farmingAprDisplay||((O=a==null?void 0:a.miningAprList)==null?void 0:O.length)>0?"help":"text",children:a==null?void 0:a.feeAndMiningAprDisplay}),(a==null?void 0:a.haveFarming)&&i.jsxs(w,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",a==null?void 0:a.farmingAprDisplay]})]})}),loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"TVL",value:(a==null?void 0:a.tvlDisplay)||"",loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"Volume (24H)",value:(a==null?void 0:a.volume24Display)||"",loading:!(a!=null&&a.poolAddress)}),i.jsx(Ee,{label:"Fees (24H)",value:(a==null?void 0:a.fees24Display)||"",loading:!(a!=null&&a.poolAddress)})]})]}),i.jsxs(m,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(U,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(Rs,{}),i.jsx(Ss,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs(U,{w:{base:"100%",lg:"40%"},children:[i.jsx(ce,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(m,{w:"100%",p:"0 16px",children:[i.jsx(fi,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:W,currentTab:s=="increase"?"Increase":"Remove",handleChangeTab:h=>{j(h==null?void 0:h.value)}}),!y&&i.jsx(di,{})]})}),s=="increase"&&i.jsx(Cs,{}),s=="remove"&&i.jsx(ns,{})]})]})]})}const di=()=>i.jsx(m,{children:i.jsx(Fi,{})});export{Ll as default};
//# sourceMappingURL=PositionDetail-xvoTCVNA.js.map
