import{r as d,a5 as rt,d as ue,as as z,j as e,ae as it,af as ot,ag as nt,ah as st,ai as we,aj as ct,ak as lt,V as U,H as L,a0 as Oe,T as C,W as ze,B as ee,bj as Ce,Y as at,$ as te,I as ye,aL as $e,aM as pt,ao as vt,a1 as xt,aO as V,m as he,g as At,b as dt,k as Je,bk as Rt,am as Dt,bl as It,ad as de,aQ as J,bb as k,aV as Ie,ab as ne,a as ut,bc as Ft,bm as Pt,bn as Xe,aa as Me,a7 as Wt,aS as Qe,aZ as Fe}from"./index-C8aSFnwA.js";import{b as zt,u as $t,a as Nt}from"./SelectTokenAndFeeConfirm-Dzr1lTRk.js";import{P as Ot}from"./PositionStatus-sxcnWwj-.js";import{c as ht,b as Pe}from"./useGetPoolList-yfAAH4Og.js";import{H as Ne}from"./HTextLabelBox-D_4rfdGc.js";import{T as Lt}from"./TradeConfirmAmountInfo-BQPzzaCp.js";import{I as Ht,P as qe}from"./common-aPtBYKfE.js";import{u as Te}from"./useTokenBalance-B20rEpvC.js";import{T as Et}from"./TradeInputGroup-CVoQvBli.js";import{L as ke}from"./LockInput-CU7UE9La.js";import{u as Vt,a as Ut}from"./useCreatePoolHelper-DY9hzWnL.js";import{I as Gt}from"./InputBox-DbogYJkC.js";import{i as be}from"./index-CPshwnV0.js";import{d as Bt}from"./FeeTierSelect-CeEfSTsx.js";import{u as gt}from"./useAccountBalance-DwZl3cPL.js";import{u as Kt}from"./useDocumentSize-CSTfnK3j.js";import{u as et}from"./useToken-DLV31YSC.js";import{u as Yt}from"./usePreviousValue-6D-DOYWi.js";import{u as Zt}from"./useTransaction-CdVfV12D.js";import{R as Jt}from"./RefreshButton-CtvTQJ6t.js";import"./index-DLN8FXV6.js";import"./Loading-DV6-TXEy.js";import"./SingleTokenInfo-Do1PEtgX.js";import"./AddressCopyLink-Comd2bKw.js";import"./AddressUnderline-BpIZGN5S.js";import"./CetusTooltip-BjuKZzhY.js";import"./TooltipIcon-DVEsk43i.js";import"./api-data-utils-DK-LMyn-.js";import"./ActionButton-5ZM7Lh5v.js";import"./_getAllKeysIn-D1lCWRIr.js";import"./icon_lock@2x-OdzkPjmc.js";import"./usePosAdd-CmtVDHH0.js";import"./global-oTYCboGn.js";import"./usePositionList-CT218bhq.js";import"./useCurrentPos-DKjK69vi.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-CdjHiG4O.js";import"./liquidity-GAfcdI39.js";import"./debounce-B3JRQ_XJ.js";import"./index-Dp8OprSJ.js";function Xt(h){const{isOpen:g,onClose:u,onSubmit:l,data:r}=h,{baseToken:t,quoteToken:i,feeDisplay:p,baseAmount:n,quoteAmount:o,isReverse:S,initPrice:s,minPrice:f,maxPrice:x,isFullRange:A}=r,[y,H]=d.useState(!0);console.log("ðŸš€ ~ file: CreateConfirmModal.tsx:49 ~ CreateConfirmModal ~ data:",r,y);const{getTokenAmountValue:O}=rt(),G=O(t==null?void 0:t.coin_type,n),B=O(i==null?void 0:i.coin_type,o),$=d.useMemo(()=>ue(G||"0").plus(B||"0").toString(),[G,B]),a=d.useMemo(()=>ht(n,o,s,A),[n,o]),P=d.useMemo(()=>y?`${z(i==null?void 0:i.symbol)} per ${z(t==null?void 0:t.symbol)}`:`${z(t==null?void 0:t.symbol)} per ${z(i==null?void 0:i.symbol)}`,[y,t==null?void 0:t.symbol,i==null?void 0:i.symbol]),_=d.useMemo(()=>A?"0":S?y?f==null?void 0:f.displayReversePrice:x.displayPrice:y?f==null?void 0:f.displayPrice:x.displayReversePrice,[y]),Z=d.useMemo(()=>A?"âˆž":S?y?x==null?void 0:x.displayReversePrice:f.displayPrice:y?x==null?void 0:x.displayPrice:f.displayReversePrice,[y]);return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(ot,{}),e.jsxs(nt,{children:[e.jsx(st,{children:e.jsx(we,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(ct,{}),e.jsx(lt,{textAlign:"center",p:"0px",children:e.jsxs(U,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(L,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(L,{children:[e.jsx(Oe,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:i==null?void 0:i.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(C,{fontSize:"16px",color:"text_caption",children:`${z(t==null?void 0:t.symbol)} - ${z(i==null?void 0:i.symbol)}`})]}),e.jsx(ze,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(L,{gap:"12px",children:[e.jsx(C,{children:"Fee Tier"}),e.jsx(C,{color:"primary",children:p})]})})]}),e.jsx(Lt,{coinA:{amount:n,...t},coinB:{amount:o,...i}}),e.jsxs(ee,{w:"100%",children:[e.jsxs(L,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(C,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(Ot,{isActive:!0,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(L,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(C,{children:"Current Price"}),e.jsx(C,{as:"span",color:"text_caption",children:Ce(y?s:at(ue(1).div(s).toFixed(18),18,!0).toString(),18)}),e.jsx(C,{children:P}),e.jsx(te,{variant:"unstyled",onClick:()=>H(!y),children:e.jsx(ye,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(L,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(tt,{title:"Min Price",price:_,perText:P}),e.jsx($e,{orientation:"vertical",h:"40px"}),e.jsx(tt,{title:"Max Price",price:Z,perText:P})]})]}),e.jsx(Ne,{isLoading:!1,label:"Deposit Ratio",value:`${a.percentA}% ${z(t==null?void 0:t.symbol)} / ${a.percentB}% ${z(i==null?void 0:i.symbol)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx(Ne,{isLoading:!1,label:"Total Amount",value:$&&+$?pt($):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(te,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:l,children:"Create and Add Liquidity"})]})})]})]})}const tt=({title:h,price:g,perText:u})=>e.jsxs(U,{flex:"1",children:[e.jsx(C,{children:h}),e.jsx(C,{color:"text_caption",children:g}),e.jsx(C,{children:u})]});function Mt(h){const{isOpen:g,onClose:u,data:l}=h,{baseToken:r,quoteToken:t,feeDisplay:i}=l;return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(ot,{}),e.jsxs(nt,{children:[e.jsx(st,{}),e.jsx(ct,{}),e.jsx(lt,{children:e.jsx(U,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(U,{gap:"8px",children:[e.jsx(vt,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(U,{mt:"-155px",gap:"10px",children:[e.jsxs(L,{children:[e.jsx(Oe,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(C,{fontSize:"14px",color:"text_caption",children:`${r==null?void 0:r.symbol} - ${t==null?void 0:t.symbol}`})]}),e.jsx(ze,{w:"unset",p:"4px 6px",borderRadius:"12px",children:e.jsxs(C,{fontSize:"12px",color:"primary",children:["Fee Tier ",i]})})]}),e.jsx(ze,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(C,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(te,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{u()},children:"OK"})]})})})]})]})}function Qt(h,g,u,l,r,t){const{currentAccount:i}=xt(),p=d.useMemo(()=>{const n={text:"Create",disabled:!1};return i!=null&&i.address?!h||!g||h&&!+h||g&&!+g?(n.text="Enter an amount",n.disabled=!0,n):h&&+h&&ue(h).gt((r==null?void 0:r.balanceFormat)||0)?(n.disabled=!0,n.text=`Insufficient ${z(u==null?void 0:u.symbol)} Balance`,n):g&&+g&&ue(g).gt((t==null?void 0:t.balanceFormat)||0)?(n.disabled=!0,n.text=`Insufficient ${z(l==null?void 0:l.symbol)} Balance`,n):((!h||!g)&&(n.disabled=!0),n):(n.text="Connect Wallet",n.disabled=!1,n)},[i==null?void 0:i.address,h,g,r==null?void 0:r.balanceDisplay,t==null?void 0:t.balanceDisplay,u==null?void 0:u.coin_type,l==null?void 0:l.coin_type]);return{btnText:p.text,btnDisabled:p.disabled}}function qt({currentStep:h,editStep:g,onCreate:u,baseToken:l,quoteToken:r,baseAmount:t,quoteAmount:i,onBaseAmountChange:p,onQuoteAmountChange:n,isReverse:o,percentMap:S}){const{balanceInfo:s}=Te(l),{balanceInfo:f}=Te(r),{btnText:x,btnDisabled:A}=Qt(t,i,l,r,s,f),{fetchTokenPrices:y,getTokenAmountValue:H}=rt(),O=()=>{const a=[];l!=null&&l.coin_type&&a.push(l==null?void 0:l.coin_type),r!=null&&r.coin_type&&a.push(r==null?void 0:r.coin_type),a.length>0&&y(a)};d.useEffect(()=>{O()},[l==null?void 0:l.coin_type,r==null?void 0:r.coin_type]);const G=H(l==null?void 0:l.coin_type,t),B=H(r==null?void 0:r.coin_type,i),$=d.useMemo(()=>{if(+G&&+B)return V(G||"0").plus(B||"0").toString()},[G,B]);return e.jsx(e.Fragment,{children:h===3&&g===3?e.jsxs(U,{w:"100%",gap:"12px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),e.jsx(Et,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(s==null?void 0:s.balanceFormat)||"",value:t,amountValue:G,loading:!1,onChange:a=>{p(a)},selectable:!1,placeholder:"0.0",token:l},to:{wrapStyle:{h:"108px"},balance:(f==null?void 0:f.balanceFormat)||"",value:i,amountValue:B,loading:!1,onChange:a=>{n(a)},selectable:!1,placeholder:"0.0",token:r}}),e.jsxs(U,{gap:"16px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(Ne,{isLoading:!1,label:"Total Amount",value:$&&+$?pt($):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(Ht,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(he,{flexDir:{base:"column",lg:"row"},gap:{base:"4px",lg:"12px"},children:S&&[l,r].filter(Boolean).map((a,P)=>e.jsxs(L,{gap:"4px",justify:"flex-end",children:[e.jsx(At,{imageUrl:a==null?void 0:a.logo_url,coinType:a?a==null?void 0:a.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(C,{color:P===0?"primary":"primary_green",fontSize:"14px",children:[z(a==null?void 0:a.symbol),"Â ",S[P===0?o?"percentB":"percentA":o?"percentA":"percentB"],"%"]})]},a==null?void 0:a.coin_type))})})]}),e.jsx(te,{w:"100%",onClick:u,h:"48px",fontSize:"16px",borderRadius:"12px",disabled:A,children:x})]}):null})}function ft({onEdit:h,children:g}){return e.jsxs(L,{w:"100%",p:{base:"16px 8px",lg:"20px 32px"},border:"0px solid",borderColor:"border",borderRadius:"12px",bg:"bg_fifth",justify:"space-between",children:[g,e.jsxs(te,{onClick:h,variant:"unstyled",border:"1px solid",borderColor:"border",cursor:"pointer",borderRadius:"8px",p:"5px 8px",display:"flex",h:"32px",alignItems:"center",gap:"8px",minW:"auto",_hover:{p:{color:"#fff"},svg:{fill:"#fff"}},children:[e.jsx(ye,{xlinkHref:"#icon-icon_edit"}),e.jsx(C,{fontSize:"12px",fontWeight:"500",children:"Edit"})]})]})}function Tt({onEdit:h,editStep:g,currentStep:u,onContinue:l,baseToken:r,quoteToken:t,onBaseTokenChange:i,onQuoteTokenChange:p,feeTier:n,feeTierList:o,onFeeTierChange:S,quoteWhiteTokenList:s}){return e.jsx(e.Fragment,{children:g===1||u===1?e.jsx(zt,{title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:l,baseToken:r,onBaseTokenChange:i,quoteToken:t,onQuoteTokenChange:p,quoteWhiteTokenList:s,feeTier:n,feeTierList:o,onFeeTierChange:S,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool"}):e.jsx(ft,{onEdit:h,children:e.jsxs(L,{gap:"12px",children:[e.jsx(Oe,{coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,w:"36px",h:"36px"}),e.jsxs(L,{children:[e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${z(r==null?void 0:r.symbol)}-${z(t==null?void 0:t.symbol)}`}),e.jsx(ee,{h:"16px",p:"1px 8px",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:e.jsx(C,{fontSize:"12px",fontWeight:"500",color:"text_highlight",children:typeof n=="string"?`${ue(n).div(100).toString()}%`:n==null?void 0:n.feeDisplay})})]})]})})})}const kt=[{label:"Full Range"},{label:"Custom Range"}];function er({editStep:h,currTick:g,currentStep:u,onEdit:l,onContinue:r,displayBaseToken:t,displayQuoteToken:i,initPrice:p,onInitPriceChange:n,displayMinPrice:o,onMinPriceChange:S,displayMaxPrice:s,onMaxPriceChange:f,isFullRange:x,isReverse:A,handleRangeModeChange:y,handleSwitchDirectionChange:H,handlePriceAction:O}){const[G,B]=d.useState("Full Range"),{isApp:$}=dt(),a=d.useMemo(()=>o?[o.tokenA,o.tokenB].filter(Boolean).map(j=>({label:j==null?void 0:j.symbol,isToken:!0,imgInfo:{src:j==null?void 0:j.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[o==null?void 0:o.tokenA,o==null?void 0:o.tokenB]),P=d.useMemo(()=>`${z(i==null?void 0:i.symbol)} per ${z(t==null?void 0:t.symbol)}`,[t==null?void 0:t.symbol,i==null?void 0:i.symbol]),_=d.useMemo(()=>{var j;return x?!0:((j=o==null?void 0:o.tokenA)==null?void 0:j.coin_type)===(t==null?void 0:t.coin_type)},[x,o==null?void 0:o.tokenA,o==null?void 0:o.tokenB,t==null?void 0:t.coin_type]),{showInputPriceWarn:Z,showPriceRangeWarn:X}=Vt(x,g,A?s.tick:o.tick,A?o.tick:s.tick),re=d.useMemo(()=>(o==null?void 0:o.price)==="0"&&(s==null?void 0:s.price)==="âˆž",[o==null?void 0:o.price,s==null?void 0:s.price]);return e.jsx(e.Fragment,{children:u>=2?h===2||u===2?e.jsxs(U,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(U,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set initial Price"}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:"center",children:[e.jsx(C,{fontSize:"12px",children:"Please set an initial price for this new pool to start."}),e.jsx(Je,{type:"outlineTab",tabList:a,currentTab:t==null?void 0:t.symbol,handleChangeTab:j=>{j.label!==(t==null?void 0:t.symbol)&&H()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(Gt,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(Rt,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(Dt,{value:p?Ce(p,18):"",onChange:j=>{n==null||n(j)},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(It,{children:e.jsx(C,{children:P})})]})}),p&&e.jsxs(L,{h:"20px",w:"100%",children:[e.jsxs(C,{color:"text_caption",fontSize:"12px",children:["Current Price: 1 ",z(t==null?void 0:t.symbol)," = ",de(Ce(p,18))," ",z(i==null?void 0:i.symbol)]}),e.jsx(ye,{w:"16px",h:"16px",svgW:"16px",svgH:"16px",xlinkHref:"#icon-icon_swap1",fontSize:"12px",onClick:H})]})]}),e.jsxs(U,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set Price Range"}),e.jsx(C,{fontSize:"12px",children:"Please specify a price range that you want to provide your liquidity within."}),e.jsx(Je,{type:"outlineTab",tabList:kt,currentTab:x?"Full Range":"Custom Range",handleChangeTab:j=>{B(j==null?void 0:j.label),y((j==null?void 0:j.label)==="Full Range")},wrapStyle:{w:"100%",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"12px",gap:"4px"},itemStyle:{flex:"1",h:"32px",p:"8px",borderRadius:"8px",fontSize:"14px"}}),e.jsxs(he,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(qe,{title:"Min Price",perText:P,data:o,direct:_,loading:!1,handleAddPrice:j=>O("Add",j),handleSubPrice:j=>O("Sub",j),setTickDataBasedOnPrice:S,isFullRange:re}),e.jsx(qe,{title:"Max Price",perText:P,data:s,direct:_,loading:!1,handleAddPrice:j=>O("Add",j),handleSubPrice:j=>O("Sub",j),setTickDataBasedOnPrice:f,isFullRange:re}),!+p&&!x&&e.jsx(ke,{position:"absolute",top:"0px",left:"0",h:"80px",borderRadius:"12px",text:""}),$&&!+p&&!x&&e.jsx(ke,{position:"absolute",top:"88px",left:"0",h:"80px",borderRadius:"12px",text:""})]}),!x&&Z&&!X&&e.jsx(ee,{w:"100%",p:"8px 16px",borderRadius:"8px",bg:"primary_yellow_opacity.10",children:e.jsx(C,{fontSize:"12px",lineHeight:"16px",color:"primary_yellow",children:"To create a new pool, the initial price you set must be within your price range."})}),!x&&X&&e.jsx(ee,{h:"28px",lineHeight:"28px",p:"0 16px",w:"100%",borderRadius:"8px",bg:"primary_red_opacity.10",children:e.jsx(C,{fontSize:"12px",color:"primary_red",children:"The max price should be higher than min price."})}),e.jsx(te,{mt:"4px",w:"100%",onClick:r,disabled:!p||!+p||!o.price||!s.price||Z||X,h:"48px",fontSize:"16px",borderRadius:"12px",children:!p||!+p?"Enter initial price":"Continue"})]})]}):e.jsx(ft,{onEdit:l,children:e.jsxs(U,{gap:"12px",align:"flex-start",children:[e.jsxs(L,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Initial Price"}),e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${Ce(p,18)} ${P}`})]}),e.jsxs(L,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Price Range"}),e.jsxs(C,{color:"text_caption",fontWeight:"500",children:[x?"0 - âˆž":`${A?o.displayReversePrice:o==null?void 0:o.displayPrice} - ${A?s==null?void 0:s.displayReversePrice:s==null?void 0:s.displayPrice} `," ",`${P}`," "]})]})]})}):null})}function tr({currentStep:h,handleStepClick:g}){const{isApp:u}=dt();return e.jsxs(he,{flexDir:{base:"row",lg:"column"},gap:"12px",flex:{base:"1",lg:"0 0 258px"},w:{base:"100%",lg:"258px"},p:{base:"12px",lg:"32px"},justify:"center",align:{base:"center",lg:"flex-start"},bg:"bg_fifth",borderRadius:"12px",children:[e.jsx(We,{step:1,title:"Select token & fee tier",isActive:h>=1,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx($e,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(We,{step:2,title:"Set initial price & range",isActive:h>=2,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx($e,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(We,{step:3,title:"Enter deposit amounts",isActive:h>=3})]})}function We({step:h,title:g,isActive:u,handleStepClick:l}){return e.jsxs(L,{w:{base:"32px",lg:"100%"},cursor:l&&u?"pointer":"unset",onClick:()=>{l&&u&&l(h)},children:[e.jsx(ee,{as:"div",flex:"0 0 32px",h:"32px",lineHeight:"32px",textAlign:"center",border:"1px solid",fontSize:"12px",fontWeight:"500",color:u?"text_highlight":"text_paragraph",borderColor:"border",borderRadius:"8px",bg:u?"primary_disabled":"transparent",children:h}),e.jsxs(U,{align:"flex-start",display:{base:"none",lg:"flex"},children:[e.jsxs(C,{fontSize:"14px",color:u?"text_caption":"text_paragraph",fontWeight:"500",children:["Step Â ",h]}),e.jsx(C,{fontSize:"12px",color:u?"primary":"text_paragraph",fontWeight:"500",children:g})]})]})}function rr(){const h=(r,t,i,p,n)=>{const o=i.decimals,S=p.decimals;let s;Math.abs(r)==Math.abs(J.getMinIndex(n))?s=t==="lower"?"0":"âˆž":s=k.tickIndexToPrice(r,o,S).toString();const f=s==="âˆž"?"âˆž":ne(s,6).toString(),x=Pe(s),A=x==="âˆž"?"âˆž":ne(x,6).toString();return{id:t,tokenA:i,tokenB:p,tick:r,price:s,displayPrice:f,reversePrice:x,displayReversePrice:A,tickSpacing:n.toString(),pool:"1"}},g=(r,t)=>{const i=r.tokenA,p=r.tokenB;if(!i||!p||t.length===0)return;let n,o="";if(t==="âˆž")n=J.getMaxIndex(Number(r.tickSpacing)),o="âˆž";else if(V(t).equals(0))n=J.getMinIndex(Number(r.tickSpacing)),o="0";else if(V(t).gt(0)){const x=k.priceToTickIndex(V(t),i.decimals,p.decimals);n=Ie(Number(x),Number(r.tickSpacing)),o=k.tickIndexToPrice(Number(n),i.decimals,p.decimals).toString()}const S=o==="âˆž"?"âˆž":ne(o,6),s=Pe(o),f=s==="âˆž"?"âˆž":ne(s,6);if(n!==void 0)return{...r,tick:n,price:o,displayPrice:S.toString(),reversePrice:s,displayReversePrice:f.toString()}},u=(r,t="Add")=>{const{tokenA:i,tokenB:p,tick:n,tickSpacing:o}=r;if(i&&p&&o){const S=t==="Add"?V(n).add(o).toNumber():V(n).sub(o).toNumber();if(V(S).gt(J.getMaxIndex(Number(r.tickSpacing)))||V(S).lt(J.getMinIndex(Number(r.tickSpacing))))return;const s=k.tickIndexToPrice(S,i.decimals,p.decimals).toString(),f=s==="âˆž"?"âˆž":ne(s,6);if(f===r.displayPrice){const x=Number(r.tickSpacing)<20?40:1;return u({...r,tick:t==="Add"?V(n).add(Number(o)*x).toNumber():V(n).sub(Number(o)*x).toNumber()},t)}else{const x=Pe(s),A=x==="âˆž"?"âˆž":ne(x,6);return{id:r.id,tick:S,price:s.toString(),displayPrice:f.toString(),reversePrice:x.toString(),displayReversePrice:A.toString(),tokenA:i,tokenB:p,tickSpacing:o,pool:"1"}}}};return{calcInitPriceRange:(r,t,i,p,n,o,S)=>{console.log("ðŸš€ ~ file: useCreatePriceRange.ts:84 ~ useCreatePriceRange ~ calcInitPriceRange:",{tickSpacing:i,baseToken:p,quoteToken:n});try{if(i&&p&&n){const s=J.getMaxIndex(i),f=J.getMinIndex(i);if(r){const x={id:"lower",tokenA:p,tokenB:n,tick:f,price:"0",displayPrice:"0",reversePrice:"âˆž",displayReversePrice:"âˆž",tickSpacing:i.toString(),pool:new Date().getTime().toString()},A={id:"upper",tokenA:p,tokenB:n,tick:s,price:"âˆž",displayPrice:"âˆž",reversePrice:"0",displayReversePrice:"0",tickSpacing:i.toString(),pool:new Date().getTime().toString()};if(t&&+t){const y=k.priceToTickIndex(V(t),p.decimals,n.decimals);return{minData:x,maxData:A,currTick:y}}return{minData:x,maxData:A,currTick:void 0}}else if(t&&+t){const x=k.priceToTickIndex(V(t),p.decimals,n.decimals),A=o||Ie(Number(x-i*5),Number(i));A<f&&(o=f);const y=S||Ie(Number(x+i*5),Number(i));y>s&&(S=s);const H=h(A,"lower",p,n,i),O=h(y,"upper",p,n,i);return{minData:H,maxData:O,currTick:x}}}}catch(s){console.log("ðŸš€ ~ file: useCreatePriceRange.ts:228 ~ useCreatePriceRange ~ error:",s)}},handleActionPrice:u,updateTickDataBasedOnPrice:g}}function ir(){ut();const{base:h,quote:g,fee:u}=Ft(),{tokenInfo:l}=et(h),{tokenInfo:r}=et(g),[t,i]=d.useState(void 0),[p,n]=d.useState([]),[o,S]=d.useState(1),[s,f]=d.useState(0),{signAndExecuteTransaction:x,transactionConfirmation:A,transactionRejected:y}=Zt(),{fetchAccountBalance:H}=gt(),{preAddPool:O,fetchFeeTierList:G,getCreatePoolTxPayload:B}=Ut(),{quoteWhiteTokenList:$}=$t(),[a,P]=d.useState(),[_,Z]=d.useState(),[X,re]=d.useState(!0);d.useEffect(()=>{H()},[]);const j=d.useMemo(()=>{if(!(a&&_&&be(a,$)&&be(_,$))&&!(!a&&!_)&&!(a&&!_&&be(a,$))&&!(_&&!a&&be(_,$)))return[...$]},[a==null?void 0:a.coin_type,_==null?void 0:_.coin_type,$]),[R,Y]=d.useState(),[D,M]=d.useState(),[N,Q]=d.useState(""),[E,ge]=d.useState(!0),[v,se]=d.useState({}),[W,ie]=d.useState({}),[_e,fe]=d.useState(),[ve,ce]=d.useState(void 0),I=d.useMemo(()=>R&&D?Pt(Xe(R.coin_type),Xe(D.coin_type)):!1,[R,D]),[Ae,me]=d.useState(void 0),{calcInitPriceRange:Re,handleActionPrice:F,updateTickDataBasedOnPrice:le}=rr(),[ae,Se]=d.useState(""),[pe,je]=d.useState("");d.useEffect(()=>{P(l),Y(l),M(r||Me.sui_coin),Z(r||Me.sui_coin)},[l==null?void 0:l.coin_type,r==null?void 0:r.coin_type]),d.useEffect(()=>{Le()},[a==null?void 0:a.coin_type,_==null?void 0:_.coin_type]);const Le=()=>{var c;a&&_?G(a.coin_type,_.coin_type).then(b=>{n(b);const m=b.filter(K=>K.poolAddress===void 0),w=m.find(K=>K.feeRate===u)||m.find(K=>K.feeRate==="25")||(m.length>0?m[0]:void 0)||(b.length>0?b[0]:void 0);w&&He(w)}):(n((c=Bt)==null?void 0:c.map(b=>({...b,title:""}))),i(void 0))},mt=(c,b=!0)=>{De(1),b?(P(c),Y(c),M(_),(c==null?void 0:c.coin_type)===(_==null?void 0:_.coin_type)&&(Z(void 0),M(void 0))):(Z(c),M(c),Y(a),(c==null?void 0:c.coin_type)===(a==null?void 0:a.coin_type)&&(P(void 0),Y(void 0)))},He=c=>{i(c),S(1),_t(),q(!0)},St=()=>{const c=R;if(Y(D),M(c),+N){const m=at(V(1).div(N).toFixed(18),18,!0).toString();Q(m)}};d.useEffect(()=>{Ee(E)},[N,t==null?void 0:t.tickSpacing]);const Ee=(c,b,m)=>{oe();const w=Re(c,N&&+N?I?(1/Number(N)).toString():N:"",Number((t==null?void 0:t.tickSpacing)||0),I?D:R,I?R:D,b,m);console.log("ðŸš€ ~ handleInitPriceRange ~ data:",w),w?(ie(w.maxData),se(w.minData),fe(w.currTick)):fe(void 0)};d.useMemo(()=>{if(t&&R&&D)return k.tickIndexToPrice(J.getMaxIndex(20),6,6).toFixed(9,Wt.ROUND_DOWN)},[t==null?void 0:t.tickSpacing,R==null?void 0:R.decimals,D==null?void 0:D.decimals]);const jt=c=>{Q(c)},q=(c,b,m)=>{ge(c),oe(),Ee(c,b,m)},Ve=d.useMemo(()=>E?v:I?W:v,[E,v,W,I]),Ue=d.useMemo(()=>E?W:I?v:W,[E,v,W,I]),bt=(c,b)=>{oe();const m=F(b,c);m&&((m==null?void 0:m.id)===(v==null?void 0:v.id)?se(m):ie(m))},Ct=Yt(E),wt=(c,b,m)=>{const w=le(c,b);if(w){w.pool=new Date().getTime().toString();let K=v==null?void 0:v.tick,T=W==null?void 0:W.tick;w.id==="lower"?(se({...w}),K=w.tick):(ie({...w}),T=w.tick),K!==void 0&&T!==void 0&&t?Ct&&(J.getMaxIndex(Number(t.tickSpacing))!==T||J.getMinIndex(Number(t.tickSpacing))!==K?q(!1):q(!0)):q(!1,K,T)}else q(!1)},yt=(c,b)=>{re(b),b?Se(c):je(c);const m=Ge(c,b);m?(me(m),b?je(I?m.coinAmountA:m.coinAmountB):Se(I?m.coinAmountB:m.coinAmountA)):(b?je(""):Se(""),me(void 0))},De=c=>{console.log("ðŸš€ ~ file: useCreatePool.ts:288 ~ handleStepClick ~ step:",c,o,s),c===1?(S(1),f(1),Q(""),q(!0),oe()):c===2?(S(2),f(2),oe()):(S(3),f(3))},Ge=(c,b,m)=>{if(D&&R&&N&&t&&c&&+c&&(v!=null&&v.price)&&(W!=null&&W.price))try{const w=O({realTokenA:I?D:R,realTokenB:I?R:D,needReverse:v.tokenA.coin_type!==R.coin_type,tickSpacing:Number(t.tickSpacing),amount:c,amountCoinType:b?R.coin_type:D.coin_type,maxPrice:E?W.price:I?v.reversePrice:W.price,minPrice:E?v.price:I?W.reversePrice:v.price,price:I?V(1).div(N).toString():N});return console.log("ðŸš€ ~ file: useCreatePool.ts:212 ~ handleAmountChange ~ res:",w),w}catch(w){console.log("ðŸš€ ~ file: useCreatePool.ts:240 ~ preCalcAddPool ~ error:",w)}};Kt(()=>{const c=Ge("1",!0);if(c){const b=ht(c==null?void 0:c.coinAmountA,c==null?void 0:c.coinAmountB,I?(1/Number(N)).toString():N,E);console.log("ðŸš€ ~ file: useCreatePool.ts:273 ~ useCreatePool ~ perMap:",b),ce(b)}else ce(void 0)},[N,v.tick,W.tick,E,I,t==null?void 0:t.tickSpacing],{wait:500});const _t=()=>{Q(""),oe(),ge(!0)},oe=()=>{Se(""),je("")};return{baseToken:a,quoteToken:_,handleSelectTokenChange:mt,displayQuoteWhiteTokenList:j,feeTier:t,setFeeTier:i,feeTierList:p,currentStep:o,editStep:s,setCurrentStep:S,setEditStep:f,displayBaseToken:R,displayQuoteToken:D,handleSwitchDirectionChange:St,initPrice:N,handleInitPriceChange:jt,isFullRange:E,handleRangeModeChange:q,minTickData:v,maxTickData:W,isReverse:I,handleFeeTierChange:He,handlePriceAction:bt,baseAmount:ae,quoteAmount:pe,handleAmountChange:yt,getConfirmData:()=>({isReverse:I,baseToken:R,quoteToken:D,baseAmount:ae,quoteAmount:pe,minPrice:Ve,maxPrice:Ue,initPrice:N,feeDisplay:t.feeDisplay,isFullRange:E}),handleCreateAction:async()=>{const c=v.tokenA;v.tokenB,c.coin_type,X?R.coin_type:D.coin_type;const b={getShowInfo:(m,w)=>{const K=z(R==null?void 0:R.symbol),T=z(D==null?void 0:D.symbol),Be=`Add ${de(ae)} ${K} and ${de(pe)} ${T}`,xe={modalDescriptionText:Be,toastTitleText:Be};if(m==="success"){let Ke=ae,Ye=pe;w&&(Ke=Qe(w,R)||ae,Ye=Qe(w,D)||pe);const Ze=`Add ${de(Ke)} ${K} and ${de(Ye)} ${T}`;xe.toastDescriptionContent=Ze,xe.modalDescriptionText=Ze,xe.toastTitleText="Create Success"}return m==="rejected"&&(xe.toastTitleText="Create pool"),xe}};A(b);try{const m=await B(Ae),w=await x(m,b,{showSuccessModal:!1,useDevInspect:!0,txAction:"signAndExecuteTransactionBlock"});if(console.log("ðŸš€ ~ handleCreateAction ~ res:",w),w)return H(),Le(),De(1),t.feeDisplay}catch(m){console.log("ðŸš€ ~ file: useCreatePool.ts:341 ~ handleCreateAction ~ error:",m),y(b)}},percentMap:ve,currTick:_e,displayMinPrice:Ve,displayMaxPrice:Ue,handleTickPriceChange:wt,handleStepClick:De,fetchFeeTierList:G}}function Zr(){const h=ut(),{baseToken:g,quoteToken:u,feeTier:l,currentStep:r,editStep:t,feeTierList:i,handleSelectTokenChange:p,displayQuoteWhiteTokenList:n,displayBaseToken:o,displayQuoteToken:S,handleSwitchDirectionChange:s,initPrice:f,handleInitPriceChange:x,isFullRange:A,handleRangeModeChange:y,handleTickPriceChange:H,isReverse:O,handleFeeTierChange:G,handlePriceAction:B,baseAmount:$,quoteAmount:a,handleAmountChange:P,getConfirmData:_,handleCreateAction:Z,percentMap:X,currTick:re,displayMinPrice:j,displayMaxPrice:R,handleStepClick:Y,fetchFeeTierList:D}=ir(),{currentAccount:M,onWalletModal:N}=xt(),{isOpen:Q,onOpen:E,onClose:ge}=Fe(),{isOpen:v,onOpen:se,onClose:W}=Fe(),{isOpen:ie,onOpen:_e,onClose:fe}=Fe(),{fetchAccountBalance:ve}=gt(),[ce,I]=d.useState(),Ae=()=>{g&&u&&l&&h(`/liquidity?tab=deposit&poolAddress=${l==null?void 0:l.poolAddress}`,{replace:!0})},me=()=>({baseToken:o,quoteToken:S,feeDisplay:ce}),Re=()=>{g&&u&&D(g.coin_type,u.coin_type),ve()};return e.jsxs(U,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(L,{w:"100%",justifyContent:"space-between",children:[e.jsxs(te,{variant:"outline",h:"32px",onClick:()=>h("/pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(ye,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(C,{fontSize:"12px",children:"Back"})]}),e.jsx(Jt,{handleRefresh:Re,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(tr,{currentStep:r,handleStepClick:Y}),e.jsxs(U,{w:"100%",gap:"16px",children:[e.jsx(Tt,{editStep:t,currentStep:r,onEdit:()=>{Y(1)},onContinue:()=>{l&&(l.poolAddress?E():Y(2))},baseToken:g,onBaseTokenChange:F=>p(F,!0),quoteToken:u,onQuoteTokenChange:F=>p(F,!1),feeTier:l,feeTierList:i,quoteWhiteTokenList:n,onFeeTierChange:F=>G(F),fromSource:"createPool"}),e.jsx(er,{editStep:t,currentStep:r,onEdit:()=>Y(2),onContinue:()=>{Y(3)},displayBaseToken:o,displayQuoteToken:S,initPrice:f,currTick:re,isReverse:O,onInitPriceChange:F=>x(F),handlePriceAction:B,displayMinPrice:j,onMinPriceChange:(F,le)=>{H(F,le,!0)},displayMaxPrice:R,onMaxPriceChange:(F,le)=>{H(F,le,!1)},handleSwitchDirectionChange:s,isFullRange:A,handleRangeModeChange:y}),e.jsx(qt,{currentStep:r,editStep:t,onCreate:()=>{M?se():N(!0)},percentMap:X,baseToken:o,quoteToken:S,baseAmount:$,quoteAmount:a,onBaseAmountChange:F=>P(F,!0),onQuoteAmountChange:F=>P(F,!1),isReverse:O})]})]}),Q&&e.jsx(Nt,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:Q,onClose:ge,onConfirm:Ae}),v&&e.jsx(Xt,{isOpen:v,onClose:W,onSubmit:async()=>{W();const F=await Z();F&&(I(F),_e())},data:_()}),ie&&ce&&e.jsx(Mt,{isOpen:ie,onClose:fe,data:me()})]})}export{Zr as default};
