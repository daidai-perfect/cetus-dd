import{r as d,a3 as tt,d as xe,aL as F,j as e,ac as rt,ad as it,ae as ot,af as st,ag as Ce,ah as nt,ai as ct,V,H as O,$ as Ne,T as C,U as We,B as k,bh as be,X as lt,Z as ee,I as we,aO as ze,aP as at,am as yt,a0 as pt,aR as E,l as de,c as vt,b as xt,i as Ye,bi as At,ak as Rt,bj as Dt,ab as pe,aT as X,b9 as T,aY as De,a9 as ne,a as dt,ba as It,bk as Ft,bl as Ze,a8 as ce,a5 as Pt,aV as Je,b1 as Ie}from"./index-B-qrdBiq.js";import{b as Wt,u as zt,a as $t}from"./SelectTokenAndFeeConfirm-TbjUhJgC.js";import{P as Nt}from"./PositionStatus-DioPUe29.js";import{c as ut,b as Fe}from"./useGetPoolList-yuWyRDmL.js";import{H as $e}from"./HTextLabelBox-CMrM5XEP.js";import{T as Ot}from"./TradeConfirmAmountInfo-_Or_Lo4v.js";import{I as Lt,P as Me}from"./common-CCQS8aVk.js";import{u as Qe}from"./useTokenBalance-BjSd1T-L.js";import{T as Ht}from"./TradeInputGroup-S0QrRoj9.js";import{L as qe}from"./LockInput-DgBZPqGI.js";import{u as Et,a as Vt}from"./useCreatePoolHelper-Ch7VAq_5.js";import{I as Ut}from"./InputBox-B-cHwU1M.js";import{u as Gt}from"./useTransaction--2sMtHs8.js";import{i as Te}from"./index-CNO93z0h.js";import{d as Bt}from"./FeeTierSelect-Du1YbR9Z.js";import{u as ht}from"./useAccountBalance-B9O9361I.js";import{u as Kt}from"./useDocumentSize-BjzG2IXB.js";import{u as Xt}from"./usePreviousValue-lK0H0Uso.js";import{u as ke}from"./useToken-BQk_H0Hd.js";import{R as Yt}from"./RefreshButton-DigytzgF.js";import"./index-CCopU0rQ.js";import"./Loading-CRRjCeeJ.js";import"./SingleTokenInfo-BbYDSI8t.js";import"./CopyButton-B43sOlQP.js";import"./TooltipIcon-DpjOiY6Y.js";import"./api-data-utils-lG4WZPKZ.js";import"./ActionButton-kFWa7aFp.js";import"./_getAllKeysIn-orUDLidk.js";import"./usePosAdd-CGDol8do.js";import"./global-DXu_9rR6.js";import"./usePositionList-BaP6RO42.js";import"./useFavoritePool-B5SWmSU7.js";import"./useCurrentPos-OrwayPuK.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-MRnnWMBj.js";import"./liquidity-D6Rwrl9r.js";import"./debounce-CTZz3DUk.js";import"./index-DCuiiUDi.js";function Zt(g){const{isOpen:f,onClose:u,onSubmit:c,data:r}=g,{baseToken:t,quoteToken:i,feeDisplay:p,baseAmount:s,quoteAmount:o,isReverse:j,initPrice:n,minPrice:m,maxPrice:x,isFullRange:v}=r,[y,L]=d.useState(!0);console.log("ðŸš€ ~ file: CreateConfirmModal.tsx:49 ~ CreateConfirmModal ~ data:",r,y);const{getTokenAmountValue:$}=tt(),U=$(t==null?void 0:t.coin_type,s),G=$(i==null?void 0:i.coin_type,o),N=d.useMemo(()=>xe(U||"0").plus(G||"0").toString(),[U,G]),h=d.useMemo(()=>ut(s,o,n,v),[s,o]),R=d.useMemo(()=>y?`${F(i==null?void 0:i.symbol)} per ${F(t==null?void 0:t.symbol)}`:`${F(t==null?void 0:t.symbol)} per ${F(i==null?void 0:i.symbol)}`,[y,t==null?void 0:t.symbol,i==null?void 0:i.symbol]),W=d.useMemo(()=>v?"0":j?y?m==null?void 0:m.displayReversePrice:x.displayPrice:y?m==null?void 0:m.displayPrice:x.displayReversePrice,[y]),K=d.useMemo(()=>v?"âˆž":j?y?x==null?void 0:x.displayReversePrice:m.displayPrice:y?x==null?void 0:x.displayPrice:m.displayReversePrice,[y]);return e.jsxs(rt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:f,onClose:u,isCentered:!0,children:[e.jsx(it,{}),e.jsxs(ot,{children:[e.jsx(st,{children:e.jsx(Ce,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(nt,{}),e.jsx(ct,{textAlign:"center",p:"0px",children:e.jsxs(V,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(O,{children:[e.jsx(Ne,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:i==null?void 0:i.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:i==null?void 0:i.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(C,{fontSize:"16px",color:"text_caption",children:`${F(t==null?void 0:t.symbol)} - ${F(i==null?void 0:i.symbol)}`})]}),e.jsx(We,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(O,{gap:"12px",children:[e.jsx(C,{children:"Fee Tier"}),e.jsx(C,{color:"primary",children:p})]})})]}),e.jsx(Ot,{coinA:{amount:s,...t},coinB:{amount:o,...i}}),e.jsxs(k,{w:"100%",children:[e.jsxs(O,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(C,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(Nt,{isActive:!0,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(O,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(C,{children:"Current Price"}),e.jsx(C,{as:"span",color:"text_caption",children:be(y?n:lt(xe(1).div(n).toFixed(18),18,!0).toString(),18)}),e.jsx(C,{children:R}),e.jsx(ee,{variant:"unstyled",onClick:()=>L(!y),children:e.jsx(we,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(O,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(et,{title:"Min Price",price:W,perText:R}),e.jsx(ze,{orientation:"vertical",h:"40px"}),e.jsx(et,{title:"Max Price",price:K,perText:R})]})]}),e.jsx($e,{isLoading:!1,label:"Deposit Ratio",value:`${h.percentA}% ${F(t==null?void 0:t.symbol)} / ${h.percentB}% ${F(i==null?void 0:i.symbol)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx($e,{isLoading:!1,label:"Total Amount",value:N&&+N?at(N):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(ee,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:c,children:"Create and Add Liquidity"})]})})]})]})}const et=({title:g,price:f,perText:u})=>e.jsxs(V,{flex:"1",children:[e.jsx(C,{children:g}),e.jsx(C,{color:"text_caption",children:f}),e.jsx(C,{children:u})]});function Jt(g){const{isOpen:f,onClose:u,data:c}=g,{baseToken:r,quoteToken:t,feeDisplay:i}=c;return e.jsxs(rt,{autoFocus:!1,returnFocusOnClose:!1,isOpen:f,onClose:u,isCentered:!0,children:[e.jsx(it,{}),e.jsxs(ot,{children:[e.jsx(st,{}),e.jsx(nt,{}),e.jsx(ct,{children:e.jsx(V,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(V,{gap:"8px",children:[e.jsx(yt,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(V,{mt:"-155px",gap:"10px",children:[e.jsxs(O,{children:[e.jsx(Ne,{coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(C,{fontSize:"14px",color:"text_caption",children:`${r==null?void 0:r.symbol} - ${t==null?void 0:t.symbol}`})]}),e.jsx(We,{w:"unset",p:"4px 6px",borderRadius:"12px",children:e.jsxs(C,{fontSize:"12px",color:"primary",children:["Fee Tier ",i]})})]}),e.jsx(We,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(C,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(ee,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{u()},children:"OK"})]})})})]})]})}function Mt(g,f,u,c,r,t){const{currentAccount:i}=pt(),p=d.useMemo(()=>{const s={text:"Create",disabled:!1};return i!=null&&i.address?!g||!f||g&&!+g||f&&!+f?(s.text="Enter an amount",s.disabled=!0,s):g&&+g&&xe(g).gt((r==null?void 0:r.balanceFormat)||0)?(s.disabled=!0,s.text=`Insufficient ${F(u==null?void 0:u.symbol)} Balance`,s):f&&+f&&xe(f).gt((t==null?void 0:t.balanceFormat)||0)?(s.disabled=!0,s.text=`Insufficient ${F(c==null?void 0:c.symbol)} Balance`,s):((!g||!f)&&(s.disabled=!0),s):(s.text="Connect Wallet",s.disabled=!1,s)},[i==null?void 0:i.address,g,f,r==null?void 0:r.balanceDisplay,t==null?void 0:t.balanceDisplay,u==null?void 0:u.coin_type,c==null?void 0:c.coin_type]);return{btnText:p.text,btnDisabled:p.disabled}}function Qt({currentStep:g,editStep:f,onCreate:u,baseToken:c,quoteToken:r,baseAmount:t,quoteAmount:i,onBaseAmountChange:p,onQuoteAmountChange:s,isReverse:o,percentMap:j}){const{balanceInfo:n}=Qe(c),{balanceInfo:m}=Qe(r),{btnText:x,btnDisabled:v}=Mt(t,i,c,r,n,m),{fetchTokenPrices:y,getTokenAmountValue:L}=tt(),$=()=>{const h=[];c!=null&&c.coin_type&&h.push(c==null?void 0:c.coin_type),r!=null&&r.coin_type&&h.push(r==null?void 0:r.coin_type),h.length>0&&y(h)};d.useEffect(()=>{$()},[c==null?void 0:c.coin_type,r==null?void 0:r.coin_type]);const U=L(c==null?void 0:c.coin_type,t),G=L(r==null?void 0:r.coin_type,i),N=d.useMemo(()=>{if(+U&&+G)return E(U||"0").plus(G||"0").toString()},[U,G]);return e.jsx(e.Fragment,{children:g===3&&f===3?e.jsxs(V,{w:"100%",gap:"12px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[e.jsx(Ce,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),e.jsx(Ht,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(n==null?void 0:n.balanceFormat)||"",value:t,amountValue:U,loading:!1,onChange:h=>{p(h)},selectable:!1,placeholder:"0.0",token:c},to:{wrapStyle:{h:"108px"},balance:(m==null?void 0:m.balanceFormat)||"",value:i,amountValue:G,loading:!1,onChange:h=>{s(h)},selectable:!1,placeholder:"0.0",token:r}}),e.jsxs(V,{gap:"16px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx($e,{isLoading:!1,label:"Total Amount",value:N&&+N?at(N):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(Lt,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(de,{flexDir:{base:"column",lg:"row"},gap:{base:"4px",lg:"12px"},children:j&&[c,r].filter(Boolean).map((h,R)=>e.jsxs(O,{gap:"4px",justify:"flex-end",children:[e.jsx(vt,{imageUrl:h==null?void 0:h.logo_url,coinType:h?h==null?void 0:h.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(C,{color:R===0?"primary":"primary_green",fontSize:"14px",children:[F(h==null?void 0:h.symbol),"Â ",j[R===0?o?"percentB":"percentA":o?"percentA":"percentB"],"%"]})]},h==null?void 0:h.coin_type))})})]}),e.jsx(ee,{w:"100%",onClick:u,h:"48px",fontSize:"16px",borderRadius:"12px",disabled:v,children:x})]}):null})}function gt({onEdit:g,children:f}){return e.jsxs(O,{w:"100%",p:{base:"16px 8px",lg:"20px 32px"},border:"0px solid",borderColor:"border",borderRadius:"12px",bg:"bg_fifth",justify:"space-between",children:[f,e.jsxs(ee,{onClick:g,variant:"unstyled",border:"1px solid",borderColor:"border",cursor:"pointer",borderRadius:"8px",p:"5px 8px",display:"flex",h:"32px",alignItems:"center",gap:"8px",minW:"auto",_hover:{p:{color:"#fff"},svg:{fill:"#fff"}},children:[e.jsx(we,{xlinkHref:"#icon-icon_edit"}),e.jsx(C,{fontSize:"12px",fontWeight:"500",children:"Edit"})]})]})}function qt({onEdit:g,editStep:f,currentStep:u,onContinue:c,baseToken:r,quoteToken:t,onBaseTokenChange:i,onQuoteTokenChange:p,feeTier:s,feeTierList:o,onFeeTierChange:j,quoteWhiteTokenList:n}){return e.jsx(e.Fragment,{children:f===1||u===1?e.jsx(Wt,{title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:c,baseToken:r,onBaseTokenChange:i,quoteToken:t,onQuoteTokenChange:p,quoteWhiteTokenList:n,feeTier:s,feeTierList:o,onFeeTierChange:j,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool"}):e.jsx(gt,{onEdit:g,children:e.jsxs(O,{gap:"12px",children:[e.jsx(Ne,{coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:t==null?void 0:t.coin_type,w:"36px",h:"36px"}),e.jsxs(O,{children:[e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${F(r==null?void 0:r.symbol)}-${F(t==null?void 0:t.symbol)}`}),e.jsx(k,{h:"16px",p:"1px 8px",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:e.jsx(C,{fontSize:"12px",fontWeight:"500",color:"text_highlight",children:typeof s=="string"?`${xe(s).div(100).toString()}%`:s==null?void 0:s.feeDisplay})})]})]})})})}const Tt=[{label:"Full Range"},{label:"Custom Range"}];function kt({editStep:g,currTick:f,currentStep:u,onEdit:c,onContinue:r,displayBaseToken:t,displayQuoteToken:i,initPrice:p,onInitPriceChange:s,displayMinPrice:o,onMinPriceChange:j,displayMaxPrice:n,onMaxPriceChange:m,isFullRange:x,isReverse:v,handleRangeModeChange:y,handleSwitchDirectionChange:L,handlePriceAction:$}){const[U,G]=d.useState("Full Range"),{isApp:N}=xt(),h=d.useMemo(()=>o?[o.tokenA,o.tokenB].filter(Boolean).map(l=>({label:l==null?void 0:l.symbol,isToken:!0,imgInfo:{src:l==null?void 0:l.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[o==null?void 0:o.tokenA,o==null?void 0:o.tokenB]),R=d.useMemo(()=>`${F(i==null?void 0:i.symbol)} per ${F(t==null?void 0:t.symbol)}`,[t==null?void 0:t.symbol,i==null?void 0:i.symbol]),W=d.useMemo(()=>{var l;return x?!0:((l=o==null?void 0:o.tokenA)==null?void 0:l.coin_type)===(t==null?void 0:t.coin_type)},[x,o==null?void 0:o.tokenA,o==null?void 0:o.tokenB,t==null?void 0:t.coin_type]),{showInputPriceWarn:K,showPriceRangeWarn:M}=Et(x,f,v?n.tick:o.tick,v?o.tick:n.tick),te=d.useMemo(()=>(o==null?void 0:o.price)==="0"&&(n==null?void 0:n.price)==="âˆž",[o==null?void 0:o.price,n==null?void 0:n.price]);return e.jsx(e.Fragment,{children:u>=2?g===2||u===2?e.jsxs(V,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(V,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(Ce,{fontSize:"16px",fontWeight:"500",children:"Set initial Price"}),e.jsxs(de,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:"center",children:[e.jsx(C,{fontSize:"12px",children:"Please set an initial price for this new pool to start."}),e.jsx(Ye,{type:"outlineTab",tabList:h,currentTab:t==null?void 0:t.symbol,handleChangeTab:l=>{l.label!==(t==null?void 0:t.symbol)&&L()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(Ut,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(At,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(Rt,{value:p?be(p,18):"",onChange:l=>{s==null||s(l)},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(Dt,{children:e.jsx(C,{children:R})})]})}),p&&e.jsxs(O,{h:"20px",w:"100%",children:[e.jsxs(C,{color:"text_caption",fontSize:"12px",children:["Current Price: 1 ",F(t==null?void 0:t.symbol)," = ",pe(be(p,18))," ",F(i==null?void 0:i.symbol)]}),e.jsx(we,{w:"16px",h:"16px",svgW:"16px",svgH:"16px",xlinkHref:"#icon-icon_swap1",fontSize:"12px",onClick:L})]})]}),e.jsxs(V,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(Ce,{fontSize:"16px",fontWeight:"500",children:"Set Price Range"}),e.jsx(C,{fontSize:"12px",children:"Please specify a price range that you want to provide your liquidity within."}),e.jsx(Ye,{type:"outlineTab",tabList:Tt,currentTab:x?"Full Range":"Custom Range",handleChangeTab:l=>{G(l==null?void 0:l.label),y((l==null?void 0:l.label)==="Full Range")},wrapStyle:{w:"100%",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"12px",gap:"4px"},itemStyle:{flex:"1",h:"32px",p:"8px",borderRadius:"8px",fontSize:"14px"}}),e.jsxs(de,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(Me,{title:"Min Price",perText:R,data:o,direct:W,loading:!1,handleAddPrice:l=>$("Add",l),handleSubPrice:l=>$("Sub",l),setTickDataBasedOnPrice:j,isFullRange:te}),e.jsx(Me,{title:"Max Price",perText:R,data:n,direct:W,loading:!1,handleAddPrice:l=>$("Add",l),handleSubPrice:l=>$("Sub",l),setTickDataBasedOnPrice:m,isFullRange:te}),!+p&&!x&&e.jsx(qe,{position:"absolute",top:"0px",left:"0",h:"80px",borderRadius:"12px",text:""}),N&&!+p&&!x&&e.jsx(qe,{position:"absolute",top:"88px",left:"0",h:"80px",borderRadius:"12px",text:""})]}),!x&&K&&!M&&e.jsx(k,{w:"100%",p:"8px 16px",borderRadius:"8px",bg:"primary_yellow_opacity.10",children:e.jsx(C,{fontSize:"12px",lineHeight:"16px",color:"primary_yellow",children:"To create a new pool, the initial price you set must be within your price range."})}),!x&&M&&e.jsx(k,{h:"28px",lineHeight:"28px",p:"0 16px",w:"100%",borderRadius:"8px",bg:"primary_red_opacity.10",children:e.jsx(C,{fontSize:"12px",color:"primary_red",children:"The max price should be higher than min price."})}),e.jsx(ee,{mt:"4px",w:"100%",onClick:r,disabled:!p||!+p||!o.price||!n.price||K||M,h:"48px",fontSize:"16px",borderRadius:"12px",children:!p||!+p?"Enter initial price":"Continue"})]})]}):e.jsx(gt,{onEdit:c,children:e.jsxs(V,{gap:"12px",align:"flex-start",children:[e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Initial Price"}),e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${be(p,18)} ${R}`})]}),e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Price Range"}),e.jsxs(C,{color:"text_caption",fontWeight:"500",children:[x?"0 - âˆž":`${v?o.displayReversePrice:o==null?void 0:o.displayPrice} - ${v?n==null?void 0:n.displayReversePrice:n==null?void 0:n.displayPrice} `," ",`${R}`," "]})]})]})}):null})}function er({currentStep:g,handleStepClick:f}){const{isApp:u}=xt();return e.jsxs(de,{flexDir:{base:"row",lg:"column"},gap:"12px",flex:{base:"1",lg:"0 0 258px"},w:{base:"100%",lg:"258px"},p:{base:"12px",lg:"32px"},justify:"center",align:{base:"center",lg:"flex-start"},bg:"bg_fifth",borderRadius:"12px",children:[e.jsx(Pe,{step:1,title:"Select token & fee tier",isActive:g>=1,handleStepClick:f}),e.jsx(k,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(ze,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(Pe,{step:2,title:"Set initial price & range",isActive:g>=2,handleStepClick:f}),e.jsx(k,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx(ze,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(Pe,{step:3,title:"Enter deposit amounts",isActive:g>=3})]})}function Pe({step:g,title:f,isActive:u,handleStepClick:c}){return e.jsxs(O,{w:{base:"32px",lg:"100%"},cursor:c&&u?"pointer":"unset",onClick:()=>{c&&u&&c(g)},children:[e.jsx(k,{as:"div",flex:"0 0 32px",h:"32px",lineHeight:"32px",textAlign:"center",border:"1px solid",fontSize:"12px",fontWeight:"500",color:u?"text_highlight":"text_paragraph",borderColor:"border",borderRadius:"8px",bg:u?"primary_disabled":"transparent",children:g}),e.jsxs(V,{align:"flex-start",display:{base:"none",lg:"flex"},children:[e.jsxs(C,{fontSize:"14px",color:u?"text_caption":"text_paragraph",fontWeight:"500",children:["Step Â ",g]}),e.jsx(C,{fontSize:"12px",color:u?"primary":"text_paragraph",fontWeight:"500",children:f})]})]})}function tr(){const g=(r,t,i,p,s)=>{const o=i.decimals,j=p.decimals;let n;Math.abs(r)==Math.abs(X.getMinIndex(s))?n=t==="lower"?"0":"âˆž":n=T.tickIndexToPrice(r,o,j).toString();const m=n==="âˆž"?"âˆž":ne(n,6).toString(),x=Fe(n),v=x==="âˆž"?"âˆž":ne(x,6).toString();return{id:t,tokenA:i,tokenB:p,tick:r,price:n,displayPrice:m,reversePrice:x,displayReversePrice:v,tickSpacing:s.toString(),pool:"1"}},f=(r,t)=>{const i=r.tokenA,p=r.tokenB;if(!i||!p||t.length===0)return;let s,o="";if(t==="âˆž")s=X.getMaxIndex(Number(r.tickSpacing)),o="âˆž";else if(E(t).equals(0))s=X.getMinIndex(Number(r.tickSpacing)),o="0";else if(E(t).gt(0)){const x=T.priceToTickIndex(E(t),i.decimals,p.decimals);s=De(Number(x),Number(r.tickSpacing)),o=T.tickIndexToPrice(Number(s),i.decimals,p.decimals).toString()}const j=o==="âˆž"?"âˆž":ne(o,6),n=Fe(o),m=n==="âˆž"?"âˆž":ne(n,6);if(s!==void 0)return{...r,tick:s,price:o,displayPrice:j.toString(),reversePrice:n,displayReversePrice:m.toString()}},u=(r,t="Add")=>{const{tokenA:i,tokenB:p,tick:s,tickSpacing:o}=r;if(i&&p&&o){const j=t==="Add"?E(s).add(o).toNumber():E(s).sub(o).toNumber();if(E(j).gt(X.getMaxIndex(Number(r.tickSpacing)))||E(j).lt(X.getMinIndex(Number(r.tickSpacing))))return;const n=T.tickIndexToPrice(j,i.decimals,p.decimals).toString(),m=n==="âˆž"?"âˆž":ne(n,6);if(m===r.displayPrice){const x=Number(r.tickSpacing)<20?40:1;return u({...r,tick:t==="Add"?E(s).add(Number(o)*x).toNumber():E(s).sub(Number(o)*x).toNumber()},t)}else{const x=Fe(n),v=x==="âˆž"?"âˆž":ne(x,6);return{id:r.id,tick:j,price:n.toString(),displayPrice:m.toString(),reversePrice:x.toString(),displayReversePrice:v.toString(),tokenA:i,tokenB:p,tickSpacing:o,pool:"1"}}}};return{calcInitPriceRange:(r,t,i,p,s,o,j)=>{console.log("ðŸš€ ~ file: useCreatePriceRange.ts:84 ~ useCreatePriceRange ~ calcInitPriceRange:",{tickSpacing:i,baseToken:p,quoteToken:s});try{if(i&&p&&s){const n=X.getMaxIndex(i),m=X.getMinIndex(i);if(r){const x={id:"lower",tokenA:p,tokenB:s,tick:m,price:"0",displayPrice:"0",reversePrice:"âˆž",displayReversePrice:"âˆž",tickSpacing:i.toString(),pool:new Date().getTime().toString()},v={id:"upper",tokenA:p,tokenB:s,tick:n,price:"âˆž",displayPrice:"âˆž",reversePrice:"0",displayReversePrice:"0",tickSpacing:i.toString(),pool:new Date().getTime().toString()};if(t&&+t){const y=T.priceToTickIndex(E(t),p.decimals,s.decimals);return{minData:x,maxData:v,currTick:y}}return{minData:x,maxData:v,currTick:void 0}}else if(t&&+t){const x=T.priceToTickIndex(E(t),p.decimals,s.decimals),v=o||De(Number(x-i*5),Number(i));v<m&&(o=m);const y=j||De(Number(x+i*5),Number(i));y>n&&(j=n);const L=g(v,"lower",p,s,i),$=g(y,"upper",p,s,i);return{minData:L,maxData:$,currTick:x}}}}catch(n){console.log("ðŸš€ ~ file: useCreatePriceRange.ts:228 ~ useCreatePriceRange ~ error:",n)}},handleActionPrice:u,updateTickDataBasedOnPrice:f}}function rr(){dt();const{base:g,quote:f,fee:u}=It(),{tokenInfo:c}=ke(g),{tokenInfo:r}=ke(f),[t,i]=d.useState(void 0),[p,s]=d.useState([]),[o,j]=d.useState(1),[n,m]=d.useState(0),{signAndExecuteTransaction:x,transactionConfirmation:v,transactionRejected:y}=Gt(),{fetchAccountBalance:L}=ht(),{preAddPool:$,fetchFeeTierList:U,getCreatePoolTxPayload:G}=Vt(),{quoteWhiteTokenList:N}=zt(),[h,R]=d.useState(),[W,K]=d.useState(),[M,te]=d.useState(!0);d.useEffect(()=>{L()},[]);const[l,Y]=d.useState(),[_,Z]=d.useState(),[z,re]=d.useState(""),[H,ue]=d.useState(!0),[A,ie]=d.useState({}),[P,oe]=d.useState({}),[he,ge]=d.useState(),[_e,fe]=d.useState(void 0),D=d.useMemo(()=>l&&_?Ft(Ze(l.coin_type),Ze(_.coin_type)):!1,[l,_]),[ye,me]=d.useState(void 0),{calcInitPriceRange:ve,handleActionPrice:Ae,updateTickDataBasedOnPrice:I}=tr(),[J,Se]=d.useState(""),[le,je]=d.useState("");d.useEffect(()=>{r&&!Te(r,N)?Te(c,N)?(R(r),Y(r),Z(c||ce.sui_coin),K(c||ce.sui_coin)):(R(void 0),Y(void 0),Z(ce.sui_coin),K(ce.sui_coin)):(R(c),Y(c),Z(r||ce.sui_coin),K(r||ce.sui_coin))},[c==null?void 0:c.coin_type,r==null?void 0:r.coin_type,N]),d.useEffect(()=>{Oe()},[h==null?void 0:h.coin_type,W==null?void 0:W.coin_type]);const Oe=()=>{var a;h&&W?U(h.coin_type,W.coin_type).then(b=>{s(b);const S=b.filter(B=>B.poolAddress===void 0),w=S.find(B=>B.feeRate===u)||S.find(B=>B.feeRate==="25")||(S.length>0?S[0]:void 0)||(b.length>0?b[0]:void 0);w&&Le(w)}):(s((a=Bt)==null?void 0:a.map(b=>({...b,title:""}))),i(void 0))},ft=(a,b=!0)=>{Re(1),b?(R(a),Y(a),Z(W),(a==null?void 0:a.coin_type)===(W==null?void 0:W.coin_type)&&(K(void 0),Z(void 0))):(K(a),Z(a),Y(h),(a==null?void 0:a.coin_type)===(h==null?void 0:h.coin_type)&&(R(void 0),Y(void 0)))},Le=a=>{i(a),j(1),_t(),Q(!0)},mt=()=>{const a=l;if(Y(_),Z(a),+z){const S=lt(E(1).div(z).toFixed(18),18,!0).toString();re(S)}};d.useEffect(()=>{He(H)},[z,t==null?void 0:t.tickSpacing]);const He=(a,b,S)=>{se();const w=ve(a,z&&+z?D?(1/Number(z)).toString():z:"",Number((t==null?void 0:t.tickSpacing)||0),D?_:l,D?l:_,b,S);console.log("ðŸš€ ~ handleInitPriceRange ~ data:",w),w?(oe(w.maxData),ie(w.minData),ge(w.currTick)):ge(void 0)};d.useMemo(()=>{if(t&&l&&_)return T.tickIndexToPrice(X.getMaxIndex(20),6,6).toFixed(9,Pt.ROUND_DOWN)},[t==null?void 0:t.tickSpacing,l==null?void 0:l.decimals,_==null?void 0:_.decimals]);const St=a=>{re(a)},Q=(a,b,S)=>{ue(a),se(),He(a,b,S)},Ee=d.useMemo(()=>H?A:D?P:A,[H,A,P,D]),Ve=d.useMemo(()=>H?P:D?A:P,[H,A,P,D]),jt=(a,b)=>{se();const S=Ae(b,a);S&&((S==null?void 0:S.id)===(A==null?void 0:A.id)?ie(S):oe(S))},bt=Xt(H),Ct=(a,b,S)=>{const w=I(a,b);if(w){w.pool=new Date().getTime().toString();let B=A==null?void 0:A.tick,q=P==null?void 0:P.tick;w.id==="lower"?(ie({...w}),B=w.tick):(oe({...w}),q=w.tick),B!==void 0&&q!==void 0&&t?bt&&(X.getMaxIndex(Number(t.tickSpacing))!==q||X.getMinIndex(Number(t.tickSpacing))!==B?Q(!1):Q(!0)):Q(!1,B,q)}else Q(!1)},wt=(a,b)=>{te(b),b?Se(a):je(a);const S=Ue(a,b);S?(me(S),b?je(D?S.coinAmountA:S.coinAmountB):Se(D?S.coinAmountB:S.coinAmountA)):(b?je(""):Se(""),me(void 0))},Re=a=>{console.log("ðŸš€ ~ file: useCreatePool.ts:288 ~ handleStepClick ~ step:",a,o,n),a===1?(j(1),m(1),re(""),Q(!0),se()):a===2?(j(2),m(2),se()):(j(3),m(3))},Ue=(a,b,S)=>{if(_&&l&&z&&t&&a&&+a&&(A!=null&&A.price)&&(P!=null&&P.price))try{const w=$({realTokenA:D?_:l,realTokenB:D?l:_,needReverse:A.tokenA.coin_type!==l.coin_type,tickSpacing:Number(t.tickSpacing),amount:a,amountCoinType:b?l.coin_type:_.coin_type,maxPrice:H?P.price:D?A.reversePrice:P.price,minPrice:H?A.price:D?P.reversePrice:A.price,price:D?E(1).div(z).toString():z});return console.log("ðŸš€ ~ file: useCreatePool.ts:212 ~ handleAmountChange ~ res:",w),w}catch(w){console.log("ðŸš€ ~ file: useCreatePool.ts:240 ~ preCalcAddPool ~ error:",w)}};Kt(()=>{const a=Ue("1",!0);if(a){const b=ut(a==null?void 0:a.coinAmountA,a==null?void 0:a.coinAmountB,D?(1/Number(z)).toString():z,H);console.log("ðŸš€ ~ file: useCreatePool.ts:273 ~ useCreatePool ~ perMap:",b),fe(b)}else fe(void 0)},[z,A.tick,P.tick,H,D,t==null?void 0:t.tickSpacing],{wait:500});const _t=()=>{re(""),se(),ue(!0)},se=()=>{Se(""),je("")};return{baseToken:h,quoteToken:W,handleSelectTokenChange:ft,displayQuoteWhiteTokenList:N,feeTier:t,setFeeTier:i,feeTierList:p,currentStep:o,editStep:n,setCurrentStep:j,setEditStep:m,displayBaseToken:l,displayQuoteToken:_,handleSwitchDirectionChange:mt,initPrice:z,handleInitPriceChange:St,isFullRange:H,handleRangeModeChange:Q,minTickData:A,maxTickData:P,isReverse:D,handleFeeTierChange:Le,handlePriceAction:jt,baseAmount:J,quoteAmount:le,handleAmountChange:wt,getConfirmData:()=>({isReverse:D,baseToken:l,quoteToken:_,baseAmount:J,quoteAmount:le,minPrice:Ee,maxPrice:Ve,initPrice:z,feeDisplay:t.feeDisplay,isFullRange:H}),handleCreateAction:async()=>{const a=A.tokenA;A.tokenB,a.coin_type,M?l.coin_type:_.coin_type;const b={getShowInfo:(S,w)=>{const B=F(l==null?void 0:l.symbol),q=F(_==null?void 0:_.symbol),Ge=`Add ${pe(J)} ${B} and ${pe(le)} ${q}`,ae={modalDescriptionText:Ge,toastTitleText:Ge};if(S==="success"){let Be=J,Ke=le;w&&(Be=Je(w,l)||J,Ke=Je(w,_)||le);const Xe=`Add ${pe(Be)} ${B} and ${pe(Ke)} ${q}`;ae.toastDescriptionContent=Xe,ae.modalDescriptionText=Xe,ae.toastTitleText="Create Success"}return S==="rejected"&&(ae.toastTitleText="Create pool"),ae}};v(b);try{const S=await G(ye),w=await x(S,b,{showSuccessModal:!1,useDevInspect:!0,txAction:"signAndExecuteTransactionBlock"});if(console.log("ðŸš€ ~ handleCreateAction ~ res:",w),w)return L(),Oe(),Re(1),t.feeDisplay}catch(S){console.log("ðŸš€ ~ file: useCreatePool.ts:341 ~ handleCreateAction ~ error:",S),y(b)}},percentMap:_e,currTick:he,displayMinPrice:Ee,displayMaxPrice:Ve,handleTickPriceChange:Ct,handleStepClick:Re,fetchFeeTierList:U}}function Br(){const g=dt(),{baseToken:f,quoteToken:u,feeTier:c,currentStep:r,editStep:t,feeTierList:i,handleSelectTokenChange:p,displayQuoteWhiteTokenList:s,displayBaseToken:o,displayQuoteToken:j,handleSwitchDirectionChange:n,initPrice:m,handleInitPriceChange:x,isFullRange:v,handleRangeModeChange:y,handleTickPriceChange:L,isReverse:$,handleFeeTierChange:U,handlePriceAction:G,baseAmount:N,quoteAmount:h,handleAmountChange:R,getConfirmData:W,handleCreateAction:K,percentMap:M,currTick:te,displayMinPrice:l,displayMaxPrice:Y,handleStepClick:_,fetchFeeTierList:Z}=rr(),{currentAccount:z,onWalletModal:re}=pt(),{isOpen:H,onOpen:ue,onClose:A}=Ie(),{isOpen:ie,onOpen:P,onClose:oe}=Ie(),{isOpen:he,onOpen:ge,onClose:_e}=Ie(),{fetchAccountBalance:fe}=ht(),[D,ye]=d.useState(),me=()=>{f&&u&&c&&g(`/liquidity?tab=deposit&poolAddress=${c==null?void 0:c.poolAddress}`,{replace:!0})},ve=()=>({baseToken:o,quoteToken:j,feeDisplay:D}),Ae=()=>{f&&u&&Z(f.coin_type,u.coin_type),fe()};return e.jsxs(V,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",children:[e.jsxs(ee,{variant:"outline",h:"32px",onClick:()=>g("/pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(we,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(C,{fontSize:"12px",children:"Back"})]}),e.jsx(Yt,{handleRefresh:Ae,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(de,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(er,{currentStep:r,handleStepClick:_}),e.jsxs(V,{w:"100%",gap:"16px",children:[e.jsx(qt,{editStep:t,currentStep:r,onEdit:()=>{_(1)},onContinue:()=>{c&&(c.poolAddress?ue():_(2))},baseToken:f,onBaseTokenChange:I=>p(I,!0),quoteToken:u,onQuoteTokenChange:I=>p(I,!1),feeTier:c,feeTierList:i,quoteWhiteTokenList:s,onFeeTierChange:I=>U(I),fromSource:"createPool"}),e.jsx(kt,{editStep:t,currentStep:r,onEdit:()=>_(2),onContinue:()=>{_(3)},displayBaseToken:o,displayQuoteToken:j,initPrice:m,currTick:te,isReverse:$,onInitPriceChange:I=>x(I),handlePriceAction:G,displayMinPrice:l,onMinPriceChange:(I,J)=>{L(I,J,!0)},displayMaxPrice:Y,onMaxPriceChange:(I,J)=>{L(I,J,!1)},handleSwitchDirectionChange:n,isFullRange:v,handleRangeModeChange:y}),e.jsx(Qt,{currentStep:r,editStep:t,onCreate:()=>{z?P():re(!0)},percentMap:M,baseToken:o,quoteToken:j,baseAmount:N,quoteAmount:h,onBaseAmountChange:I=>R(I,!0),onQuoteAmountChange:I=>R(I,!1),isReverse:$})]})]}),H&&e.jsx($t,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:H,onClose:A,onConfirm:me}),ie&&e.jsx(Zt,{isOpen:ie,onClose:oe,onSubmit:async()=>{oe();const I=await K();I&&(ye(I),ge())},data:W()}),he&&D&&e.jsx(Jt,{isOpen:he,onClose:_e,data:ve()})]})}export{Br as default};
