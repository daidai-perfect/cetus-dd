import{U as E,bT as _,bU as N,bV as W,bW as M,bX as X,u as $,an as Y,R as K,r as q,X as I,aI as C,bb as B,bh as U,bg as x,d as S,ab as v,aa as F,bY as H,aX as h,bZ as Z,b_ as z}from"./index-RYgVkSoi.js";import{u as G}from"./useToken-ptIKZ0M9.js";import{l as J}from"./api-data-utils-BpogEvv2.js";import{u as Q,d as ee,e as oe,c as se,f as j,h as te}from"./useGetPoolList-BZbnERIp.js";const ae=(t,R)=>({poolListLength:"",setPoolListLength:e=>{t(()=>({poolListLength:e}))},poolRefreshStatus:"pending",setPoolRefreshStatus:e=>{t(()=>({poolRefreshStatus:e}))},isWatchList:void 0,setIsWatchList:e=>{t(()=>({isWatchList:e})),_.setItem(W,e)},isAllPools:!1,setIsAllPools:e=>{t(()=>({isAllPools:e})),_.setItem(M,e)},isIncentivizedOnly:!1,setIsIncentivizedOnly:e=>{t(()=>({isIncentivizedOnly:e})),_.setItem(X,e)},poolFavoriteIds:[],setPoolFavoriteId:e=>{const p=[...R().poolFavoriteIds,e];t(()=>({poolFavoriteIds:p})),_.setItem(N,p)},setPoolFavoriteIds:e=>{t(()=>({poolFavoriteIds:e})),_.setItem(N,e)},poolFavoriteIdsChange:!1,setPoolFavoriteIdsChange:e=>{t(()=>({poolFavoriteIdsChange:e}))}}),O=E(ae);_.getItem(N).then(t=>{console.log("ðŸš€ ~ file: store/pool/index.ts.ts ~ savedPoolFavoriteList:",t),(t==null?void 0:t.length)>0&&O.getState().setPoolFavoriteIds(t)});_.getItem(W).then(t=>{console.log("ðŸš€ ~ LocalStorageService isWatchList:",t),typeof t=="boolean"?O.getState().setIsWatchList(t):O.getState().setIsWatchList(!1)});_.getItem(M).then(t=>{console.log("ðŸš€ ~ LocalStorageService isAllPools:",t),typeof t=="boolean"&&O.getState().setIsAllPools(t)});_.getItem(X).then(t=>{console.log("ðŸš€ ~ LocalStorageService isIncentivizedOnly:",t),typeof t=="boolean"&&O.getState().setIsIncentivizedOnly(t)});function ne(){const{fetchByApi:t}=$(),{getLocalJsonPoolList:R}=Q(),{wrapPoolData:e}=ee(),{poolFavoriteIds:p,setPoolFavoriteId:c,setPoolFavoriteIds:i,setPoolFavoriteIdsChange:g}=O(),{successTsToast:u,failedTsToast:a}=Y();return{addFavorites:r=>{const o={linkLabel:"",getShowInfo:()=>({toastTitleText:p.length>=100?"Watchlist exceeds the maximum limit":"Added to Watchlist"})};p.length>=100?a(o):(c(r),g(!0),u(o))},removeFavorites:r=>{const o=p==null?void 0:p.filter(f=>f!==r);i(o),g(!0),u({linkLabel:"",getShowInfo:()=>({toastTitleText:"Removed from Watchlist"})})},getFavoritePoolList:async r=>{var f,w,y;const{needLocalData:o=!0}=r;if(((r==null?void 0:r.pools)||[]).length>0)try{const l=await t(J,"POST",r);if(l!=null&&l.data)return console.log("ðŸš€ ~ getFavoritePoolList ~ res?.data:",l==null?void 0:l.data),{list:(w=(f=l==null?void 0:l.data)==null?void 0:f.lp_list)==null?void 0:w.map(D=>e(D)),total:(y=l==null?void 0:l.data)==null?void 0:y.total}}catch(l){if(console.log("ðŸš€ ~ getFavoritePoolList ~ error:",l),o)return await R(r)}return{list:[],total:0}}}}const re=(t,R)=>({showPosListLength:"",setShowPosListLength:e=>{t(()=>({showPosListLength:e}))},posApiPoolData:{},setPosApiPoolData:e=>{t(()=>({posApiPoolData:e}))},myPosYieldValue:"",setMyPosYieldValue:e=>{t(()=>({myPosYieldValue:e}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:e=>{const p=e.reduce((c,i)=>{var g,u,a;return c[i.clmmPool]||(c[i.clmmPool]={list:[]}),(g=c[i.clmmPool])!=null&&g.tokenA||(c[i.clmmPool].isReverse=i==null?void 0:i.isReverse,c[i.clmmPool].tokenA=i==null?void 0:i.tokenA,c[i.clmmPool].tokenB=i==null?void 0:i.tokenB,c[i.clmmPool].displayTokenA=i==null?void 0:i.displayTokenA,c[i.clmmPool].displayTokenB=i==null?void 0:i.displayTokenB,c[i.clmmPool].clmmPoolAddress=i.clmmPool),(a=(u=c[i.clmmPool])==null?void 0:u.list)==null||a.push(i),c},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",p),t(()=>({posBaseList:e,posBaseListGroupByPool:p,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:e=>{t(()=>({posBaseListLoading:e}))},setPosBaseListIsLoading:e=>{t(()=>({posBaseListLoading:e}))},fullRangePosBaseList:[],setFullRangePosBaseList:e=>{t(()=>({fullRangePosBaseList:e,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:e=>{t(()=>({fullRangePosBaseListLoading:e}))},posPoolsOriginalData:{},setPosPoolOriginalData:e=>{t(()=>({posPoolsOriginalData:e}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:e=>{t(()=>({posPoolsRelatedData:e,posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:e=>{t(()=>({posPoolsRelatedDataLoading:e}))},posLiquidityData:{},setPosLiquidityData:e=>{t(()=>({posLiquidityData:e,posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:e=>{t(()=>({posLiquidityDataLoading:e}))},posRewardsData:{},setPosRewardsData:e=>{t(()=>({posRewardsData:e,posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:e=>{t(()=>({posRewardsDataLoading:e}))},farmsPosRewardsData:{},setFarmsPosRewardsData:e=>{t(()=>({farmsPosRewardsData:e,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:e=>{t(()=>({farmsPosRewardsDataLoading:e}))},posFeeData:{},setPosFeeData:e=>{t(()=>({posFeeData:e,posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:e=>{t(()=>({posFeeDataLoading:e}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:e=>{t(()=>({currentPosBaseInfo:e,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:e=>{t(()=>({currentPosBaseInfoLoading:e}))}}),b=E(re);function ie(){const{peripherySdk:t}=K(),{getTokenInfo:R}=G(),{setFarmsPosRewardsData:e,setFarmsPosRewardsDataLoading:p}=b(),c=q.useRef(t);return q.useEffect(()=>{c.current=t},[t.ClmmSDK.senderAddress]),{getFarmsRewardsData:async g=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",g),p(!0);const u=g==null?void 0:g.filter(a=>a.posType==="farms").map(a=>({pool_id:a.farmsPool,position_nft_id:a.id}));try{let a={},n={};if(u&&u.length>0&&(a=await c.current.Farms.calculateFarmingRewards(u),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",a,c.current.ClmmSDK.senderAddress,u),a)){const s=Object.entries(a).map(([P,r])=>({id:P,rewarderAmountOwed:r}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",s),n=Object.fromEntries(s.map((P,r)=>{for(const o of P.rewarderAmountOwed){const{rewarder_amount:m,rewarder_type:f}=o,w=R(f);o.display_amount_owed=I(m.toString(),(w==null?void 0:w.decimals)||0),o.amount_owed=m.toString(),o.token=w}return[P.id,P.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",n),e(n)}catch(a){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",a)}}}}function le(){const{setPosApiPoolData:t}=b(),{getFavoritePoolList:R}=ne();return{getPosApiPoolData:async p=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",p);const i={needLocalData:!1,pools:Array.from(new Set(p==null?void 0:p.map(a=>a.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",i);const g=await R(i)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",g);const u=g==null?void 0:g.list.reduce((a,n)=>(a[n.poolAddress]=n,a),{});t(u)}catch(c){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",c)}}}}function ce(){const{clmmSdk:t}=C(),{setPosFeeData:R,setPosFeeDataLoading:e}=b();return{getPosFeeData:async c=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",c),e(!0);const i=c==null?void 0:c.map(a=>({poolAddress:a.clmmPool,positionId:a.posId,coinTypeA:a.coinTypeA,coinTypeB:a.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",i);const g=await t.Position.fetchPosFeeAmount(i)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",g);const u=Object.fromEntries(g.map((a,n)=>{var o,m;const s=c[n],P=I(s.isReverse?a.feeOwedB.toString():a.feeOwedA.toString(),((o=s==null?void 0:s.displayTokenA)==null?void 0:o.decimals)||0),r=I(s.isReverse?a.feeOwedA.toString():a.feeOwedB.toString(),((m=s==null?void 0:s.displayTokenB)==null?void 0:m.decimals)||0);return[a.position_id,{feeOwedA:a.feeOwedA.toString(),feeOwedB:a.feeOwedB.toString(),displayFeeOwedA:P,displayFeeOwedB:r}]}));console.log("getPosFeeData ~ posFeesData:",u),R(u)}}}function de(){const{setPosLiquidityData:t,setPosLiquidityDataLoading:R}=b(),e=({tokenA:c,tokenB:i,liquidity:g,currentSqrtPrice:u,lowerTick:a,upperTick:n,roundUp:s})=>{const P=B.tickIndexToSqrtPriceX64(a),r=B.tickIndexToSqrtPriceX64(n),o=U.getCoinAmountFromLiquidity(new x(g),new x(u),P,r,s),m=o.coinA.toString(),f=o.coinB.toString(),w=c.decimals,y=i.decimals,l=I(m,w||0),d=I(f,y||0);return{coinAmountA:m,coinAmountB:f,amountA:l,amountB:d}};return{getPosLiquidityData:async(c,i)=>{R(!0);const g={};for(let u=0;u<c.length;u++){const a=c[u],n=i==null?void 0:i[a.clmmPool],{coinAmountA:s,coinAmountB:P,amountA:r,amountB:o}=e({tokenA:a.tokenA,tokenB:a.tokenB,liquidity:a.liquidity,currentSqrtPrice:n==null?void 0:n.current_sqrt_price,lowerTick:a.lowerTick,upperTick:a.upperTick,roundUp:!0}),m=oe(a.lowerTick,a.upperTick),f=a.tokenA.decimals,w=a.tokenB.decimals,y=B.sqrtPriceX64ToPrice(new x(n==null?void 0:n.current_sqrt_price),f,w).toString(),{percentA:l,percentB:d}=se(r,o,y,m);g[a.posId]={coinAmountA:s,coinAmountB:P,displayCoinAmountA:a.isReverse?o:r,displayCoinAmountB:a.isReverse?r:o,displayPercentA:a.isReverse?d:l,displayPercentB:a.isReverse?l:d}}console.log("getPosLisuidityData ~ posLiquidityData:",g),t(g)},getCoinAmountFromLiquidity:e}}function ue(){const{clmmSdk:t}=C(),{setPosPoolOriginalData:R,setPosPoolsRelatedData:e,setPosPoolsRelatedDataLoading:p,setFullRangePosBaseList:c,setFullRangePosBaseListLoading:i}=b();return{getPosPoolsOriginalObj:async a=>{const n=a==null?void 0:a.map(r=>r.clmmPool),s=[...new Set([...n])];let P={};if(s&&s.length>0){const r=await t.Pool.getPools(s,0,1e3);P=Object.fromEntries(r==null?void 0:r.map(o=>{const m=a.find(d=>d.clmmPool===(o==null?void 0:o.poolAddress)),f=m.tokenA.decimals,w=m.tokenB.decimals,y=B.sqrtPriceX64ToPrice(new x(o==null?void 0:o.current_sqrt_price),f,w).toString(),l=S(1).div(y).toString();return[o==null?void 0:o.poolAddress,{...o,currentPrice:y,currentPriceReverse:l}]}))}return R(P),P},getPosPoolsRelatedData:(a,n)=>{p(!0),i(!0);const s={},P=[];a.forEach(r=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",r);const o=n[r.clmmPool],m=r.tokenA.decimals,f=r.tokenB.decimals,w=B.sqrtPriceX64ToPrice(new x(o==null?void 0:o.current_sqrt_price),m,f).toString(),y=S(1).div(w).toString();let l="0",d="0";j(r.lowerTick,"min")?l="0":l=B.tickIndexToPrice(Number(r.lowerTick),m,f).toString(),j(r.upperTick,"max")?d="âˆž":d=B.tickIndexToPrice(Number(r.upperTick),m,f).toString();let D,T;d!=="âˆž"?T=S(1).div(S(d)).toString():T="0",l!=="0"?D=S(1).div(S(l)).toString():D="âˆž";let L="";o!=null&&o.is_pause?L="Closed":Number(w)>=Number(l)&&(d==="âˆž"||Number(w)<=Number(d))?L="Active":(Number(w)>Number(d)||Number(w)<Number(l))&&(L="Inactive"),(l==="0"&&d==="âˆž"||D==="0"&&T==="âˆž")&&r.posType==="clmm"&&P.push(r);const k=r.isReverse;s[r.posId]={currentPrice:o?v(k?y:w).toString():"",currentPriceReverse:o?v(k?w:y).toString():"",minPrice:v(k?T:l).toString(),minPriceResever:v(k?l:T).toString(),maxPrice:v(k?D:d).toString(),maxPriceResever:v(k?d:D).toString(),minPriceOrigin:o?k?T:l:"",maxPriceOrigin:o?k?D:d:"",currentStatus:o?L:"",fee:o==null?void 0:o.fee_rate,displayFee:S(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),e(s),c(P)}}}function Pe(){const{clmmSdk:t}=C(),{getTokenInfo:R}=G(),{setPosRewardsData:e,setPosRewardsDataLoading:p}=b();return{getPosRewardsData:async(i,g)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",i),p(!0);const u=i==null?void 0:i.filter(n=>n.posType!=="farms").map(n=>{const s=g[n.clmmPool];return{poolAddress:n.clmmPool,positionId:n.posId,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,rewarderInfo:s.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",u);let a={};if(u&&u.length>0)try{const n=await t.Rewarder.fetchPosRewardersAmount(u);a=Object.fromEntries(n.map((s,P)=>{for(const r of s.rewarderAmountOwed){const{amount_owed:o,coin_address:m}=r,f=R(m);r.display_amount_owed=I(o.toString(),(f==null?void 0:f.decimals)||0),r.amount_owed=o.toString(),r.token=f}return[s.positionId,s.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",a)}catch(n){console.log("getPosRewardsData ~ error:",n)}e(a)}}}function V(){const t=(c,i)=>{if(i||i==0)return`Cetus LP | Pool${i}-${c}`},R=q.useMemo(()=>`${F.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[F]),e=q.useMemo(()=>`${F.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[F]),p=q.useMemo(()=>`${F.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[F]);return{getClmmPosName:t,buildPositionType:R,buildFarmsPositionType:e,buildBurnPositionType:p}}function ge(){const{buildPositionType:t,buildFarmsPositionType:R,buildBurnPositionType:e}=V(),{getTokenInfo:p}=G(),c=(n,s)=>{const P=!te(n,s),r=p(n),o=p(s);return{isReverse:P,tokenA:r,tokenB:o,displayTokenA:P?o:r,displayTokenB:P?r:o}},i=n=>{var d;const s=H(n),P=h(s.coin_type_a).full_address,r=h(s.coin_type_b).full_address,{isReverse:o,tokenA:m,tokenB:f,displayTokenA:w,displayTokenB:y}=c(P,r),l=((d=n==null?void 0:n.data)==null?void 0:d.version)||"0";return{clmmPool:s.pool,posId:s.pos_object_id,id:s.pos_object_id,liquidity:s.liquidity,index:s.index,lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:s.owner,coinTypeA:P,coinTypeB:r,posType:"clmm",tokenName:"",tokenA:m,tokenB:f,displayTokenA:w,displayTokenB:y,isReverse:o,version:l}},g=n=>{var d;const s=Z.buildFramsPositionNFT(n),P=((d=n==null?void 0:n.data)==null?void 0:d.version)||"0",r=h(s.coinTypeA).full_address,o=h(s.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:w,displayTokenA:y,displayTokenB:l}=c(r,o);return{clmmPool:s.clmm_pool_id,farmsPool:s.pool_id,posId:s.clmm_position_id,id:s.id,liquidity:s.liquidity,index:s.name.split("-")[1],lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"farms",tokenName:s.name,isReverse:m,tokenA:f,tokenB:w,displayTokenA:y,displayTokenB:l,version:P}},u=n=>{var d,D,T;const s=z.buildBurnPositionNFT((D=(d=n==null?void 0:n.data)==null?void 0:d.content)==null?void 0:D.fields),P=((T=n==null?void 0:n.data)==null?void 0:T.version)||"0",r=h(s.coinTypeA).full_address,o=h(s.coinTypeB).full_address,{isReverse:m,tokenA:f,tokenB:w,displayTokenA:y,displayTokenB:l}=c(r,o);return{clmmPool:s.clmm_pool_id,posId:s.clmm_position_id,liquidity:s.liquidity,index:s.index,id:s.id,lowerTick:s.tick_lower_index,upperTick:s.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"burn",tokenName:s.name,isReverse:m,tokenA:f,tokenB:w,displayTokenA:y,displayTokenB:l,version:P}};return{wrapClmmPosBaseInfo:i,wrapBurnPosBaseInfo:u,wrapFarmsPosBaseInfo:g,buildPosBaseInfo:n=>{const s=h(n.data.type);return s.full_address===t?i(n):s.full_address===R?g(n):s.full_address===e?u(n):null}}}function we(){const{clmmSdk:t}=C(),{buildPositionType:R,buildFarmsPositionType:e,buildBurnPositionType:p}=V(),{buildPosBaseInfo:c}=ge(),{setPosBaseList:i,setFullRangePosBaseList:g,setPosBaseListLoading:u}=b(),{getPosPoolsOriginalObj:a,getPosPoolsRelatedData:n}=ue(),{getPosLiquidityData:s}=de(),{getPosFeeData:P}=ce(),{getPosApiPoolData:r}=le(),{getPosRewardsData:o}=Pe(),{getFarmsRewardsData:m}=ie();return{getPositionBaseList:async(y,l)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",l),u(!0);try{const d=await t.fullClient.getOwnedObjectsByPage(y,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:F.clmm_sdk_options.clmm_pool.package_id},{StructType:e},{StructType:p}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",d);const D=[];for(const k of d.data){const A=c(k);S(A==null?void 0:A.liquidity).lte(0)||!(A!=null&&A.displayTokenA)||!(A!=null&&A.displayTokenB)||A&&D.push(A)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",D);const T=D.sort((k,A)=>A.version-k.version);let L=[];return l?L=T==null?void 0:T.filter(k=>k.clmmPool===l):L=T,i(L),u(!1),(L==null?void 0:L.length)==0&&g([]),L}catch(d){if(console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",d),d instanceof TypeError)return u(!1),i([]),"Something went wrong, please change the rpc node and try again"}},getPosRelatedData:async(y,l=!1)=>{var d;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",l,y),m(y),l||(r(y),P(y));try{const D=await a(y);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",D),n(y,D),((d=Object.keys(D))==null?void 0:d.length)>0&&(s(y,D),l||o(y,D))}catch(D){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",D)}}}}export{ne as a,V as b,b as c,we as d,ce as e,Pe as f,ie as g,de as h,ge as i,O as u};
