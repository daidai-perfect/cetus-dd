import{a as m,j as i,a7 as qe,T as w,V as Y,H as c,u as de,aq as Si,v as Oe,R as vi,f as Ue,ab as Ci,as as _i}from"./vendor-DXHkIl66.js";import{A as Ri}from"./index-9YMM8VLO.js";import{C as Li}from"./CoinPairInfo-18SnxIQd.js";import{S as Fi}from"./Slippage-C3CIJtWK.js";import{u as Mi,L as Ei,S as Ee}from"./LiquidityRangeChart-Bgl68zcm.js";import{u as oi,a as Di}from"./useTransaction-HT-BOlou.js";import{u as Wi,a as Vi,P as Gi}from"./PositionCurrentPrice-A2W_iwn3.js";import{a as Ye}from"./useNotifiSubscription-Bli90fgE.js";import{b as Ni,c as Hi,a as je,d as xi,e as zi,f as Zi}from"./usePositionList-BulHo-5f.js";import{u as Se}from"./detail-B3wKtpN6.js";import{j as We,y as oe,a as $e,B as ne,c as ei,X as ue,O as mi,d as me,e as ni,n as Qe,r as qi,a1 as Oi,q as ii,a3 as Ui,p as Yi,a4 as si,a0 as $i,$ as Qi,a2 as Xi,aa as Ji,v as Ki,w as li,i as fi}from"./index-1pql7esm.js";import{u as Xe}from"./useAccountBalance-C2Raiu99.js";import{S as Bi,A as Ii}from"./SingleTokenInfo-CIUspzmb.js";import{L as Pi}from"./PriceRange-C09QLmLc.js";import{c as es,e as is,a as ss,g as ls,Z as ts,R as as,b as ps}from"./ZapSwitch-BKdmjTSC.js";import{u as ds,T as os,F as xs,R as ms}from"./RemoveBlock-CvqKhdOr.js";import{u as ns}from"./global-BhEQOSwv.js";import{f as De}from"./index-B79h-ghE.js";import{u as ti}from"./useTokenBalance-CuMCex55.js";import{u as cs}from"./useInsufficientBalanceToast-rFjqpLYC.js";import{u as gs}from"./usePosAdd-DpxGEr6Q.js";import{v as ai}from"./v4-C6aID195.js";import{T as rs}from"./TradeInputGroup-CpiF2tC0.js";import{T as bs}from"./TooltipIcon-C0_AzT63.js";import{P as hs}from"./PositionStatus-gu0KkwGh.js";import{R as js}from"./RangeValue-CWje48WD.js";import{u as ys}from"./index-CG17RbnK.js";import{b as ws,u as Ts}from"./useGetPoolList-B1dNsTr9.js";import{u as ks}from"./swapWidget-CCdeJosm.js";import{B as As}from"./BackButton-C7BKjC1_.js";import{R as pi}from"./RefreshButton-BHZks4q0.js";import{u as us}from"./useRpcListener-ct19cNgt.js";import"./PoweredByHaedal-990R--7x.js";import"./HTextLabelBox-BUAVAY0k.js";import"./VTextLabelBox-BBP6S5GJ.js";import"./linear-DYpwdEgO.js";import"./liquidity-Q2duYbTE.js";import"./usePreviousValue-BBpD8e7r.js";import"./ActionButton-DLa5Vayu.js";import"./useTrack-CtIH4d6T.js";import"./useSigner-CFmwTogF.js";import"./useBurn-BCV4jC2K.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-1_oiwNvt.js";import"./useXCetusHelper-B8egdb_b.js";import"./useToken-DQuh8vo3.js";import"./index-CptRizr3.js";import"./debounce-BgSgg6I6.js";import"./index-DKPh1ief.js";import"./useFavoritePool-DE7_4UZt.js";import"./useWrapPoolData-DbIflROk.js";import"./CopyButton-DHFYRM3v.js";import"./DepositRatio-B_RmkVfd.js";import"./FreshProgressV2-25htpobb.js";import"./index-Ct3YeWBa.js";import"./usePriceImpact-DQhSWKXY.js";import"./useSwapHelper-BaLkqCYA.js";import"./ErrorTips-CNrEhtPh.js";import"./ExpendItem-Bf0lMQPF.js";import"./_getAllKeysIn-Ds6Ic9w2.js";function Ss(){var ie,$,N,Z,K,q;const{tokenAmountAfterA:e,tokenAmountAfterB:x,currentPosDetailTab:d,curPosContractPoolInfo:a}=Se(),{getPosFeeData:D}=Ni(),{getPosRewardsData:r}=Hi(),{currentAccount:n}=We(),{currentPosBaseInfo:s,posFeeData:t,posRewardsData:j,posLiquidityData:_,currentPosBaseInfoLoading:z,posFeeDataLoading:R,posRewardsDataLoading:M}=je();Ye();const p=m.useMemo(()=>_[s==null?void 0:s.posId],[_,s==null?void 0:s.posId]),L=m.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",t[s==null?void 0:s.posId]),t[s==null?void 0:s.posId]),[t,s==null?void 0:s.posId]),l=m.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",j[s==null?void 0:s.posId]),j[s==null?void 0:s.posId]),[j,s==null?void 0:s.posId]);oe(p==null?void 0:p.displayCoinAmountA,void 0,!0),oe(p==null?void 0:p.displayCoinAmountB,void 0,!0);const[S,F]=m.useState(!1),[W,A]=m.useState("--"),{signAndExecuteTransaction:V}=oi(),{getPosClaimFeeAndRewardTxPayload:G}=Wi(),{calculatePendingYield:v}=Vi();m.useEffect(()=>{if(!z&&!R&&!M){const{total:k}=v([s],t,j);A(k)}},[z,R,M]);const{fetchAccountBalance:ee}=Xe(),O=async()=>{F(!0);try{const k=(l==null?void 0:l.map(H=>H.coin_address))||[],f={posType:s==null?void 0:s.posType,id:s==null?void 0:s.id,clmmPool:s==null?void 0:s.clmmPool,coinTypeA:s==null?void 0:s.coinTypeA,coinTypeB:s==null?void 0:s.coinTypeB,rewarderCoinTypes:k,account:n==null?void 0:n.address};console.log("ðŸš€ ~ toClaim ~ params.currentPosBaseInfo:",f,s);const{tx:u,msafeParams:Q}=await G(f);console.log("ðŸš€ ~ toClaim ~ tx:",u);const y=await V(u,{getShowInfo:H=>{const U={modalDescriptionText:"",toastTitleText:""};return H==="success"&&(U.toastTitleText="Claim Successful"),U}},{msafeParams:Q});console.log("ðŸš€ ~ toClaim ~ res:",y),y&&setTimeout(()=>{ee(),D([s]),r([s],{[a.poolAddress]:a})},2e3),F(!1)}catch(k){F(!1),console.log("ðŸš€ ~ toClaim ~ error:",k)}},E=e!==""||x!=="",{isApp:T}=$e();return i.jsxs(ne,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(ne,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(qe,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(w,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(Pi,{positionInfo:s,haveTooltip:!1})]}),i.jsxs(Y,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(c,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(c,{gap:"4px",children:[i.jsx(ei,{imageUrl:(ie=s==null?void 0:s.displayTokenA)==null?void 0:ie.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?($=s==null?void 0:s.displayTokenA)==null?void 0:$.coin_type:""}),i.jsx(de,{isLoaded:!!s&&!!p,children:i.jsxs(c,{gap:"4px",children:[i.jsx(w,{color:"primary",children:ue((N=s==null?void 0:s.displayTokenA)==null?void 0:N.symbol)}),i.jsxs(w,{color:"primary",children:[p==null?void 0:p.displayPercentA,"%"]})]})})]}),i.jsxs(c,{gap:"4px",children:[i.jsx(ei,{imageUrl:(Z=s==null?void 0:s.displayTokenB)==null?void 0:Z.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(K=s==null?void 0:s.displayTokenB)==null?void 0:K.coin_type:""}),i.jsx(de,{isLoaded:!!s&&!!p,children:i.jsxs(c,{gap:"4px",children:[i.jsx(w,{color:"primary_green",children:ue((q=s==null?void 0:s.displayTokenB)==null?void 0:q.symbol)}),i.jsxs(w,{color:"primary_green",children:[p==null?void 0:p.displayPercentB,"%"]})]})})]})]}),i.jsx(Si,{w:"200px",h:"4px",value:p==null?void 0:p.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ae,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:p==null?void 0:p.displayCoinAmountA,afterAmount:e}),i.jsx(Ae,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:p==null?void 0:p.displayCoinAmountB,afterAmount:x})]}),i.jsx(ne,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsxs(qe,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(w,{color:"primary_gray",children:"Pending Yield"}),i.jsx(de,{isLoaded:!!W&&!!s&&!!t&&!!j,children:i.jsx(w,{color:"text_caption",fontSize:"16px",children:mi(W,2)})})]}),i.jsx(Oe,{isLoading:S,disabled:Number(W)==0||R||M||S||!L,onClick:O,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(c,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ae,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:L==null?void 0:L.displayFeeOwedA,afterAmount:E?"0":""}),i.jsx(Ae,{label:T?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:L==null?void 0:L.displayFeeOwedB,afterAmount:E?"0":""}),l==null?void 0:l.map((k,f)=>i.jsx(vi.Fragment,{children:me(k.amount_owed).gt(0)&&i.jsx(Ae,{label:T?f==0?"Mining Rewards":"":"Mining Rewards",token:k==null?void 0:k.token,amount:k==null?void 0:k.display_amount_owed,afterAmount:E?"0":""})},k==null?void 0:k.coin_address))]})]})}const Ae=({label:e,token:x,amount:d,afterAmount:a,isLoading:D})=>{const{isApp:r}=$e(),{getExplorerUrl:n}=ni();return i.jsxs(Y,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(c,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(w,{color:"primary_gray",children:e}),i.jsxs(c,{children:[i.jsx(Ue,{onClick:r?()=>window.open(n(x==null?void 0:x.coin_type,"coin")):()=>{},children:i.jsx(Bi,{haveTooltip:!r,coinType:x?x==null?void 0:x.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(de,{isLoaded:!D&&!!d,children:i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:oe(d)})}),i.jsx(w,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:ue(x==null?void 0:x.symbol)})]})]}),a!==""&&a&&i.jsxs(c,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",children:oe(a)}),i.jsx(w,{color:"primary",children:"after"})]})]})};function vs(){const{currentPosBaseInfo:e,posPoolsOriginalData:x,posPoolsRelatedData:d,posRewardsData:a,posLiquidityData:D}=je(),r=a[e==null?void 0:e.posId],{getTokenAmountValue:n}=Qe(),{transactionConfirmation:s}=Di(),{preAdd:t,getAddTsPayload:j,getClmmCreateAddData:_,getFarmsCreateAddData:z}=gs(),{getTokenALock:R,getTokenBLock:M}=xi(),{getCurrentPosBaseInfo:p}=Ye(),{setTokenAmountAfterA:L,setTokenAmountAfterB:l,currentPoolSqrtPrice:S,isFixedDisplayTokenA:F,setIsFixedDisplayTokenA:W,curPosContractPoolInfo:A,currentPosDetailTab:V,isPosDetailRefresh:G,useZapIn:v}=Se(),{getZapDepositToastInfo:ee,getZapDepositTx:O,reCalculateZapData:E}=es(),{preDepositeData:T,setZapAmount:ie,setPreDepositeData:$}=is(),[N,Z]=m.useState(!1),[K,q]=m.useState(""),[k,f]=m.useState(""),[u,Q]=m.useState(""),[y,H]=m.useState(""),U=m.useMemo(()=>D[e==null?void 0:e.posId],[D,e==null?void 0:e.posId]),b=oe(U==null?void 0:U.displayCoinAmountA,void 0,!0),se=oe(U==null?void 0:U.displayCoinAmountB,void 0,!0);m.useEffect(()=>{if(+u||+y){const o=+u,h=+y;L(me(o).plus(b).toString()),l(me(h).plus(se).toString())}else L(""),l("")},[u,y]);const g=e==null?void 0:e.displayTokenA,C=e==null?void 0:e.displayTokenB,{mevProtect:ve,maxCapForGas:Ce,transactionMode:B,customGasPrice:ci}=ns(),{balanceInfo:ye}=ti(g),{balanceInfo:we}=ti(C),gi=n(g==null?void 0:g.coin_type,u),ri=n(C==null?void 0:C.coin_type,y),[Ve,Ge]=m.useState(""),Je=m.useRef("");m.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",Ve),Je.current=Ve},[Ve]);const Te=()=>{Q(""),H(""),Z(!1),Ge("")},_e=m.useMemo(()=>R(e,A),[A==null?void 0:A.current_tick_index,e]),Re=m.useMemo(()=>M(e,A),[A==null?void 0:A.current_tick_index,e]),Ne=e!=null&&e.isReverse?Re:_e,He=e!=null&&e.isReverse?_e:Re;m.useEffect(()=>{Te()},[Ne,He]);const Ke=qi((o,h,X)=>{var he,P;if(V!=="increase")return;const J=h?(he=e==null?void 0:e.displayTokenA)==null?void 0:he.decimals:(P=e==null?void 0:e.displayTokenB)==null?void 0:P.decimals,ke=Oi(o,J),Fe=e==null?void 0:e.tokenA,le=e==null?void 0:e.tokenB,te=e==null?void 0:e.lowerTick,ce=e==null?void 0:e.upperTick,ge=e==null?void 0:e.isReverse,ae={amount:ke,tokenA:Fe,tokenB:le,isTokenA:ge?!h:h,lowerTick:te,upperTick:ce,curSqrtPrice:S,isReverse:ge,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",ae);const{displayCoinAmountA:xe,displayCoinAmountB:re,tokenMaxA:be,tokenMaxB:pe}=t(ae);Je.current===X?(q(be),f(pe),h?H(re||""):Q(xe||"")):Te(),Z(!1)},500),Le=()=>{if((u||y)&&Ui(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const o=F?u:y;if(+o){const h=ai();Ge(h),Ke(o,F,h)}}};m.useEffect(()=>{V=="increase"&&G&&Le()},[G]);const bi=(o,h)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!o,+o,o),!o){Te();return}if(W(h),h?Q(o):H(o),+o){Z(!0);const X=ai();Ge(X),console.log("ðŸš€ ~ handleAmountChange ~ params:",o),Ke(o,h,X)}else h?H(""):Q("")},{currentAccount:I}=We(),hi=m.useMemo(()=>{const o={text:"Add More Liquidity",disabled:!1};return I!=null&&I.address?!+u&&!+y?(o.text="Enter an amount",o.disabled=!0,o):!Ne&&u&&me(u).gt((ye==null?void 0:ye.balanceFormat)||0)?(o.disabled=!0,o.text=`Insufficient ${ue(g==null?void 0:g.symbol,10)} Balance`,o):!He&&y&&me(y).gt((we==null?void 0:we.balanceFormat)||0)?(o.disabled=!0,o.text=`Insufficient ${ue(C==null?void 0:C.symbol,10)} Balance`,o):((!_e&&!Re&&(!+u||!+y)||(e==null?void 0:e.posType)=="burn")&&(o.disabled=!0),o):(o.text="Connect Wallet",o.disabled=!1,o)},[u,y,ye,we,I==null?void 0:I.address]),{signAndExecuteTransaction:ji}=oi(),{getContractPoolInfo:yi}=ss(),[wi,ze]=m.useState(!1),{fetchAccountBalance:Ti}=Xe(),{showInsufficientBalanceToast:ki}=cs(),Ai=async()=>{var o;ze(!0);try{let h,X,J;const ke=(o=r||[])==null?void 0:o.reduce((le,te)=>(me(te==null?void 0:te.amount_owed).gt(0)&&le.push(te.coin_address),le),[]);if(v)J=ee(),s(J),h=await O(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:ke});else{const le=F?u:y,te=F?g.decimals:C.decimals,ce=me(le).mul(Yi.pow(10,te)).toString(),ge=e!=null&&e.isReverse?!F:F;let ae,xe;const re=e==null?void 0:e.lowerTick,be=e==null?void 0:e.upperTick,pe=A==null?void 0:A.current_tick_index;pe!==void 0&&re!==void 0&&be!==void 0&&(pe>=re&&pe<=be?(ae=ge?ce:K,xe=ge?k:ce):pe>be?(ae=0,xe=ce):pe<re&&(ae=ce,xe=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",re,be,pe),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,ae,xe),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",r,ke);const he={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:ae,amountB:xe,fixAmountA:ge,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:S,posType:e==null?void 0:e.posType,rewarderCoinTypes:ke,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(he.farmsPoolId=e==null?void 0:e.farmsPool),J={getShowInfo:(ui,Ze)=>{const fe="Add "+[De(u,g==null?void 0:g.symbol),De(y,C==null?void 0:C.symbol)].filter(Boolean).join(" and "),Me={modalDescriptionText:fe,toastTitleText:fe};if(ui==="success"){let Be=u,Ie=y;Ze&&(Be=si(Ze,g)||u,Ie=si(Ze,C)||y);const Pe="Add "+[De(Be,g==null?void 0:g.symbol),De(Ie,C==null?void 0:C.symbol)].filter(Boolean).join(" and ");Me.toastDescriptionContent=Pe,Me.modalDescriptionText=Pe,Me.toastTitleText="Supplied Successful"}return Me}},s(J),console.log("ðŸš€ ~ toAdd ~ params:",he);const P=await j(he);h=P==null?void 0:P.tx,X=P==null?void 0:P.msafeParams}const Fe=await ji(h,J,{useMev:ve,useFastMode:B==="Fast Mode",maxCapForGas:Ce,customGasPrice:ci,msafeParams:X});console.log("ðŸš€ ~ toClaim ~ res:",Fe),Fe?(Ti(),Te(),ie(""),p(I==null?void 0:I.address,e==null?void 0:e.id,!0)):e&&yi(e==null?void 0:e.clmmPool).then(le=>{console.log("ðŸš€ ~ toClaim ~ res:",le),v?E():Le()}),ze(!1)}catch(h){console.log("ðŸš€ ~ toClaim ~ error:",h),v?E():Le(),ki(String(h)),ze(!1)}};return m.useEffect(()=>{if(V==="increase"&&v){if(T!=null&&T.amount_a||T!=null&&T.amount_b){const o=e==null?void 0:e.tokenA,h=e==null?void 0:e.tokenB,X=ii(T==null?void 0:T.amount_a,o==null?void 0:o.decimals),J=ii(T==null?void 0:T.amount_b,h==null?void 0:h.decimals);Q(e!=null&&e.isReverse?J:X),H(e!=null&&e.isReverse?X:J);return}Q(""),H("")}},[v,T,e==null?void 0:e.isReverse]),m.useEffect(()=>(Q(""),H(""),()=>{$(void 0)}),[]),{tokenAmountA:u,tokenAmountB:y,reCalculateResult:Le,preAddLoading:N,preAdd:t,getAddTsPayload:j,displayTokenA:g,displayTokenB:C,tokenABalanceInfo:ye,tokenBBalanceInfo:we,tokenAmountValueA:gi,tokenAmountValueB:ri,handleAmountChange:bi,resetInputAmount:Te,btnStatusText:hi,toAdd:Ai,isAddLoading:wi,showTokenALock:_e,showTokenBLock:Re,showDisplayTokenALock:Ne,showDisplayTokenBLock:He,getClmmCreateAddData:_,getFarmsCreateAddData:z,currentPoolSqrtPrice:S}}function Cs(){var K;const{currentPosBaseInfo:e,posPoolsRelatedData:x,posApiPoolData:d}=je(),{currentAccount:a,onWalletModal:D}=We(),{isFixedDisplayTokenA:r,curPosContractPoolInfo:n,useZapIn:s,currentPosPoolInfo:t}=Se(),{tokenAmountA:j,tokenAmountB:_,displayTokenA:z,displayTokenB:R,tokenABalanceInfo:M,tokenBBalanceInfo:p,tokenAmountValueA:L,tokenAmountValueB:l,handleAmountChange:S,preAddLoading:F,btnStatusText:W,toAdd:A,isAddLoading:V,showDisplayTokenALock:G,showDisplayTokenBLock:v,resetInputAmount:ee,currentPoolSqrtPrice:O}=vs();m.useEffect(()=>()=>{ee()},[]);const{getTokenAmountValue:E}=Qe(),T=E(z==null?void 0:z.coin_type,j,"--"),ie=E(R==null?void 0:R.coin_type,_,"--"),$=T=="--"||ie=="--"?"--":$i(L).plus(l).toString(),N=x[e==null?void 0:e.posId],{currentApiPoolInfo:Z}=ds(e,d);return i.jsxs(Y,{w:"100%",gap:"8px",children:[i.jsxs(Ue,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(Z==null?void 0:Z.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!G&&!v&&i.jsx(os,{action:"Deposit",resetInputAmount:ee}),s?i.jsx(ls,{action:"Deposit",apiPoolInfo:Z,currentSqrtPrice:O,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(rs,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(M==null?void 0:M.balanceFormat)||"",value:j,amountValue:L,loading:!r&&F,onChange:q=>{S(q,!0)},placeholder:"0.0",token:z,lock:{isLock:e&&n&&G,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(p==null?void 0:p.balanceFormat)||"",value:_,amountValue:l,loading:r&&F,onChange:q=>{S(q,!1)},placeholder:"0.0",token:R,lock:{isLock:e&&n&&v,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:G||v?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!n||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),s?i.jsx(ts,{action:"Deposit",onClick:A,hideDepositRatio:!0,otherLoading:V,isReverse:e==null?void 0:e.isReverse}):i.jsxs(i.Fragment,{children:[i.jsx(Oe,{onClick:()=>{a?A():D(!0)},isLoading:V,disabled:W.disabled||V,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:W.text}),$&&i.jsx(ne,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsx(w,{children:"Total Amount"}),i.jsx(w,{color:"text_caption",children:mi($,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&(t==null?void 0:t.farmsRewarderList)&&((K=t==null?void 0:t.farmsRewarderList)==null?void 0:K.length)>0&&i.jsx(xs,{}),N&&(N==null?void 0:N.minPrice)!=="0"&&(N==null?void 0:N.maxPrice)!=="âˆž"&&i.jsx(as,{subscriptionSource:"PositionDetail"})]})}function _s(){const{currentPosBaseInfo:e}=je(),{currentPosPoolInfo:x,curPosContractPoolInfo:d}=Se(),{setContractPoolInfo:a,setApiPoolInfo:D}=ys(),{lowerTickData:r,upperTickData:n,setLowerTickData:s,setUpperTickData:t}=Mi();Qi(()=>{D(x)},[x]);const j=(R,M,p)=>{var G,v;const L=(G=p==null?void 0:p.tokenA)==null?void 0:G.decimals,l=(v=p==null?void 0:p.tokenB)==null?void 0:v.decimals;let S;Math.abs(R)==Math.abs(Xi.getMinIndex(Number(p.tickSpacing)))?S=M==="lower"?"0":"âˆž":S=Ji.tickIndexToPrice(R,L,l).toString();const F=S==="âˆž"?"âˆž":oe(S,6),W=ws(S),A=W==="âˆž"?"âˆž":oe(W,6),V={id:M,tokenA:p==null?void 0:p.tokenA,tokenB:p==null?void 0:p.tokenB,tick:R,price:S,displayPrice:F,reversePrice:W,displayReversePrice:A,tickSpacing:p==null?void 0:p.tickSpacing,pool:p==null?void 0:p.poolAddress};M==="lower"?s({...V}):t({...V})},{getCurrentPrice:_}=ps();m.useEffect(()=>{e!=null&&e.lowerTick&&(d!=null&&d.current_sqrt_price)&&(x!=null&&x.poolAddress)&&(j(e==null?void 0:e.lowerTick,"lower",x),j(e==null?void 0:e.upperTick,"upper",x),_(d==null?void 0:d.current_sqrt_price,x),a(d))},[e==null?void 0:e.lowerTick,d==null?void 0:d.current_sqrt_price,x==null?void 0:x.poolAddress]);const z=m.useMemo(()=>(e==null?void 0:e.posId)&&(r==null?void 0:r.pool)&&(n==null?void 0:n.pool),[r==null?void 0:r.pool,n==null?void 0:n.pool,e==null?void 0:e.posId]);return i.jsx(Ue,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:z&&i.jsx(Ei,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?n:r,maxPriceData:e!=null&&e.isReverse?r:n,readonly:!0})})}function Rs(){const{currentPosBaseInfo:e,posPoolsRelatedData:x,posPoolsOriginalData:d}=je(),a=x[e==null?void 0:e.posId],{getClmmPosName:D}=xi(),r=m.useMemo(()=>{var j;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const _=(j=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:j.index;return D(e==null?void 0:e.index,_)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]);(a==null?void 0:a.displayFee)+"";const n=(a==null?void 0:a.currentStatus)=="Active",s=m.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",a);const j=a==null?void 0:a.minPriceOrigin,_=a==null?void 0:a.maxPriceOrigin;return j!=="0"&&_!=="âˆž"?Ki(1/(1-Number((j/_)**.25)),2)+"x":"1x"},[a==null?void 0:a.minPriceOrigin,a==null?void 0:a.maxPriceOrigin]),{getExplorerUrl:t}=ni();return i.jsxs(ne,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(ne,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(c,{justify:"space-between",children:[i.jsxs(c,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position ID"}),i.jsx(de,{isLoaded:!!r,children:i.jsx(w,{color:"text_caption",children:r==null?void 0:r.split("|")[1]})})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(w,{children:"Position NFT"}),i.jsx(de,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Ii,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(t(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),a&&i.jsx(hs,{isActive:n,isLoading:(a==null?void 0:a.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(Y,{gap:{base:"16px",lg:"32px"},children:[i.jsxs(Y,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Current Price"}),i.jsx(Gi,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs(Y,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(w,{color:"primary_gray",children:"Position Range"}),i.jsx(js,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:a==null?void 0:a.minPrice,maxPrice:a==null?void 0:a.maxPrice,minPriceResever:a==null?void 0:a.minPriceResever,maxPriceResever:a==null?void 0:a.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs(Y,{gap:"0",children:[i.jsx(_s,{}),i.jsx(Y,{zIndex:"9",children:i.jsxs(c,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(w,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(bs,{type:"leverage"}),i.jsx(de,{ml:"4px",isLoaded:!!s&&!!a,children:i.jsx(w,{color:"primary",children:s})})]})})]})]})]})}function Vl(){var H,U;const e=Ci(),{fetchAccountBalance:x}=Xe(),{currentAccount:d}=We(),{position_nft_id:a}=_i(),{getCurrentPosBaseInfo:D,getCurrentPosByPosId:r}=Ye(),{curPosContractPoolInfo:n,currentPosDetailTab:s,currentPosPoolInfo:t,setCurrentPosDetailTab:j,setCurrentPosPoolInfo:_,setCurrentPoolSqrtPrice:z,setCurPosContractPoolInfo:R,setIsPosDetailRefresh:M,setUseZapIn:p}=Se(),{posPoolsRelatedData:L,currentPosBaseInfo:l,setCurrentPosBaseInfo:S,farmsPosRewardsData:F,posRewardsData:W}=je();console.log(l,"currentPosBaseInfo");const A=(((H=L[l==null?void 0:l.posId])==null?void 0:H.displayFee)||"--")+"%",V=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],G=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),M(!0),v(!0),$(),T(),x(),q(),setTimeout(()=>{M(!1)},1e3)},v=(b=!1)=>{d!=null&&d.address&&a&&D(d==null?void 0:d.address,a,b)};m.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",a),v()},[d==null?void 0:d.address,a]),m.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:ee}=Qe(),O=F[l==null?void 0:l.id],E=W[l==null?void 0:l.posId],T=()=>{var ve,Ce;const b=(E==null?void 0:E.map(B=>B==null?void 0:B.coin_address))||[],se=(O==null?void 0:O.map(B=>B==null?void 0:B.rewarder_type))||[],g=[(ve=l==null?void 0:l.tokenA)==null?void 0:ve.coin_type,(Ce=l==null?void 0:l.tokenB)==null?void 0:Ce.coin_type].filter(Boolean),C=Array.from(new Set([...b,...g,...se]));ee(C)};m.useEffect(()=>{T()},[l==null?void 0:l.posId,E==null?void 0:E.length,O==null?void 0:O.length]);const{getPoolList:ie}=Ts(),$=async()=>{if(!(l!=null&&l.clmmPool))return;const b=await ie({pool:l==null?void 0:l.clmmPool});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,b),b)return _(b==null?void 0:b.list[0])},{getPosPoolsOriginalObj:N,getPosPoolsRelatedData:Z}=zi(),{getPosLiquidityData:K}=Zi(),q=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const b=await r(d==null?void 0:d.address,a),se=await N([b]);Z([b],se);const g=se[b==null?void 0:b.clmmPool];console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo[currentPosBaseInfo?.clmmPool]:",g,n),(g==null?void 0:g.current_sqrt_price)!==(n==null?void 0:n.current_sqrt_price)&&K([b],se),se&&(z(g==null?void 0:g.current_sqrt_price),R(g))}},{setFromCoin:k,setToCoin:f,fromCoin:u,toCoin:Q}=ks();m.useEffect(()=>{$(),q();let b;return l!=null&&l.clmmPool&&(b=setInterval(()=>{q()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(k(l==null?void 0:l.displayTokenA),f(l==null?void 0:l.displayTokenB)),()=>{clearInterval(b),k(li.clmm_swap.from_coin),f(li.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),m.useEffect(()=>(j("increase"),d!=null&&d.address&&x(),()=>{R(null),S(null),_(null),p(!1)}),[]),us({onRpcChange:()=>{v(!0),q(),d!=null&&d.address&&x()}});const{isApp:y}=$e();return i.jsxs(Y,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(As,{}),y&&i.jsxs(c,{children:[i.jsx(di,{}),i.jsx(pi,{handleRefresh:G,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(Oe,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:b=>{e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!y&&i.jsx(pi,{handleRefresh:G,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(de,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Li,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:A,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(c,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Ee,{label:"Pool APR",value:i.jsx(Ri,{poolInfo:t,children:i.jsxs(c,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(w,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:t!=null&&t.farmingAprDisplay||((U=t==null?void 0:t.miningAprList)==null?void 0:U.length)>0?"help":"text",children:t==null?void 0:t.feeAndMiningAprDisplay}),(t==null?void 0:t.haveFarming)&&i.jsxs(w,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",t==null?void 0:t.farmingAprDisplay]})]})}),loading:!(t!=null&&t.poolAddress)}),i.jsx(Ee,{label:"TVL",value:(t==null?void 0:t.tvlDisplay)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Ee,{label:"Volume (24H)",value:(t==null?void 0:t.volume24Display)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Ee,{label:"Fees (24H)",value:(t==null?void 0:t.fees24Display)||"",loading:!(t!=null&&t.poolAddress)})]})]}),i.jsxs(c,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(Y,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(Rs,{}),i.jsx(Ss,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs(Y,{w:{base:"100%",lg:"40%"},children:[i.jsx(ne,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(c,{w:"100%",p:"0 16px",children:[i.jsx(fi,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:V,currentTab:s=="increase"?"Increase":"Remove",handleChangeTab:b=>{j(b==null?void 0:b.value)}}),!y&&i.jsx(di,{})]})}),s=="increase"&&i.jsx(Cs,{}),s=="remove"&&i.jsx(ms,{})]})]})]})}const di=()=>i.jsx(c,{children:i.jsx(Fi,{})});export{Vl as default};
//# sourceMappingURL=PositionDetail-DiRnMJMC.js.map
