import{l as _,k as X,ap as S,o as O,d as y,G as b,aU as x,n as A,v as F,ao as V,aL as R,p as h,bk as G,bl as P}from"./index-CsPKGWlY.js";import{u as E}from"./useToken-CcYMprru.js";import{a as d}from"./vendor-BFGDaAdA.js";import{u as M}from"./index-D1m9ooSc.js";function $(){const t=_("xcetus"),{currentAccount:e}=X(),n=d.useRef(e==null?void 0:e.address);d.useEffect(()=>{n.current=e==null?void 0:e.address},[e==null?void 0:e.address]);const{setLockCetusListLoading:o,clearData:s,setLockCetusList:m,setAvailableXCetusAmount:r,veNFT:i}=S();return{fetchOwnerLockCetusList:async(a,C=e==null?void 0:e.address)=>{if(!C){o(!1),s();return}try{const c=await t.XCetusModule.getOwnerRedeemLockList(C);console.log("ðŸš€ ~ fetchOwnerLockCetusList ~ lockList:",{lockList:c,veNFT:a,availableXCetusAmount:V.getAvailableXCetus(a,c)}),C===n.current&&(c.sort((T,f)=>T.locked_until_time-f.locked_until_time),m(c),a&&r(V.getAvailableXCetus(a,c)))}catch(c){console.log("ðŸš€ ~ fetchOwnerLockCetusList ~ error:",c)}finally{o(!1)}}}}function z(){const t=_("xcetus"),{setDividendRewardList:e}=S();return{fetchVeNFTDividendInfo:async o=>{try{const s=await t.XCetusModule.getVeNFTDividendInfo(o);console.log("ðŸš€ ~ file: useXCetusHelper.ts:62 ~ fetchVeNFTDividendInfo ~ dividendInfo:",s),s&&e(s.rewards)}catch(s){console.log("ðŸš€ ~ fetchVeNFTDividendInfo ~ error:",s,o)}}}}function D(){const t=_("xcetus"),{currentAccount:e}=X(),{fetchOwnerLockCetusList:n}=$(),{setVeNFTLoading:o,clearData:s,setVeNFT:m}=S();return{fetchOwnerVeNFT:async(i=e==null?void 0:e.address,l)=>{if(!i){o(!1),s();return}o(!0);try{const a=await t.XCetusModule.getOwnerVeNFT(i,l);if(console.log("ðŸš€ ~ fetchOwnerVeNFT ~ veNFT:",a),a)return m(a,i),n(a,i),a}catch(a){console.log("ðŸš€ ~ fetchOwnerVeNFT ~ error:",a)}finally{o(!1)}}}}function I(){const{dividendManager:t}=S(),[e,n]=d.useState(),[o,s]=d.useState(),m=r=>{const i=Date.now()/1e3,{start_time:l,interval_day:a}=r,C=Number(V.getNextStartTime(r).toString()),c=F.env=="testnet"?Math.ceil((i-l)/(a*60)):Math.ceil((i-l)/(a*24*3600));n(c),s(C)};return d.useEffect(()=>{t&&m(t)},[t]),{currentPeriod:e,nextStartTime:o,calculateCurrPeriod:m}}function J(t,e){const{fetchTokenInfo:n}=E(),{getTokenAmountValue:o}=O(),{coinPriceObj:s}=A(),[m,r]=d.useState("0"),i=d.useCallback(async()=>{if(!(!t||!e))try{const l=t.bonus,a=l.map(w=>b(w.name,!1)),C=await n(a),c=l.map(w=>{const k=b(w.name,!1),u=C==null?void 0:C.get(k);if(u){const L=x(w.value,u.decimals).toString();return o(k,L)}return"0"}).reduce((w,k)=>w.add(k),y(0)),T=o(F.cetus_coin.coin_type,x(e,9).toString()),f=y(T).gt(0)?c.div(7).mul(365).div(T).mul(100).toFixed(2):"0";r(Number(f)>0&&Number(f)<.01?"0.01":f.toString())}catch(l){console.error("Error calculating APR:",l),r("0.01")}},[t==null?void 0:t.bonus,e,s]);return M(()=>{i()},[t==null?void 0:t.bonus,e,s]),{cetusApr:m}}function K(t){const{dividendRewardList:e}=S(),{fetchTokenInfo:n}=E(),{getTokenAmountValue:o}=O(),[s,m]=d.useState([]),[r,i]=d.useState([]),[l,a]=d.useState("0"),C=d.useCallback(async()=>{let c=y(0);const T=e.filter(u=>!(u.period===t||u.rewards.find(L=>y(L.amount).eq(0))));console.log("ðŸš€ ~ file: useXCetusHelper.ts:107 ~ calculateRewards ~ filteredList:",{filteredList:T,dividendRewardList:e,currentPeriod:t}),i(T);const f={},w=T.flatMap(u=>u.rewards.map(L=>b(L.coin_type,!1))),k=await n(w);T.forEach(u=>{for(const L of u.rewards){const g=b(L.coin_type,!1),v=k==null?void 0:k.get(g);if(v){const p=x(L.amount,v.decimals).toString(),N=o(g,p);c=c.add(N),f[g]=f[g]?{...f[g],amount:y(f[g].amount).add(p).toString(),value:y(f[g].value).add(N).toString()}:{amount:p,coin_type:g,value:N}}}}),m(Object.values(f).filter(u=>y(u.amount).gt(0)).sort((u,L)=>y(L.value).sub(u.value).toNumber())),a(c.toString())},[e,o,t]);return d.useEffect(()=>{t&&C()},[e,t]),{summaryRewardList:s,rewardList:r,totalRewardValue:l}}const j=`${R.xcetus.package_id}::xcetus::VeNFT`,H=`${R.xcetus.package_id}::lock_coin::LockedCoin<${F.cetus_coin.coin_type}>`;function Q(t){let e;return t.forEach(n=>{if(n){const o=h(G(n)).source_address;if(o===j&&n.data&&n.data.content){const{fields:s}=n.data.content;return e={...P(n),id:s.id.id,index:s.index,type:o,xcetus_balance:s.xcetus_balance},e}}}),e}async function W(t,e){const n=[];for(let o=0;o<t.length;o++){const s=t[o];if(s&&h(G(s)).source_address===H&&s.data){const r=V.buildLockCetus(s.data.content);r.xcetus_amount=await e.XCetusModule.getXCetusAmount(r.id),n.push(r)}}return n}export{j as X,H as a,Q as b,W as c,z as d,I as e,K as f,J as g,D as u};
//# sourceMappingURL=useXCetusHelper-BZ3t3rLl.js.map
