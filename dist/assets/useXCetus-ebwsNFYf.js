import{a as p,j as e,X as de,Y as ue,Z as fe,$ as xe,a8 as me,a0 as pe,a1 as he,V,H as X,T as L,v as te,f as Ce,a2 as be,a3 as ge,a4 as Se,a5 as Te}from"./vendor-DXHkIl66.js";import{u as Z}from"./useTransaction-Cu46NUUD.js";import{j as U,k as F,as as O,w as I,d as z,t as ee,C as Y,M as P,p as se,i as we,B as oe,am as ae,a as ye,c as G,v as $,n as ve,aY as ke,aZ as Ie,aR as je,al as Me,ar as De,a0 as K,aK as _e}from"./index-D1te9NbD.js";import{M as Q}from"./msafe-oYBkW7LJ.js";import{u as N}from"./useAccountBalance-DRRhiC7T.js";import{u as re}from"./useTokenBalance-CKuEHkFq.js";import{a as q,e as W,f as Le,g as Oe,u as Re,h as Pe}from"./useXCetusHelper-Cj1GICSR.js";import{T as ce}from"./TradeInputGroup-B9NjQibp.js";import{H as Ue}from"./HTextLabelBox-CTsll-sl.js";import{C as Ae}from"./CheckBox-DSEkqWzu.js";import{H as Ee}from"./HighlightText-BLaAjUt8.js";import{u as Xe}from"./activeOrders-CVZy9qcO.js";const nt=(x,c,r="seconds")=>{const a=()=>{const t=x-new Date().getTime();if(t<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const i=Math.floor(t/1e3%60),f=Math.floor(t/1e3/60%60),n=Math.floor(t/(1e3*60*60)%24),s=Math.floor(t/(1e3*60*60*24)%30),h=Math.floor(t/(1e3*60*60*24*30)%12),b=Math.floor(t/(1e3*60*60*24*365));return r==="days"?{years:0,months:0,days:s+h*30+b*365,hours:n,minutes:f,seconds:i}:r==="months"?{years:0,months:h+b*12,days:s,hours:n,minutes:f,seconds:i}:{years:b,months:h,days:s,hours:n,minutes:f,seconds:i}},[o,u]=p.useState(a());return p.useEffect(()=>{const d=setInterval(()=>{const t=a();u(t),t.years===0&&t.months===0&&t.days===0&&t.hours===0&&t.minutes===0&&t.seconds===0&&(clearInterval(d),c&&c())},1e3);return()=>clearInterval(d)},[x]),o};function Fe(){const{fetchAccountBalance:x}=N(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:r}=Z(),{currentAccount:a}=U(),{fetchOwnerVeNFT:o}=W(),{xCetusSdk:u}=F(),{veNFT:d}=O(),[t,i]=p.useState(""),[f,n]=p.useState(""),{balanceInfo:s}=re(I.cetus_coin),h=l=>{i(l),n(l)},[b,y]=p.useState(!1),g=async()=>{y(!0);const l={venft_id:d==null?void 0:d.id,amount:ee(t,9).toFixed(0)},M=await u.XCetusModule.convertPayload(l),j=await r(M,{getShowInfo:v=>{const D=`Converting ${Y(t)} CETUS to ${Y(t)} xCETUS`,_={modalTitleText:"Convert",modalDescriptionText:D,toastDescriptionContent:D};if(v==="success"){const R=D.replace("Converting","Converted");_.modalDescriptionText=R,_.toastDescriptionContent=R}return _}},{msafeParams:{action:Q.xCETUSConvert,txbParams:l}});y(!1),j&&(a&&o(a==null?void 0:a.address,!0),i(""),n(""),x(),c())},w=p.useMemo(()=>{const l={text:"Convert",disabled:!1};return a!=null&&a.address?+t?(+t&&z(t).gt((s==null?void 0:s.balanceFormat)||0)&&(l.disabled=!0,l.text="Insufficient CETUS Balance"),l):(l.text="Enter an amount",l.disabled=!0,l):(l.text="Connect Wallet",l.disabled=!1,l)},[s==null?void 0:s.balanceFormat,a==null?void 0:a.address,t]);return{inputAmountFrom:t,inputAmountTo:f,handleInputChange:h,balanceInfoFrom:s,convertLoading:b,btnText:w.text,btnDisabled:w.disabled,handleConvertClick:g}}function ie(x){const{isOpen:c,onClose:r,onSubmitClick:a}=x,{setShowConvertModel:o}=O(),[u,d]=p.useState(!1);return e.jsxs(de,{autoFocus:!1,returnFocusOnClose:!1,isOpen:c,onClose:r,isCentered:!0,children:[e.jsx(ue,{}),e.jsxs(fe,{children:[e.jsx(xe,{children:e.jsx(me,{fontWeight:"500",fontSize:"16px"})}),e.jsx(pe,{}),e.jsx(he,{textAlign:"center",p:"0px",children:e.jsxs(V,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[e.jsx(Ee,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),e.jsxs(X,{children:[e.jsx(Ae,{checked:u,onClick:()=>{d(!u)}}),e.jsx(L,{color:"text_caption",children:"Do not remind again."})]}),e.jsx(te,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{o(!u),a()},children:"Convert"})]})})]})]})}function st(x){const{availableXCetusAmount:c,iconParams:r,onIconClick:a}=x,{currentAccount:o,onWalletModal:u}=U(),{inputAmountFrom:d,inputAmountTo:t,handleInputChange:i,balanceInfoFrom:f,btnText:n,btnDisabled:s,handleConvertClick:h,convertLoading:b}=Fe(),{showConvertModel:y}=O(),[g,w]=p.useState(!1);return e.jsxs(V,{w:"100%",gap:"8px",children:[e.jsx(ce,{onClick:a,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(f==null?void 0:f.balanceFormat)||"",value:d,amountValue:"",loading:!1,onChange:l=>{i(l)},selectable:!1,placeholder:"0.0",token:I.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:P(c,9),value:t,half:!1,max:!1,amountValue:"",onChange:l=>{i(l)},selectable:!1,placeholder:"0.0",token:I.x_cetus_coin},iconParams:r}),e.jsx(te,{w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:s||b,isLoading:b,onClick:()=>{console.log(o,y,"showConvertModel"),o?y?w(!0):h():u(!0)},children:n}),g&&e.jsx(ie,{isOpen:g,onClose:()=>{w(!1)},onSubmitClick:()=>{w(!1),h()}})]})}function Be(x){const{fetchAccountBalance:c}=N(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:a}=Z(),{currentAccount:o}=U(),{fetchOwnerVeNFT:u}=W(),{xCetusSdk:d}=F(),{veNFT:t}=O(),[i,f]=p.useState(""),[n,s]=p.useState(""),[h,b]=p.useState(180),[y,g]=p.useState(""),[w,l]=p.useState(!0),{balanceInfo:M}=re(I.cetus_coin),j=(C,k)=>{l(k),k?f(C):s(C),D(C,k,h)},v=C=>{b(C),D(w?i:n,w,C)},D=async(C,k,A)=>{if(+C){const E=ee(C,9);if(k){const S=await d.XCetusModule.redeemNum(E,A);s(P(S.amount_out,9)),g(z(S.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const S=await d.XCetusModule.reverseRedeemNum(E,A);f(P(S.amount_out,9)),g(z(S.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else f(""),s(""),g("")},[_,R]=p.useState(!1),J=async()=>{if(!t)return;R(!0);const C={venft_id:t.id,amount:ee(i,9).toFixed(0),lock_day:h},k=d.XCetusModule.redeemLockPayload(C),A=await a(k,{getShowInfo:E=>{const S=`Redeeming ${Y(i)} xCETUS to ${Y(n)} CETUS`,B={modalTitleText:"Redeem",modalDescriptionText:S,toastDescriptionContent:S};if(E==="success"){const m=S.replace("Redeeming","Redeemed");B.modalDescriptionText=m,B.toastDescriptionContent=m}return B}},{msafeParams:{action:Q.xCETUSRedeemLock,txbParams:C}});R(!1),A&&(o&&u(o==null?void 0:o.address,!0),f(""),s(""),c(),r())},H=p.useMemo(()=>{const C={text:"Redeem",disabled:!1};return o!=null&&o.address?+i?(+i&&z(i).gt(x||0)&&(C.disabled=!0,C.text="Insufficient xCETUS Balance"),C):(C.text="Enter an amount",C.disabled=!0,C):(C.text="Connect Wallet",C.disabled=!1,C)},[x,o==null?void 0:o.address,i]);return{inputAmountFrom:i,inputAmountTo:n,handleInputChange:j,balanceInfoTo:M,convertLoading:_,btnText:H.text,btnDisabled:H.disabled,handleConvertClick:J,day:h,handleDayChange:v,percent:y}}function Ve(x){const{day:c,onChange:r}=x,a=p.useMemo(()=>`${c}D`,[c]),o=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return e.jsxs(Ce,{children:[e.jsxs(X,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[e.jsxs(L,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[c," Days"]}),e.jsx(we,{type:"outlineTab",tabList:o,currentTab:a,handleChangeTab:u=>{u.label==="MAX"?r(100):r(u.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),e.jsxs(be,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(c),onChange:u=>r(u),children:[e.jsx(ge,{h:"8px",children:e.jsx(Se,{h:"4px"})}),e.jsx(Te,{})]})]})}function ot(x){const{availableXCetusAmount:c,iconParams:r,onIconClick:a}=x,{currentAccount:o,onWalletModal:u}=U(),{inputAmountFrom:d,inputAmountTo:t,handleInputChange:i,balanceInfoTo:f,btnText:n,btnDisabled:s,handleConvertClick:h,day:b,handleDayChange:y,percent:g,convertLoading:w}=Be(c),{showConvertModel:l}=O(),[M,j]=p.useState(!1);return e.jsxs(V,{w:"100%",gap:"8px",children:[e.jsx(ce,{onClick:a,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:c,value:d,amountValue:"",loading:!1,onChange:v=>{i(v,!0)},selectable:!1,placeholder:"0.0",token:I.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(f==null?void 0:f.balanceFormat)||"",value:t,half:!1,max:!1,amountValue:"",onChange:v=>{i(v,!1)},selectable:!1,placeholder:"0.0",token:I.cetus_coin},iconParams:r}),e.jsxs(oe,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(L,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),e.jsx(Ve,{day:b,onChange:v=>{y(Number(v))}})]}),e.jsx(oe,{borderRadius:"12px",p:"0px",border:"none",children:e.jsxs(V,{w:"100%",gap:"20px",children:[e.jsx(te,{mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:s||w,isLoading:w,onClick:()=>{o?l?j(!0):h():u(!0)},children:n}),+g&&e.jsx(X,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:e.jsx(Ue,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:ae(g),valueStyle:{fontSize:"14px"}})})]})}),M&&e.jsx(ie,{isOpen:M,onClose:()=>{j(!1)},onSubmitClick:()=>{j(!1),h()}})]})}function at(){const{fetchAccountBalance:x}=N(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:r}=Z(),{xCetusSdk:a}=F(),{veNFT:o}=O(),{fetchOwnerVeNFT:u}=W(),{currentAccount:d}=U(),[t,i]=p.useState(!1);return{handleCancelOrder:async n=>{if(!o)return;i(!0);const s={venft_id:o.id,lock_id:n.id},h=a.XCetusModule.cancelRedeemPayload(s),b=await r(h,{},{msafeParams:{action:Q.xCETUSCancelRedeem,txbParams:s}});i(!1),b&&(x(),c(),d&&u(d==null?void 0:d.address,!0))},cancelOrderLoading:t}}function rt(){const{fetchAccountBalance:x}=N(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:r}=Z(),{xCetusSdk:a}=F(),{veNFT:o}=O(),{fetchOwnerVeNFT:u}=W(),{currentAccount:d}=U(),[t,i]=p.useState(!1);return{handleClaimOrder:async n=>{if(i(!0),!o)return;const s={lock_id:n,venft_id:o.id},h=await a.XCetusModule.redeemPayload(s),b=await r(h,{},{useDevInspect:!1,msafeParams:{action:Q.xCETUSRedeem,txbParams:s}});i(!1),b&&(x(),c(),d&&u(d==null?void 0:d.address,!0))},claimOrderLoading:t}}function ct({xcetus_amount:x,cetus_amount:c,imageSize:r="24px"}){const{isApp:a}=ye();return a?e.jsxs(V,{w:"100%",align:"center",gap:"8px",children:[e.jsxs(X,{children:[e.jsx(G,{imageUrl:I.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:r,h:r,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(L,{color:"text_caption",children:[$(P(x,9),9)," xCETUS"]})]}),e.jsx(L,{color:"text_caption",transform:"rotate(90deg)",children:"â†’"}),e.jsxs(X,{children:[e.jsx(G,{imageUrl:I.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:r,h:r,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(L,{color:"text_caption",children:[$(P(c,9),9)," CETUS "]})]})]}):e.jsxs(X,{children:[e.jsx(G,{imageUrl:I.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:r,h:r,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(L,{color:"text_caption",children:[$(P(x,9),9)," xCETUS â†’"]}),e.jsx(G,{imageUrl:I.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:r,h:r,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(L,{color:"text_caption",children:[$(P(c,9),9)," CETUS "]})]})}function Ne(){const{getTokenPrice:x,fetchTokenPrices:c}=ve();return{refreshCoinPriceInfo:async(a,o=!1)=>{const u=new Set;o||a.forEach(d=>{x(d,6e5)||u.add(d)}),console.log("ðŸš€ ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:u,coinTypeList:a}),u.size>0&&await c(Array.from(u),!1)}}}function it(){const{limitUserIndexerObj:x,setLimitUserIndexerObj:c,dcaUserIndexerObj:r,setDcaUserIndexerObj:a}=Xe(),{peripherySdk:o}=F();return{getLimitUserIndexer:async t=>{const i=x[t];if(i)return i;try{const f=new je;o.LimitOrder.buildGetUserIndexerHandle(t,f);const n=await o.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:f,sender:Me("0x0")}),s=o.LimitOrder.parsedQueryUserIndexerEvent(n);if(s)return c(t,s),s}catch(f){throw console.log("ðŸš€ ~ getLimitUserIndexer ~ error:",f),f}},getDcaUserIndexer:async t=>{const i=r[t];if(i)return i;try{const{dca:f}=o.sdkOptions,{user_indexer_id:n}=ke(f),s=await o.ClmmSDK.fullClient.getDynamicFieldObject({parentId:n,name:{type:"address",value:t}}),h=Ie(s).value.fields.id.id;if(h)return a(t,h),h}catch(f){throw console.log("ðŸš€ ~ getDcaUserIndexer ~ error:",f),f}}}}function lt(x=!1){const{xCetusSdk:c}=F(),{currentAccount:r}=U(),{fetchAccountBalance:a}=N(),{refreshCoinPriceInfo:o}=Ne(),{lockCetusList:u,veNFTLoading:d,lockCetusListLoading:t,clearData:i,owner:f,veNFT:n,XCetusManager:s,setXCetusManager:h,setDividendManager:b,setPhaseDividendInfoMap:y,phaseDividendInfoMap:g}=O(),{nextStartTime:w,currentPeriod:l,calculateCurrPeriod:M}=Le(),{summaryRewardList:j,rewardList:v,totalRewardValue:D}=Oe(l),{fetchVeNFTDividendInfo:_}=Re(),R=async m=>{try{const T=await c.XCetusModule.getXcetusManager(m);T&&h(T)}catch(T){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",T)}},J=async m=>{try{const T=await c.XCetusModule.getPhaseDividendInfo(m.toString());if(T)y(T);else{const le=(m-1).toString();if(!g[le]){const ne=await c.XCetusModule.getPhaseDividendInfo(m.toString());ne&&y(ne)}}}catch(T){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",T)}},H=async m=>{try{const T=await c.XCetusModule.getDividendManager(m);T&&b(T)}catch(T){console.log("ðŸš€ ~ fetchXCetusManager ~ error:",T)}},{fetchOwnerVeNFT:C}=W(),k=p.useMemo(()=>{if(n&&r&&!t){const m=De.getAvailableXCetus(n,u);if(K(m).gte(0))return m}return"0"},[n==null?void 0:n.xcetus_balance,u]),A=p.useMemo(()=>{if(n){const m=K(n.xcetus_balance).sub(k);if(m.gte(0))return m.toFixed(0)}return"0"},[n==null?void 0:n.xcetus_balance,k]),E=p.useMemo(()=>{if(s&&n){const m=K(n.xcetus_balance).div(s.treasury).mul(100);return K(m).lt(.01)?"<0.01%":ae(m.toString(),3)}return r?"0%":"--"},[s==null?void 0:s.treasury,n==null?void 0:n.xcetus_balance]),S=p.useMemo(()=>{if(l){let m=g[l.toString()];return m===void 0&&(m=g[(l-1).toString()]),m}},[g,l]),{cetusApr:B}=Pe(S,s==null?void 0:s.treasury);return p.useEffect(()=>{if(S){const m=S.bonus_types.map(T=>_e(T,!1));m&&(m.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),o(m))}},[S==null?void 0:S.id]),p.useEffect(()=>{l&&l>0&&J(l)},[l]),p.useEffect(()=>{n&&!x&&_(n.id)},[n==null?void 0:n.id]),{fetchOwnerVeNFT:C,fetchAccountBalance:a,fetchXCetusManager:R,fetchDividendManager:H,fetchVeNFTDividendInfo:_,veNFTLoading:d,lockCetusListLoading:t,redeemingXCetusAmount:A,availableXCetusAmount:k,veNFT:n,myShare:E,nextStartTime:w,cetusApr:B,summaryRewardList:j,rewardList:v,totalRewardValue:D,lockCetusList:u,calculateCurrPeriod:M}}export{st as C,ct as X,at as a,rt as b,lt as c,ot as d,Ne as e,it as f,nt as u};
//# sourceMappingURL=useXCetus-ebwsNFYf.js.map
