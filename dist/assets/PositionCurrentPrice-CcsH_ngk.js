import{a4 as A,aC as w,d as g,aH as U,R as H,r as R,j as i,H as b,S as j,T as S,as as C,I as v,c as D}from"./index-VLgXFcAE.js";import{u as B}from"./useBurn-CsUa4YtN.js";import{M as E}from"./msafe-oYBkW7LJ.js";import{c as I}from"./usePositionList-4KJFm0UW.js";function M(){const{getTokenAmountValue:_}=A(),f=(u,r,a)=>{if(!(u!=null&&u.length))return{total:"0",rewardAndFeeList:[]};let e="0";const o=[];u.forEach(n=>{const m=r[n==null?void 0:n.posId],x=a[n==null?void 0:n.posId]||[];if(m){const t=d(n==null?void 0:n.displayTokenA,m==null?void 0:m.displayFeeOwedA),s=d(n==null?void 0:n.displayTokenB,m==null?void 0:m.displayFeeOwedB);t&&o.push(t),s&&o.push(s),e=h(e,t==null?void 0:t.amountUSD,s==null?void 0:s.amountUSD)}x.forEach(t=>{if(Number(t==null?void 0:t.display_amount_owed)>0){const s=d(t==null?void 0:t.token,t==null?void 0:t.display_amount_owed,t==null?void 0:t.coin_address);s&&(o.push(s),e=h(e,s==null?void 0:s.amountUSD))}})});const l=p(o);return console.log("ðŸš€ ~ calculatePendingYield ~  total,:",l,e,l.length==1&&(e=="--"||Number(e)==0)),{total:(l==null?void 0:l.length)>0&&Number(e)==0?"--":e,rewardAndFeeList:l}},d=(u,r,a)=>{if(!u||!r)return null;const e=a||u.coin_type,o=_(e,r);return{coin_address:w(e,!1),amount:r,amountUSD:g(r).gt(0)&&g(o).lte(0)?"--":o,token:u}},h=(u,...r)=>{console.log("ðŸš€ ~ useCalculatePendingYield ~ amounts:",r);let a=g(u);return r.forEach(e=>{e&&e!=="--"&&a!=="--"&&(a=a.plus(e))}),a.toString()},p=u=>{const r={};return u.forEach(a=>{var n,m;const{coin_address:e,amount:o,amountUSD:l}=a;r[e]||(r[e]={...a,amount:"0",amountUSD:"0"}),l=="--"?r[e].amountUSD="--":r[e].amountUSD=r[e].amountUSD=="--"?"--":g((n=r[e])==null?void 0:n.amountUSD).plus(l||0).toString(),r[e].amount=g((m=r[e])==null?void 0:m.amount).plus(o||0).toString()}),Object.values(r).filter(a=>Number(a.amount)>0).sort((a,e)=>g(e.amountUSD=="--"?0:e.amountUSD).minus(a.amountUSD=="--"?0:a.amountUSD).toNumber())};return{calculatePendingYield:f}}const T=_=>_.startsWith("0x")?_.slice(2):_;function K(){const{clmmSdk:_}=U(),{peripherySdk:f,burnSdk:d}=H(),{getBurnClaimTxPayload:h}=B();return{getPosClaimFeeAndRewardTxPayload:async r=>{const{posType:a,id:e,clmmPool:o,coinTypeA:l,coinTypeB:n,rewarderCoinTypes:m,account:x}=r;let t,s;if(a==="clmm"){const c={pool_id:o,pos_id:e,rewarder_coin_types:m,coinTypeA:l,coinTypeB:n,collect_fee:!0};t=await _.Rewarder.collectRewarderTransactionPayload(c),s={action:E.ClaimFeeAndMining,txbParams:c}}else if(a==="farms"){const c={coinTypeA:l,coinTypeB:n,clmm_pool_id:o,position_nft_id:e,clmm_rewarder_types:m,collect_fee:!0};t=await f.Farms.claimFeeAndClmmReward(c),s={action:"FarmingClaimFeeAndReward",txbParams:c}}else a==="burn"&&(t=h({poolAddress:o,posId:e,coinTypeA:l,coinTypeB:n,account:x,rewarderCoinTypes:m}));return{tx:t,msafeParams:s}},getBatchHarvestFeeAndRewardsTxPayload:async(r,a,e)=>{console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ posBaseList:",r,a,e);const o=[],l=[],n=[];r.forEach(c=>{var P;const y=((P=a[c.posId])==null?void 0:P.map(F=>F.coin_address))||[];console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ rewarderCoinTypes:",y),c.posType=="clmm"?o.push({pool_id:c.clmmPool,pos_id:c.id,collect_fee:!0,rewarder_coin_types:y,coinTypeA:T(c.coinTypeA),coinTypeB:T(c.coinTypeB)}):c.posType=="farms"?l.push({pool_id:c.farmsPool,position_nft_id:c.id,clmm_pool_id:c.clmmPool,collect_fee:!0,collect_frams_rewarder:!1,clmm_rewarder_types:y,coinTypeA:c.coinTypeA,coinTypeB:c.coinTypeB}):n.push({pos:c==null?void 0:c.id,pool:c.clmmPool,coinTypeA:c.coinTypeA,coinTypeB:c.coinTypeB,rewarderCoinTypes:y,account:e})});const m=await f.Farms.batchHarvestAndClmmFeePayload(l,o),x=[];for(let c=0;c<n.length;c++){const y=n[c];(y==null?void 0:y.rewarderCoinTypes.length)>0&&x.push(y)}const t=d.Burn.createCollectFeesPaylaod(n,m),s=d.Burn.crateCollectRewardsPayload(x,t);return{txb:t,tx:s}}}}function V({posId:_,displayTokenA:f,displayTokenB:d,symbolEllipsesDecimals:h=10}){const[p,u]=R.useState(!0),{posPoolsRelatedData:r}=I(),a=r[_];return i.jsxs(b,{children:[i.jsx(j,{isLoaded:!!(a!=null&&a.currentPrice),children:i.jsx(S,{color:"text_caption",children:p?a==null?void 0:a.currentPrice:a==null?void 0:a.currentPriceReverse})}),i.jsxs(b,{gap:"0",children:[i.jsx(S,{color:"primary_gray",children:C(p?d==null?void 0:d.symbol:f==null?void 0:f.symbol,h)}),i.jsx(S,{color:"primary_gray",children:"Â perÂ "}),i.jsx(S,{color:"primary_gray",children:C(p?f==null?void 0:f.symbol:d==null?void 0:d.symbol,h)})]}),i.jsx(v,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:e=>{D(e),u(!p)}})]})}export{V as P,M as a,K as u};
