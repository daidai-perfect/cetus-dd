import{R as X,k as $,q as L,V as x,aa as b,aL as M,aI as h,d as _,y as v,w as F,a3 as O,b7 as V,Q as B,b8 as K,b9 as W}from"./index-COrObqhs.js";import{a as q}from"./vendor-DXHkIl66.js";import{u as j}from"./useToken-tdeKOG5n.js";import{u as Y}from"./useFavoritePool-CH5NkXpI.js";import{d as U,c as H,f as G,e as Q}from"./useGetPoolList-B9bUsMZ5.js";const z=(u,R)=>({showPosListLength:"",setShowPosListLength:t=>{u(()=>({showPosListLength:t}))},posApiPoolData:{},setPosApiPoolData:t=>{const g=R().posApiPoolData;u(()=>({posApiPoolData:{...g,...t}}))},myPosYieldValue:"",setMyPosYieldValue:t=>{u(()=>({myPosYieldValue:t}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:t=>{const g=t.reduce((w,r)=>{var c,l,n;return w[r.clmmPool]||(w[r.clmmPool]={list:[]}),(c=w[r.clmmPool])!=null&&c.tokenA||(w[r.clmmPool].isReverse=r==null?void 0:r.isReverse,w[r.clmmPool].tokenA=r==null?void 0:r.tokenA,w[r.clmmPool].tokenB=r==null?void 0:r.tokenB,w[r.clmmPool].displayTokenA=r==null?void 0:r.displayTokenA,w[r.clmmPool].displayTokenB=r==null?void 0:r.displayTokenB,w[r.clmmPool].clmmPoolAddress=r.clmmPool),(n=(l=w[r.clmmPool])==null?void 0:l.list)==null||n.push(r),w},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",g),u(()=>({posBaseList:t,posBaseListGroupByPool:g,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:t=>{u(()=>({posBaseListLoading:t}))},setPosBaseListIsLoading:t=>{u(()=>({posBaseListLoading:t}))},fullRangePosBaseList:[],setFullRangePosBaseList:t=>{u(()=>({fullRangePosBaseList:t,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:t=>{u(()=>({fullRangePosBaseListLoading:t}))},posPoolsOriginalData:{},setPosPoolOriginalData:t=>{u(()=>({posPoolsOriginalData:t}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:t=>{const g=R().posPoolsRelatedData;u(()=>({posPoolsRelatedData:{...g,...t},posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:t=>{u(()=>({posPoolsRelatedDataLoading:t}))},posLiquidityData:{},setPosLiquidityData:t=>{const g=R().posLiquidityData;u(()=>({posLiquidityData:{...g,...t},posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:t=>{u(()=>({posLiquidityDataLoading:t}))},posRewardsData:{},setPosRewardsData:t=>{const g=R().posRewardsData;u(()=>({posRewardsData:{...g,...t},posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:t=>{u(()=>({posRewardsDataLoading:t}))},farmsPosRewardsData:{},setFarmsPosRewardsData:t=>{u(()=>({farmsPosRewardsData:t,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:t=>{u(()=>({farmsPosRewardsDataLoading:t}))},posFeeData:{},setPosFeeData:t=>{const g=R().posFeeData;u(()=>({posFeeData:{...g,...t},posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:t=>{u(()=>({posFeeDataLoading:t}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:t=>{u(()=>({currentPosBaseInfo:t,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:t=>{u(()=>({currentPosBaseInfoLoading:t}))}}),S=X(z);function J(){const{peripherySdk:u}=$(),{getTokenListInfo:R}=j(),{setFarmsPosRewardsData:t,setFarmsPosRewardsDataLoading:g}=S(),w=q.useRef(u);q.useEffect(()=>{w.current=u},[u.ClmmSDK.senderAddress]);const r=async l=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",l),g(!0);const n=l==null?void 0:l.filter(o=>o.posType==="farms").map(o=>({pool_id:o.farmsPool,position_nft_id:o.id}));try{let o={};n&&n.length>0&&(o=await w.current.Farms.calculateFarmingRewards(n),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",o));let e=await c(o);console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",e),t(e)}catch(o){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",o)}},c=async l=>{let n={};const o=Object.entries(l).map(([a,s])=>({id:a,rewarderAmountOwed:s}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",o);const e=o.map(a=>a.rewarderAmountOwed.map(s=>s.rewarder_type)).flat(),i=await R(e);return n=Object.fromEntries(o.map((a,s)=>{for(const P of a.rewarderAmountOwed){const{rewarder_amount:D,rewarder_type:y}=P,m=i==null?void 0:i.get(y);P.display_amount_owed=L(D.toString(),(m==null?void 0:m.decimals)||0),P.amount_owed=D.toString(),P.token=m}return[a.id,a.rewarderAmountOwed]})),n};return{getFarmsRewardsData:r,formatFarmsRewardsData:c}}function Z(){const{setPosApiPoolData:u}=S(),{getFavoritePoolList:R}=Y();return{getPosApiPoolData:async g=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",g);const r={needLocalData:!1,pools:Array.from(new Set(g==null?void 0:g.map(n=>n.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",r);const c=await R(r)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",c);const l=c==null?void 0:c.list.reduce((n,o)=>(n[o.poolAddress]=o,n),{});u(l)}catch(w){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",w)}}}}function ee(){const{clmmSdk:u}=x(),{setPosFeeData:R,setPosFeeDataLoading:t}=S(),g=async r=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",r),t(!0);const c=r==null?void 0:r.map(o=>({poolAddress:o.clmmPool,positionId:o.posId,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",c);const l=await u.Position.fetchPosFeeAmount(c)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",l);const n=await w(l,r);console.log("getPosFeeData ~ posFeesData:",n),R(n)},w=async(r,c)=>Object.fromEntries(r.map(n=>{var a,s;const o=c.find(P=>P.posId===n.position_id),e=L(o.isReverse?n.feeOwedB.toString():n.feeOwedA.toString(),((a=o==null?void 0:o.displayTokenA)==null?void 0:a.decimals)||0),i=L(o.isReverse?n.feeOwedA.toString():n.feeOwedB.toString(),((s=o==null?void 0:o.displayTokenB)==null?void 0:s.decimals)||0);return[n.position_id,{feeOwedA:n.feeOwedA.toString(),feeOwedB:n.feeOwedB.toString(),displayFeeOwedA:e,displayFeeOwedB:i}]}));return{getPosFeeData:g,formatPosFeeData:w}}function oe(){const{setPosLiquidityData:u,setPosLiquidityDataLoading:R}=S(),{getTokenInfo:t}=j(),g=({tokenA:r,tokenB:c,liquidity:l,currentSqrtPrice:n,lowerTick:o,upperTick:e,roundUp:i})=>{const a=b.tickIndexToSqrtPriceX64(o),s=b.tickIndexToSqrtPriceX64(e),P=M.getCoinAmountFromLiquidity(new h(l),new h(n),a,s,i),D=P.coinA.toString(),y=P.coinB.toString(),m=r.decimals,p=c.decimals,d=L(D,m||0),f=L(y,p||0);return{coinAmountA:D,coinAmountB:y,amountA:d,amountB:f}};return{getPosLiquidityData:async(r,c)=>{var n,o;R(!0);const l={};for(let e=0;e<r.length;e++){const i=r[e],a=c==null?void 0:c[i.clmmPool],{coinAmountA:s,coinAmountB:P,amountA:D,amountB:y}=g({tokenA:i.tokenA,tokenB:i.tokenB,liquidity:i.liquidity,currentSqrtPrice:a==null?void 0:a.current_sqrt_price,lowerTick:i.lowerTick,upperTick:i.upperTick,roundUp:!0}),m=U(i.lowerTick,i.upperTick);let p=i.tokenA.decimals,d=i.tokenB.decimals;p==null&&(p=(n=await t(i.tokenA.coin_type))==null?void 0:n.decimals),d==null&&(d=(o=await t(i.tokenB.coin_type))==null?void 0:o.decimals);const f=b.sqrtPriceX64ToPrice(new h(a==null?void 0:a.current_sqrt_price),p,d).toString(),{percentA:A,percentB:T}=H(D,y,f,m),k=L(s,p),N=L(P,d),C=_(N).div(f).add(k).toString(),E=_(k).mul(f).add(N).toString();l[i.posId]={coinAmountA:s,coinAmountB:P,displayCoinAmountA:i.isReverse?y:D,displayCoinAmountB:i.isReverse?D:y,displayPercentA:i.isReverse?T:A,displayPercentB:i.isReverse?A:T,onlyAmountA:C,onlyAmountB:E}}console.log("getPosLisuidityData ~ posLiquidityData:",l),u(l)},getCoinAmountFromLiquidity:g}}function se(){const{clmmSdk:u}=x(),{setPosPoolOriginalData:R,setPosPoolsRelatedData:t,setPosPoolsRelatedDataLoading:g,setFullRangePosBaseList:w,setFullRangePosBaseListLoading:r}=S();return{getPosPoolsOriginalObj:async n=>{const o=n==null?void 0:n.map(a=>a.clmmPool),e=[...new Set([...o])];let i={};if(e&&e.length>0){const a=await u.Pool.getPools(e,0,1e3);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",a),i=Object.fromEntries(a==null?void 0:a.map(s=>{const P=n.find(d=>d.clmmPool===(s==null?void 0:s.poolAddress)),D=P.tokenA.decimals,y=P.tokenB.decimals,m=b.sqrtPriceX64ToPrice(new h(s==null?void 0:s.current_sqrt_price),D,y).toString(),p=_(1).div(m).toString();return[s==null?void 0:s.poolAddress,{...s,currentPrice:m,currentPriceReverse:p}]}))}return R(i),i},getPosPoolsRelatedData:(n,o)=>{g(!0),r(!0);const e={},i=[];n.forEach(a=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",a);const s=o[a.clmmPool],P=a.tokenA.decimals,D=a.tokenB.decimals,y=b.sqrtPriceX64ToPrice(new h(s==null?void 0:s.current_sqrt_price),P,D).toString(),m=_(1).div(y).toString();let p="0",d="0";G(a.lowerTick,"min")?p="0":p=b.tickIndexToPrice(Number(a.lowerTick),P,D).toString(),G(a.upperTick,"max")?d="âˆž":d=b.tickIndexToPrice(Number(a.upperTick),P,D).toString();let f,A;d!=="âˆž"?A=_(1).div(_(d)).toString():A="0",p!=="0"?f=_(1).div(_(p)).toString():f="âˆž";let T="";s!=null&&s.is_pause?T="Closed":Number(y)>=Number(p)&&(d==="âˆž"||Number(y)<=Number(d))?T="Active":(Number(y)>Number(d)||Number(y)<Number(p))&&(T="Inactive"),(p==="0"&&d==="âˆž"||f==="0"&&A==="âˆž")&&a.posType==="clmm"&&i.push(a);const k=a.isReverse;e[a.posId]={currentPrice:s?v(k?m:y).toString():"",currentPriceReverse:s?v(k?y:m).toString():"",minPrice:v(k?A:p).toString(),minPriceResever:v(k?p:A).toString(),maxPrice:v(k?f:d).toString(),maxPriceResever:v(k?d:f).toString(),minPriceOrigin:s?k?A:p:"",maxPriceOrigin:s?k?f:d:"",currentStatus:s?T:"",fee:s==null?void 0:s.fee_rate,displayFee:_(s==null?void 0:s.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:s==null?void 0:s.tickSpacing,currentTickIndex:s==null?void 0:s.current_tick_index,curSqrtPrice:s==null?void 0:s.current_sqrt_price,liquidity:s==null?void 0:s.liquidity}}),t(e),w(i)}}}function te(){const{clmmSdk:u}=x(),{getTokenListInfo:R}=j(),{setPosRewardsData:t,setPosRewardsDataLoading:g}=S(),w=async(c,l)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",c),g(!0);const n=c==null?void 0:c.filter(e=>e.posType!=="farms").map(e=>{const i=l[e.clmmPool];return{poolAddress:e.clmmPool,positionId:e.posId,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,rewarderInfo:i.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",n);let o={};if(n&&n.length>0)try{const e=await u.Rewarder.fetchPosRewardersAmount(n);o=await r(e),console.log("getPosRewardsData ~ posRewardsData:",o)}catch(e){console.log("getPosRewardsData ~ error:",e)}t(o)},r=async c=>{let l={};const n=c==null?void 0:c.map(e=>e.rewarderAmountOwed.map(i=>i.coin_address)).flat(),o=await R(n);return l=Object.fromEntries(c.map(e=>{for(const i of e.rewarderAmountOwed){const{amount_owed:a,coin_address:s}=i,P=o==null?void 0:o.get(s);i.display_amount_owed=L(a.toString(),(P==null?void 0:P.decimals)||0),i.amount_owed=a.toString(),i.token=P}return[e.positionId,e.rewarderAmountOwed]})),l};return{formatPosRewardsData:r,getPosRewardsData:w}}function I(){const u=(c,l)=>{if(l||l==0)return`Cetus LP | Pool${l}-${c}`},R=q.useMemo(()=>`${F.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[F]),t=q.useMemo(()=>`${F.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[F]),g=q.useMemo(()=>`${F.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[F]);return{getClmmPosName:u,buildPositionType:R,buildFarmsPositionType:t,buildBurnPositionType:g,getTokenALock:(c,l)=>{if(O(c)&&O(l)){const{lowerTick:n,upperTick:o}=c,e=l==null?void 0:l.current_tick_index;if(e!==void 0&&n!==void 0&&o!==void 0)return e>=n&&e<o?!1:e>=o?!0:!(e<n)}return!1},getTokenBLock:(c,l)=>{if(O(c)&&O(l)){const{lowerTick:n,upperTick:o}=c,e=l==null?void 0:l.current_tick_index;if(e!==void 0&&n!==void 0&&o!==void 0)return e>=n&&e<o||e>=o?!1:(e<n,!0)}return!1}}}function ae(){const{buildPositionType:u,buildFarmsPositionType:R,buildBurnPositionType:t}=I(),{getTokenListInfo:g}=j(),w=async(o,e)=>{const i=!Q(o,e),a=await g([o,e]),s=a==null?void 0:a.get(o),P=a==null?void 0:a.get(e);return{isReverse:i,tokenA:s,tokenB:P,displayTokenA:i?P:s,displayTokenB:i?s:P}},r=async o=>{var d;const e=V(o),i=B(e.coin_type_a).full_address,a=B(e.coin_type_b).full_address,{isReverse:s,tokenA:P,tokenB:D,displayTokenA:y,displayTokenB:m}=await w(i,a),p=((d=o==null?void 0:o.data)==null?void 0:d.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:i,coinTypeB:a,posType:"clmm",tokenName:"",tokenA:P,tokenB:D,displayTokenA:y,displayTokenB:m,isReverse:s,version:p}},c=async o=>{var d;const e=K.buildFramsPositionNFT(o),i=((d=o==null?void 0:o.data)==null?void 0:d.version)||"0",a=B(e.coinTypeA).full_address,s=B(e.coinTypeB).full_address,{isReverse:P,tokenA:D,tokenB:y,displayTokenA:m,displayTokenB:p}=await w(a,s);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:a,coinTypeB:s,posType:"farms",tokenName:e.name,isReverse:P,tokenA:D,tokenB:y,displayTokenA:m,displayTokenB:p,version:i}},l=async o=>{var d,f,A;const e=W.buildBurnPositionNFT((f=(d=o==null?void 0:o.data)==null?void 0:d.content)==null?void 0:f.fields),i=((A=o==null?void 0:o.data)==null?void 0:A.version)||"0",a=B(e.coinTypeA).full_address,s=B(e.coinTypeB).full_address,{isReverse:P,tokenA:D,tokenB:y,displayTokenA:m,displayTokenB:p}=await w(a,s);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:a,coinTypeB:s,posType:"burn",tokenName:e.name,isReverse:P,tokenA:D,tokenB:y,displayTokenA:m,displayTokenB:p,version:i}};return{wrapClmmPosBaseInfo:r,wrapBurnPosBaseInfo:l,wrapFarmsPosBaseInfo:c,buildPosBaseInfo:async o=>{const e=B(o.data.type);return e.full_address===u?await r(o):e.full_address===R?await c(o):e.full_address===t?await l(o):null}}}function de(){const{clmmSdk:u}=x(),{buildFarmsPositionType:R,buildBurnPositionType:t}=I(),{buildPosBaseInfo:g}=ae(),{setPosBaseList:w,setFullRangePosBaseList:r,setPosBaseListLoading:c}=S(),{getPosPoolsOriginalObj:l,getPosPoolsRelatedData:n}=se(),{getPosLiquidityData:o}=oe(),{getPosFeeData:e}=ee(),{getPosApiPoolData:i}=Z(),{getPosRewardsData:a}=te(),{getFarmsRewardsData:s}=J(),P=async(m,p)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",p),c(!0);try{const d=await u.fullClient.getOwnedObjectsByPage(m,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:F.clmm_sdk_options.clmm_pool.package_id},{StructType:R},{StructType:t}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",d);let f=await D(d,p);return w(f),c(!1),(f==null?void 0:f.length)==0&&r([]),f}catch(d){return console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",d),d instanceof TypeError?(c(!1),w([]),[]):[]}},D=async(m,p)=>{const d=[];for(const T of m.data){const k=await g(T);_(k==null?void 0:k.liquidity).lte(0)||!(k!=null&&k.displayTokenA)||!(k!=null&&k.displayTokenB)||k&&d.push(k)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",d);const f=d.sort((T,k)=>k.version-T.version);let A=[];return p?A=f==null?void 0:f.filter(T=>T.clmmPool===p):A=f,A};return{formatPosBaseList:D,getPositionBaseList:P,getPosRelatedData:async(m,p=!1)=>{var d;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",p,m),s(m),p||(console.log("ðŸš€ ~ getPosRelatedData ~ isFarms:",m),i(m),e(m));try{const f=await l(m);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",f),n(m,f),((d=Object.keys(f))==null?void 0:d.length)>0&&(o(m,f),p||a(m,f))}catch(f){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",f)}}}}export{S as a,ee as b,te as c,I as d,se as e,oe as f,J as g,ae as h,de as u};
//# sourceMappingURL=usePositionList-CTV19gkH.js.map
