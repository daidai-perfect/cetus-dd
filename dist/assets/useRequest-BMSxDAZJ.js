import{a as m,aF as g,aG as b,W as y,aP as Q,_ as V,aQ as $}from"./vendor-BulRdKUe.js";import{b as B,a as H,u as q}from"./index-e8NcK24v.js";import{d as J}from"./debounce-Cta0IZrB.js";import{v as K}from"./generateCategoricalChart-COzGi7lQ.js";import{i as X,u as P}from"./index-BYrW2Tah.js";var U=function(n,e){var r=e.manual,t=e.ready,i=t===void 0?!0:t,u=e.defaultParams,o=u===void 0?[]:u,d=e.refreshDeps,s=d===void 0?[]:d,c=e.refreshDepsAction,v=m.useRef(!1);return v.current=!1,B(function(){!r&&i&&(v.current=!0,n.run.apply(n,g([],b(o),!1)))},[i]),B(function(){v.current||r||(v.current=!0,c?c():n.refresh())},g([],b(s),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};U.onInit=function(n){var e=n.ready,r=e===void 0?!0:e,t=n.manual;return{loading:!t&&r}};function Y(n,e){if(n===e)return!0;for(var r=0;r<n.length;r++)if(!Object.is(n[r],e[r]))return!1;return!0}function G(n,e){var r=m.useRef({deps:e,obj:void 0,initialized:!1}).current;return(r.initialized===!1||!Y(r.deps,e))&&(r.deps=e,r.obj=n(),r.initialized=!0),r.obj}var A=new Map,Z=function(n,e,r){var t=A.get(n);t!=null&&t.timer&&clearTimeout(t.timer);var i=void 0;e>-1&&(i=setTimeout(function(){A.delete(n)},e)),A.set(n,y(y({},r),{timer:i}))},k=function(n){return A.get(n)},E=new Map,I=function(n){return E.get(n)},ee=function(n,e){E.set(n,e),e.then(function(r){return E.delete(n),r}).catch(function(){E.delete(n)})},w={},ne=function(n,e){w[n]&&w[n].forEach(function(r){return r(e)})},x=function(n,e){return w[n]||(w[n]=[]),w[n].push(e),function(){var t=w[n].indexOf(e);w[n].splice(t,1)}},re=function(n,e){var r=e.cacheKey,t=e.cacheTime,i=t===void 0?5*60*1e3:t,u=e.staleTime,o=u===void 0?0:u,d=e.setCache,s=e.getCache,c=m.useRef(),v=m.useRef(),a=function(f,l){d?d(l):Z(f,i,l),ne(f,l.data)},h=function(f,l){return l===void 0&&(l=[]),s?s(l):k(f)};return G(function(){if(r){var f=h(r);f&&Object.hasOwnProperty.call(f,"data")&&(n.state.data=f.data,n.state.params=f.params,(o===-1||new Date().getTime()-f.time<=o)&&(n.state.loading=!1)),c.current=x(r,function(l){n.setState({data:l})})}},[]),H(function(){var f;(f=c.current)===null||f===void 0||f.call(c)}),r?{onBefore:function(f){var l=h(r,f);return!l||!Object.hasOwnProperty.call(l,"data")?{}:o===-1||new Date().getTime()-l.time<=o?{loading:!1,data:l==null?void 0:l.data,error:void 0,returnNow:!0}:{data:l==null?void 0:l.data,error:void 0}},onRequest:function(f,l){var p=I(r);return p&&p!==v.current?{servicePromise:p}:(p=f.apply(void 0,g([],b(l),!1)),v.current=p,ee(r,p),{servicePromise:p})},onSuccess:function(f,l){var p;r&&((p=c.current)===null||p===void 0||p.call(c),a(r,{data:f,params:l,time:new Date().getTime()}),c.current=x(r,function(S){n.setState({data:S})}))},onMutate:function(f){var l;r&&((l=c.current)===null||l===void 0||l.call(c),a(r,{data:f,params:n.state.params,time:new Date().getTime()}),c.current=x(r,function(p){n.setState({data:p})}))}}:{}},te=function(n,e){var r=e.debounceWait,t=e.debounceLeading,i=e.debounceTrailing,u=e.debounceMaxWait,o=m.useRef(),d=m.useMemo(function(){var s={};return t!==void 0&&(s.leading=t),i!==void 0&&(s.trailing=i),u!==void 0&&(s.maxWait=u),s},[t,i,u]);return m.useEffect(function(){if(r){var s=n.runAsync.bind(n);return o.current=J(function(c){c()},r,d),n.runAsync=function(){for(var c=[],v=0;v<arguments.length;v++)c[v]=arguments[v];return new Promise(function(a,h){var f;(f=o.current)===null||f===void 0||f.call(o,function(){s.apply(void 0,g([],b(c),!1)).then(a).catch(h)})})},function(){var c;(c=o.current)===null||c===void 0||c.cancel(),n.runAsync=s}}},[r,d]),r?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}},ie=function(n,e){var r=e.loadingDelay,t=e.ready,i=m.useRef();if(!r)return{};var u=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return u(),t!==!1&&(i.current=setTimeout(function(){n.setState({loading:!0})},r)),{loading:!1}},onFinally:function(){u()},onCancel:function(){u()}}},O=!!(typeof window<"u"&&window.document&&window.document.createElement);function L(){return O?document.visibilityState!=="hidden":!0}var C=[];function ue(n){return C.push(n),function(){var r=C.indexOf(n);C.splice(r,1)}}if(O){var ae=function(){if(L())for(var n=0;n<C.length;n++){var e=C[n];e()}};window.addEventListener("visibilitychange",ae,!1)}var oe=function(n,e){var r=e.pollingInterval,t=e.pollingWhenHidden,i=t===void 0?!0:t,u=e.pollingErrorRetryCount,o=u===void 0?-1:u,d=m.useRef(),s=m.useRef(),c=m.useRef(0),v=function(){var a;d.current&&clearTimeout(d.current),(a=s.current)===null||a===void 0||a.call(s)};return B(function(){r||v()},[r]),r?{onBefore:function(){v()},onError:function(){c.current+=1},onSuccess:function(){c.current=0},onFinally:function(){o===-1||o!==-1&&c.current<=o?d.current=setTimeout(function(){!i&&!L()?s.current=ue(function(){n.refresh()}):n.refresh()},r):c.current=0},onCancel:function(){v()}}:{}};function se(n,e){var r=!1;return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];r||(r=!0,n.apply(void 0,g([],b(t),!1)),setTimeout(function(){r=!1},e))}}function ce(){return O&&typeof navigator.onLine<"u"?navigator.onLine:!0}var T=[];function fe(n){return T.push(n),function(){var r=T.indexOf(n);r>-1&&T.splice(r,1)}}if(O){var z=function(){if(!(!L()||!ce()))for(var n=0;n<T.length;n++){var e=T[n];e()}};window.addEventListener("visibilitychange",z,!1),window.addEventListener("focus",z,!1)}var le=function(n,e){var r=e.refreshOnWindowFocus,t=e.focusTimespan,i=t===void 0?5e3:t,u=m.useRef(),o=function(){var d;(d=u.current)===null||d===void 0||d.call(u)};return m.useEffect(function(){if(r){var d=se(n.refresh.bind(n),i);u.current=fe(function(){d()})}return function(){o()}},[r,i]),H(function(){o()}),{}},de=function(n,e){var r=e.retryInterval,t=e.retryCount,i=m.useRef(),u=m.useRef(0),o=m.useRef(!1);return t?{onBefore:function(){o.current||(u.current=0),o.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){u.current=0},onError:function(){if(u.current+=1,t===-1||u.current<=t){var d=r??Math.min(1e3*Math.pow(2,u.current),3e4);i.current=setTimeout(function(){o.current=!0,n.refresh()},d)}else u.current=0},onCancel:function(){u.current=0,i.current&&clearTimeout(i.current)}}:{}},ve=function(n,e){var r=e.throttleWait,t=e.throttleLeading,i=e.throttleTrailing,u=m.useRef(),o={};return t!==void 0&&(o.leading=t),i!==void 0&&(o.trailing=i),m.useEffect(function(){if(r){var d=n.runAsync.bind(n);return u.current=K(function(s){s()},r,o),n.runAsync=function(){for(var s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];return new Promise(function(v,a){var h;(h=u.current)===null||h===void 0||h.call(u,function(){d.apply(void 0,g([],b(s),!1)).then(v).catch(a)})})},function(){var s;n.runAsync=d,(s=u.current)===null||s===void 0||s.cancel()}}},[r,t,i]),r?{onCancel:function(){var d;(d=u.current)===null||d===void 0||d.cancel()}}:{}},he=function(n){m.useEffect(function(){n==null||n()},[])},me=function(){var n=b(m.useState({}),2),e=n[1];return m.useCallback(function(){return e({})},[])},pe=function(){function n(e,r,t,i){i===void 0&&(i={}),this.serviceRef=e,this.options=r,this.subscribe=t,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=y(y(y({},this.state),{loading:!r.manual}),i)}return n.prototype.setState=function(e){e===void 0&&(e={}),this.state=y(y({},this.state),e),this.subscribe()},n.prototype.runPluginHandler=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var i=this.pluginImpls.map(function(u){var o;return(o=u[e])===null||o===void 0?void 0:o.call.apply(o,g([u],b(r),!1))}).filter(Boolean);return Object.assign.apply(Object,g([{}],b(i),!1))},n.prototype.runAsync=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Q(this,void 0,void 0,function(){var t,i,u,o,d,s,c,v,a,h,f,l,p,S,F,M,W,_,D,N,j;return V(this,function(R){switch(R.label){case 0:if(this.count+=1,t=this.count,i=this.runPluginHandler("onBefore",e),u=i.stopNow,o=u===void 0?!1:u,d=i.returnNow,s=d===void 0?!1:d,c=$(i,["stopNow","returnNow"]),o)return[2,new Promise(function(){})];if(this.setState(y({loading:!0,params:e},c)),s)return[2,Promise.resolve(c.data)];(p=(l=this.options).onBefore)===null||p===void 0||p.call(l,e),R.label=1;case 1:return R.trys.push([1,3,,4]),v=this.runPluginHandler("onRequest",this.serviceRef.current,e).servicePromise,v||(v=(f=this.serviceRef).current.apply(f,g([],b(e),!1))),[4,v];case 2:return a=R.sent(),t!==this.count?[2,new Promise(function(){})]:(this.setState({data:a,error:void 0,loading:!1}),(F=(S=this.options).onSuccess)===null||F===void 0||F.call(S,a,e),this.runPluginHandler("onSuccess",a,e),(W=(M=this.options).onFinally)===null||W===void 0||W.call(M,e,a,void 0),t===this.count&&this.runPluginHandler("onFinally",e,a,void 0),[2,a]);case 3:if(h=R.sent(),t!==this.count)return[2,new Promise(function(){})];throw this.setState({error:h,loading:!1}),(D=(_=this.options).onError)===null||D===void 0||D.call(_,h,e),this.runPluginHandler("onError",h,e),(j=(N=this.options).onFinally)===null||j===void 0||j.call(N,e,void 0,h),t===this.count&&this.runPluginHandler("onFinally",e,void 0,h),h;case 4:return[2]}})})},n.prototype.run=function(){for(var e=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this.runAsync.apply(this,g([],b(r),!1)).catch(function(i){e.options.onError||console.error(i)})},n.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},n.prototype.refresh=function(){this.run.apply(this,g([],b(this.state.params||[]),!1))},n.prototype.refreshAsync=function(){return this.runAsync.apply(this,g([],b(this.state.params||[]),!1))},n.prototype.mutate=function(e){var r=X(e)?e(this.state.data):e;this.runPluginHandler("onMutate",r),this.setState({data:r})},n}();function ge(n,e,r){e===void 0&&(e={}),r===void 0&&(r=[]);var t=e.manual,i=t===void 0?!1:t,u=e.ready,o=u===void 0?!0:u,d=$(e,["manual","ready"]),s=y({manual:i,ready:o},d),c=q(n),v=me(),a=G(function(){var h=r.map(function(f){var l;return(l=f==null?void 0:f.onInit)===null||l===void 0?void 0:l.call(f,s)}).filter(Boolean);return new pe(c,s,v,Object.assign.apply(Object,g([{}],b(h),!1)))},[]);return a.options=s,a.pluginImpls=r.map(function(h){return h(a,s)}),he(function(){if(!i&&o){var h=a.state.params||e.defaultParams||[];a.run.apply(a,g([],b(h),!1))}}),H(function(){a.cancel()}),{loading:a.state.loading,data:a.state.data,error:a.state.error,params:a.state.params||[],cancel:P(a.cancel.bind(a)),refresh:P(a.refresh.bind(a)),refreshAsync:P(a.refreshAsync.bind(a)),run:P(a.run.bind(a)),runAsync:P(a.runAsync.bind(a)),mutate:P(a.mutate.bind(a))}}function Ce(n,e,r){return ge(n,e,g(g([],b([]),!1),[te,ie,oe,le,ve,U,re,de],!1))}export{Ce as u};
//# sourceMappingURL=useRequest-BMSxDAZJ.js.map
