import{a0 as A,r as n,aC as rs,j as e,V as k,T as _,B as N,S,Z as X,d as P,H as v,a1 as K,a3 as M,a2 as $,I as as,b as D,i as is}from"./index-BB14M7zw.js";import{u as ns}from"./ExpendItem-DY893wHF.js";import{a as Y,b as O}from"./usePositionList-I4qNuxva.js";import{N as U}from"./NoData-SuzM8qIx.js";import{A as ds}from"./index-BrMEhcSj.js";import{V as xs,R as ms,S as ps,T as gs,F as cs,a as hs}from"./FarmsTable-Bk3g-E7x.js";import{R as us}from"./RefreshButton-9wQrB_Pm.js";import{S as bs}from"./SortDropBlock-DV9E9lFQ.js";import{u as js}from"./useGetPoolList-DiqtR684.js";import{u as fs}from"./useAccountBalance-BNz4QwWa.js";import{u as Ls}from"./useRpcListener-DDi_UyvV.js";import"./useTransaction-D0dYLe1f.js";import"./msafe-oYBkW7LJ.js";import"./SingleTokenInfo-CIVLLr62.js";import"./useToken-BjRHcKk_.js";import"./AddressUnderline-Chx0jWAd.js";import"./PriceRange-0aQsFun0.js";import"./PositionStatus-B1wPrtsy.js";import"./RangeValue-GwcJc6_L.js";import"./useFavoritePool-C_gGjJpt.js";import"./api-data-utils-Dsc9QswP.js";import"./CoinPairInfo-Cu86oZpe.js";import"./PoweredByHaedal-C-b4VcJz.js";import"./tr-AMjWY8VQ.js";import"./usePreviousValue-BVhEAKZP.js";function Ss(s){const{totalRewards:d}=s,{currentAccount:l}=A(),{posBaseList:o}=Y(),{getPositionBaseList:g}=O(),{toClaimAllPos:r,claimLoading:c}=ns(),a=n.useRef(null),T=async()=>{l!=null&&l.address&&await g(l==null?void 0:l.address)},u=()=>{r(o,T)};return n.useEffect(()=>{a!=null&&a.current&&(a.current.textContent=rs(d,2))},[d]),e.jsx(k,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(k,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(_,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(_,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(l==null?void 0:l.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(S,{isLoaded:!!d,children:e.jsx(_,{color:"primary",fontSize:"20px",fontWeight:"500",ref:a})})}),(l==null?void 0:l.address)&&e.jsx(X,{isLoading:c,disabled:c||d=="--"?!0:P(d).lte(0),w:"170px",h:"28px",fontSize:"14px",borderRadius:"4px",onClick:u,children:"Claim All Rewards"})]})})}function ys({dataList:s,showSkeletonLoading:d,currTabLabel:l}){const{currentAccount:o,onWalletModal:g}=A();return e.jsx(e.Fragment,{children:l=="Your Farms"&&!(o!=null&&o.address)?e.jsx(U,{type:"nowallet",onboard:()=>{g(!0)}}):d?e.jsx(vs,{}):s.length===0?e.jsx(U,{type:"nodata",text:"No farms found"}):e.jsx(k,{w:"100%",children:s.map(r=>e.jsx(Ts,{apiInfo:r},r==null?void 0:r.poolAddress))})})}const Ts=({apiInfo:s})=>{const{getTokenAmountValue:d}=M(),{coinPriceObj:l}=$();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:o,onWalletModal:g}=A(),[r,c]=n.useState({}),{farmsPosRewardsDataLoading:a,farmsPosRewardsData:T,posBaseListLoading:u,posBaseListGroupByPool:f}=Y(),y=n.useMemo(()=>{var b;if(!(o!=null&&o.address)||!(s!=null&&s.poolAddress))return"--";if(!u&&!a)return(((b=f[s.poolAddress])==null?void 0:b.list)||[]).reduce((p,j)=>{const x=T[j==null?void 0:j.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",p,x);const V=x.reduce((W,m)=>{if(W==="--")return"--";const C=d(m==null?void 0:m.token.coin_type,m==null?void 0:m.display_amount_owed,"--");return C==="--"?"--":P(W).plus(C).toString()},"0");return p==="--"||V==="--"?"--":P(p).plus(V).toString()},"0")},[u,T,a,l,o==null?void 0:o.address]),B=n.useMemo(()=>{var L,p;const b=((p=(L=f==null?void 0:f[s==null?void 0:s.poolAddress])==null?void 0:L.list)==null?void 0:p.filter(j=>j.posType!=="burn").sort((j,x)=>Number(x.liquidity)-Number(j.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",b),b},[s==null?void 0:s.poolAddress,f]);return e.jsxs(k,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(xs,{apiInfo:s}),e.jsx(E,{label:"Staked TVL",value:e.jsx(_,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(E,{label:"APR",value:e.jsx(ds,{poolInfo:s,isPosition:!0})}),e.jsx(E,{label:"Rewards / day",value:e.jsx(ms,{apiInfo:s})}),e.jsx(E,{label:"Your Staked",value:e.jsx(ps,{apiInfo:s})}),e.jsx(E,{label:"Your Earned",value:e.jsx(gs,{totalEarned:y,apiInfo:s,disabled:y=="--"?!0:P(y).lte(0)})}),e.jsx(X,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{r[s==null?void 0:s.poolAddress]?r[s==null?void 0:s.poolAddress]=!1:r[s==null?void 0:s.poolAddress]=!0,c({...r})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(as,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:r[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),r[s==null?void 0:s.poolAddress]&&e.jsx(cs,{expendList:B,apiInfo:s})]})},E=({label:s,value:d})=>e.jsxs(v,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:s}),d]}),vs=()=>e.jsx(k,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,d)=>e.jsxs(k,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(v,{gap:"0",children:[e.jsx(K,{size:"9"}),e.jsx(K,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(S,{height:"4",width:"150px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]}),e.jsxs(v,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(S,{height:"4",width:"120px"}),e.jsx(S,{height:"4",width:"120px"})]})]},d))});function Rs(s){const{sortByList:d,currTab:l,tabList:o,handleChangeTab:g,currSortType:r,onSortByChange:c,sortRule:a,handleRefresh:T,handleChangeSortRule:u}=s,{isApp:f}=D();return e.jsxs(v,{w:"100%",mt:{base:"20px",lg:"40px"},justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[e.jsx(is,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"415px"},h:"46px",borderRadius:{base:"8px",lg:"12px"}},itemStyle:{w:"50%",fontSize:"16px"},tabList:o,currentTab:l.label,handleChangeTab:g}),e.jsxs(v,{w:{base:"100%",lg:"unset"},children:[e.jsx(bs,{sortText:"Sort by",xlinkHref:a=="desc"?"#icon-icon_sort2":"#icon-icon_sort_asc1",iconOnClick:()=>{u(a==="asc"?"desc":"asc")},minW:f?"calc(100vw - 126px)":"120px",currentSort:r,sortByList:d,onSortByChange:c,wrapStyle:{borderRadius:{base:"8px",lg:"12px"}}}),e.jsx(us,{handleRefresh:T,borderRadius:{base:"8px",lg:"12px"}})]})]})}function ks(){const{getPoolList:s}=js();return{getFarmList:async(l="-tvl")=>{var g;const o=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",o),(g=o==null?void 0:o.list)==null?void 0:g.sort((r,c)=>l==="-apr"?c.feeAndFarmsApr-r.feeAndFarmsApr:l==="apr"?r.feeAndFarmsApr-c.feeAndFarmsApr:l==="-tvl"?c.farmsStatedTvl-r.farmsStatedTvl:r.farmsStatedTvl-c.farmsStatedTvl)}}}function qs(){const{currentAccount:s}=A(),{getPositionBaseList:d,getPosRelatedData:l}=O(),{posBaseList:o,posBaseListLoading:g,farmsPosRewardsData:r}=Y(),{getFarmList:c}=ks(),[a,T]=n.useState([]),[u,f]=n.useState([]),[y,B]=n.useState([]),[b,L]=n.useState(!0),[p,j]=n.useState([]);fs();const[x,V]=n.useState({label:"Live"}),W=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[m,C]=n.useState({sortRule:"desc",sortType:"tvl"}),[q,I]=n.useState({label:"TVL",value:"tvl"}),ss=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:b?void 0:u.length.toString()}),t.push({label:"Your Farms",num:y.length>0&&(s!=null&&s.address)&&!b?y.length.toString():void 0}),t},[x.label,b,u,y,s==null?void 0:s.address]),G=async()=>{s!=null&&s.address?(await d(s==null?void 0:s.address),console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address)):j([])};n.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ posBaseList:",o),(o==null?void 0:o.length)>0&&l(o,!0)},[o]);const z=async t=>{const i=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,R=await c(i);R&&T(R)};n.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",p),a.length>0){if(x.label=="Live"&&(f(a),L(!1)),s!=null&&s.address&&(p==null?void 0:p.length)>0){const t=a.filter(i=>(p==null?void 0:p.filter(h=>(h==null?void 0:h.posType)==="farms")).some(h=>(i==null?void 0:i.poolAddress)===(h==null?void 0:h.clmmPool)));B(t)}else B([]);g||L(!1)}else f([]),B([])},[x.label,a,s==null?void 0:s.address,p,g]),n.useEffect(()=>{z(m),s!=null&&s.address?(L(!0),G()):j([])},[s==null?void 0:s.address]),n.useEffect(()=>{j(o)},[o]);const Q=()=>{L(!0),z(m),G()};Ls({onRpcChange:()=>{Q()}});const{fetchTokenPrices:es}=M(),ts=()=>{const t=[];a==null||a.forEach(i=>{var R,h;t.includes(i.tokenA.coin_type)||t.push(i.tokenA.coin_type),t.includes(i.tokenB.coin_type)||t.push(i.tokenB.coin_type),((R=i==null?void 0:i.farmsRewarderList)==null?void 0:R.length)>0&&((h=i==null?void 0:i.farmsRewarderList)==null||h.forEach(w=>{t.push(w==null?void 0:w.coinType)}))}),t.length>0&&es(Array.from(new Set(t)))};n.useEffect(()=>{(a==null?void 0:a.length)>0&&ts()},[a]);const{getTokenAmountValue:os}=M(),{coinPriceObj:ls}=$(),Z=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!g)return o.reduce((t,i)=>{const h=(r[i==null?void 0:i.id]||[]).reduce((w,F)=>{if(w==="--")return"--";const J=os(F==null?void 0:F.token.coin_type,F==null?void 0:F.display_amount_owed,"--");return J==="--"?"--":P(w).plus(J).toString()},"0");return t==="--"||h==="--"?"--":P(t).plus(h).toString()},"0")},[g,r,ls,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",Z);const{isApp:H}=D();return e.jsxs(k,{gap:"20px",w:"100%",children:[e.jsx(Ss,{totalRewards:Z}),e.jsx(N,{h:"220px"}),e.jsx(Rs,{sortByList:W,currTab:x,tabList:ss,handleChangeTab:t=>{V(t)},currSortType:q,onSortByChange:t=>{L(!0),m.sortType=t.value,C({...m}),I(t),z(m)},sortRule:m.sortRule,handleChangeSortRule:t=>{L(!0),m.sortRule=t,C({...m}),z(m)},handleRefresh:Q}),H&&e.jsx(_,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!H&&e.jsx(hs,{dataList:x.label=="Live"?u:y,showSkeletonLoading:b,currTabLabel:x==null?void 0:x.label}),H&&e.jsx(ys,{dataList:x.label=="Live"?u:y,showSkeletonLoading:b,currTabLabel:x==null?void 0:x.label})]})}export{qs as default};
