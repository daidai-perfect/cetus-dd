import{r as d,a4 as rt,d as ue,as as W,j as e,ad as it,ae as ot,af as nt,ag as st,ah as we,ai as ct,aj as lt,V as B,H as O,a0 as Oe,T as C,W as ze,B as ee,bk as Ce,Y as at,$ as te,I as ye,aM as $e,aN as pt,an as vt,a1 as xt,aO as G,m as he,g as At,b as dt,k as Je,bl as Rt,al as Dt,bm as It,ac as de,aQ as J,bc as k,aV as Ie,aa as ne,a as ut,bd as Ft,bn as Pt,bo as Xe,a9 as Me,a6 as Wt,aS as Qe,aZ as Fe}from"./index-BHioxihs.js";import{b as zt,u as $t,a as Nt}from"./SelectTokenAndFeeConfirm-B_codzOX.js";import{P as Ot}from"./PositionStatus-CHJ1G87m.js";import{c as ht,b as Pe}from"./useGetPoolList-g-UFM5lp.js";import{H as Ne}from"./HTextLabelBox-Bsxm1-Y-.js";import{T as Lt}from"./TradeConfirmAmountInfo-BvV6xzPt.js";import{I as Et,P as qe}from"./common-_IjrV_V2.js";import{u as Te}from"./useTokenBalance-BLs9nTNB.js";import{T as Ht}from"./TradeInputGroup-DHW51PUD.js";import{L as ke}from"./LockInput-BB5BkeHo.js";import{u as Vt,a as Ut}from"./useCreatePoolHelper-C6hheTtt.js";import{I as Gt}from"./InputBox-Cm2u5Ykw.js";import{i as be}from"./index-XbiT-K8U.js";import{d as Bt}from"./FeeTierSelect-BzlcFebH.js";import{u as gt}from"./useAccountBalance-BkCOmdNG.js";import{u as Kt}from"./useDocumentSize-BYcypMB8.js";import{u as et}from"./useToken-DZK_dzU3.js";import{u as Yt}from"./usePreviousValue-qnWj3KZg.js";import{u as Zt}from"./useTransaction-B_4Jg7f2.js";import{R as Jt}from"./RefreshButton-CiZJCLSA.js";import"./index-CbaF6qCz.js";import"./Loading-CfSmXNdE.js";import"./SingleTokenInfo-D28cfzld.js";import"./AddressCopyLink-V33ze5Xu.js";import"./AddressUnderline-DQBj8kxU.js";import"./CetusTooltip-D74XO5fb.js";import"./TooltipIcon-B9nqzUAW.js";import"./api-data-utils-BCUKKSI0.js";import"./ActionButton-CnqRq_P_.js";import"./_getAllKeysIn-Be6LJ_gF.js";import"./icon_lock@2x-OdzkPjmc.js";import"./usePosAdd-qk1D_bvw.js";import"./global-DSBKxi_f.js";import"./usePositionList-BoU0l88X.js";import"./useCurrentPos-rccnNGjZ.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-9c6kR8yD.js";import"./liquidity-C_6QK2Qc.js";import"./debounce-Y-z0BKQj.js";import"./index-BUbOgaOa.js";function Xt(h){const{isOpen:g,onClose:u,onSubmit:l,data:i}=h,{baseToken:t,quoteToken:r,feeDisplay:x,baseAmount:n,quoteAmount:o,isReverse:b,initPrice:s,minPrice:f,maxPrice:p,isFullRange:v}=i,[y,E]=d.useState(!0);console.log("ðŸš€ ~ file: CreateConfirmModal.tsx:49 ~ CreateConfirmModal ~ data:",i,y);const{getTokenAmountValue:L}=rt(),H=L(t==null?void 0:t.coin_type,n),V=L(r==null?void 0:r.coin_type,o),z=d.useMemo(()=>ue(H||"0").plus(V||"0").toString(),[H,V]),a=d.useMemo(()=>ht(n,o,s,v),[n,o]),$=d.useMemo(()=>y?`${W(r==null?void 0:r.symbol)} per ${W(t==null?void 0:t.symbol)}`:`${W(t==null?void 0:t.symbol)} per ${W(r==null?void 0:r.symbol)}`,[y,t==null?void 0:t.symbol,r==null?void 0:r.symbol]),_=d.useMemo(()=>v?"0":b?y?f==null?void 0:f.displayReversePrice:p.displayPrice:y?f==null?void 0:f.displayPrice:p.displayReversePrice,[y]),Y=d.useMemo(()=>v?"âˆž":b?y?p==null?void 0:p.displayReversePrice:f.displayPrice:y?p==null?void 0:p.displayPrice:f.displayReversePrice,[y]);return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(ot,{}),e.jsxs(nt,{children:[e.jsx(st,{children:e.jsx(we,{fontWeight:"500",fontSize:"16px",children:"Preview"})}),e.jsx(ct,{}),e.jsx(lt,{textAlign:"center",p:"0px",children:e.jsxs(B,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(O,{children:[e.jsx(Oe,{coinACoinType:t==null?void 0:t.coin_type,coinBCoinType:r==null?void 0:r.coin_type,coinAIconUrl:t==null?void 0:t.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(C,{fontSize:"16px",color:"text_caption",children:`${W(t==null?void 0:t.symbol)} - ${W(r==null?void 0:r.symbol)}`})]}),e.jsx(ze,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(O,{gap:"12px",children:[e.jsx(C,{children:"Fee Tier"}),e.jsx(C,{color:"primary",children:x})]})})]}),e.jsx(Lt,{coinA:{amount:n,...t},coinB:{amount:o,...r}}),e.jsxs(ee,{w:"100%",children:[e.jsxs(O,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(C,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(Ot,{isActive:!0,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(O,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(C,{children:"Current Price"}),e.jsx(C,{as:"span",color:"text_caption",children:Ce(y?s:at(ue(1).div(s).toFixed(18),18,!0).toString(),18)}),e.jsx(C,{children:$}),e.jsx(te,{variant:"unstyled",onClick:()=>E(!y),children:e.jsx(ye,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(O,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(tt,{title:"Min Price",price:_,perText:$}),e.jsx($e,{orientation:"vertical",h:"40px"}),e.jsx(tt,{title:"Max Price",price:Y,perText:$})]})]}),e.jsx(Ne,{isLoading:!1,label:"Deposit Ratio",value:`${a.percentA}% ${W(t==null?void 0:t.symbol)} / ${a.percentB}% ${W(r==null?void 0:r.symbol)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx(Ne,{isLoading:!1,label:"Total Amount",value:z&&+z?pt(z):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(te,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:l,children:"Create and Add Liquidity"})]})})]})]})}const tt=({title:h,price:g,perText:u})=>e.jsxs(B,{flex:"1",children:[e.jsx(C,{children:h}),e.jsx(C,{color:"text_caption",children:g}),e.jsx(C,{children:u})]});function Mt(h){const{isOpen:g,onClose:u,data:l}=h,{baseToken:i,quoteToken:t,feeDisplay:r}=l;return e.jsxs(it,{autoFocus:!1,returnFocusOnClose:!1,isOpen:g,onClose:u,isCentered:!0,children:[e.jsx(ot,{}),e.jsxs(nt,{children:[e.jsx(st,{}),e.jsx(ct,{}),e.jsx(lt,{children:e.jsx(B,{gap:"8px",pb:"8px",pt:"28px",w:"100%",children:e.jsxs(B,{gap:"8px",children:[e.jsx(vt,{src:"/images/img_transactionsuccess@2x.png",w:"200px",h:"200px",alt:"icon"}),e.jsxs(B,{mt:"-155px",gap:"10px",children:[e.jsxs(O,{children:[e.jsx(Oe,{coinACoinType:i==null?void 0:i.coin_type,coinBCoinType:t==null?void 0:t.coin_type,coinAIconUrl:i==null?void 0:i.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,imageStyle:{w:"24px",h:"24px"},imgBoxStyle:{w:"24px",h:"24px"}}),e.jsx(C,{fontSize:"14px",color:"text_caption",children:`${i==null?void 0:i.symbol} - ${t==null?void 0:t.symbol}`})]}),e.jsx(ze,{w:"unset",p:"4px 6px",borderRadius:"12px",children:e.jsxs(C,{fontSize:"12px",color:"primary",children:["Fee Tier ",r]})})]}),e.jsx(ze,{mt:"80px",borderRadius:"16px",padding:"16px",children:e.jsx(C,{color:"primary_gray",fontSize:"12px",lineHeight:"20px",children:"The pool has been created. It will usually take up to 3 min for a new pool to be presented in front end interface. Thanks for creating this pool"})}),e.jsx(te,{mt:"16px",fontSize:"14px",w:"100%",onClick:()=>{u()},children:"OK"})]})})})]})]})}function Qt(h,g,u,l,i,t){const{currentAccount:r}=xt(),x=d.useMemo(()=>{const n={text:"Create",disabled:!1};return r!=null&&r.address?!h||!g||h&&!+h||g&&!+g?(n.text="Enter an amount",n.disabled=!0,n):h&&+h&&ue(h).gt((i==null?void 0:i.balanceFormat)||0)?(n.disabled=!0,n.text=`Insufficient ${W(u==null?void 0:u.symbol)} Balance`,n):g&&+g&&ue(g).gt((t==null?void 0:t.balanceFormat)||0)?(n.disabled=!0,n.text=`Insufficient ${W(l==null?void 0:l.symbol)} Balance`,n):((!h||!g)&&(n.disabled=!0),n):(n.text="Connect Wallet",n.disabled=!1,n)},[r==null?void 0:r.address,h,g,i==null?void 0:i.balanceDisplay,t==null?void 0:t.balanceDisplay,u==null?void 0:u.coin_type,l==null?void 0:l.coin_type]);return{btnText:x.text,btnDisabled:x.disabled}}function qt({currentStep:h,editStep:g,onCreate:u,baseToken:l,quoteToken:i,baseAmount:t,quoteAmount:r,onBaseAmountChange:x,onQuoteAmountChange:n,isReverse:o,percentMap:b}){const{balanceInfo:s}=Te(l),{balanceInfo:f}=Te(i),{btnText:p,btnDisabled:v}=Qt(t,r,l,i,s,f),{fetchTokenPrices:y,getTokenAmountValue:E}=rt(),L=()=>{const a=[];l!=null&&l.coin_type&&a.push(l==null?void 0:l.coin_type),i!=null&&i.coin_type&&a.push(i==null?void 0:i.coin_type),a.length>0&&y(a)};d.useEffect(()=>{L()},[l==null?void 0:l.coin_type,i==null?void 0:i.coin_type]);const H=E(l==null?void 0:l.coin_type,t),V=E(i==null?void 0:i.coin_type,r),z=d.useMemo(()=>{if(+H&&+V)return G(H||"0").plus(V||"0").toString()},[H,V]);return e.jsx(e.Fragment,{children:h===3&&g===3?e.jsxs(B,{w:"100%",gap:"12px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Deposit amounts"}),e.jsx(Ht,{wrapStyle:{mt:"4px"},from:{wrapStyle:{h:"108px"},balance:(s==null?void 0:s.balanceFormat)||"",value:t,amountValue:H,loading:!1,onChange:a=>{x(a)},selectable:!1,placeholder:"0.0",token:l},to:{wrapStyle:{h:"108px"},balance:(f==null?void 0:f.balanceFormat)||"",value:r,amountValue:V,loading:!1,onChange:a=>{n(a)},selectable:!1,placeholder:"0.0",token:i}}),e.jsxs(B,{gap:"16px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(Ne,{isLoading:!1,label:"Total Amount",value:z&&+z?pt(z):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),e.jsx(Et,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(he,{flexDir:{base:"column",lg:"row"},gap:{base:"4px",lg:"12px"},children:b&&[l,i].filter(Boolean).map((a,$)=>e.jsxs(O,{gap:"4px",justify:"flex-end",children:[e.jsx(At,{imageUrl:a==null?void 0:a.logo_url,coinType:a?a==null?void 0:a.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(C,{color:$===0?"primary":"primary_green",fontSize:"14px",children:[W(a==null?void 0:a.symbol),"Â ",b[$===0?o?"percentB":"percentA":o?"percentA":"percentB"],"%"]})]},a==null?void 0:a.coin_type))})})]}),e.jsx(te,{w:"100%",onClick:u,h:"48px",fontSize:"16px",borderRadius:"12px",disabled:v,children:p})]}):null})}function ft({onEdit:h,children:g}){return e.jsxs(O,{w:"100%",p:{base:"16px 8px",lg:"20px 32px"},border:"0px solid",borderColor:"border",borderRadius:"12px",bg:"bg_fifth",justify:"space-between",children:[g,e.jsxs(te,{onClick:h,variant:"unstyled",border:"1px solid",borderColor:"border",cursor:"pointer",borderRadius:"8px",p:"5px 8px",display:"flex",h:"32px",alignItems:"center",gap:"8px",minW:"auto",_hover:{p:{color:"#fff"},svg:{fill:"#fff"}},children:[e.jsx(ye,{xlinkHref:"#icon-icon_edit"}),e.jsx(C,{fontSize:"12px",fontWeight:"500",children:"Edit"})]})]})}function Tt({onEdit:h,editStep:g,currentStep:u,onContinue:l,baseToken:i,quoteToken:t,onBaseTokenChange:r,onQuoteTokenChange:x,feeTier:n,feeTierList:o,onFeeTierChange:b,quoteWhiteTokenList:s}){return e.jsx(e.Fragment,{children:g===1||u===1?e.jsx(zt,{title:"Select pair",description:"Select the token you want to create a liquidity pool for.",onContinue:l,baseToken:i,onBaseTokenChange:r,quoteToken:t,onQuoteTokenChange:x,quoteWhiteTokenList:s,feeTier:n,feeTierList:o,onFeeTierChange:b,wrapStyle:{p:{base:"16px 8px",lg:"32px"}},fromSource:"createPool"}):e.jsx(ft,{onEdit:h,children:e.jsxs(O,{gap:"12px",children:[e.jsx(Oe,{coinAIconUrl:i==null?void 0:i.logo_url,coinBIconUrl:t==null?void 0:t.logo_url,coinACoinType:i==null?void 0:i.coin_type,coinBCoinType:t==null?void 0:t.coin_type,w:"36px",h:"36px"}),e.jsxs(O,{children:[e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${W(i==null?void 0:i.symbol)}-${W(t==null?void 0:t.symbol)}`}),e.jsx(ee,{h:"16px",p:"1px 8px",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",children:e.jsx(C,{fontSize:"12px",fontWeight:"500",color:"text_highlight",children:typeof n=="string"?`${ue(n).div(100).toString()}%`:n==null?void 0:n.feeDisplay})})]})]})})})}const kt=[{label:"Full Range"},{label:"Custom Range"}];function er({editStep:h,currTick:g,currentStep:u,onEdit:l,onContinue:i,displayBaseToken:t,displayQuoteToken:r,initPrice:x,onInitPriceChange:n,displayMinPrice:o,onMinPriceChange:b,displayMaxPrice:s,onMaxPriceChange:f,isFullRange:p,isReverse:v,handleRangeModeChange:y,handleSwitchDirectionChange:E,handlePriceAction:L}){const[H,V]=d.useState("Full Range"),{isApp:z}=dt(),a=d.useMemo(()=>o?[o.tokenA,o.tokenB].filter(Boolean).map(S=>({label:S==null?void 0:S.symbol,isToken:!0,imgInfo:{src:S==null?void 0:S.logo_url,w:"16px",h:"16px",borderRadius:"50%",fallbackSrc:"/images/placeholder-token@2x.png"}})):[],[o==null?void 0:o.tokenA,o==null?void 0:o.tokenB]),$=d.useMemo(()=>`${W(r==null?void 0:r.symbol)} per ${W(t==null?void 0:t.symbol)}`,[t==null?void 0:t.symbol,r==null?void 0:r.symbol]),_=d.useMemo(()=>{var S;return p?!0:((S=o==null?void 0:o.tokenA)==null?void 0:S.coin_type)===(t==null?void 0:t.coin_type)},[p,o==null?void 0:o.tokenA,o==null?void 0:o.tokenB,t==null?void 0:t.coin_type]),{showInputPriceWarn:Y,showPriceRangeWarn:M}=Vt(p,g,v?s.tick:o.tick,v?o.tick:s.tick),re=d.useMemo(()=>(o==null?void 0:o.price)==="0"&&(s==null?void 0:s.price)==="âˆž",[o==null?void 0:o.price,s==null?void 0:s.price]);return e.jsx(e.Fragment,{children:u>=2?h===2||u===2?e.jsxs(B,{w:"100%",gap:"32px",bg:"bg_fifth",borderRadius:"12px",p:{base:"16px 8px",lg:"32px"},children:[e.jsxs(B,{gap:"8px",w:"100%",align:"flex-start",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set initial Price"}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",justify:"space-between",mt:"-2px",alignItems:"center",children:[e.jsx(C,{fontSize:"12px",children:"Please set an initial price for this new pool to start."}),e.jsx(Je,{type:"outlineTab",tabList:a,currentTab:t==null?void 0:t.symbol,handleChangeTab:S=>{S.label!==(t==null?void 0:t.symbol)&&E()},wrapStyle:{w:{base:"100%",lg:"auto"},h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px"},itemStyle:{flex:1,h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}})]}),e.jsx(Gt,{mt:"4px",h:"48px",borderRadius:"12px",p:"16px",children:e.jsxs(Rt,{fontFamily:"Inter",justifyContent:"space-between",gap:"12px",children:[e.jsx(Dt,{value:x?Ce(x,18):"",onChange:S=>{n==null||n(S)},placeholder:"0.0",inputAllowed:!0,decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"16px",fontWeight:"500",height:"14px",lineHeight:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(It,{children:e.jsx(C,{children:$})})]})}),x&&e.jsxs(O,{h:"20px",w:"100%",children:[e.jsxs(C,{color:"text_caption",fontSize:"12px",children:["Current Price: 1 ",W(t==null?void 0:t.symbol)," = ",de(Ce(x,18))," ",W(r==null?void 0:r.symbol)]}),e.jsx(ye,{w:"16px",h:"16px",svgW:"16px",svgH:"16px",xlinkHref:"#icon-icon_swap1",fontSize:"12px",onClick:E})]})]}),e.jsxs(B,{w:"100%",align:"flex-start",gap:"12px",children:[e.jsx(we,{fontSize:"16px",fontWeight:"500",children:"Set Price Range"}),e.jsx(C,{fontSize:"12px",children:"Please specify a price range that you want to provide your liquidity within."}),e.jsx(Je,{type:"outlineTab",tabList:kt,currentTab:p?"Full Range":"Custom Range",handleChangeTab:S=>{V(S==null?void 0:S.label),y((S==null?void 0:S.label)==="Full Range")},wrapStyle:{w:"100%",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"12px",gap:"4px"},itemStyle:{flex:"1",h:"32px",p:"8px",borderRadius:"8px",fontSize:"14px"}}),e.jsxs(he,{mt:"4px",position:"relative",flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(qe,{title:"Min Price",perText:$,data:o,direct:_,loading:!1,handleAddPrice:S=>L("Add",S),handleSubPrice:S=>L("Sub",S),setTickDataBasedOnPrice:b,isFullRange:re}),e.jsx(qe,{title:"Max Price",perText:$,data:s,direct:_,loading:!1,handleAddPrice:S=>L("Add",S),handleSubPrice:S=>L("Sub",S),setTickDataBasedOnPrice:f,isFullRange:re}),!+x&&!p&&e.jsx(ke,{position:"absolute",top:"0px",left:"0",h:"80px",borderRadius:"12px",text:""}),z&&!+x&&!p&&e.jsx(ke,{position:"absolute",top:"88px",left:"0",h:"80px",borderRadius:"12px",text:""})]}),!p&&Y&&!M&&e.jsx(ee,{w:"100%",p:"8px 16px",borderRadius:"8px",bg:"primary_yellow_opacity.10",children:e.jsx(C,{fontSize:"12px",lineHeight:"16px",color:"primary_yellow",children:"To create a new pool, the initial price you set must be within your price range."})}),!p&&M&&e.jsx(ee,{h:"28px",lineHeight:"28px",p:"0 16px",w:"100%",borderRadius:"8px",bg:"primary_red_opacity.10",children:e.jsx(C,{fontSize:"12px",color:"primary_red",children:"The max price should be higher than min price."})}),e.jsx(te,{mt:"4px",w:"100%",onClick:i,disabled:!x||!+x||!o.price||!s.price||Y||M,h:"48px",fontSize:"16px",borderRadius:"12px",children:!x||!+x?"Enter initial price":"Continue"})]})]}):e.jsx(ft,{onEdit:l,children:e.jsxs(B,{gap:"12px",align:"flex-start",children:[e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Initial Price"}),e.jsx(C,{color:"text_caption",fontWeight:"500",children:`${Ce(x,18)} ${$}`})]}),e.jsxs(O,{children:[e.jsx(C,{whiteSpace:"nowrap",children:"Price Range"}),e.jsxs(C,{color:"text_caption",fontWeight:"500",children:[p?"0 - âˆž":`${v?o.displayReversePrice:o==null?void 0:o.displayPrice} - ${v?s==null?void 0:s.displayReversePrice:s==null?void 0:s.displayPrice} `," ",`${$}`," "]})]})]})}):null})}function tr({currentStep:h,handleStepClick:g}){const{isApp:u}=dt();return e.jsxs(he,{flexDir:{base:"row",lg:"column"},gap:"12px",flex:{base:"1",lg:"0 0 258px"},w:{base:"100%",lg:"258px"},p:{base:"12px",lg:"32px"},justify:"center",align:{base:"center",lg:"flex-start"},bg:"bg_fifth",borderRadius:"12px",children:[e.jsx(We,{step:1,title:"Select token & fee tier",isActive:h>=1,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx($e,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(We,{step:2,title:"Set initial price & range",isActive:h>=2,handleStepClick:g}),e.jsx(ee,{w:"32px",h:{base:"1px",lg:"32px"},children:e.jsx($e,{orientation:u?"horizontal":"vertical",ml:{base:"0",lg:"16px"}})}),e.jsx(We,{step:3,title:"Enter deposit amounts",isActive:h>=3})]})}function We({step:h,title:g,isActive:u,handleStepClick:l}){return e.jsxs(O,{w:{base:"32px",lg:"100%"},cursor:l&&u?"pointer":"unset",onClick:()=>{l&&u&&l(h)},children:[e.jsx(ee,{as:"div",flex:"0 0 32px",h:"32px",lineHeight:"32px",textAlign:"center",border:"1px solid",fontSize:"12px",fontWeight:"500",color:u?"text_highlight":"text_paragraph",borderColor:"border",borderRadius:"8px",bg:u?"primary_disabled":"transparent",children:h}),e.jsxs(B,{align:"flex-start",display:{base:"none",lg:"flex"},children:[e.jsxs(C,{fontSize:"14px",color:u?"text_caption":"text_paragraph",fontWeight:"500",children:["Step Â ",h]}),e.jsx(C,{fontSize:"12px",color:u?"primary":"text_paragraph",fontWeight:"500",children:g})]})]})}function rr(){const h=(i,t,r,x,n)=>{const o=r.decimals,b=x.decimals;let s;Math.abs(i)==Math.abs(J.getMinIndex(n))?s=t==="lower"?"0":"âˆž":s=k.tickIndexToPrice(i,o,b).toString();const f=s==="âˆž"?"âˆž":ne(s,6).toString(),p=Pe(s),v=p==="âˆž"?"âˆž":ne(p,6).toString();return{id:t,tokenA:r,tokenB:x,tick:i,price:s,displayPrice:f,reversePrice:p,displayReversePrice:v,tickSpacing:n.toString(),pool:"1"}},g=(i,t)=>{const r=i.tokenA,x=i.tokenB;if(!r||!x||t.length===0)return;let n,o="";if(t==="âˆž")n=J.getMaxIndex(Number(i.tickSpacing)),o="âˆž";else if(G(t).equals(0))n=J.getMinIndex(Number(i.tickSpacing)),o="0";else if(G(t).gt(0)){const p=k.priceToTickIndex(G(t),r.decimals,x.decimals);n=Ie(Number(p),Number(i.tickSpacing)),o=k.tickIndexToPrice(Number(n),r.decimals,x.decimals).toString()}const b=o==="âˆž"?"âˆž":ne(o,6),s=Pe(o),f=s==="âˆž"?"âˆž":ne(s,6);if(n!==void 0)return{...i,tick:n,price:o,displayPrice:b.toString(),reversePrice:s,displayReversePrice:f.toString()}},u=(i,t="Add")=>{const{tokenA:r,tokenB:x,tick:n,tickSpacing:o}=i;if(r&&x&&o){const b=t==="Add"?G(n).add(o).toNumber():G(n).sub(o).toNumber();if(G(b).gt(J.getMaxIndex(Number(i.tickSpacing)))||G(b).lt(J.getMinIndex(Number(i.tickSpacing))))return;const s=k.tickIndexToPrice(b,r.decimals,x.decimals).toString(),f=s==="âˆž"?"âˆž":ne(s,6);if(f===i.displayPrice){const p=Number(i.tickSpacing)<20?40:1;return u({...i,tick:t==="Add"?G(n).add(Number(o)*p).toNumber():G(n).sub(Number(o)*p).toNumber()},t)}else{const p=Pe(s),v=p==="âˆž"?"âˆž":ne(p,6);return{id:i.id,tick:b,price:s.toString(),displayPrice:f.toString(),reversePrice:p.toString(),displayReversePrice:v.toString(),tokenA:r,tokenB:x,tickSpacing:o,pool:"1"}}}};return{calcInitPriceRange:(i,t,r,x,n,o,b)=>{console.log("ðŸš€ ~ file: useCreatePriceRange.ts:84 ~ useCreatePriceRange ~ calcInitPriceRange:",{tickSpacing:r,baseToken:x,quoteToken:n});try{if(r&&x&&n){const s=J.getMaxIndex(r),f=J.getMinIndex(r);if(i){const p={id:"lower",tokenA:x,tokenB:n,tick:f,price:"0",displayPrice:"0",reversePrice:"âˆž",displayReversePrice:"âˆž",tickSpacing:r.toString(),pool:new Date().getTime().toString()},v={id:"upper",tokenA:x,tokenB:n,tick:s,price:"âˆž",displayPrice:"âˆž",reversePrice:"0",displayReversePrice:"0",tickSpacing:r.toString(),pool:new Date().getTime().toString()};if(t&&+t){const y=k.priceToTickIndex(G(t),x.decimals,n.decimals);return{minData:p,maxData:v,currTick:y}}return{minData:p,maxData:v,currTick:void 0}}else if(t&&+t){const p=k.priceToTickIndex(G(t),x.decimals,n.decimals),v=o||Ie(Number(p-r*5),Number(r));v<f&&(o=f);const y=b||Ie(Number(p+r*5),Number(r));y>s&&(b=s);const E=h(v,"lower",x,n,r),L=h(y,"upper",x,n,r);return{minData:E,maxData:L,currTick:p}}}}catch(s){console.log("ðŸš€ ~ file: useCreatePriceRange.ts:228 ~ useCreatePriceRange ~ error:",s)}},handleActionPrice:u,updateTickDataBasedOnPrice:g}}function ir(){ut();const{base:h,quote:g,fee:u}=Ft(),{tokenInfo:l}=et(h),{tokenInfo:i}=et(g),[t,r]=d.useState(void 0),[x,n]=d.useState([]),[o,b]=d.useState(1),[s,f]=d.useState(0),{signAndExecuteTransaction:p,transactionConfirmation:v,transactionRejected:y}=Zt(),{fetchAccountBalance:E}=gt(),{preAddPool:L,fetchFeeTierList:H,getCreatePoolTxPayload:V}=Ut(),{quoteWhiteTokenList:z}=$t(),[a,$]=d.useState(),[_,Y]=d.useState(),[M,re]=d.useState(!0);d.useEffect(()=>{E()},[]);const S=d.useMemo(()=>{if(!(a&&_&&be(a,z)&&be(_,z))&&!(!a&&!_)&&!(a&&!_&&be(a,z))&&!(_&&!a&&be(_,z)))return[...z]},[a==null?void 0:a.coin_type,_==null?void 0:_.coin_type,z]),[A,Q]=d.useState(),[I,Z]=d.useState(),[N,ie]=d.useState(""),[U,se]=d.useState(!0),[R,ce]=d.useState({}),[P,le]=d.useState({}),[ge,ae]=d.useState(),[_e,fe]=d.useState(void 0),F=d.useMemo(()=>A&&I?Pt(Xe(A.coin_type),Xe(I.coin_type)):!1,[A,I]),[me,Se]=d.useState(void 0),{calcInitPriceRange:ve,handleActionPrice:Ae,updateTickDataBasedOnPrice:Re}=rr(),[D,X]=d.useState(""),[pe,je]=d.useState("");d.useEffect(()=>{$(l),Q(l),Z(i||Me.sui_coin),Y(i||Me.sui_coin)},[l==null?void 0:l.coin_type,i==null?void 0:i.coin_type]),d.useEffect(()=>{Le()},[a==null?void 0:a.coin_type,_==null?void 0:_.coin_type]);const Le=()=>{var c;a&&_?H(a.coin_type,_.coin_type).then(j=>{n(j);const m=j.filter(K=>K.poolAddress===void 0),w=m.find(K=>K.feeRate===u)||m.find(K=>K.feeRate==="25")||(m.length>0?m[0]:void 0)||(j.length>0?j[0]:void 0);w&&Ee(w)}):(n((c=Bt)==null?void 0:c.map(j=>({...j,title:""}))),r(void 0))},mt=(c,j=!0)=>{De(1),j?($(c),Q(c),Z(_),(c==null?void 0:c.coin_type)===(_==null?void 0:_.coin_type)&&(Y(void 0),Z(void 0))):(Y(c),Z(c),Q(a),(c==null?void 0:c.coin_type)===(a==null?void 0:a.coin_type)&&($(void 0),Q(void 0)))},Ee=c=>{r(c),b(1),_t(),q(!0)},St=()=>{const c=A;if(Q(I),Z(c),+N){const m=at(G(1).div(N).toFixed(18),18,!0).toString();ie(m)}};d.useEffect(()=>{He(U)},[N,t==null?void 0:t.tickSpacing]);const He=(c,j,m)=>{oe();const w=ve(c,N&&+N?F?(1/Number(N)).toString():N:"",Number((t==null?void 0:t.tickSpacing)||0),F?I:A,F?A:I,j,m);console.log("ðŸš€ ~ handleInitPriceRange ~ data:",w),w?(le(w.maxData),ce(w.minData),ae(w.currTick)):ae(void 0)};d.useMemo(()=>{if(t&&A&&I)return k.tickIndexToPrice(J.getMaxIndex(20),6,6).toFixed(9,Wt.ROUND_DOWN)},[t==null?void 0:t.tickSpacing,A==null?void 0:A.decimals,I==null?void 0:I.decimals]);const jt=c=>{ie(c)},q=(c,j,m)=>{se(c),oe(),He(c,j,m)},Ve=d.useMemo(()=>U?R:F?P:R,[U,R,P,F]),Ue=d.useMemo(()=>U?P:F?R:P,[U,R,P,F]),bt=(c,j)=>{oe();const m=Ae(j,c);m&&((m==null?void 0:m.id)===(R==null?void 0:R.id)?ce(m):le(m))},Ct=Yt(U),wt=(c,j,m)=>{const w=Re(c,j);if(w){w.pool=new Date().getTime().toString();let K=R==null?void 0:R.tick,T=P==null?void 0:P.tick;w.id==="lower"?(ce({...w}),K=w.tick):(le({...w}),T=w.tick),K!==void 0&&T!==void 0&&t?Ct&&(J.getMaxIndex(Number(t.tickSpacing))!==T||J.getMinIndex(Number(t.tickSpacing))!==K?q(!1):q(!0)):q(!1,K,T)}else q(!1)},yt=(c,j)=>{re(j),j?X(c):je(c);const m=Ge(c,j);m?(Se(m),j?je(F?m.coinAmountA:m.coinAmountB):X(F?m.coinAmountB:m.coinAmountA)):(j?je(""):X(""),Se(void 0))},De=c=>{console.log("ðŸš€ ~ file: useCreatePool.ts:288 ~ handleStepClick ~ step:",c,o,s),c===1?(b(1),f(1),ie(""),q(!0),oe()):c===2?(b(2),f(2),oe()):(b(3),f(3))},Ge=(c,j,m)=>{if(I&&A&&N&&t&&c&&+c&&(R!=null&&R.price)&&(P!=null&&P.price))try{const w=L({realTokenA:F?I:A,realTokenB:F?A:I,needReverse:R.tokenA.coin_type!==A.coin_type,tickSpacing:Number(t.tickSpacing),amount:c,amountCoinType:j?A.coin_type:I.coin_type,maxPrice:U?P.price:F?R.reversePrice:P.price,minPrice:U?R.price:F?P.reversePrice:R.price,price:F?G(1).div(N).toString():N});return console.log("ðŸš€ ~ file: useCreatePool.ts:212 ~ handleAmountChange ~ res:",w),w}catch(w){console.log("ðŸš€ ~ file: useCreatePool.ts:240 ~ preCalcAddPool ~ error:",w)}};Kt(()=>{const c=Ge("1",!0);if(c){const j=ht(c==null?void 0:c.coinAmountA,c==null?void 0:c.coinAmountB,F?(1/Number(N)).toString():N,U);console.log("ðŸš€ ~ file: useCreatePool.ts:273 ~ useCreatePool ~ perMap:",j),fe(j)}else fe(void 0)},[N,R.tick,P.tick,U,F,t==null?void 0:t.tickSpacing],{wait:500});const _t=()=>{ie(""),oe(),se(!0)},oe=()=>{X(""),je("")};return{baseToken:a,quoteToken:_,handleSelectTokenChange:mt,displayQuoteWhiteTokenList:S,feeTier:t,setFeeTier:r,feeTierList:x,currentStep:o,editStep:s,setCurrentStep:b,setEditStep:f,displayBaseToken:A,displayQuoteToken:I,handleSwitchDirectionChange:St,initPrice:N,handleInitPriceChange:jt,isFullRange:U,handleRangeModeChange:q,minTickData:R,maxTickData:P,isReverse:F,handleFeeTierChange:Ee,handlePriceAction:bt,baseAmount:D,quoteAmount:pe,handleAmountChange:yt,getConfirmData:()=>({isReverse:F,baseToken:A,quoteToken:I,baseAmount:D,quoteAmount:pe,minPrice:Ve,maxPrice:Ue,initPrice:N,feeDisplay:t.feeDisplay,isFullRange:U}),handleCreateAction:async()=>{const c=R.tokenA;R.tokenB,c.coin_type,M?A.coin_type:I.coin_type;const j={getShowInfo:(m,w)=>{const K=W(A==null?void 0:A.symbol),T=W(I==null?void 0:I.symbol),Be=`Add ${de(D)} ${K} and ${de(pe)} ${T}`,xe={modalDescriptionText:Be,toastTitleText:Be};if(m==="success"){let Ke=D,Ye=pe;w&&(Ke=Qe(w,A)||D,Ye=Qe(w,I)||pe);const Ze=`Add ${de(Ke)} ${K} and ${de(Ye)} ${T}`;xe.toastDescriptionContent=Ze,xe.modalDescriptionText=Ze,xe.toastTitleText="Create Success"}return m==="rejected"&&(xe.toastTitleText="Create pool"),xe}};v(j);try{const m=await V(me),w=await p(m,j,{showSuccessModal:!1,useDevInspect:!0,txAction:"signAndExecuteTransactionBlock"});if(console.log("ðŸš€ ~ handleCreateAction ~ res:",w),w)return E(),Le(),De(1),t.feeDisplay}catch(m){console.log("ðŸš€ ~ file: useCreatePool.ts:341 ~ handleCreateAction ~ error:",m),y(j)}},percentMap:_e,currTick:ge,displayMinPrice:Ve,displayMaxPrice:Ue,handleTickPriceChange:wt,handleStepClick:De,fetchFeeTierList:H}}function Zr(){const h=ut(),{baseToken:g,quoteToken:u,feeTier:l,currentStep:i,setCurrentStep:t,editStep:r,setEditStep:x,feeTierList:n,handleSelectTokenChange:o,displayQuoteWhiteTokenList:b,displayBaseToken:s,displayQuoteToken:f,handleSwitchDirectionChange:p,initPrice:v,handleInitPriceChange:y,isFullRange:E,handleRangeModeChange:L,handleTickPriceChange:H,isReverse:V,handleFeeTierChange:z,handlePriceAction:a,baseAmount:$,quoteAmount:_,handleAmountChange:Y,getConfirmData:M,handleCreateAction:re,percentMap:S,currTick:A,displayMinPrice:Q,displayMaxPrice:I,handleStepClick:Z,fetchFeeTierList:N}=ir(),{currentAccount:ie,onWalletModal:U}=xt(),{isOpen:se,onOpen:R,onClose:ce}=Fe(),{isOpen:P,onOpen:le,onClose:ge}=Fe(),{isOpen:ae,onOpen:_e,onClose:fe}=Fe(),{fetchAccountBalance:F}=gt(),[me,Se]=d.useState(),ve=()=>{g&&u&&l&&h(`/liquidity?tab=deposit&poolAddress=${l==null?void 0:l.poolAddress}`,{replace:!0})},Ae=()=>({baseToken:s,quoteToken:f,feeDisplay:me}),Re=()=>{g&&u&&N(g.coin_type,u.coin_type),F()};return e.jsxs(B,{w:"814px",align:"flex-start",gap:"20px",mt:"20px",children:[e.jsxs(O,{w:"100%",justifyContent:"space-between",children:[e.jsxs(te,{variant:"outline",h:"32px",onClick:()=>h("/pools"),p:"0 12px",borderRadius:"8px",bg:"background",children:[e.jsx(ye,{xlinkHref:"#icon-icon_descending",transform:"rotate(90deg)"}),e.jsx(C,{fontSize:"12px",children:"Back"})]}),e.jsx(Jt,{handleRefresh:Re,w:"32px",h:"32px",borderRadius:"8px",bg:"background",innerStyle:{bg:"background"}})]}),e.jsxs(he,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",align:"flex-start",children:[e.jsx(tr,{currentStep:i,handleStepClick:Z}),e.jsxs(B,{w:"100%",gap:"16px",children:[e.jsx(Tt,{editStep:r,currentStep:i,onEdit:()=>{Z(1)},onContinue:()=>{l&&(l.poolAddress?R():Z(2))},baseToken:g,onBaseTokenChange:D=>o(D,!0),quoteToken:u,onQuoteTokenChange:D=>o(D,!1),feeTier:l,feeTierList:n,quoteWhiteTokenList:b,onFeeTierChange:D=>z(D),fromSource:"createPool"}),e.jsx(er,{editStep:r,currentStep:i,onEdit:()=>Z(2),onContinue:()=>{Z(3)},displayBaseToken:s,displayQuoteToken:f,initPrice:v,currTick:A,isReverse:V,onInitPriceChange:D=>y(D),handlePriceAction:a,displayMinPrice:Q,onMinPriceChange:(D,X)=>{H(D,X,!0)},displayMaxPrice:I,onMaxPriceChange:(D,X)=>{H(D,X,!1)},handleSwitchDirectionChange:p,isFullRange:E,handleRangeModeChange:L}),e.jsx(qt,{currentStep:i,editStep:r,onCreate:()=>{ie?le():U(!0)},percentMap:S,baseToken:s,quoteToken:f,baseAmount:$,quoteAmount:_,onBaseAmountChange:D=>Y(D,!0),onQuoteAmountChange:D=>Y(D,!1),isReverse:V})]})]}),se&&e.jsx(Nt,{title:"This Pool already exists",subTitle:"Do you want to provide liquidity?",btnText:"Add liquidity",isOpen:se,onClose:ce,onConfirm:ve}),P&&e.jsx(Xt,{isOpen:P,onClose:ge,onSubmit:async()=>{ge();const D=await re();D&&(Se(D),_e())},data:M()}),ae&&me&&e.jsx(Mt,{isOpen:ae,onClose:fe,data:Ae()})]})}export{Zr as default};
