import{a as A,j as a,H as o,C as K,I as Z,T as j,f as O,P as D,h as f,p as F,k as I,m as ee,n as ae,V as C,ak as se,q as B,R as re}from"./vendor-BowHGuwE.js";import{u as te}from"./useTransaction-B4uWKcuY.js";import{u as le}from"./useAccountBalance-DQPZ-D5d.js";import{k as ce,J as Q,K as W,r as xe,R as H,d as de,a as q,z as G,n as ne,$ as T,I as me}from"./index-YuqJEnbb.js";import{M as R}from"./msafe-oYBkW7LJ.js";import{u as E,b as ge,a as ue}from"./usePositionList-amHHenxr.js";import{S as U}from"./SingleTokenInfo-CKEiUr26.js";import{u as he}from"./useToken-BrDEFOtQ.js";import{P as ye}from"./PositionStatus-_qOmIGIw.js";import{R as ie}from"./RangeValue-CxrttgBG.js";function oe(){const e=ce("farms");return{getStakeTxPayload:async(s,m)=>{const l={pool_id:m,clmm_position_id:s},n=await e.Farms.depositPayload(l),t={action:R.FarmingStake,txbParams:l};return{tx:n,msafeParams:t}},getUnstakeTxPayload:async(s,m)=>{const l={pool_id:s,position_nft_id:m},n=await e.Farms.withdrawPayload(l),t={action:R.FarmingUnstake,txbParams:l};return{tx:n,msafeParams:t}},getHarvestFarmsTxPayload:async(s,m,l)=>{const n={pool_id:s,position_nft_id:m},t=await e.Farms.harvestPayload(n,l),w={action:R.FarmingHarvest,txbParams:n};return{tx:t,msafeParams:w}},getBatchHarvestFarmsTxPayload:async s=>({tx:await e.Farms.batchHarvestPayload(s),msafeParams:{action:"FarmingBatchHarvest",txbParams:s}})}}function je(){const{getBatchHarvestFarmsTxPayload:e,getStakeTxPayload:c,getUnstakeTxPayload:d,getHarvestFarmsTxPayload:k}=oe(),{signAndExecuteTransaction:g}=te(),[s,m]=A.useState(!1),[l,n]=A.useState(!1),{fetchAccountBalance:t}=le();return{toStakePos:async(y,S,u,i)=>{n(!0);try{const{tx:h,msafeParams:p}=await c(y,S);console.log("ðŸš€ ~ toStakePos ~ tx:",h);const x=await g(h,{getShowInfo:()=>({modalDescriptionText:`Stake ${u}`,toastTitleText:"Stake"})},{msafeParams:p});x&&(console.log("ðŸš€ ~ toStakePos ~ res:",x),i(x.events)),n(!1)}catch(h){console.log("ðŸš€ ~ toStakePos ~ error:",h),n(!1)}},toUnStakePos:async(y,S,u,i)=>{n(!0);try{const{tx:h,msafeParams:p}=await d(S,y);console.log("ðŸš€ ~ toUnstack ~ tx:",h);const x=await g(h,{getShowInfo:()=>({modalDescriptionText:`Unstake ${u}`,toastTitleText:"Unstake"})},{msafeParams:p});console.log("ðŸš€ ~ toUnStakePos ~ res:",x),x&&(t(),i()),n(!1)}catch(h){console.log("ðŸš€ ~ toUnStakePos ~ error:",h),n(!1)}},toClaimPos:async(y,S,u)=>{m(!0);try{const{tx:i,msafeParams:h}=await k(S,y);console.log("ðŸš€ ~ toClaimPos ~ tx:",i);const p=await g(i,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimPos ~ res:",p),p&&(t(),u()),m(!1)}catch(i){m(!1),console.log("ðŸš€ ~ toClaimPos ~ error:",i)}},toClaimAllPos:async(y,S)=>{m(!0);try{const u=[];y.forEach(x=>{x!=null&&x.farmsPool&&u.push({pool_id:x.farmsPool,position_nft_id:x.id})}),console.log("ðŸš€ ~ list.forEach  toClaimAllPos ~ params:",u);const{tx:i,msafeParams:h}=await e(u);console.log("ðŸš€ ~ toClaimAllPos ~ tx:",i);const p=await g(i,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimAllPos ~ res:",p),p&&setTimeout(async()=>{t(),S()},2e3),m(!1)}catch(u){m(!1),console.log("ðŸš€ ~ toClaimAllPos ~ error:",u)}},claimLoading:s,unstakeLoading:l}}const ke="/images/burn-lock.png",pe=()=>a.jsx(o,{w:"20px",h:"20px",onClick:e=>{W(e)},children:a.jsx(Q,{placement:"top",tooltip:a.jsx(j,{fontSize:"12px",children:"Liquidity that is permanently locked"}),children:a.jsx(K,{children:a.jsx(Z,{w:"100%",h:"100%",src:ke})})})}),we=({positionInfo:e,haveTooltip:c=!0,isPosList:d=!1,...k})=>{var v,L;const{getTokenAmountValue:g}=xe(),{posLiquidityData:s,posLiquidityDataLoading:m}=E(),l=s[e==null?void 0:e.posId],n=g((v=e==null?void 0:e.displayTokenA)==null?void 0:v.coin_type,l==null?void 0:l.displayCoinAmountA,"--"),t=g((L=e==null?void 0:e.displayTokenB)==null?void 0:L.coin_type,l==null?void 0:l.displayCoinAmountB,"--"),w=A.useMemo(()=>n!=="--"&&t!=="--"?H(de(n).plus(t).toString(),2):"$--",[n,t]),{isApp:_}=q();return a.jsxs(o,{gap:"4px",children:[(e==null?void 0:e.posType)=="burn"&&a.jsx(pe,{}),a.jsx(O,{p:"12px 0",onClick:y=>W(y),children:a.jsxs(D,{isLazy:!0,trigger:_?"click":"hover",placement:"top-start",children:[a.jsx(f,{children:a.jsx(K,{as:"button",cursor:c?"help":"text",children:a.jsx(F,{isLoaded:!!w&&!!s,children:a.jsx(j,{color:"text_caption",fontSize:"16px",textDecoration:d||!c?"none":"underline dotted",textUnderlineOffset:"3px",...k,children:w})})})}),c&&a.jsx(I,{children:a.jsx(ee,{zIndex:"2",minW:"unset",w:"unset",p:"4px ",children:a.jsx(ae,{borderRadius:"12px",p:"8px",children:a.jsxs(C,{align:"flex-start",minW:"200px",children:[a.jsxs(o,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[a.jsx(U,{token:e==null?void 0:e.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),a.jsxs(C,{align:"flex-end",gap:"4px",children:[a.jsx(j,{fontSize:"12px",color:"text_caption",children:G(l==null?void 0:l.displayCoinAmountA)}),a.jsx(j,{fontSize:"12px",children:H(n,2)})]})]}),a.jsxs(o,{w:"100%",justify:"space-between",children:[a.jsx(U,{token:e==null?void 0:e.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),a.jsxs(C,{align:"flex-end",gap:"4px",children:[a.jsx(j,{fontSize:"12px",color:"text_caption",children:G(l==null?void 0:l.displayCoinAmountB)}),a.jsx(j,{fontSize:"12px",children:H(t,2)})]})]})]})})})})]})})]})};function be({positionInfo:e,symbolEllipsesDecimals:c=0,labelInfo:d,children:k}){const{posPoolsRelatedData:g}=E(),s=g[e==null?void 0:e.posId],m=(s==null?void 0:s.currentStatus)=="Active",{isApp:l}=q();return a.jsx(O,{w:{base:"100%",lg:"480px"},maxW:{base:"100%",lg:"480px"},children:a.jsx(o,{maxW:"100%",display:"inline-block",w:{base:"100%",lg:"unset"},borderRadius:"12px",bg:"position_status_bg",pr:"16px",children:a.jsxs(o,{w:"100%",children:[a.jsx(ye,{isActive:m,isLoading:(s==null?void 0:s.currentStatus)==""}),a.jsxs(C,{align:"flex-start",gap:"4px",children:[a.jsxs(o,{children:[a.jsx(F,{isLoaded:!!(d!=null&&d.text),children:a.jsx(j,{fontSize:"12px",color:"primary_gray",...d==null?void 0:d.style,children:d==null?void 0:d.text})}),!l&&k]}),a.jsx(ie,{symbolEllipsesDecimals:c,displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,priceInfo:{minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,minPriceResever:s==null?void 0:s.minPriceResever,maxPriceResever:s==null?void 0:s.maxPriceResever}}),l&&k]})]})})})}function He({positionInfo:e,apiInfo:c}){var M,$;const{farmsPosRewardsData:d,posPoolsRelatedData:k,posPoolsOriginalData:g}=E(),{getPositionBaseList:s,getPosRelatedData:m}=ge(),{currentAccount:l}=ne(),{isApp:n}=q(),t=d[e==null?void 0:e.id],w=t==null?void 0:t.reduce((r,b)=>r+b.display_amount_owed,0),_=k[e==null?void 0:e.posId],v=(_==null?void 0:_.currentStatus)=="Active",{getClmmPosName:L}=ue(),y=A.useMemo(()=>{var r;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const b=(r=g==null?void 0:g[e==null?void 0:e.clmmPool])==null?void 0:r.index;return L(e==null?void 0:e.index,b)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,g]),S=se(),u=()=>{setTimeout(async()=>{const r=await s(l==null?void 0:l.address);m(r,!0)},2e3)},{toStakePos:i,toUnStakePos:h,toClaimPos:p,unstakeLoading:x,claimLoading:P}=je(),X=async r=>{i(e==null?void 0:e.id,c==null?void 0:c.farmsPoolAddress,y,u)},Y=async()=>{h(e==null?void 0:e.id,e==null?void 0:e.farmsPool,y,u)},N=async()=>{p(e==null?void 0:e.id,e==null?void 0:e.farmsPool,u)},z=A.useMemo(()=>(t==null?void 0:t.length)>0?t.reduce((r,b)=>T(r).plus(b==null?void 0:b.display_amount_owed).toString(),"0"):"0",[t,l==null?void 0:l.address,P,x]),V=A.useMemo(()=>e&&c?e.posType=="clmm"&&c.haveFarming===!0:!1,[e==null?void 0:e.posType,c==null?void 0:c.haveFarming]);return a.jsxs(o,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:"12px",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[a.jsx(be,{positionInfo:e,symbolEllipsesDecimals:10,labelInfo:{text:y,style:{color:"text_caption",mb:"-2px"}},children:a.jsxs(o,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:r=>{W(r),S(`/position-detail/${e==null?void 0:e.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[a.jsx(j,{fontSize:"12px",color:"primary",children:"Manage position"}),a.jsx(me,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),a.jsxs(o,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[a.jsxs(C,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsx(j,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),a.jsx(we,{positionInfo:e,fontSize:"14px"})]}),a.jsxs(C,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsxs(o,{gap:"4px",children:[a.jsx(j,{color:"primary_gray",children:"Earnings"}),!n&&a.jsx(B,{isLoading:P,disabled:x||P||T(w).eq(0),onClick:x||P||T(w).eq(0)?()=>{}:N,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),a.jsxs(o,{children:[a.jsx(F,{isLoaded:!!z,children:a.jsx(C,{align:"flex-end",children:t&&(t==null?void 0:t.length)>0&&T(z).gt(0)?t==null?void 0:t.map(r=>{var b;return console.log("ðŸš€ ~ ExpendItem ~ posFarmsData && posFarmsData?.length > 0 && d(totalAmount).gt(0) :",t,(t==null?void 0:t.length)>0,z,T(z).gt(0)),a.jsx(re.Fragment,{children:T(r==null?void 0:r.display_amount_owed).gt(0)&&a.jsx(J,{coinType:(b=r==null?void 0:r.token)==null?void 0:b.coin_type,amount:(r==null?void 0:r.display_amount_owed)||0,tokenInfo:r==null?void 0:r.token},r==null?void 0:r.coinType)},r==null?void 0:r.rewarder_type)}):((M=c==null?void 0:c.farmsRewarderList)==null?void 0:M.length)>0?($=c==null?void 0:c.farmsRewarderList)==null?void 0:$.map(r=>(console.log("ðŸš€ ~ apiInfo?.farmsRewarderList?.map ~ item:",r),a.jsx(J,{coinType:r==null?void 0:r.coinType,amount:"0"},r==null?void 0:r.coinType))):a.jsx(j,{textColor:"text_caption",textAlign:"right",children:"--"})})}),n&&a.jsx(B,{isLoading:P,disabled:x||P||T(w).eq(0),onClick:x||P||T(w).eq(0)?()=>{}:N,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),a.jsxs(C,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(e==null?void 0:e.posType)=="farms"&&a.jsx(B,{disabled:x,isLoading:x,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:Y,children:"Unstake"}),V&&!v&&a.jsx(Q,{placement:"top",tooltip:a.jsx(j,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:a.jsx(B,{disabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),V&&v&&a.jsx(B,{disabled:x,isLoading:x,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:X,children:"Stake"})]})]})]})}const J=({coinType:e,amount:c,tokenInfo:d,boxStyle:k,textAlign:g="right"})=>{const{tokenInfo:s}=he(e);return a.jsxs(o,{...k,children:[a.jsx(U,{token:d||s,coinType:e,imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),a.jsxs(j,{textColor:"text_caption",textAlign:g,children:[c," ",(d==null?void 0:d.symbol)||(s==null?void 0:s.symbol)]})]})};export{He as E,we as L,J as R,je as a,oe as u};
//# sourceMappingURL=ExpendItem-BZoWmDor.js.map
