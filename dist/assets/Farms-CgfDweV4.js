import{a1 as z,r as n,aA as rs,j as e,V as F,T as _,B as N,S as b,$ as X,d as P,a4 as H,a3 as Z,I as is,H as w,a2 as K,b as as}from"./index-D49RffYW.js";import{V as ns}from"./VaultsAndFarmsTabFilter-DmZJOlEB.js";import{u as ds}from"./ExpendItem-Dexzs6Wu.js";import{c as Y,d as O}from"./usePositionList-CyCzZNts.js";import{N as U}from"./NoData-MWQZy93S.js";import{A as xs}from"./index-BVFwDyvF.js";import{V as ms,R as ps,S as hs,T as gs,F as us,a as cs}from"./FarmsTable-BmPDV1jg.js";import{u as js}from"./useGetPoolList-DBJielhS.js";import{u as bs}from"./useAccountBalance-D-weOZgA.js";import{u as fs}from"./useRpcListener-D8tK2rVa.js";import"./RefreshButton-C1kwCG7k.js";import"./SortDropBlock-C63_uO_7.js";import"./useTransaction-i5gFyneH.js";import"./msafe-oYBkW7LJ.js";import"./CetusTooltip-7TnGbJNH.js";import"./SingleTokenInfo-Cvcahm1q.js";import"./AddressCopyLink-BnCAac35.js";import"./AddressUnderline-CPGiMg8E.js";import"./useToken-BlS8b5ft.js";import"./PriceRange-BFhvNGCl.js";import"./PositionStatus-Cy2qCSNc.js";import"./RangeValue-B6IVaqEN.js";import"./api-data-utils-D656F-wl.js";import"./CoinPairInfo-DmtDGhhi.js";import"./tr-ChzXWjY-.js";import"./usePreviousValue-D4m5LJZe.js";function Ls(s){const{totalRewards:d}=s,{currentAccount:l}=z(),{posBaseList:o}=Y(),{getPositionBaseList:g}=O(),{toClaimAllPos:r,claimLoading:u}=ds(),i=n.useRef(null),T=async()=>{l!=null&&l.address&&await g(l==null?void 0:l.address)},f=()=>{r(o,T)};return n.useEffect(()=>{i!=null&&i.current&&(i.current.textContent=rs(d,2))},[d]),e.jsx(F,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(F,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(_,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(_,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(l==null?void 0:l.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(b,{isLoaded:!!d,children:e.jsx(_,{color:"primary",fontSize:"20px",fontWeight:"500",ref:i})})}),(l==null?void 0:l.address)&&e.jsx(X,{isLoading:u,disabled:u||d=="--"?!0:P(d).lte(0),w:"170px",h:"28px",fontSize:"14px",borderRadius:"4px",onClick:f,children:"Claim All Rewards"})]})})}function Ss({dataList:s,showSkeletonLoading:d,currTabLabel:l}){const{currentAccount:o,onWalletModal:g}=z();return e.jsx(e.Fragment,{children:l=="Your Farms"&&!(o!=null&&o.address)?e.jsx(U,{type:"nowallet",onboard:()=>{g(!0)}}):d?e.jsx(ks,{}):s.length===0?e.jsx(U,{type:"nodata",text:"No farms found"}):e.jsx(F,{w:"100%",children:s.map(r=>e.jsx(vs,{apiInfo:r},r==null?void 0:r.poolAddress))})})}const vs=({apiInfo:s})=>{const{getTokenAmountValue:d}=H(),{coinPriceObj:l}=Z(),{currentAccount:o,onWalletModal:g}=z(),[r,u]=n.useState({}),{farmsPosRewardsDataLoading:i,farmsPosRewardsData:T,posBaseListLoading:f,posBaseListGroupByPool:v}=Y(),L=n.useMemo(()=>{var S;if(!(o!=null&&o.address)||!(s!=null&&s.poolAddress))return"--";if(!f&&!i)return(((S=v[s.poolAddress])==null?void 0:S.list)||[]).reduce((p,c)=>{const V=(T[c==null?void 0:c.id]||[]).reduce((A,x)=>{if(A==="--")return"--";const E=d(x==null?void 0:x.token.coin_type,x==null?void 0:x.display_amount_owed,"--");return E==="--"?"--":P(A).plus(E).toString()},"0");return p==="--"||V==="--"?"--":P(p).plus(V).toString()},"0")},[f,T,i,l,o==null?void 0:o.address]),C=n.useMemo(()=>{var j,p;return((p=(j=v==null?void 0:v[s==null?void 0:s.poolAddress])==null?void 0:j.list)==null?void 0:p.filter(c=>c.posType!=="burn").sort((c,m)=>Number(m.liquidity)-Number(c.liquidity)))||[]},[s==null?void 0:s.poolAddress,v]);return e.jsxs(F,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(ms,{apiInfo:s}),e.jsx(B,{label:"Staked TVL",value:e.jsx(_,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(B,{label:"APR",value:e.jsx(xs,{poolInfo:s,isPosition:!0})}),e.jsx(B,{label:"Rewards / day",value:e.jsx(ps,{apiInfo:s})}),e.jsx(B,{label:"Your Staked",value:e.jsx(hs,{apiInfo:s})}),e.jsx(B,{label:"Your Earned",value:e.jsx(gs,{totalEarned:L,apiInfo:s,disabled:L=="--"?!0:P(L).lte(0)})}),e.jsx(X,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{r[s==null?void 0:s.poolAddress]?r[s==null?void 0:s.poolAddress]=!1:r[s==null?void 0:s.poolAddress]=!0,u({...r})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(is,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:r[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),r[s==null?void 0:s.poolAddress]&&e.jsx(us,{expendList:C,apiInfo:s})]})},B=({label:s,value:d})=>e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:s}),d]}),ks=()=>e.jsx(F,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,d)=>e.jsxs(F,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(w,{gap:"0",children:[e.jsx(K,{size:"9"}),e.jsx(K,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(b,{height:"4",width:"150px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(b,{height:"4",width:"120px"}),e.jsx(b,{height:"4",width:"120px"})]})]},d))});function Fs(){const{getPoolList:s}=js();return{getFarmList:async(l="-tvl")=>{var g;const o=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return(g=o==null?void 0:o.list)==null?void 0:g.sort((r,u)=>l==="-apr"?u.feeAndFarmsApr-r.feeAndFarmsApr:l==="apr"?r.feeAndFarmsApr-u.feeAndFarmsApr:l==="-tvl"?u.farmsStatedTvl-r.farmsStatedTvl:r.farmsStatedTvl-u.farmsStatedTvl)}}}function Ds(){var $;const{currentAccount:s}=z(),{getPositionBaseList:d,getPosRelatedData:l}=O(),{posBaseList:o,posBaseListLoading:g,farmsPosRewardsData:r}=Y(),{getFarmList:u}=Fs(),[i,T]=n.useState([]),[f,v]=n.useState([]),[L,C]=n.useState([]),[S,j]=n.useState(!0),[p,c]=n.useState([]);bs();const[m,V]=n.useState({label:"Live"}),A=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[x,E]=n.useState({sortRule:"desc",sortType:"tvl"}),[D,q]=n.useState({label:"TVL",value:"tvl"}),I=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:S?void 0:f.length.toString()}),t.push({label:"Your Farms",num:L.length>0&&(s!=null&&s.address)&&!S?L.length.toString():void 0}),t},[m.label,S,f,L,s==null?void 0:s.address]),G=async()=>{s!=null&&s.address?await d(s==null?void 0:s.address):c([])};n.useEffect(()=>{(o==null?void 0:o.length)>0&&l(o,!0)},[o]);const W=async t=>{const a=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,k=await u(a);k&&T(k)};n.useEffect(()=>{if(i.length>0){if(m.label=="Live"&&(v(i),j(!1)),s!=null&&s.address&&(p==null?void 0:p.length)>0){const t=i.filter(a=>(p==null?void 0:p.filter(h=>(h==null?void 0:h.posType)==="farms")).some(h=>(a==null?void 0:a.poolAddress)===(h==null?void 0:h.clmmPool)));C(t)}else C([]);g||j(!1)}else v([]),C([])},[m.label,i,s==null?void 0:s.address,p,g]),n.useEffect(()=>{W(x),s!=null&&s.address?(j(!0),G()):c([])},[s==null?void 0:s.address]),n.useEffect(()=>{c(o)},[o]);const Q=()=>{j(!0),W(x),G()};fs({onRpcChange:()=>{Q()}});const{fetchTokenPrices:ss}=H(),es=()=>{const t=[];i==null||i.forEach(a=>{var k,h;t.includes(a.tokenA.coin_type)||t.push(a.tokenA.coin_type),t.includes(a.tokenB.coin_type)||t.push(a.tokenB.coin_type),((k=a==null?void 0:a.farmsRewarderList)==null?void 0:k.length)>0&&((h=a==null?void 0:a.farmsRewarderList)==null||h.forEach(y=>{t.push(y==null?void 0:y.coinType)}))}),t.length>0&&ss(Array.from(new Set(t)))};n.useEffect(()=>{(i==null?void 0:i.length)>0&&es()},[i]);const{getTokenAmountValue:ts}=H(),{coinPriceObj:os}=Z(),ls=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!g)return o.reduce((t,a)=>{const h=(r[a==null?void 0:a.id]||[]).reduce((y,R)=>{if(y==="--")return"--";const J=ts(R==null?void 0:R.token.coin_type,R==null?void 0:R.display_amount_owed,"--");return J==="--"?"--":P(y).plus(J).toString()},"0");return t==="--"||h==="--"?"--":P(t).plus(h).toString()},"0")},[g,($=Object.values(r))==null?void 0:$.length,os,s==null?void 0:s.address]),{isApp:M}=as();return e.jsxs(F,{gap:"20px",w:"100%",children:[e.jsx(Ls,{totalRewards:ls}),e.jsx(N,{h:"220px"}),e.jsx(ns,{sortByList:A,currTab:m,tabList:I,handleChangeTab:t=>{V(t)},currSortType:D,onSortByChange:t=>{j(!0),x.sortType=t.value,E({...x}),q(t),W(x)},sortRule:x.sortRule,handleChangeSortRule:t=>{j(!0),x.sortRule=t,E({...x}),W(x)},handleRefresh:Q}),M&&e.jsx(_,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!M&&e.jsx(cs,{dataList:m.label=="Live"?f:L,showSkeletonLoading:S,currTabLabel:m==null?void 0:m.label}),M&&e.jsx(Ss,{dataList:m.label=="Live"?f:L,showSkeletonLoading:S,currTabLabel:m==null?void 0:m.label})]})}export{Ds as default};
