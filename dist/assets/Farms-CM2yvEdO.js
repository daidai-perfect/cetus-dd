import{a1 as z,r as n,aA as rs,j as e,V as k,T as _,B as N,S as f,$ as Z,d as P,H as w,a3 as U,a5 as H,a4 as O,I as is,b as as}from"./index-CrLDUzf4.js";import{V as ns}from"./VaultsAndFarmsTabFilter-CtnPeWY9.js";import{u as ds}from"./ExpendItem-CB2ZjIzH.js";import{c as Y,d as D}from"./usePositionList-C6hCOMJ_.js";import{N as X}from"./NoData-jXyH13JP.js";import{A as xs}from"./index-B8dGYaZb.js";import{V as ms,R as gs,S as ps,T as hs,F as us,a as cs}from"./FarmsTable-Crqg1nta.js";import{u as js}from"./useGetPoolList-DH_ZoZq7.js";import{u as bs}from"./useAccountBalance-CXZi51PX.js";import{u as fs}from"./useRpcListener-DxPF9xu6.js";import"./RefreshButton-CtgwEHuv.js";import"./SortDropBlock-DHF7Pyvh.js";import"./useTransaction-DsGcn4o8.js";import"./msafe-oYBkW7LJ.js";import"./CetusTooltip-BUG0NyC7.js";import"./SingleTokenInfo-D05DhnKv.js";import"./AddressCopyLink-CqSacTr3.js";import"./AddressUnderline-UBqmtWNP.js";import"./useToken-DDK1y6Ol.js";import"./PriceRange-BdvwMxps.js";import"./PositionStatus-CK4NxSmn.js";import"./RangeValue-B1QGXn6d.js";import"./api-data-utils-CbMpbpVK.js";import"./CoinPairInfo-BfDsONRq.js";import"./tr-DcJeayU6.js";import"./usePreviousValue-I2C_cVB5.js";function Ls(s){const{totalRewards:x}=s,{currentAccount:l}=z(),{posBaseList:o}=Y(),{getPositionBaseList:h}=D(),{toClaimAllPos:r,claimLoading:u}=ds(),i=n.useRef(null),T=async()=>{l!=null&&l.address&&await h(l==null?void 0:l.address)},L=()=>{r(o,T)};return n.useEffect(()=>{i!=null&&i.current&&(i.current.textContent=rs(x,2))},[x]),e.jsx(k,{w:"100%",pos:"absolute",alignItems:"start",sx:{backgroundImage:{base:"url('/images/farms_banner_h5.png')",lg:"url('/images/farms.png')"},backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs(k,{minW:"1200px",p:"40px 20px 0",margin:"0px auto",gap:"12px",h:"240px",alignItems:"start",children:[e.jsx(_,{color:"text_caption",fontSize:"28px",fontWeight:"500",children:"Farms"}),e.jsx(_,{fontSize:"16px",children:"Stake your positions to earn higher yield."}),(l==null?void 0:l.address)&&e.jsx(N,{h:"20px",mt:"16px",children:e.jsx(f,{isLoaded:!!x,children:e.jsx(_,{color:"primary",fontSize:"20px",fontWeight:"500",ref:i})})}),(l==null?void 0:l.address)&&e.jsx(Z,{isLoading:u,disabled:u||x=="--"?!0:P(x).lte(0),w:"170px",h:"28px",fontSize:"14px",borderRadius:"4px",onClick:L,children:"Claim All Rewards"})]})})}function Ss({dataList:s,showSkeletonLoading:x,currTabLabel:l}){const{currentAccount:o,onWalletModal:h}=z();return e.jsx(e.Fragment,{children:l=="Your Farms"&&!(o!=null&&o.address)?e.jsx(X,{type:"nowallet",onboard:()=>{h(!0)}}):x?e.jsx(Fs,{}):s.length===0?e.jsx(X,{type:"nodata",text:"No farms found"}):e.jsx(k,{w:"100%",children:s.map(r=>e.jsx(vs,{apiInfo:r},r==null?void 0:r.poolAddress))})})}const vs=({apiInfo:s})=>{const{getTokenAmountValue:x}=H(),{coinPriceObj:l}=O();console.log("ðŸš€ ~ FarmsTableItem ~ apiInfo:",s);const{currentAccount:o,onWalletModal:h}=z(),[r,u]=n.useState({}),{farmsPosRewardsDataLoading:i,farmsPosRewardsData:T,posBaseListLoading:L,posBaseListGroupByPool:v}=Y(),S=n.useMemo(()=>{var c;if(!(o!=null&&o.address)||!(s!=null&&s.poolAddress))return"--";if(!L&&!i)return(((c=v[s.poolAddress])==null?void 0:c.list)||[]).reduce((g,j)=>{const d=T[j==null?void 0:j.id]||[];console.log("ðŸš€ ~ returnposBaseList.reduce ~ posFarmsData:",g,d);const V=d.reduce((A,m)=>{if(A==="--")return"--";const B=x(m==null?void 0:m.token.coin_type,m==null?void 0:m.display_amount_owed,"--");return B==="--"?"--":P(A).plus(B).toString()},"0");return g==="--"||V==="--"?"--":P(g).plus(V).toString()},"0")},[L,T,i,l,o==null?void 0:o.address]),E=n.useMemo(()=>{var b,g;const c=((g=(b=v==null?void 0:v[s==null?void 0:s.poolAddress])==null?void 0:b.list)==null?void 0:g.filter(j=>j.posType!=="burn").sort((j,d)=>Number(d.liquidity)-Number(j.liquidity)))||[];return console.log("ðŸš€ ~ expendList ~ list:",c),c},[s==null?void 0:s.poolAddress,v]);return e.jsxs(k,{gap:"16px",w:"100%",align:"flex-start",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsx(ms,{apiInfo:s}),e.jsx(C,{label:"Staked TVL",value:e.jsx(_,{fontWeight:"500",textColor:"text_caption",textAlign:"right",children:s==null?void 0:s.farmsStatedTvlDisplay})}),e.jsx(C,{label:"APR",value:e.jsx(xs,{poolInfo:s,isPosition:!0})}),e.jsx(C,{label:"Rewards / day",value:e.jsx(gs,{apiInfo:s})}),e.jsx(C,{label:"Your Staked",value:e.jsx(ps,{apiInfo:s})}),e.jsx(C,{label:"Your Earned",value:e.jsx(hs,{totalEarned:S,apiInfo:s,disabled:S=="--"?!0:P(S).lte(0)})}),e.jsx(Z,{w:"100%",h:"40px",borderRadius:"8px",variant:"ghost",onClick:()=>{r[s==null?void 0:s.poolAddress]?r[s==null?void 0:s.poolAddress]=!1:r[s==null?void 0:s.poolAddress]=!0,u({...r})},sx:{_hover:{svg:{fill:"text_caption"}}},children:e.jsx(is,{svgW:"16px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:r[s==null?void 0:s.poolAddress]?"rotate(180deg)":"rotate(0deg)"})}),r[s==null?void 0:s.poolAddress]&&e.jsx(us,{expendList:E,apiInfo:s})]})},C=({label:s,value:x})=>e.jsxs(w,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:s}),x]}),Fs=()=>e.jsx(k,{w:"100%",align:"flex-start",children:[{},{},{}].map((s,x)=>e.jsxs(k,{w:"100%",align:"flex-start",gap:"16px",bg:"bg_fifth",border:"1px solid",borderColor:"border",p:"8px",borderRadius:"12px",children:[e.jsxs(w,{gap:"0",children:[e.jsx(U,{size:"9"}),e.jsx(U,{size:"9"}),e.jsx(N,{w:"4px"}),e.jsx(f,{height:"4",width:"150px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]}),e.jsxs(w,{w:"100%",gap:"4px",ml:"4px",justify:"space-between",children:[e.jsx(f,{height:"4",width:"120px"}),e.jsx(f,{height:"4",width:"120px"})]})]},x))});function ks(){const{getPoolList:s}=js();return{getFarmList:async(l="-tvl")=>{var h;const o=await s({is_vaults:!1,display_all_pools:!1,has_mining:!1,has_farming:!0,no_incentives:!1,order_by:"-vol",limit:100,offset:0});return console.log("ðŸš€ ~ getFarmList ~ res:",o),(h=o==null?void 0:o.list)==null?void 0:h.sort((r,u)=>l==="-apr"?u.feeAndFarmsApr-r.feeAndFarmsApr:l==="apr"?r.feeAndFarmsApr-u.feeAndFarmsApr:l==="-tvl"?u.farmsStatedTvl-r.farmsStatedTvl:r.farmsStatedTvl-u.farmsStatedTvl)}}}function Ds(){var J;const{currentAccount:s}=z(),{getPositionBaseList:x,getPosRelatedData:l}=D(),{posBaseList:o,posBaseListLoading:h,farmsPosRewardsData:r}=Y(),{getFarmList:u}=ks(),[i,T]=n.useState([]),[L,v]=n.useState([]),[S,E]=n.useState([]),[c,b]=n.useState(!0),[g,j]=n.useState([]);bs();const[d,V]=n.useState({label:"Live"}),A=[{label:"APR",value:"apr"},{label:"TVL",value:"tvl"}],[m,B]=n.useState({sortRule:"desc",sortType:"tvl"}),[q,I]=n.useState({label:"TVL",value:"tvl"}),ss=n.useMemo(()=>{const t=[];return t.push({label:"Live",num:c?void 0:L.length.toString()}),t.push({label:"Your Farms",num:S.length>0&&(s!=null&&s.address)&&!c?S.length.toString():void 0}),t},[d.label,c,L,S,s==null?void 0:s.address]),G=async()=>{s!=null&&s.address?(await x(s==null?void 0:s.address),console.log("ðŸš€ ~ getPositionList ~ currentAccount?.address:",s==null?void 0:s.address)):j([])};n.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ posBaseList:",o),(o==null?void 0:o.length)>0&&l(o,!0)},[o]);const W=async t=>{const a=(t==null?void 0:t.sortRule)=="desc"?"-"+(t==null?void 0:t.sortType):t==null?void 0:t.sortType,F=await u(a);F&&T(F)};n.useEffect(()=>{if(console.log("ðŸš€ ~ Farms ~ positionList:",g),i.length>0){if(d.label=="Live"&&(v(i),b(!1)),s!=null&&s.address&&(g==null?void 0:g.length)>0){const t=i.filter(a=>(g==null?void 0:g.filter(p=>(p==null?void 0:p.posType)==="farms")).some(p=>(a==null?void 0:a.poolAddress)===(p==null?void 0:p.clmmPool)));E(t)}else E([]);h||b(!1)}else v([]),E([])},[d.label,i,s==null?void 0:s.address,g,h]),n.useEffect(()=>{W(m),s!=null&&s.address?(b(!0),G()):j([])},[s==null?void 0:s.address]),n.useEffect(()=>{j(o)},[o]);const Q=()=>{b(!0),W(m),G()};fs({onRpcChange:()=>{Q()}});const{fetchTokenPrices:es}=H(),ts=()=>{const t=[];i==null||i.forEach(a=>{var F,p;t.includes(a.tokenA.coin_type)||t.push(a.tokenA.coin_type),t.includes(a.tokenB.coin_type)||t.push(a.tokenB.coin_type),((F=a==null?void 0:a.farmsRewarderList)==null?void 0:F.length)>0&&((p=a==null?void 0:a.farmsRewarderList)==null||p.forEach(y=>{t.push(y==null?void 0:y.coinType)}))}),t.length>0&&es(Array.from(new Set(t)))};n.useEffect(()=>{(i==null?void 0:i.length)>0&&ts()},[i]);const{getTokenAmountValue:os}=H(),{coinPriceObj:ls}=O(),$=n.useMemo(()=>{if(!(s!=null&&s.address))return"--";if(!h)return o.reduce((t,a)=>{const p=(r[a==null?void 0:a.id]||[]).reduce((y,R)=>{if(y==="--")return"--";const K=os(R==null?void 0:R.token.coin_type,R==null?void 0:R.display_amount_owed,"--");return K==="--"?"--":P(y).plus(K).toString()},"0");return t==="--"||p==="--"?"--":P(t).plus(p).toString()},"0")},[h,(J=Object.values(r))==null?void 0:J.length,ls,s==null?void 0:s.address]);console.log("ðŸš€ ~ totalEarned ~ totalEarned:",$);const{isApp:M}=as();return e.jsxs(k,{gap:"20px",w:"100%",children:[e.jsx(Ls,{totalRewards:$}),e.jsx(N,{h:"220px"}),e.jsx(ns,{sortByList:A,currTab:d,tabList:ss,handleChangeTab:t=>{V(t)},currSortType:q,onSortByChange:t=>{b(!0),m.sortType=t.value,B({...m}),I(t),W(m)},sortRule:m.sortRule,handleChangeSortRule:t=>{b(!0),m.sortRule=t,B({...m}),W(m)},handleRefresh:Q}),M&&e.jsx(_,{w:"100%",fontSize:"20px",color:"text_caption",mb:"-8px",children:"Pools"}),!M&&e.jsx(cs,{dataList:d.label=="Live"?L:S,showSkeletonLoading:c,currTabLabel:d==null?void 0:d.label}),M&&e.jsx(Ss,{dataList:d.label=="Live"?L:S,showSkeletonLoading:c,currTabLabel:d==null?void 0:d.label})]})}export{Ds as default};
