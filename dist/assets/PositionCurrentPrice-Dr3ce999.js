import{o as T,G as j,d as g,l as F,V as C,I as v,F as R}from"./index-Fe2tZAmL.js";import{a as D,j as i,H as A,p as E,T as S}from"./vendor-BFGDaAdA.js";import{u as I,d as U}from"./contract-helper-D2BdItFe.js";import{M as B}from"./msafe-oYBkW7LJ.js";import{a as N}from"./usePositionList-CXKX6qAY.js";function V(){const{getTokenAmountValue:b}=T(),_=(l,c,e,t)=>{if(!(l!=null&&l.length))return{total:"0",rewardAndFeeList:[]};let n="0";const u=[];l.forEach(r=>{const f=c[r==null?void 0:r.posId],p=e[r==null?void 0:r.posId]||[],h=t?t[r==null?void 0:r.id]:[],y=p.concat(h);if(f){const s=d(r==null?void 0:r.displayTokenA,f==null?void 0:f.displayFeeOwedA),a=d(r==null?void 0:r.displayTokenB,f==null?void 0:f.displayFeeOwedB);s&&u.push(s),a&&u.push(a),n=x(n,s==null?void 0:s.amountUSD,a==null?void 0:a.amountUSD)}y.forEach(s=>{var a;if(Number(s==null?void 0:s.display_amount_owed)>0){const m=d(s==null?void 0:s.token,s==null?void 0:s.display_amount_owed,(a=s==null?void 0:s.token)==null?void 0:a.coin_type);m&&(u.push(m),n=x(n,m==null?void 0:m.amountUSD))}})});const o=P(u);return console.log("ðŸš€ ~ calculatePendingYield ~  total,:",o,n,o.length==1&&(n=="--"||Number(n)==0)),{total:(o==null?void 0:o.length)>0&&Number(n)==0?"--":n,rewardAndFeeList:o}},d=(l,c,e)=>{if(!l||!c)return null;const t=e||l.coin_type;if(!t)return null;const n=b(t,c);return{coin_address:j(t,!1),amount:c,amountUSD:g(c).gt(0)&&g(n).lte(0)?"--":n,token:l}},x=(l,...c)=>{let e=g(l);return c.forEach(t=>{t&&t!=="--"&&e!=="--"&&(e=e.plus(t))}),e.toString()},P=l=>{const c={};return l.forEach(e=>{var o,r;const{coin_address:t,amount:n,amountUSD:u}=e;c[t]||(c[t]={...e,amount:"0",amountUSD:"0"}),u=="--"?c[t].amountUSD="--":c[t].amountUSD=c[t].amountUSD=="--"?"--":g((o=c[t])==null?void 0:o.amountUSD).plus(u||0).toString(),c[t].amount=g((r=c[t])==null?void 0:r.amount).plus(n||0).toString()}),Object.values(c).filter(e=>Number(e.amount)>0).sort((e,t)=>g(t.amountUSD=="--"?0:t.amountUSD).minus(e.amountUSD=="--"?0:e.amountUSD).toNumber())};return{calculatePendingYield:_}}function q(){const b=F("clmm"),_=F("farms"),d=F("burn"),{getBurnClaimTxPayload:x}=I();return{getPosClaimFeeAndRewardTxPayload:async c=>{const{posType:e,id:t,clmmPool:n,coinTypeA:u,coinTypeB:o,rewarderCoinTypes:r,account:f}=c;let p,h;if(e==="clmm"){const y={pool_id:n,pos_id:t,rewarder_coin_types:r,coin_type_a:u,coin_type_b:o,collect_fee:!0};p=await b.Rewarder.collectRewarderPayload(y),h={action:B.ClaimFeeAndMining,txbParams:y}}else if(e==="farms"){const y={coin_type_a:u,coin_type_b:o,clmm_pool_id:n,position_nft_id:t,clmm_rewarder_types:r,collect_fee:!0};p=await _.Farms.claimFeeAndClmmReward(y),h={action:"FarmingClaimFeeAndReward",txbParams:y}}else e==="burn"&&(p=x({poolAddress:n,posId:t,coinTypeA:u,coinTypeB:o,account:f,rewarderCoinTypes:r}));return{tx:p,msafeParams:h}},getBatchHarvestFeeAndRewardsTxPayload:async(c,e,t)=>{console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ posBaseList:",c,e,t);const n=[],u=[],o=[],r=[];c.forEach(a=>{var w;const m=((w=e[a.posId])==null?void 0:w.map(H=>H.coin_address))||[];console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ rewarderCoinTypes:",m),a.posType=="clmm"?n.push({pool_id:a.clmmPool,pos_id:a.id,collect_fee:!0,rewarder_coin_types:m,coin_type_a:U(a.coinTypeA),coin_type_b:U(a.coinTypeB)}):a.posType=="farms"?(u.push({pool_id:a.farmsPool||"",position_nft_id:a.id,clmm_pool_id:a.clmmPool,collect_fee:!0,collect_farms_rewarder:!1,clmm_rewarder_types:m,coin_type_a:a.coinTypeA,coin_type_b:a.coinTypeB}),r.push({pool_id:a.farmsPool||"",position_nft_id:a.id})):o.push({pos_id:(a==null?void 0:a.id)||"",pool_id:a.clmmPool,coin_type_a:a.coinTypeA,coin_type_b:a.coinTypeB,rewarder_coin_types:m,account:t})});const f=await _.Farms.batchHarvestAndClmmFeePayload(u,n),p=[];for(let a=0;a<o.length;a++){const m=o[a];(m==null?void 0:m.rewarder_coin_types.length)>0&&p.push(m)}const h=d.Burn.createCollectFeesPayload(o,f),y=d.Burn.crateCollectRewardsPayload(p,h),s=await _.Farms.batchHarvestPayload(r,y);return{txb:h,tx:y,txf:s}}}}function z({posId:b,displayTokenA:_,displayTokenB:d,symbolEllipsesDecimals:x=10}){const[P,l]=D.useState(!0),{posPoolsRelatedData:c}=N(),e=c[b];return i.jsxs(A,{children:[i.jsx(E,{isLoaded:!!(e!=null&&e.currentPrice),children:i.jsx(S,{color:"text_caption",children:P?e==null?void 0:e.currentPrice:e==null?void 0:e.currentPriceReverse})}),i.jsxs(A,{gap:"0",children:[i.jsx(S,{color:"primary_gray",children:C(P?d==null?void 0:d.symbol:_==null?void 0:_.symbol,x)}),i.jsx(S,{color:"primary_gray",children:"Â perÂ "}),i.jsx(S,{color:"primary_gray",children:C(P?_==null?void 0:_.symbol:d==null?void 0:d.symbol,x)})]}),i.jsx(v,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:t=>{R(t),l(!P)}})]})}export{z as P,V as a,q as u};
//# sourceMappingURL=PositionCurrentPrice-Dr3ce999.js.map
