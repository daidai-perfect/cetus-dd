import{a as A,j as a,H as i,C as K,I as Z,T as o,f as O,P as D,h as f,p as F,k as I,m as ee,n as ae,V as C,ak as se,q as L,R as re}from"./vendor-BowHGuwE.js";import{u as te}from"./useTransaction-Ck5-rOQU.js";import{u as le}from"./useAccountBalance-B0xlJzQj.js";import{k as ce,J as Q,K as W,r as xe,R as H,d as de,a as q,z as G,n as ne,$ as T,I as me}from"./index-C2ps9-Dy.js";import{M as R}from"./msafe-oYBkW7LJ.js";import{u as E,b as ge,a as ue}from"./usePositionList-B802Vh58.js";import{S as U}from"./SingleTokenInfo-DIrFWCBu.js";import{u as he}from"./useToken-CE5Fcadt.js";import{P as ye}from"./PositionStatus-BGCbpj7Q.js";import{R as ie}from"./RangeValue-DWfWcPYm.js";function oe(){const e=ce("farms");return{getStakeTxPayload:async(r,l)=>{const x={pool_id:l,clmm_position_id:r},m=await e.Farms.depositPayload(x),t={action:R.FarmingStake,txbParams:x};return{tx:m,msafeParams:t}},getUnstakeTxPayload:async(r,l)=>{const x={pool_id:r,position_nft_id:l},m=await e.Farms.withdrawPayload(x),t={action:R.FarmingUnstake,txbParams:x};return{tx:m,msafeParams:t}},getHarvestFarmsTxPayload:async(r,l,x)=>{const m={pool_id:r,position_nft_id:l},t=await e.Farms.harvestPayload(m,x),b={action:R.FarmingHarvest,txbParams:m};return{tx:t,msafeParams:b}},getBatchHarvestFarmsTxPayload:async r=>({tx:await e.Farms.batchHarvestPayload(r),msafeParams:{action:"FarmingBatchHarvest",txbParams:r}})}}function je(){const{getBatchHarvestFarmsTxPayload:e,getStakeTxPayload:c,getUnstakeTxPayload:n,getHarvestFarmsTxPayload:j}=oe(),{signAndExecuteTransaction:g}=te(),[r,l]=A.useState(!1),[x,m]=A.useState(!1),{fetchAccountBalance:t}=le();return{toStakePos:async(k,S,u,y)=>{m(!0);try{const{tx:h,msafeParams:p}=await c(k,S);console.log("ðŸš€ ~ toStakePos ~ tx:",h);const d=await g(h,{getShowInfo:()=>({modalDescriptionText:`Stake ${u}`,toastTitleText:"Stake"})},{msafeParams:p});d&&(console.log("ðŸš€ ~ toStakePos ~ res:",d),y(d.events)),m(!1)}catch(h){console.log("ðŸš€ ~ toStakePos ~ error:",h),m(!1)}},toUnStakePos:async(k,S,u,y)=>{m(!0);try{const{tx:h,msafeParams:p}=await n(S,k);console.log("ðŸš€ ~ toUnstack ~ tx:",h);const d=await g(h,{getShowInfo:()=>({modalDescriptionText:`Unstake ${u}`,toastTitleText:"Unstake"})},{msafeParams:p});console.log("ðŸš€ ~ toUnStakePos ~ res:",d),d&&(t(),y()),m(!1)}catch(h){console.log("ðŸš€ ~ toUnStakePos ~ error:",h),m(!1)}},toClaimPos:async(k,S,u)=>{l(!0);try{const{tx:y,msafeParams:h}=await j(S,k);console.log("ðŸš€ ~ toClaimPos ~ tx:",y);const p=await g(y,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimPos ~ res:",p),p&&(t(),u()),l(!1)}catch(y){l(!1),console.log("ðŸš€ ~ toClaimPos ~ error:",y)}},toClaimAllPos:async(k,S)=>{l(!0);try{const u=[];k.forEach(d=>{d!=null&&d.farmsPool&&u.push({pool_id:d.farmsPool,position_nft_id:d.id})}),console.log("ðŸš€ ~ list.forEach  toClaimAllPos ~ params:",u);const{tx:y,msafeParams:h}=await e(u);console.log("ðŸš€ ~ toClaimAllPos ~ tx:",y);const p=await g(y,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h});console.log("ðŸš€ ~ toClaimAllPos ~ res:",p),p&&setTimeout(async()=>{t(),S()},2e3),l(!1)}catch(u){l(!1),console.log("ðŸš€ ~ toClaimAllPos ~ error:",u)}},claimLoading:r,unstakeLoading:x}}const ke="/images/burn-lock.png",pe=()=>a.jsx(i,{w:"20px",h:"20px",onClick:e=>{W(e)},children:a.jsx(Q,{placement:"top",tooltip:a.jsx(o,{fontSize:"12px",children:"Liquidity that is permanently locked"}),children:a.jsx(K,{children:a.jsx(Z,{w:"100%",h:"100%",src:ke})})})}),we=({positionInfo:e,haveTooltip:c=!0,...n})=>{var _,v;const{getTokenAmountValue:j}=xe(),{posLiquidityData:g,posLiquidityDataLoading:r}=E(),l=g[e==null?void 0:e.posId],x=j((_=e==null?void 0:e.displayTokenA)==null?void 0:_.coin_type,l==null?void 0:l.displayCoinAmountA,"--"),m=j((v=e==null?void 0:e.displayTokenB)==null?void 0:v.coin_type,l==null?void 0:l.displayCoinAmountB,"--"),t=A.useMemo(()=>x!=="--"&&m!=="--"?H(de(x).plus(m).toString(),2):"$--",[x,m]),{isApp:b}=q();return a.jsxs(i,{gap:"4px",children:[(e==null?void 0:e.posType)=="burn"&&a.jsx(pe,{}),a.jsx(O,{p:"12px 0",onClick:B=>W(B),children:a.jsxs(D,{isLazy:!0,trigger:b?"click":"hover",placement:"top-start",children:[a.jsx(f,{children:a.jsx(K,{as:"button",cursor:c?"help":"text",children:a.jsx(F,{isLoaded:!!t&&!!g,children:a.jsx(o,{color:"text_caption",fontSize:"16px",textDecoration:c?"underline dotted":"none",textUnderlineOffset:"3px",...n,children:t})})})}),c&&a.jsx(I,{children:a.jsx(ee,{zIndex:"2",minW:"unset",w:"unset",p:"4px ",children:a.jsx(ae,{borderRadius:"12px",p:"8px",children:a.jsxs(C,{align:"flex-start",minW:"200px",children:[a.jsxs(i,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:"border",pb:"8px",sx:{_last:{borderBottom:"none",pb:"0px"}},children:[a.jsx(U,{token:e==null?void 0:e.displayTokenA,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),a.jsxs(C,{align:"flex-end",gap:"4px",children:[a.jsx(o,{fontSize:"12px",color:"text_caption",children:G(l==null?void 0:l.displayCoinAmountA)}),a.jsx(o,{fontSize:"12px",children:H(x,2)})]})]}),a.jsxs(i,{w:"100%",justify:"space-between",children:[a.jsx(U,{token:e==null?void 0:e.displayTokenB,imgBoxStyle:{w:"20px",h:"20px"},haveName:!1,symbolFontSize:"12px",warningIcon:{iconW:"10px",iconH:"10px"}}),a.jsxs(C,{align:"flex-end",gap:"4px",children:[a.jsx(o,{fontSize:"12px",color:"text_caption",children:G(l==null?void 0:l.displayCoinAmountB)}),a.jsx(o,{fontSize:"12px",children:H(m,2)})]})]})]})})})})]})})]})};function be({positionInfo:e,symbolEllipsesDecimals:c=0,labelInfo:n,children:j}){const{posPoolsRelatedData:g}=E(),r=g[e==null?void 0:e.posId],l=(r==null?void 0:r.currentStatus)=="Active",{isApp:x}=q();return a.jsx(O,{w:{base:"100%",lg:"480px"},maxW:{base:"100%",lg:"480px"},children:a.jsx(i,{maxW:"100%",display:"inline-block",w:{base:"100%",lg:"unset"},borderRadius:"12px",bg:"position_status_bg",pr:"16px",children:a.jsxs(i,{w:"100%",children:[a.jsx(ye,{isActive:l,isLoading:(r==null?void 0:r.currentStatus)==""}),a.jsxs(C,{align:"flex-start",gap:"4px",children:[a.jsxs(i,{children:[a.jsx(F,{isLoaded:!!(n!=null&&n.text),children:a.jsx(o,{fontSize:"12px",color:"primary_gray",...n==null?void 0:n.style,children:n==null?void 0:n.text})}),!x&&j]}),a.jsx(ie,{symbolEllipsesDecimals:c,displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,priceInfo:{minPrice:r==null?void 0:r.minPrice,maxPrice:r==null?void 0:r.maxPrice,minPriceResever:r==null?void 0:r.minPriceResever,maxPriceResever:r==null?void 0:r.maxPriceResever}}),x&&j]})]})})})}function He({positionInfo:e,apiInfo:c}){var M,$;const{farmsPosRewardsData:n,posPoolsRelatedData:j,posPoolsOriginalData:g}=E(),{getPositionBaseList:r,getPosRelatedData:l}=ge(),{currentAccount:x}=ne(),{isApp:m}=q(),t=n[e==null?void 0:e.id],b=t==null?void 0:t.reduce((s,w)=>s+w.display_amount_owed,0),_=j[e==null?void 0:e.posId],v=(_==null?void 0:_.currentStatus)=="Active",{getClmmPosName:B}=ue(),k=A.useMemo(()=>{var s;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const w=(s=g==null?void 0:g[e==null?void 0:e.clmmPool])==null?void 0:s.index;return B(e==null?void 0:e.index,w)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,g]),S=se(),u=()=>{setTimeout(async()=>{const s=await r(x==null?void 0:x.address);l(s,!0)},2e3)},{toStakePos:y,toUnStakePos:h,toClaimPos:p,unstakeLoading:d,claimLoading:P}=je(),X=async s=>{y(e==null?void 0:e.id,c==null?void 0:c.farmsPoolAddress,k,u)},Y=async()=>{h(e==null?void 0:e.id,e==null?void 0:e.farmsPool,k,u)},N=async()=>{p(e==null?void 0:e.id,e==null?void 0:e.farmsPool,u)},z=A.useMemo(()=>(t==null?void 0:t.length)>0?t.reduce((s,w)=>T(s).plus(w==null?void 0:w.display_amount_owed).toString(),"0"):"0",[t,x==null?void 0:x.address,P,d]),V=A.useMemo(()=>e&&c?e.posType=="clmm"&&c.haveFarming===!0:!1,[e==null?void 0:e.posType,c==null?void 0:c.haveFarming]);return a.jsxs(i,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:"12px",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[a.jsx(be,{positionInfo:e,symbolEllipsesDecimals:10,labelInfo:{text:k,style:{color:"text_caption",mb:"-2px"}},children:a.jsxs(i,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:s=>{W(s),S(`/position-detail/${e==null?void 0:e.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[a.jsx(o,{fontSize:"12px",color:"primary",children:"Manage position"}),a.jsx(me,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),a.jsxs(i,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[a.jsxs(C,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsx(o,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),a.jsx(we,{positionInfo:e,fontSize:"14px"})]}),a.jsxs(C,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[a.jsxs(i,{gap:"4px",children:[a.jsx(o,{color:"primary_gray",children:"Earnings"}),!m&&a.jsx(L,{isLoading:P,disabled:d||P||T(b).eq(0),onClick:d||P||T(b).eq(0)?()=>{}:N,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),a.jsxs(i,{children:[a.jsx(F,{isLoaded:!!z,children:a.jsx(C,{align:"flex-end",children:t&&(t==null?void 0:t.length)>0&&T(z).gt(0)?t==null?void 0:t.map(s=>{var w;return console.log("ðŸš€ ~ ExpendItem ~ posFarmsData && posFarmsData?.length > 0 && d(totalAmount).gt(0) :",t,(t==null?void 0:t.length)>0,z,T(z).gt(0)),a.jsx(re.Fragment,{children:T(s==null?void 0:s.display_amount_owed).gt(0)&&a.jsx(J,{coinType:(w=s==null?void 0:s.token)==null?void 0:w.coin_type,amount:(s==null?void 0:s.display_amount_owed)||0,tokenInfo:s==null?void 0:s.token},s==null?void 0:s.coinType)},s==null?void 0:s.rewarder_type)}):((M=c==null?void 0:c.farmsRewarderList)==null?void 0:M.length)>0?($=c==null?void 0:c.farmsRewarderList)==null?void 0:$.map(s=>(console.log("ðŸš€ ~ apiInfo?.farmsRewarderList?.map ~ item:",s),a.jsx(J,{coinType:s==null?void 0:s.coinType,amount:"0"},s==null?void 0:s.coinType))):a.jsx(o,{textColor:"text_caption",textAlign:"right",children:"--"})})}),m&&a.jsx(L,{isLoading:P,disabled:d||P||T(b).eq(0),onClick:d||P||T(b).eq(0)?()=>{}:N,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),a.jsxs(C,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(e==null?void 0:e.posType)=="farms"&&a.jsx(L,{disabled:d,isLoading:d,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:Y,children:"Unstake"}),V&&!v&&a.jsx(Q,{placement:"top",tooltip:a.jsx(o,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:a.jsx(L,{disabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),V&&v&&a.jsx(L,{disabled:d,isLoading:d,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:X,children:"Stake"})]})]})]})}const J=({coinType:e,amount:c,tokenInfo:n,boxStyle:j,textAlign:g="right"})=>{const{tokenInfo:r}=he(e);return a.jsxs(i,{...j,children:[a.jsx(U,{token:n||r,coinType:e,imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),a.jsxs(o,{textColor:"text_caption",textAlign:g,children:[c," ",(n==null?void 0:n.symbol)||(r==null?void 0:r.symbol)]})]})};export{He as E,we as L,J as R,je as a,oe as u};
//# sourceMappingURL=ExpendItem-CPm9nAfZ.js.map
