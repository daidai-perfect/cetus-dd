import{j as e,H as b,a0 as Vt,T as _,Y as D,Z as Ee,bo as lt,e as dt,r as p,b as re,W as G,V as O,I as ee,c as Re,X as He,U as pt,a1 as X,R as Se,bp as _e,bq as ne,br as xt,aO as K,d as R,ae as Fe,af as ze,ag as Ne,ah as De,ai as ut,aj as Be,ak as We,k as mt,am as gt,$ as te,S as I,g as Yt,C as ae,a3 as qe,B as ht,a$ as Ce,aa as we,a5 as $e,a as jt,bc as Ut,a9 as Ie,al as et,as as tt,l as Gt,ab as Qt,u as Jt,a2 as Kt}from"./index-EIuDXFqf.js";import{P as Le}from"./Pagination-C4T7_n9r.js";import{N as se}from"./NoData-DwlYdbUZ.js";import{u as Zt}from"./RangeValue-gh8MqniR.js";import{u as he}from"./useAccountBalance-C1UphFYm.js";import{u as me}from"./useTransaction-D43fSpZb.js";import{u as Ve}from"./useToken-OFYCK_e2.js";import{C as ge}from"./CetusTooltip-nIulWf_q.js";import{S as Xt}from"./SingleTokenInfo-WYoENExZ.js";import{b as bt}from"./FarmsTable-DH01e6cx.js";import{a as Q,b as F,c as ft,d as _t,e as Z,T as wt}from"./tr-BL1Tym1g.js";import{A as qt}from"./aggregator-fVcfIFzR.js";import{u as It,A as st}from"./useFindBestRouting-CEdRIjXa.js";import{u as it}from"./useTokenBalance-CClU3QSh.js";import{u as es}from"./useInsufficientBalanceToast-BTLvW3lQ.js";import{u as yt}from"./global-B5Oapgsl.js";import{I as nt}from"./IconBg-CkDqT_Pf.js";import{T as ts}from"./TradeInputGroup-_FSZjx17.js";import{W as ss}from"./WarningTokenTipModal-DH8fdx0b.js";import{T as is,a as ns,L as rs}from"./LimitPriceChart-Ca9IARCP.js";import"./Swap-BurBUWzg.js";import{T as as}from"./TradeConfirmAmountInfo-a_8KJ7B-.js";import{I as ye}from"./InputBox-2aJW8uKB.js";import{M as os,F as cs}from"./MenuDropBlock-CaF4Xt4B.js";import{L as ls}from"./api-data-utils-BTVVFqla.js";import{u as ds}from"./useRpcListener-BD1TvJNu.js";import"./AddressCopyLink-Dm7E_aus.js";import"./AddressUnderline-CpCI8hhH.js";import"./usePositionList-DaKBHsXn.js";import"./useGetPoolList-BFzNj-S-.js";import"./AprTooltip-EapVC4TC.js";import"./generateCategoricalChart-Cwqm8RFj.js";import"./debounce-CVEREl3e.js";import"./throttle-Cgde_pTT.js";import"./index-BsIXeSqj.js";import"./ExpendItem-CVoGyPy4.js";import"./msafe-oYBkW7LJ.js";import"./PriceRange-Cdvn9m8z.js";import"./PositionStatus-BNUng5n-.js";import"./CoinPairInfo-BA8tfTI9.js";import"./_getAllKeysIn-BnLBgRmE.js";import"./SwapConfirmBlock-D2tfRXSB.js";import"./index-CK1fDGhy.js";import"./CurrentPrice-D7c6YYd9.js";import"./HighlightText-Cu1XL-Ku.js";import"./HTextLabelBox-C3BJypdy.js";import"./swap-BCour3g3.js";import"./Slippage-BLs_9i2g.js";import"./TooltipIcon-B1aK4n7B.js";import"./switch-BcSMKVwc.js";import"./index-C9s1l7-3.js";import"./circular-progress-BVOxjuZ6.js";import"./progress.utils-Bzc7xuFJ.js";import"./usePreviousValue-CyAwuFXn.js";const je=({info:t,imgSize:n="32px"})=>{const{pay_coin:i,target_coin:u,total_pay_amount:x,expect_obtain_amount:c}=t;return e.jsxs(b,{children:[e.jsx(Vt,{w:n,h:n,coinAIconUrl:i.logo_url,coinBIconUrl:u.logo_url}),e.jsxs(_,{color:"text_caption",children:[D(x)," ",i.symbol," â†’ ",D(c)," ",u.symbol]})]})},be=({info:t})=>e.jsx(b,{justifyContent:"end",gap:"2px",children:e.jsxs(_,{color:"text_caption",children:[Ee(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),fe=({info:t})=>{const{pay_coin:n,total_pay_amount:i,deal_amount:u,deal_rate:x}=t;return e.jsxs(b,{justifyContent:"end",gap:"2px",children:[e.jsxs(_,{color:"text_caption",children:[D(u),"/",D(i)," ",n.symbol]}),e.jsxs(_,{color:"primary_gray",children:["(",lt(Number(x)*100),")"]})]})},St=({historyInfo:t,type:n,...i})=>{const{getExplorerUrl:u}=dt(),{pay_coin:x,target_coin:c}=t,g=p.useMemo(()=>(t==null?void 0:t.events)||[],[t]),h=d=>{const l=d==null?void 0:d.event_type;return l.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${D(He(d==null?void 0:d.amount,x==null?void 0:x.decimals))}`}:l.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:c,num:`+${D(He(d==null?void 0:d.amount,c==null?void 0:c.decimals))}`}:l.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${D(He(d==null?void 0:d.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=re();return e.jsx(G,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...i,children:e.jsx(O,{align:"flex-start",children:g.map(d=>{const{tokenInfo:l,text:o,icon:s,color:r,num:j}=h(d);return e.jsxs(O,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(b,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(b,{gap:n=="card"?"4px":"8px",flexDirection:n=="card"?"column":"row",align:n=="card"?"flex-start":"center",children:[e.jsxs(b,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(ee,{svgW:"14px",xlinkHref:s,svgFill:r,svgHover:r}),e.jsx(_,{color:r,children:o})]}),!a&&e.jsxs(_,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[j,"Â ",l==null?void 0:l.symbol]})]}),e.jsxs(b,{gap:n=="card"?"4px":"20px",flexDirection:n=="card"&&!a?"column":"row",align:n=="card"?"flex-end":"center",children:[e.jsxs(_,{h:"20px",lineHeight:"20px",children:[Ee(Number(d.block_time),"")," (UTC)"]}),e.jsxs(b,{gap:"4px",cursor:"pointer",onClick:w=>{Re(w),window.open(u(d.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(_,{color:"text_caption",children:"View Transaction"}),e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(_,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[j,"Â ",l==null?void 0:l.symbol]})]},d==null?void 0:d.tx)})})})},de=({info:t})=>{const[n,i]=p.useState(!0),{getTokenRank:u}=Zt();p.useEffect(()=>{const a=u(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);console.log("ðŸš€ ~ useEffect PriceBlock ~ direct:",a),i(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:c,price:g,reseverPrice:h}=t;return e.jsxs(b,{justifyContent:"end",children:[n?e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(_,{color:"text_caption",lineHeight:"1",children:D(g)}),e.jsxs(_,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[c.symbol," per ",x.symbol]})]}):e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(_,{color:"text_caption",children:D(h)}),e.jsxs(_,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",c.symbol]})]}),e.jsx(ee,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{Re(a),i(!n)}})]})},Ct=({historyInfo:t,openExpendItemObj:n})=>e.jsxs(b,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(ee,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(_,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(ee,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:n[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),ps=(t,n)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:i=>{t(()=>({orderListLoading:i}))},setMyOrderList:i=>{t(()=>({myOrderList:i}))}}),ve=pt(ps);function Oe(){const{currentAccount:t,addressChangeVersion:n}=X(),{peripherySdk:i}=Se(),{setOrderListLoading:u,setMyOrderList:x,myOrderList:c,orderListLoading:g}=ve(),{fetchTokenInfo:h}=Ve(),a=async(l=t==null?void 0:t.address,o)=>{console.log("ðŸš€ ~ fetchMyLimitOrder ~ account:",l);try{if(!l){u(!1),x([]);return}o&&u(!0);const s=await i.LimitOrder.getOwnerLimitOrderList(l,"all"),r=await d(s.data.filter(j=>j.status===_e.PartialCompleted||j.status===_e.Running));x(r),console.log("ðŸš€ ~ fetchMyLimitOrder ~ list:",r)}catch(s){console.log("ðŸš€ ~ fetchMyLimitOrder ~ error:",s)}finally{u(!1)}},d=async l=>{const o=[];for(const s of l){const[r,j]=await Promise.all([h(s.pay_coin_type),h(s.target_coin_type)]);if(r&&j){const{total_pay_amount:w,pay_balance:v,rate:C,obtained_amount:S,claimed_amount:k,target_balance:y,created_ts:H,expire_ts:f,status:B,id:T}=s,z=ne(w,r.decimals).toString(),N=ne(v,r.decimals).toString(),q=ne(S,j.decimals).toString(),$=ne(k,j.decimals).toString(),Y=ne(y,j.decimals).toString(),L=xt.rateToPrice(C.toString(),r.decimals,j.decimals),U=K(1).div(L).toString(),P=ne(K(w).sub(v).toFixed(0),r.decimals).toString(),V={order_id:T,pay_coin:r,target_coin:j,price:L,reseverPrice:U,total_pay_amount:z,expect_obtain_amount:K(z).mul(L).toString(),remaining_amount:N,deal_amount:P,deal_rate:K(P).div(z).toString(),obtained_amount:q,claimed_amount:$,un_claimed_amount:K(Y).sub($).toString(),created_ts:H,expire_ts:f,status:B};o.push(V)}}return o.sort((s,r)=>r.created_ts-s.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:g,myOrderList:c}}function Lt(){const{fetchAccountBalance:t}=he(),{fetchMyLimitOrder:n}=Oe(),{signAndExecuteTransaction:i}=me(),{peripherySdk:u}=Se(),[x,c]=p.useState(!1),{transactionConfirmation:g}=me();return{handleCancelOrder:async a=>{c(!0);const d={getShowInfo:r=>{const j="Canceling order",w={modalDescriptionText:j,toastTitleText:j};return r==="success"&&(w.toastDescriptionContent="Order cancelled successfully",w.modalDescriptionText="Order cancelled successfully",w.toastTitleText="Order cancelled"),w}};g(d);const l=a.map(r=>({pay_coin_type:r.pay_coin.coin_type,target_coin_type:r.target_coin.coin_type,order_id:r.order_id})),o=await u.LimitOrder.cancelOrdersByOwner(l),s=await i(o,d);c(!1),s&&setTimeout(()=>{t(),n()},2e3)},cancelOrderLoading:x}}function xs(){const{fetchAccountBalance:t}=he(),{fetchMyLimitOrder:n}=Oe(),{signAndExecuteTransaction:i}=me(),{peripherySdk:u}=Se(),[x,c]=p.useState(!1),[g,h]=p.useState(!1);return{handleClaimOrder:async(l,o)=>{console.log("ðŸš€ ~ handleClaimOrder ~ info:",l),c(!0);const s={pay_coin_type:l.pay_coin.coin_type,target_coin_type:l.target_coin.coin_type,order_id:l.order_id},r=await u.LimitOrder.claimTargetCoin(s),j=await i(r,{getShowInfo:(w,v)=>{var k;const C=`Claim ${D(o)} ${(k=l==null?void 0:l.target_coin)==null?void 0:k.symbol}`,S={modalDescriptionText:C,toastTitleText:C};return w==="success"&&(S.toastDescriptionContent="",S.modalDescriptionText="",S.toastTitleText="Claim successfully"),S}});c(!1),j&&setTimeout(()=>{t(),n()},2e3)},getLimitOrderClaimHistory:async l=>{h(!0);const o=await u.LimitOrder.getLimitOrderClaimLogs(l.order_id);return console.log("ðŸš€ ~ getLimitOrderClaimHistory ~ result:",l,o),o?(h(!1),o.map(s=>{var j;const r=R(s.parsedJson.claimed_amount).div(Math.pow(10,(j=l.target_coin)==null?void 0:j.decimals));return{...s,...s.parsedJson,claimed_amount:r}})):[]},isClaimHistoryLoading:g,claimLoading:x}}const us=({orderInfo:t,isOpen:n,onClose:i,handleClaim:u,claimLoading:x,getLimitOrderClaimHistory:c,isClaimHistoryLoading:g})=>{const{getExplorerUrl:h}=dt(),[a,d]=p.useState(""),[l,o]=p.useState([]),[s,r]=p.useState({label:"Claim",value:"claim"}),j=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],w=y=>{r(y),(y==null?void 0:y.value)=="history"&&v()},v=async()=>{const y=await c();y&&o(y)},C=p.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:R(a).gt(t.un_claimed_amount)||R(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[S,k]=p.useState(!0);return p.useEffect(()=>{S&&(k(!1),d(t.un_claimed_amount))},[S,t.un_claimed_amount]),e.jsxs(Fe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:i,isCentered:!0,children:[e.jsx(ze,{}),e.jsxs(Ne,{children:[e.jsx(De,{children:e.jsx(ut,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(Be,{}),e.jsx(We,{textAlign:"center",p:"0px",children:e.jsxs(O,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(G,{borderRadius:"8px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(je,{info:t,imgSize:"28px"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(de,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(be,{info:t})]}),e.jsx(mt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:j,currentTab:s.label,handleChangeTab:w}),(s==null?void 0:s.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(O,{gap:"16px",align:"flex-start",children:[e.jsx(_,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(gt,{value:a?D(a).toString():"",onChange:y=>{d(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:e.jsx(Xt,{portal:!1,token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(te,{onClick:()=>{u(a),i()},disabled:C.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:C.text})]}),(s==null?void 0:s.value)=="history"&&e.jsx(O,{w:"100%",gap:"12px",children:g?e.jsxs(G,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(b,{justify:"space-between",children:[e.jsx(I,{height:"4",width:"150px"}),e.jsx(I,{height:"4",width:"150px"})]}),e.jsxs(b,{justify:"space-between",mt:"16px",children:[e.jsx(I,{height:"4",width:"150px"}),e.jsx(I,{height:"4",width:"150px"})]})]},history==null?void 0:history.id):(l==null?void 0:l.length)==0?e.jsx(se,{type:"nodata",text:"No History.",p:"20px"}):l==null?void 0:l.map(y=>{var H,f;return e.jsx(G,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(O,{gap:"16px",align:"flex-start",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Amount"}),e.jsxs(b,{gap:"4px",children:[e.jsx(Yt,{imageUrl:(H=t==null?void 0:t.target_coin)==null?void 0:H.logo_url,w:"20px",h:"20px"}),e.jsxs(_,{color:"text_caption",lineHeight:"18px",children:[D(y==null?void 0:y.claimed_amount)," ",(f=t==null?void 0:t.target_coin)==null?void 0:f.symbol]})]})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Time"}),e.jsxs(b,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:B=>{Re(B),window.open(h(y.digest,"tx"))},children:[e.jsxs(_,{color:"text_caption",children:[Ee(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(ee,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},Ae=({orderInfo:t})=>{const{handleCancelOrder:n,cancelOrderLoading:i}=Lt(),{handleClaimOrder:u,claimLoading:x,getLimitOrderClaimHistory:c,isClaimHistoryLoading:g}=xs(),[h,a]=p.useState(),[d,l]=p.useState(!1),o=(s,r)=>{a(s),r==="cancel"&&n([s]),r==="claim"&&l(!0)};return re(),e.jsxs(b,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[R(t==null?void 0:t.obtained_amount).lte(0)&&R(t.un_claimed_amount).lte(0)?e.jsx(ge,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(ae,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(te,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(te,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||o(t,"claim")},children:"Claim"}),e.jsx(te,{isLoading:i,disabled:i,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{i||o(t,"cancel")},children:"Cancel"}),d&&e.jsx(us,{orderInfo:t,claimLoading:x,isOpen:d,onClose:()=>l(!1),handleClaim:s=>u(t,s),getLimitOrderClaimHistory:()=>c(t),isClaimHistoryLoading:g})]})};function rt(){const{currentAccount:t,onWalletModal:n}=X(),{myOrderList:i,orderListLoading:u}=ve();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",i);const x=10,[c,g]=p.useState([]),[h,a]=p.useState(0),[d,l]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){a(i==null?void 0:i.length);const o=(d-1)*x,s=o+x;g(i.slice(o,s))}},[d,i]),e.jsx(O,{w:"100%",children:t!=null&&t.address?u?e.jsx(G,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(O,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((o,s)=>e.jsx(vt,{},s))})}):i.length===0?e.jsx(se,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(G,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(c==null?void 0:c.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(O,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:c==null?void 0:c.map(o=>e.jsx(ms,{orderInfo:o},o==null?void 0:o.order_id))}),!u&&(i==null?void 0:i.length)>x&&e.jsx(ae,{mt:"12px",children:e.jsx(Le,{total:h,size:x,currentPage:d,onChange:l})})]}):e.jsx(se,{type:"nowallet",onboard:()=>n(!0),borderRadius:"16px"})})}const ms=({orderInfo:t})=>{const{isApp:n}=re();return e.jsxs(O,{w:"100%",gap:"16px",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(je,{info:t,imgSize:"28px"}),!n&&e.jsx(Ae,{orderInfo:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(de,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(be,{info:t})]}),n&&e.jsx(Ae,{orderInfo:t})]})},vt=()=>e.jsxs(O,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(b,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(b,{gap:"0",children:[e.jsxs(b,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(qe,{size:"8"}),e.jsx(qe,{size:"8"})]}),e.jsx(I,{height:"4",width:"100px"})]})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(I,{height:"4",width:"180px"}),e.jsx(I,{height:"4",width:"150px"})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(I,{height:"4",width:"180px"}),e.jsx(I,{height:"4",width:"150px"})]})]});function at(t){const{historyOrderList:n,historyOrderLoading:i}=t,{currentAccount:u,onWalletModal:x}=X();console.log("ðŸš€ ~ OrderTableList ~ historyOrderList:",n);const c=10,[g,h]=p.useState([]),[a,d]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){d(n==null?void 0:n.length);const s=(l-1)*c,r=s+c;h(n.slice(s,r))}},[l,n]),e.jsx(O,{w:"100%",children:u!=null&&u.address?i?e.jsx(G,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(O,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,r)=>e.jsx(vt,{},r))})}):n.length===0?e.jsx(se,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(G,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(g==null?void 0:g.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(O,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:g==null?void 0:g.map(s=>e.jsx(gs,{historyInfo:s},s==null?void 0:s.order_id))}),!i&&(n==null?void 0:n.length)>c&&e.jsx(ae,{mt:"12px",children:e.jsx(Le,{total:a,size:c,currentPage:l,onChange:o})})]}):e.jsx(se,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const gs=({historyInfo:t})=>{const[n,i]=p.useState({});return e.jsxs(O,{w:"100%",gap:"16px",children:[e.jsx(b,{w:"100%",justify:"space-between",children:e.jsx(je,{info:t,imgSize:"28px"})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Limit Price"}),e.jsx(de,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expiry"}),e.jsx(be,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Filled Size"}),e.jsx(fe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Status"}),e.jsx(ht,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,i({...n})},children:e.jsx(Ct,{historyInfo:t,openExpendItemObj:n})})]}),n[t==null?void 0:t.order_id]&&e.jsx(St,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function hs({historyInfo:t}){const[n,i]=p.useState({});return e.jsxs(Ce.Fragment,{children:[e.jsxs(Q,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,i({...n})},sx:{td:{pb:n[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(F,{w:"30%",children:e.jsx(je,{info:t})}),e.jsx(F,{w:"20%",textAlign:"right",children:e.jsx(de,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(be,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(Ct,{historyInfo:t,openExpendItemObj:n})})]}),!n[t==null?void 0:t.order_id]&&e.jsx(Q,{h:"16px"}),e.jsx(Q,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:n[t==null?void 0:t.order_id]&&e.jsx(F,{colSpan:5,children:e.jsx(St,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function js(t){const{historyOrderList:n,historyOrderLoading:i}=t;console.log("ðŸš€ ~ HistoryTableList ~ historyOrderList:",n);const{currentAccount:u,onWalletModal:x}=X(),c=10,[g,h]=p.useState([]),[a,d]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){d(n==null?void 0:n.length);const s=(l-1)*c,r=s+c;h(n.slice(s,r))}},[l,n]),e.jsxs(ft,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(_t,{children:e.jsxs(Q,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Limit Price"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Status"})]})}),e.jsx(wt,{children:u!=null&&u.address?i?e.jsx(bt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(Q,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(se,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(Ce.Fragment,{children:[g.map(s=>e.jsx(hs,{historyInfo:s},s.order_id)),!i&&(n==null?void 0:n.length)>c&&e.jsx(F,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(ae,{w:"100%",children:e.jsx(Le,{total:a,size:c,currentPage:l,onChange:o})})})]}):e.jsx(Q,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(se,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const bs=(t,n)=>({quoteToken:void 0,payCoin:we.clmm_swap.from_coin,targetCoin:we.clmm_swap.to_coin,setPayCoin:i=>{t(()=>({payCoin:i}))},setTargetCoin:i=>{t(()=>({targetCoin:i}))},setQuoteToken:i=>{t(()=>({quoteToken:i}))},expiresIn:"7 Days",setExpiresIn:i=>{t(()=>({expiresIn:i}))},customExpiresVal:null,setCustomExpiresVal:i=>{t(()=>({customExpiresVal:i}))},refreshPriceLoading:!1,setRefreshPriceLoading:i=>{t(()=>({refreshPriceLoading:i}))}}),oe=pt(bs);function fs(t,n){const{getTokenPrice:i}=$e(),u=i(t),x=i(n),c=p.useMemo(()=>{if(u&&x){const g=K(u.price).div(x.price).toString(),h=g.toString();return{price:g,displayPrice:h}}},[u,x]);return{price:c==null?void 0:c.price,displayPrice:c==null?void 0:c.displayPrice}}function Ot(){const{payCoin:t,targetCoin:n,setRefreshPriceLoading:i}=oe(),{fetchTokenPrices:u}=$e();return{refreshCoinMarketPrice:()=>{const c=[];t&&c.push(t.coin_type),n&&c.push(n.coin_type),c.length>0&&(i(!0),u(c).finally(()=>{i(!1)}))}}}function _s(){const{refreshCoinMarketPrice:t}=Ot(),{fetchAccountBalance:n}=he(),{fetchMyLimitOrder:i}=Oe(),{signAndExecuteTransaction:u}=me(),{peripherySdk:x}=Se(),{findBestRouters:c}=It(),{fetchTokenPrices:g,getTokenAmountValue:h}=$e(),a=jt(),{pay:d,target:l}=Ut(),{getTokenInfo:o}=Ve(),{payCoin:s,targetCoin:r,quoteToken:j,expiresIn:w,setPayCoin:v,setTargetCoin:C,setQuoteToken:S,customExpiresVal:k,setExpiresIn:y,setRefreshPriceLoading:H}=oe(),[f,B]=p.useState(""),[T,z]=p.useState(""),[N,q]=p.useState(!0),[$,Y]=p.useState(!0),[L,U]=p.useState(""),{displayPrice:P}=fs((j==null?void 0:j.coin_type)===(s==null?void 0:s.coin_type)?r==null?void 0:r.coin_type:s==null?void 0:s.coin_type,j==null?void 0:j.coin_type),{balanceInfo:V}=it(s),{balanceInfo:Te}=it(r),ke=h(s==null?void 0:s.coin_type,f),ce=h(r==null?void 0:r.coin_type,T),[M,pe]=p.useState(""),Pe=p.useRef(M);p.useEffect(()=>{Pe.current=M},[M]);const[xe,Ye]=p.useState(void 0),[Tt,Ue]=p.useState(""),kt=p.useRef(f),Pt=p.useRef(T);p.useEffect(()=>{kt.current=f},[f]),p.useEffect(()=>{Pt.current=T},[T]),p.useEffect(()=>{v(o(d)||we.clmm_swap.from_coin),C(o(l)||we.clmm_swap.to_coin)},[d,l]),p.useEffect(()=>{if(Ye(void 0),t(),Mt(),s&&r){const m=s.extensions&&s.extensions.rank||"0",A=r.extensions&&r.extensions.rank||"0";console.log("ðŸš€ ~ useEffect ~ payCoinRank:",s,r),R(m).gte(A)?S({...s}):S({...r})}},[s==null?void 0:s.coin_type,r==null?void 0:r.coin_type]);const Mt=async()=>{if(s&&r){const m=`${s.coin_type}_${r.coin_type}`;pe(m);const A=Object.entries(qt).map(([W,ie])=>ie.id),J=await c({fromToken:s,toToken:r,amount:Ie(1,s.decimals).toFixed(0),providersKeys:A,by_amount_in:!0,uuid:m});m===Pe.current&&Ye(J)}};p.useEffect(()=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",$,P),$?U(P||""):Qe()},[P]),p.useEffect(()=>{j&&!$&&+L&&U(D(R(1).div(L).toFixed(j.decimals)).toString())},[j]),p.useEffect(()=>{Je(N?f:T,N),Qe()},[L]);const[Ht,At]=p.useState({tooltip:"",color:"",text:"",bg:""}),[Et,Ge]=p.useState(!1),Qe=()=>{var m,A;if(!$&&P&&L){Ge(!0);const J=R(L).sub(P).div(P).mul(100).toFixed(2);Ue(J);const W=R(J).gt(0),ie=W?J:J.split("-")[1],E={tooltip:"",color:"",text:"",bg:""};E.tooltip=`Limit order price is ${ie}% ${W?"higher":"lower"} than the market.`,((m=j==null?void 0:j.coin_type)==null?void 0:m.toLowerCase())==((A=r==null?void 0:r.coin_type)==null?void 0:A.toLowerCase())?Number(L)>Number(P)?(E.text="",E.color="#68FFD8"):Number(P)>Number(L)&&(E.text=`Your limit order price is ${ie}% ${W?"higher":"lower"} than market. You are selling at a much ${W?"higher":"lower"} rate. We recommend you to use`,E.color="#ffb62d",E.bg="rgba(255,202,104,0.1)"):Number(L)>Number(P)?(E.text=`Your limit order price is ${ie}% ${W?"higher":"lower"} than market. You are buying at a much ${W?"higher":"lower"} rate. We recommend you to use`,E.color="#ffb62d",E.bg="rgba(255,202,104,0.1)"):Number(P)>Number(L)&&(E.text="",E.color="#68FFD8"),At(E),Ge(!1);return}Ue("")},Rt=(m=!0)=>{console.log("ðŸš€ ~ handleMarketPriceClick ~ marketPrice:",P),Y(m),m&&(U(P||""),t())},Je=(m,A)=>{if(q(A),A?B(m):z(m),j&&s&&r&&+L&&+m)if(A){j.coin_type===s.coin_type?z(R(m).div(L).toString().toString()):z(R(m).mul(L).toString().toString());return}else{j.coin_type===r.coin_type?B(R(m).div(L).toString().toString()):B(R(m).mul(L).toString().toString());return}A?z(""):B("")},Ke=(m,A)=>{Ze(),q(A),Y(!0),A?m.coin_type===(r==null?void 0:r.coin_type)?a(`/limit/${m==null?void 0:m.coin_type}/${s==null?void 0:s.coin_type}`):a(`/limit/${m==null?void 0:m.coin_type}/${r==null?void 0:r.coin_type}`):m.coin_type===(s==null?void 0:s.coin_type)?a(`/limit/${r==null?void 0:r.coin_type}/${m==null?void 0:m.coin_type}`):a(`/limit/${s==null?void 0:s.coin_type}/${m==null?void 0:m.coin_type}`)},Ft=async()=>{r&&(Ke(r,!0),B(T),z(f))},Ze=()=>{B(""),z("")};p.useEffect(()=>()=>{y("7 Days")},[]);const[zt,Me]=p.useState(!1),Nt=m=>{switch(m){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:Dt}=es(),{transactionConfirmation:Bt}=me(),Wt=async()=>{const m={getShowInfo:(W,ie)=>{const E="Creating order",ue={modalDescriptionText:E,toastTitleText:E};return W==="success"&&(ue.toastDescriptionContent="",ue.modalDescriptionText="Created order successfully",ue.toastTitleText="Created order successfully"),W==="rejected"&&(ue.toastTitleText="Create order"),ue}};Bt(m);const A=Date.parse(new Date().toString())+(Nt(w)||k);console.log(" ~ handleSubmitOrder ~ expired_ts:",A),Me(!0);let J;(j==null?void 0:j.coin_type)===(r==null?void 0:r.coin_type)?J=L:J=R(1).div(L).toFixed(r.decimals);try{const W={pay_coin_type:s.coin_type,target_coin_type:r.coin_type,expired_ts:A,target_decimal:r.decimals,pay_decimal:s.decimals,price:Number(J),pay_coin_amount:Number(Ie(f,s.decimals).toFixed(0))},ie=await x.LimitOrder.placeLimitOrder(W),E=await u(ie,m);Me(!1),E&&(n(),i(),Ze())}catch(W){Dt(String(W)),Me(!1)}},{currentAccount:le}=X(),Xe=p.useMemo(()=>{const m=h(s==null?void 0:s.coin_type,f);return Number(m)==0&&Number(f)>0?!1:Number(m)<5},[s,f]),$t=p.useMemo(()=>{const m={text:"Place Limit Order",disabled:!1};return le!=null&&le.address?!s||!r?(m.disabled=!0,m.text=" Select a token",m):!Number(f)||!Number(T)?(m.disabled=!0,m.text="Enter an amount",m):Xe?(m.disabled=!0,m.text="Order size should be higher than $5",m):Number(f)>Number(V==null?void 0:V.balanceFormat)||!(V!=null&&V.balanceFormat)?(m.disabled=!0,m.text=`Insufficient ${s==null?void 0:s.symbol} balance`,m):(xe&&xe.errorCode&&(xe.errorCode===st.NoRouter||xe.errorCode===st.HoneyPot)&&(m.text="No Available Route",m.disabled=!0),m):(m.disabled=!1,m.text="Connect Wallet",m)},[le==null?void 0:le.address,s,r,xe,f,T,Xe,V]);return{priceImpactInfoLoading:Et,priceImpactInfo:Ht,fixPayCoin:N,onReverseClick:Ft,handleSelectToken:Ke,marketPrice:P,payCoin:s,targetCoin:r,handleAmountChange:Je,payAmount:f,targetAmount:T,payBalanceInfo:V,targetBalanceInfo:Te,payAmountValue:ke,targetAmountValue:ce,useMarketPrice:$,handleMarketPriceClick:Rt,inputPrice:L,setInputPrice:U,priceImpact:Tt,quoteToken:j,setQuoteToken:S,handleSubmitOrder:Wt,submitOrderLoading:zt,buttonTextStatus:$t}}const ws=({confirmData:t,isOpen:n,onClose:i,handleSubmitOrder:u,submitOrderLoading:x})=>{var j,w,v,C;const{payAmount:c,targetAmount:g,payCoin:h,targetCoin:a,inputPrice:d,expiresIn:l,quoteToken:o}=t,s=((j=o==null?void 0:o.coin_type)==null?void 0:j.toLowerCase())==((w=a==null?void 0:a.coin_type)==null?void 0:w.toLowerCase())?d:R(1).div(d).toString(),r=((v=o==null?void 0:o.coin_type)==null?void 0:v.toLowerCase())==((C=a==null?void 0:a.coin_type)==null?void 0:C.toLowerCase())?R(1).div(d).toString():d;return e.jsxs(Fe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:i,isCentered:!0,children:[e.jsx(ze,{}),e.jsxs(Ne,{children:[e.jsx(De,{children:e.jsx(ut,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(Be,{}),e.jsx(We,{textAlign:"center",p:"0px",children:e.jsxs(O,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(as,{coinA:{amount:D(c,h==null?void 0:h.decimals).toString()||"0",...h},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:D(g,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Price"}),e.jsx(de,{info:{pay_coin:h,target_coin:a,price:s,reseverPrice:r}})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(_,{children:"Expires in"}),e.jsx(_,{color:"text_caption",children:l})]}),e.jsx(G,{borderRadius:"8px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(G,{borderRadius:"8px",p:"8px",children:e.jsx(_,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(te,{onClick:()=>{u(),i()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},ys=({isOpen:t,onClose:n})=>{const{isApp:i}=re(),{setCustomExpiresVal:u,setExpiresIn:x}=oe(),[c,g]=p.useState(""),[h,a]=p.useState(""),d=v=>{const C=v.target.value.replace(/[^\d]/g,"");g(C)},l=v=>{const C=v.target.value.replace(/[^\d]/g,"");a(C)},[o,s]=p.useState({}),r=(v,C)=>{const S=Number(v||0)*60+Number(C||0),k=Math.floor(S/(60*24)),y=Math.floor(S%(60*24)/60),H=S%60;let f="";k>0&&(f+=k+"d "),y>0&&(f+=y+"h "),H>0&&(f+=H+"m "),s({timeText:f.trim()||"0 m",time:S*60*1e3})};p.useEffect(()=>{r(c,h)},[c,h]);const j=p.useMemo(()=>!c&&!h||Number(c)==0&&!h||Number(h)==0&&!c||Number(c)==0&&Number(h)==0,[c,h]),w=()=>{x(o==null?void 0:o.timeText),u(o==null?void 0:o.time),n()};return e.jsxs(Fe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:n,isCentered:!0,children:[e.jsx(ze,{}),e.jsxs(Ne,{maxW:"1200px",w:i?"calc(100vw - 32px)":"440px",children:[e.jsx(De,{mr:"-10px",children:e.jsxs(b,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(_,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(b,{gap:"0",align:"center",children:e.jsx(Be,{mt:"0",position:"static"})})]})}),e.jsx(We,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(O,{w:"100%",children:[e.jsx(ye,{children:e.jsxs(b,{children:[e.jsx(et,{value:c,onChange:d,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(_,{children:"Hours"})]})}),e.jsx(ye,{children:e.jsxs(b,{children:[e.jsx(et,{value:h,onChange:l,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(_,{children:"Minutes"})]})}),e.jsx(te,{onClick:w,disabled:j,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function Ss(t){const{expiresIn:n,setExpiresIn:i}=oe(),[u,x]=p.useState(!1),c=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(ye,{w:"156px",borderRadius:"16px",children:[e.jsxs(O,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(ge,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(b,{gap:"4px",children:[e.jsx(_,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(ee,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(os,{label:n,list:c,onListItemClick:g=>{g=="Custom"?x(!0):i(g)}})]}),u&&e.jsx(ys,{isOpen:u,onClose:()=>x(!1)})]})}function Cs(t){re();const{marketPrice:n,priceImpactInfo:i,priceImpactInfoLoading:u,priceImpact:x,inputPrice:c,handleMarketPriceClick:g,setInputPrice:h}=t,{payCoin:a,targetCoin:d,quoteToken:l,refreshPriceLoading:o,setQuoteToken:s}=oe();return e.jsx(ye,{w:"calc(100% - 156px)",children:e.jsxs(O,{w:"100%",gap:"20px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsxs(b,{children:[e.jsx(_,{fontSize:"13px",fontWeight:"500",children:(l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${tt(d==null?void 0:d.symbol,10)} at rate`:`Sell ${tt(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!o&&(u?e.jsx(Gt,{size:"sm"}):e.jsx(ge,{placement:"top",tooltip:e.jsx(_,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:i.tooltip}),children:e.jsxs(_,{color:i.color,children:[R(x).gt(0)?"+":"",Number(x)>1e4?">10000%":lt(x)]})}))]}),(n||o)&&e.jsx(te,{isLoading:o,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>g(!0),children:"Market"})]}),e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsx(gt,{value:c?Qt(c).toString():"",onChange:r=>{console.log("ðŸš€ ~ useEffect ~ useMarketPrice:",c,r),g(!1),h(r)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(b,{gap:"4px",children:[e.jsx(_,{textColor:"text_caption",children:l==null?void 0:l.symbol}),e.jsx(ee,{xlinkHref:"#icon-icon_swap1",onClick:()=>{d&&a&&((l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?s(d):s(a))}})]})]})]})})}function Ls(){const{expiresIn:t}=oe(),{buttonTextStatus:n,payBalanceInfo:i,targetBalanceInfo:u,payAmountValue:x,targetAmountValue:c,payAmount:g,targetAmount:h,payCoin:a,targetCoin:d,marketPrice:l,handleAmountChange:o,handleMarketPriceClick:s,handleSelectToken:r,inputPrice:j,setInputPrice:w,priceImpact:v,quoteToken:C,handleSubmitOrder:S,submitOrderLoading:k,onReverseClick:y,priceImpactInfoLoading:H,priceImpactInfo:f}=_s(),B=p.useMemo(()=>({payAmount:g,targetAmount:h,payCoin:a,targetCoin:d,inputPrice:j,expiresIn:t,quoteToken:C}),[g,h,a,d,j,t,C]),{isShowTradeChart:T,setIsShowTradeChart:z,isShowTradeOrders:N,setIsShowTradeOrders:q}=yt(),{onWalletModal:$}=X(),[Y,L]=p.useState("#icon-a-icon_trade"),U=M=>L(M?"#icon-icon_swap1":"#icon-a-icon_trade"),[P,V]=p.useState(!1),Te=jt(),ke=p.useMemo(()=>{const M=[];return a&&M.push(a),d&&M.push(d),M},[a,d]),{isApp:ce}=re();return e.jsxs(O,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(is,{currTradeTab:ns.Limit}),e.jsxs(b,{children:[e.jsx(ge,{showTooltip:!ce,placement:"bottom-end",tooltip:e.jsx(_,{fontSize:"12px",children:T?"Hide reference price":"View reference price"}),children:e.jsx(ae,{children:e.jsx(nt,{w:"28px",h:"28px",borderRadius:"8px",variant:"",xlinkHref:"#icon-icon_kline",svgFill:T?"primary":"",svgHover:T?"primary":ce?"text_paragraph":"text_caption",onClick:()=>z(!T)})})}),e.jsx(ge,{showTooltip:!ce,placement:"bottom-end",tooltip:e.jsx(_,{fontSize:"12px",children:N?"Hide Orders":"View Orders"}),children:e.jsx(ae,{children:e.jsx(nt,{w:"28px",h:"28px",borderRadius:"8px",variant:"",xlinkHref:"#icon-icon_order",svgFill:N?"primary":"",svgHover:N?"primary":ce?"text_paragraph":"text_caption",onClick:()=>q(!N)})})})]})]}),e.jsx(ts,{onClick:y,from:{title:"You Pay",balance:(i==null?void 0:i.balanceFormat)||"",value:g,amountValue:x,onChange:M=>{o(M,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:M=>{r(M,!0)}},to:{title:"You Receive",balance:(u==null?void 0:u.balanceFormat)||"",value:h,amountValue:c,onTokenChange:M=>{r(M,!1)},onChange:M=>{o(M,!1)},selectable:!0,placeholder:"0.0",token:d,half:!1,max:!1},iconParams:{xlinkHref:Y,svgFill:"text_caption",transform:Y==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:Y==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1)}}),e.jsxs(b,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(Cs,{marketPrice:l,priceImpactInfoLoading:H,priceImpactInfo:f,priceImpact:v,inputPrice:j,setInputPrice:w,handleMarketPriceClick:s}),e.jsx(Ss,{})]}),(f==null?void 0:f.text)&&l&&Number(v)!==0&&j&&e.jsxs(_,{color:f==null?void 0:f.color,lineHeight:"20px",bg:f==null?void 0:f.bg,p:"12px",borderRadius:"8px",children:[f==null?void 0:f.text,"Â ",e.jsx(_,{color:f==null?void 0:f.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>Te(`/swap/${a==null?void 0:a.coin_type}/${d==null?void 0:d.coin_type}`),children:"Cetus Swap"}),"Â instead."]}),e.jsx(te,{disabled:(n==null?void 0:n.disabled)||k,isLoading:k,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(n==null?void 0:n.text)=="Connect Wallet"?()=>$(!0):()=>V(!0),children:n==null?void 0:n.text}),P&&e.jsx(ws,{confirmData:B,isOpen:P,onClose:()=>V(!1),handleSubmitOrder:S,submitOrderLoading:k}),(a||d)&&e.jsx(ss,{addToken:!0,tokensInfo:ke,waringModalCancel:M=>{M.forEach(pe=>{(pe.coin_type===(a==null?void 0:a.coin_type)||pe.coin_type===(d==null?void 0:d.coin_type))&&r(void 0,pe.coin_type===(a==null?void 0:a.coin_type))})}})]})}function vs({orderInfo:t}){return e.jsxs(Ce.Fragment,{children:[e.jsxs(Q,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(F,{w:"30%",children:e.jsx(je,{info:t})}),e.jsx(F,{w:"20%",textAlign:"right",children:e.jsx(de,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(fe,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(be,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(Ae,{orderInfo:t})})]}),e.jsx(Q,{h:"16px"})]},t==null?void 0:t.order_id)}function Os(){const{currentAccount:t,onWalletModal:n}=X(),{myOrderList:i,orderListLoading:u}=ve();console.log("ðŸš€ ~ OrderTableList ~ myOrderList:",i);const x=10,[c,g]=p.useState([]),[h,a]=p.useState(0),[d,l]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){a(i==null?void 0:i.length);const o=(d-1)*x,s=o+x;g(i.slice(o,s))}},[d,i]),e.jsxs(ft,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(_t,{children:e.jsxs(Q,{children:[e.jsx(Z,{children:"Order Info"}),e.jsx(Z,{textAlign:"right",children:"Price"}),e.jsx(Z,{textAlign:"right",children:"Filled Size"}),e.jsx(Z,{textAlign:"right",children:"Expiry"}),e.jsx(Z,{textAlign:"right",children:"Action"})]})}),e.jsx(wt,{children:t!=null&&t.address?u?e.jsx(bt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):i.length===0?e.jsx(Q,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(se,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(Ce.Fragment,{children:[c.map(o=>e.jsx(vs,{orderInfo:o},o.order_id)),!u&&(i==null?void 0:i.length)>x&&e.jsx(F,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(ae,{w:"100%",children:e.jsx(Le,{total:h,size:x,currentPage:d,onChange:l})})})]}):e.jsx(Q,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(se,{type:"nowallet",onboard:()=>{n(!0)},borderRadius:"16px"})})})})]})}function Ts(){const{fetchByApi:t}=Jt(),{fetchTokenInfo:n}=Ve(),{currentAccount:i}=X(),[u,x]=p.useState(!1),[c,g]=p.useState([]);p.useEffect(()=>{g([])},[i==null?void 0:i.address]);const h=async(d,l)=>{try{l&&x(!0);const o=await t(ls,"GET",{wallet_address:d});if(o!=null&&o.list){const s=await a((o==null?void 0:o.list)||[]);return g(s),console.log("ðŸš€ ~ file: useGetLimitOrderHistory.ts:10 ~ getLimitOrderHistory ~ res:",s),s}}catch(o){console.log("getLimitOrderHistory ~ error:",o)}finally{x(!1)}},a=async d=>{const l=[];for(const o of d){const[s,r]=await Promise.all([n(o.pay_coin),n(o.target_coin)]);if(s&&r){const{total_pay_amount:j,remaining_amount:w,rate:v,obtained_amount:C,claimed_amount:S,target_balance:k,created_ts:y,expire_ts:H,cancel_reason:f,events:B}=o,T=B;console.log("ðŸš€ ~ formatLimitOrderList ~ eventList:",o,T),T.sort((L,U)=>U.block_time-L.block_time);const z=ne(j,s.decimals).toString(),N=xt.rateToPrice(v.toString(),s.decimals,r.decimals),q=K(1).div(N).toString();console.log("ðŸš€ ~ formatLimitOrderList ~ reseverPrice:",N,q);const $=ne(K(j).sub(w).toFixed(0),s.decimals).toString(),Y={order_id:o.order_id,pay_coin:s,target_coin:r,price:N,reseverPrice:q,total_pay_amount:z,remaining_amount:w,deal_amount:$,deal_rate:K($).div(z).toString(),expect_obtain_amount:K(z).mul(N).toString(),obtained_amount:C,claimed_amount:S,un_claimed_amount:"0",created_ts:y,expire_ts:H,status:Number(f)===0?_e.Completed:_e.Cancelled,events:T};console.log("ðŸš€ ~ formatLimitOrderList ~ info:",Y),l.push(Y)}}return l.sort((o,s)=>s.created_ts=o.created_ts),l};return{getLimitOrderHistory:h,historyOrderLoading:u,historyOrderList:c}}function ki(){const{currentAccount:t}=X(),{getLimitOrderHistory:n,historyOrderList:i,historyOrderLoading:u}=Ts(),{fetchMyLimitOrder:x}=Oe(),{setMyOrderList:c,myOrderList:g,orderListLoading:h}=ve(),{payCoin:a,targetCoin:d}=oe(),{fetchAccountBalance:l}=he();p.useEffect(()=>{t!=null&&t.address&&l()},[]);const{isShowTradeChart:o,isShowTradeOrders:s}=yt(),[r,j]=p.useState([]),[w,v]=p.useState({label:"Open Orders"}),C=p.useMemo(()=>{console.log("ðŸš€ ~ Limit ~ myOrderList:",g);const f=[];return f.push({label:"Open Orders",num:w.label==="Open Orders"&&g.length>0&&!h?g.length.toString():void 0}),f.push({label:"Order History",num:w.label==="Order History"&&r.length>0&&!u?r.length.toString():void 0}),f},[w.label,g,r,u,h]);p.useEffect(()=>{S(!0)},[w.label,t]),ds({onRpcChange:()=>{S(!0),t!=null&&t.address&&l()}});const S=f=>{console.log("ðŸš€ ~ getOrderList ~ currentAccount:",w.label==="Open Orders",t==null?void 0:t.address),t!=null&&t.address&&(w.label==="Open Orders"?x(t.address,f):(console.log("ðŸš€ ~ getOrderList ~ currentAccount:",t),n(t.address,f)))};p.useEffect(()=>{t!=null&&t.address&&(i==null?void 0:i.length)>0?j(i):(j([]),c([]))},[i,t==null?void 0:t.address]);const k=f=>{v(f)},{windowWidth:y,isApp:H}=re();return e.jsxs(O,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:H||o||s?"":"bg_img",children:[e.jsxs(b,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:o?"column":"column-reverse",lg:"row"},children:[(s||o)&&e.jsx(b,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:o?e.jsx(rs,{baseToken:a,quoteToken:d}):e.jsxs(O,{w:"100%",children:[e.jsx(ot,{tabList:C,currTab:w,myOrderList:g,handleChangeTab:k,getOrderList:S}),w.label==="Open Orders"&&e.jsx(rt,{}),w.label==="Order History"&&e.jsx(at,{historyOrderList:r,historyOrderLoading:u})]})}),e.jsx(Ls,{})]}),s&&o&&e.jsxs(O,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(ot,{getOrderList:S,tabList:C,currTab:w,myOrderList:g,handleChangeTab:k}),H&&e.jsx(ht,{h:"16px"}),w.label==="Open Orders"&&(H?e.jsx(rt,{}):e.jsx(Os,{})),w.label==="Order History"&&(H?e.jsx(at,{historyOrderList:r,historyOrderLoading:u}):e.jsx(js,{historyOrderList:r,historyOrderLoading:u}))]})]})}const ot=({tabList:t,currTab:n,myOrderList:i,handleChangeTab:u,getOrderList:x})=>{const{handleCancelOrder:c,cancelOrderLoading:g}=Lt(),{isApp:h}=re(),a=n.label==="Open Orders"&&i.length>1;return e.jsxs(b,{w:"100%",justifyContent:"space-between",flexDirection:{base:n.label==="Open Orders"&&i.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(b,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(mt,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:n.label,handleChangeTab:u}),h&&e.jsx(ct,{getOrderList:x})]}),(!h||a)&&e.jsxs(b,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(te,{onClick:()=>{c(i)},disabled:g,isLoading:g,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!h&&e.jsx(ct,{getOrderList:x})]})]})},ct=({getOrderList:t})=>{const{refreshCoinMarketPrice:n}=Ot(),[i,u]=p.useState(0);Kt({interval:1e3,callback:()=>{u(i+1),i>=20&&g()}});const{currentAccount:x}=X(),{fetchAccountBalance:c}=he(),g=h=>{u(0),t(h),n(),x!=null&&x.address&&c()};return e.jsx(cs,{value:i,min:0,max:20,onClick:()=>g(!0)})};export{ki as default};
