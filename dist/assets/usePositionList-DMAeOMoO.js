import{k as X,j as $,l as L,Y as x,b2 as K,ac as S,am as M,aS as h,d as _,A as v,z as F,a5 as O,b3 as W,W as B,b4 as Y,b5 as V}from"./index-DIvDX_Yh.js";import{a as q}from"./vendor-DsVemle5.js";import{u as j}from"./useToken-YYj-bY2H.js";import{a as U}from"./useFavoritePool-BJLivj5m.js";import{d as z,c as H,f as G,e as J}from"./useGetPoolList-CqBccx4u.js";const Q=(l,k)=>({showPosListLength:"",setShowPosListLength:t=>{l(()=>({showPosListLength:t}))},posApiPoolData:{},setPosApiPoolData:t=>{const f=k().posApiPoolData;l(()=>({posApiPoolData:{...f,...t}}))},myPosYieldValue:"",setMyPosYieldValue:t=>{l(()=>({myPosYieldValue:t}))},posBaseList:[],posBaseListGroupByPool:{},setPosBaseList:t=>{const f=t.reduce((p,n)=>{var P,c,a;return p[n.clmmPool]||(p[n.clmmPool]={list:[]}),(P=p[n.clmmPool])!=null&&P.tokenA||(p[n.clmmPool].isReverse=n==null?void 0:n.isReverse,p[n.clmmPool].tokenA=n==null?void 0:n.tokenA,p[n.clmmPool].tokenB=n==null?void 0:n.tokenB,p[n.clmmPool].displayTokenA=n==null?void 0:n.displayTokenA,p[n.clmmPool].displayTokenB=n==null?void 0:n.displayTokenB,p[n.clmmPool].clmmPoolAddress=n.clmmPool),(a=(c=p[n.clmmPool])==null?void 0:c.list)==null||a.push(n),p},{});console.log("ðŸš€ ~ file: index.ts:43 ~ groupedByClmmPool ~ groupedByClmmPool:",f),l(()=>({posBaseList:t,posBaseListGroupByPool:f,posBaseListIsLoading:!1}))},posBaseListLoading:!0,setPosBaseListLoading:t=>{l(()=>({posBaseListLoading:t}))},setPosBaseListIsLoading:t=>{l(()=>({posBaseListLoading:t}))},fullRangePosBaseList:[],setFullRangePosBaseList:t=>{l(()=>({fullRangePosBaseList:t,fullRangePosBaseListLoading:!1}))},fullRangePosBaseListLoading:!0,setFullRangePosBaseListLoading:t=>{l(()=>({fullRangePosBaseListLoading:t}))},posPoolsOriginalData:{},setPosPoolOriginalData:t=>{l(()=>({posPoolsOriginalData:t}))},posPoolsRelatedData:{},posPoolsRelatedDataGroupByPool:{},setPosPoolsRelatedData:t=>{const f=k().posPoolsRelatedData;l(()=>({posPoolsRelatedData:{...f,...t},posPoolsRelatedDataLoading:!1}))},posPoolsRelatedDataLoading:!0,setPosPoolsRelatedDataLoading:t=>{l(()=>({posPoolsRelatedDataLoading:t}))},posLiquidityData:{},setPosLiquidityData:t=>{const f=k().posLiquidityData;l(()=>({posLiquidityData:{...f,...t},posLiquidityDataLoading:!1}))},posLiquidityDataLoading:!0,setPosLiquidityDataLoading:t=>{l(()=>({posLiquidityDataLoading:t}))},posRewardsData:{},setPosRewardsData:t=>{const f=k().posRewardsData;l(()=>({posRewardsData:{...f,...t},posRewardsDataLoading:!1}))},posRewardsDataLoading:!0,setPosRewardsDataLoading:t=>{l(()=>({posRewardsDataLoading:t}))},farmsPosRewardsData:{},setFarmsPosRewardsData:t=>{l(()=>({farmsPosRewardsData:t,farmsPosRewardsDataLoading:!1}))},farmsPosRewardsDataLoading:!0,setFarmsPosRewardsDataLoading:t=>{l(()=>({farmsPosRewardsDataLoading:t}))},posFeeData:{},setPosFeeData:t=>{const f=k().posFeeData;l(()=>({posFeeData:{...f,...t},posFeeDataLoading:!1}))},posFeeDataLoading:!0,setPosFeeDataLoading:t=>{l(()=>({posFeeDataLoading:t}))},currentPosBaseInfo:null,setCurrentPosBaseInfo:t=>{l(()=>({currentPosBaseInfo:t,currentPosBaseInfoLoading:!1}))},currentPosBaseInfoLoading:!0,setCurrentPosBaseInfoLoading:t=>{l(()=>({currentPosBaseInfoLoading:t}))}}),b=X(Q);function Z(){const{peripherySdk:l}=$(),{getTokenListInfo:k}=j(),{setFarmsPosRewardsData:t,setFarmsPosRewardsDataLoading:f}=b(),p=q.useRef(l);return q.useEffect(()=>{p.current=l},[l.ClmmSDK.senderAddress]),{getFarmsRewardsData:async P=>{console.log("ðŸš€ ~ getFarmsRewardsData ~ positionBaseList:",P),f(!0);const c=P==null?void 0:P.filter(a=>a.posType==="farms").map(a=>({pool_id:a.farmsPool,position_nft_id:a.id}));try{let a={},s={};if(c&&c.length>0&&(a=await p.current.Farms.calculateFarmingRewards(c),console.log("ðŸš€ ~ getFarmsRewardsData ~ res:",a,p.current.ClmmSDK.senderAddress,c),a)){const e=Object.entries(a).map(([o,m])=>({id:o,rewarderAmountOwed:m}));console.log("ðŸš€ ~ file: useGetFarmsPosRewards.ts:27 ~ resArr ~ resArr:",e);const i=e.map(o=>o.rewarderAmountOwed.map(m=>m.rewarder_type)).flat(),r=await k(i);s=Object.fromEntries(e.map((o,m)=>{for(const y of o.rewarderAmountOwed){const{rewarder_amount:u,rewarder_type:w}=y,g=r==null?void 0:r.get(w);y.display_amount_owed=L(u.toString(),(g==null?void 0:g.decimals)||0),y.amount_owed=u.toString(),y.token=g}return[o.id,o.rewarderAmountOwed]}))}console.log("getFarmsRewardsData ~ posFarmsRewardsObj:",s),t(s)}catch(a){console.log("ðŸš€ ~ getPosFarmsRewards ~ error:",a)}}}}function ee(){const{setPosApiPoolData:l}=b(),{getFavoritePoolList:k}=U();return{getPosApiPoolData:async f=>{try{console.log("ðŸš€ ~ getPosApiPoolData ~ positionBaseList:",f);const n={needLocalData:!1,pools:Array.from(new Set(f==null?void 0:f.map(a=>a.clmmPool))),display_all_pools:!0,no_incentives:!0,has_mining:!0,has_farming:!0};console.log("ðŸš€ ~ getPosApiPoolData ~ params:",n);const P=await k(n)||[];console.log("ðŸš€ ~ getPosApiPoolData ~ res:",P);const c=P==null?void 0:P.list.reduce((a,s)=>(a[s.poolAddress]=s,a),{});l(c)}catch(p){console.log("ðŸš€ ~ getPosApiPoolData ~ error:",p)}}}}function oe(){const{clmmSdk:l}=x(),{setPosFeeData:k,setPosFeeDataLoading:t}=b();return{getPosFeeData:async p=>{console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ positionBaseList:",p),t(!0);const n=p==null?void 0:p.map(a=>({poolAddress:a.clmmPool,positionId:a.posId,coinTypeA:a.coinTypeA,coinTypeB:a.coinTypeB}));console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ feeParams ~ feeParams:",n);const P=await l.Position.fetchPosFeeAmount(n)||[];console.log("ðŸš€ ~ file: useGetPosfees.ts:11 ~ getPosFeeData ~ res:",P);const c=Object.fromEntries(P.map((a,s)=>{var o,m;const e=p[s],i=L(e.isReverse?a.feeOwedB.toString():a.feeOwedA.toString(),((o=e==null?void 0:e.displayTokenA)==null?void 0:o.decimals)||0),r=L(e.isReverse?a.feeOwedA.toString():a.feeOwedB.toString(),((m=e==null?void 0:e.displayTokenB)==null?void 0:m.decimals)||0);return[a.position_id,{feeOwedA:a.feeOwedA.toString(),feeOwedB:a.feeOwedB.toString(),displayFeeOwedA:i,displayFeeOwedB:r}]}));console.log("getPosFeeData ~ posFeesData:",c),k(c)}}}function se(){const{setPosLiquidityData:l,setPosLiquidityDataLoading:k}=b(),{getToken:t}=K(),f=({tokenA:n,tokenB:P,liquidity:c,currentSqrtPrice:a,lowerTick:s,upperTick:e,roundUp:i})=>{const r=S.tickIndexToSqrtPriceX64(s),o=S.tickIndexToSqrtPriceX64(e),m=M.getCoinAmountFromLiquidity(new h(c),new h(a),r,o,i),y=m.coinA.toString(),u=m.coinB.toString(),w=n.decimals,g=P.decimals,d=L(y,w||0),R=L(u,g||0);return{coinAmountA:y,coinAmountB:u,amountA:d,amountB:R}};return{getPosLiquidityData:async(n,P)=>{var a,s;k(!0);const c={};for(let e=0;e<n.length;e++){const i=n[e],r=P==null?void 0:P[i.clmmPool],{coinAmountA:o,coinAmountB:m,amountA:y,amountB:u}=f({tokenA:i.tokenA,tokenB:i.tokenB,liquidity:i.liquidity,currentSqrtPrice:r==null?void 0:r.current_sqrt_price,lowerTick:i.lowerTick,upperTick:i.upperTick,roundUp:!0}),w=z(i.lowerTick,i.upperTick);let g=i.tokenA.decimals,d=i.tokenB.decimals;g==null&&(g=(a=await t(i.tokenA.coin_type))==null?void 0:a.decimals),d==null&&(d=(s=await t(i.tokenB.coin_type))==null?void 0:s.decimals);const R=S.sqrtPriceX64ToPrice(new h(r==null?void 0:r.current_sqrt_price),g,d).toString(),{percentA:A,percentB:T}=H(y,u,R,w),D=L(o,g),N=L(m,d),I=_(N).div(R).add(D).toString(),E=_(D).mul(R).add(N).toString();c[i.posId]={coinAmountA:o,coinAmountB:m,displayCoinAmountA:i.isReverse?u:y,displayCoinAmountB:i.isReverse?y:u,displayPercentA:i.isReverse?T:A,displayPercentB:i.isReverse?A:T,onlyAmountA:I,onlyAmountB:E}}console.log("getPosLisuidityData ~ posLiquidityData:",c),l(c)},getCoinAmountFromLiquidity:f}}function te(){const{clmmSdk:l}=x(),{setPosPoolOriginalData:k,setPosPoolsRelatedData:t,setPosPoolsRelatedDataLoading:f,setFullRangePosBaseList:p,setFullRangePosBaseListLoading:n}=b();return{getPosPoolsOriginalObj:async a=>{const s=a==null?void 0:a.map(r=>r.clmmPool),e=[...new Set([...s])];let i={};if(e&&e.length>0){const r=await l.Pool.getPools(e,0,1e3);console.log("ðŸš€ðŸš€ðŸš€ ~ getPosPoolsOriginalObj ~ posAllPools:",r),i=Object.fromEntries(r==null?void 0:r.map(o=>{const m=a.find(d=>d.clmmPool===(o==null?void 0:o.poolAddress)),y=m.tokenA.decimals,u=m.tokenB.decimals,w=S.sqrtPriceX64ToPrice(new h(o==null?void 0:o.current_sqrt_price),y,u).toString(),g=_(1).div(w).toString();return[o==null?void 0:o.poolAddress,{...o,currentPrice:w,currentPriceReverse:g}]}))}return k(i),i},getPosPoolsRelatedData:(a,s)=>{f(!0),n(!0);const e={},i=[];a.forEach(r=>{console.log("ðŸš€ ~ posBaseList.forEach ~ item:",r);const o=s[r.clmmPool],m=r.tokenA.decimals,y=r.tokenB.decimals,u=S.sqrtPriceX64ToPrice(new h(o==null?void 0:o.current_sqrt_price),m,y).toString(),w=_(1).div(u).toString();let g="0",d="0";G(r.lowerTick,"min")?g="0":g=S.tickIndexToPrice(Number(r.lowerTick),m,y).toString(),G(r.upperTick,"max")?d="âˆž":d=S.tickIndexToPrice(Number(r.upperTick),m,y).toString();let R,A;d!=="âˆž"?A=_(1).div(_(d)).toString():A="0",g!=="0"?R=_(1).div(_(g)).toString():R="âˆž";let T="";o!=null&&o.is_pause?T="Closed":Number(u)>=Number(g)&&(d==="âˆž"||Number(u)<=Number(d))?T="Active":(Number(u)>Number(d)||Number(u)<Number(g))&&(T="Inactive"),(g==="0"&&d==="âˆž"||R==="0"&&A==="âˆž")&&r.posType==="clmm"&&i.push(r);const D=r.isReverse;e[r.posId]={currentPrice:o?v(D?w:u).toString():"",currentPriceReverse:o?v(D?u:w).toString():"",minPrice:v(D?A:g).toString(),minPriceResever:v(D?g:A).toString(),maxPrice:v(D?R:d).toString(),maxPriceResever:v(D?d:R).toString(),minPriceOrigin:o?D?A:g:"",maxPriceOrigin:o?D?R:d:"",currentStatus:o?T:"",fee:o==null?void 0:o.fee_rate,displayFee:_(o==null?void 0:o.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tickSpacing:o==null?void 0:o.tickSpacing,currentTickIndex:o==null?void 0:o.current_tick_index,curSqrtPrice:o==null?void 0:o.current_sqrt_price,liquidity:o==null?void 0:o.liquidity}}),t(e),p(i)}}}function ae(){const{clmmSdk:l}=x(),{getTokenListInfo:k}=j(),{setPosRewardsData:t,setPosRewardsDataLoading:f}=b();return{getPosRewardsData:async(n,P)=>{console.log("ðŸš€ ~ getPosRewardsData ~ positionBaseList:",n),f(!0);const c=n==null?void 0:n.filter(s=>s.posType!=="farms").map(s=>{const e=P[s.clmmPool];return{poolAddress:s.clmmPool,positionId:s.posId,coinTypeA:s.coinTypeA,coinTypeB:s.coinTypeB,rewarderInfo:e.rewarder_infos}});console.log("ðŸš€ ~ file: useGetPosRewards.ts:15 ~ getPosRewardsData ~ batchFetchPosRewardersAmountParams:",c);let a={};if(c&&c.length>0)try{const s=await l.Rewarder.fetchPosRewardersAmount(c),e=s==null?void 0:s.map(r=>r.rewarderAmountOwed.map(o=>o.coin_address)).flat(),i=await k(e);a=Object.fromEntries(s.map((r,o)=>{for(const m of r.rewarderAmountOwed){const{amount_owed:y,coin_address:u}=m,w=i==null?void 0:i.get(u);m.display_amount_owed=L(y.toString(),(w==null?void 0:w.decimals)||0),m.amount_owed=y.toString(),m.token=w}return[r.positionId,r.rewarderAmountOwed]})),console.log("getPosRewardsData ~ posRewardsData:",a)}catch(s){console.log("getPosRewardsData ~ error:",s)}t(a)}}}function C(){const l=(P,c)=>{if(c||c==0)return`Cetus LP | Pool${c}-${P}`},k=q.useMemo(()=>`${F.clmm_sdk_options.clmm_pool.package_id}::position::Position`,[F]),t=q.useMemo(()=>`${F.periphery_sdk_options.frams.package_id}::pool::WrappedPositionNFT`,[F]),f=q.useMemo(()=>`${F.burn_sdk_options.burn.package_id}::lp_burn::CetusLPBurnProof`,[F]);return{getClmmPosName:l,buildPositionType:k,buildFarmsPositionType:t,buildBurnPositionType:f,getTokenALock:(P,c)=>{if(O(P)&&O(c)){const{lowerTick:a,upperTick:s}=P,e=c==null?void 0:c.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s?!1:e>=s?!0:!(e<a)}return!1},getTokenBLock:(P,c)=>{if(O(P)&&O(c)){const{lowerTick:a,upperTick:s}=P,e=c==null?void 0:c.current_tick_index;if(e!==void 0&&a!==void 0&&s!==void 0)return e>=a&&e<s||e>=s?!1:(e<a,!0)}return!1}}}function re(){const{buildPositionType:l,buildFarmsPositionType:k,buildBurnPositionType:t}=C(),{getTokenListInfo:f}=j(),p=async(s,e)=>{const i=!J(s,e),r=await f([s,e]),o=r==null?void 0:r.get(s),m=r==null?void 0:r.get(e);return{isReverse:i,tokenA:o,tokenB:m,displayTokenA:i?m:o,displayTokenB:i?o:m}},n=async s=>{var d;const e=W(s),i=B(e.coin_type_a).full_address,r=B(e.coin_type_b).full_address,{isReverse:o,tokenA:m,tokenB:y,displayTokenA:u,displayTokenB:w}=await p(i,r),g=((d=s==null?void 0:s.data)==null?void 0:d.version)||"0";return{clmmPool:e.pool,posId:e.pos_object_id,id:e.pos_object_id,liquidity:e.liquidity,index:e.index,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:e.owner,coinTypeA:i,coinTypeB:r,posType:"clmm",tokenName:"",tokenA:m,tokenB:y,displayTokenA:u,displayTokenB:w,isReverse:o,version:g}},P=async s=>{var d;const e=Y.buildFramsPositionNFT(s),i=((d=s==null?void 0:s.data)==null?void 0:d.version)||"0",r=B(e.coinTypeA).full_address,o=B(e.coinTypeB).full_address,{isReverse:m,tokenA:y,tokenB:u,displayTokenA:w,displayTokenB:g}=await p(r,o);return{clmmPool:e.clmm_pool_id,farmsPool:e.pool_id,posId:e.clmm_position_id,id:e.id,liquidity:e.liquidity,index:e.name.split("-")[1],lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"farms",tokenName:e.name,isReverse:m,tokenA:y,tokenB:u,displayTokenA:w,displayTokenB:g,version:i}},c=async s=>{var d,R,A;const e=V.buildBurnPositionNFT((R=(d=s==null?void 0:s.data)==null?void 0:d.content)==null?void 0:R.fields),i=((A=s==null?void 0:s.data)==null?void 0:A.version)||"0",r=B(e.coinTypeA).full_address,o=B(e.coinTypeB).full_address,{isReverse:m,tokenA:y,tokenB:u,displayTokenA:w,displayTokenB:g}=await p(r,o);return{clmmPool:e.clmm_pool_id,posId:e.clmm_position_id,liquidity:e.liquidity,index:e.index,id:e.id,lowerTick:e.tick_lower_index,upperTick:e.tick_upper_index,owner:"",coinTypeA:r,coinTypeB:o,posType:"burn",tokenName:e.name,isReverse:m,tokenA:y,tokenB:u,displayTokenA:w,displayTokenB:g,version:i}};return{wrapClmmPosBaseInfo:n,wrapBurnPosBaseInfo:c,wrapFarmsPosBaseInfo:P,buildPosBaseInfo:async s=>{const e=B(s.data.type);return e.full_address===l?await n(s):e.full_address===k?await P(s):e.full_address===t?await c(s):null}}}function ue(){const{clmmSdk:l}=x(),{buildFarmsPositionType:k,buildBurnPositionType:t}=C(),{buildPosBaseInfo:f}=re(),{setPosBaseList:p,setFullRangePosBaseList:n,setPosBaseListLoading:P}=b(),{getPosPoolsOriginalObj:c,getPosPoolsRelatedData:a}=te(),{getPosLiquidityData:s}=se(),{getPosFeeData:e}=oe(),{getPosApiPoolData:i}=ee(),{getPosRewardsData:r}=ae(),{getFarmsRewardsData:o}=Z();return{getPositionBaseList:async(u,w)=>{console.log("ðŸš€ ~ getPositionBaseList ~ clmmPool:",w),P(!0);try{const g=await l.fullClient.getOwnedObjectsByPage(u,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{MatchAny:[{Package:F.clmm_sdk_options.clmm_pool.package_id},{StructType:k},{StructType:t}]}});console.log("ðŸš€ ~ file: usePositionList.ts:25 ~ getPositionList ~ ownerRes:",g);const d=[];for(const T of g.data){const D=await f(T);_(D==null?void 0:D.liquidity).lte(0)||!(D!=null&&D.displayTokenA)||!(D!=null&&D.displayTokenB)||D&&d.push(D)}console.log("ðŸš€ ~ file: usePositionList.ts:33 ~ getPositionList ~ posBaseList:",d);const R=d.sort((T,D)=>D.version-T.version);let A=[];return w?A=R==null?void 0:R.filter(T=>T.clmmPool===w):A=R,p(A),P(!1),(A==null?void 0:A.length)==0&&n([]),A}catch(g){return console.error("ðŸš€ ~ getPositionBaseList ~ 79 ~ error:",g),g instanceof TypeError?(P(!1),p([]),"Something went wrong, please change the rpc node and try again"):""}},getPosRelatedData:async(u,w=!1)=>{var g;console.log("ðŸš€ ~ getPosRelatedData ~ posBaseList:",w,u),o(u),w||(console.log("ðŸš€ ~ getPosRelatedData ~ isFarms:",u),i(u),e(u));try{const d=await c(u);console.log("ðŸš€ ~ getPosRelatedData ~ posPoolsOriginalData:",d),a(u,d),((g=Object.keys(d))==null?void 0:g.length)>0&&(s(u,d),w||r(u,d))}catch(d){console.error("ðŸš€ ~ getPosRelatedData ~ error: 96",d)}}}}export{C as a,ue as b,oe as c,ae as d,te as e,se as f,Z as g,re as h,b as u};
//# sourceMappingURL=usePositionList-DMAeOMoO.js.map
