import{a as p,j as e,X as xe,Y as me,Z as pe,$ as he,a8 as Ce,a0 as be,a1 as ge,V as N,H as F,T as j,v as te,f as ae,a2 as Se,a3 as we,a4 as Te,a5 as ye}from"./vendor-DXHkIl66.js";import{u as W}from"./useTransaction-CNh9Zl5M.js";import{j as P,k as U,as as R,w as M,d as Q,t as ee,C as Y,M as A,p as se,i as ve,B as oe,am as re,a as ce,c as z,v as K,F as ke,n as Ie,aZ as je,a_ as Me,aR as De,al as Re,ar as _e,a0 as Z,aK as Le}from"./index-Bs7BAmjF.js";import{M as H}from"./msafe-oYBkW7LJ.js";import{u as B}from"./useAccountBalance-_Hc7hvLr.js";import{u as ie}from"./useTokenBalance-n1SxwJSA.js";import{u as q,d as G,e as le,f as Oe,g as Ae,h as Pe}from"./useXCetusHelper-CeEnLdBO.js";import{T as de}from"./TradeInputGroup-Dgho1sl0.js";import{H as Ue}from"./HTextLabelBox-C3cJhX9e.js";import{C as Ee}from"./CheckBox-DtJXwMzF.js";import{H as Xe}from"./HighlightText-BLaAjUt8.js";import{u as Fe}from"./activeOrders-Bkvn9OM4.js";const st=(x,r,c="seconds")=>{const o=()=>{const n=x-new Date().getTime();if(n<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const l=Math.floor(n/1e3%60),f=Math.floor(n/1e3/60%60),t=Math.floor(n/(1e3*60*60)%24),a=Math.floor(n/(1e3*60*60*24)%30),C=Math.floor(n/(1e3*60*60*24*30)%12),b=Math.floor(n/(1e3*60*60*24*365));return c==="days"?{years:0,months:0,days:a+C*30+b*365,hours:t,minutes:f,seconds:l}:c==="months"?{years:0,months:C+b*12,days:a,hours:t,minutes:f,seconds:l}:{years:b,months:C,days:a,hours:t,minutes:f,seconds:l}},[s,i]=p.useState(o());return p.useEffect(()=>{const u=setInterval(()=>{const n=o();i(n),n.years===0&&n.months===0&&n.days===0&&n.hours===0&&n.minutes===0&&n.seconds===0&&(clearInterval(u),r&&r())},1e3);return()=>clearInterval(u)},[x]),s};function Be(){const{fetchAccountBalance:x}=B(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{currentAccount:o}=P(),{fetchOwnerVeNFT:s}=G(),{xCetusSdk:i}=U(),{veNFT:u}=R(),[n,l]=p.useState(""),[f,t]=p.useState(""),{balanceInfo:a}=ie(M.cetus_coin),C=d=>{l(d),t(d)},[b,T]=p.useState(!1),w=async()=>{try{T(!0);const d={venft_id:u==null?void 0:u.id,amount:ee(n,9).toFixed(0)},k=await i.XCetusModule.convertPayload(d),_=await c(k,{getShowInfo:D=>{const y=`Converting ${Y(n)} CETUS to ${Y(n)} xCETUS`,L={modalTitleText:"Convert",modalDescriptionText:y,toastDescriptionContent:y};if(D==="success"){const O=y.replace("Converting","Converted");L.modalDescriptionText=O,L.toastDescriptionContent=O}return L}},{msafeParams:{action:H.xCETUSConvert,txbParams:d}});T(!1),_&&(o&&s(o==null?void 0:o.address,!0),l(""),t(""),setTimeout(()=>{x()},2e3),r())}catch{T(!1)}},v=p.useMemo(()=>{const d={text:"Convert",disabled:!1};return o!=null&&o.address?+n?(+n&&Q(n).gt((a==null?void 0:a.balanceFormat)||0)&&(d.disabled=!0,d.text="Insufficient CETUS Balance"),d):(d.text="Enter an amount",d.disabled=!0,d):(d.text="Connect Wallet",d.disabled=!1,d)},[a==null?void 0:a.balanceFormat,o==null?void 0:o.address,n]);return{inputAmountFrom:n,inputAmountTo:f,handleInputChange:C,balanceInfoFrom:a,convertLoading:b,btnText:v.text,btnDisabled:v.disabled,handleConvertClick:w}}function ue(x){const{isOpen:r,onClose:c,onSubmitClick:o}=x,{setShowConvertModel:s}=R(),[i,u]=p.useState(!1);return e.jsxs(xe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:r,onClose:c,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(pe,{children:[e.jsx(he,{children:e.jsx(Ce,{fontWeight:"500",fontSize:"16px"})}),e.jsx(be,{}),e.jsx(ge,{textAlign:"center",p:"0px",children:e.jsxs(N,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[e.jsx(Xe,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),e.jsxs(F,{children:[e.jsx(Ee,{checked:i,onClick:()=>{u(!i)}}),e.jsx(j,{color:"text_caption",children:"Do not remind again."})]}),e.jsx(te,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{s(!i),o()},children:"Convert"})]})})]})]})}function ot(x){const{availableXCetusAmount:r,iconParams:c,onIconClick:o,onClose:s}=x,{currentAccount:i,onWalletModal:u}=P(),{inputAmountFrom:n,inputAmountTo:l,handleInputChange:f,balanceInfoFrom:t,btnText:a,btnDisabled:C,handleConvertClick:b,convertLoading:T}=Be(),{showConvertModel:w}=R(),[v,d]=p.useState(!1);return e.jsxs(N,{w:"100%",gap:"8px",children:[e.jsx(de,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(t==null?void 0:t.balanceFormat)||"",value:n,amountValue:"",loading:!1,onChange:k=>{f(k)},selectable:!1,placeholder:"0.0",token:M.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:A(r,9),value:l,half:!1,max:!1,amountValue:"",onChange:k=>{f(k)},selectable:!1,placeholder:"0.0",token:M.x_cetus_coin},iconParams:c}),e.jsx(te,{w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:C||T,isLoading:T,onClick:()=>{console.log(i,w,"showConvertModel"),i?w?d(!0):b().then(()=>{s&&s()}):u(!0)},children:a}),v&&e.jsx(ue,{isOpen:v,onClose:()=>{d(!1)},onSubmitClick:()=>{d(!1),b().then(()=>{s&&s()})}})]})}function Ve(x){const{fetchAccountBalance:r}=B(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:o}=W(),{currentAccount:s}=P(),{fetchOwnerVeNFT:i}=G(),{xCetusSdk:u}=U(),{veNFT:n}=R(),[l,f]=p.useState(""),[t,a]=p.useState(""),[C,b]=p.useState(180),[T,w]=p.useState(""),[v,d]=p.useState(!0),{balanceInfo:k}=ie(M.cetus_coin),_=(h,I)=>{d(I),I?f(h):a(h),y(h,I,C)},D=h=>{b(h),y(v?l:t,v,h)},y=async(h,I,E)=>{if(+h){const X=ee(h,9);if(I){const g=await u.XCetusModule.redeemNum(X,E);a(A(g.amount_out,9)),w(Q(g.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const g=await u.XCetusModule.reverseRedeemNum(X,E);f(A(g.amount_out,9)),w(Q(g.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else f(""),a(""),w("")},[L,O]=p.useState(!1),J=async()=>{if(!n)return;O(!0);const h={venft_id:n.id,amount:ee(l,9).toFixed(0),lock_day:C},I=u.XCetusModule.redeemLockPayload(h),E=await o(I,{getShowInfo:X=>{const g=`Redeeming ${Y(l)} xCETUS to ${Y(t)} CETUS`,V={modalTitleText:"Redeem",modalDescriptionText:g,toastDescriptionContent:g};if(X==="success"){const m=g.replace("Redeeming","Redeemed");V.modalDescriptionText=m,V.toastDescriptionContent=m}return V}},{msafeParams:{action:H.xCETUSRedeemLock,txbParams:h}});O(!1),E&&(s&&i(s==null?void 0:s.address,!0),f(""),a(""),r(),c())},$=p.useMemo(()=>{const h={text:"Redeem",disabled:!1};return s!=null&&s.address?+l?(+l&&Q(l).gt(x||0)&&(h.disabled=!0,h.text="Insufficient xCETUS Balance"),h):(h.text="Enter an amount",h.disabled=!0,h):(h.text="Connect Wallet",h.disabled=!1,h)},[x,s==null?void 0:s.address,l]);return{inputAmountFrom:l,inputAmountTo:t,handleInputChange:_,balanceInfoTo:k,convertLoading:L,btnText:$.text,btnDisabled:$.disabled,handleConvertClick:J,day:C,handleDayChange:D,percent:T}}function Ne(x){const{day:r,onChange:c}=x,o=p.useMemo(()=>`${r}D`,[r]),s=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return e.jsxs(ae,{children:[e.jsxs(F,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[e.jsxs(j,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[r," Days"]}),e.jsx(ve,{type:"outlineTab",tabList:s,currentTab:o,handleChangeTab:i=>{i.label==="MAX"?c(100):c(i.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),e.jsxs(Se,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(r),onChange:i=>c(i),children:[e.jsx(we,{h:"8px",children:e.jsx(Te,{h:"4px"})}),e.jsx(ye,{})]})]})}function at(x){const{availableXCetusAmount:r,iconParams:c,onIconClick:o,onClose:s}=x,{currentAccount:i,onWalletModal:u}=P(),{inputAmountFrom:n,inputAmountTo:l,handleInputChange:f,balanceInfoTo:t,btnText:a,btnDisabled:C,handleConvertClick:b,day:T,handleDayChange:w,percent:v,convertLoading:d}=Ve(r),{showConvertModel:k}=R(),[_,D]=p.useState(!1);return e.jsxs(N,{w:"100%",gap:"8px",children:[e.jsx(de,{onClick:o,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:r,value:n,amountValue:"",loading:!1,onChange:y=>{f(y,!0)},selectable:!1,placeholder:"0.0",token:M.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(t==null?void 0:t.balanceFormat)||"",value:l,half:!1,max:!1,amountValue:"",onChange:y=>{f(y,!1)},selectable:!1,placeholder:"0.0",token:M.cetus_coin},iconParams:c}),e.jsxs(oe,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(j,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),e.jsx(Ne,{day:T,onChange:y=>{w(Number(y))}})]}),e.jsx(oe,{borderRadius:"12px",p:"0px",border:"none",children:e.jsxs(N,{w:"100%",gap:"20px",children:[e.jsx(te,{mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:C||d,isLoading:d,onClick:()=>{i?k?D(!0):b().then(()=>{s&&s()}):u(!0)},children:a}),+v&&e.jsx(F,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:e.jsx(Ue,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:re(v),valueStyle:{fontSize:"14px"}})})]})}),_&&e.jsx(ue,{isOpen:_,onClose:()=>{D(!1)},onSubmitClick:()=>{D(!1),b().then(()=>{s&&s()})}})]})}function rt(){const{fetchAccountBalance:x}=B(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{xCetusSdk:o}=U(),{veNFT:s}=R(),{fetchOwnerVeNFT:i}=G(),{currentAccount:u}=P(),[n,l]=p.useState(!1);return{handleCancelOrder:async t=>{if(!s)return;l(!0);const a={venft_id:s.id,lock_id:t.id},C=o.XCetusModule.cancelRedeemPayload(a),b=await c(C,{},{msafeParams:{action:H.xCETUSCancelRedeem,txbParams:a}});l(!1),b&&(x(),r(),u&&i(u==null?void 0:u.address,!0))},cancelOrderLoading:n}}function ct(){const{fetchAccountBalance:x}=B(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{xCetusSdk:o}=U(),{veNFT:s}=R(),{fetchOwnerVeNFT:i}=G(),{currentAccount:u}=P(),[n,l]=p.useState(!1);return{handleClaimOrder:async t=>{if(l(!0),!s)return;const a={lock_id:t,venft_id:s.id},C=await o.XCetusModule.redeemPayload(a),b=await c(C,{},{useDevInspect:!1,msafeParams:{action:H.xCETUSRedeem,txbParams:a}});l(!1),b&&setTimeout(()=>{x(),r(),u&&i(u==null?void 0:u.address,!0)},2e3)},claimOrderLoading:n}}function it({xcetus_amount:x,cetus_amount:r,imageSize:c="24px"}){const{isApp:o}=ce();return o?e.jsxs(N,{w:"100%",align:"center",gap:"8px",children:[e.jsxs(F,{children:[e.jsx(z,{imageUrl:M.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(j,{color:"text_caption",children:[K(A(x,9),9)," xCETUS"]})]}),e.jsx(j,{color:"text_caption",transform:"rotate(90deg)",children:"→"}),e.jsxs(F,{children:[e.jsx(z,{imageUrl:M.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(j,{color:"text_caption",children:[K(A(r,9),9)," CETUS "]})]})]}):e.jsxs(F,{children:[e.jsx(z,{imageUrl:M.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(j,{color:"text_caption",children:[K(A(x,9),9)," xCETUS →"]}),e.jsx(z,{imageUrl:M.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(j,{color:"text_caption",children:[K(A(r,9),9)," CETUS "]})]})}function lt(){const{fetchAccountBalance:x}=B(),{signAndExecuteTransaction:r}=W(),{xCetusSdk:c}=U(),{veNFT:o}=R(),[s,i]=p.useState(!1),{fetchVeNFTDividendInfo:u}=le();return{handleClaimReward:async l=>{if(o){i(!0),console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:23 ~ handleClaimReward ~ rewardList:",l);try{const f=c.XCetusModule.redeemDividendV3Payload(o.id,l),t=await r(f,{},{useDevInspect:!0,msafeParams:{action:H.xCETUSClaimStakingRwewards,txbParams:{veNftId:o.id,rewardList:l}}});i(!1),t&&(x(),u(o.id))}catch(f){console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:40 ~ handleClaimReward ~ error:",f)}finally{i(!1)}}},claimRewardLoading:s}}function dt({children:x}){const{isApp:r}=ce();return e.jsx(ke,{placement:r?"bottom-end":"top-start",maxW:{base:"calc(100vw - 16px)",lg:"unset"},tooltip:e.jsxs(ae,{as:"div",lineHeight:"20px",maxW:"280px",children:[e.jsx(j,{as:"span",fontSize:"12px",color:"text_caption",children:"The estimated APR of the current epoch for all xCETUS holders. "}),e.jsx(j,{as:"span",fontSize:"12px",color:"text_highlight",children:"APR = ($ Rewards of the upcoming week * 52) / $ Total xCETUS staked * 100% "}),e.jsx(j,{as:"span",fontSize:"12px",color:"text_caption",children:"Both real-time value of rewards and CETUS price will affect the APR fluctuation."})]}),children:x})}function We(){const{getTokenPrice:x,fetchTokenPrices:r}=Ie();return{refreshCoinPriceInfo:async(o,s=!1)=>{const i=new Set;s||o.forEach(u=>{x(u,6e5)||i.add(u)}),console.log("🚀 ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:i,coinTypeList:o}),i.size>0&&await r(Array.from(i),!1)}}}function ut(){const{limitUserIndexerObj:x,setLimitUserIndexerObj:r,dcaUserIndexerObj:c,setDcaUserIndexerObj:o}=Fe(),{peripherySdk:s}=U();return{getLimitUserIndexer:async n=>{const l=x[n];if(l)return l;try{const f=new De;s.LimitOrder.buildGetUserIndexerHandle(n,f);const t=await s.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:f,sender:Re("0x0")}),a=s.LimitOrder.parsedQueryUserIndexerEvent(t);if(a)return r(n,a),a}catch(f){throw console.log("🚀 ~ getLimitUserIndexer ~ error:",f),f}},getDcaUserIndexer:async n=>{const l=c[n];if(l)return l;try{const{dca:f}=s.sdkOptions,{user_indexer_id:t}=je(f),a=await s.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"address",value:n}}),C=Me(a).value.fields.id.id;if(C)return o(n,C),C}catch(f){throw console.log("🚀 ~ getDcaUserIndexer ~ error:",f),f}}}}function ft(x=!1){const{xCetusSdk:r}=U(),{currentAccount:c}=P(),{fetchAccountBalance:o}=B(),{refreshCoinPriceInfo:s}=We(),{lockCetusList:i,veNFTLoading:u,lockCetusListLoading:n,clearData:l,owner:f,veNFT:t,XCetusManager:a,setXCetusManager:C,setDividendManager:b,setPhaseDividendInfoMap:T,phaseDividendInfoMap:w}=R(),{nextStartTime:v,currentPeriod:d,calculateCurrPeriod:k}=Oe(),{summaryRewardList:_,rewardList:D,totalRewardValue:y}=Ae(d),{fetchVeNFTDividendInfo:L}=le(),O=async m=>{try{const S=await r.XCetusModule.getXcetusManager(m);S&&C(S)}catch(S){console.log("🚀 ~ fetchXCetusManager ~ error:",S)}},J=async m=>{try{const S=await r.XCetusModule.getPhaseDividendInfo(m.toString());if(S)T(S);else{const fe=(m-1).toString();if(!w[fe]){const ne=await r.XCetusModule.getPhaseDividendInfo(m.toString());ne&&T(ne)}}}catch(S){console.log("🚀 ~ fetchXCetusManager ~ error:",S)}},$=async m=>{try{const S=await r.XCetusModule.getDividendManager(m);S&&b(S)}catch(S){console.log("🚀 ~ fetchXCetusManager ~ error:",S)}},{fetchOwnerVeNFT:h}=G(),I=p.useMemo(()=>{if(t&&c&&!n){const m=_e.getAvailableXCetus(t,i);if(Z(m).gte(0))return m}return"0"},[t==null?void 0:t.xcetus_balance,i]),E=p.useMemo(()=>{if(t){const m=Z(t.xcetus_balance).sub(I);if(m.gte(0))return m.toFixed(0)}return"0"},[t==null?void 0:t.xcetus_balance,I]),X=p.useMemo(()=>{if(a&&t){const m=Z(t.xcetus_balance).div(a.treasury).mul(100);return Z(m).lt(.01)?"<0.01%":re(m.toString(),3)}return c?"0%":"--"},[a==null?void 0:a.treasury,t==null?void 0:t.xcetus_balance]),g=p.useMemo(()=>{if(d){let m=w[d.toString()];return m===void 0&&(m=w[(d-1).toString()]),m}},[w,d]),{cetusApr:V}=Pe(g,a==null?void 0:a.treasury);return p.useEffect(()=>{if(g){const m=g.bonus_types.map(S=>Le(S,!1));m&&(m.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),s(m))}},[g==null?void 0:g.id]),p.useEffect(()=>{d&&d>0&&J(d)},[d]),p.useEffect(()=>{t&&!x&&L(t.id)},[t==null?void 0:t.id]),{fetchOwnerVeNFT:h,fetchAccountBalance:o,fetchXCetusManager:O,fetchDividendManager:$,fetchVeNFTDividendInfo:L,veNFTLoading:u,lockCetusListLoading:n,redeemingXCetusAmount:E,availableXCetusAmount:I,veNFT:t,myShare:X,nextStartTime:v,cetusApr:V,summaryRewardList:_,rewardList:D,totalRewardValue:y,lockCetusList:i,calculateCurrPeriod:k}}export{ot as C,dt as E,it as X,rt as a,ct as b,lt as c,ft as d,at as e,We as f,ut as g,st as u};
//# sourceMappingURL=useXCetus-DMHXEX2W.js.map
