import{a3 as A,aE as w,d as g,aK as U,Q as j,r as H,j as i,H as b,S as R,T as S,aL as T,I as v,ar as D}from"./index-BB14M7zw.js";import{u as B}from"./useBurn-Bm-HzT7i.js";import{M as E}from"./msafe-oYBkW7LJ.js";import{a as I}from"./usePositionList-I4qNuxva.js";function K(){const{getTokenAmountValue:_}=A(),f=(u,t,a)=>{if(!(u!=null&&u.length))return{total:"0",rewardAndFeeList:[]};let e="0";const o=[];u.forEach(n=>{const m=t[n==null?void 0:n.posId],x=a[n==null?void 0:n.posId]||[];if(m){const c=d(n==null?void 0:n.displayTokenA,m==null?void 0:m.displayFeeOwedA),s=d(n==null?void 0:n.displayTokenB,m==null?void 0:m.displayFeeOwedB);c&&o.push(c),s&&o.push(s),e=h(e,c==null?void 0:c.amountUSD,s==null?void 0:s.amountUSD)}x.forEach(c=>{if(Number(c==null?void 0:c.display_amount_owed)>0){const s=d(c==null?void 0:c.token,c==null?void 0:c.display_amount_owed,c==null?void 0:c.coin_address);s&&(o.push(s),e=h(e,s==null?void 0:s.amountUSD))}})});const l=p(o);return console.log("ðŸš€ ~ calculatePendingYield ~  total,:",l,e,l.length==1&&(e=="--"||Number(e)==0)),{total:(l==null?void 0:l.length)>0&&Number(e)==0?"--":e,rewardAndFeeList:l}},d=(u,t,a)=>{if(!u||!t)return null;const e=a||u.coin_type,o=_(e,t);return{coin_address:w(e,!1),amount:t,amountUSD:g(t).gt(0)&&g(o).lte(0)?"--":o,token:u}},h=(u,...t)=>{console.log("ðŸš€ ~ useCalculatePendingYield ~ amounts:",t);let a=g(u);return t.forEach(e=>{e&&e!=="--"&&a!=="--"&&(a=a.plus(e))}),a.toString()},p=u=>{const t={};return u.forEach(a=>{var n,m;const{coin_address:e,amount:o,amountUSD:l}=a;t[e]||(t[e]={...a,amount:"0",amountUSD:"0"}),l=="--"?t[e].amountUSD="--":t[e].amountUSD=t[e].amountUSD=="--"?"--":g((n=t[e])==null?void 0:n.amountUSD).plus(l||0).toString(),t[e].amount=g((m=t[e])==null?void 0:m.amount).plus(o||0).toString()}),Object.values(t).filter(a=>Number(a.amount)>0).sort((a,e)=>g(e.amountUSD=="--"?0:e.amountUSD).minus(a.amountUSD=="--"?0:a.amountUSD).toNumber())};return{calculatePendingYield:f}}const C=_=>_.startsWith("0x")?_.slice(2):_;function M(){const{clmmSdk:_}=U(),{peripherySdk:f,burnSdk:d}=j(),{getBurnClaimTxPayload:h}=B();return{getPosClaimFeeAndRewardTxPayload:async t=>{const{posType:a,id:e,clmmPool:o,coinTypeA:l,coinTypeB:n,rewarderCoinTypes:m,account:x}=t;let c,s;if(a==="clmm"){const r={pool_id:o,pos_id:e,rewarder_coin_types:m,coinTypeA:l,coinTypeB:n,collect_fee:!0};c=await _.Rewarder.collectRewarderTransactionPayload(r),s={action:E.ClaimFeeAndMining,txbParams:r}}else if(a==="farms"){const r={coinTypeA:l,coinTypeB:n,clmm_pool_id:o,position_nft_id:e,clmm_rewarder_types:m,collect_fee:!0};c=await f.Farms.claimFeeAndClmmReward(r),s={action:"FarmingClaimFeeAndReward",txbParams:r}}else a==="burn"&&(c=h({poolAddress:o,posId:e,coinTypeA:l,coinTypeB:n,account:x,rewarderCoinTypes:m}));return{tx:c,msafeParams:s}},getBatchHarvestFeeAndRewardsTxPayload:async(t,a,e)=>{console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ posBaseList:",t,a,e);const o=[],l=[],n=[];t.forEach(r=>{var P;const y=((P=a[r.posId])==null?void 0:P.map(F=>F.coin_address))||[];console.log("ðŸš€ ~ getBatchHarvestFeeAndRewardsTxPayload ~ rewarderCoinTypes:",y),r.posType=="clmm"?o.push({pool_id:r.clmmPool,pos_id:r.id,collect_fee:!0,rewarder_coin_types:y,coinTypeA:C(r.coinTypeA),coinTypeB:C(r.coinTypeB)}):r.posType=="farms"?l.push({pool_id:r.farmsPool,position_nft_id:r.id,clmm_pool_id:r.clmmPool,collect_fee:!0,collect_frams_rewarder:!1,clmm_rewarder_types:y,coinTypeA:r.coinTypeA,coinTypeB:r.coinTypeB}):n.push({pos:r==null?void 0:r.id,pool:r.clmmPool,coinTypeA:r.coinTypeA,coinTypeB:r.coinTypeB,rewarderCoinTypes:y,account:e})});const m=await f.Farms.batchHarvestAndClmmFeePayload(l,o),x=[];for(let r=0;r<n.length;r++){const y=n[r];(y==null?void 0:y.rewarderCoinTypes.length)>0&&x.push(y)}const c=d.Burn.createCollectFeesPaylaod(n,m),s=d.Burn.crateCollectRewardsPayload(x,c);return{txb:c,tx:s}}}}function Q({posId:_,displayTokenA:f,displayTokenB:d,symbolEllipsesDecimals:h=10}){const[p,u]=H.useState(!0),{posPoolsRelatedData:t}=I(),a=t[_];return i.jsxs(b,{children:[i.jsx(R,{isLoaded:!!(a!=null&&a.currentPrice),children:i.jsx(S,{color:"text_caption",children:p?a==null?void 0:a.currentPrice:a==null?void 0:a.currentPriceReverse})}),i.jsxs(b,{gap:"0",children:[i.jsx(S,{color:"primary_gray",children:T(p?d==null?void 0:d.symbol:f==null?void 0:f.symbol,h)}),i.jsx(S,{color:"primary_gray",children:"Â perÂ "}),i.jsx(S,{color:"primary_gray",children:T(p?f==null?void 0:f.symbol:d==null?void 0:d.symbol,h)})]}),i.jsx(v,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:e=>{D(e),u(!p)}})]})}export{Q as P,K as a,M as u};
