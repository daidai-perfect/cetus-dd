import{R as M,r as p,j as r,H as T,aC as H,T as i,a1 as W,b as $,a as V,aO as k,c as G,I as K,V as C,$ as j,S as J,a$ as O}from"./index-D49RffYW.js";import{u as Q}from"./useAccountBalance-D-weOZgA.js";import{u as X}from"./useTransaction-i5gFyneH.js";import{M as U}from"./msafe-oYBkW7LJ.js";import{c as Y,d as Z,b as D}from"./usePositionList-CyCzZNts.js";import{C as f}from"./CetusTooltip-7TnGbJNH.js";import{S as I}from"./SingleTokenInfo-Cvcahm1q.js";import{u as aa}from"./useToken-BlS8b5ft.js";import{P as ea,L as sa}from"./PriceRange-BFhvNGCl.js";function ra(){const{peripherySdk:a}=M();return{getStakeTxPayload:async(m,t)=>{const l={pool_id:t,clmm_position_id:m},s=await a.Farms.depositPayload(l),x={action:U.FarmingStake,txbParams:l};return{tx:s,msafeParams:x}},getUnstakeTxPayload:async(m,t)=>{const l={pool_id:m,position_nft_id:t},s=await a.Farms.withdrawPayload(l),x={action:U.FarmingUnstake,txbParams:l};return{tx:s,msafeParams:x}},getHarvestFarmsTxPayload:async(m,t)=>{const l={pool_id:m,position_nft_id:t},s=await a.Farms.harvestPayload(l),x={action:U.FarmingHarvest,txbParams:l};return{tx:s,msafeParams:x}},getBatchHarvestFarmsTxPayload:async m=>({tx:await a.Farms.batchHarvestPayload(m),msafeParams:{action:"FarmingBatchHarvest",txbParams:m}})}}function ta(){const{getBatchHarvestFarmsTxPayload:a,getStakeTxPayload:n,getUnstakeTxPayload:P,getHarvestFarmsTxPayload:S}=ra(),{signAndExecuteTransaction:u}=X(),[m,t]=p.useState(!1),[l,s]=p.useState(!1),{fetchAccountBalance:x}=Q();return{toStakePos:async(w,g,y,o)=>{s(!0);try{const{tx:h,msafeParams:d}=await n(w,g),c=await u(h,{getShowInfo:()=>({modalDescriptionText:`Stake ${y}`,toastTitleText:"Stake"})},{msafeParams:d});c&&o(c.events),s(!1)}catch{s(!1)}},toUnStakePos:async(w,g,y,o)=>{s(!0);try{const{tx:h,msafeParams:d}=await P(g,w);await u(h,{getShowInfo:()=>({modalDescriptionText:`Unstake ${y}`,toastTitleText:"Unstake"})},{msafeParams:d})&&(x(),o()),s(!1)}catch{s(!1)}},toClaimPos:async(w,g,y)=>{t(!0);try{const{tx:o,msafeParams:h}=await S(g,w);await u(o,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h})&&(x(),y()),t(!1)}catch{t(!1)}},toClaimAllPos:async(w,g)=>{t(!0);try{const y=[];w.forEach(c=>{c!=null&&c.farmsPool&&y.push({pool_id:c.farmsPool,position_nft_id:c.id})});const{tx:o,msafeParams:h}=await a(y);await u(o,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:h})&&setTimeout(async()=>{x(),g()},2e3),t(!1)}catch{t(!1)}},claimLoading:m,unstakeLoading:l}}function ha({positionInfo:a,apiInfo:n}){var E,z;const{farmsPosRewardsData:P,posPoolsRelatedData:S,posPoolsOriginalData:u}=Y(),{getPositionBaseList:m}=Z(),{currentAccount:t}=W(),{isApp:l}=$(),s=P[a==null?void 0:a.id],x=s==null?void 0:s.reduce((e,b)=>e+b.display_amount_owed,0),_=S[a==null?void 0:a.posId],L=(_==null?void 0:_.currentStatus)=="Active",{getClmmPosName:B}=D(),v=p.useMemo(()=>{var e;if(a!=null&&a.tokenName)return a==null?void 0:a.tokenName;{const b=(e=u==null?void 0:u[a==null?void 0:a.clmmPool])==null?void 0:e.index;return B(a==null?void 0:a.index,b)}},[a==null?void 0:a.tokenName,a==null?void 0:a.index,a==null?void 0:a.clmmPool,u]),w=V(),g=()=>{setTimeout(async()=>{await m(t==null?void 0:t.address)},2e3)},{toStakePos:y,toUnStakePos:o,toClaimPos:h,unstakeLoading:d,claimLoading:c}=ta(),R=async e=>{y(a==null?void 0:a.id,n==null?void 0:n.farmsPoolAddress,v,g)},q=async()=>{o(a==null?void 0:a.id,a==null?void 0:a.farmsPool,v,g)},F=async()=>{h(a==null?void 0:a.id,a==null?void 0:a.farmsPool,g)},A=p.useMemo(()=>(s==null?void 0:s.length)>0?s.reduce((e,b)=>k(e).plus(b==null?void 0:b.display_amount_owed).toString(),"0"):"0",[s,t==null?void 0:t.address,c,d]);return r.jsxs(T,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:"12px",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[r.jsx(ea,{positionInfo:a,symbolEllipsesDecimals:10,labelInfo:{text:v,style:{color:"text_caption",mb:"-2px"}},children:r.jsxs(T,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:e=>{G(e),w(`/position-detail/${a==null?void 0:a.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[r.jsx(i,{fontSize:"12px",color:"primary",children:"Manage position"}),r.jsx(K,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),r.jsxs(T,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[r.jsxs(C,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[r.jsx(i,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),r.jsx(sa,{positionInfo:a,fontSize:"14px"})]}),r.jsxs(C,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[r.jsxs(T,{gap:"4px",children:[r.jsx(i,{color:"primary_gray",children:"Earnings"}),!l&&r.jsx(j,{isLoading:c,disabled:d||c||k(x).eq(0),onClick:d||c||k(x).eq(0)?()=>{}:F,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),r.jsxs(T,{children:[r.jsx(J,{isLoaded:!!A,children:r.jsx(C,{align:"flex-end",children:s&&(s==null?void 0:s.length)>0&&k(A).gt(0)?s==null?void 0:s.map(e=>{var b;return r.jsx(O.Fragment,{children:k(e==null?void 0:e.display_amount_owed).gt(0)&&r.jsx(N,{coinType:(b=e==null?void 0:e.token)==null?void 0:b.coin_type,amount:(e==null?void 0:e.display_amount_owed)||0,tokenInfo:e==null?void 0:e.token},e==null?void 0:e.coinType)},e==null?void 0:e.rewarder_type)}):((E=n==null?void 0:n.farmsRewarderList)==null?void 0:E.length)>0?(z=n==null?void 0:n.farmsRewarderList)==null?void 0:z.map(e=>r.jsx(N,{coinType:e==null?void 0:e.coinType,amount:"0"},e==null?void 0:e.coinType)):r.jsx(i,{textColor:"text_caption",textAlign:"right",children:"--"})})}),l&&r.jsx(j,{isLoading:c,disabled:d||c||k(x).eq(0),onClick:d||c||k(x).eq(0)?()=>{}:F,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),r.jsxs(C,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(a==null?void 0:a.posType)=="farms"&&r.jsx(j,{disabled:d,isLoading:d,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:q,children:"Unstake"}),(a==null?void 0:a.posType)=="clmm"&&!L&&r.jsx(f,{placement:"top",tooltip:r.jsx(i,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:r.jsx(j,{disabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),(a==null?void 0:a.posType)=="clmm"&&L&&r.jsx(j,{disabled:d,isLoading:d,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:R,children:"Stake"})]})]})]})}const N=({coinType:a,amount:n,tokenInfo:P,boxStyle:S,textAlign:u="right"})=>{var l;const{getTokenInfo:m}=aa(),t=s=>{if(s)try{return m(s)}catch(x){console.error("Error fetching token info:",x)}};return r.jsxs(T,{gap:"0",...S,children:[r.jsx(I,{token:P||t(H(a)),coinType:H(a),imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),r.jsxs(i,{textColor:"text_caption",textAlign:u,children:[n," ",(P==null?void 0:P.symbol)||((l=t(H(a)))==null?void 0:l.symbol)]})]})};export{ha as E,N as R,ta as u};
