import{a as x,j as i,a7 as ze,T as b,V as $,H as c,u as te,am as Ci,v as Ne,R as vi,f as He,ab as _i,az as Ri}from"./vendor-DsVemle5.js";import{A as Li}from"./index-CI9BE_b8.js";import{C as Fi}from"./CoinPairInfo-CRvWBqVO.js";import{S as Mi}from"./Slippage-uq4mzInu.js";import{u as Ei,L as Di,S as Le}from"./LiquidityRangeChart-virEj8IX.js";import{u as ai,a as Wi}from"./useTransaction-_40Gj-Xj.js";import{u as Vi,a as zi,P as Ni}from"./PositionCurrentPrice-DywqzNbA.js";import{a as Te,b as Ge}from"./useNotifiSubscription-DtbsDptI.js";import{c as Hi,d as Gi,u as re,a as pi}from"./usePositionList-DPh0B0ja.js";import{n as Me,A as ae,a as Ze,B as oe,c as Be,$ as ye,Q as di,d as de,e as oi,r as Ue,x as Zi,a3 as Ui,l as Ie,a5 as Oi,w as Yi,a6 as Pe,a2 as $i,a1 as qi,a4 as Qi,ac as Ji,m as Ki,z as ei,i as Xi}from"./index-ptnn7YYs.js";import{u as Oe}from"./useAccountBalance-BlkjpDIb.js";import{S as fi,A as Bi}from"./SingleTokenInfo-BK4bHte8.js";import{L as Ii}from"./PriceRange-Bbswl8vh.js";import{c as Pi,e as el,a as xi,g as il,Z as ll,R as sl,b as tl}from"./ZapSwitch-Dj1I4tYZ.js";import{u as al,T as pl,F as dl,R as ol}from"./RemoveBlock-DJWHB9hn.js";import{u as xl}from"./global-XGPon1rE.js";import{f as Fe}from"./index-Cr9gqCFC.js";import{u as ii}from"./useTokenBalance-BmzoUDH9.js";import{u as ml}from"./useInsufficientBalanceToast-BjqRjKwn.js";import{u as nl}from"./usePosAdd-Xc3N56oJ.js";import{v as li}from"./v4-C6aID195.js";import{T as cl}from"./TradeInputGroup-cjeY54io.js";import{T as gl}from"./TooltipIcon-Cc-8Tse6.js";import{P as rl}from"./PositionStatus-WnMSBgkX.js";import{R as bl}from"./RangeValue-rGit3VvP.js";import{u as hl}from"./index-CevVDf0u.js";import{b as jl,u as wl}from"./useGetPoolList-BWUJTUb5.js";import{u as yl}from"./swapWidget-BX_OS0Vd.js";import{B as Tl}from"./BackButton-B7ddYl_1.js";import{R as si}from"./RefreshButton-WcxAkxJ5.js";import{u as kl}from"./useRpcListener-zb5WjE9D.js";import"./PoweredByHaedal-CSYJZkP0.js";import"./HTextLabelBox-BSdt2JjM.js";import"./VTextLabelBox-7Zj5rpY_.js";import"./linear-DYpwdEgO.js";import"./liquidity-CGH69t9q.js";import"./usePreviousValue-CMQTRdbk.js";import"./ActionButton-Dr_wR4Ze.js";import"./useTrack-DUPD-CMT.js";import"./useSigner-CA1OjupR.js";import"./useBurn-Dg2fme1h.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-CxuyiQiK.js";import"./useXCetusHelper-CO5x0Hf_.js";import"./useToken-D0Y8EMfE.js";import"./index-CB7ViKlR.js";import"./debounce-Bdyap_Ai.js";import"./index-BzFku5sE.js";import"./useFavoritePool-BRmN064e.js";import"./useWrapPoolData-Dtc_nARB.js";import"./CopyButton-BDbKvN3H.js";import"./DepositRatio-BtLi2arX.js";import"./FreshProgressV2-CujxstRu.js";import"./usePriceImpact-DsXChPO7.js";import"./useSwapHelper-CkdGRiyG.js";import"./ErrorTips-BCywB7U6.js";import"./ExpendItem-DP88Bi04.js";import"./_getAllKeysIn-BPxU3Eca.js";function Al(){var I,U,D,N,P,J;const{tokenAmountAfterA:e,tokenAmountAfterB:o,currentPosDetailTab:d,curPosContractPoolInfo:a}=Te(),{getPosFeeData:W}=Hi(),{getPosRewardsData:n}=Gi(),{currentAccount:t}=Me(),{currentPosBaseInfo:s,posFeeData:h,posRewardsData:j,posLiquidityData:C,currentPosBaseInfoLoading:V,posFeeDataLoading:R,posRewardsDataLoading:E}=re();Ge();const l=x.useMemo(()=>C[s==null?void 0:s.posId],[C,s==null?void 0:s.posId]),v=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",h[s==null?void 0:s.posId]),h[s==null?void 0:s.posId]),[h,s==null?void 0:s.posId]),L=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",j[s==null?void 0:s.posId]),j[s==null?void 0:s.posId]),[j,s==null?void 0:s.posId]);ae(l==null?void 0:l.displayCoinAmountA,void 0,!0),ae(l==null?void 0:l.displayCoinAmountB,void 0,!0);const[S,_]=x.useState(!1),[z,T]=x.useState("--"),{signAndExecuteTransaction:F}=ai(),{getPosClaimFeeAndRewardTxPayload:H}=Vi(),{calculatePendingYield:k}=zi();x.useEffect(()=>{if(!V&&!R&&!E){const{total:w}=k([s],h,j);T(w)}},[V,R,E]);const{fetchAccountBalance:G}=Oe(),B=async()=>{_(!0);try{const w=(L==null?void 0:L.map(Z=>Z.coin_address))||[],K={posType:s==null?void 0:s.posType,id:s==null?void 0:s.id,clmmPool:s==null?void 0:s.clmmPool,coinTypeA:s==null?void 0:s.coinTypeA,coinTypeB:s==null?void 0:s.coinTypeB,rewarderCoinTypes:w,account:t==null?void 0:t.address};console.log("ðŸš€ ~ toClaim ~ params.currentPosBaseInfo:",K,s);const{tx:y,msafeParams:m}=await H(K);console.log("ðŸš€ ~ toClaim ~ tx:",y);const u=await F(y,{getShowInfo:Z=>{const Y={modalDescriptionText:"",toastTitleText:""};return Z==="success"&&(Y.toastTitleText="Claim Successful"),Y}},{msafeParams:m});console.log("ðŸš€ ~ toClaim ~ res:",u),u&&setTimeout(()=>{G(),W([s]),n([s],{[a.poolAddress]:a})},2e3),_(!1)}catch(w){_(!1),console.log("ðŸš€ ~ toClaim ~ error:",w)}},O=e!==""||o!=="",{isApp:A}=Ze();return i.jsxs(oe,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(oe,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(ze,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(ze,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(b,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(Ii,{positionInfo:s,haveTooltip:!1})]}),i.jsxs($,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(c,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(c,{gap:"4px",children:[i.jsx(Be,{imageUrl:(I=s==null?void 0:s.displayTokenA)==null?void 0:I.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(U=s==null?void 0:s.displayTokenA)==null?void 0:U.coin_type:""}),i.jsx(te,{isLoaded:!!s&&!!l,children:i.jsxs(c,{gap:"4px",children:[i.jsx(b,{color:"primary",children:ye((D=s==null?void 0:s.displayTokenA)==null?void 0:D.symbol)}),i.jsxs(b,{color:"primary",children:[l==null?void 0:l.displayPercentA,"%"]})]})})]}),i.jsxs(c,{gap:"4px",children:[i.jsx(Be,{imageUrl:(N=s==null?void 0:s.displayTokenB)==null?void 0:N.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(P=s==null?void 0:s.displayTokenB)==null?void 0:P.coin_type:""}),i.jsx(te,{isLoaded:!!s&&!!l,children:i.jsxs(c,{gap:"4px",children:[i.jsx(b,{color:"primary_green",children:ye((J=s==null?void 0:s.displayTokenB)==null?void 0:J.symbol)}),i.jsxs(b,{color:"primary_green",children:[l==null?void 0:l.displayPercentB,"%"]})]})})]})]}),i.jsx(Ci,{w:"200px",h:"4px",value:l==null?void 0:l.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(we,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:l==null?void 0:l.displayCoinAmountA,afterAmount:e}),i.jsx(we,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:l==null?void 0:l.displayCoinAmountB,afterAmount:o})]}),i.jsx(oe,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsxs(ze,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(b,{color:"primary_gray",children:"Pending Yield"}),i.jsx(te,{isLoaded:!!z&&!!s&&!!h&&!!j,children:i.jsx(b,{color:"text_caption",fontSize:"16px",children:di(z,2)})})]}),i.jsx(Ne,{isLoading:S,disabled:Number(z)==0||R||E||S||!v,onClick:B,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(c,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(we,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:v==null?void 0:v.displayFeeOwedA,afterAmount:O?"0":""}),i.jsx(we,{label:A?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:v==null?void 0:v.displayFeeOwedB,afterAmount:O?"0":""}),L==null?void 0:L.map((w,K)=>i.jsx(vi.Fragment,{children:de(w.amount_owed).gt(0)&&i.jsx(we,{label:A?K==0?"Mining Rewards":"":"Mining Rewards",token:w==null?void 0:w.token,amount:w==null?void 0:w.display_amount_owed,afterAmount:O?"0":""})},w==null?void 0:w.coin_address))]})]})}const we=({label:e,token:o,amount:d,afterAmount:a,isLoading:W})=>{const{isApp:n}=Ze(),{getExplorerUrl:t}=oi();return i.jsxs($,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(c,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(b,{color:"primary_gray",children:e}),i.jsxs(c,{children:[i.jsx(He,{onClick:n?()=>window.open(t(o==null?void 0:o.coin_type,"coin")):()=>{},children:i.jsx(fi,{haveTooltip:!n,coinType:o?o==null?void 0:o.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(te,{isLoaded:!W&&!!d,children:i.jsx(b,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:ae(d)})}),i.jsx(b,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:ye(o==null?void 0:o.symbol)})]})]}),a!==""&&a&&i.jsxs(c,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(b,{color:"primary",children:ae(a)}),i.jsx(b,{color:"primary",children:"after"})]})]})};function ul(){const{currentPosBaseInfo:e,posPoolsOriginalData:o,posPoolsRelatedData:d,posRewardsData:a,posLiquidityData:W}=re(),n=a[e==null?void 0:e.posId],{getTokenAmountValue:t}=Ue(),{transactionConfirmation:s}=Wi(),{preAdd:h,getAddTsPayload:j,getClmmCreateAddData:C,getFarmsCreateAddData:V}=nl(),{getTokenALock:R,getTokenBLock:E}=pi(),{getCurrentPosBaseInfo:l}=Ge(),{setTokenAmountAfterA:v,setTokenAmountAfterB:L,currentPoolSqrtPrice:S,isFixedDisplayTokenA:_,setIsFixedDisplayTokenA:z,curPosContractPoolInfo:T,currentPosDetailTab:F,isPosDetailRefresh:H,useZapIn:k}=Te(),{getZapDepositToastInfo:G,getZapDepositTx:B,reCalculateZapData:O}=Pi(),{preDepositeData:A,setZapAmount:I,setPreDepositeData:U}=el(),[D,N]=x.useState(!1),[P,J]=x.useState(""),[w,K]=x.useState(""),[y,m]=x.useState(""),[u,Z]=x.useState(""),Y=x.useMemo(()=>W[e==null?void 0:e.posId],[W,e==null?void 0:e.posId]),ke=ae(Y==null?void 0:Y.displayCoinAmountA,void 0,!0),Ae=ae(Y==null?void 0:Y.displayCoinAmountB,void 0,!0);x.useEffect(()=>{if(+y||+u){const p=+y,g=+u;v(de(p).plus(ke).toString()),L(de(g).plus(Ae).toString())}else v(""),L("")},[y,u]);const r=e==null?void 0:e.displayTokenA,M=e==null?void 0:e.displayTokenB,{mevProtect:mi,maxCapForGas:ni,transactionMode:ci,customGasPrice:gi}=xl(),{balanceInfo:be}=ii(r),{balanceInfo:he}=ii(M),ri=t(r==null?void 0:r.coin_type,y),bi=t(M==null?void 0:M.coin_type,u),[Ee,De]=x.useState(""),Ye=x.useRef("");x.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",Ee),Ye.current=Ee},[Ee]);const ue=()=>{m(""),Z(""),N(!1),De("")},Se=x.useMemo(()=>R(e,T),[T==null?void 0:T.current_tick_index,e]),Ce=x.useMemo(()=>E(e,T),[T==null?void 0:T.current_tick_index,e]),$e=e!=null&&e.isReverse?Ce:Se,qe=e!=null&&e.isReverse?Se:Ce,Qe=Zi((p,g,q)=>{var ge,f;if(F!=="increase")return;const Q=g?(ge=e==null?void 0:e.displayTokenA)==null?void 0:ge.decimals:(f=e==null?void 0:e.displayTokenB)==null?void 0:f.decimals,je=Ui(p,Q),_e=e==null?void 0:e.tokenA,ee=e==null?void 0:e.tokenB,ie=e==null?void 0:e.lowerTick,xe=e==null?void 0:e.upperTick,me=e==null?void 0:e.isReverse,le={amount:je,tokenA:_e,tokenB:ee,isTokenA:me?!g:g,lowerTick:ie,upperTick:xe,curSqrtPrice:S,isReverse:me,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",le);const{displayCoinAmountA:pe,displayCoinAmountB:ne,tokenMaxA:ce,tokenMaxB:se}=h(le);Ye.current===q?(J(ce),K(se),g?Z(ne||""):m(pe||"")):ue(),N(!1)},500),ve=()=>{if((y||u)&&Oi(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const p=_?y:u;if(+p){const g=li();De(g),Qe(p,_,g)}}};x.useEffect(()=>{F=="increase"&&H&&ve()},[H]);const hi=(p,g)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!p,+p,p),!p){ue();return}if(z(g),g?m(p):Z(p),+p){N(!0);const q=li();De(q),console.log("ðŸš€ ~ handleAmountChange ~ params:",p),Qe(p,g,q)}else g?Z(""):m("")},{currentAccount:X}=Me(),ji=x.useMemo(()=>{const p={text:"Add More Liquidity",disabled:!1};return X!=null&&X.address?!+y&&!+u?(p.text="Enter an amount",p.disabled=!0,p):!$e&&y&&de(y).gt((be==null?void 0:be.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${ye(r==null?void 0:r.symbol,10)} Balance`,p):!qe&&u&&de(u).gt((he==null?void 0:he.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${ye(M==null?void 0:M.symbol,10)} Balance`,p):((!Se&&!Ce&&(!+y||!+u)||(e==null?void 0:e.posType)=="burn")&&(p.disabled=!0),p):(p.text="Connect Wallet",p.disabled=!1,p)},[y,u,be,he,X==null?void 0:X.address]),{signAndExecuteTransaction:wi}=ai(),{getContractPoolInfo:yi}=xi(),[Ti,We]=x.useState(!1),{fetchAccountBalance:ki}=Oe(),{showInsufficientBalanceToast:Ai}=ml(),ui=async()=>{var p;We(!0);try{let g,q,Q;const je=(p=n||[])==null?void 0:p.reduce((ee,ie)=>(de(ie==null?void 0:ie.amount_owed).gt(0)&&ee.push(ie.coin_address),ee),[]);if(k)Q=G(),s(Q),g=await B(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:je});else{const ee=_?y:u,ie=_?r.decimals:M.decimals,xe=de(ee).mul(Yi.pow(10,ie)).toString(),me=e!=null&&e.isReverse?!_:_;let le,pe;const ne=e==null?void 0:e.lowerTick,ce=e==null?void 0:e.upperTick,se=T==null?void 0:T.current_tick_index;se!==void 0&&ne!==void 0&&ce!==void 0&&(se>=ne&&se<=ce?(le=me?xe:P,pe=me?w:xe):se>ce?(le=0,pe=xe):se<ne&&(le=xe,pe=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",ne,ce,se),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,le,pe),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",n,je);const ge={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:le,amountB:pe,fixAmountA:me,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:S,posType:e==null?void 0:e.posType,rewarderCoinTypes:je,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(ge.farmsPoolId=e==null?void 0:e.farmsPool),Q={getShowInfo:(Si,Ve)=>{const Je="Add "+[Fe(y,r==null?void 0:r.symbol),Fe(u,M==null?void 0:M.symbol)].filter(Boolean).join(" and "),Re={modalDescriptionText:Je,toastTitleText:Je};if(Si==="success"){let Ke=y,Xe=u;Ve&&(Ke=Pe(Ve,r)||y,Xe=Pe(Ve,M)||u);const fe="Add "+[Fe(Ke,r==null?void 0:r.symbol),Fe(Xe,M==null?void 0:M.symbol)].filter(Boolean).join(" and ");Re.toastDescriptionContent=fe,Re.modalDescriptionText=fe,Re.toastTitleText="Supplied Successful"}return Re}},s(Q),console.log("ðŸš€ ~ toAdd ~ params:",ge);const f=await j(ge);g=f==null?void 0:f.tx,q=f==null?void 0:f.msafeParams}const _e=await wi(g,Q,{useMev:mi,useFastMode:ci==="Fast Mode",maxCapForGas:ni,customGasPrice:gi,msafeParams:q});console.log("ðŸš€ ~ toClaim ~ res:",_e),_e?(ki(),ue(),I(""),l(X==null?void 0:X.address,e==null?void 0:e.id,!0)):e&&yi(e==null?void 0:e.clmmPool).then(ee=>{console.log("ðŸš€ ~ toClaim ~ res:",ee),k?O():ve()}),We(!1)}catch(g){console.log("ðŸš€ ~ toClaim ~ error:",g),k?O():ve(),Ai(String(g)),We(!1)}};return x.useEffect(()=>{if(F==="increase"&&k){if(A!=null&&A.amount_a||A!=null&&A.amount_b){const p=e==null?void 0:e.tokenA,g=e==null?void 0:e.tokenB,q=Ie(A==null?void 0:A.amount_a,p==null?void 0:p.decimals),Q=Ie(A==null?void 0:A.amount_b,g==null?void 0:g.decimals);m(e!=null&&e.isReverse?Q:q),Z(e!=null&&e.isReverse?q:Q);return}m(""),Z("")}},[k,A,e==null?void 0:e.isReverse]),x.useEffect(()=>(m(""),Z(""),()=>{U(void 0)}),[]),{tokenAmountA:y,tokenAmountB:u,reCalculateResult:ve,preAddLoading:D,preAdd:h,getAddTsPayload:j,displayTokenA:r,displayTokenB:M,tokenABalanceInfo:be,tokenBBalanceInfo:he,tokenAmountValueA:ri,tokenAmountValueB:bi,handleAmountChange:hi,resetInputAmount:ue,btnStatusText:ji,toAdd:ui,isAddLoading:Ti,showTokenALock:Se,showTokenBLock:Ce,showDisplayTokenALock:$e,showDisplayTokenBLock:qe,getClmmCreateAddData:C,getFarmsCreateAddData:V,currentPoolSqrtPrice:S}}function Sl(){var P;const{currentPosBaseInfo:e,posPoolsRelatedData:o,posApiPoolData:d}=re(),{currentAccount:a,onWalletModal:W}=Me(),{isFixedDisplayTokenA:n,curPosContractPoolInfo:t,useZapIn:s,currentPosPoolInfo:h}=Te(),{tokenAmountA:j,tokenAmountB:C,displayTokenA:V,displayTokenB:R,tokenABalanceInfo:E,tokenBBalanceInfo:l,tokenAmountValueA:v,tokenAmountValueB:L,handleAmountChange:S,preAddLoading:_,btnStatusText:z,toAdd:T,isAddLoading:F,showDisplayTokenALock:H,showDisplayTokenBLock:k,resetInputAmount:G,currentPoolSqrtPrice:B}=ul();x.useEffect(()=>()=>{G()},[]);const{getTokenAmountValue:O}=Ue(),A=O(V==null?void 0:V.coin_type,j,"--"),I=O(R==null?void 0:R.coin_type,C,"--"),U=A=="--"||I=="--"?"--":$i(v).plus(L).toString(),D=o[e==null?void 0:e.posId],{currentApiPoolInfo:N}=al(e,d);return i.jsxs($,{w:"100%",gap:"8px",children:[i.jsxs(He,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(N==null?void 0:N.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!H&&!k&&i.jsx(pl,{action:"Deposit",resetInputAmount:G}),s?i.jsx(il,{action:"Deposit",apiPoolInfo:N,currentSqrtPrice:B,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(cl,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(E==null?void 0:E.balanceFormat)||"",value:j,amountValue:v,loading:!n&&_,onChange:J=>{S(J,!0)},placeholder:"0.0",token:V,lock:{isLock:e&&t&&H,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(l==null?void 0:l.balanceFormat)||"",value:C,amountValue:L,loading:n&&_,onChange:J=>{S(J,!1)},placeholder:"0.0",token:R,lock:{isLock:e&&t&&k,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:H||k?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!t||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),s?i.jsx(ll,{action:"Deposit",onClick:T,hideDepositRatio:!0,otherLoading:F}):i.jsxs(i.Fragment,{children:[i.jsx(Ne,{onClick:()=>{a?T():W(!0)},isLoading:F,disabled:z.disabled||F,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:z.text}),U&&i.jsx(oe,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsx(b,{children:"Total Amount"}),i.jsx(b,{color:"text_caption",children:di(U,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&(h==null?void 0:h.farmsRewarderList)&&((P=h==null?void 0:h.farmsRewarderList)==null?void 0:P.length)>0&&i.jsx(dl,{}),D&&(D==null?void 0:D.minPrice)!=="0"&&(D==null?void 0:D.maxPrice)!=="âˆž"&&i.jsx(sl,{subscriptionSource:"PositionDetail"})]})}function Cl(){const{currentPosBaseInfo:e}=re(),{currentPosPoolInfo:o,curPosContractPoolInfo:d}=Te(),{setContractPoolInfo:a,setApiPoolInfo:W}=hl(),{lowerTickData:n,upperTickData:t,setLowerTickData:s,setUpperTickData:h}=Ei();qi(()=>{W(o)},[o]);const j=(R,E,l)=>{var H,k;const v=(H=l==null?void 0:l.tokenA)==null?void 0:H.decimals,L=(k=l==null?void 0:l.tokenB)==null?void 0:k.decimals;let S;Math.abs(R)==Math.abs(Qi.getMinIndex(Number(l.tickSpacing)))?S=E==="lower"?"0":"âˆž":S=Ji.tickIndexToPrice(R,v,L).toString();const _=S==="âˆž"?"âˆž":ae(S,6),z=jl(S),T=z==="âˆž"?"âˆž":ae(z,6),F={id:E,tokenA:l==null?void 0:l.tokenA,tokenB:l==null?void 0:l.tokenB,tick:R,price:S,displayPrice:_,reversePrice:z,displayReversePrice:T,tickSpacing:l==null?void 0:l.tickSpacing,pool:l==null?void 0:l.poolAddress};E==="lower"?s({...F}):h({...F})},{getCurrentPrice:C}=tl();x.useEffect(()=>{e!=null&&e.lowerTick&&(d!=null&&d.current_sqrt_price)&&(o!=null&&o.poolAddress)&&(j(e==null?void 0:e.lowerTick,"lower",o),j(e==null?void 0:e.upperTick,"upper",o),C(d==null?void 0:d.current_sqrt_price,o),a(d))},[e==null?void 0:e.lowerTick,d==null?void 0:d.current_sqrt_price,o==null?void 0:o.poolAddress]);const V=x.useMemo(()=>(e==null?void 0:e.posId)&&(n==null?void 0:n.pool)&&(t==null?void 0:t.pool),[n==null?void 0:n.pool,t==null?void 0:t.pool,e==null?void 0:e.posId]);return i.jsx(He,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:V&&i.jsx(Di,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?t:n,maxPriceData:e!=null&&e.isReverse?n:t,readonly:!0})})}function vl(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posPoolsOriginalData:d}=re(),a=o[e==null?void 0:e.posId],{getClmmPosName:W}=pi(),n=x.useMemo(()=>{var j;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const C=(j=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:j.index;return W(e==null?void 0:e.index,C)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]);(a==null?void 0:a.displayFee)+"";const t=(a==null?void 0:a.currentStatus)=="Active",s=x.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",a);const j=a==null?void 0:a.minPriceOrigin,C=a==null?void 0:a.maxPriceOrigin;return j!=="0"&&C!=="âˆž"?Ki(1/(1-Number((j/C)**.25)),2)+"x":"1x"},[a==null?void 0:a.minPriceOrigin,a==null?void 0:a.maxPriceOrigin]),{getExplorerUrl:h}=oi();return i.jsxs(oe,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(oe,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(c,{justify:"space-between",children:[i.jsxs(c,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(b,{children:"Position ID"}),i.jsx(te,{isLoaded:!!n,children:i.jsx(b,{color:"text_caption",children:n==null?void 0:n.split("|")[1]})})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(b,{children:"Position NFT"}),i.jsx(te,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Bi,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(h(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),a&&i.jsx(rl,{isActive:t,isLoading:(a==null?void 0:a.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs($,{gap:{base:"16px",lg:"32px"},children:[i.jsxs($,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(b,{color:"primary_gray",children:"Current Price"}),i.jsx(Ni,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs($,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(b,{color:"primary_gray",children:"Position Range"}),i.jsx(bl,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:a==null?void 0:a.minPrice,maxPrice:a==null?void 0:a.maxPrice,minPriceResever:a==null?void 0:a.minPriceResever,maxPriceResever:a==null?void 0:a.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs($,{gap:"0",children:[i.jsx(Cl,{}),i.jsx($,{zIndex:"9",children:i.jsxs(c,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(b,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(gl,{type:"leverage"}),i.jsx(te,{ml:"4px",isLoaded:!!s&&!!a,children:i.jsx(b,{color:"primary",children:s})})]})})]})]})]})}function Ms(){var K,y;const e=_i(),{fetchAccountBalance:o}=Oe(),{currentAccount:d}=Me(),{position_nft_id:a}=Ri(),{getCurrentPosBaseInfo:W}=Ge(),{currentPosDetailTab:n,currentPosPoolInfo:t,setCurrentPosDetailTab:s,setCurrentPosPoolInfo:h,setCurrentPoolSqrtPrice:j,setCurPosContractPoolInfo:C,setIsPosDetailRefresh:V,setUseZapIn:R}=Te(),{posPoolsRelatedData:E,currentPosBaseInfo:l,setCurrentPosBaseInfo:v,farmsPosRewardsData:L,posRewardsData:S}=re();console.log(l,"currentPosBaseInfo");const _=(((K=E[l==null?void 0:l.posId])==null?void 0:K.displayFee)||"--")+"%",z=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],T=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),V(!0),F(!0),A(),B(),o(),U(),setTimeout(()=>{V(!1)},1e3)},F=(m=!1)=>{d!=null&&d.address&&a&&W(d==null?void 0:d.address,a,m)};x.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",a),F()},[d==null?void 0:d.address,a]),x.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:H}=Ue(),k=L[l==null?void 0:l.id],G=S[l==null?void 0:l.posId],B=()=>{var ke,Ae;const m=(G==null?void 0:G.map(r=>r==null?void 0:r.coin_address))||[],u=(k==null?void 0:k.map(r=>r==null?void 0:r.rewarder_type))||[],Z=[(ke=l==null?void 0:l.tokenA)==null?void 0:ke.coin_type,(Ae=l==null?void 0:l.tokenB)==null?void 0:Ae.coin_type].filter(Boolean),Y=Array.from(new Set([...m,...Z,...u]));H(Y)};x.useEffect(()=>{B()},[l==null?void 0:l.posId,G==null?void 0:G.length,k==null?void 0:k.length]);const{getPoolList:O}=wl(),A=async()=>{if(!(l!=null&&l.clmmPool))return;const m=await O({pool:l==null?void 0:l.clmmPool});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,m),m)return h(m==null?void 0:m.list[0])},{getContractPoolInfo:I}=xi(),U=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const m=await I(l==null?void 0:l.clmmPool);console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo:",m),m&&(j(m.current_sqrt_price),C(m))}},{setFromCoin:D,setToCoin:N,fromCoin:P,toCoin:J}=yl();x.useEffect(()=>{A(),U();let m;return l!=null&&l.clmmPool&&(m=setInterval(()=>{U()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(D(l==null?void 0:l.displayTokenA),N(l==null?void 0:l.displayTokenB)),()=>{clearInterval(m),D(ei.clmm_swap.from_coin),N(ei.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),x.useEffect(()=>(s("increase"),d!=null&&d.address&&o(),()=>{C(null),v(null),h(null),R(!1)}),[]),kl({onRpcChange:()=>{F(!0),U(),d!=null&&d.address&&o()}});const{isApp:w}=Ze();return i.jsxs($,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(Tl,{}),w&&i.jsxs(c,{children:[i.jsx(ti,{}),i.jsx(si,{handleRefresh:T,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(Ne,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:m=>{e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!w&&i.jsx(si,{handleRefresh:T,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(te,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Fi,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:_,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(c,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Le,{label:"Pool APR",value:i.jsx(Li,{poolInfo:t,children:i.jsxs(c,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(b,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:t!=null&&t.farmingAprDisplay||((y=t==null?void 0:t.miningAprList)==null?void 0:y.length)>0?"help":"text",children:t==null?void 0:t.feeAndMiningAprDisplay}),(t==null?void 0:t.haveFarming)&&i.jsxs(b,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",t==null?void 0:t.farmingAprDisplay]})]})}),loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"TVL",value:(t==null?void 0:t.tvlDisplay)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"Volume (24H)",value:(t==null?void 0:t.volume24Display)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"Fees (24H)",value:(t==null?void 0:t.fees24Display)||"",loading:!(t!=null&&t.poolAddress)})]})]}),i.jsxs(c,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs($,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(vl,{}),i.jsx(Al,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs($,{w:{base:"100%",lg:"40%"},children:[i.jsx(oe,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(c,{w:"100%",p:"0 16px",children:[i.jsx(Xi,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:z,currentTab:n=="increase"?"Increase":"Remove",handleChangeTab:m=>{s(m==null?void 0:m.value)}}),!w&&i.jsx(ti,{})]})}),n=="increase"&&i.jsx(Sl,{}),n=="remove"&&i.jsx(ol,{})]})]})]})}const ti=()=>i.jsx(c,{children:i.jsx(Mi,{})});export{Ms as default};
//# sourceMappingURL=PositionDetail-YcTEBgH9.js.map
