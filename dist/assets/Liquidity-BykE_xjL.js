import{aF as Gs,aG as $t,aH as Ks,aI as Qs,u as Nt,j as e,T as F,h as Xs,H as q,I as Me,b as ze,V as W,g as Ge,ad as Vt,as as P,e as Ot,r as f,X as Zt,C as Ze,$ as fe,l as Dt,k as De,d as Q,aJ as Jt,f as Re,B as ne,U as gs,m as be,aA as Wt,Y as ms,az as Ys,ai as tt,aK as Zs,S as st,a as wt,a1 as Rt,aE as Ut,ae as ys,af as hs,ag as bs,ah as fs,aj as Js,ak as js,a0 as As,W as Ps,ab as ht,aL as Ss,aM as Gt,a5 as _s,aN as Pt,aO as ie,aP as pt,aQ as ft,aR as oe,a7 as Is,aS as It,aT as er,c as Kt,aU as tr,aV as sr,ar as rr,aC as ir,ao as es,aW as vs,aX as we,aY as nr,aa as ar,an as cr,aZ as lr,a_ as dr}from"./index-c8x0neDx.js";import{A as or}from"./AprTooltip-CSg3mjFm.js";import{i as xr,R as ur,C as pr}from"./api-data-utils-0d_jjn6h.js";import{u as ue}from"./index-DI5Q0fYc.js";import{u as Se}from"./useQueryParams-C-cUhNAg.js";import{u as rt}from"./useDocumentSize-D_qHMQHm.js";import{H as gr,T as mr,a as yr,u as hr,V as br}from"./VolumeChart-CXR-rgMt.js";import{N as et}from"./NoData-C7RuiRQ2.js";import{A as fr}from"./AddressUnderline-D-OGLlr6.js";import{T as jr}from"./TvlChart-7Qtheypm.js";import{u as Ar}from"./useBurn-BFWB3TFT.js";import{H as me}from"./HTextLabelBox-C9FZcI0L.js";import{T as Sr}from"./TooltipIcon-B5wViqRg.js";import{A as ws}from"./AddressCopyLink-CXikOUHz.js";import{P as _r}from"./progress-BaDu_ehH.js";import{c as Rs,d as vr,a as wr,u as Rr}from"./usePositionList-jMKEHL_-.js";import{u as Cr}from"./useRpcListener-BS06EUQo.js";import{a as kr,P as Lr,F as Cs}from"./PositionListLoading-DAQ1MlU7.js";import{u as Ee,a as Ct,L as ks,b as Tr,c as Fr,S as gt}from"./useGetContractPoolInfo-Cl2Izg4L.js";import{T as Br}from"./TradeConfirmAmountInfo-Dmeoy8BX.js";import{P as Mr}from"./PositionStatus-BMJM4Hh1.js";import{R as zr}from"./RangeAlerts-CxUCJldo.js";import{u as Er}from"./global-DLT0J0mI.js";import{c as qr,g as jt,a as At,u as $r}from"./useGetPoolList-COr9_t00.js";import{u as Ls}from"./useAccountBalance-CZOHOa8D.js";import{u as St}from"./useTokenBalance-eq1GEE9D.js";import{u as Wr,a as Ur}from"./useTransaction-DAoWoqXP.js";import{u as Ts,m as zt,S as ts,a as Hr}from"./SelectTokenAndFeeConfirm-DtsFsHQ1.js";import{u as Nr}from"./useNotifiSubscription-La67Z7V_.js";import{u as Vr}from"./usePosAdd-3nc6fJ9x.js";import{L as _t}from"./LockInput-C6EUUthc.js";import{S as Fs}from"./Slippage-D4t4y3eq.js";import{P as ss,C as Bs,I as vt}from"./common-0fEW93nG.js";import{C as bt}from"./CetusTooltip-CGhijhrv.js";import{S as Ht}from"./switch-81cBGCWx.js";import{T as Ms}from"./TradeInputGroup-DQRm61m2.js";import{i as Ye}from"./index-9_VNld9X.js";import{g as Or}from"./liquidity-w8VwWcFh.js";import{d as rs,F as Dr}from"./FeeTierSelect-5UxKr4wN.js";import{u as zs}from"./useToken-D-6xB-ST.js";import{R as Gr}from"./RefreshButton-S2zh08Pz.js";import{C as Kr}from"./CurrentPrice-CGDhlaPu.js";import{W as Qr}from"./WarningTokenTipModal-BpOSyIut.js";import"./generateCategoricalChart-BQB8abrb.js";import"./debounce-Cbctf6FT.js";import"./throttle-Ci4i6U0I.js";import"./index-DwhjM_Xa.js";import"./index-C03DpDOz.js";import"./Pagination-hwq11WUw.js";import"./tr-Dh5PCvTH.js";import"./_getAllKeysIn-C6E0GMPP.js";import"./YAxis-Cx0CTd6K.js";import"./progress.utils-lPdRWm8i.js";import"./usePreviousValue-B4Ws-I5w.js";import"./useCurrentPos-Bg9_OBWV.js";import"./PriceRange-lF99gfNF.js";import"./SingleTokenInfo-DeVv6bgN.js";import"./RangeValue-qMaWWfA-.js";import"./ActionButton-Db0-lE8T.js";import"./VTextLabelBox-dt-U3a_S.js";import"./index-Z9lcNQQE.js";import"./Loading-BKdkEwf3.js";import"./useXCetusHelper-C-BGnfq1.js";import"./msafe-oYBkW7LJ.js";import"./useInsufficientBalanceToast-CiJ4SaVO.js";import"./icon_lock@2x-OdzkPjmc.js";import"./InputBox-C7CBHtqJ.js";var Xr=/\s/;function Yr(t){for(var c=t.length;c--&&Xr.test(t.charAt(c)););return c}var Zr=/^\s+/;function Jr(t){return t&&t.slice(0,Yr(t)+1).replace(Zr,"")}var is=NaN,Pr=/^[-+]0x[0-9a-f]+$/i,Ir=/^0b[01]+$/i,ei=/^0o[0-7]+$/i,ti=parseInt;function ns(t){if(typeof t=="number")return t;if(Gs(t))return is;if($t(t)){var c=typeof t.valueOf=="function"?t.valueOf():t;t=$t(c)?c+"":c}if(typeof t!="string")return t===0?t:+t;t=Jr(t);var s=Ir.test(t);return s||ei.test(t)?ti(t.slice(2),s?2:8):Pr.test(t)?is:+t}var Et=function(){return Ks.Date.now()},si="Expected a function",ri=Math.max,ii=Math.min;function Es(t,c,s){var u,g,r,i,o,d,a=0,l=!1,x=!1,b=!0;if(typeof t!="function")throw new TypeError(si);c=ns(c)||0,$t(s)&&(l=!!s.leading,x="maxWait"in s,r=x?ri(ns(s.maxWait)||0,c):r,b="trailing"in s?!!s.trailing:b);function w(k){var A=u,z=g;return u=g=void 0,a=k,i=t.apply(z,A),i}function j(k){return a=k,o=setTimeout(m,c),l?w(k):i}function R(k){var A=k-d,z=k-a,L=c-A;return x?ii(L,r-z):L}function H(k){var A=k-d,z=k-a;return d===void 0||A>=c||A<0||x&&z>=r}function m(){var k=Et();if(H(k))return h(k);o=setTimeout(m,R(k))}function h(k){return o=void 0,b&&u?w(k):(u=g=void 0,i)}function n(){o!==void 0&&clearTimeout(o),a=0,u=d=g=o=void 0}function y(){return o===void 0?i:h(Et())}function M(){var k=Et(),A=H(k);if(u=arguments,g=this,d=k,A){if(o===void 0)return j(d);if(x)return clearTimeout(o),o=setTimeout(m,c),w(d)}return o===void 0&&(o=setTimeout(m,c)),i}return M.cancel=n,M.flush=y,M}function ni(){const{clmmSdk:t}=Qs(),{fetchByApi:c}=Nt();return{getTransactionsHistory:async g=>{try{const r=await c(xr,"GET",g);if(console.log(r,"getTransactionsHistory"),r)return r;throw new Error("no data")}catch(r){console.error(r,"getTransactionsHistory ~ error")}},getTransactionsHistoryBySDK:async(g,r)=>{try{const i=await t.Pool.getPoolTransactionList({poolId:g,paginationArgs:r,fullRpcUrl:"https://rpc-mainnet.suiscan.xyz:443"});if(console.log(i,"getTransactionsHistoryBySDK"),i)return i;throw new Error("no data")}catch(i){console.error(i,"getTransactionsHistoryBySDK ~ error")}}}}var Be=(t=>(t.add="add_liquidity_event",t.remove="remove_liquidity_event",t.swap="swap_event",t))(Be||{});const mt={[Be.add]:{icon:"#icon-a-icon_add1",color:"primary_green",title:"Add Liquidity"},[Be.remove]:{icon:"#icon-tx_remove",color:"light_coral",title:"Remove Liquidity"},[Be.swap]:{icon:"#icon-icon_swap",color:"primary",title:"Swap"}},ai=({type:t})=>{var c,s,u,g;return e.jsxs(q,{children:[e.jsx(Me,{xlinkHref:(c=mt[t])==null?void 0:c.icon,svgFill:(s=mt[t])==null?void 0:s.color,svgHover:(u=mt[t])==null?void 0:u.color}),e.jsx(F,{color:"text_caption",children:(g=mt[t])==null?void 0:g.title})]})},ci=({items:t,type:c,isReverse:s})=>{var g,r;const{isApp:u}=ze();return t?c===Be.swap?u?e.jsxs(W,{align:"flex-end",gap:"8px",children:[e.jsx(Xe,{item:t==null?void 0:t[0]}),e.jsxs(q,{justify:"flex-end",children:[e.jsx(Me,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(Xe,{item:t==null?void 0:t[1]})]})]}):e.jsxs(q,{justify:"flex-end",gap:"8px",children:[e.jsx(Xe,{item:t==null?void 0:t[0]}),e.jsx(Me,{xlinkHref:"#icon-icon_right",svgFill:"text_caption",svgHover:"text_caption"}),e.jsx(Xe,{item:t==null?void 0:t[1]})]}):u?e.jsx(W,{align:"flex-end",gap:"8px 16px",flexDir:s?"column-reverse":"column",children:(g=t==null?void 0:t.filter(i=>!!+i.amount))==null?void 0:g.map(i=>e.jsx(Xe,{item:i},i==null?void 0:i.address))}):e.jsx(q,{justify:s?"flex-start":"flex-end",gap:"8px 16px",flexDir:s?"row-reverse":"row",children:(r=t==null?void 0:t.filter(i=>!!+i.amount))==null?void 0:r.map(i=>e.jsx(Xe,{item:i},i==null?void 0:i.address))}):null},Xe=({item:t})=>e.jsxs(q,{gap:"4px",children:[e.jsx(Ge,{imageUrl:t==null?void 0:t.url,w:"20px",h:"20px"}),e.jsx(F,{color:"text_caption",children:Vt(t==null?void 0:t.amount)}),e.jsx(F,{children:P(t==null?void 0:t.symbol,10)})]}),as=(t,c=!1)=>[{title:e.jsx(F,{children:"Event"}),key:"type",render:({type:s})=>e.jsx(ai,{type:s}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(F,{textAlign:"right",children:"Amounts"}),key:"amounts",render:({items:s,type:u})=>e.jsx(ci,{items:s,type:u,isReverse:c}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(F,{textAlign:"right",children:"Transactions"}),key:"tx",render:({tx:s})=>e.jsx(fr,{address:s,color:"primary",fontSize:"14px",onClickLink:()=>{window.open(t(s,"tx"),"_blank")}}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}},{title:e.jsx(F,{textAlign:"right",children:"Time"}),key:"block_time",render:({block_time:s})=>e.jsx(F,{color:"text_caption",children:Xs(s)}),thConfig:{h:"52px",p:"0 !important"},tdConfig:{p:"0 !important"}}],cs=10;function li(){const{getExplorerUrl:t}=Ot(),{getTransactionsHistoryBySDK:c}=ni(),[s,u]=f.useState(!0),[g,r]=f.useState([]),[i,o]=f.useState(1),[d,a]=f.useState(),[l,x]=f.useState(!0),{apiPoolInfo:b,manualRefresh:w,setManualRefresh:j}=ue(),{poolAddress:R}=Se();f.useEffect(()=>{r([]),o(1),a(void 0),x(!0)},[R]),f.useEffect(()=>{w&&(r([]),o(1),a(void 0),x(!0),H({cursor:void 0,limit:cs}))},[R,w]),rt(()=>{H({cursor:d,limit:cs})},[i,R],{wait:500,leading:!0,trailing:!1});const H=async h=>{var n;try{if(!l)return;if(R){u(!0);const y=await c(R,{...h});if(y){const M=(n=y==null?void 0:y.data)==null?void 0:n.map(k=>{var D,V;const A=k==null?void 0:k.parsedJson,z=A!=null&&A.amount_a||A!=null&&A.atob?b==null?void 0:b.tokenA:b==null?void 0:b.tokenB,L=A!=null&&A.amount_b||A!=null&&A.atob?b==null?void 0:b.tokenB:b==null?void 0:b.tokenA;return{...k,type:(D=k.type)!=null&&D.includes("Add")?Be.add:(V=k.type)!=null&&V.includes("Remove")?Be.remove:Be.swap,items:[{amount:Zt(A!=null&&A.amount_a?A==null?void 0:A.amount_a:A==null?void 0:A.amount_in,z==null?void 0:z.decimals).toString(),address:z==null?void 0:z.coin_type,url:z==null?void 0:z.logo_url,symbol:z==null?void 0:z.symbol},{amount:Zt(A!=null&&A.amount_b?A==null?void 0:A.amount_b:A==null?void 0:A.amount_out,L==null?void 0:L.decimals).toString(),address:L==null?void 0:L.coin_type,url:L==null?void 0:L.logo_url,symbol:L==null?void 0:L.symbol}]}});h!=null&&h.cursor?r(k=>[...k,...M||[]]):r(M||[]),a(y==null?void 0:y.nextCursor),x(y==null?void 0:y.hasNextPage),u(!1)}}}catch(y){console.log(y,"getTransactionsHistoryBySDK-error"),u(!1)}finally{u(!1)}},{isApp:m}=ze();return e.jsxs(W,{w:"100%",position:"relative",mt:{base:"12px",lg:"24px"},gap:"0px",children:[e.jsx(q,{w:"100%",justify:"space-between",children:e.jsx(F,{fontSize:"24px",color:"text_caption",fontWeight:"500",children:"Transactions"})}),!s&&(g==null?void 0:g.length)==0?e.jsx(et,{type:"nodata",mt:"16px",text:"No Recent Transactions"}):m?e.jsx(gr,{columns:as(t,b==null?void 0:b.isReverse),dataSource:g,loading:s&&i===1,itemSkeletonLength:5,itemHeight:"30px",wrapStyle:{gap:0},rowStyle:(h,n)=>({w:"100%",p:"0px",mt:"20px"}),onRowClick:h=>{window.open(t(h==null?void 0:h.tx,"tx"),"_blank")}}):e.jsx(mr,{columns:as(t,b==null?void 0:b.isReverse),dataSource:g,skeletonLength:10,loading:s&&i===1,onRowClick:h=>{window.open(t(h==null?void 0:h.tx,"tx"),"_blank")},rowStyle:{h:"52px",cursor:"pointer"}}),l&&e.jsx(Ze,{mt:{base:"40px",lg:"20px"},children:e.jsx(fe,{w:"120px",h:"32px",fontSize:"12px",borderRadius:"8px",bg:"button_ghost_bg",color:"primary",borderColor:"border",variant:"outline",onClick:()=>o(h=>h+1),children:s?e.jsx(Dt,{size:"sm",color:"text_caption"}):"Load More"})})]})}var qs=(t=>(t.volume="Volume",t.tvl="TVL",t.fees="Fees",t))(qs||{}),$s=(t=>(t.volume="vol",t.tvl="pure_tvl",t.fees="fee",t))($s||{}),Ws=(t=>(t.d="D",t.w="W",t.m="M",t))(Ws||{}),Us=(t=>(t.d="day",t.w="wek",t.m="mon",t))(Us||{});const di=Object.values(qs).map(t=>({label:t})),ls=Object.values(Ws).map(t=>({label:t})),oi={D:40,W:30,M:20};function xi(){const{isApp:t}=ze(),[c,s]=f.useState("Volume"),[u,g]=f.useState("D"),[r,i]=f.useState([]),{apiPoolInfo:o}=ue(),[d,a]=f.useState(!0),[l,x]=f.useState(null),{getHistogramData:b}=yr(),{poolAddress:w}=Se();f.useLayoutEffect(()=>{i([]),s("Volume"),g("D"),x(null)},[w]);const j=async()=>{if(w)try{a(!0);const y=await b({date_type:Us[u.toLowerCase()],type:$s[c.toLowerCase()],limit:oi[u],address:w});y&&y.length&&i(y)}catch(y){throw console.error(y,"res-fetchAnalyticsData"),y}finally{a(!1)}};f.useEffect(()=>{j()},[w,c,u]);const R=f.useMemo(()=>{if(c==="Volume")return{value:o==null?void 0:o.volume24Display,title:"Volume (24H)"};if(c==="TVL")return{value:o==null?void 0:o.tvlDisplay,title:"TVL"};if(c==="Fees")return{value:o==null?void 0:o.fees24Display,title:"Fees (24H)"}},[c,o==null?void 0:o.volume24Display,o==null?void 0:o.tvlDisplay,o==null?void 0:o.fees24Display]),{getHoverTime:H,time:m}=hr();f.useEffect(()=>{l!=null&&l.date&&H(l==null?void 0:l.date,u)},[l==null?void 0:l.date,u]);const h=y=>{s(y.label),y.label!==c&&i([])},n=y=>{g(y.label),y.label!==u&&i([])};return e.jsxs(W,{flex:"1",border:"1px solid",borderColor:"border",borderRadius:"16px",p:{base:"8px",lg:"20px"},bg:"bg_secondary",gap:"20px",children:[e.jsxs(q,{w:"100%",justify:{base:"center",lg:"space-between"},children:[e.jsx(De,{type:"outlineTab",tabList:di,currentTab:c,handleChangeTab:h,wrapStyle:{h:"32px",p:"3px",borderRadius:"8px",flex:{base:"1",lg:"0 0 308px"}},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}}),!t&&e.jsx(De,{type:"outlineTab",tabList:ls,currentTab:u,handleChangeTab:n,wrapStyle:{h:"32px",p:"3px",borderRadius:"8px",flex:"0 0 128px"},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}})]}),e.jsxs(W,{w:"100%",align:"flex-start",children:[e.jsx(F,{color:"text_caption",fontSize:"24px",children:(l==null?void 0:l.num)!==void 0&&l!==null?Q(Jt(l.num)).gte("0.01")||Q(Jt(l.num)).equals("0")?`$${Re(l==null?void 0:l.num,2)}`:"<$0.01":R==null?void 0:R.value}),e.jsx(F,{children:l!=null&&l.date?m:R==null?void 0:R.title}),t&&e.jsx(De,{type:"outlineTab",tabList:ls,currentTab:u,handleChangeTab:n,wrapStyle:{mt:"8px",h:"32px",p:"3px",borderRadius:"8px",w:"128px"},itemStyle:{fontSize:"12px",flex:1,borderRadius:"6px"}})]}),e.jsx(ne,{w:"100%",h:"340px",mt:"20px",children:e.jsxs(ne,{w:"100%",h:"100%",position:"relative",children:[d&&e.jsx(ne,{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%,-50%)",children:e.jsx(Dt,{})}),c==="TVL"?e.jsx(jr,{data:r,onChangeValue:y=>x(y)}):e.jsx(br,{data:r,onChangeValue:y=>x(y),pageFrom:"pools"})]})})]})}const ui=(t,c)=>({tokenAPrice:void 0,setTokenAPrice:s=>{t(()=>({tokenAPrice:s}))},tokenBPrice:void 0,setTokenBPrice:s=>{t(()=>({tokenBPrice:s}))},tokenAAmount:"",setTokenAAmount:s=>{t(()=>({tokenAAmount:s}))},tokenBAmount:"",setTokenBAmount:s=>{t(()=>({tokenBAmount:s}))},tokenAAmountUSD:"",setTokenAAmountUSD:s=>{t(()=>({tokenAAmountUSD:s}))},tokenBAmountUSD:"",setTokenBAmountUSD:s=>{t(()=>({tokenBAmountUSD:s}))},totalAmountUSD:"",setTotalAmountUSD:s=>{t(()=>({totalAmountUSD:s}))},tvlLoading:!0,setTvlLoading:s=>{t(()=>({tvlLoading:s}))},resetTvlInfo:()=>{t(()=>({tokenAPrice:void 0,tokenBPrice:void 0,tokenAAmount:"",tokenBAmount:"",tokenAAmountUSD:"",tokenBAmountUSD:"",totalAmountUSD:""}))}}),Qt=gs(ui);function pi(){ze();const{getBurnPositionAmountByPool:t}=Ar(),{apiPoolInfo:c,contractPoolInfo:s}=ue(),[u,g]=f.useState("0"),[r,i]=f.useState("0"),[o,d]=f.useState("0"),[a,l]=f.useState("0"),[x,b]=f.useState(!1),{poolAddress:w}=Se(),{tokenAPrice:j,tokenBPrice:R}=Qt(),H=async(m,h)=>{try{b(!0),console.log("ðŸš€ðŸš€ðŸš€ ~ file: burn-position-amount 29 ~ getBurnAmount ~ getBurnAmount:");const{totalA:n,totalB:y}=await t(m,h);g(n),i(y),j&&d(Q(n).mul(j==null?void 0:j.price).toString()),R&&l(Q(y).mul(R==null?void 0:R.price).toString())}catch(n){console.log("ðŸš€ðŸš€ðŸš€  ~ getBurnAmount ~ error:",n)}finally{b(!1)}};return rt(()=>{c&&(s!=null&&s.current_sqrt_price)&&H(c,s==null?void 0:s.current_sqrt_price)},[w,s==null?void 0:s.current_sqrt_price,j==null?void 0:j.price,R==null?void 0:R.price],{wait:500}),Q(u).gt(0)||Q(r).gt(0)?e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",bg:"bg_secondary",borderRadius:"16px",border:"1px solid",borderColor:"border",justify:"space-between",align:"flex-start",p:{base:"16px 8px 8px",lg:"20px 16px 20px 20px"},children:[e.jsxs(q,{children:[e.jsx(F,{fontSize:"16px",color:"text_caption",children:"Burned Liquidity"}),e.jsx(Sr,{type:"burnedLiquidity"})]}),e.jsxs(be,{gap:"16px",flexDir:{base:c!=null&&c.isReverse?"column-reverse":"column",lg:c!=null&&c.isReverse?"row-reverse":"row"},w:{base:"100%",lg:"822px",xl:"862px"},children:[e.jsx(ds,{token:c==null?void 0:c.tokenA,amount:u,amountUSD:o,loading:x}),e.jsx(ds,{token:c==null?void 0:c.tokenB,amount:r,amountUSD:a,loading:x})]})]}):null}const ds=({token:t,amount:c,amountUSD:s,loading:u})=>e.jsxs(W,{flex:"1",align:"flex-start",gap:"16px",p:{base:"16px 8px",lg:"16px 20px"},borderRadius:"8px",bg:"background",border:"1px solid",borderColor:"border",children:[e.jsxs(q,{gap:"12px",children:[e.jsx(Ge,{imageUrl:t==null?void 0:t.logo_url,w:"28px",h:"28px"}),e.jsxs(W,{align:"flex-start",gap:"4px",children:[e.jsx(F,{color:"text_caption",fontSize:"16px",children:P(t==null?void 0:t.symbol,10)}),e.jsx(F,{fontSize:"12px",children:t==null?void 0:t.name})]})]}),e.jsx(me,{label:"Amount",labelStyle:{fontSize:"14px"},value:Vt(Wt(c,t==null?void 0:t.decimals)),valueStyle:{fontSize:"14px"},isLoading:u,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}}),e.jsx(me,{label:"Amount (USD)",labelStyle:{fontSize:"14px"},value:Q(s).gt("0")?`$${ms(Wt(s,t==null?void 0:t.decimals),2)}`:"--",valueStyle:{fontSize:"14px"},isLoading:u,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}})]}),yt=t=>t==="--"?"--":`${t}%`;function gi(){var b,w,j,R,H,m;const{apiPoolInfo:t,contractPoolInfo:c}=ue(),{getExplorerUrl:s}=Ot(),{poolAddress:u}=Se(),{tokenAAmount:g,tokenBAmount:r,tokenAAmountUSD:i,tokenBAmountUSD:o,totalAmountUSD:d,tvlLoading:a}=Qt(),l=f.useMemo(()=>{if(i&&d&&i!=="--"&&d!=="--"){const h=Ys(Q(i).div(d).mul(100).toString(),2);return h==="NaN"?"--":h}return"--"},[i,d]),x=f.useMemo(()=>l&&l!=="--"?Q(100).minus(l).toString():"--",[l]);return e.jsxs(W,{w:{base:"100%",lg:"420px",xl:"440px"},gap:{base:"20px",lg:"40px"},p:{base:"20px 8px 8px",lg:"20px 16px"},borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_secondary",minW:{base:"100%",lg:"420px"},maxW:{base:"100%",lg:"440px"},children:[e.jsxs(W,{gap:"20px",w:"100%",children:[e.jsx(q,{w:"100%",justify:"space-between",children:e.jsx(tt,{fontSize:"16px",fontWeight:"400",children:"Pool Info"})}),e.jsxs(Zs,{templateColumns:{base:"repeat(1, 1fr)",lg:"repeat(2, 1fr)"},w:"100%",gap:{base:"20px",lg:"20px 36px"},children:[e.jsx(me,{label:"Pool Address",labelStyle:{fontSize:"14px",whiteSpace:"nowrap"},value:e.jsx(ws,{address:u||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(s(u,"poolAddress"))}),valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Tick Spacing",labelStyle:{whiteSpace:"nowrap",fontSize:"14px"},value:(t==null?void 0:t.tickSpacing)||"",valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Pool ID",labelStyle:{fontSize:"14px"},value:c!=null&&c.index||t!=null&&t.index?`#${(c==null?void 0:c.index)||(t==null?void 0:t.index)}`:"--",valueStyle:{fontSize:"14px"}}),e.jsx(me,{label:"Fee Tier",labelStyle:{fontSize:"14px"},value:`${t==null?void 0:t.feeDisplay}`||"--",valueStyle:{fontSize:"14px"}})]})]}),e.jsxs(W,{gap:"20px",w:"100%",children:[e.jsx(q,{justify:"flex-start",w:"100%",children:e.jsx(tt,{fontSize:"16px",fontWeight:"400",children:"Pool Composition"})}),e.jsxs(W,{gap:"16px",w:"100%",children:[e.jsxs(q,{w:"100%",justify:"space-between",children:[e.jsxs(q,{gap:"12px",children:[e.jsx(Ge,{imageUrl:(b=t==null?void 0:t.displayTokenA)==null?void 0:b.logo_url,w:"28px",h:"28px",coinType:t!=null&&t.displayTokenA?(w=t==null?void 0:t.displayTokenA)==null?void 0:w.coin_type:""}),e.jsxs(W,{align:"flex-start",gap:"4px",children:[e.jsx(F,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:P((j=t==null?void 0:t.displayTokenA)==null?void 0:j.symbol,10)}),a?e.jsx(st,{h:"12px"}):e.jsx(F,{fontSize:"12px",fontWeight:"500",children:t!=null&&t.isReverse?yt(x):yt(l)})]})]}),e.jsx(ne,{w:"200px",children:e.jsx(_r,{value:Number(t!=null&&t.isReverse?x:l),size:"xs",h:"4px",borderRadius:"4px",bg:[l,x].includes("--")?"border":"quote_green",sx:{'div[role="progressbar"]':{bg:[l,x].includes("--")?"background":"primary"}}})}),e.jsxs(q,{gap:"12px",children:[e.jsxs(W,{align:"flex-end",gap:"4px",children:[e.jsx(F,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:P((R=t==null?void 0:t.displayTokenB)==null?void 0:R.symbol,10)}),a?e.jsx(st,{h:"12px"}):e.jsx(F,{fontSize:"12px",fontWeight:"500",children:t!=null&&t.isReverse?yt(l):yt(x)})]}),e.jsx(Ge,{imageUrl:(H=t==null?void 0:t.displayTokenB)==null?void 0:H.logo_url,w:"28px",h:"28px",coinType:t!=null&&t.displayTokenB?(m=t==null?void 0:t.displayTokenB)==null?void 0:m.coin_type:""})]})]}),e.jsxs(W,{w:"100%",flexDir:t!=null&&t.isReverse?"column-reverse":"column",gap:"16px",children:[e.jsx(os,{loading:a,token:t==null?void 0:t.tokenA,amount:g,amountUSD:i}),e.jsx(os,{loading:a,token:t==null?void 0:t.tokenB,amount:r,amountUSD:o})]})]})]})]})}const os=({token:t,amount:c,amountUSD:s,loading:u})=>{const{getExplorerUrl:g}=Ot();return t?e.jsxs(W,{w:"100%",p:{base:"16px 8px",lg:"16px 20px"},borderRadius:"8px",bg:"background",border:"1px solid",borderColor:"border",gap:"16px",children:[e.jsxs(q,{w:"100%",justify:"space-between",children:[e.jsxs(q,{gap:"12px",children:[e.jsx(Ge,{imageUrl:t==null?void 0:t.logo_url,w:"28px",h:"28px",coinType:t?t==null?void 0:t.coin_type:""}),e.jsxs(W,{align:"flex-start",gap:"4px",children:[e.jsx(F,{color:"text_caption",fontSize:"16px",children:P(t==null?void 0:t.symbol,10)}),e.jsx(F,{fontSize:"12px",children:t==null?void 0:t.name})]})]}),e.jsx(ws,{address:(t==null?void 0:t.coin_type)||"",fontSize:"14px",color:"text_caption",onClickLink:()=>window.open(g(t==null?void 0:t.coin_type,"coin"))})]}),e.jsx(me,{label:"Amount",labelStyle:{fontSize:"14px"},value:Vt(Wt(c||"0",t.decimals)),valueStyle:{fontSize:"14px"},isLoading:u,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}}),e.jsx(me,{label:"Amount (USD)",labelStyle:{fontSize:"14px"},value:s&&s!=="--"?`$${Re(s)}`:"--",valueStyle:{fontSize:"14px"},isLoading:u,wrapStyle:{h:"14px"},skeletonStyle:{valueW:"120px"}})]}):null};function mi(){return e.jsxs(W,{w:"100%",gap:"16px",minW:{base:"100%",lg:"1024px"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",gap:"16px",children:[e.jsx(xi,{}),e.jsx(gi,{})]}),e.jsx(pi,{}),e.jsx(li,{})]})}function yi(){const t=wt(),{posBaseListLoading:c,posBaseListGroupByPool:s}=Rs(),{apiPoolInfo:u,manualRefresh:g}=ue(),{currentAccount:r,onWalletModal:i}=Rt(),{getPositionBaseList:o,getPosRelatedData:d}=vr(),[a,l]=f.useState(""),{poolAddress:x}=Se(),b=async j=>{const R=await o(j);Array.isArray(R)&&d(R),typeof R=="string"&&l(R)};f.useEffect(()=>{r!=null&&r.address&&b(r==null?void 0:r.address)},[r==null?void 0:r.address]),f.useEffect(()=>{g&&(r!=null&&r.address)&&b(r==null?void 0:r.address)},[g]),Cr({onRpcChange:()=>{r!=null&&r.address&&b(r==null?void 0:r.address)}});const w=f.useMemo(()=>{if(x){const j=s[x.toLowerCase()||""];return j?j==null?void 0:j.list:[]}return[]},[x,JSON.stringify(s)]);return e.jsx(W,{minW:{base:"100%",lg:"1024px"},children:r!=null&&r.address?c?[{},{}].map((j,R)=>e.jsx(kr,{},R)):w&&(w==null?void 0:w.length)>0?w==null?void 0:w.map((j,R)=>e.jsx(Lr,{positionInfo:j},j==null?void 0:j.posId)):a?e.jsx(et,{type:"nodata",text:a}):e.jsx(et,{type:"nodata",text:"You don't have positions for this pool",children:e.jsx(fe,{borderRadius:"8px",mt:"8px",fontWeight:"500",w:"120px",h:"28px",fontSize:"12px",onClick:()=>t(`/liquidity?tab=deposit&poolAddress=${u==null?void 0:u.poolAddress}`),children:"Create Position"})}):e.jsx(et,{type:"nowallet",onboard:()=>i(!0)})})}const hi=(t,c)=>({fromAmount:"",setFromAmount:s=>{t(()=>({fromAmount:s}))},fromAmountValue:"",setFromAmountValue:s=>{t(()=>({fromAmountValue:s}))},toAmount:"",setToAmount:s=>{t(()=>({toAmount:s}))},toAmountValue:"",setToAmountValue:s=>{t(()=>({toAmountValue:s}))},liquidityAmount:"",setLiquidityAmount:s=>{t(()=>({liquidityAmount:s}))},tokenMaxA:"",setTokenMaxA:s=>{t(()=>({tokenMaxA:s}))},tokenMaxB:"",setTokenMaxB:s=>{t(()=>({tokenMaxB:s}))},byAmountIn:!0,setByAmountIn:s=>{t(()=>({byAmountIn:s}))},isTokenA:!0,setIsTokenA:s=>{t(()=>({isTokenA:s}))},percentMap:{percentA:"0",percentB:"0"},setPercentMap:s=>{t(()=>({percentMap:s}))},isFullRange:!1,setIsFullRange:s=>{t(()=>({isFullRange:s}))},fromToken:void 0,setFromToken:s=>{t(()=>({fromToken:s}))},fromTokenLock:!1,setFromTokenLock:s=>{t(()=>({fromTokenLock:s}))},toToken:void 0,setToToken:s=>{t(()=>({toToken:s}))},toTokenLock:!1,setToTokenLock:s=>{t(()=>({toTokenLock:s}))},totalAmount:void 0,setTotalAmount:s=>{t(()=>({totalAmount:s}))},autoStakePosition:!1,setAutoStakePosition:s=>{t(()=>({autoStakePosition:s}))},isFarmRewardsRange:!1,setIsFarmRewardsRange:s=>{t(()=>({isFarmRewardsRange:s}))},resetAddLiquidity:()=>{t(()=>({isFarmRewardsRange:!1,autoStakePosition:!1,totalAmount:void 0,fromTokenLock:!1,fromToken:void 0,toTokenLock:!1,toToken:void 0,isFullRange:!1,percentMap:{percentA:"0",percentB:"0"},fromAmount:"",toAmount:"",fromAmountValue:"",toAmountValue:"",liquidityAmount:"",byAmountIn:!0,isTokenA:!0}))}}),qe=gs(hi);function bi(t){var A,z;const{onClose:c,onSubmit:s,data:{feeTier:u}}=t,{fromToken:g,toToken:r,fromAmount:i,toAmount:o,totalAmount:d,percentMap:a,fromTokenLock:l,toTokenLock:x}=qe(),{lowerTickData:b,upperTickData:w}=Ee(),{currentPriceData:j,apiPoolInfo:R}=ue(),{setIsChecked:H}=Ut(),[m,h]=f.useState(!0),n=f.useMemo(()=>{var L;return((L=R==null?void 0:R.tokenA)==null?void 0:L.coin_type)===(g==null?void 0:g.coin_type)?!m:!!m},[R,g,r,m]),y=f.useMemo(()=>m?`${P(r==null?void 0:r.symbol,10)} per ${P(g==null?void 0:g.symbol,10)}`:`${P(g==null?void 0:g.symbol,10)} per ${P(r==null?void 0:r.symbol)}`,[m,g==null?void 0:g.symbol,r==null?void 0:r.symbol]),M=Es(()=>{s(),c()},1e3,{leading:!0,trailing:!1}),{notifiStatus:k}=Ut();return e.jsxs(ys,{isOpen:!0,onClose:()=>{c(),H(!1)},isCentered:!0,children:[e.jsx(hs,{}),e.jsxs(bs,{children:[e.jsx(fs,{children:e.jsx(tt,{fontWeight:"500",fontSize:"16px",children:"Add Liquidity"})}),e.jsx(Js,{}),e.jsx(js,{textAlign:"center",p:"0px",children:e.jsxs(W,{w:"100%",gap:"20px",p:"8px 16px",pb:"0px",children:[e.jsxs(q,{w:"100%",justifyContent:"space-between",h:"40px",children:[e.jsxs(q,{children:[e.jsx(As,{coinACoinType:g==null?void 0:g.coin_type,coinBCoinType:r==null?void 0:r.coin_type,coinAIconUrl:g==null?void 0:g.logo_url,coinBIconUrl:r==null?void 0:r.logo_url,imageStyle:{w:"40px",h:"40px"},imgBoxStyle:{w:"40px",h:"40px"}}),e.jsx(F,{fontSize:"16px",color:"text_caption",textAlign:"left",children:`${P(g==null?void 0:g.symbol,10)} - ${P(r==null?void 0:r.symbol,10)}`})]}),e.jsx(Ps,{w:"unset",p:"8px 12px",borderRadius:"12px",ml:"4px",children:e.jsxs(q,{gap:"12px",children:[e.jsx(F,{whiteSpace:"nowrap",children:"Fee Tier"}),e.jsx(F,{color:"primary",children:u==null?void 0:u.feeDisplay})]})})]}),e.jsx(Br,{coinA:{amount:i,...g},coinB:{amount:o,...r}}),e.jsxs(ne,{w:"100%",children:[e.jsxs(q,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(F,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Selected Range"}),e.jsx(Mr,{isActive:!l&&!x,isRow:!0,imgStyle:{imgW:"29px",imgH:"16px"},w:"105px",h:"32px"})]}),e.jsxs(q,{justify:"center",bg:"bg_secondary",borderRadius:"8px",h:"48px",w:"100%",gap:"4px",mt:"12px",children:[e.jsx(F,{children:"Current Price"}),e.jsx(F,{as:"span",color:"text_caption",children:ht(n?j.reverseCurrentPrice:j==null?void 0:j.currentPrice,6)}),e.jsx(F,{children:y}),e.jsx(fe,{variant:"unstyled",onClick:()=>h(!m),children:e.jsx(Me,{xlinkHref:"#icon-icon_swap1"})})]}),e.jsxs(q,{w:"100%",h:"100px",bg:"bg_secondary",borderRadius:"12px",mt:"8px",children:[e.jsx(xs,{title:"Min Price",price:ht(n?w==null?void 0:w.reversePrice:b==null?void 0:b.price,6),perText:y}),e.jsx(Ss,{orientation:"vertical",h:"40px"}),e.jsx(xs,{title:"Max Price",price:ht(n?b==null?void 0:b.reversePrice:w==null?void 0:w.price,6),perText:y})]})]}),e.jsx(me,{isLoading:!1,label:"Deposit Ratio",value:`${a[(g==null?void 0:g.coin_type)===((A=R==null?void 0:R.tokenA)==null?void 0:A.coin_type)?"percentA":"percentB"]}% ${P(g==null?void 0:g.symbol,10)} / ${a[(r==null?void 0:r.coin_type)===((z=R==null?void 0:R.tokenA)==null?void 0:z.coin_type)?"percentA":"percentB"]}% ${P(r==null?void 0:r.symbol,10)} `,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",maxW:"unset"},skeletonStyle:{valueW:"128px"}}),e.jsx(me,{isLoading:!1,label:"Total Amount",value:d&&+d?Gt(d):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),!l&&!x&&!((b==null?void 0:b.price)==="0"&&(w==null?void 0:w.price)==="âˆž")&&k=="authenticated"&&e.jsx(zr,{subscriptionSource:"AddLiquidity",title:"Range alerts for this position",description:"Subscribe to receive alerts on email, SMS, or Telegram when the price for this pool moves out of your selected range.",wrapStyle:{bg:"bg_secondary",borderRadius:"12px"}}),e.jsx(fe,{w:"calc(100% + 32px)",bottom:"0px",mt:"4px",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:M,children:"Add Liquidity"})]})})]})]})}const xs=({title:t,price:c,perText:s})=>e.jsxs(W,{flex:"1",children:[e.jsx(F,{children:t}),e.jsx(F,{color:"text_caption",children:c}),e.jsx(F,{children:s})]});function fi(){return{getLeverage:(c,s)=>c&&s&&c!=="0"&&s!=="âˆž"?ms(1/(1-Number(Q(c).div(s).toNumber()**.25)),2)+"x":"1x"}}function ji(t,c){const{preAdd:s,getClmmCreateAddData:u,getFarmsCreateAddData:g}=Vr();f.useState(!1);const{currentPriceData:r,apiPoolInfo:i,contractPoolInfo:o}=ue(),{lowerTickData:d,upperTickData:a}=Ee(),{signAndExecuteTransaction:l,getTransactionStatus:x,transactionSuccess:b}=Wr(),{mevProtect:w,maxCapForGas:j,transactionMode:R,customGasPrice:H}=Er(),[m,h]=f.useState(!1),[n,y]=f.useState(!1),[M,k]=f.useState(""),{transactionConfirmation:A}=Ur(),{fromAmount:z,setFromAmount:L,fromAmountValue:D,setFromAmountValue:V,toAmount:X,setToAmount:se,toAmountValue:ee,setToAmountValue:Y,byAmountIn:Z,setByAmountIn:pe,isTokenA:te,setIsTokenA:S,percentMap:B,setPercentMap:$,isFullRange:T,setIsFullRange:J,fromToken:C,setFromToken:I,toToken:p,setToToken:_,totalAmount:E,setTotalAmount:U,fromTokenLock:N,setFromTokenLock:ae,toTokenLock:le,setToTokenLock:K,setTokenMaxA:ye,setTokenMaxB:Ce,tokenMaxA:Ke,tokenMaxB:it,autoStakePosition:Je,liquidityAmount:kt,setLiquidityAmount:nt}=qe(),{getTokenAmountValue:ke}=_s();Pt(()=>{var O,xe;i&&S(((O=i==null?void 0:i.displayTokenA)==null?void 0:O.coin_type)===((xe=i==null?void 0:i.tokenA)==null?void 0:xe.coin_type))},[i]);const{isWhiteQuoteToken:Lt}=Ts(),{notifiSubscription:Qe}=Nr(),{isChecked:at}=Ut();rt(()=>{if(T){$({percentA:"50",percentB:"50"});return}if(i&&(i!=null&&i.tokenA)&&(i!=null&&i.tokenB)&&typeof(o==null?void 0:o.current_tick_index)=="number"&&(d==null?void 0:d.tick)!==void 0&&(a==null?void 0:a.tick)!==void 0&&r.currentSqrtPrice){if(ie(d.tick).lte(o.current_tick_index)&&ie(a.tick).gt(o.current_tick_index)){const O=Lt(i.tokenA.coin_type)?i.tokenA:i.tokenB,xe=O.coin_type===i.tokenA.coin_type,he=s({amount:pt("1",O.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:xe,lowerTick:d==null?void 0:d.tick,upperTick:a==null?void 0:a.tick,curSqrtPrice:r.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0}),Le=qr(he.coinAmountA,he.coinAmountB,r==null?void 0:r.currentPrice,T);$(Le);return}if(ie(d.tick).gt(o.current_tick_index)){$({percentA:"100",percentB:"0"});return}if(ie(a.tick).lte(o.current_tick_index)){$({percentA:"0",percentB:"100"});return}}},[JSON.stringify(i),r,d==null?void 0:d.tick,a==null?void 0:a.tick,T],{wait:300});const ct=({amount:O,isTokenA:xe,isFullRange:he})=>{var Le,He,Ne,Ve;if(i&&(i!=null&&i.tokenA)&&(i!=null&&i.tokenB)&&Object.keys(r).length>0&&(d==null?void 0:d.tick)!==void 0&&(a==null?void 0:a.tick)!==void 0&&C&&p){let G;if(typeof(o==null?void 0:o.current_tick_index)=="number"&&ie(d==null?void 0:d.tick).lte(o==null?void 0:o.current_tick_index)&&ie(a==null?void 0:a.tick).gt(o==null?void 0:o.current_tick_index))G=s({amount:pt(O&&+O?O+"":"1",Z?C==null?void 0:C.decimals:p==null?void 0:p.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:xe,lowerTick:d==null?void 0:d.tick,upperTick:a==null?void 0:a.tick,curSqrtPrice:r.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0});else if(N&&!le){const ce=(p==null?void 0:p.coin_type)===((Le=i==null?void 0:i.tokenA)==null?void 0:Le.coin_type);G=s({amount:pt(O?O+"":"1",p==null?void 0:p.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:ce,lowerTick:d==null?void 0:d.tick,upperTick:a==null?void 0:a.tick,curSqrtPrice:r.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0})}else if(le&&!N){const ce=(C==null?void 0:C.coin_type)===((He=i==null?void 0:i.tokenA)==null?void 0:He.coin_type);G=s({amount:pt(O?O+"":"1",C==null?void 0:C.decimals).toString(),tokenA:i==null?void 0:i.tokenA,tokenB:i==null?void 0:i.tokenB,isTokenA:ce,lowerTick:d==null?void 0:d.tick,upperTick:a==null?void 0:a.tick,curSqrtPrice:r.currentSqrtPrice,isReverse:i==null?void 0:i.isReverse,roundUp:!0})}else N&&le&&(G=xe?{coinAmountA:O?O+"":"1",coinAmountB:"",tokenMaxA:O?O+"":"1",tokenMaxB:""}:{coinAmountA:"",coinAmountB:O?O+"":"1",tokenMaxA:"",tokenMaxB:O?O+"":"1"});if(ye(G==null?void 0:G.tokenMaxA),Ce(G==null?void 0:G.tokenMaxB),O)if(ie(O).gt("0"))if(Z){const ce=(p==null?void 0:p.coin_type)===((Ne=i==null?void 0:i.tokenA)==null?void 0:Ne.coin_type)?G==null?void 0:G.coinAmountA:G==null?void 0:G.coinAmountB,je=ke(C==null?void 0:C.coin_type,O+""),Ae=ke(p==null?void 0:p.coin_type,ce),Te=ie(je).plus(Ae).toString();console.log(ce,je,Ae,Te,"_totalAmountValue"),se(ce||""),V(je),Y(Ae),U(Te)}else{const ce=(C==null?void 0:C.coin_type)===((Ve=i==null?void 0:i.tokenA)==null?void 0:Ve.coin_type)?G==null?void 0:G.coinAmountA:G==null?void 0:G.coinAmountB,je=ke(C==null?void 0:C.coin_type,ce),Ae=ke(p==null?void 0:p.coin_type,O+""),Te=ie(je).plus(Ae).toString();console.log(ce,je,Ae,Te,"_totalAmountValue"),V(je),Y(Ae),L(ce||""),U(Te)}else Z?(se(""),V(""),Y(""),U("")):(L(""),V(""),Y(""),U(""));else L(""),se(""),V(""),Y(""),U("");G&&nt((G==null?void 0:G.liquidityAmount)||"")}};rt(()=>{ct({amount:Z?z:X,isTokenA:te,isFullRange:T})},[JSON.stringify(i),r,d==null?void 0:d.tick,a==null?void 0:a.tick,z,X,Z,te,N,le,T],{wait:300});const lt=(O,xe,he)=>{pe(xe),xe?L(O):se(O),S(he!==void 0?he:!1)},{balanceInfo:dt}=St(C),{balanceInfo:v}=St(p);Pt(()=>{var O,xe;S(Z?(C==null?void 0:C.coin_type)===((O=i==null?void 0:i.tokenA)==null?void 0:O.coin_type):(p==null?void 0:p.coin_type)===((xe=i==null?void 0:i.tokenA)==null?void 0:xe.coin_type))},[i,Z,C,p]),f.useEffect(()=>{(d==null?void 0:d.tick)===ft.getMinIndex(Number((d==null?void 0:d.tickSpacing)||0))&&(a==null?void 0:a.tick)===ft.getMaxIndex(Number((a==null?void 0:a.tickSpacing)||0))?J(!0):J(!1)},[d==null?void 0:d.tick,a==null?void 0:a.tick]),f.useEffect(()=>{(o==null?void 0:o.current_tick_index)!==void 0&&oe(d)&&oe(a)&&(ie(d==null?void 0:d.tick).gte(ie(a.tick))?(ae(!0),K(!0)):ie(d==null?void 0:d.tick).gt(o==null?void 0:o.current_tick_index)?(ae(!c),K(!!c)):ie(a.tick).lte(o==null?void 0:o.current_tick_index)?(ae(!!c),K(!c)):(ae(!1),K(!1)))},[d==null?void 0:d.tick,a==null?void 0:a.tick,o,c]);const{currentAccount:de,onWalletModal:_e}=Rt(),$e=Es(()=>{de?h(!0):_e(!0)},300,{leading:!0,trailing:!1}),We=()=>{L(""),se(""),V(""),Y(""),U("")},{fetchAccountBalance:Ue}=Ls();return{percentMap:B,handleAmountChange:lt,fromToken:C,setFromToken:I,toToken:p,setToToken:_,byAmountIn:Z,setByAmountIn:pe,fromAmount:z,fromAmountValue:D,setFromAmount:L,toAmount:X,toAmountValue:ee,setToAmount:se,liquidityAmount:kt,fromBalanceInfo:dt,toBalanceInfo:v,totalAmount:E,fromTokenLock:N,toTokenLock:le,handleAdd:$e,confirmModalOpen:m,setConfirmModalOpen:h,nftOpen:n,setNftOpen:y,relatedPosId:M,handleSubmit:async()=>{var Ae,Te,Xt;const O=Z?z:X,xe=Z?C==null?void 0:C.decimals:p==null?void 0:p.decimals,he=ie(O).mul(Is.pow(10,xe)).toString(),Le=Z&&(C==null?void 0:C.coin_type)===((Ae=i==null?void 0:i.tokenA)==null?void 0:Ae.coin_type)?!0:(p==null?void 0:p.coin_type)===((Te=i==null?void 0:i.tokenA)==null?void 0:Te.coin_type)&&!Z;let He,Ne;const Ve=d.tick,G=a.tick,ce=o==null?void 0:o.current_tick_index;Ve!==void 0&&G!==void 0&&ce!==void 0&&(ce>=Ve&&ce<=G?(He=Le?he:Ke,Ne=Le?it:he):ce>G?(He=0,Ne=he):ce<Ve&&(He=he,Ne=0));let je=[];if(o!=null&&o.index){const{rewarder_infos:ge}=o;je=(ge==null?void 0:ge.length)>0&&(ge==null?void 0:ge.map(Pe=>Pe.coinAddress))||[]}try{const ge={poolAddress:o==null?void 0:o.poolAddress,coinTypeA:o==null?void 0:o.coinTypeA,coinTypeB:o==null?void 0:o.coinTypeB,amountA:He,amountB:Ne,fixAmountA:Le,lowerTick:Ve,upperTick:G,currentSqrtPrice:o==null?void 0:o.current_sqrt_price,rewarderCoinTypes:je,farmsPoolId:i==null?void 0:i.farmsPoolAddress},Pe={getShowInfo:(re,Oe)=>{const xt=!N&&!le?`Add ${z} ${C==null?void 0:C.symbol} and ${X} ${p==null?void 0:p.symbol}`:le?N?"Add Liquidity":`Add ${z} ${C==null?void 0:C.symbol}`:`Add ${X} ${p==null?void 0:p.symbol}`,ut={modalDescriptionText:xt,toastTitleText:xt};if(re==="success"){let Bt=z,Mt=X;Oe&&(Bt=It(Oe,C)||z,Mt=It(Oe,p)||X);const Yt=!N&&!le?`Add ${Bt} ${C==null?void 0:C.symbol} and ${Mt} ${p==null?void 0:p.symbol}`:!N&&le?`Add ${Bt} ${C==null?void 0:C.symbol}`:!le&&N?`Add ${Mt} ${p==null?void 0:p.symbol}`:"Add Liquidity";ut.toastDescriptionContent=Yt,ut.modalDescriptionText=Yt,ut.toastTitleText="Supplied Successful"}return ut}};A(Pe);let Tt,Ft;if(Je){const re=await g(ge);Tt=re==null?void 0:re.tx,Ft=re==null?void 0:re.msafeParams}else{const re=await u(ge);Tt=re==null?void 0:re.tx,Ft=re==null?void 0:re.msafeParams}let ve=await l(Tt,Pe,{useDevInspect:!0,useMev:w,showSuccessModal:!1,useFastMode:R==="Fast Mode",maxCapForGas:j,customGasPrice:H,msafeParams:Ft});if(ve){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAddLiquidity.ts:403 ~ handleSubmit ~ res:",ve),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useAddLiquidity.ts:411 ~ handleSubmit ~ isChecked:",at),((Xt=ve==null?void 0:ve.events)==null?void 0:Xt.length)===0&&(ve=await x(ve.digest));const{posId:re,farmsPosId:Oe}=er(ve);if(console.log("ðŸš€ ~ file: useAddLiquidity.ts:436 ~ handleSubmit ~ posId:",{posId:re,farmsPosId:Oe}),re?(y(!0),k(Oe||re)):b(Pe),at){const xt={subscriptionSource:"AddLiquidity",events:ve.events};Qe(xt)}Ue(),We(),t()}}catch(ge){throw console.error(ge,"handleSubmit ~ error"),new Error(ge)}}}}function Ai(){const{fromAmount:t,toAmount:c,fromToken:s,toToken:u,fromTokenLock:g,toTokenLock:r,liquidityAmount:i}=qe(),{currentAccount:o}=Rt(),{balanceInfo:d}=St(s),{balanceInfo:a}=St(u),l=f.useMemo(()=>{const x={text:"Add Liquidity",disabled:!1};return o!=null&&o.address?!g&&!r&&(!t||!c||t&&!+t||c&&!+c)||g&&!r&&(!c||c&&!+c)||r&&!g&&(!t||t&&!+t)?(x.text="Enter an amount",x.disabled=!0,x):t&&+t&&Q(t).gt((d==null?void 0:d.balanceFormat)||0)?(x.disabled=!0,x.text=`Insufficient ${P(s==null?void 0:s.symbol,10)} Balance`,x):c&&+c&&Q(c).gt((a==null?void 0:a.balanceFormat)||0)?(x.disabled=!0,x.text=`Insufficient ${P(u==null?void 0:u.symbol,10)} Balance`,x):((!g&&!r&&(!t||!c)||Q(i).lte("0"))&&(x.disabled=!0),x):(x.text="Connect Wallet",x.disabled=!1,x)},[o==null?void 0:o.address,t,c,d==null?void 0:d.balanceDisplay,a==null?void 0:a.balanceDisplay,s,u,g,r,i]);return{btnText:l.text,btnDisabled:l.disabled}}function Si({onClose:t,posId:c,tokenA:s,tokenB:u,fee:g,isReverse:r}){const i=wt(),[o,d]=f.useState(!0),{lowerTickData:a,upperTickData:l}=Ee();return f.useLayoutEffect(()=>{r&&d(!1)},[r]),e.jsxs(ys,{isOpen:!0,autoFocus:!1,returnFocusOnClose:!1,onClose:t,isCentered:!0,children:[e.jsx(hs,{}),e.jsxs(bs,{w:"400px",children:[e.jsx(fs,{children:e.jsxs(q,{justify:"space-between",w:"100%",children:[e.jsx(F,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Open position successful"}),e.jsx(fe,{onClick:t,variant:"unstyled",p:"0",minW:"unset",minH:"unset",w:"20px",h:"20px",children:e.jsx(Me,{xlinkHref:"#icon-icon_close"})})]})}),e.jsx(js,{children:e.jsxs(W,{gap:"36px",children:[e.jsxs(W,{gap:"16px",bg:"center / contain no-repeat url('/images/active-sui.gif') ",w:"240px",h:"240px",justify:"center",border:"1px solid",borderColor:"border",borderRadius:"16px",children:[e.jsx(As,{coinAIconUrl:s==null?void 0:s.logo_url,coinBIconUrl:u==null?void 0:u.logo_url,coinACoinType:s==null?void 0:s.coin_type,coinBCoinType:u==null?void 0:u.coin_type,w:"48px",h:"48px"}),e.jsxs(F,{fontSize:"20px",fontWeight:"500",color:"text_caption",lineHeight:"28px",children:[P(s==null?void 0:s.symbol,10)," - ",P(u==null?void 0:u.symbol,10)]}),e.jsxs(q,{bg:"bg_secondary",p:"8px 12px",border:"1px solid",borderColor:"border",borderRadius:"12px",children:[e.jsx(F,{fontSize:"14px",children:"Fee tier"}),e.jsx(F,{fontSize:"14px",color:"text_highlight",children:g})]})]}),e.jsxs(W,{w:"100%",justify:"center",borderRadius:"8px",border:"1px solid",borderColor:"border",bg:"input_bg",p:"16px 8px",children:[e.jsxs(F,{color:"text_caption",whiteSpace:"nowrap",children:[o?Re(a==null?void 0:a.price,6):Re(l==null?void 0:l.reversePrice,6)," -Â ",o?Re(l==null?void 0:l.price,6):Re(a==null?void 0:a.reversePrice,6)]}),e.jsxs(q,{children:[e.jsxs(q,{gap:"0",children:[e.jsx(F,{color:"primary_gray",children:P(o?r?s==null?void 0:s.symbol:u==null?void 0:u.symbol:r?u==null?void 0:u.symbol:s==null?void 0:s.symbol,10)}),e.jsx(F,{color:"primary_gray",children:"Â perÂ "}),e.jsx(F,{color:"primary_gray",children:P(o?r?u==null?void 0:u.symbol:s==null?void 0:s.symbol:r?s==null?void 0:s.symbol:u==null?void 0:u.symbol,10)})]}),e.jsx(Me,{xlinkHref:"#icon-icon_swap1",w:"16px",h:"16px",onClick:x=>{Kt(x),d(!o)}})]})]})]})}),e.jsx(tr,{p:"20px 0 0",children:e.jsx(fe,{flex:"1",onClick:()=>i(`/position-detail/${c}`),h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",children:"View Detail"})})]})]})}function Hs({perText:t,direct:c,minPriceData:s,maxPriceData:u,isFullRange:g=!1}){const{tickDataLoading:r}=Ee(),{handleAddPrice:i,handleSubPrice:o,setTickDataBasedOnPrice:d}=Ct();return e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",gap:{base:"8px",lg:"16px"},children:[e.jsx(ss,{title:"Min Price",perText:t,data:s,direct:c,loading:r,handleAddPrice:i,handleSubPrice:o,setTickDataBasedOnPrice:d,isFullRange:g}),e.jsx(ss,{title:"Max Price",perText:t,data:u,direct:c,loading:r,handleAddPrice:i,handleSubPrice:o,setTickDataBasedOnPrice:d,isFullRange:g})]})}const Ns=({minPrice:t,maxPrice:c,perText:s,checked:u,onChange:g,loading:r})=>e.jsxs(q,{w:"100%",justify:{base:"space-between",lg:"center"},align:{base:"flex-start",lg:"center"},p:{base:"0 12px",lg:"0"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},children:[e.jsxs(q,{children:[e.jsx(Cs,{tooltip:e.jsxs(ne,{as:"div",lineHeight:"20px",fontSize:"12px",children:["Farm reward range: Only liquidity within this range is eligible to receive farming rewards of the pool. Â ",e.jsx(ne,{as:"a",color:"primary",onClick:i=>{Kt(i),window.open("https://medium.com/@CetusProtocol/cetus-new-farms-everything-you-should-know-about-it-c6b60e6a6ae5")},children:"Learn More"})]})}),e.jsx(F,{children:"Farm rewards range"})]}),e.jsxs(q,{children:[r?e.jsx(st,{w:"120px",h:"14px"}):e.jsxs(F,{color:"primary_yellow",children:[t,"Â -Â ",c]}),e.jsx(F,{children:s})]})]}),e.jsx(Ht,{isChecked:u,onChange:g})]}),Vs=({disabled:t,checked:c,onChange:s})=>e.jsxs(q,{p:{base:"20px 8px",lg:"24px 24px 24px 16px"},border:{base:"none",lg:"1px solid"},borderColor:{base:"transparent",lg:"border"},borderRadius:{base:"0 0 20px 20px",lg:"20px"},bg:"bg_six",gap:"12px",children:[e.jsx(Cs,{flex:"0 0 24px",h:"24px"}),e.jsx(F,{lineHeight:"20px",color:"text_caption",children:"Automatically stake your position into the farm to enjoy higher yield."}),t?e.jsx(bt,{tooltip:e.jsxs(W,{gap:"4px",align:"flex-start",children:[e.jsx(F,{fontSize:"12px",children:"Farming rewards only available"}),e.jsx(F,{fontSize:"12px",children:"for active positions."})]}),placement:"top",maxW:"198px",children:e.jsx(Ht,{isChecked:c,disabled:t,onChange:s})}):e.jsx(Ht,{isChecked:c,disabled:t,onChange:s})]}),_i=[{label:"24H",key:"24_h"},{label:"7D",key:"7_d"},{label:"30D",key:"30_d"}];function Os({direct:t,rangeMap:c,wrapStyle:s={}}){const[u,g]=f.useState({type:"30D",key:"30_d"}),{minPriceForDate:r,maxPriceForDate:i,setMinPriceForDate:o,setMaxPriceForDate:d}=ue();f.useEffect(()=>{let l="";if(oe(c)){const b=c[`before_${u==null?void 0:u.key}_contract_price_lowest`],w=t?b:Q(1).div(b).toString();l=Re(w,6)}else l="-";o(l);let x="";if(oe(c)){const b=c[`before_${u==null?void 0:u.key}_contract_price_highest`],w=t?b:Q(1).div(b).toString();x=Re(w,6)}else x="-";d(x)},[t,u.key,c]);const{isApp:a}=ze();return e.jsxs(q,{w:"100%",justify:"space-between",...s,children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},align:{base:"flex-start",lg:"center"},children:[e.jsxs(q,{children:[e.jsx(Ze,{borderRadius:"4px",border:"1px solid",borderColor:"border",w:"20px",h:"20px",color:"text_caption",children:e.jsx(Ss,{w:"14px",border:"1px dashed"})}),e.jsxs(F,{fontSize:"12px",whiteSpace:"nowrap",children:[u==null?void 0:u.type,"Â Price Range"]})]}),e.jsxs(F,{color:"text_caption",fontSize:"12px",lineHeight:"12px",h:"12px",children:[t?r:i,"Â -Â ",t?i:r]})]}),e.jsx(De,{type:"outlineTab",tabList:_i,currentTab:u,handleChangeTab:l=>{g({type:l.label,key:l.key})},isActive:(l,x)=>l.key===x.key,wrapStyle:{h:a?"28px":"20px",p:"1px",border:"1px solid",borderColor:"border",borderRadius:{base:"8px",lg:"4px"},gap:"0px",w:"auto"},itemStyle:{h:a?"24px":"16px",p:"2px 8px",fontSize:"12px",borderRadius:"4px",flex:1}})]})}function vi(){const{fetchByApi:t}=Nt(),[c,s]=f.useState(""),u=async d=>{var a,l,x,b;try{const j=await t(ur,"GET",{pool:d}),R=((l=(a=j==null?void 0:j.list)==null?void 0:a[0])==null?void 0:l.recommend_ranges)||{},H=((b=(x=j==null?void 0:j.list)==null?void 0:x[0])==null?void 0:b.type)||"";console.log("ðŸš€ðŸš€ðŸš€ ~ getRecommendRanges ~ type:",H);const m={};if(R)for(const h in R){const n=R[h];(n!=null&&n.lower||n!=null&&n.upper)&&(m[h]={lower:n.lower,upper:n.upper})}return{ranges:m,type:H}}catch(w){return console.error("Error in getRecommendRanges:",w),{ranges:{},type:""}}},g=(d,a)=>({default:{lower:d,upper:a,sort:3}}),r=d=>({"full range":{lower:ft.getMinIndex(d),upper:ft.getMaxIndex(d),sort:2}}),i=(d,a,l)=>{const x=Q(l).mul(a==="unstable"?2:3).toNumber(),b=sr(Number(d),Number(l));return{custom:{lower:Q(b).sub(x).toNumber(),upper:Q(b).add(x).toNumber(),sort:1}}};return{getRecommendRanges:u,getRecommendRangesList:async d=>{try{const a=d.farmsEffectTickLower&&d.farmsEffectTickUpper?g(d.farmsEffectTickLower,d.farmsEffectTickUpper):null,l=d.farmsEffectTickLower&&d.farmsEffectTickUpper?{ranges:{},type:""}:await u(d.poolAddress);s(l.type);const x=r(d.tickSpacing),b=i(d.currentTick,l.type,d.tickSpacing),w={...a,...l.ranges,...x,...b},j=Object.entries(w).map(([R,H])=>({key:R,...H})).sort((R,H)=>H.sort-R.sort);return oe(l.ranges)||oe(a)?{rangeList:j,error:!1}:{rangeList:j,error:!0}}catch(a){return console.error("Error in getRecommendRangesList:",a),{rangeList:[],error:!0}}},poolType:c}}const qt=(t,c=!1)=>{switch(t){case"passive":return{name:"Conservative",image:c?"img_conservative_sel@2x.png":"img_conservative_nor@2x.png"};case"active":return{name:"Active",image:c?"img_active_sel@2x.png":"img_active_nor@2x.png"};case"full range":return{name:"Full Range",image:c?"img_fullrange_sel@2x.png":"img_fullrange_nor@2x.png"};case"custom":return{name:"Custom",image:c?"img_custom_sel@2x.png":"img_custom_nor@2x.png"};case"suggested":return{name:"Stable",image:c?"img_stable_sel@2x.png":"img_stable_nor@2x.png"};default:return{name:"Default",image:c?"img_stable_sel@2x.png":"img_stable_nor@2x.png"}}},wi=t=>{switch(t){case"passive":return"Lower yields and lower impermanent loss. Less frequent rebalancing.";case"active":return"Higher yields but higher impermanent loss potentially. Requires frequent rebalancing.";case"full range":return"Full range positions are active all the time with no need to be rebalanced but may earn less fees than concentrated liquidity.";case"custom":return"Recommended only if you understand how concentrated liquidity works.";case"suggested":return"Stable range according to the price history of last 7 days.";default:return"The default range of this pool is set following the real-time valid range of its farm."}},Ri={1:"100%",2:"50%",3:"33.33%",4:"50%"};function Ds(t){const{getRecommendRangesList:c}=vi(),[s,u]=f.useState(),{poolAddress:g,currentTick:r,tickSpacing:i,farmsEffectTickLower:o,farmsEffectTickUpper:d}=t;ze();const{handleInitTickData:a}=Ct(),{apiPoolInfo:l,currentRange:x,setCurrentRange:b}=ue(),{lowerTickData:w,upperTickData:j,setLowerTickData:R,setUpperTickData:H,setTickDataLoading:m,tickDataLoading:h}=Ee(),n=async()=>{var y,M,k;try{x||m(!0);const{rangeList:A,error:z}=await c(t);if(u(A),z){if(b("custom"),!x&&(l!=null&&l.tokenA)&&(l!=null&&l.tokenB)){const L=A.find(D=>D.key==="custom");L&&a(L==null?void 0:L.lower,L==null?void 0:L.upper,l)}}else b((y=A[0])==null?void 0:y.key),!x&&(l!=null&&l.tokenA)&&(l!=null&&l.tokenB)&&a((M=A[0])==null?void 0:M.lower,(k=A[0])==null?void 0:k.upper,l)}catch(A){console.error(A)}finally{m(!1)}};return rt(()=>{g&&r!==void 0&&i!==void 0&&n()},[g,i],{wait:500}),f.useEffect(()=>{if(s&&s.length>0&&oe(w)&&oe(j)){const y=s==null?void 0:s.find(M=>Q(M.lower).eq(Q(w==null?void 0:w.tick))&&Q(M.upper).eq(Q(j==null?void 0:j.tick)));y?y.key!==x&&b(y.key):b("custom")}},[w==null?void 0:w.tick,j==null?void 0:j.tick,s]),e.jsx(e.Fragment,{children:e.jsx(rr,{w:{base:"100%",lg:"124px"},flexDirection:{base:"row",lg:"column"},flexWrap:"wrap",border:"1px solid",borderColor:s&&s.length>0?"border":"transparent",borderRadius:"16px",p:"4px",rowGap:{base:"20px",lg:"0"},bg:s&&s.length>0?"background":"transparent",marginTop:"0",minH:"62px",children:s==null?void 0:s.map((y,M)=>{var k,A;return e.jsx(ir,{label:wi(y.key),lineHeight:"1.5",placement:"top",gutter:-4,children:e.jsxs(W,{cursor:"pointer",textAlign:"center",width:{base:s!=null&&s.length?Ri[s.length+""]:"auto",lg:"auto"},p:"8px 20px",gap:"4px",onClick:()=>{y.key!==x&&(b(y.key),l!=null&&l.tokenA&&(l!=null&&l.tokenB)&&a(y.lower,y.upper,l))},bg:y.key==x?"card_bg":"transparent",borderRadius:"12px",sx:{_hover:{p:{color:"primary"}}},children:[e.jsx(es,{decoding:"async",display:y.key===x?"block":"none",src:`/images/${(k=qt(y.key,!0))==null?void 0:k.image}`,w:"72px",h:y.key===x?"22px":"0px",fallback:e.jsx(ne,{bg:"background",w:"72px",h:y.key===x?"22px":"0px",borderRadius:"4px"})}),e.jsx(es,{decoding:"async",display:y.key===x?"none":"block",src:`/images/${(A=qt(y.key,!1))==null?void 0:A.image}`,w:"72px",h:y.key===x?"0px":"22px",fallback:e.jsx(ne,{bg:"background",w:"72px",h:y.key===x?"0px":"22px",borderRadius:"4px"})}),e.jsx(F,{color:y.key==x?"primary":"primary_gray",fontSize:"12px",children:qt(y.key).name})]})},y.key)})})})}function Ci({btnText:t,btnDisabled:c,handleChangeIsFarmRewardsRange:s,onReverseClick:u,leverage:g,direct:r,perText:i,rangeTabList:o,currentRangeTab:d,addressHistTokensMap:a,fromBalanceInfo:l,toBalanceInfo:x,fromAmountValue:b,toAmountValue:w,handleAmountChange:j,handleAdd:R,isFullRange:H}){var I;const{currentPriceData:m,contractPoolInfo:h,apiPoolInfo:n,resetLiquidity:y,contractPoolInfoLoading:M,apiPoolInfoLoading:k,minPriceForDate:A,maxPriceForDate:z}=ue(),{lowerTickData:L,upperTickData:D}=Ee(),{autoStakePosition:V,setAutoStakePosition:X,isFarmRewardsRange:se,fromAmount:ee,toAmount:Y,byAmountIn:Z,percentMap:pe,fromToken:te,toToken:S,totalAmount:B,fromTokenLock:$,toTokenLock:T}=qe(),{poolAddress:J}=Se(),C=p=>{X(p.target.checked)};return f.useMemo(()=>!!(n!=null&&n.haveFarming)&&!!(n!=null&&n.displayFarmsEffectMaxPrice)&&!!(n!=null&&n.displayFarmsEffectMinPrice),[n==null?void 0:n.haveFarming,n==null?void 0:n.displayFarmsEffectMaxPrice,n==null?void 0:n.displayFarmsEffectMinPrice]),e.jsxs(ne,{w:"100%",children:[e.jsx(tt,{fontSize:"16px",fontWeight:"500",mb:"16px",children:"1. Select Range"}),e.jsx(Ds,{poolAddress:J,currentTick:h==null?void 0:h.current_tick_index,tickSpacing:h==null?void 0:h.tickSpacing,farmsEffectTickLower:n==null?void 0:n.farmsEffectiveTickLower,farmsEffectTickUpper:n==null?void 0:n.farmsEffectiveTickUpper}),k?e.jsx(st,{mt:"20px",h:"40px",borderRadius:"8px",w:"100%"}):e.jsx(De,{type:"outlineTab",tabList:o,currentTab:d,handleChangeTab:p=>u(p),wrapStyle:{mt:"20px",h:"40px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"12px"},itemStyle:{flex:1,h:"32px",borderRadius:"4px",gap:"4px"}}),e.jsx(Bs,{price:vs(r?m==null?void 0:m.currentPrice:m.reverseCurrentPrice,6),perText:i,loading:M,wrapStyle:{mt:"28px",gap:"12px"}}),e.jsx(W,{flex:"1",h:"180px",pos:"relative",mt:"20px",children:e.jsx(ks,{handleClickRefresh:()=>{},direct:r,minPriceData:r?L:D,maxPriceData:r?D:L,dashedMarkerLine:[A,z]})}),e.jsx(Os,{direct:r,rangeMap:a,wrapStyle:{mt:"90px",align:"center",gap:"20px"}}),e.jsxs(W,{borderRadius:"20px",border:"1px solid",borderColor:"border",bg:"bg_six",mt:"20px",mb:"20px",p:"8px",gap:"12px",children:[e.jsx(Hs,{perText:i,direct:r,isFullRange:H,minPriceData:r?L:D,maxPriceData:r?D:L}),$&&T&&e.jsx(Ze,{w:"100%",fontSize:"12px",color:"primary_red",bg:"primary_red_opacity.10",h:"32px",borderRadius:"8px",children:"The max price should be higher than min price."})]}),e.jsxs(W,{mb:"20px",gap:"16px",children:[e.jsx(vt,{label:"Leverage",tooltip:"This parameter indicates the concentration rate of your liquidity relative to a full range position.",wrapStyle:{flexDir:"row",gap:"8px",p:"0 12px 0"},children:e.jsx(F,{color:"text_caption",children:$&&T?"--":g})}),(n==null?void 0:n.haveFarming)&&(n==null?void 0:n.displayFarmsEffectMaxPrice)&&(n==null?void 0:n.displayFarmsEffectMinPrice)&&e.jsx(Ns,{minPrice:r?jt(n==null?void 0:n.displayFarmsEffectMinPrice):At(n==null?void 0:n.displayFarmsEffectMaxPrice),maxPrice:r?jt(n==null?void 0:n.displayFarmsEffectMaxPrice):At(n==null?void 0:n.displayFarmsEffectMinPrice),loading:k,perText:i,checked:se,onChange:s})]}),e.jsxs(ne,{w:"100%",bg:"bg_secondary",borderRadius:"20px",border:"1px solid",borderColor:"border",children:[e.jsxs(W,{w:"calc(100% + 2px)",gap:"16px",p:"16px 8px",bg:"bg_six",border:"1px solid",borderColor:"border",borderRadius:"20px",margin:"-1px -1px 0 -1px",children:[e.jsxs(q,{w:"100%",justify:"space-between",children:[e.jsx(tt,{fontSize:"16px",fontWeight:"500",children:"2. Deposit Amounts"}),e.jsx(q,{children:e.jsx(Fs,{})})]}),e.jsxs(W,{w:"100%",gap:"12px",children:[e.jsxs(ne,{w:"100%",position:"relative",children:[e.jsx(Ms,{onClick:u,from:{wrapStyle:{h:"108px"},balance:(l==null?void 0:l.balanceFormat)||"",value:ee+"",amountValue:b,loading:!1,onChange:p=>{var _;j(p,!0,(te==null?void 0:te.coin_type)===((_=n==null?void 0:n.tokenA)==null?void 0:_.coin_type))},selectable:!1,placeholder:"0.0",token:te,onFocusChange:p=>{var _;p&&+(ee+"")&&!Z&&j(ee+"",!0,(te==null?void 0:te.coin_type)===((_=n==null?void 0:n.tokenA)==null?void 0:_.coin_type))}},to:{wrapStyle:{h:"108px"},balance:(x==null?void 0:x.balanceFormat)||"",value:Y+"",amountValue:w,loading:!1,onFocusChange:p=>{var _;p&&+(Y+"")&&Z&&j(Y+"",!1,(S==null?void 0:S.coin_type)===((_=n==null?void 0:n.tokenA)==null?void 0:_.coin_type))},onChange:p=>{var _;j(p,!1,(S==null?void 0:S.coin_type)===((_=n==null?void 0:n.tokenA)==null?void 0:_.coin_type))},selectable:!1,placeholder:"0.0",token:S},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"}}),$&&T&&e.jsx(_t,{position:"absolute",h:"224px",top:"0px",left:"0",zIndex:9999,borderRadius:"16px"}),((I=[$,T].filter(Boolean))==null?void 0:I.length)===1&&e.jsx(_t,{position:"absolute",top:$?"0px":"116px",h:"108px",left:"0",p:"16px",borderRadius:"16px",text:"The market price is outside your specified price range. Single-asset deposit only."})]}),!!(n!=null&&n.poolAddress)&&e.jsx(e.Fragment,{children:e.jsxs(W,{gap:"12px",w:"100%",borderRadius:"20px",border:"1px solid",borderColor:"border",bg:"background",p:"20px 8px",children:[e.jsx(me,{isLoading:!1,label:"Total Amount",value:B&&+B?Gt(B):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",h:"20px"},skeletonStyle:{valueW:"128px"}}),e.jsx(vt,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",children:e.jsx(W,{justify:"flex-end",gap:"4px",children:[te,S].filter(Boolean).map((p,_)=>{var E;return e.jsxs(q,{gap:"4px",justify:"flex-end",w:"100%",children:[e.jsx(Ge,{imageUrl:p==null?void 0:p.logo_url,coinType:p==null?void 0:p.coin_type,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(F,{color:_===0?"primary":"primary_green",fontSize:"14px",whiteSpace:"nowrap",children:[P(p==null?void 0:p.symbol,10),"Â ",$&&T?"--":pe[(p==null?void 0:p.coin_type)===((E=n==null?void 0:n.tokenA)==null?void 0:E.coin_type)?"percentA":"percentB"],"%"]})]},p==null?void 0:p.coin_type)})})})]})})]}),!!(n!=null&&n.poolAddress)&&e.jsx(fe,{w:"100%",h:"52px",fontSize:"20px",fontWeight:"500",borderRadius:"16px",isDisabled:c,isLoading:!1,onClick:R,children:t})]}),(n==null?void 0:n.haveFarming)&&e.jsx(Vs,{disabled:$||T,checked:V,onChange:C})]})]})}function us({children:t,title:c,wrapStyle:s={}}){return e.jsxs(W,{gap:"8px",p:"10px 16px 16px",border:"1px solid",borderColor:"border",borderRadius:"16px",bg:"bg_six",...s,children:[e.jsxs(q,{w:"100%",justify:"space-between",h:"32px",children:[e.jsx(F,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:c}),t==null?void 0:t[0]]}),t==null?void 0:t[1]]})}function ki({btnText:t,btnDisabled:c,handleChangeIsFarmRewardsRange:s,onReverseClick:u,leverage:g,direct:r,perText:i,rangeTabList:o,currentRangeTab:d,addressHistTokensMap:a,fromBalanceInfo:l,toBalanceInfo:x,fromAmountValue:b,toAmountValue:w,handleAmountChange:j,handleAdd:R,isFullRange:H}){var p;const{currentPriceData:m,contractPoolInfo:h,apiPoolInfo:n,resetLiquidity:y,contractPoolInfoLoading:M,apiPoolInfoLoading:k,minPriceForDate:A,maxPriceForDate:z,currentRange:L}=ue(),{lowerTickData:D,upperTickData:V}=Ee(),{autoStakePosition:X,setAutoStakePosition:se,isFarmRewardsRange:ee,fromAmount:Y,toAmount:Z,byAmountIn:pe,percentMap:te,fromToken:S,toToken:B,totalAmount:$,fromTokenLock:T,toTokenLock:J}=qe(),{poolAddress:C}=Se(),I=_=>{se(_.target.checked)};return e.jsx(e.Fragment,{children:e.jsxs(q,{gap:"12px",align:"flex-start",children:[e.jsxs(us,{title:"1. Select Range",wrapStyle:{flex:1,minW:"588px",gap:"0"},children:[!o||!o.length?e.jsx(st,{h:"32px",borderRadius:"8px",w:"180px"}):e.jsx(De,{type:"outlineTab",tabList:o,currentTab:d,handleChangeTab:_=>u(_),wrapStyle:{h:"32px",p:"3px",border:"1px solid",borderColor:"border",borderRadius:"8px",gap:"4px",zIndex:"99"},itemStyle:{h:"24px",p:"4px 12px",borderRadius:"4px",gap:"4px"}}),e.jsxs(W,{w:"100%",gap:"12px",children:[e.jsx(q,{w:"100%",justify:"space-between",gap:"32px",mt:"16px",children:e.jsxs(W,{flex:"1",pos:"relative",gap:"0px",children:[e.jsx(q,{w:"100%",h:"24px",justify:"flex-start",children:e.jsx(Bs,{loading:k,price:oe(m)?vs(r?m==null?void 0:m.currentPrice:m.reverseCurrentPrice,6):"--",perText:i,wrapStyle:{ml:"156px",zIndex:99}})}),e.jsxs(q,{w:"100%",gap:"32px",children:[e.jsxs(W,{gap:"20px",children:[e.jsx(Ze,{h:"226px",mt:"10px",children:e.jsx(Ds,{poolAddress:C,currentTick:h==null?void 0:h.current_tick_index,tickSpacing:h==null?void 0:h.tickSpacing,farmsEffectTickLower:n==null?void 0:n.farmsEffectiveTickLower,farmsEffectTickUpper:n==null?void 0:n.farmsEffectiveTickUpper})}),oe(D)&&oe(V)&&e.jsx(e.Fragment,{children:e.jsx(vt,{label:"Leverage",tooltip:"This parameter indicates the concentration rate of your liquidity relative to a full range position.",wrapStyle:{flexDir:"column",align:"center",width:"auto",gap:"2px"},children:e.jsx(F,{color:"text_caption",children:T&&J?"--":g})})})]}),e.jsxs(W,{w:"100%",gap:"32px",children:[e.jsx(ne,{w:"100%",h:"230px",children:e.jsx(ks,{handleClickRefresh:()=>{},direct:r,minPriceData:r?D:V,maxPriceData:r?V:D,dashedMarkerLine:[A,z],currentRange:L})}),oe(D)&&oe(V)&&e.jsx(Os,{direct:r,rangeMap:a,wrapStyle:{w:"100%"}})]})]})]})}),e.jsx(Hs,{perText:i,direct:r,isFullRange:H,minPriceData:r?D:V,maxPriceData:r?V:D}),T&&J&&e.jsx(Ze,{w:"100%",fontSize:"12px",color:"primary_red",bg:"primary_red_opacity.10",h:"32px",borderRadius:"8px",children:"The max price should be higher than min price."}),(n==null?void 0:n.haveFarming)&&(n==null?void 0:n.displayFarmsEffectMaxPrice)&&(n==null?void 0:n.displayFarmsEffectMinPrice)&&e.jsx(Ns,{minPrice:r?jt(n==null?void 0:n.displayFarmsEffectMinPrice):At(n==null?void 0:n.displayFarmsEffectMaxPrice),maxPrice:r?jt(n==null?void 0:n.displayFarmsEffectMaxPrice):At(n==null?void 0:n.displayFarmsEffectMinPrice),loading:k,perText:i,checked:ee,onChange:s})]})]}),e.jsxs(W,{gap:"8px",minW:"420px",maxW:"460px",w:"460px",children:[e.jsxs(us,{title:"2. Deposit Amounts",wrapStyle:{gap:"16px",w:"100%"},children:[e.jsx(q,{children:e.jsx(Fs,{})}),e.jsxs(ne,{w:"100%",position:"relative",children:[e.jsx(Ms,{onClick:u,from:{wrapStyle:{h:"108px"},balance:(l==null?void 0:l.balanceFormat)||"",value:Y,amountValue:b,loading:!1,onChange:_=>{var E;j(_,!0,(S==null?void 0:S.coin_type)===((E=n==null?void 0:n.tokenA)==null?void 0:E.coin_type))},selectable:!1,placeholder:"0.0",token:S,onFocusChange:_=>{var E;_&&+(Y+"")&&!pe&&j(Y+"",!0,(S==null?void 0:S.coin_type)===((E=n==null?void 0:n.tokenA)==null?void 0:E.coin_type))}},to:{wrapStyle:{h:"108px"},balance:(x==null?void 0:x.balanceFormat)||"",value:Z,amountValue:w,loading:!1,onFocusChange:_=>{var E;_&&+(Z+"")&&pe&&j(Z+"",!1,(B==null?void 0:B.coin_type)===((E=n==null?void 0:n.tokenA)==null?void 0:E.coin_type))},onChange:_=>{var E;j(_,!1,(B==null?void 0:B.coin_type)===((E=n==null?void 0:n.tokenA)==null?void 0:E.coin_type))},selectable:!1,placeholder:"0.0",token:B},iconParams:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"}}),T&&J&&e.jsx(_t,{position:"absolute",h:"224px",top:"0px",left:"0",zIndex:9999,borderRadius:"16px"}),((p=[T,J].filter(Boolean))==null?void 0:p.length)===1&&e.jsx(_t,{position:"absolute",top:T?"0px":"116px",h:"108px",left:"0",text:"The market price is outside your specified price range. Single-asset deposit only.",borderRadius:"16px"})]})]}),e.jsxs(e.Fragment,{children:[e.jsx(W,{w:"100%",gap:"8px",children:!!(n!=null&&n.poolAddress)&&(!T||!J)&&e.jsxs(W,{gap:"12px",w:"100%",borderRadius:"16px",border:"1px solid",borderColor:"border",bg:"bg_six",p:n!=null&&n.displayTokenA&&(n!=null&&n.displayTokenB)?"0 16px 16px":"0 16px",children:[e.jsx(fe,{w:"calc(100% + 34px)",h:"52px",margin:"-1px -1px 5px",fontSize:"18px",fontWeight:"500",borderRadius:"16px",isDisabled:c,isLoading:!1,onClick:R,children:t}),(n==null?void 0:n.displayTokenA)&&(n==null?void 0:n.displayTokenB)&&e.jsxs(e.Fragment,{children:[e.jsx(me,{isLoading:!1,label:"Total Amount",value:$&&+$?Gt($):"--",labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px",h:"20px"},skeletonStyle:{valueW:"128px"}}),e.jsx(vt,{label:"Deposit Ratio",tooltip:"The ratio of two assets depends on the range you set and the current price.",wrapStyle:{gap:"0px"},children:e.jsx(q,{gap:"12px",children:[S,B].filter(Boolean).map((_,E)=>{var U;return e.jsxs(q,{gap:"4px",children:[e.jsx(Ge,{imageUrl:_==null?void 0:_.logo_url,coinType:_?_==null?void 0:_.coin_type:"",w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px"}),e.jsxs(F,{color:E===0?"primary":"primary_green",fontSize:"14px",whiteSpace:"nowrap",children:[P(_==null?void 0:_.symbol,10),"Â ",T&&J?"--":te[(_==null?void 0:_.coin_type)===((U=n==null?void 0:n.tokenA)==null?void 0:U.coin_type)?"percentA":"percentB"],"%"]})]},_==null?void 0:_.coin_type)})})})]})]})}),(n==null?void 0:n.haveFarming)&&e.jsx(Vs,{disabled:T||J,checked:X,onChange:I})]})]})]})})}function Li({rangeTabList:t,currentFeeTier:c,addressHistTokensMap:s,getList:u,getPrice:g}){var le;const{apiPoolInfo:r}=ue(),[i,o]=f.useState();f.useEffect(()=>{var K;r&&o((K=r==null?void 0:r.displayTokenA)==null?void 0:K.coin_type)},[r==null?void 0:r.poolAddress]);const d=f.useMemo(()=>{var K;return i===((K=r==null?void 0:r.tokenA)==null?void 0:K.coin_type)},[i,(le=r==null?void 0:r.tokenA)==null?void 0:le.coin_type]),a=f.useMemo(()=>{var K,ye,Ce,Ke;return!(r!=null&&r.tokenA)||!(r!=null&&r.tokenB)?"":d?`${P((K=r==null?void 0:r.tokenB)==null?void 0:K.symbol,10)} per ${P((ye=r==null?void 0:r.tokenA)==null?void 0:ye.symbol,10)}`:`${P((Ce=r==null?void 0:r.tokenA)==null?void 0:Ce.symbol,10)} per ${P((Ke=r==null?void 0:r.tokenB)==null?void 0:Ke.symbol,10)}`},[d,r==null?void 0:r.tokenA,r==null?void 0:r.tokenB]),{lowerTickData:l,upperTickData:x}=Ee(),{handleInitTickData:b}=Ct(),{getLeverage:w}=fi(),j=f.useMemo(()=>{const K=l==null?void 0:l.price,ye=x==null?void 0:x.price;return w(K,ye)},[l==null?void 0:l.price,x==null?void 0:x.price]),{handleAmountChange:R,fromToken:H,setFromToken:m,toToken:h,setToToken:n,byAmountIn:y,setByAmountIn:M,fromAmount:k,setFromAmount:A,toAmount:z,setToAmount:L,fromAmountValue:D,toAmountValue:V,fromBalanceInfo:X,toBalanceInfo:se,fromTokenLock:ee,toTokenLock:Y,confirmModalOpen:Z,setConfirmModalOpen:pe,relatedPosId:te,nftOpen:S,setNftOpen:B,handleAdd:$,handleSubmit:T}=ji(u,d),{setAutoStakePosition:J,setIsFarmRewardsRange:C}=qe();f.useEffect(()=>{oe(r)&&(m(r==null?void 0:r.displayTokenA),n(r==null?void 0:r.displayTokenB))},[r==null?void 0:r.poolAddress]);const I=K=>{var ye;K&&(K!=null&&K.coin_type)?o(K==null?void 0:K.coin_type):o((ye=t==null?void 0:t.find(Ce=>Ce.key!==i))==null?void 0:ye.key),m(h),n(H),M(!y),y?(L(k),A("")):(A(z),L(""))};f.useEffect(()=>{r!=null&&r.haveFarming&&J(!(ee||Y))},[ee,Y,r==null?void 0:r.haveFarming]),f.useEffect(()=>{y&&ee&&!Y&&(A(""),L("")),!y&&!ee&&Y&&(A(""),L("")),y&&!ee&&Y&&L(""),!y&&ee&&!Y&&A(""),ee&&Y&&(A(""),L(""))},[ee,Y]);const p=K=>{C(K.target.checked),K.target.checked&&(r!=null&&r.farmsEffectiveTickLower)&&(r!=null&&r.farmsEffectiveTickUpper)&&b(r==null?void 0:r.farmsEffectiveTickLower,r==null?void 0:r.farmsEffectiveTickUpper,r)};f.useEffect(()=>{ie(l==null?void 0:l.tick).eq(ie(r==null?void 0:r.farmsEffectiveTickLower))&&ie(x==null?void 0:x.tick).eq(ie(r==null?void 0:r.farmsEffectiveTickUpper))?C(!0):C(!1)},[l==null?void 0:l.tick,x==null?void 0:x.tick,r==null?void 0:r.farmsEffectiveTickLower,r==null?void 0:r.farmsEffectiveTickUpper]);const _=f.useMemo(()=>(l==null?void 0:l.price)==="0"&&(x==null?void 0:x.price)==="âˆž",[l==null?void 0:l.price,x==null?void 0:x.price]),{btnText:E,btnDisabled:U}=Ai(),{isApp:N}=ze(),ae={btnText:E,btnDisabled:U,handleChangeIsFarmRewardsRange:p,onReverseClick:I,leverage:j,direct:d,perText:a,rangeTabList:t,currentRangeTab:i,addressHistTokensMap:s,fromBalanceInfo:X,toBalanceInfo:se,fromAmountValue:D,toAmountValue:V,handleAmountChange:R,handleAdd:$,isFullRange:_};return e.jsxs(e.Fragment,{children:[N?e.jsx(Ci,{...ae}):e.jsx(ki,{...ae}),Z&&e.jsx(bi,{onClose:()=>pe(!1),data:{feeTier:c},onSubmit:T}),S&&te&&oe(r)&&e.jsx(Si,{onClose:()=>B(!1),tokenA:r==null?void 0:r.displayTokenA,tokenB:r==null?void 0:r.displayTokenB,posId:te,fee:r==null?void 0:r.feeDisplay,isReverse:r==null?void 0:r.isReverse})]})}function Ti(){var Y,Z,pe,te;const{tab:t,poolAddress:c,from:s,to:u,fee:g}=Se(),{getPoolList:r,getLocalJsonPoolList:i}=$r(),[o,d]=f.useState([]),{apiPoolInfo:a,setApiPoolInfo:l,setApiPoolInfoLoading:x,apiPoolInfoLoading:b,setNetError:w}=ue(),[j,R]=f.useState(),{fetchByApi:H}=Nt(),m=wt(),{fetchTokenInfo:h,getTokenInfo:n}=zs(),{quoteWhiteTokenList:y}=Ts(),{fromToken:M,toToken:k}=qe(),{fetchTokenPrices:A}=_s(),z=async({poolAddress:S,from:B,to:$})=>{var T,J,C,I;try{x(!0);let p,_;if(S&&S!=="undefined"){const E=await r({pool:S});E&&E.list&&E.list.length?(_=E.list[0],p=await r({coin_type:`${(T=_==null?void 0:_.displayTokenA)==null?void 0:T.coin_type},${(J=_==null?void 0:_.displayTokenB)==null?void 0:J.coin_type}`,is_vaults:!1,display_all_pools:!0,has_mining:!0,has_farming:!0,no_incentives:!0,order_by:"-vol",offset:0})):a&&oe(a)?(_=a,p={list:o}):(_={poolAddress:S,displayTokenA:void 0,displayTokenB:void 0},p={list:[]}),x(!1)}else if(B&&$&&B!=="undefined"&&$!=="undefined"&&B!==$){const E=await r({coin_type:`${B},${$}`,is_vaults:!1,display_all_pools:!0,has_mining:!0,has_farming:!0,no_incentives:!0,order_by:"-vol",offset:0});if(console.log(E,"res_getPoolList"),E&&E.list&&E.list.length)if(g&&g!=="undefined"){const U=(C=E==null?void 0:E.list)==null?void 0:C.find(N=>Q(N==null?void 0:N.feeRate).eq(g));if(U)m(t?`/liquidity?tab=${t}&poolAddress=${U==null?void 0:U.poolAddress}`:`/liquidity?poolAddress=${U==null?void 0:U.poolAddress}`);else{const N=zt(E==null?void 0:E.list,ae=>Number((ae==null?void 0:ae.tvl)||"0"));m(t?`/liquidity?tab=${t}&poolAddress=${N==null?void 0:N.poolAddress}`:`/liquidity?poolAddress=${N==null?void 0:N.poolAddress}`)}}else{let U=zt(E==null?void 0:E.list,N=>Number((N==null?void 0:N.tvl)||"0"));U||(U=zt(E==null?void 0:E.list,N=>{var ae;return Number(((ae=N==null?void 0:N.object)==null?void 0:ae.liquidity)||"0")}),U||(U=E==null?void 0:E.list[0])),m(t?`/liquidity?tab=${t}&poolAddress=${U==null?void 0:U.poolAddress}`:`/liquidity?poolAddress=${U==null?void 0:U.poolAddress}`)}else{const U=await h(B),N=await h($);_={poolAddress:void 0,displayTokenA:U,displayTokenB:N},p={list:[]},x(!1)}}else(!B||B==="undefined")&&$&&$!=="undefined"&&(_={poolAddress:void 0,displayTokenA:void 0,displayTokenB:await h($)}),(!$||$==="undefined")&&B&&B!=="undefined"&&(_={poolAddress:void 0,displayTokenA:await h(B),displayTokenB:void 0}),p={list:[]},x(!1);p&&(w(!1),d(p==null?void 0:p.list),console.log(_,"setApiPoolInfo"),_&&(_!=null&&_.poolAddress&&S?(_==null?void 0:_.poolAddress)===S&&l(_):l(_))),x(!1)}catch(p){if(p!=null&&p.list&&((I=p==null?void 0:p.list)==null?void 0:I.length)===1){w(!0);const _=p==null?void 0:p.list[0];console.log(p==null?void 0:p.list,"setApiPoolInfo"),l(_),d([]),x(!1)}}};f.useEffect(()=>{c&&c==="undefined"||z({poolAddress:c,from:s,to:u})},[c,s,u]);const L=f.useMemo(()=>{var B,$;const S=Or(o);return S?a!=null&&a.tokenA&&(a!=null&&a.tokenB)?(B=rs)==null?void 0:B.map(T=>{var C,I;const J=((C=S.find(p=>p.feeRate===T.feeRate))==null?void 0:C.title)||T.title;return{...T,title:J,poolAddress:(I=S.find(p=>p.feeRate===T.feeRate))==null?void 0:I.poolAddress,disabled:J==="Not Created"&&!Ye(a==null?void 0:a.tokenA,y)&&!Ye(a==null?void 0:a.tokenB,y)}}):($=rs)==null?void 0:$.map(T=>{var C,I;const J=((C=S.find(p=>p.feeRate===T.feeRate))==null?void 0:C.title)||T.title;return{...T,title:J,poolAddress:(I=S.find(p=>p.feeRate===T.feeRate))==null?void 0:I.poolAddress,disabled:!Ye(a==null?void 0:a.displayTokenA,y)&&!Ye(a==null?void 0:a.displayTokenB,y)}}):[]},[JSON.stringify(o),JSON.stringify(y),(Y=a==null?void 0:a.displayTokenA)==null?void 0:Y.coin_type,(Z=a==null?void 0:a.displayTokenB)==null?void 0:Z.coin_type]),D=f.useMemo(()=>a?[a==null?void 0:a.displayTokenA,a==null?void 0:a.displayTokenB].filter(Boolean).map(S=>({label:S==null?void 0:S.symbol,key:S==null?void 0:S.coin_type,isToken:!0,imgInfo:{src:S==null?void 0:S.logo_url,w:"16px",h:"16px",coinType:S?S==null?void 0:S.coin_type:"",showTagWidth:"8px",showTagHeight:"8px"}})):[],[(pe=a==null?void 0:a.displayTokenA)==null?void 0:pe.symbol,(te=a==null?void 0:a.displayTokenB)==null?void 0:te.symbol]),V=f.useMemo(()=>{const S=L==null?void 0:L.find(B=>B.poolAddress===c);return S||a},[JSON.stringify(L),c,JSON.stringify(a)]),X=async S=>{console.log("ðŸš€ ~ setAddressHistTokens ~ this.addressHistTokens:ðŸš€ ~ getContractPrices ~ address:",S);let B=[];const $=await H(pr,"GET",{pool:S});console.log($,"resVal"),B=Object.fromEntries($.list.map(T=>[T.swap_account,T])),R(B)};f.useEffect(()=>{c&&X(c)},[c]);const se=f.useMemo(()=>{var S,B,$;return j&&c&&((S=j==null?void 0:j[c])!=null&&S.data)?Object.fromEntries(($=(B=j==null?void 0:j[c])==null?void 0:B.data)==null?void 0:$.map(T=>[T.key,T.value])):{}},[JSON.stringify(j)]),ee=()=>{const S=[];M&&S.push(M.coin_type),k&&S.push(k.coin_type),S.length>0&&A(S)};return f.useEffect(()=>{ee()},[M==null?void 0:M.coin_type,k==null?void 0:k.coin_type]),{getList:z,feeTierList:L,apiPoolInfo:a,rangeTabList:D,currentFeeTier:V,addressHistTokensMap:se,apiPoolInfoLoading:b,quoteWhiteTokenList:y,refreshMarketPrice:ee}}const ps=(t,c,s)=>t&&c&&s?Q(t).mul(c).div(Q(10).pow(s)).toString():"--";function Fi(){var k,A;const{tokenAPrice:t,setTokenAPrice:c,tokenBPrice:s,setTokenBPrice:u,tokenAAmount:g,setTokenAAmount:r,tokenBAmount:i,setTokenBAmount:o,tokenAAmountUSD:d,setTokenAAmountUSD:a,tokenBAmountUSD:l,setTokenBAmountUSD:x,totalAmountUSD:b,setTotalAmountUSD:w,resetTvlInfo:j,tvlLoading:R,setTvlLoading:H}=Qt(),{apiPoolInfo:m,contractPoolInfo:h}=ue(),n=async z=>{var L,D;try{const V=(L=we(z))==null?void 0:L.full_address,X=V=="0x2::sui::SUI"?"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":V,{prices:se}=await nr(`${(D=ar)==null?void 0:D.cetus_api}/v2/sui/price?base_symbol_address=${X}`);return se==null?void 0:se[0]}catch(V){return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useRate.ts:31 ~ getAmountPrice ~ error:",V),"--"}},{poolAddress:y}=Se(),M=async()=>{var z,L,D,V;H(!0);try{if((z=m==null?void 0:m.tokenA)!=null&&z.coin_type){const X=await n((L=m==null?void 0:m.tokenA)==null?void 0:L.coin_type);X&&c(X)}if((D=m==null?void 0:m.tokenB)!=null&&D.coin_type){const X=await n((V=m==null?void 0:m.tokenB)==null?void 0:V.coin_type);X&&u(X)}}catch(X){console.log("ðŸš€ ~ PoolInfo ~ handleRefresh:",X)}finally{H(!1)}};return f.useEffect(()=>{j()},[y]),f.useEffect(()=>()=>{j()},[]),f.useEffect(()=>{M()},[m==null?void 0:m.tvl,(k=m==null?void 0:m.tokenA)==null?void 0:k.coin_type,(A=m==null?void 0:m.tokenB)==null?void 0:A.coin_type]),f.useEffect(()=>{h!=null&&h.coinAmountA&&r(Q(h==null?void 0:h.coinAmountA).sub((h==null?void 0:h.fee_protocol_coin_a)||"0").toString())},[h==null?void 0:h.coinAmountA,h==null?void 0:h.fee_protocol_coin_a]),f.useEffect(()=>{h!=null&&h.coinAmountB&&o(Q(h==null?void 0:h.coinAmountB).sub((h==null?void 0:h.fee_protocol_coin_b)||"0").toString())},[h==null?void 0:h.coinAmountB,h==null?void 0:h.fee_protocol_coin_b]),f.useEffect(()=>{g&&(t!=null&&t.price)&&(m!=null&&m.tokenA.decimals)&&!Number.isNaN(Number(m==null?void 0:m.tokenA.decimals))&&a(ps(g,t==null?void 0:t.price,m==null?void 0:m.tokenA.decimals))},[g,t]),f.useEffect(()=>{i&&(s!=null&&s.price)&&(m!=null&&m.tokenB.decimals)&&!Number.isNaN(Number(m==null?void 0:m.tokenB.decimals))&&x(ps(i,s==null?void 0:s.price,m==null?void 0:m.tokenB.decimals))},[i,s]),f.useEffect(()=>{w(d&&l&&d!=="--"&&l!=="--"?Q(d).plus(l).toString():"--")},[d,l]),{tokenAPrice:t,tokenBPrice:s,tokenAAmount:g,tokenBAmount:i,tokenAAmountUSD:d,tokenBAmountUSD:l,totalAmountUSD:b,setTotalAmountUSD:w,tvlLoading:R}}var Ie=(t=>(t.deposit="Provide Liquidity",t.positions="My Positions",t.analytics="Analytics",t))(Ie||{});const Fe=[{label:"Provide Liquidity",key:"deposit"},{label:"My Positions",key:"positions"},{label:"Analytics",key:"analytics"}];function Kn(){var ct,lt,dt;const t=wt(),{currentAccount:c}=Rt(),{apiPoolInfo:s,apiPoolInfoLoading:u,currentPriceData:g,resetLiquidity:r,contractPoolInfo:i,setApiPoolInfo:o,netError:d,manualRefresh:a,setManualRefresh:l}=ue(),{feeTierList:x,currentFeeTier:b,rangeTabList:w,addressHistTokensMap:j,getList:R,quoteWhiteTokenList:H,refreshMarketPrice:m}=Ti(),[h,n]=f.useState(Fe),{tab:y,poolAddress:M,from:k,to:A}=Se(),[z,L]=f.useState(((ct=Fe==null?void 0:Fe.find(v=>v.key===y))==null?void 0:ct.key)||Fe[0].key),{handleResetRange:D}=Ct(),{resetAddLiquidity:V,fromToken:X,toToken:se,setFromToken:ee,setToToken:Y}=qe(),{fetchAccountBalance:Z}=Ls(),{getContractPoolInfo:pe}=Tr(),{getCurrentPrice:te}=Fr(),{getTokenInfo:S}=zs(),[B,$]=f.useState(),[T,J]=f.useState();f.useLayoutEffect(()=>{y&&y!==z&&L(y)},[y]),f.useEffect(()=>{$(s==null?void 0:s.displayTokenA),J(s==null?void 0:s.displayTokenB)},[(lt=s==null?void 0:s.displayTokenA)==null?void 0:lt.coin_type,(dt=s==null?void 0:s.displayTokenB)==null?void 0:dt.coin_type]);const C=async()=>{if(M&&s&&M===(s==null?void 0:s.poolAddress)){const v=await pe(M);v&&te(v==null?void 0:v.current_sqrt_price,s)}};f.useEffect(()=>{M&&(s==null?void 0:s.poolAddress)!==M&&(D(),V(),r()),M&&M===(s==null?void 0:s.poolAddress)&&C()},[M,s==null?void 0:s.poolAddress]),f.useEffect(()=>(c!=null&&c.address&&Z(),()=>{D(),V(),r()}),[]);const{isApp:I}=ze(),{addFavorites:p,removeFavorites:_}=wr(),{poolFavoriteIds:E}=Rr();cr();const U=f.useMemo(()=>E==null?void 0:E.includes(M||""),[JSON.stringify(E),M]),N=v=>{Kt(v),M&&(U?_(M):p(M))},ae=async v=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh111:"),v&&l(!0),M&&M!=="undefined"&&await R({poolAddress:M}),c!=null&&c.address&&await Z(),at(),l(!1)},{posBaseListGroupByPool:le}=Rs(),K=f.useMemo(()=>{if(M&&M!=="undefined"){const v=le[M.toLowerCase()||""];return v&&(v!=null&&v.list)&&(v==null?void 0:v.list.length)>0?v==null?void 0:v.list.length:void 0}},[JSON.stringify(le),M]);f.useEffect(()=>{n(Fe==null?void 0:Fe.map(v=>({...v,num:v.label==="My Positions"&&z==="positions"?K:void 0})))},[K,z]);const ye=f.useMemo(()=>{const v=[];return s!=null&&s.displayTokenA&&v.push(s==null?void 0:s.displayTokenA),s!=null&&s.displayTokenB&&v.push(s==null?void 0:s.displayTokenB),v},[JSON.stringify(s==null?void 0:s.displayTokenA),JSON.stringify(s==null?void 0:s.displayTokenB)]),{isOpen:Ce,onOpen:Ke,onClose:it}=lr(),[Je,kt]=f.useState(),nt=()=>{var v,de;t(`/create-pool/${(v=s==null?void 0:s.displayTokenA)==null?void 0:v.coin_type}/${(de=s==null?void 0:s.displayTokenB)==null?void 0:de.coin_type}/${Je==null?void 0:Je.feeRate}`)},{totalAmountUSD:ke,tvlLoading:Lt,setTotalAmountUSD:Qe}=Fi(),at=()=>{m==null||m(),C==null||C()};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{w:"100%",mt:"20px",children:[e.jsxs(q,{w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",children:[e.jsx(dr,{text:"Pools",onClick:()=>t("/pools")}),M&&(s==null?void 0:s.tokenA)&&(s==null?void 0:s.tokenB)&&e.jsxs(q,{gap:"8px",children:[e.jsx(bt,{placement:"top",tooltip:U?"Remove from Watchlist":"Add to Watchlist",children:e.jsx(fe,{variant:"outline",w:"32px",h:"32px",lineHeight:"32px",onClick:N,p:"0 6px",borderRadius:"8px",color:"text_paragraph",bg:"background",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:U?"primary":"text_caption"}}},children:e.jsx(Me,{xlinkHref:U?"#icon-icon_star_sel":"#icon-icon_star",svgFill:U?"primary_blue":"text_paragraph",svgHover:U?"primary":"text_caption",fontSize:"18px"})})}),e.jsx(bt,{placement:"top",tooltip:"Trade",children:e.jsx(fe,{variant:"outline",bg:"background",h:"32px",w:"32px",onClick:()=>{var v,de;return t(`/swap/${(v=s==null?void 0:s.displayTokenA)==null?void 0:v.coin_type}/${(de=s==null?void 0:s.displayTokenB)==null?void 0:de.coin_type}`)},borderRadius:"8px",p:"0 6px",color:"text_paragraph",display:"flex",justifyContent:"center",gap:"4px",sx:{_hover:{color:"text_caption",svg:{fill:"text_caption"}}},children:e.jsx(Me,{xlinkHref:"#icon-icon_swap1",fontSize:"16px"})})}),e.jsx(bt,{placement:"top",tooltip:"Refresh",children:e.jsx(ne,{children:e.jsx(Gr,{handleRefresh:ae,isAutoRefresh:!0,refreshInterval:60,innerStyle:{bg:"background"},w:"32px",h:"32px",borderRadius:"8px",bg:"background"},M)})})]})]}),e.jsxs(be,{flexDir:{base:"column",lg:"row"},w:"100%",minW:{base:"100%",lg:"1024px"},justify:"space-between",mt:"20px",gap:{base:"20px",lg:"8px"},children:[e.jsxs(be,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"8px"},align:{base:"flex-start",lg:"center"},children:[e.jsxs(q,{gap:"12px",children:[e.jsx(ts,{value:B||(k?S(k):void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:d,onChange:v=>{var _e,$e,We,Ue;const de=Object.keys(Ie).find(ot=>ot===z);if(T!=null&&T.coin_type||(_e=S(A))!=null&&_e.coin_type)if(we(v==null?void 0:v.coin_type).full_address===we((T==null?void 0:T.coin_type)||(($e=S(A))==null?void 0:$e.coin_type)||"").full_address)$(T),J(B);else{if(we(v==null?void 0:v.coin_type).full_address===we((B==null?void 0:B.coin_type)||((We=S(k))==null?void 0:We.coin_type)||"").full_address)return;t(`/liquidity?tab=${de}&from=${v==null?void 0:v.coin_type}&to=${(T==null?void 0:T.coin_type)||((Ue=S(A))==null?void 0:Ue.coin_type)}`),o(null),Qe("")}else t(`/liquidity?tab=${de}&from=${v==null?void 0:v.coin_type}`),o(null),Qe("")},tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!B&&u}),e.jsx(ts,{value:T||(A?S(A):void 0),isWhiteSelect:!1,whiteTokenList:void 0,disabled:d,onChange:v=>{var _e,$e,We,Ue;const de=Object.keys(Ie).find(ot=>ot===z);if(B!=null&&B.coin_type||(_e=S(k))!=null&&_e.coin_type)if(we(v==null?void 0:v.coin_type).full_address===we((B==null?void 0:B.coin_type)||(($e=S(k))==null?void 0:$e.coin_type)||"").full_address)$(T),J(B);else{if(we(v==null?void 0:v.coin_type).full_address===we((T==null?void 0:T.coin_type)||((We=S(A))==null?void 0:We.coin_type)||"").full_address)return;t(`/liquidity?tab=${de}&from=${(B==null?void 0:B.coin_type)||((Ue=S(k))==null?void 0:Ue.coin_type)}&to=${v==null?void 0:v.coin_type}`),o(null),Qe("")}else t(`/liquidity?tab=${de}&to=${v==null?void 0:v.coin_type}`),o(null),Qe("")},tokenStyle:{p:0,border:"none"},tokenSize:"32px",symbolStyle:{fontSize:"20px",fontWeight:"500"},wrapStyle:{h:"32px",border:"none",p:"0",bg:"background"},loading:!T&&u})]}),e.jsx(Dr,{value:b,loading:!b&&u,feeTierList:x,disabled:d,onChange:v=>{v!=null&&v.poolAddress?t(`/liquidity?poolAddress=${v==null?void 0:v.poolAddress}`):(kt(v),Ke())}})]}),M&&(s==null?void 0:s.tokenA)&&(s==null?void 0:s.tokenB)&&e.jsxs(be,{flexDir:{base:"column",lg:"row"},gap:{base:"20px",lg:"28px"},children:[e.jsx(gt,{label:"Pool APR",value:e.jsx(or,{poolInfo:s,placement:"bottom",children:e.jsxs(q,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[e.jsx(F,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:s!=null&&s.farmingAprDisplay||s!=null&&s.miningAprList&&(s==null?void 0:s.miningAprList.length)>0?"help":"text",children:s==null?void 0:s.feeAndMiningAprDisplay}),(s==null?void 0:s.haveFarming)&&e.jsxs(F,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",s==null?void 0:s.farmingAprDisplay]})]})})}),e.jsx(gt,{label:"TVL",value:ke&&ke!=="--"?`$${Re(ke,2)}`:"--",loading:u||Lt}),e.jsx(gt,{label:"Volume (24H)",value:(s==null?void 0:s.volume24Display)||"",loading:u}),e.jsx(gt,{label:"Fees (24H)",value:(s==null?void 0:s.fees24Display)||"",loading:u})]})]}),M&&(s!=null&&s.tokenA)&&(s!=null&&s.tokenB)?e.jsxs(e.Fragment,{children:[e.jsxs(be,{w:"100%",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},minW:{base:"100%",lg:"1024px"},children:[e.jsx(De,{type:"borderTab",tabList:h,currentTab:z,handleChangeTab:v=>{const de=Object.keys(Ie).find(_e=>Ie[_e]===v.label);M&&t(`/liquidity?tab=${de}&poolAddress=${M}`),L(de)},wrapStyle:{w:{base:"100%",lg:"auto"},justify:{base:"space-between",lg:"flex-start"},p:{base:"0 12px",lg:"0"},bg:{base:"bg_secondary",lg:"transparent"},h:I?"60px":"58px",gap:{base:"8px",lg:"45px"},border:{base:"1px solid",lg:"none"},borderColor:{base:"border",lg:"transparent"},borderRadius:{base:"16px",lg:"unset"},mt:{base:"20px",lg:"12px"}},itemStyle:{fontSize:I?"14px":"16px",fontWeight:"500"}}),z!=="deposit"&&s&&e.jsxs(be,{w:I?"100%":"auto",mt:{base:"4px",lg:"12px"},gap:"12px",flexDir:{base:"column",lg:"row"},justify:{base:"center",lg:"space-between"},align:{base:"flex-start",lg:"center"},children:[e.jsx(F,{children:"Current Price"}),e.jsx(Kr,{noCenter:!!I,fromToken:s==null?void 0:s.displayTokenA,toToken:s==null?void 0:s.displayTokenB,fromValue:"1",toValue:ht(s!=null&&s.isReverse?g==null?void 0:g.reverseCurrentPrice:g==null?void 0:g.currentPrice,6,!0).toString(),color:"text_caption",wrapStyle:I?{w:"100%"}:{}})]})]}),e.jsx(ne,{h:{base:"20px",lg:"8px"}}),z==="deposit"&&e.jsx(Li,{rangeTabList:w,getList:ae,getPrice:C,currentFeeTier:b,addressHistTokensMap:j}),z==="positions"&&e.jsx(yi,{}),z==="analytics"&&e.jsx(mi,{})]}):e.jsx(ne,{mt:"20px",children:!s&&u?e.jsx(Ze,{w:"100%",h:"480px",background:"bg_secondary",borderRadius:"12px",border:"1px solid",borderColor:"border",children:e.jsx(Dt,{})}):e.jsx(et,{type:"custom",imgUrl:"/images/img_create_pool.png",h:"480px",children:e.jsx(W,{children:B&&T?Ye(B,H)||Ye(T,H)?e.jsxs(e.Fragment,{children:[e.jsx(F,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",fontWeight:"500",children:"This Pool has not been initialized"}),e.jsx(F,{fontSize:"14px",children:"Do you want to initialize it?"}),e.jsx(fe,{mt:"12px",w:"120px",h:"32px",borderRadius:"8px",colorScheme:"blue",fontSize:"14px",fontWeight:"500",onClick:()=>{it(),nt()},children:"Initialized Pool"})]}):e.jsx(F,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"No liquidity data"}):e.jsx(F,{h:"20px",lineHeight:"20px",fontSize:"14px",color:"text_caption",children:"Select the token you want to provide liquidity for."})})})})]}),(s==null?void 0:s.displayTokenA)&&(s==null?void 0:s.displayTokenB)&&e.jsx(Qr,{tokensInfo:ye,waringModalCancel:v=>{t("/pools")}}),e.jsx(Hr,{title:"This Pool has not been initialized",subTitle:"Do you want to initialize it?",btnText:"Initialized Pool",isOpen:Ce,onClose:it,onConfirm:nt})]})}export{Kn as default};
