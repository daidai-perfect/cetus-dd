import{u as T}from"./useNotifiAlerts-BJ-UUq1s.js";import{l as x,k as D,H as k,U as A,d as _,n as L}from"./index-DOpwe9u0.js";import"./vendor-BowHGuwE.js";import{a as B}from"./useXCetusHelper-N1h7tj3v.js";import{u as O,j,b as F}from"./usePositionList-C4UKPPMR.js";const U=(n,u)=>({isPosDetailRefresh:!1,setIsPosDetailRefresh:t=>{n(()=>({isPosDetailRefresh:t}))},isPosHistoryLoading:!0,setIsPosHistoryLoading:t=>{n(()=>({isPosHistoryLoading:t}))},curPosHistoryList:[],setCurPosHistoryList:t=>{n(()=>({curPosHistoryList:t}))},currentPosDetailTab:"increase",setCurrentPosDetailTab:t=>{n(()=>({currentPosDetailTab:t}))},tokenAmountAfterA:"",setTokenAmountAfterA:t=>{n(()=>({tokenAmountAfterA:t}))},tokenAmountAfterB:"",setTokenAmountAfterB:t=>{n(()=>({tokenAmountAfterB:t}))},isFixedDisplayTokenA:!0,setIsFixedDisplayTokenA:t=>{n(()=>({isFixedDisplayTokenA:t}))},slideValue:"--",setSlideValue:t=>{n(()=>({slideValue:t}))},currentPosPoolInfo:null,setCurrentPosPoolInfo:t=>{n(()=>({currentPosPoolInfo:t}))},currentPoolSqrtPrice:"",setCurrentPoolSqrtPrice:t=>{n(()=>({currentPoolSqrtPrice:t}))},curPosContractPoolInfo:null,setCurPosContractPoolInfo:t=>{n(()=>({curPosContractPoolInfo:t}))},useZapIn:!1,setUseZapIn:t=>{n(()=>({useZapIn:t}))}}),V=x(U);function v(){const n=D("clmm"),{posBaseList:u,setCurrentPosBaseInfo:t,setCurrentPosBaseInfoLoading:b}=O(),{setCurPosHistoryList:N,setIsPosHistoryLoading:c}=V(),{buildPosBaseInfo:m}=j(),{getPosRelatedData:f}=F(),y=async(p,o,e=!1)=>{b(!0);const i=u.find(r=>r.id===o);let s;i&&!e?s=i:s=await g(p,o),console.log("getCurrentPosBaseInfo ~ posInfo:",u,s),t(s),s&&f([s])},g=async(p,o)=>{const e=await n.FullClient.getOwnedObjectsByPage(p,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{ObjectId:o}});return e&&e.data&&e.data.length>0?await m(e.data[0]):null},d=async(p,o)=>{var i;const e=["https://mainnet.suiet.app:443","https://rpc-mainnet.suiscan.xyz:443"];for(const s of e)try{const r=await n.Position.getPositionTransactionList({pos_id:p,full_rpc_url:s,origin_pos_id:o,order:"descending"});if(console.log("ğŸš€ ~ getCurrentPosHistory ~ response?.data:",r==null?void 0:r.data,s),((i=r==null?void 0:r.data)==null?void 0:i.length)>0)return r.data}catch(r){console.error(`Error fetching data from ${s}:`,r)}return[]};return{getCurrentPosBaseInfo:y,getCurrentPosHistory:async(p,o)=>{console.log("ğŸš€ ~ getCurrentPosHistory ~ posId:",p,o),c(!0);const e=await d(p,o),i=p.toLowerCase()!==o.toLowerCase()?await d(o,o):[];console.log("ğŸš€ ~ getCurrentPosHistory ~ clmmHistory:",e,i,[...e,...i]);const r=[...e,...i].sort((P,l)=>(l==null?void 0:l.timestampMs)-(P==null?void 0:P.timestampMs));N(r),c(!1),console.log("ğŸš€ ~ getCurrentPosHistory ~ result:",r)},getCurrentPosByPosId:g}}function E(){const{fetchOwnerVeNFT:n}=B(),{showCommonToast:u}=k(),{notifiSources:t}=A();return{createNotifiSubscriptionVerify:async()=>{try{const c=await n();if(c!=null&&c.xcetus_balance){if(_(c.xcetus_balance).div(Math.pow(10,9)).lessThan(1e3))return u("Price alerts are currently open to users who hold 1000+ xCETUS.","rejected"),!1}else return u("Unable to fetch xCetus information.","rejected"),!1;return t.length>=5?(u("Price alerts can only be enabled for up to 5 positions for an account at the same time.","rejected"),!1):!0}catch(c){return console.error("ğŸš€ ~ createNotifiSubscriptionVerify ~ error:",c),u("An error occurred while verifying the subscription.","rejected"),!1}},getPositionNotifiStatus:(c,m)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiHelper.ts:46 ~ getPositionNotifiStatus ~ notifiSources:",t);try{const f=t.find(y=>{const{pool_address:g,position_index:d}=y;return g===c&&d===m});return{isSubscription:!!f,alertID:(f==null?void 0:f.alertID)||""}}catch(f){return console.error("ğŸš€ ~ getPositionNotifiStatus ~ error:",f),{isSubscription:!1,alertID:""}}}}}function G(){const{getCurrentPosByPosId:n}=v(),{currentAccount:u}=L(),{createNotifiAlert:t,deleteNotifiAlerts:b}=T(),{setIsChecked:N,setNotifiSubscriptionLoading:c,notifiClient:m}=A(),{createNotifiSubscriptionVerify:f,getPositionNotifiStatus:y}=E(),g=async o=>{if(c(!0),!await f())return N(!1),!1;const{subscriptionSource:i,position:s,posIndex:r,events:P}=o;console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:30 ~ notifiSubscription ~ notifiSubscriptionParams:",o);try{if(i=="PositionDetail")d(String(s),String(r));else{const l=P.filter(w=>w.type.indexOf("OpenPositionEvent")>-1)[0],a=P.filter(w=>w.type.indexOf("DepositEvent")>-1)[0],{position:S,pool:H}=l.parsedJson,I=a?a.parsedJson.wrapped_position_id:l.parsedJson.position,C=await n(u==null?void 0:u.address,I);C&&(console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:36 ~ notifiSubscription ~ currentPosInfo.index:",C.index),d(S,String(C.index)))}}catch(l){c(!1),console.log("ğŸš€ğŸš€ğŸš€ ~ file: useNotifiSubscription.ts:45 ~ notifiSubscription ~ error:",l)}},d=async(o,e)=>{t(o,e)},h=async(o,e,i)=>{console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:57 ~ notifiUnSubscription ~ posId:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:58 ~ notifiUnSubscription ~ posIndex:",i);const{alertID:s}=y(o,String(i));console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:59 ~ notifiUnSubscription ~ alertID:",s),s&&b(s)};return{notifiSubscription:g,notifiUnSubscription:h,getNotifiPositionTransfer:(o,e,i)=>{if(e&&e.userState&&e.userState.status=="authenticated"){console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:62 ~ getNotifiPositionTransfer ~ notifiSources:",i);for(let s=0;s<i.length;s++){const{pool_address:r,position_index:P}=i[s];let l=!1,a;for(let S=0;S<o.length;S++){const{posId:H,index:I}=o[S];r==H&&Number(I)==Number(P)&&(l=!0),a={pool_address:r,position_index:P,clmmPool:o[S].clmmPool}}l||h(a==null?void 0:a.pool_address,a==null?void 0:a.clmmPool,a==null?void 0:a.position_index)}}console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiSources:",i),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ posBaseList:",o),console.log("ğŸš€ğŸš€ğŸš€ ~ useNotifiSubscription.ts:60 ~ getNotifiPositionTransfer ~ notifiClient:",e.us)}}}export{V as a,v as b,E as c,G as u};
//# sourceMappingURL=useNotifiSubscription-izrr9CM1.js.map
