import{dj as ce,bO as Z,a1 as ee,c6 as oe,d as J,cC as ie,cD as ae,r as K,co as se,aH as de,am as fe,e as ue,cS as le,cq as be,dk as ge,dl as he,dm as Se,dn as we}from"./index-D49RffYW.js";function xe(t){try{return t&&t.includes("user")&&t.includes("reject")}catch{return!1}}function me(t){const e=String(t);return e.indexOf('Some("create_pool_internal")')>-1&&e.indexOf(" }, 1")>-1}function Ie(t){const e=String(t);return e.indexOf("withdraw_with_proof")>-1||e.indexOf("check_coin_threshold")>-1||e.indexOf('Identifier("balance")')>-1||e.indexOf("remove_liquidity")>-1&&(e.indexOf("in command 1")>-1||e.indexOf("in command 2")>-1||e.indexOf("in command 4")>-1||e.indexOf("in command 5")>-1)||e.indexOf("repay_add_liquidity")>-1&&(e.indexOf("in command 1")>-1||e.indexOf("in command 2")>-1||e.indexOf("in command 3")>-1||e.indexOf("in command 4")>-1||e.indexOf("in command 5")>-1)}function Te(t){return!!String(t).includes("Could not find the referenced transaction")}function Ee(t){return!!String(t).includes("TRPCClientError:")}function ve(t){const e=t.status,n=String(t);return!!([429,503,502,400].includes(e)||n.includes("Could not find the referenced object"))}function je(t){return!!String(t).includes("Max cap reached.")}function Me(t){return!!String(t).includes("Fast Mode service error")}function ye(t){return!!String(t).includes("The current operation does not support msafe wallet")}const Ae=[{matcher:xe,message:"User rejected the request"},{matcher:Te,message:"Oops. Failed to sync data from your txid. Please check your txn status from explorer or from your wallet."},{matcher:Ee,message:t=>String(t).split(":")[1]},{matcher:ve,message:"RPC loading failed. Try resubmission or check your network. You can also switch an RPC in settings to try again."},{matcher:je,message:"Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed."},{matcher:Me,message:"Fast Mode service error, please switch to the Default Transaction Mode or try again later."},{matcher:ye,message:"The current operation does not support msafe wallet."},{matcher:t=>String(t).includes("Transaction validator signing failed"),message:"Oops. Failed to pull your txid. Please check your txn status from explorer or from your wallet."},{matcher:Ie,message:"Exceeded price slippage"},{matcher:me,message:"Pool already exists"}];function ke(t){for(const{matcher:e,message:n}of Ae)if(e(t))return typeof n=="function"?n(t):n;return"Transaction failed"}const W={CETUS:"a",DEEPBOOK:"b",DEEPBOOKV3:"c",KRIYA:"d",KRIYAV3:"e",FLOWX:"f",FLOWXV3:"g",AFTERMATH:"h",TURBOS:"i",HAEDAL:"j",HAEDALPMM:"k",VOLO:"l",AFSUI:"m",BLUEMOVE:"n",SCALLOP:"o",SPRINGSUI:"p",BLUEFIN:"q",ALPHAFI:"r",STEAMM:"s",METASTABLE:"t",OBRIC:"u"};function te(t,e,n){typeof window<"u"&&window.gtag&&window.gtag("event","track_shio_status",{operation_type:t,shio_enabled:e,tx_hash:n})}function Be(t){const n=t.providers.map(r=>W==null?void 0:W[r]).join("");typeof window<"u"&&window.gtag&&window.gtag("event","track_transaction",{...t,providers:n})}const Ce="0x2::sui::SUI",Oe="https://rpc.getshio.com/fast",pe="0x1889977f0fb56ae730e7bda8e8e32859ce78874458c74910d36121a81a615123",Q=[{objectId:"0xc32ce42eac951759666cbc993646b72387ec2708a2917c2c6fb7d21f00108c18",version:72869622},{objectId:"0x0289acae0edcdf1fe3aedc2e886bc23064d41c359e0179a18152a64d1c1c2b3e",version:327637282},{objectId:"0x03132160e8c2c45208abf3ccf165e82edcc42fee2e614afe54582f9740a808b8",version:327637282},{objectId:"0x072ae7307459e535379f422995a0d10132f12a3450298f8cf0cc07bd164f9999",version:327637282},{objectId:"0x1c1a96a2f4a34ea09ab15b8ff98f4b6b4338ce89f4158eb7d3eb2cd4dcbd6d86",version:327637282},{objectId:"0x20d76f37ad9f2421a9e6afaf3bb204250b1c2241c50e8a955e86a1a48767d06f",version:327637282},{objectId:"0x213ed368233cc7480fcb6336e70c5ae7ee106b2317ba02ccb5d0478e45bcc046",version:327637282},{objectId:"0x22ce1e80937354eba5549fed2937dc6e2b24026d03505bb51a3e4a64aa4142f6",version:327637282},{objectId:"0x26188cb7ce5ae633279f440f66081cb65cc585e428de18e194f8843e866f799f",version:327637282},{objectId:"0x38642f01422480128388d3e2948d3dc1b2680f9914077edb6bd3451ae1c5bcf0",version:327637282},{objectId:"0x3dd85b6424aea1cae9eff6e55456ca783e056226325f1362106eca8b3ed04ca0",version:327637282},{objectId:"0x42f8adc490542369d9c3b95e9f6eb70b2583102900feb7e103072ed49ba7fc3d",version:327637282},{objectId:"0x46b8158c82fa6bda7230d31a127d934c7295a0042083b4900f3096e9191f6f3f",version:327637282},{objectId:"0x6ebac88a8c3f7a4a9fb05ea49d188a1fe8520ae59ee736e0473004d3033512a4",version:327637282},{objectId:"0x6f55ad6cb40cfc124c11b11c19be0a80237b104acd955e7b52ccb7bf9046fe33",version:327637282},{objectId:"0x71aafb8bac986e82e5f78846bf3b36c2a82505585625207324140227a27ff279",version:327637282},{objectId:"0x7fe9b08680d4179de5672f213b863525b21f10604ca161538075e9338d1d2324",version:327637282},{objectId:"0x81538ef2909a3e0dd3d7f38bcbee191509bae4e8666272938ced295672e2ee8d",version:327637282},{objectId:"0x828eb6b3354ad68a23dd792313a16a0d888b7ea4fdb884bb22bd569f8e61319e",version:327637282},{objectId:"0x9705a332b8c1650dd7fe687ef9f9a9638afb51c30c0b34db150d60b920bc07eb",version:327637282},{objectId:"0x9918f73797a9390e9888b55454f2b31bc01de1a4634acab08f80641c4248e8a5",version:327637282},{objectId:"0x9cd4c08bdf2e132ec2cc77b0f03be60a94951e046d8e82ed5494f44e609edd2f",version:327637282},{objectId:"0xac8ce2033571140509788337c8a1f3aa8941a320ecd7047acda310d39cad9e03",version:327637282},{objectId:"0xbcd4527035265461a9a7b4f1e57c63ea7a6bdf0dc223c66033c218d880f928b1",version:327637282},{objectId:"0xbfdb691b8cc0b3c3a3b7a654f6682f3e53b164d9ee00b9582cdb4d0a353440a9",version:327637282},{objectId:"0xc2559d5c52ae04837ddf943a8c2cd53a5a0b512cee615d30d3abe25aa339465e",version:327637282},{objectId:"0xc56db634d02511e66d7ca1254312b71c60d64dc44bf67ea46b922c52d8aebba6",version:327637282},{objectId:"0xc84545cbff1b36b874ab2b69d11a3d108f23562e87550588c0bda335b27101e0",version:327637282},{objectId:"0xcc141659b5885043f9bfcfe470064819ab9ac667953bcedd1000e0652e90ee76",version:327637282},{objectId:"0xef6bf4952968d25d3e79f7e4db1dc38f2e9d99d61ad38f3829acb4100fe6383a",version:327637282},{objectId:"0xf2ed8d00ef829de5c4a3c5adf2d6b0f41f7fec005fb9c88e5616b98173b2fd66",version:327637282},{objectId:"0xfce73f3c32c3f56ddb924a04cabd44dd870b72954bbe7c3d7767c3b8c25c4326",version:327637282}];async function De(t){const e=t.client,n=await t.transaction.build({client:e,onlyTransactionKind:!0});let r=t.sender??t.transaction.getData().sender;if(!r)throw new Error("Sender need to be either set in options or in transaction data");return await e.call("shio_estimateFastModeFee",[r,t.transaction.getData().gasData.price,ce.from(n).toString("base64")])}function Fe(){return Q[Math.floor(Math.random()*Q.length)]}async function Re(t,e,n){return await t.executeTransactionBlock({transactionBlock:e.bytes,signature:e.signature,options:n})}async function Le(t,e,n){let r=t.moveCall({package:"0x2",module:"coin",function:"into_balance",typeArguments:[Ce],arguments:[e]});return _e(t,r,n)}async function _e(t,e,n){let r=Fe();t.moveCall({package:pe,module:"auctioneer",function:"submit_bid",arguments:[t.sharedObjectRef({objectId:r.objectId,mutable:!0,initialSharedVersion:r.version}),t.pure.u64(n),e]})}function qe(){const{signTransactionBlock:t,executeTransactionBlock:e,signAndExecuteTransactionBlock:n}=Z(),{currentAccount:r}=ee();return{getFastModeTx:async(c,w,x)=>{let h,I,i;try{const d=new oe({url:Oe});c.setSender(r==null?void 0:r.address),c.setGasPrice(Number(x));const T=await De({transaction:c,client:d}),y=J(w).mul(Math.pow(10,9)).toString();if(J(T.gasBudget).gt(y))throw Error("Max cap reached. This is to prevent your txn from overpaying. You can choose to edit your gas max cap in settings if needed.");c.setGasBudget(T.gasBudget);const O=c.splitCoins(c.gas,[T.tipAmount]);Le(c,O[0],T.tipAmount);const p=await c.build({client:d}),D=await t(p),{bytes:S,signature:A}=D;i=S,I=new Date().getTime(),h=await Re(d,D,{showEffects:!0})}catch(d){throw String(d).includes("Failed to fetch")?Error("Fast Mode service error"):d}return{result:h,startExecuteTime:I,transactionBlockBytes:i}}}}function Ue(){const t=ie(),e=ae(),n=K.useMemo(()=>{if(!t.currentWallet)return null;const a=t.currentWallet.features["sui:signAndExecuteTransactionBlock"];return a?a.signAndExecuteTransactionBlock:null},[t]);return{getMsafeRes:async(a,c)=>{if(!e||!n)throw new Error("No account information");return a.setSender(e==null?void 0:e.address),await n({transactionBlock:a,account:e,chain:e==null?void 0:e.chains[0],action:c==null?void 0:c.action,txbParams:c==null?void 0:c.txbParams})}}}function We(){return{trackShio:(n,r,a)=>{const c=n==null?void 0:n.action;if(["FarmingOpenAndAddLiquidity","FarmingIncreaseLiquidity","FarmingDecreaseLiquidity","FarmingRemoveLiquidity","FarmingRemoveLiquidity","OpenAndAddLiquidity","IncreaseLiquidity","RemoveLiquidity","DecreaseLiquidity","AddVaultsPosition","RemoveVaultsPosition","AggregatorSwap"].includes(c))try{te(c,r,a)}catch{}},trackSwap:(n,r,a)=>{var c,w,x,h;if(r!=="User rejected the request")try{const I="Swap",i=new Date().getTime(),d=((c=n==null?void 0:n.providerKey)==null?void 0:c.length)>1,T=!!((w=n==null?void 0:n.routerData)!=null&&w.isDowngrade),y=(n==null?void 0:n.providerKey)||[],O=`${n==null?void 0:n.from}-${(x=n==null?void 0:n.routerData)==null?void 0:x.fromAmountUi}`,p=`${n==null?void 0:n.to}-${(h=n==null?void 0:n.routerData)==null?void 0:h.toAmountUi}`,D=!!r,S={action:I,actionTime:i,txHash:a,isOpenAggregator:d,isDowngrade:T,providers:y,fromCoin:O,toCoin:p,isError:!!r},A=String(r),R=A.length;if(S.errorMsgLength=R,R>100){let m=1;for(;m<=5;)S[`errorMsg${m}`]=A.slice((m-1)*100,(m-1)*100+100),m++}else D&&(S.errorMsg1=A);Be(S)}catch{}}}}function Ke(){const{setTransactionData:t,setTransactionModalVisible:e,manualCloseIdList:n}=se(),r=K.useRef(n);K.useEffect(()=>{r.current=n},[n]);const a=i=>{if(i){const d=r.current.includes(i);return d&&e(!1),d}return!1};return{transactionConfirmation:i=>{a(i.transactionId)||(t({...i,status:"confirmation"}),e(!0))},transactionSubmitted:i=>{a(i.transactionId)||(e(!1),t({...i,status:"submitted"}),e(!0))},transactionSuccess:i=>{a(i.transactionId)||(e(!1),t({...i,status:"success"}),e(!0))},transactionRejected:(i,d=n)=>{a(i.transactionId)||(e(!1),t({...i,status:"rejected"}),e(!0))},closeTransactionModal:()=>{e(!1)}}}function Ne(){const{signTransactionBlock:t,executeTransactionBlock:e,signAndExecuteTransactionBlock:n}=Z(),{currentAccount:r}=ee(),{clmmSdk:a}=de(),{transactionConfirmation:c,transactionSubmitted:w,transactionSuccess:x,transactionRejected:h,closeTransactionModal:I}=Ke(),{submittedTsToast:i,failedTsToast:d,successTsToast:T,closeToast:y}=fe();ue();const{getFastModeTx:O}=qe(),{getMsafeRes:p}=Ue(),{trackShio:D,trackSwap:S}=We(),A=5,R=2e3;async function m(s,o=1){try{let f;try{f=await a.fullClient.getTransactionBlock({digest:s,options:{showEvents:!0,showEffects:!0,showBalanceChanges:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0}})}catch{f=await a.fullClient.getTransactionBlock({digest:s,options:{showEvents:!0,showEffects:!0}})}if(f)return f;throw new Error("Empty response")}catch(f){if(console.error(`Attempt ${o} failed:`,f),o>=A)throw new Error("Failed to fetch transaction status after maximum retries.");return await le(R),m(s,o+1)}}const ne=async(s,o,{useDevInspect:f=!1,useMev:E=!1,txAction:k="signTransactionBlock",showSuccessModal:re=!0,useFastMode:V=!1,maxCapForGas:N="",customGasPrice:H="",msafeParams:j,otherParams:q}={})=>{var Y,$,G,X;const L=o.transactionId?o.transactionId:new Date().getTime().toString();o.transactionId=L,c(o);const U=(j==null?void 0:j.action)==="AggregatorSwap";let g="";try{let u,B,C;typeof s=="function"?C=await s():C=s;let F;if(V&&N&&H){const b=await O(C,N,H);u=b.result,F=b.startExecuteTime,B=b.transactionBlockBytes}else if((Y=be)!=null&&Y.inMSafeWallet())if(j)u=await p(C,j);else throw Error("The current operation does not support msafe wallet");else if(k==="signTransactionBlock"){const b=await t(C);F=new Date().getTime();const{bytes:v,signature:M}=b;if(B=b.bytes,E)try{const P=await ge(v,M,500)}catch{}u=await e(v,M,f)}else u=await n(C,f);if(g=u==null?void 0:u.digest,!g&&B){const b=he(B);g=Se.getDigestFromBytes(b)}o.tx=g,w(o),o.isSwapWidget||i(o),y(L);let l;if((($=u==null?void 0:u.effects)==null?void 0:$.status.status)==="success"?l=u:l=await m(g,0),!l||((G=l.effects)==null?void 0:G.status.status)==="failure"){const b=_(o,(X=l.effects)==null?void 0:X.status.error);U&&S(q,b,g)}else{if(F){const v=new Date().getTime(),M=(l==null?void 0:l.timestampMs)||0,z=(M&&Number(M)>F?Math.min(v,Number(M)):v)-F;z<1e3&&(o.executeTime=z)}const b=we(l,r==null?void 0:r.address,!1);if(o.getShowInfo){const v=o.getShowInfo("success",b);o.getShowInfo=M=>v}if(re?x(o):I(),o.isSwapWidget||(o.transactionId=void 0,T(o)),l&&!l.digest&&g&&(l.digest=g),j)try{te(j.action,V||E,g)}catch{}return U&&S(q,"",g),l}}catch(u){L&&y(L);const B=_(o,u);U&&S(q,B,g)}},_=(s,o)=>{const f=ke(o);if(s.getShowInfo){const E=s.getShowInfo("rejected");s.getShowInfo=k=>(E.toastDescriptionContent=f,E.modalDescriptionText=f,E),h(s),s.isSwapWidget||d(s)}else s.getShowInfo=E=>{const k={};return k.toastDescriptionContent=f,k.modalDescriptionText=f,k},h(s),s.isSwapWidget||d(s);return f};return{signAndExecuteTransaction:ne,transactionSuccess:x,getTransactionStatus:m,transactionConfirmation:c,transactionRejected:h,handleError:_}}export{Ke as a,Ne as u};
