import{n as mt,o as It,r as u,p as ft,v as jt,q as es,t as ts,w as ss,x as as,y as ns,z as Pt,A as dt,D as Fe,E as gt,F as is,G as cs,J as ls,K as zt,L as Ze,M as rs,N as os,O as us,j as t,P as Ie,Q as bt,R as Ye,U as ps,u as _t,b as lt,e as Wt,V as G,k as Bt,W as Ge,S as ct,H as N,X as ht,d as v,Y as U,T as $,Z as Je,I as Oe,C as wt,$ as He,B as Ht,a0 as xs,a1 as rt,a2 as Tt,a3 as ms,a4 as ds,a5 as gs,a6 as Re,a7 as at,a8 as yt,a9 as At,aa as qe,ab as hs,g as ys,ac as nt,ad as Ss,ae as vs,af as bs,ag as _s,ah as ws,ai as Ds,aj as fs,ak as js,al as Ps,am as Ts,an as As,ao as ks}from"./index-D49RffYW.js";import{M as Rs,C as Os}from"./MenuDropBlock-B-3fdvCI.js";import{L as Ns,T as Cs,a as Ms}from"./LimitPriceChart-C264-Tbb.js";import{P as Lt}from"./Pagination-DqVMPT3W.js";import{N as St}from"./NoData-MWQZy93S.js";import{R as kt}from"./RefreshButton-C1kwCG7k.js";import{u as ot}from"./useTransaction-i5gFyneH.js";import{R as Vt,u as Ut}from"./RangeValue-B6IVaqEN.js";import{D as $s,e as Es,g as zs}from"./api-data-utils-D656F-wl.js";import{H as De}from"./HTextLabelBox-DVxTk_Ir.js";import{u as Dt}from"./useAccountBalance-D-weOZgA.js";import{P as Ws}from"./progress-C8tpxWAq.js";import{u as Bs}from"./useInsufficientBalanceToast-oZJ3kO4O.js";import{A as Hs}from"./aggregator-VXxomCmR.js";import{A as Rt}from"./useSwapHelper-CKwapxYx.js";import{u as Ot}from"./useTokenBalance-Cc02jFZo.js";import{u as Ls}from"./useFindBestRouting-Bo95_EUn.js";import{u as Ft}from"./useToken-BlS8b5ft.js";import{i as Vs}from"./icon_currentprice@2x-DeObnx8l.js";import{C as Us}from"./CurrentPrice-bArlFA15.js";import{T as Fs}from"./TooltipIcon-BGEWyiwk.js";import{T as qs}from"./TradeInputGroup-C7m7R_Tz.js";import{W as Gs}from"./WarningTokenTipModal-Ffw8adfe.js";import{S as Nt}from"./SingleTokenInfo-Cvcahm1q.js";import{I as qt}from"./InputBox-cvzQCj0g.js";import{u as Ys}from"./global-iZ7St_zm.js";import{u as Ks}from"./useRpcListener-D8tK2rVa.js";import"./CetusTooltip-7TnGbJNH.js";import"./IconBg-C4r55JcD.js";import"./progress.utils-4THQPte7.js";import"./useGetPoolList-DBJielhS.js";import"./_getAllKeysIn-Caqnu8Ck.js";import"./AddressCopyLink-BnCAac35.js";import"./AddressUnderline-CPGiMg8E.js";import"./usePreviousValue-D4m5LJZe.js";function Qs(a){const{min:s=0,max:e=100,onChange:h,value:r,defaultValue:c,isReversed:i,direction:n="ltr",orientation:p="horizontal",id:l,isDisabled:m,isReadOnly:x,onChangeStart:f,onChangeEnd:d,step:o=1,getAriaValueText:S,"aria-valuetext":j,"aria-label":T,"aria-labelledby":H,name:Y,focusThumbOnChange:E=!0,minStepsBetweenThumbs:A=0,...J}=a,ee=mt(f),Z=mt(d),L=mt(S),te=cs({isReversed:i,direction:n,orientation:p}),[se,z]=It({value:r,defaultValue:c??[25,75],onChange:h});if(!Array.isArray(se))throw new TypeError(`[range-slider] You passed an invalid value for \`value\` or \`defaultValue\`, expected \`Array\` but got \`${typeof se}\``);const[C,R]=u.useState(!1),[F,ie]=u.useState(!1),[b,_]=u.useState(-1),V=!(m||x),M=u.useRef(se),k=se.map(y=>ft(y,s,e)),O=A*o,I=Xs(k,s,e,O),W=u.useRef({eventSource:null,value:[],valueBounds:[]});W.current.value=k,W.current.valueBounds=I;const me=k.map(y=>e-y+s),Ce=(te?me:k).map(y=>jt(y,s,e)),Me=p==="vertical",de=u.useRef(null),fe=u.useRef(null),be=u.useId(),K=ls(l??be),ae=u.useCallback(y=>{var ne;if(!de.current)return;W.current.eventSource="pointer";const w=de.current.getBoundingClientRect(),{clientX:D,clientY:B}=((ne=y.touches)==null?void 0:ne[0])??y,q=Me?w.bottom-B:D-w.left,pe=Me?w.height:w.width;let re=q/pe;return te&&(re=1-re),es(re,s,e)},[Me,te,e,s]),je=(e-s)/10,ye=o||(e-s)/100,Q=u.useMemo(()=>({setValueAtIndex(y,w){if(!V)return;const D=W.current.valueBounds[y];w=parseFloat(ts(w,D.min,ye)),w=ft(w,D.min,D.max);const B=[...W.current.value];B[y]=w,z(B)},setActiveIndex:_,stepUp(y,w=ye){const D=W.current.value[y],B=te?D-w:D+w;Q.setValueAtIndex(y,B)},stepDown(y,w=ye){const D=W.current.value[y],B=te?D+w:D-w;Q.setValueAtIndex(y,B)},reset(){z(M.current)}}),[ye,te,z,V]),Pe=u.useCallback(y=>{const w=y.key,B={ArrowRight:()=>Q.stepUp(b),ArrowUp:()=>Q.stepUp(b),ArrowLeft:()=>Q.stepDown(b),ArrowDown:()=>Q.stepDown(b),PageUp:()=>Q.stepUp(b,je),PageDown:()=>Q.stepDown(b,je),Home:()=>{const{min:q}=I[b];Q.setValueAtIndex(b,q)},End:()=>{const{max:q}=I[b];Q.setValueAtIndex(b,q)}}[w];B&&(y.preventDefault(),y.stopPropagation(),B(y),W.current.eventSource="keyboard")},[Q,b,je,I]),{getThumbStyle:Te,rootStyle:Ae,trackStyle:Le,innerTrackStyle:$e}=u.useMemo(()=>ss({isReversed:te,orientation:p,thumbPercents:Ce}),[te,p,Ce]),ke=u.useCallback(y=>{var D;const w=y??b;if(w!==-1&&E){const B=K.getThumb(w),q=(D=fe.current)==null?void 0:D.ownerDocument.getElementById(B);q&&setTimeout(()=>q.focus())}},[E,b,K]);as(()=>{W.current.eventSource==="keyboard"&&(Z==null||Z(W.current.value))},[k,Z]);const Ve=y=>{const w=ae(y)||0,D=W.current.value.map(ne=>Math.abs(ne-w)),B=Math.min(...D);let q=D.indexOf(B);const pe=D.filter(ne=>ne===B);pe.length>1&&w>W.current.value[q]&&(q=q+pe.length-1),_(q),Q.setValueAtIndex(q,w),ke(q)},Ee=y=>{if(b==-1)return;const w=ae(y)||0;_(b),Q.setValueAtIndex(b,w),ke(b)};ns(fe,{onPanSessionStart(y){V&&(R(!0),Ve(y),ee==null||ee(W.current.value))},onPanSessionEnd(){V&&(R(!1),Z==null||Z(W.current.value))},onPan(y){V&&Ee(y)}});const _e=u.useCallback((y={},w=null)=>({...y,...J,id:K.root,ref:Pt(w,fe),tabIndex:-1,"aria-disabled":dt(m),"data-focused":Fe(F),style:{...y.style,...Ae}}),[J,m,F,Ae,K]),ze=u.useCallback((y={},w=null)=>({...y,ref:Pt(w,de),id:K.track,"data-disabled":Fe(m),style:{...y.style,...Le}}),[m,Le,K]),Se=u.useCallback((y={},w=null)=>({...y,ref:w,id:K.innerTrack,style:{...y.style,...$e}}),[$e,K]),Ke=u.useCallback((y,w=null)=>{const{index:D,...B}=y,q=k[D];if(q==null)throw new TypeError(`[range-slider > thumb] Cannot find value at index \`${D}\`. The \`value\` or \`defaultValue\` length is : ${k.length}`);const pe=I[D];return{...B,ref:w,role:"slider",tabIndex:V?0:void 0,id:K.getThumb(D),"data-active":Fe(C&&b===D),"aria-valuetext":(L==null?void 0:L(q))??(j==null?void 0:j[D]),"aria-valuemin":pe.min,"aria-valuemax":pe.max,"aria-valuenow":q,"aria-orientation":p,"aria-disabled":dt(m),"aria-readonly":dt(x),"aria-label":T==null?void 0:T[D],"aria-labelledby":T!=null&&T[D]||H==null?void 0:H[D],style:{...y.style,...Te(D)},onKeyDown:gt(y.onKeyDown,Pe),onFocus:gt(y.onFocus,()=>{ie(!0),_(D)}),onBlur:gt(y.onBlur,()=>{ie(!1),_(-1)})}},[K,k,I,V,C,b,L,j,p,m,x,T,H,Te,Pe,ie]),Qe=u.useCallback((y={},w=null)=>({...y,ref:w,id:K.output,htmlFor:k.map((D,B)=>K.getThumb(B)).join(" "),"aria-live":"off"}),[K,k]),We=u.useCallback((y,w=null)=>{const{value:D,...B}=y,q=!(D<s||D>e),pe=D>=k[0]&&D<=k[k.length-1];let re=jt(D,s,e);re=te?100-re:re;const ne={position:"absolute",pointerEvents:"none",...is({orientation:p,vertical:{bottom:`${re}%`},horizontal:{left:`${re}%`}})};return{...B,ref:w,id:K.getMarker(y.value),role:"presentation","aria-hidden":!0,"data-disabled":Fe(m),"data-invalid":Fe(!q),"data-highlighted":Fe(pe),style:{...y.style,...ne}}},[m,te,e,s,p,k,K]),ge=u.useCallback((y,w=null)=>{const{index:D,...B}=y;return{...B,ref:w,id:K.getInput(D),type:"hidden",value:k[D],name:Array.isArray(Y)?Y[D]:`${Y}-${D}`}},[Y,k,K]);return{state:{value:k,isFocused:F,isDragging:C,getThumbPercent:y=>Ce[y],getThumbMinValue:y=>I[y].min,getThumbMaxValue:y=>I[y].max},actions:Q,getRootProps:_e,getTrackProps:ze,getInnerTrackProps:Se,getThumbProps:Ke,getMarkerProps:We,getInputProps:ge,getOutputProps:Qe}}function Xs(a,s,e,h){return a.map((r,c)=>{const i=c===0?s:a[c-1]+h,n=c===a.length-1?e:a[c+1]-h;return{min:i,max:n}})}const[Js,ut]=zt({name:"SliderContext",errorMessage:"useSliderContext: `context` is undefined. Seems you forgot to wrap all slider components within <RangeSlider />"}),[Zs,pt]=zt({name:"RangeSliderStylesContext",errorMessage:`useRangeSliderStyles returned is 'undefined'. Seems you forgot to wrap the components in "<RangeSlider />" `}),Gt=Ze(function(s,e){const h={orientation:"horizontal",...s},r=rs("Slider",h),c=os(h),{direction:i}=us();c.direction=i;const{getRootProps:n,...p}=Qs(c),l=u.useMemo(()=>({...p,name:h.name}),[p,h.name]);return t.jsx(Js,{value:l,children:t.jsx(Zs,{value:r,children:t.jsx(Ie.div,{...n({},e),className:"chakra-slider",__css:r.container,children:h.children})})})});Gt.displayName="RangeSlider";const vt=Ze(function(s,e){const{getThumbProps:h,getInputProps:r,name:c}=ut(),i=pt(),n=h(s,e);return t.jsxs(Ie.div,{...n,className:bt("chakra-slider__thumb",s.className),__css:i.thumb,children:[n.children,c&&t.jsx("input",{...r({index:s.index})})]})});vt.displayName="RangeSliderThumb";const Yt=Ze(function(s,e){const{getTrackProps:h}=ut(),r=pt(),c=h(s,e);return t.jsx(Ie.div,{...c,className:bt("chakra-slider__track",s.className),__css:r.track,"data-testid":"chakra-range-slider-track"})});Yt.displayName="RangeSliderTrack";const Kt=Ze(function(s,e){const{getInnerTrackProps:h}=ut(),r=pt(),c=h(s,e);return t.jsx(Ie.div,{...c,className:"chakra-slider__filled-track",__css:r.filledTrack})});Kt.displayName="RangeSliderFilledTrack";const Is=Ze(function(s,e){const{getMarkerProps:h}=ut(),r=pt(),c=h(s,e);return t.jsx(Ie.div,{...c,className:bt("chakra-slider__marker",s.className),__css:r.mark})});Is.displayName="RangeSliderMark";function Qt(){const{peripherySdk:a}=Ye();return{dcaCloseOrderPayload:async e=>await a.Dca.dcaCloseOrderPayload(e)}}function Xt(){const{peripherySdk:a}=Ye();return{dcaWithdrawPayload:async e=>await a.Dca.withdrawAll(e)}}const ea=(a,s)=>({upperPriceSize:"0%",setUpperPriceSize:e=>{a(()=>({upperPriceSize:e}))},lowerPriceSize:"0%",setLowerPriceSize:e=>{a(()=>({lowerPriceSize:e}))},dcaMode:"total",setDcaMode:e=>{a(()=>({dcaMode:e}))},isDcaRefresh:!1,setIsDcaRefresh:e=>{a(()=>({isDcaRefresh:e}))},pageDirect:!1,setPageDirect:e=>{a(()=>({pageDirect:e}))},sellTotalAmount:"",setSellTotalAmount:e=>{a(()=>({sellTotalAmount:e}))},sellAmount:"",setSellAmount:e=>{a(()=>({sellAmount:e}))},buyAmount:"",setBuyAmount:e=>{a(()=>({buyAmount:e}))},sellCoin:void 0,setSellCoin:e=>{a(()=>({sellCoin:e}))},buyCoin:void 0,setBuyCoin:e=>{a(()=>({buyCoin:e}))},orderNum:"2",setOrderNum:e=>{a(()=>({orderNum:e}))},investNum:"1",setInvestNum:e=>{a(()=>({investNum:e}))},currentCoinKey:"sellCoin",setCurrentCoinKey:e=>{a(()=>({currentCoinKey:e}))},currentInvest:"Hour",setCurrentInvest:e=>{a(()=>({currentInvest:e}))},pageLoading:!0,setPageLoading:e=>{a(()=>({pageLoading:e}))},dcaConfig:{},setDcaConfig:e=>{a(()=>({dcaConfig:e}))},dcaQuote:{},setDcaQuote:e=>{a(()=>({dcaQuote:e}))},orderHistoryObj:{},setOrderHistoryObj:e=>{a(()=>({orderHistoryObj:{...s().orderHistoryObj,...e}}))},inCoinWhiteList:[],setInCoinWhiteList:e=>{a(()=>({inCoinWhiteList:e}))},outCoinWhiteList:[],setOutCoinWhiteList:e=>{a(()=>({outCoinWhiteList:e}))}}),he=ps(ea);function ta(){const{fetchByApi:a}=_t(),{setOrderHistoryObj:s}=he();return{getDcaOrderHistory:async({orderId:h,limit:r,offset:c})=>{var n;const i=await a($s,"GET",{order_id:h,limit:r,offset:c});if(i!=null&&i.list){const p={[h]:{list:((n=i==null?void 0:i.list)==null?void 0:n.map(l=>({inAmount:l==null?void 0:l.in_amount,outAmount:l==null?void 0:l.out_amount,inCoinType:l==null?void 0:l.in_coin,outCoinType:l==null?void 0:l.out_coin,time:l==null?void 0:l.execution_at,tx:l==null?void 0:l.tx})))||[],total:(i==null?void 0:i.total)||0}};return s(p),p}}}}function sa({isDetail:a,currentTabVal:s,orderInfo:e,handleRefresh:h,pageDirect:r}){const{isApp:c}=lt(),{inCoin:i,outCoin:n}=e,{getDcaOrderHistory:p}=ta(),[l,m]=u.useState(r),[x,f]=u.useState(r),d=10,[o,S]=u.useState([]),[j,T]=u.useState(0),[H,Y]=u.useState(1),[E,A]=u.useState(!1),[J,ee]=u.useState({label:"Overview",value:"overview"}),Z=u.useMemo(()=>[{label:"Overview",value:"overview"},{label:E||Number(j)===0?"Orders":`Orders (${j})`,value:"orders"}],[j]),L=_=>{ee(_),e!=null&&e.orderID&&se(e==null?void 0:e.orderID,d,0,!1)};u.useEffect(()=>{a&&(e!=null&&e.orderID)&&se(e==null?void 0:e.orderID,d,0,!1)},[e,a]);const te=_=>{const V=(_-1)*d;se(e==null?void 0:e.orderID,d,V,!1),Y(_)},se=async(_,V,M,k=!1)=>{var I,W,me,Ne;A(k);const O=await p({orderId:_,limit:V,offset:M});(I=O[_])!=null&&I.list&&S((W=O[_])==null?void 0:W.list),(me=O[_])!=null&&me.total&&T((Ne=O[_])==null?void 0:Ne.total),A(!1)},[z,C]=u.useState(!1),{dcaWithdrawPayload:R}=Xt();Dt();const{signAndExecuteTransaction:F}=ot(),ie=async()=>{C(!0);try{const _=[],V={order_id:e==null?void 0:e.orderID,in_coin_type:e==null?void 0:e.inCoin.coin_type,out_coin_type:e==null?void 0:e.outCoin.coin_type};_.push(V);const M=await R(_);await F(M,{getShowInfo:O=>{var W,me;const I={modalDescriptionText:`${(W=e==null?void 0:e.outCoin)==null?void 0:W.symbol} Claimed`,toastTitleText:`${(me=e==null?void 0:e.outCoin)==null?void 0:me.symbol} Claimed`};return O==="success"&&(I.toastDescriptionContent=""),I}})&&setTimeout(()=>{h()},2e3),C(!1)}catch{C(!1)}},{getExplorerUrl:b}=Wt();return t.jsxs(G,{w:"100%",gap:"20px",children:[t.jsx(Bt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:Z,currentTab:J.label,handleChangeTab:L}),t.jsxs(Ge,{p:"30px 8px 20px",mt:"-42px",borderRadius:"8px",zIndex:"0",bg:"bg_primary",children:[J.value=="orders"&&(E?t.jsx(ct,{height:"4",width:"100%"}):(o==null?void 0:o.length)===0?t.jsx(St,{type:"nodata",text:"No orders",noBorder:!0,p:"12px",bg:"none"}):t.jsxs(G,{w:"100%",align:"flex-start",gap:"16px",mt:"12px",children:[!c&&t.jsxs(N,{w:"100%",flexDirection:{base:"column",lg:"row"},children:[t.jsx(le,{label:"Order info",value:"",w:{base:"100%",lg:"40%"}}),t.jsx(le,{label:"Rate",value:"",w:{base:"100%",lg:"calc(32% - 16px)"},direct:x,onChangeDirect:()=>f(!x)}),t.jsx(le,{label:"Time (UTC)",value:"",w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]}),o==null?void 0:o.map(_=>{const V=ht(_.inAmount,i==null?void 0:i.decimals),M=ht(_.outAmount,n==null?void 0:n.decimals),k=v(V).div(M).toString(),O=v(1).div(k).toString();return t.jsxs(N,{w:"100%",flexDirection:{base:"column",lg:"row"},borderBottom:c?"1px solid":"none",pb:c?"16px":"0",borderColor:"border",_last:{borderBottom:"none",pb:"0"},children:[t.jsx(le,{label:c?"Order info":"",value:`${U(V)} ${i.symbol} → ${U(M)} ${n.symbol}`,w:{base:"100%",lg:"40%"}}),t.jsx(le,{label:c?"Rate":"",value:x?`${U(k)} ${i.symbol} per ${n.symbol}`:`${U(O)} ${n.symbol} per ${i.symbol}`,w:{base:"100%",lg:"calc(32% - 16px)"},direct:x,showDirectIcon:!!c,onChangeDirect:()=>f(!x)}),t.jsx(le,{label:c?"Time (UTC)":"",value:t.jsxs(N,{h:"12px",children:[t.jsx($,{fontSize:"12px",color:"text_caption",children:Je((_==null?void 0:_.time)*1e3,"YMDHM")}),t.jsx(Oe,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(b(_==null?void 0:_.tx,"tx"))}})]}),w:{base:"100%",lg:"28%"},align:"flex-end",textAlign:"right"})]},_==null?void 0:_.time)}),v(j).gt(d)&&t.jsx(wt,{w:"100%",children:t.jsx(Lt,{total:j,size:d,currentPage:H,onChange:te})})]})),J.value=="overview"&&t.jsxs(G,{align:"flex-start",gap:"20px",children:[(e==null?void 0:e.isShowTradeTips)&&(e==null?void 0:e.orderStatus)=="Active"&&s=="active"&&t.jsx(aa,{}),t.jsxs(G,{w:"100%",borderRadius:"8px",p:"12px",bg:"card_bg",gap:"12px",children:[t.jsx(De,{isLoading:!1,label:`DCA  ${i==null?void 0:i.symbol} Balance`,value:`${U(e==null?void 0:e.inBalance,2)||"0"} ${i==null?void 0:i.symbol}`,skeletonStyle:{valueW:"128px"}}),t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsxs($,{fontSize:"12px",children:["DCA ",n==null?void 0:n.symbol," Balance"]}),t.jsxs(N,{children:[t.jsxs($,{color:"text_caption",fontSize:"12px",children:[(e==null?void 0:e.outBalance)>0?U(e==null?void 0:e.outBalance):e==null?void 0:e.outBalance," ",n==null?void 0:n.symbol]}),s=="active"&&t.jsx(He,{isLoading:z,onClick:ie,disabled:(e==null?void 0:e.outBalance)<=0||z,w:"60px",h:"20px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),t.jsx(De,{isLoading:!1,label:"Amount Withdrawn",value:s=="active"?`${U(e==null?void 0:e.outWithdraw,2)}`:(e==null?void 0:e.orderStatus)=="PartialDeal"||(e==null?void 0:e.orderStatus)=="Close"?v(e==null?void 0:e.outWithdraw).gt(0)?`${U(e==null?void 0:e.inWithdrawn)} ${i==null?void 0:i.symbol} ${U(e==null?void 0:e.outWithdraw)} ${n==null?void 0:n.symbol}`:`${U(e==null?void 0:e.inWithdrawn)} ${i==null?void 0:i.symbol}`:`${U(e==null?void 0:e.outWithdraw)} ${n==null?void 0:n.symbol}`,skeletonStyle:{valueW:"128px"}})]}),t.jsxs(N,{flexWrap:"wrap",p:{base:"0",lg:"0 12px"},mt:{base:"-12px",lg:"-28px"},sx:{">div":{mt:{base:"12px",lg:"28px"},w:{base:"100%",lg:"calc((100% - 66px)/3)"},"&:nth-child(3n+1)":{mr:{base:"0",lg:"50px"}}}},children:[t.jsx(le,{label:"Invest Every",value:e==null?void 0:e.investEvery}),t.jsx(le,{label:"# of Orders Left",value:e==null?void 0:e.ofOrderLeft}),t.jsx(le,{label:"Each Order Size",value:`${e==null?void 0:e.eachOrderSize} ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right"}),t.jsx(le,{label:"Minimum Price",value:l?`${e==null?void 0:e.minPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.minPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,direct:l,onChangeDirect:()=>m(!l)}),t.jsx(le,{label:"Maximum Price",value:l?`${e==null?void 0:e.maxPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.maxPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,direct:l,onChangeDirect:()=>m(!l)}),s=="active"&&t.jsx(le,{label:"Current Avg. Price",value:l?`${e==null?void 0:e.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right",direct:l,onChangeDirect:()=>m(!l)}),s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"&&t.jsx(le,{label:"Avg. Price",value:l?`${e==null?void 0:e.currentAvgPrice} ${i==null?void 0:i.symbol} per ${n==null?void 0:n.symbol}`:`${e==null?void 0:e.currentAvgPriceResever} ${n==null?void 0:n.symbol} per ${i==null?void 0:i.symbol}`,align:"flex-end",textAlign:"right",direct:l,onChangeDirect:()=>m(!l)}),s=="active"&&t.jsx(le,{label:"Next Order (UTC)",value:e==null?void 0:e.nextCycleAt}),t.jsx(le,{label:"Created (UTC)",value:e==null?void 0:e.createAt,align:s=="active"||s!=="active"&&(e==null?void 0:e.currentAvgPrice)!=="--"?"flex-start":"flex-end"})]})]})]})]})}const le=({label:a,value:s,direct:e,onChangeDirect:h,textAlign:r="left",showDirectIcon:c=!0,...i})=>t.jsxs(G,{align:"flex-start",flexDirection:{base:"row",lg:"column"},w:{base:"100%",lg:"unset"},justify:{base:"space-between",lg:"unset"},...i,children:[a!==""&&t.jsxs(N,{h:"12px",children:[t.jsx($,{fontSize:"12px",children:a}),h&&c&&t.jsx(Oe,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:h})]}),s!==""&&t.jsx(Ht,{fontSize:"12px",color:"text_caption",textAlign:r,children:s})]}),aa=()=>t.jsxs(G,{p:"12px 12px 0",align:"flex-start",children:[t.jsxs(N,{children:[t.jsx(Oe,{xlinkHref:"#icon-icon-warning",variant:"warning",cursor:"text"}),t.jsx($,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"The system tried to execute your order multiple times but did not get it through. This is possibly because:"})]}),t.jsx($,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market price is not in your required price range"}),t.jsx($,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market no longer exit"}),t.jsx($,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"- The market is extremely volatile"}),t.jsx($,{color:"primary_yellow",lineHeight:"20px",fontSize:"12px",children:"This DCA will continue to be attempted and the estimated end date may be extended until your order is fully executed."})]});function na({currentTabVal:a,orderInfo:s,handleRefresh:e}){const{isApp:h}=lt(),{inCoin:r,outCoin:c}=s,[i,n]=u.useState(!1),[p,l]=u.useState(!1);u.useEffect(()=>{n(!1)},[a]);const{getTokenRank:m}=Ut(),[x,f]=u.useState(!1);u.useEffect(()=>{const T=m(r,c);f(!T)},[r==null?void 0:r.coin_type,c==null?void 0:c.coin_type]);const{dcaCloseOrderPayload:d}=Qt(),{signAndExecuteTransaction:o}=ot(),S=async()=>{l(!0);try{const T=[{order_id:s==null?void 0:s.orderID,in_coin_type:s==null?void 0:s.inCoin.coin_type,out_coin_type:s==null?void 0:s.outCoin.coin_type}],H=await d(T);await o(H,{getShowInfo:E=>{const A={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return E==="success"&&(A.modalDescriptionText="DCA Order Closed",A.toastDescriptionContent="",A.toastTitleText="DCA Order Closed"),A}})&&setTimeout(()=>{e()},2e3),l(!1)}catch{l(!1)}},{getExplorerUrl:j}=Wt();return t.jsxs(G,{w:"100%",gap:"12px",align:"flex-start",children:[t.jsxs(N,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"flex-start",lg:"center"},children:[t.jsxs(N,{children:[t.jsx(xs,{coinAIconUrl:r==null?void 0:r.logo_url,coinBIconUrl:c==null?void 0:c.logo_url,coinACoinType:r==null?void 0:r.coin_type,coinBCoinType:c==null?void 0:c.coin_type,w:"28px",h:"28px"}),t.jsxs($,{color:"text_caption",children:[r==null?void 0:r.symbol," → ",c==null?void 0:c.symbol]}),t.jsx(Oe,{xlinkHref:"#icon-icon_link1",onClick:()=>{window.open(j(s==null?void 0:s.orderID,"poolAddress"))}})]}),!h&&t.jsx(Ct,{currentTabVal:a,isCloseLoading:p,closeOrder:S,orderInfo:s,isDetail:i,onClickDetail:()=>n(!i)})]}),t.jsxs(N,{children:[t.jsxs($,{color:"text_caption",fontSize:"12px",children:[U(s==null?void 0:s.inDepositedOut)," ",r==null?void 0:r.symbol]}),t.jsxs($,{color:"primary_gray",fontSize:"12px",children:["/ ",U(s==null?void 0:s.inDeposited)," ",r==null?void 0:r.symbol]}),t.jsxs($,{color:"primary_gray",fontSize:"12px",children:["(",s==null?void 0:s.inBalanceRatio,"%)"]}),t.jsx(Ws,{w:"50px",h:"4px",value:s==null?void 0:s.inBalanceRatio,bg:"#282828",sx:{'div[role="progressbar"]':{bg:"primary"}}})]}),t.jsxs(N,{w:"100%",children:[t.jsx($,{color:"primary_gray",fontSize:"12px",children:"Price Range"}),t.jsx(Vt,{displayTokenA:c,displayTokenB:r,isRank:!0,priceInfo:{minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,minPriceResever:s==null?void 0:s.minPriceResever,maxPriceResever:s==null?void 0:s.maxPriceResever},fontSize:"12px"})]}),h&&t.jsx(Ct,{currentTabVal:a,isCloseLoading:p,closeOrder:S,orderInfo:s,isDetail:i,onClickDetail:()=>n(!i)}),i&&t.jsx(sa,{pageDirect:x,isDetail:i,currentTabVal:a,orderInfo:s,handleRefresh:e})]})}const Ct=({currentTabVal:a,isCloseLoading:s,closeOrder:e,orderInfo:h,isDetail:r,onClickDetail:c})=>t.jsxs(N,{w:{base:"100%",lg:"unset"},flexDirection:{base:"column",lg:"row"},children:[a=="active"&&t.jsx(He,{w:{base:"100%",lg:"unset"},isLoading:s,disabled:s,onClick:e,h:"32px",minH:"unset",p:"0px 12px",fontSize:"14px",borderRadius:"8px",variant:"outline",children:(h==null?void 0:h.outBalance)<=0?"Close":"Close and Withdraw"}),t.jsx(He,{w:{base:"100%",lg:"unset"},h:"32px",borderRadius:"8px",minH:"unset",p:"0px 12px",fontSize:"14px",variant:"ghost",rightIcon:t.jsx(Oe,{svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",transform:r?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.5s",ml:"-4px",mr:"-4px"}),onClick:c,children:"Details"})]});function Mt({handleRefresh:a,activeList:s,pastList:e,isOrderLoading:h}){const[c,i]=u.useState([]),[n,p]=u.useState([]),[l,m]=u.useState(0),[x,f]=u.useState(1),{currentAccount:d,onWalletModal:o}=rt(),[S,j]=u.useState({label:"Active DCAs",value:"active"}),T=u.useMemo(()=>[{label:"Active DCAs",value:"active",num:(s==null?void 0:s.length)>0?s==null?void 0:s.length:void 0},{label:"Past DCAs",value:"past",num:(e==null?void 0:e.length)>0?e==null?void 0:e.length:void 0}],[S==null?void 0:S.value,s,e]),H=R=>{f(1),j(R)};u.useEffect(()=>{const R=(S==null?void 0:S.value)==="active"?s:e;i(R),m(R==null?void 0:R.length)},[S==null?void 0:S.value,s,e]),u.useEffect(()=>{const R=(x-1)*10,F=R+10;p(c==null?void 0:c.slice(R,F))},[x,c,S==null?void 0:S.value]);const Y=u.useMemo(()=>(S==null?void 0:S.value)==="past"||(c==null?void 0:c.length)===0?0:c==null?void 0:c.reduce((R,F)=>v(R).plus(F==null?void 0:F.outBalance),v(0)).toString(),[S==null?void 0:S.value,c]),[E,A]=u.useState(!1),[J,ee]=u.useState(!1),{dcaWithdrawPayload:Z}=Xt(),{dcaCloseOrderPayload:L}=Qt(),{signAndExecuteTransaction:te}=ot(),se=async()=>{ee(!0);try{const R=c==null?void 0:c.map(b=>({order_id:b==null?void 0:b.orderID,in_coin_type:b==null?void 0:b.inCoin.coin_type,out_coin_type:b==null?void 0:b.outCoin.coin_type})),F=await L(R);await te(F,{getShowInfo:b=>{const _={modalDescriptionText:"Closing DCA order",toastTitleText:"Closing DCA order"};return b==="success"&&(_.modalDescriptionText="DCA Order Closed",_.toastDescriptionContent="",_.toastTitleText="DCA Order Closed"),_}})&&setTimeout(()=>{a(!0)},2e3),ee(!1)}catch{ee(!1)}},z=async()=>{A(!0);try{const R=c==null?void 0:c.map(b=>({order_id:b==null?void 0:b.orderID,in_coin_type:b==null?void 0:b.inCoin.coin_type,out_coin_type:b==null?void 0:b.outCoin.coin_type})),F=await Z(R);await te(F,{getShowInfo:b=>{const _={modalDescriptionText:"DCA Order Claimed",toastTitleText:"DCA Order Claimed"};return b==="success"&&(_.toastDescriptionContent=""),_}})&&setTimeout(()=>{a(!0)},2e3),A(!1)}catch{A(!1)}},{isApp:C}=lt();return t.jsxs(G,{w:"100%",children:[t.jsxs(N,{w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsxs(N,{w:{base:"100%",lg:"unset"},justify:"space-between",children:[t.jsx(Bt,{type:"borderTab",wrapStyle:{w:{base:"100%",lg:"300px"},h:"52px",gap:"32px",bg:"none",border:"none",mb:"8px"},itemStyle:{fontSize:"16px"},tabList:T,currentTab:S.label,handleChangeTab:H}),C&&t.jsx(kt,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),t.jsxs(N,{w:{base:"100%",lg:"unset"},children:[S.value==="active"&&(c==null?void 0:c.length)>0&&(d==null?void 0:d.address)&&t.jsx(He,{w:{base:"50%",lg:"unset"},h:"28px",minH:"unset",p:"0 10px",fontSize:"14px",borderRadius:"8px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},isLoading:E,disabled:Number(Y)===0||E,onClick:z,leftIcon:t.jsx(Oe,{xlinkHref:"#icon-icon_incentive",svgFill:"primary",mr:"-4px",ml:"-4px"}),children:"Claim all"}),S.value==="active"&&(c==null?void 0:c.length)>0&&(d==null?void 0:d.address)&&t.jsx(He,{w:{base:"50%",lg:"unset"},isLoading:J,disabled:(c==null?void 0:c.length)==0||J,h:"28px",borderRadius:"8px",minH:"unset",p:"0 12px",fontSize:"14px",variant:"outline",color:"primary_gray",_hover:{color:"text_caption"},onClick:se,children:"Close All"}),!C&&t.jsx(kt,{handleRefresh:a,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),d!=null&&d.address?h?t.jsx(Ge,{children:t.jsx(G,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((R,F)=>t.jsx(ia,{},F))})}):(c==null?void 0:c.length)===0?t.jsx(St,{type:"nodata",text:(S==null?void 0:S.value)==="active"?"No active orders":"No closed orders"}):t.jsxs(Ge,{h:(n==null?void 0:n.length)>8?"927px":"unset",overflowY:"auto",p:{base:"12px",lg:"20px 16px"},children:[t.jsx(G,{gap:"16px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"16px",_last:{borderBottom:"none",pb:"0px"}}},children:n==null?void 0:n.map(R=>t.jsx(na,{handleRefresh:()=>a(!0),currentTabVal:S.value,orderInfo:R},R==null?void 0:R.orderID))}),!h&&(c==null?void 0:c.length)>10&&t.jsx(wt,{mt:"28px",children:t.jsx(Lt,{total:l,size:10,currentPage:x,onChange:f})})]}):t.jsx(St,{type:"nowallet",onboard:()=>o(!0)})]})}const ia=()=>t.jsxs(G,{w:"100%",gap:"16px",align:"flex-start",children:[t.jsxs(N,{w:"100%",gap:"0",justify:"space-between",children:[t.jsxs(N,{gap:"0",children:[t.jsxs(N,{gap:"0px",mr:"8px",align:"flex-start",children:[t.jsx(Tt,{size:"8"}),t.jsx(Tt,{size:"8"})]}),t.jsx(ct,{height:"4",width:"100px"})]}),t.jsx(ct,{height:"4",width:"150px"})]}),t.jsx(ct,{height:"4",width:"180px"})]});function ca(){const{fetchByApi:a}=_t(),{peripherySdk:s}=Ye(),{setDcaConfig:e}=he(),h=async()=>await a(Es,"GET")||null,r=async()=>await s.Dca.getDcaGlobalConfig();return{getDcaConfig:async()=>{const i={};try{const n=await h();n&&(i.minCycleAmountInUsd=n==null?void 0:n.min_amount_in_usd)}catch{}try{const n=await r();i.minCycleCount=n==null?void 0:n.min_cycle_count,i.minCycleFrequency=n==null?void 0:n.min_cycle_frequency,i.whitelistMode=n==null?void 0:n.whitelist_mode}catch{}return e(i),i}}}function Jt(){const{fetchByApi:a}=_t(),{setDcaQuote:s}=he();return{getDcaQuote:async({inCoin:h,freq:r,count:c,sender:i})=>{try{const n=await a(zs,"GET",{in_coin:h,freq:r,count:c,sender:i});if(n){const p={amountInLimitPerCycle:n==null?void 0:n.amount_in_limit_per_cycle,coinType:n==null?void 0:n.coin_type,feeRate:n==null?void 0:n.fee_rate,signature:n==null?void 0:n.signature,signer:n==null?void 0:n.signer,timestamp:n==null?void 0:n.timestamp};return s(p),p}}catch{}return null}}}function la(){var tt,ve;const{sellCoin:a,buyCoin:s,setSellCoin:e,setBuyCoin:h,sellAmount:r,buyAmount:c,setBuyAmount:i,setSellAmount:n,dcaConfig:p,setCurrentCoinKey:l,currentCoinKey:m,investNum:x,currentInvest:f,orderNum:d,dcaQuote:o,setInvestNum:S,setOrderNum:j,setCurrentInvest:T,setPageDirect:H,pageDirect:Y,dcaMode:E,sellTotalAmount:A,setSellTotalAmount:J,setLowerPriceSize:ee,setUpperPriceSize:Z}=he(),{currentAccount:L}=rt(),{getDcaConfig:te}=ca(),{getDcaQuote:se}=Jt(),{coinPriceObj:z}=ms(),{fetchTokenPrices:C,getTokenAmountValue:R}=ds(),[F,ie]=u.useState(""),b=u.useRef(F);u.useEffect(()=>{b.current=F},[F]);const _=async()=>{await te()},V=()=>{e(At.clmm_swap.from_coin),h(At.clmm_swap.to_coin)};u.useEffect(()=>(ee("0%"),Z("0%"),V(),_(),()=>{fe()}),[]);const[M,k]=u.useState(""),[O,I]=u.useState(""),{balanceInfo:W}=Ot(a),{balanceInfo:me}=Ot(s),Ne=R(a==null?void 0:a.coin_type,r),Ce=g=>{l("sellCoin"),n(g),w()};u.useEffect(()=>{+r&&+d?E=="total"?J(r):J(v(r).mul(d).toString()):J("")},[r,E,d]);const Me=()=>{const g=Y?a==null?void 0:a.decimals:s==null?void 0:s.decimals;if(H(!Y),M&&O){const X=M,ce=v(1).div(O).toString(),we=v(1).div(X).toString();k(qe(ce,g,!0).toString()),I(qe(we,g,!0).toString())}},de=(g,X=!0)=>{var ce,we,Ue,st;k(""),I(""),X?(((ce=g==null?void 0:g.coin_type)==null?void 0:ce.toLowerCase())===((we=s==null?void 0:s.coin_type)==null?void 0:we.toLowerCase())?be():e(g),l("sellCoin")):(((Ue=g==null?void 0:g.coin_type)==null?void 0:Ue.toLowerCase())===((st=a==null?void 0:a.coin_type)==null?void 0:st.toLowerCase())?be():h(g),l("buyCoin"))},fe=()=>{n(""),k(""),I(""),ie(""),S("1"),j("2"),T("Hour")},be=()=>{e(s),h(a)},et=u.useMemo(()=>{const g=p==null?void 0:p.whitelistMode;return g===3?!0:g===0?!1:m==="sellCoin"?g===1:m==="buyCoin"?g===2:!1},[p==null?void 0:p.whitelistMode]),K=((tt=z[gs(a==null?void 0:a.coin_type).full_address])==null?void 0:tt.price)||0,ae=u.useMemo(()=>A&&d?v(A).div(d).toString():0,[A,d]),je=u.useMemo(()=>A&&d&&K&&v(A).div(d).mul(K).toString()||0,[A,d,K]),ye=v(o==null?void 0:o.feeRate).div(Re.pow(10,6)).mul(100).toString()+"%"||"0%",Q=u.useMemo(()=>{if(o!=null&&o.amountInLimitPerCycle&&(a!=null&&a.decimals))return ht(o==null?void 0:o.amountInLimitPerCycle,a==null?void 0:a.decimals)},[o==null?void 0:o.amountInLimitPerCycle]),Pe=u.useMemo(()=>p!=null&&p.minCycleAmountInUsd&&d&&r&&Q&&Number(ae)<Number(Q)?{status:!0,tips:`Each order size should be higher than $${p==null?void 0:p.minCycleAmountInUsd}.`}:r&&d&&Number(je)>1e4?{status:!0,tips:"Each order size should be less than $10,000"}:{status:!1,tips:""},[E,Q,d,ae,r,je,p==null?void 0:p.minCycleAmountInUsd]),Te=u.useMemo(()=>p!=null&&p.minCycleCount&&d&&Number(d)<Number(p==null?void 0:p.minCycleCount)?{status:!0,tips:`Number of Orders cannot be lower than ${p==null?void 0:p.minCycleCount}.`}:d&&Number(x)<=0?{status:!0,tips:"Please enter an interval above 0"}:d&&x&&Number(x)>1e4?{status:!0,tips:"The maximum interval is 10,000."}:{status:!1,tips:""},[d,p==null?void 0:p.minCycleCount,x]),Ae=u.useMemo(()=>M&&Number(M)==0||O&&Number(O)==0?{status:!0,tips:"Please enter a price greater than 0."}:M&&O&&Number(M)>=Number(O)?{status:!0,tips:"The max price should be higher than min price."}:{status:!1,tips:""},[M,O]),[Le,$e]=u.useState(""),[ke,Ve]=u.useState({status:!1,tips:""}),Ee=()=>{const g=new Date().getTime();let X=0;switch(f){case"Minute":X=Number(x)*60*1e3*(Number(d)-1)+6e4;break;case"Hour":X=Number(x)*60*60*1e3*(Number(d)-1)+6e4;break;case"Day":X=Number(x)*60*60*24*1e3*(Number(d)-1)+6e4;break;case"Week":X=Number(x)*60*60*24*7*1e3*(Number(d)-1)+6e4;break;case"Month":X=Number(x)*60*60*24*30*1e3*(Number(d)-1)+6e4;break}const ce=Je(g+X,"YMDHM");$e(ce),ce=="NaN-NaN-NaN NaN:NaN"&&$e("--"),X>60*60*24*365*1e3?Ve({status:!0,tips:"The maximum execution period is 1 year"}):Ve({status:!1,tips:"The maximum execution period is 1 year"})};u.useEffect(()=>{Ee()},[r,x,d,M,O,f]);const _e=u.useMemo(()=>{let g=0;switch(f){case"Minute":g=Number(x)*60;break;case"Hour":g=Number(x)*60*60;break;case"Day":g=Number(x)*60*60*24;break;case"Week":g=Number(x)*60*60*24*7;break;case"Month":g=Number(x)*60*60*24*30;break}return g},[f,x]);u.useEffect(()=>{a!=null&&a.coin_type&&_e&&d&&Se(a==null?void 0:a.coin_type,_e,d,L==null?void 0:L.address)},[a==null?void 0:a.coin_type,_e,d,L==null?void 0:L.address]);const ze=async(g,X,ce,we)=>{const Ue=we||"0x0000000000000000000000000000000000000000000000000000000000000000";try{return await se({inCoin:g,freq:X,count:ce,sender:Ue})}catch{}},Se=at((g,X,ce,we)=>{ze(g,X,ce,we)},500),{findBestRouters:Ke}=Ls(),[Qe,We]=u.useState(!1),[ge,Xe]=u.useState(void 0),{getTokenRank:y}=Ut();u.useEffect(()=>{q();const g=y(a,s);H(g)},[a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]),u.useEffect(()=>{w()},[ae,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]);const w=()=>{v(ae).gt(0)&&(a!=null&&a.coin_type)&&(s!=null&&s.coin_type)&&(We(!0),D())},D=at(()=>{B()},500),B=async()=>{if(a&&s){const g=`${a.coin_type}_${s.coin_type}`;ie(g);const X=Object.entries(Hs).map(([we,Ue])=>Ue.id),ce=await Ke({fromToken:a,toToken:s,amount:yt(ae||1,a==null?void 0:a.decimals).toFixed(0),providersKeys:X,by_amount_in:!0,uuid:g});g===b.current&&(Xe(ce),i(ce==null?void 0:ce.toAmountUi),We(!1))}},q=()=>{const g=((a==null?void 0:a.coin_type)||(s==null?void 0:s.coin_type))&&Array.from(new Set([a==null?void 0:a.coin_type,s==null?void 0:s.coin_type]));C(g||[])},pe=u.useMemo(()=>{const g={text:"Create DCA Order",disabled:!1};return L!=null&&L.address?!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)?(g.disabled=!0,g.text="Select a token",g):!r||Number(r)==0?(g.disabled=!0,g.text="Enter an amount",g):v(A).gt((W==null?void 0:W.balanceFormat)||0)?(g.disabled=!0,g.text=`Insufficient ${a==null?void 0:a.symbol} balance`,g):v(p==null?void 0:p.minCycleCount).gt(d||0)?(g.disabled=!0,g.text=`Minimum ${p==null?void 0:p.minCycleCount} orders`,g):v(Q).gt(ae||0)?(g.disabled=!0,g.text=`Minimum $${p==null?void 0:p.minCycleAmountInUsd} per order`,g):Pe.status||Te.status||Ae.status||ke.status||!(a!=null&&a.coin_type)||!(s!=null&&s.coin_type)||!d||!x||!M||!O?(g.disabled=!0,g.text="Create DCA Order",g):(ge&&ge.errorCode&&(ge.errorCode===Rt.NoRouter||ge.errorCode===Rt.HoneyPot)&&(g.text="No Available Route",g.disabled=!0),g):(g.text="Connect Wallet",g.disabled=!1,g)},[L==null?void 0:L.address,W,Pe,Te,Ae,ke,a==null?void 0:a.coin_type,s==null?void 0:s.coin_type,A,x,d,M,O,(ve=ge==null?void 0:ge.routes)==null?void 0:ve.length]),re=u.useMemo(()=>{const g=[];return s&&g.push(s),a&&g.push(a),g},[s,a]),ne=u.useMemo(()=>Y&&c&&ae?U(v(c).div(ae).toString(),s==null?void 0:s.decimals,!0):!Y&&c&&ae?U(v(ae).div(c).toString(),a==null?void 0:a.decimals,!0):"",[Y,ae,c]),xt=at(g=>{k(g)},500),P=at(g=>{I(g)},500),oe=g=>{xt(g)},Be=g=>{P(g)};u.useEffect(()=>{xe(M)},[M,ne]),u.useEffect(()=>{ue(O)},[O,ne]);const xe=g=>{if(ne&&g){const X=v(g).div(ne).sub(1).mul(100).toString();ee(v(X).gt(1e4)?">10,000%":`${U(X,1,!1,Re.ROUND_HALF_DOWN)}%`)}},ue=g=>{if(ne&&g){const X=v(g).div(ne).sub(1).mul(100).toString();Z(v(X).gt(1e4)?">10,000%":`${U(X,1,!1,Re.ROUND_HALF_DOWN)}%`)}};return{currentPrice:ne,handleMinInputChange:oe,handleMaxInputChange:Be,warningTokenList:re,resetInputAmount:fe,cycleFrequency:_e,btnStatus:pe,fetchFindAvailableRouterDebounce:w,queryDcaQuote:ze,findRouterLoading:Qe,platformFee:ye,estEndDate:Le,sellPerOrder:ae,isDcaSelect:et,onReverseClick:be,sellBalanceInfo:W,buyBalanceInfo:me,sellAmountValue:Ne,handleAmountChange:Ce,handleSelectToken:de,minPriceValue:M,maxPriceValue:O,handlePageToggleDirect:Me,orderSizeError:Pe,orderInputError:Te,priceError:Ae,orderTimeError:ke}}function ra(){const{peripherySdk:a}=Ye(),{getTokenInfo:s}=Ft(),{setFilterTokenLoading:e}=hs(),{setInCoinWhiteList:h,setOutCoinWhiteList:r}=he();return{getDcaCoinWhiteList:async i=>{var x,f;e(!0);const{inCoinList:n,outCoinList:p}=await a.Dca.getDcaCoinWhiteList(i),l=[],m=[];for(let d=0;d<n.length;d++){const o=await s(n[d]);l.push({...o,labels:((x=o==null?void 0:o.labels)==null?void 0:x.length)>0?o.labels:""})}for(let d=0;d<p.length;d++){const o=await s(p[d]);m.push({...o,labels:((f=o==null?void 0:o.labels)==null?void 0:f.length)>0?o.labels:""})}h(l),r(m),e(!1)}}}function oa(){const{peripherySdk:a}=Ye(),{getDcaQuote:s}=Jt(),e=(c,i,n,p,l,m)=>{const x=v(yt(c,n)).div(i),f=v(x).div(v(l)),d=v(x).div(v(m));let o,S;if(n>p){const j=Re.pow(10,n-p);o=d.div(j).ceil().toString(),S=f.div(j).ceil().toString()}else if(n<p){const j=Re.pow(10,p-n);o=d.mul(j).ceil().toString(),S=f.mul(j).ceil().toString()}else o=d.ceil().toString(),S=f.ceil().toString();return{perCycleMinOutAmount:o,perCycleMaxOutAmount:S,cycleCountAmount:x}},h=(c,i,n,p)=>{const{in_coin:l,in_coin_amount:m,freq:x,cycle_count:f,out_coin:d}=c;return{in_coin_amount:String(yt(m,l.decimals)),in_coin_type:l.coin_type,out_coin_type:d.coin_type,cycle_frequency:x,cycle_count:f,per_cycle_min_out_amount:n,per_cycle_max_out_amount:p,per_cycle_in_amount_limit:i.amountInLimitPerCycle,fee_rate:i.feeRate,timestamp:i.timestamp,signature:i.signature}};return{openDcaOrder:async c=>{const{in_coin:i,out_coin:n,in_coin_amount:p,cycle_count:l,min_price:m,max_price:x,freq:f}=c,d=a.ClmmSDK.senderAddress||"0x0000000000000000000000000000000000000000000000000000000000000000",o=await s({inCoin:i.coin_type,freq:f,count:l,sender:d});if(!o)throw new Error("Request timed out");const{perCycleMinOutAmount:S,perCycleMaxOutAmount:j}=e(p,l,i.decimals,n.decimals,m,x),T=h(c,o,S,j);return await a.Dca.dcaOpenOrderPayload(T)}}}function Zt({detailsData:a,isConfirm:s=!1}){const{sellPerOrder:e,estEndDate:h,platformFee:r,minPriceValue:c,maxPriceValue:i,minPriceResever:n,maxPriceResever:p}=a,{sellCoin:l,buyCoin:m,sellTotalAmount:x,investNum:f,currentInvest:d,pageDirect:o}=he();return t.jsxs(G,{w:"100%",gap:s?"20px":"16px",children:[t.jsx(De,{isLoading:!1,label:"Sell total",value:x?`${U(x,l==null?void 0:l.decimals)} ${l==null?void 0:l.symbol}`:`-- ${l==null?void 0:l.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(De,{isLoading:!1,label:"Sell per order",value:e?`${U(e,l==null?void 0:l.decimals)} ${l==null?void 0:l.symbol}`:`-- ${l==null?void 0:l.symbol}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),!s&&t.jsx(De,{isLoading:!1,label:"Receive",value:t.jsxs(N,{gap:"4px",children:[t.jsx(ys,{imageUrl:m==null?void 0:m.logo_url,w:"20px",h:"20px",coinType:m==null?void 0:m.coin_type,showTagHeight:"10px",showTagWidth:"10px"}),t.jsx($,{color:"text_caption",children:m==null?void 0:m.symbol})]}),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx($,{textAlign:"left",whiteSpace:"nowrap",children:"Price range"}),t.jsx(Vt,{displayTokenA:m,displayTokenB:l,isRank:!0,justify:"flex-end",priceInfo:{minPrice:nt(c).toString(),maxPrice:nt(i).toString(),minPriceResever:nt(n).toString(),maxPriceResever:nt(p).toString()},fontSize:"14px",color:"text_caption"})]}),t.jsx(De,{isLoading:!1,label:"Invest every",value:Number(f)>1?`${f} ${d}s`:`${f} ${d}`,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),s&&t.jsx(De,{isLoading:!1,label:"Start date",value:String(Je(Date.now(),"YMDHM")),labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(De,{isLoading:!1,label:"Est. end date(UTC)",value:h,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}}),t.jsx(De,{isLoading:!1,label:"Platform fee",value:r,labelStyle:{fontSize:"14px"},valueStyle:{fontSize:"14px"},skeletonStyle:{valueW:"128px"}})]})}const ua=({confirmData:a,isOpen:s,onClose:e,toOpenDca:h,toOpenDcaLoading:r})=>{const{sellCoin:c,buyCoin:i}=he();return t.jsxs(Ss,{autoFocus:!1,returnFocusOnClose:!1,isOpen:s,onClose:e,isCentered:!0,children:[t.jsx(vs,{}),t.jsxs(bs,{children:[t.jsx(_s,{children:t.jsx(ws,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),t.jsx(Ds,{}),t.jsx(fs,{textAlign:"center",p:"0px",children:t.jsxs(G,{w:"100%",gap:"16px",p:"16px",children:[t.jsxs(Ge,{borderRadius:"8px",position:"relative",p:"0 12px",children:[t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsxs(G,{align:"flex-start",w:"calc(50% - 24px)",children:[t.jsx($,{children:"Sell"}),t.jsx(Nt,{portal:!1,token:c,haveName:!1,symbolEllipsesDecimals:10})]}),t.jsx(Ht,{w:"1px",h:"100px",bg:"border"}),t.jsxs(G,{align:"flex-end",w:"calc(50% - 24px)",children:[t.jsx($,{children:"Buy"}),t.jsx(Nt,{portal:!1,token:i,haveName:!1,symbolEllipsesDecimals:10})]})]}),t.jsx(wt,{w:"36px",h:"36px",borderRadius:"50%",position:"absolute",left:"calc(50% - 18px)",top:"calc(50% - 18px)",border:"1px solid",borderColor:"border",boxShadow:"trade_icon_shadow",bg:"input_bg",children:t.jsx(Oe,{mt:"-1px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",transform:"rotate(-90deg)"})})]}),t.jsx(Zt,{detailsData:a,isConfirm:!0}),t.jsx(He,{mt:"12px",onClick:()=>{h(),e()},disabled:r,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Create DCA Order"})]})})]})]})};function pa({detailsData:a}){return t.jsx(Ge,{children:t.jsxs(G,{gap:"20px",children:[t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx($,{color:"text_caption",children:"Details"}),t.jsx($,{fontSize:"12px",children:"Your first invest cycle will begin immediately"})]}),t.jsx(Zt,{detailsData:a})]})})}function $t({title:a,label:s,inputValue:e,inputChange:h=()=>{},list:r=[],onListItemClick:c=()=>{}}){const i=n=>{const p=n.target.value.replace(/[^\d]/g,"");h(p)};return t.jsx(qt,{w:"50%",borderRadius:"16px",children:t.jsxs(G,{gap:"16px",align:"flex-start",children:[typeof a=="string"?t.jsx($,{fontWeight:"500",lineHeight:"18px",fontSize:"13px",children:a}):a,t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx(js,{value:e,onChange:i,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),r.length>0?t.jsx(Rs,{label:s,list:r,onListItemClick:c}):t.jsx($,{color:"text_caption",children:s})]})]})})}function Et({direct:a,text:s,align:e,inputValue:h,inputChange:r=()=>{}}){const{sellCoin:c,buyCoin:i}=he();return t.jsx(qt,{w:"unset",borderRadius:"8px",children:t.jsx(N,{children:t.jsxs(G,{align:e,children:[t.jsx(Ps,{value:h,placeholder:"0.0",decimals:18,onChange:n=>r(n),style:{width:"calc(100% - 8px)",textAlign:e=="flex-start"?"left":"right",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",fontWeight:"500",touchAction:"manipulation",transition:"all 0.3s"}}),t.jsxs(N,{w:"100%",justify:"space-between",children:[t.jsx($,{fontSize:"12px",fontWeight:"500",children:a?`${i==null?void 0:i.symbol} per ${c==null?void 0:c.symbol}`:`${c==null?void 0:c.symbol} per ${i==null?void 0:i.symbol}`}),s&&t.jsx($,{fontSize:"12px",fontWeight:"500",children:s})]})]})})})}function xa({handleGetDcaOrderList:a}){const{sellCoin:s,buyCoin:e,sellAmount:h,buyAmount:r,setInvestNum:c,setOrderNum:i,investNum:n,orderNum:p,currentInvest:l,setCurrentInvest:m,pageDirect:x,isDcaRefresh:f,dcaMode:d,setDcaMode:o,sellTotalAmount:S,upperPriceSize:j,lowerPriceSize:T,setLowerPriceSize:H,setUpperPriceSize:Y}=he(),{currentPrice:E,btnStatus:A,findRouterLoading:J,sellBalanceInfo:ee,buyBalanceInfo:Z,sellAmountValue:L,handleAmountChange:te,handleSelectToken:se,minPriceValue:z,maxPriceValue:C,handleMinInputChange:R,handleMaxInputChange:F,handlePageToggleDirect:ie,onReverseClick:b,orderSizeError:_,orderInputError:V,orderTimeError:M,priceError:k,sellPerOrder:O,estEndDate:I,platformFee:W,fetchFindAvailableRouterDebounce:me,cycleFrequency:Ne,resetInputAmount:Ce,warningTokenList:Me}=la();u.useEffect(()=>{f&&me()},[f]);const{currentAccount:de,onWalletModal:fe}=rt(),[be,et]=u.useState("#icon-a-icon_trade"),K=["Minute","Hour","Day","Week","Month"],ae=P=>et(P?"#icon-icon_swap1":"#icon-a-icon_trade"),{openDcaOrder:je}=oa(),[ye,Q]=u.useState(!1),{fetchCoinBalance:Pe}=Dt(),{signAndExecuteTransaction:Te,transactionRejected:Ae,transactionConfirmation:Le}=ot(),{failedTsToast:$e}=Ts(),{showInsufficientBalanceToast:ke}=Bs(),Ve=async()=>{Q(!0);const P={getShowInfo:xe=>{`${U(S)}${s==null?void 0:s.symbol}${e==null?void 0:e.symbol}${p}`;const ue={modalDescriptionText:"Creating DCA Order",toastTitleText:"Creating DCA Order"};return xe==="success"&&(ue.modalDescriptionText="DCA Order Created",ue.toastDescriptionContent="",ue.toastTitleText="DCA Order Created"),ue}};Le(P);const oe=x?v(1).div(C).toString():z,Be=x?v(1).div(z).toString():C;try{const ue=await je({in_coin:s,out_coin:e,in_coin_amount:S,cycle_count:p,min_price:oe,max_price:Be,freq:Ne});await Te(ue,P)&&(Ce(),setTimeout(()=>{Pe(de==null?void 0:de.address,s==null?void 0:s.coin_type),a(de==null?void 0:de.address)},2e3)),Q(!1)}catch(xe){const ue={getShowInfo:tt=>{const ve={};return String(xe)==="Error: Each order size should be higher than $10"&&(ve.toastTitleText="Transaction Submission Error",ve.toastDescriptionContent="Each order size should be higher than $10."),String(xe)==="Error: Request timed out"&&(ve.toastTitleText="Request timed out",ve.toastDescriptionContent="Please confirm the network status and resubmit the transaction."),String(xe)==="Error: minPrice error"&&(ve.toastTitleText="DCA order submission failed",ve.toastDescriptionContent="Your nominated prices are out of scope. Please modify your accepted price range and submit it again."),ve}};console.error("Open DCA Order Error: ",xe),ke(String(xe)),Ae(ue),$e(ue),Q(!1)}},{currentCoinKey:Ee,inCoinWhiteList:_e,outCoinWhiteList:ze,dcaConfig:Se}=he(),{getDcaCoinWhiteList:Ke}=ra(),[Qe,We]=u.useState([]);u.useEffect(()=>{Ee=="sellCoin"?We(_e):We(ze)},[Ee,_e,ze]),u.useEffect(()=>{Se&&Se.whitelistMode&&Ke(Se.whitelistMode)},[Se==null?void 0:Se.whitelistMode]);const[ge,Xe]=u.useState(!1),y=u.useMemo(()=>{const P=x?e==null?void 0:e.decimals:s==null?void 0:s.decimals;let oe="",Be="",xe="",ue="";return z&&C&&(oe=x?qe(v(1).div(C).toString(),P,!0).toString():z,Be=x?qe(v(1).div(z).toString(),P,!0).toString():C,xe=x?z:qe(v(1).div(C).toString(),P,!0).toString(),ue=x?C:qe(v(1).div(z).toString(),P,!0).toString()),{estEndDate:I,sellPerOrder:O,platformFee:W,minPriceValue:oe,maxPriceValue:Be,minPriceResever:xe,maxPriceResever:ue}},[x,I,O,W,z,C]),w=[{label:"Total",value:"total"},{label:"Per Order",value:"perOrder"}],[D,B]=u.useState([0,0]),[q,pe]=u.useState(0),[re,ne]=u.useState(0),xt=P=>{B(P),R(P[0].toString()),F(P[1].toString())};return u.useEffect(()=>{if(z&&C){const P=Number(z),oe=Number(C);B([P,oe])}z||H("0%"),C||Y("0%")},[z,C]),u.useEffect(()=>{if(E){const P=v("-100").div(100).plus(1).mul(E).toNumber(),oe=v("100").div(100).plus(1).mul(E).toNumber();pe(P),ne(oe)}},[E]),t.jsxs(G,{w:"100%",children:[t.jsx(qs,{onClick:b,currentCoinKey:Ee,whiteTokenList:Qe,from:{inputTabOptions:{type:"outlineTab",tabList:w,currentTab:d=="total"?"Total":"Per Order",handleChangeTab:P=>{o(P==null?void 0:P.value)},wrapStyle:{w:"168px",h:"28px",p:"3px",borderRadius:"10px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px",borderRadius:"6px"}},title:"You Pay",balance:(ee==null?void 0:ee.balanceFormat)||"",value:h,amountValue:L,loading:!1,onChange:te,selectable:!0,placeholder:"0.0",token:s,onTokenChange:P=>se(P,!0)},to:{isDcaTo:!0,wrapStyle:{backgroundColor:"bg_secondary",h:"94px"},title:"You Receive",inputAllowed:!1,balance:(Z==null?void 0:Z.balanceFormat)||"",value:"",amountValue:"",loading:!1,onChange:()=>{},token:e,onTokenChange:P=>se(P,!1),selectable:!0,placeholder:"",half:!1,max:!1},iconParams:{xlinkHref:be,svgFill:"text_caption",transform:be==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:be==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>ae(!0),onMouseLeave:()=>ae(!1)}}),(_==null?void 0:_.status)&&t.jsx(it,{tips:_==null?void 0:_.tips}),t.jsxs(N,{w:"100%",children:[t.jsx($t,{title:"Invest Every",label:l,inputValue:n,list:K,onListItemClick:P=>{m(P)},inputChange:P=>{c(P)}}),t.jsx($t,{title:t.jsx(Fs,{type:"over",children:t.jsx($,{fontSize:"13px",fontWeight:"500",mr:"4px",children:"Over"})}),label:"Orders",inputValue:p,inputChange:P=>{i(P),me()}})]}),(V==null?void 0:V.status)&&t.jsx(it,{tips:V==null?void 0:V.tips}),(M==null?void 0:M.status)&&t.jsx(it,{tips:M==null?void 0:M.tips}),t.jsxs(Ge,{zIndex:"1",p:"16px",borderRadius:"16px",children:[t.jsxs(G,{align:"flex-start",children:[t.jsx($,{color:"text_caption",children:"Set Price Range"}),t.jsx($,{lineHeight:"16px",fontSize:"12px",m:{base:"4px 0",lg:"0"},mb:{base:h?"4px":"0"},children:"DCA will only be executed if the price falls within the range of your pricing strategy."}),h&&O&&t.jsxs(N,{mt:"8px",w:"100%",justify:"space-between",flexDirection:{base:"column",lg:"row"},align:{base:"align",lg:"center"},children:[t.jsx($,{children:"Current Rate"}),t.jsx(G,{align:{base:"flex-start",lg:"flex-end"},children:t.jsx(Us,{color:"text_caption",pageDirect:x,handlePageToggleDirect:ie,fromToken:s,toToken:e,fromValue:O,toValue:r,isLoading:J||!r||!O})})]})]}),t.jsxs(N,{justify:"space-between",gap:"8px",mt:"20px",children:[t.jsx(Et,{direct:x,text:h&&z?T:"",inputValue:z,inputChange:P=>R(P),align:"flex-start"}),t.jsx($,{color:"text_caption",children:"-"}),t.jsx(Et,{direct:x,text:h&&C?j:"",inputValue:C,inputChange:P=>F(P),align:"flex-start"})]}),!J&&h&&z&&C&&Number(C)>=Number(z)&&(A==null?void 0:A.text)!=="No Available Route"&&t.jsxs(G,{w:"100%",gap:"0",mt:"20px",children:[t.jsxs(Gt,{min:q,max:re,step:.1,value:D,onChange:P=>{xt(P)},colorScheme:"teal",children:[t.jsx(Yt,{children:t.jsx(Kt,{})}),t.jsx(vt,{index:0}),t.jsx(vt,{index:1})]}),t.jsx(As,{src:Vs,w:"32px",h:"32px"}),t.jsx(N,{w:"100%",h:"14px",justify:"center",mt:"-2px",children:t.jsx($,{children:"Current Rate"})})]})]}),(k==null?void 0:k.status)&&t.jsx(it,{tips:k==null?void 0:k.tips}),t.jsx(He,{isLoading:ye,disabled:(A==null?void 0:A.disabled)||ye,w:"100%",h:"52px",fontSize:"18px",fontWeight:"500",onClick:(A==null?void 0:A.text)=="Connect Wallet"?()=>fe(!0):()=>Xe(!0),children:A==null?void 0:A.text}),h&&t.jsx(pa,{detailsData:y}),ge&&t.jsx(ua,{confirmData:y,isOpen:ge,onClose:()=>Xe(!1),toOpenDca:Ve,toOpenDcaLoading:ye}),(e||s)&&t.jsx(Gs,{addToken:!0,tokensInfo:Me,waringModalCancel:P=>{P.forEach(oe=>{(oe.coin_type===(e==null?void 0:e.coin_type)||oe.coin_type===(s==null?void 0:s.coin_type))&&se(void 0,oe.coin_type===(e==null?void 0:e.coin_type))})}})]})}const it=({tips:a})=>t.jsxs(N,{w:"100%",bg:"primary_red_bg",p:"12px",borderRadius:"12px",children:[t.jsx(Oe,{svgW:"16px",svgH:"16px",variant:"error",xlinkHref:"#icon-icon-warning",cursor:"text"}),t.jsx($,{color:"primary_red",lineHeight:"20px",children:a})]});function ma(a){const i=Math.floor(a/2592e3);a%=2592e3;const n=Math.floor(a/604800);a%=604800;const p=Math.floor(a/86400);a%=86400;const l=Math.floor(a/3600);a%=3600;const m=Math.floor(a/60);a%=60;const x=[];return i>0&&x.push(`${i} Month${i>1?"s":""}`),n>0&&x.push(`${n} Week${n>1?"s":""}`),p>0&&x.push(`${p} Day${p>1?"s":""}`),l>0&&x.push(`${l} Hour${l>1?"s":""}`),m>0&&x.push(`${m} Minute${m>1?"s":""}`),x.join(" ")}function da(){const{getTokenInfo:a}=Ft(),{peripherySdk:s}=Ye(),e=async l=>{try{const m=await s.Dca.getDcaOrders(l);return await p(m==null?void 0:m.data)}catch{}},h=async l=>{const m=await a(l),x=Re.pow(10,m==null?void 0:m.decimals);return{token:m,decimalsPow:x}},r=(l,m,x,f,d)=>{const o=v(l).div(m).div(v(f).div(x)).toString(),S=v(l).div(m).div(v(d).div(x)).toString();return{minPrice:o,maxPrice:S,minPriceResever:v(1).div(v(S)).toString(),maxPriceResever:v(1).div(v(o)).toString()}},c=l=>l.in_withdrawn>0&&l.in_withdrawn==l.in_deposited?"Close":l.in_withdrawn>0&&l.out_withdrawn>0?"PartialDeal":l.amount_left_next_cycle==0&&l.next_cycle_at==0?"AllDeal":"Active",i=(l,m,x,f,d,o,S)=>{const j=T=>T==="--"?"--":v(1).div(T).toString();switch(l){case"Close":return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"};case"PartialDeal":{const T=m.sub(x).div(o).toString(),H=m.sub(x).div(m).mul(100).toDP(2,Re.ROUND_HALF_UP).toString();return{currentAvgPrice:T,currentAvgPriceResever:j(T),inBalanceRatio:H,inDepositedOut:m.sub(x).toString()}}case"AllDeal":{const T=m.div(o).toString();return{currentAvgPrice:T,currentAvgPriceResever:j(T),inBalanceRatio:"100",inDepositedOut:m.sub(f).toString()}}case"Active":{const T=d.gt(0)||o.gt(0)?m.sub(f).div(d.add(o)).toString():"--",H=m.sub(f).div(m).mul(100).toDP(2,Re.ROUND_HALF_UP).toString();return{currentAvgPrice:T,currentAvgPriceResever:j(T),inBalanceRatio:H,inDepositedOut:m.sub(f).toString()}}default:return{currentAvgPrice:"--",currentAvgPriceResever:"--",inBalanceRatio:"0",inDepositedOut:"0"}}},n=(l,m,x,f)=>{const d=Date.now()/1e3,o=v(d).sub(l).div(m),S=x.lte(0)&&v(f).lte(0);return o.gt(3)&&S},p=async l=>{const m=[],x=[];for(const o of l){const{token:S,decimalsPow:j}=await h(o.in_coin_type),{token:T,decimalsPow:H}=await h(o.out_coin_type),Y=v(o.in_deposited).div(j),E=v(o.in_deposited).div(o.in_amount_per_cycle).floor().toString(),A=v(o.in_amount_per_cycle).div(j).toString(),J=v(o.in_balance).div(j),ee=v(o.in_withdrawn).div(j),Z=v(o.out_balance).gt(0)?v(o.out_balance).div(H):v(0),L=v(o.out_withdrawn).div(H),te=U(Y.div(E).toString()),se=J.div(A).floor().toNumber(),{minPrice:z,maxPrice:C,minPriceResever:R,maxPriceResever:F}=r(o.in_amount_per_cycle,j,H,o.max_out_amount_per_cycle,o.min_out_amount_per_cycle),ie=c(o),{currentAvgPrice:b,currentAvgPriceResever:_,inBalanceRatio:V,inDepositedOut:M}=i(ie,Y,ee,J,Z,L),k=n(o.created_at,o.cycle_frequency,Z,L),O={createAt:Je(o.created_at*1e3,"YMDHM"),cycleFrequency:o.cycle_frequency,orderID:o.id,inAmountPerCycle:A,nextCycleAt:Je(o.next_cycle_at*1e3,"YMDHM"),inDeposited:Y.toString(),cycleCount:E,inDepositedOut:M,inBalance:J.toString(),minPrice:U(z),maxPrice:U(C),minPriceResever:U(R),maxPriceResever:U(F),inCoin:S,outCoin:T,outBalance:Z.toString(),inBalanceRatio:V,outWithdraw:L.toString(),investEvery:ma(o.cycle_frequency),eachOrderSize:te,currentAvgPrice:b==="--"?"--":U(b,T.decimals),currentAvgPriceResever:b==="--"?"--":U(_,S.decimals),orderStatus:ie,inWithdrawn:ee.toString(),ofOrderLeft:se,isShowTradeTips:k,next_cycle_at:o.created_at+se*o.cycle_frequency,created_at:o.created_at,version:o.version};ie==="Active"?m.push(O):x.push(O)}const f=m==null?void 0:m.sort((o,S)=>S.version-o.version),d=x==null?void 0:x.sort((o,S)=>S.version-o.version);return{activeResult:f,pastResult:d}};return{getDcaOrderList:e}}function Xa(){const[a,s]=u.useState([]),[e,h]=u.useState([]),{currentAccount:r}=rt(),{sellCoin:c,buyCoin:i,setIsDcaRefresh:n}=he(),[p,l]=u.useState(!0),{isShowTradeChart:m,isShowTradeOrders:x}=Ys(),{getDcaOrderList:f}=da(),{fetchAccountBalance:d}=Dt(),o=async(E,A=!1)=>{if(!x)return;A&&l(!0);const{activeResult:J,pastResult:ee}=await f(E);s(J),h(ee),l(!1)};u.useEffect(()=>{r!=null&&r.address?o(r==null?void 0:r.address,!0):(s([]),h([]))},[r==null?void 0:r.address,x]);const S=(E=!0)=>{Y(0),n(!0),setTimeout(()=>{n(!1)},1e3),r!=null&&r.address&&(E||d(),o(r==null?void 0:r.address,E))};Ks({onRpcChange:()=>{S()}}),u.useEffect(()=>{r!=null&&r.address&&d()},[r==null?void 0:r.address]);const{isApp:j,windowWidth:T}=lt(),[H,Y]=u.useState(0);return ks({interval:1e3,callback:()=>{Y(H+1),H>=20&&S(!1)}}),t.jsxs(N,{mt:T&&T<1024?"28px":"42px",className:j||m||x?"":"bg_img",w:"100%",gap:"16px",justify:"center",align:"flex-start",flexDirection:{base:"column",lg:"row"},children:[(x||m)&&t.jsxs(G,{w:{base:"100%",lg:"calc(100% - 470px)"},mt:j&&!m?"-16px":"0",children:[m&&t.jsx(Ns,{baseToken:c,quoteToken:i}),x&&!j&&t.jsx(Mt,{handleRefresh:S,activeList:a,pastList:e,isOrderLoading:p})]}),t.jsxs(G,{w:{base:"100%",lg:"470px"},children:[t.jsxs(N,{w:"100%",justify:"space-between",mb:"8px",children:[t.jsx(Cs,{currTradeTab:Ms.DCA}),t.jsx(Os,{})]}),t.jsx(xa,{handleGetDcaOrderList:E=>o(E)})]}),j&&x&&t.jsx(G,{w:{base:"100%",lg:"calc(100% - 470px)"},children:t.jsx(Mt,{handleRefresh:S,activeList:a,pastList:e,isOrderLoading:p})})]})}export{Xa as default};
