import{a as x,j as i,a7 as He,T as b,V as q,H as c,u as le,am as Ci,v as Ne,R as vi,f as ze,ab as _i,az as Ri}from"./vendor-DYqnJE5Q.js";import{A as Li}from"./index-rlvi-7_T.js";import{C as Fi}from"./CoinPairInfo-DxzxlP2G.js";import{S as Mi}from"./Slippage-_d8xq0BF.js";import{u as Ei,L as Di,S as Le}from"./LiquidityRangeChart-Cecxkn-I.js";import{u as ai,a as Wi}from"./useTransaction-B0xyNeQf.js";import{u as Vi,a as Hi,P as Ni}from"./PositionCurrentPrice-xFAU-VIX.js";import{a as we,b as Ge}from"./useNotifiSubscription-D5CEF9OP.js";import{c as zi,d as Gi,a as ce,u as pi}from"./usePositionList-DKv7WJr0.js";import{k as Me,r as se,a as Ze,B as pe,S as Be,O as Te,H as di,d as ae,b as oi,m as Ue,o as Zi,U as Ui,i as Ie,W as Oi,D as qi,X as Pe,R as Yi,Q as $i,V as Qi,a2 as Xi,j as Ji,q as ei,c as Ki}from"./index-WWPS4_2e.js";import{u as Oe}from"./useAccountBalance-Bh-NvyHs.js";import{S as fi,A as Bi}from"./SingleTokenInfo-BmePh6gD.js";import{L as Ii}from"./PriceRange-Bhwm_iq4.js";import{b as Pi,c as el,a as xi,f as il,Z as ll,R as sl,g as tl}from"./ZapSwitch-CozVPddg.js";import{u as al,T as pl,F as dl,R as ol}from"./RemoveBlock-BAVNFfAZ.js";import{u as xl}from"./global-Bo5w7aOL.js";import{f as Fe}from"./index-BQdM0Oaf.js";import{u as ii}from"./useTokenBalance-L-7JdNBo.js";import{u as nl}from"./useInsufficientBalanceToast-B4q0gxFb.js";import{u as ml}from"./usePosAdd-yKPgI-5c.js";import{v as li}from"./v4-C6aID195.js";import{T as cl}from"./TradeInputGroup-BIsIP9JC.js";import{T as gl}from"./TooltipIcon-BfDJpR5R.js";import{P as rl}from"./PositionStatus-O7YT_I-Q.js";import{R as bl}from"./RangeValue-C3CNy31o.js";import{u as hl}from"./index-CPkN-tGW.js";import{b as jl,u as yl}from"./useGetPoolList-CMRSGTVw.js";import{u as Tl}from"./swapWidget-CTmuvVSU.js";import{B as wl}from"./BackButton-kuRg3FJq.js";import{R as si}from"./RefreshButton-wIjLAatj.js";import{u as kl}from"./useRpcListener-BZmBHZRe.js";import"./PoweredByHaedal-COe4fDWI.js";import"./HTextLabelBox-CabGGlmQ.js";import"./VTextLabelBox-LQjO6gSH.js";import"./linear-DYpwdEgO.js";import"./liquidity-BBVqpKX5.js";import"./usePreviousValue-COG3o_Rs.js";import"./ActionButton-skuk0GyZ.js";import"./useSigner-rKW8msZz.js";import"./useBurn-DyUQgl6j.js";import"./msafe-oYBkW7LJ.js";import"./useNotifiAlerts-Cdv2amid.js";import"./useXCetusHelper-CpXBHf3W.js";import"./useToken-DKo5fk0k.js";import"./useFavoritePool-CnJfzn94.js";import"./useWrapPoolData-C8NJOF2n.js";import"./CopyButton-D1sHEEd7.js";import"./DepositRatio-BfBjRHwn.js";import"./FreshProgressV2-NKYDd-xy.js";import"./usePriceImpact-Dn-go9TS.js";import"./useSwapHelper-C0YC34Fy.js";import"./ErrorTips-DJn2WIrX.js";import"./ExpendItem-D8nrSWF5.js";import"./_getAllKeysIn-DOxZoQuX.js";function Al(){var J,R,U,z,ge,re;const{tokenAmountAfterA:e,tokenAmountAfterB:o,currentPosDetailTab:d,curPosContractPoolInfo:a}=we(),{getPosFeeData:W}=zi(),{getPosRewardsData:m}=Gi(),{currentAccount:t}=Me(),{currentPosBaseInfo:s,posFeeData:S,posRewardsData:h,posLiquidityData:A,currentPosBaseInfoLoading:V,posFeeDataLoading:E,posRewardsDataLoading:D}=ce();Ge();const l=x.useMemo(()=>A[s==null?void 0:s.posId],[A,s==null?void 0:s.posId]),v=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosFeeData ~ posFeeData[currentPosBaseInfo?.posId as string]:",S[s==null?void 0:s.posId]),S[s==null?void 0:s.posId]),[S,s==null?void 0:s.posId]),L=x.useMemo(()=>(console.log("ðŸš€ ~ currentPosRewardsData ~ posRewardsData[currentPosBaseInfo?.posId as string]:",h[s==null?void 0:s.posId]),h[s==null?void 0:s.posId]),[h,s==null?void 0:s.posId]);se(l==null?void 0:l.displayCoinAmountA,void 0,!0),se(l==null?void 0:l.displayCoinAmountB,void 0,!0);const[C,_]=x.useState(!1),[H,j]=x.useState("--"),{signAndExecuteTransaction:F}=ai(),{getPosClaimFeeAndRewardTxPayload:N}=Vi(),{calculatePendingYield:u}=Hi();x.useEffect(()=>{if(!V&&!E&&!D){const{total:y}=u([s],S,h);j(y)}},[V,E,D]);const{fetchAccountBalance:Z}=Oe(),Q=async()=>{_(!0);try{const y=(L==null?void 0:L.map(G=>G.coin_address))||[],K={posType:s==null?void 0:s.posType,id:s==null?void 0:s.id,clmmPool:s==null?void 0:s.clmmPool,coinTypeA:s==null?void 0:s.coinTypeA,coinTypeB:s==null?void 0:s.coinTypeB,rewarderCoinTypes:y,account:t==null?void 0:t.address};console.log("ðŸš€ ~ toClaim ~ params.currentPosBaseInfo:",K,s);const{tx:T,msafeParams:n}=await N(K);console.log("ðŸš€ ~ toClaim ~ tx:",T);const k=await F(T,{getShowInfo:G=>{const O={modalDescriptionText:"",toastTitleText:""};return G==="success"&&(O.toastTitleText="Claim Successful"),O}},{msafeParams:n});console.log("ðŸš€ ~ toClaim ~ res:",k),k&&setTimeout(()=>{Z(),W([s]),m([s],{[a.poolAddress]:a})},2e3),_(!1)}catch(y){_(!1),console.log("ðŸš€ ~ toClaim ~ error:",y)}},X=e!==""||o!=="",{isApp:w}=Ze();return i.jsxs(pe,{w:"100%",borderRadius:"16px",p:"0",children:[i.jsx(pe,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"auto",lg:"80px"},p:{base:"20px 8px",lg:"20px 20px"},children:i.jsxs(He,{flexDir:{base:"column",lg:"row"},w:"100%",justify:{base:"center",lg:"space-between"},gap:{base:"16px",lg:"0"},children:[i.jsxs(He,{flexDir:{base:"row",lg:"column"},align:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},mt:{base:"-12px",lg:"0"},children:[i.jsx(b,{color:"primary_gray",mb:{base:"0",lg:"-12px"},children:"Liquidity"}),i.jsx(Ii,{positionInfo:s,haveTooltip:!1})]}),i.jsxs(q,{minW:"200px",align:{base:"center",lg:"flex-end"},pb:{base:"0",lg:"12px"},gap:"12px",children:[i.jsxs(c,{w:"100%",justify:{base:"center",lg:"space-between"},children:[i.jsxs(c,{gap:"4px",children:[i.jsx(Be,{imageUrl:(J=s==null?void 0:s.displayTokenA)==null?void 0:J.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(R=s==null?void 0:s.displayTokenA)==null?void 0:R.coin_type:""}),i.jsx(le,{isLoaded:!!s&&!!l,children:i.jsxs(c,{gap:"4px",children:[i.jsx(b,{color:"primary",children:Te((U=s==null?void 0:s.displayTokenA)==null?void 0:U.symbol)}),i.jsxs(b,{color:"primary",children:[l==null?void 0:l.displayPercentA,"%"]})]})})]}),i.jsxs(c,{gap:"4px",children:[i.jsx(Be,{imageUrl:(z=s==null?void 0:s.displayTokenB)==null?void 0:z.logo_url,w:"20px",h:"20px",showTagWidth:"10px",showTagHeight:"10px",coinType:s?(ge=s==null?void 0:s.displayTokenB)==null?void 0:ge.coin_type:""}),i.jsx(le,{isLoaded:!!s&&!!l,children:i.jsxs(c,{gap:"4px",children:[i.jsx(b,{color:"primary_green",children:Te((re=s==null?void 0:s.displayTokenB)==null?void 0:re.symbol)}),i.jsxs(b,{color:"primary_green",children:[l==null?void 0:l.displayPercentB,"%"]})]})})]})]}),i.jsx(Ci,{w:"200px",h:"4px",value:l==null?void 0:l.displayPercentA,bg:"quote_green",sx:{'div[role="progressbar"]':{bg:"primary"}}})]})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},p:{base:"20px 8px",lg:"40px 8px"},w:"100%",justify:"space-around",flexDirection:{base:"column",lg:"row"},children:[i.jsx(ye,{label:"Base",token:s==null?void 0:s.displayTokenA,amount:l==null?void 0:l.displayCoinAmountA,afterAmount:e}),i.jsx(ye,{label:"Quote",token:s==null?void 0:s.displayTokenB,amount:l==null?void 0:l.displayCoinAmountB,afterAmount:o})]}),i.jsx(pe,{w:"calc(100% + 2px)",ml:"-1px",mt:"-1px",bg:"bg_six",borderRadius:"16px",h:{base:"70px",lg:"80px"},p:{base:"20px 8px",lg:"20px"},children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsxs(He,{flexDir:{base:"row",lg:"column"},alignItems:{base:"center",lg:"flex-start"},justify:{base:"space-between",lg:"center"},w:{base:"100%",lg:"auto"},children:[i.jsx(b,{color:"primary_gray",children:"Pending Yield"}),i.jsx(le,{isLoaded:!!H&&!!s&&!!S&&!!h,children:i.jsx(b,{color:"text_caption",fontSize:"16px",children:di(H,2)})})]}),i.jsx(Ne,{isLoading:C,disabled:Number(H)==0||E||D||C||!v,onClick:Q,w:"112px",h:"28px",borderRadius:"8px",fontWeight:"500",fontSize:"14px",children:"Claim"})]})}),i.jsxs(c,{p:{base:"20px 8px 0",lg:"40px 8px 20px"},w:"100%",justify:"space-between",flexWrap:"wrap",sx:{">div":{mb:{base:"12px",lg:"20px"}}},flexDirection:{base:"column",lg:"row"},children:[i.jsx(ye,{label:"Fees",token:s==null?void 0:s.displayTokenA,amount:v==null?void 0:v.displayFeeOwedA,afterAmount:X?"0":""}),i.jsx(ye,{label:w?"":"Fees",token:s==null?void 0:s.displayTokenB,amount:v==null?void 0:v.displayFeeOwedB,afterAmount:X?"0":""}),L==null?void 0:L.map((y,K)=>i.jsx(vi.Fragment,{children:ae(y.amount_owed).gt(0)&&i.jsx(ye,{label:w?K==0?"Mining Rewards":"":"Mining Rewards",token:y==null?void 0:y.token,amount:y==null?void 0:y.display_amount_owed,afterAmount:X?"0":""})},y==null?void 0:y.coin_address))]})]})}const ye=({label:e,token:o,amount:d,afterAmount:a,isLoading:W})=>{const{isApp:m}=Ze(),{getExplorerUrl:t}=oi();return i.jsxs(q,{align:{base:"flex-end",lg:"center"},gap:{base:"4px",lg:"8px"},w:{base:"100%",lg:"calc(50% - 4px)"},children:[i.jsxs(c,{w:"100%",justify:{base:"space-between"},flexDirection:{base:"row",lg:"column"},children:[i.jsx(b,{color:"primary_gray",children:e}),i.jsxs(c,{children:[i.jsx(ze,{onClick:m?()=>window.open(t(o==null?void 0:o.coin_type,"coin")):()=>{},children:i.jsx(fi,{haveTooltip:!m,coinType:o?o==null?void 0:o.coin_type:"",haveName:!1,haveSymbol:!1,warningIcon:{iconW:"14px",iconH:"14px"},imgBoxStyle:{w:"28px",h:"28px"}})}),i.jsx(le,{isLoaded:!W&&!!d,children:i.jsx(b,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:se(d)})}),i.jsx(b,{color:"text_caption",fontSize:{base:"14px",lg:"16px"},children:Te(o==null?void 0:o.symbol)})]})]}),a!==""&&a&&i.jsxs(c,{bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(b,{color:"primary",children:se(a)}),i.jsx(b,{color:"primary",children:"after"})]})]})};function ul(){const{currentPosBaseInfo:e,posPoolsOriginalData:o,posPoolsRelatedData:d,posRewardsData:a,posLiquidityData:W}=ce(),m=a[e==null?void 0:e.posId],{getTokenAmountValue:t}=Ue(),{transactionConfirmation:s}=Wi(),{preAdd:S,getAddTsPayload:h,getClmmCreateAddData:A,getFarmsCreateAddData:V}=ml(),{getTokenALock:E,getTokenBLock:D}=pi(),{getCurrentPosBaseInfo:l}=Ge(),{setTokenAmountAfterA:v,setTokenAmountAfterB:L,currentPoolSqrtPrice:C,isFixedDisplayTokenA:_,setIsFixedDisplayTokenA:H,curPosContractPoolInfo:j,currentPosDetailTab:F,isPosDetailRefresh:N,useZapIn:u}=we(),{getZapDepositToastInfo:Z,getZapDepositTx:Q,reCalculateZapData:X}=Pi(),{preDepositeData:w,setZapAmount:J,setPreDepositeData:R}=el(),[U,z]=x.useState(!1),[ge,re]=x.useState(""),[y,K]=x.useState(""),[T,n]=x.useState(""),[k,G]=x.useState(""),O=x.useMemo(()=>W[e==null?void 0:e.posId],[W,e==null?void 0:e.posId]),ke=se(O==null?void 0:O.displayCoinAmountA,void 0,!0),Ae=se(O==null?void 0:O.displayCoinAmountB,void 0,!0);x.useEffect(()=>{if(+T||+k){const p=+T,g=+k;v(ae(p).plus(ke).toString()),L(ae(g).plus(Ae).toString())}else v(""),L("")},[T,k]);const r=e==null?void 0:e.displayTokenA,M=e==null?void 0:e.displayTokenB,{mevProtect:ni,maxCapForGas:mi,transactionMode:ci,customGasPrice:gi}=xl(),{balanceInfo:be}=ii(r),{balanceInfo:he}=ii(M),ri=t(r==null?void 0:r.coin_type,T),bi=t(M==null?void 0:M.coin_type,k),[Ee,De]=x.useState(""),qe=x.useRef("");x.useEffect(()=>{console.log("ðŸš€ ~ usePosAddPage ~ uuid:",Ee),qe.current=Ee},[Ee]);const ue=()=>{n(""),G(""),z(!1),De("")},Se=x.useMemo(()=>E(e,j),[j==null?void 0:j.current_tick_index,e]),Ce=x.useMemo(()=>D(e,j),[j==null?void 0:j.current_tick_index,e]),Ye=e!=null&&e.isReverse?Ce:Se,$e=e!=null&&e.isReverse?Se:Ce,Qe=Zi((p,g,Y)=>{var me,B;if(F!=="increase")return;const $=g?(me=e==null?void 0:e.displayTokenA)==null?void 0:me.decimals:(B=e==null?void 0:e.displayTokenB)==null?void 0:B.decimals,je=Ui(p,$),_e=e==null?void 0:e.tokenA,I=e==null?void 0:e.tokenB,P=e==null?void 0:e.lowerTick,de=e==null?void 0:e.upperTick,oe=e==null?void 0:e.isReverse,ee={amount:je,tokenA:_e,tokenB:I,isTokenA:oe?!g:g,lowerTick:P,upperTick:de,curSqrtPrice:C,isReverse:oe,roundUp:!0};console.log("ðŸš€ ~ debouncedPreAdd ~ params:",ee);const{displayCoinAmountA:te,displayCoinAmountB:xe,tokenMaxA:ne,tokenMaxB:ie}=S(ee);qe.current===Y?(re(ne),K(ie),g?G(xe||""):n(te||"")):ue(),z(!1)},500),ve=()=>{if((T||k)&&Oi(e)){console.log("ðŸš€ ~ reCalculateResult ~ currentPosBaseInfo:",e);const p=_?T:k;if(+p){const g=li();De(g),Qe(p,_,g)}}};x.useEffect(()=>{F=="increase"&&N&&ve()},[N]);const hi=(p,g)=>{if(console.log("ðŸš€ ~ handleAmountChange ~ amount:",!p,+p,p),!p){ue();return}if(H(g),g?n(p):G(p),+p){z(!0);const Y=li();De(Y),console.log("ðŸš€ ~ handleAmountChange ~ params:",p),Qe(p,g,Y)}else g?G(""):n("")},{currentAccount:f}=Me(),ji=x.useMemo(()=>{const p={text:"Add More Liquidity",disabled:!1};return f!=null&&f.address?!+T&&!+k?(p.text="Enter an amount",p.disabled=!0,p):!Ye&&T&&ae(T).gt((be==null?void 0:be.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${Te(r==null?void 0:r.symbol,10)} Balance`,p):!$e&&k&&ae(k).gt((he==null?void 0:he.balanceFormat)||0)?(p.disabled=!0,p.text=`Insufficient ${Te(M==null?void 0:M.symbol,10)} Balance`,p):((!Se&&!Ce&&(!+T||!+k)||(e==null?void 0:e.posType)=="burn")&&(p.disabled=!0),p):(p.text="Connect Wallet",p.disabled=!1,p)},[T,k,be,he,f==null?void 0:f.address]),{signAndExecuteTransaction:yi}=ai(),{getContractPoolInfo:Ti}=xi(),[wi,We]=x.useState(!1),{fetchAccountBalance:ki}=Oe(),{showInsufficientBalanceToast:Ai}=nl(),ui=async()=>{var p;We(!0);try{let g,Y,$;const je=(p=m||[])==null?void 0:p.reduce((I,P)=>(ae(P==null?void 0:P.amount_owed).gt(0)&&I.push(P.coin_address),I),[]);if(u)$=Z(),s($),g=await Q(e==null?void 0:e.lowerTick,e==null?void 0:e.upperTick,(e==null?void 0:e.posType)=="farms",{pos_id:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,collect_fee:!0,collect_rewarder_types:je});else{const I=_?T:k,P=_?r.decimals:M.decimals,de=ae(I).mul(qi.pow(10,P)).toString(),oe=e!=null&&e.isReverse?!_:_;let ee,te;const xe=e==null?void 0:e.lowerTick,ne=e==null?void 0:e.upperTick,ie=j==null?void 0:j.current_tick_index;ie!==void 0&&xe!==void 0&&ne!==void 0&&(ie>=xe&&ie<=ne?(ee=oe?de:ge,te=oe?y:de):ie>ne?(ee=0,te=de):ie<xe&&(ee=de,te=0)),console.log("ðŸš€ ~ toAdd ~ lowerTick:",xe,ne,ie),console.log("ðŸš€ ~ toAdd ~ amount_a:",e,ee,te),console.log("ðŸš€ ~ toAdd ~ rewarderCoinTypes:",m,je);const me={poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:ee,amountB:te,fixAmountA:oe,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,currentSqrtPrice:C,posType:e==null?void 0:e.posType,rewarderCoinTypes:je,posIndex:e==null?void 0:e.index,posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId};(e==null?void 0:e.posType)=="farms"&&(me.farmsPoolId=e==null?void 0:e.farmsPool),$={getShowInfo:(Si,Ve)=>{const Xe="Add "+[Fe(T,r==null?void 0:r.symbol),Fe(k,M==null?void 0:M.symbol)].filter(Boolean).join(" and "),Re={modalDescriptionText:Xe,toastTitleText:Xe};if(Si==="success"){let Je=T,Ke=k;Ve&&(Je=Pe(Ve,r)||T,Ke=Pe(Ve,M)||k);const fe="Add "+[Fe(Je,r==null?void 0:r.symbol),Fe(Ke,M==null?void 0:M.symbol)].filter(Boolean).join(" and ");Re.toastDescriptionContent=fe,Re.modalDescriptionText=fe,Re.toastTitleText="Supplied Successful"}return Re}},s($),console.log("ðŸš€ ~ toAdd ~ params:",me);const B=await h(me);g=B==null?void 0:B.tx,Y=B==null?void 0:B.msafeParams}const _e=await yi(g,$,{useMev:ni,useFastMode:ci==="Fast Mode",maxCapForGas:mi,customGasPrice:gi,msafeParams:Y});console.log("ðŸš€ ~ toClaim ~ res:",_e),_e?(ki(),ue(),J(""),l(f==null?void 0:f.address,e==null?void 0:e.id,!0)):e&&Ti(e==null?void 0:e.clmmPool).then(I=>{console.log("ðŸš€ ~ toClaim ~ res:",I),u?X():ve()}),We(!1)}catch(g){console.log("ðŸš€ ~ toClaim ~ error:",g),ve(),Ai(String(g)),We(!1)}};return x.useEffect(()=>{if(F==="increase"&&u){if(w!=null&&w.amount_a||w!=null&&w.amount_b){const p=e==null?void 0:e.tokenA,g=e==null?void 0:e.tokenB,Y=Ie(w==null?void 0:w.amount_a,p==null?void 0:p.decimals),$=Ie(w==null?void 0:w.amount_b,g==null?void 0:g.decimals);n(e!=null&&e.isReverse?$:Y),G(e!=null&&e.isReverse?Y:$);return}n(""),G("")}},[u,w,e==null?void 0:e.isReverse]),x.useEffect(()=>(n(""),G(""),()=>{R(void 0)}),[]),{tokenAmountA:T,tokenAmountB:k,reCalculateResult:ve,preAddLoading:U,preAdd:S,getAddTsPayload:h,displayTokenA:r,displayTokenB:M,tokenABalanceInfo:be,tokenBBalanceInfo:he,tokenAmountValueA:ri,tokenAmountValueB:bi,handleAmountChange:hi,resetInputAmount:ue,btnStatusText:ji,toAdd:ui,isAddLoading:wi,showTokenALock:Se,showTokenBLock:Ce,showDisplayTokenALock:Ye,showDisplayTokenBLock:$e,getClmmCreateAddData:A,getFarmsCreateAddData:V,currentPoolSqrtPrice:C}}function Sl(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posApiPoolData:d}=ce(),{currentAccount:a,onWalletModal:W}=Me(),{isFixedDisplayTokenA:m,curPosContractPoolInfo:t,useZapIn:s}=we(),{tokenAmountA:S,tokenAmountB:h,displayTokenA:A,displayTokenB:V,tokenABalanceInfo:E,tokenBBalanceInfo:D,tokenAmountValueA:l,tokenAmountValueB:v,handleAmountChange:L,preAddLoading:C,btnStatusText:_,toAdd:H,isAddLoading:j,showDisplayTokenALock:F,showDisplayTokenBLock:N,resetInputAmount:u,currentPoolSqrtPrice:Z}=ul();x.useEffect(()=>()=>{u()},[]);const{getTokenAmountValue:Q}=Ue(),X=Q(A==null?void 0:A.coin_type,S,"--"),w=Q(V==null?void 0:V.coin_type,h,"--"),J=X=="--"||w=="--"?"--":Yi(l).plus(v).toString(),R=o[e==null?void 0:e.posId],{currentApiPoolInfo:U}=al(e,d);return i.jsxs(q,{w:"100%",gap:"8px",children:[i.jsxs(ze,{w:"100%",position:"relative",bg:"bg_six",p:{base:"8px",lg:"16px"},border:"1px solid",borderColor:"border",borderRadius:"16px",children:[(U==null?void 0:U.haveZap)&&(e==null?void 0:e.posType)!=="burn"&&!F&&!N&&i.jsx(pl,{action:"Deposit",resetInputAmount:u}),s?i.jsx(il,{action:"Deposit",apiPoolInfo:U,currentSqrtPrice:Z,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick}):i.jsx(i.Fragment,{children:i.jsx(cl,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(E==null?void 0:E.balanceFormat)||"",value:S,amountValue:l,loading:!m&&C,onChange:z=>{L(z,!0)},placeholder:"0.0",token:A,lock:{isLock:e&&t&&F,style:{borderRadius:"12px"}}},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:(D==null?void 0:D.balanceFormat)||"",value:h,amountValue:v,loading:m&&C,onChange:z=>{L(z,!1)},placeholder:"0.0",token:V,lock:{isLock:e&&t&&N,style:{borderRadius:"12px"}}},iconHover:!1,iconParams:F||N?void 0:{xlinkHref:"#icon-icon_add",svgFill:"text_caption"},lock:{isLock:!e||!t||e&&(e==null?void 0:e.posType)=="burn",text:e&&(e==null?void 0:e.posType)=="burn"?"Your liquidity has been permanently locked":void 0,style:{h:"224px",borderRadius:"12px"}}})})]}),s?i.jsx(ll,{action:"Deposit",onClick:H,hideDepositRatio:!0,otherLoading:j}):i.jsxs(i.Fragment,{children:[i.jsx(Ne,{onClick:()=>{a?H():W(!0)},isLoading:j,disabled:_.disabled||j,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:_.text}),J&&i.jsx(pe,{borderRadius:"0 0 16px 16px",pt:"36px",mt:"-28px",children:i.jsxs(c,{w:"100%",justify:"space-between",children:[i.jsx(b,{children:"Total Amount"}),i.jsx(b,{color:"text_caption",children:di(J,2)})]})})]}),(e==null?void 0:e.posType)!=="burn"&&i.jsx(dl,{}),R&&(R==null?void 0:R.minPrice)!=="0"&&(R==null?void 0:R.maxPrice)!=="âˆž"&&i.jsx(sl,{subscriptionSource:"PositionDetail"})]})}function Cl(){const{currentPosBaseInfo:e}=ce(),{currentPosPoolInfo:o,curPosContractPoolInfo:d}=we(),{setContractPoolInfo:a,setApiPoolInfo:W}=hl(),{lowerTickData:m,upperTickData:t,setLowerTickData:s,setUpperTickData:S}=Ei();$i(()=>{W(o)},[o]);const h=(E,D,l)=>{var N,u;const v=(N=l==null?void 0:l.tokenA)==null?void 0:N.decimals,L=(u=l==null?void 0:l.tokenB)==null?void 0:u.decimals;let C;Math.abs(E)==Math.abs(Qi.getMinIndex(Number(l.tickSpacing)))?C=D==="lower"?"0":"âˆž":C=Xi.tickIndexToPrice(E,v,L).toString();const _=C==="âˆž"?"âˆž":se(C,6),H=jl(C),j=H==="âˆž"?"âˆž":se(H,6),F={id:D,tokenA:l==null?void 0:l.tokenA,tokenB:l==null?void 0:l.tokenB,tick:E,price:C,displayPrice:_,reversePrice:H,displayReversePrice:j,tickSpacing:l==null?void 0:l.tickSpacing,pool:l==null?void 0:l.poolAddress};D==="lower"?s({...F}):S({...F})},{getCurrentPrice:A}=tl();x.useEffect(()=>{e!=null&&e.lowerTick&&(d!=null&&d.current_sqrt_price)&&(o!=null&&o.poolAddress)&&(h(e==null?void 0:e.lowerTick,"lower",o),h(e==null?void 0:e.upperTick,"upper",o),A(d==null?void 0:d.current_sqrt_price,o),a(d))},[e==null?void 0:e.lowerTick,d==null?void 0:d.current_sqrt_price,o==null?void 0:o.poolAddress]);const V=x.useMemo(()=>(e==null?void 0:e.posId)&&(m==null?void 0:m.pool)&&(t==null?void 0:t.pool),[m==null?void 0:m.pool,t==null?void 0:t.pool,e==null?void 0:e.posId]);return i.jsx(ze,{className:"chart-block",w:{base:"100%",lg:"200px"},h:"85px",mb:"8px",overflow:"hidden",children:V&&i.jsx(Di,{isFrom:"position",handleClickRefresh:()=>{},direct:!(e!=null&&e.isReverse),minPriceData:e!=null&&e.isReverse?t:m,maxPriceData:e!=null&&e.isReverse?m:t,readonly:!0})})}function vl(){const{currentPosBaseInfo:e,posPoolsRelatedData:o,posPoolsOriginalData:d}=ce(),a=o[e==null?void 0:e.posId],{getClmmPosName:W}=pi(),m=x.useMemo(()=>{var h;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const A=(h=d==null?void 0:d[e==null?void 0:e.clmmPool])==null?void 0:h.index;return W(e==null?void 0:e.index,A)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,d]);(a==null?void 0:a.displayFee)+"";const t=(a==null?void 0:a.currentStatus)=="Active",s=x.useMemo(()=>{console.log("ðŸš€ ~ leverage ~ currentPosPoolsRelatedData:",a);const h=a==null?void 0:a.minPriceOrigin,A=a==null?void 0:a.maxPriceOrigin;return h!=="0"&&A!=="âˆž"?Ji(1/(1-Number((h/A)**.25)),2)+"x":"1x"},[a==null?void 0:a.minPriceOrigin,a==null?void 0:a.maxPriceOrigin]),{getExplorerUrl:S}=oi();return i.jsxs(pe,{w:"100%",borderRadius:"20px 20px 16px 16px",children:[i.jsx(pe,{p:{base:"16px 8px",lg:"16px"},w:"calc(100% + 34px)",ml:"-17px",mt:"-21px",bg:"bg_six",children:i.jsxs(c,{justify:"space-between",children:[i.jsxs(c,{h:{base:"40px",lg:"32px"},gap:"8px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(b,{children:"Position ID"}),i.jsx(le,{isLoaded:!!m,children:i.jsx(b,{color:"text_caption",children:m==null?void 0:m.split("|")[1]})})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(b,{children:"Position NFT"}),i.jsx(le,{isLoaded:!!(e!=null&&e.id),children:i.jsx(Bi,{fontWeight:"500",color:"text_caption",fontSize:"14px",address:e==null?void 0:e.id,showLink:!1,onClickLink:()=>{window.open(S(e==null?void 0:e.id,"nftAddress"),"_blank")}})})]})]}),a&&i.jsx(rl,{isActive:t,isLoading:(a==null?void 0:a.currentStatus)=="",h:"32px",p:"0 12px",w:"unset",isRow:!0,imgStyle:{imgW:"30px",imgH:"16px"}})]})}),i.jsxs(c,{gap:{base:"20px",lg:"8px"},w:"100%",justify:"space-between",p:"28px 0 20px",flexDirection:{base:"column",lg:"row"},children:[i.jsxs(q,{gap:{base:"16px",lg:"32px"},children:[i.jsxs(q,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(b,{color:"primary_gray",children:"Current Price"}),i.jsx(Ni,{posId:(e==null?void 0:e.posId)||"",displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB})]}),i.jsxs(q,{w:"100%",justify:"space-between",mt:"8px",align:{base:"center",lg:"flex-start"},children:[i.jsx(b,{color:"primary_gray",children:"Position Range"}),i.jsx(bl,{displayTokenA:e==null?void 0:e.displayTokenA,displayTokenB:e==null?void 0:e.displayTokenB,justify:"center",priceInfo:{minPrice:a==null?void 0:a.minPrice,maxPrice:a==null?void 0:a.maxPrice,minPriceResever:a==null?void 0:a.minPriceResever,maxPriceResever:a==null?void 0:a.maxPriceResever},fontSize:"14px"})]})]}),i.jsxs(q,{gap:"0",children:[i.jsx(Cl,{}),i.jsx(q,{zIndex:"9",children:i.jsxs(c,{gap:"2px",bg:"primary_opacity.10",borderRadius:"full",p:" 0 20px",h:"26px",align:"center",children:[i.jsx(b,{color:"primary",fontSize:"12px",children:"Leverage"}),i.jsx(gl,{type:"leverage"}),i.jsx(le,{ml:"4px",isLoaded:!!s&&!!a,children:i.jsx(b,{color:"primary",children:s})})]})})]})]})]})}function _s(){var K,T;const e=_i(),{fetchAccountBalance:o}=Oe(),{currentAccount:d}=Me(),{position_nft_id:a}=Ri(),{getCurrentPosBaseInfo:W}=Ge(),{currentPosDetailTab:m,currentPosPoolInfo:t,setCurrentPosDetailTab:s,setCurrentPosPoolInfo:S,setCurrentPoolSqrtPrice:h,setCurPosContractPoolInfo:A,setIsPosDetailRefresh:V,setUseZapIn:E}=we(),{posPoolsRelatedData:D,currentPosBaseInfo:l,setCurrentPosBaseInfo:v,farmsPosRewardsData:L,posRewardsData:C}=ce(),_=(((K=D[l==null?void 0:l.posId])==null?void 0:K.displayFee)||"--")+"%",H=[{label:"Increase",value:"increase"},{label:"Remove",value:"remove"}],j=()=>{console.log("ðŸš€ ~ handleRefresh ~ handleRefresh:"),V(!0),F(!0),w(),Q(),o(),R(),setTimeout(()=>{V(!1)},1e3)},F=(n=!1)=>{d!=null&&d.address&&a&&W(d==null?void 0:d.address,a,n)};x.useEffect(()=>{console.log("ðŸš€ ~ PositionDetail ~ position_nft_id:",a),F()},[d==null?void 0:d.address,a]),x.useEffect(()=>{console.log("ðŸš€ ~ PositionHistory ~ currentPosBaseInfo?.id:",l==null?void 0:l.id)},[l==null?void 0:l.id]);const{fetchTokenPrices:N}=Ue(),u=L[l==null?void 0:l.id],Z=C[l==null?void 0:l.posId],Q=()=>{var ke,Ae;const n=(Z==null?void 0:Z.map(r=>r==null?void 0:r.coin_address))||[],k=(u==null?void 0:u.map(r=>r==null?void 0:r.rewarder_type))||[],G=[(ke=l==null?void 0:l.tokenA)==null?void 0:ke.coin_type,(Ae=l==null?void 0:l.tokenB)==null?void 0:Ae.coin_type].filter(Boolean),O=Array.from(new Set([...n,...G,...k]));N(O)};x.useEffect(()=>{Q()},[l==null?void 0:l.posId,Z==null?void 0:Z.length,u==null?void 0:u.length]);const{getPoolList:X}=yl(),w=async()=>{if(!(l!=null&&l.clmmPool))return;const n=await X({pool:l==null?void 0:l.clmmPool});if(console.log("ðŸš€ ~ getPoolData ~ poolInfo:",l,n),n)return S(n==null?void 0:n.list[0])},{getContractPoolInfo:J}=xi(),R=async()=>{if(console.log("ðŸš€ ~ handleGetPrice ~ currentPosBaseInfo?.clmmPool:",l==null?void 0:l.clmmPool),l!=null&&l.clmmPool){const n=await J(l==null?void 0:l.clmmPool);console.log("ðŸš€ ~ handleGetPrice ~ contractPoolInfo:",n),n&&(h(n.current_sqrt_price),A(n))}},{setFromCoin:U,setToCoin:z,fromCoin:ge,toCoin:re}=Tl();x.useEffect(()=>{w(),R();let n;return l!=null&&l.clmmPool&&(n=setInterval(()=>{R()},2e4)),l!=null&&l.displayTokenA&&(l!=null&&l.displayTokenB)&&(U(l==null?void 0:l.displayTokenA),z(l==null?void 0:l.displayTokenB)),()=>{clearInterval(n),U(ei.clmm_swap.from_coin),z(ei.clmm_swap.to_coin)}},[l==null?void 0:l.clmmPool]),x.useEffect(()=>(s("increase"),d!=null&&d.address&&o(),()=>{A(null),v(null),S(null),E(!1)}),[]),kl({onRpcChange:()=>{F(!0),R(),d!=null&&d.address&&o()}});const{isApp:y}=Ze();return i.jsxs(q,{gap:"12px",w:"100%",pt:"20px",align:"flex-start",children:[i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(c,{w:{base:"100%",lg:"unset"},justifyContent:"space-between",children:[i.jsx(wl,{}),y&&i.jsxs(c,{children:[i.jsx(ti,{}),i.jsx(si,{handleRefresh:j,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:{base:"100%",lg:"unset"},children:[i.jsx(Ne,{w:{base:"100%",lg:"unset"},bg:"bg_secondary",fontSize:"14px",p:"0 16px",h:"32px",borderRadius:"8px",fontWeight:"500",variant:"outline",onClick:n=>{e(`/liquidity?poolAddress=${l==null?void 0:l.clmmPool}`)},children:"Create a new position"}),!y&&i.jsx(si,{handleRefresh:j,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]}),i.jsxs(c,{w:"100%",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[i.jsx(le,{w:{base:"100%",lg:"unset"},isLoaded:!!(l!=null&&l.clmmPool),children:i.jsx(Fi,{symbolFontWeight:"600",haveName:!0,poolInfo:{feeDisplay:_,poolAddress:l==null?void 0:l.clmmPool,...l},symbolEllipsesDecimals:10,nameEllipsesDecimals:20,placement:"bottom-start"})}),i.jsxs(c,{w:{base:"100%",lg:"unset"},gap:{base:"12px",lg:"28px"},flexDirection:{base:"column",lg:"row"},children:[i.jsx(Le,{label:"Pool APR",value:i.jsx(Li,{poolInfo:t,children:i.jsxs(c,{justify:"flex-end",align:"flex-end",gap:"4px",lineHeight:"14px",h:"14px",children:[i.jsx(b,{as:"span",fontSize:"14px",color:"text_caption",fontWeight:"500",cursor:t!=null&&t.farmingAprDisplay||((T=t==null?void 0:t.miningAprList)==null?void 0:T.length)>0?"help":"text",children:t==null?void 0:t.feeAndMiningAprDisplay}),(t==null?void 0:t.haveFarming)&&i.jsxs(b,{fontSize:"12px",lineHeight:"12px",h:"12px",color:"primary",fontWeight:"500",children:["+",t==null?void 0:t.farmingAprDisplay]})]})}),loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"TVL",value:(t==null?void 0:t.tvlDisplay)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"Volume (24H)",value:(t==null?void 0:t.volume24Display)||"",loading:!(t!=null&&t.poolAddress)}),i.jsx(Le,{label:"Fees (24H)",value:(t==null?void 0:t.fees24Display)||"",loading:!(t!=null&&t.poolAddress)})]})]}),i.jsxs(c,{w:"100%",align:"flex-start",flexDirection:{base:"column-reverse",lg:"row"},children:[i.jsxs(q,{w:{base:"100%",lg:"60%"},gap:"8px",children:[i.jsx(vl,{}),i.jsx(Al,{})]},`${l==null?void 0:l.posId}-posInfo`),i.jsxs(q,{w:{base:"100%",lg:"40%"},children:[i.jsx(pe,{p:"0",borderRadius:"16px",bg:"bg_six",children:i.jsxs(c,{w:"100%",p:"0 16px",children:[i.jsx(Ki,{type:"borderTab",bg:"none",wrapStyle:{w:"100%",h:"60px",border:"none",bg:"none"},itemStyle:{w:{base:"50%",lg:"unset"},fontSize:"16px",mr:"28px"},tabList:H,currentTab:m=="increase"?"Increase":"Remove",handleChangeTab:n=>{s(n==null?void 0:n.value)}}),!y&&i.jsx(ti,{})]})}),m=="increase"&&i.jsx(Sl,{}),m=="remove"&&i.jsx(ol,{})]})]})]})}const ti=()=>i.jsx(c,{children:i.jsx(Mi,{})});export{_s as default};
//# sourceMappingURL=PositionDetail-DWLM0DWt.js.map
