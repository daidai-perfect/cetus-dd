import{j as e,H as b,a0 as Bt,T as f,Y as N,Z as Te,bp as rt,e as at,r as p,b as ie,W as V,V as k,I as q,c as ke,X as Le,U as ot,a1 as te,R as be,bq as ge,br as ne,bs as ct,aO as Q,d as R,ad as Pe,ae as Me,af as Ae,ag as Ee,ah as lt,ai as He,aj as Re,k as dt,al as pt,$ as I,S as X,g as $t,C as pe,a2 as Ke,B as xt,a$ as fe,a9 as he,a4 as Fe,a as ut,bd as Vt,a8 as Ze,ak as Xe,as as qe,l as Yt,aa as Ut,u as Gt,ao as Qt}from"./index-D49RffYW.js";import{P as _e}from"./Pagination-DqVMPT3W.js";import{N as ee}from"./NoData-MWQZy93S.js";import{u as Jt}from"./RangeValue-B6IVaqEN.js";import{u as we}from"./useAccountBalance-D-weOZgA.js";import{u as de}from"./useTransaction-i5gFyneH.js";import{u as ze}from"./useToken-BlS8b5ft.js";import{C as Ne}from"./CetusTooltip-7TnGbJNH.js";import{S as Kt}from"./SingleTokenInfo-Cvcahm1q.js";import{b as mt}from"./FarmsTable-BmPDV1jg.js";import{a as Y,b as F,c as gt,d as ht,e as J,T as jt}from"./tr-ChzXWjY-.js";import{A as Zt}from"./aggregator-VXxomCmR.js";import{A as Ie}from"./useSwapHelper-CKwapxYx.js";import{u as et}from"./useTokenBalance-Cc02jFZo.js";import{u as Xt}from"./useInsufficientBalanceToast-oZJ3kO4O.js";import{u as qt}from"./useFindBestRouting-Bo95_EUn.js";import{T as It}from"./TradeInputGroup-C7m7R_Tz.js";import{W as es}from"./WarningTokenTipModal-Ffw8adfe.js";import{M as ts,C as ss}from"./MenuDropBlock-B-3fdvCI.js";import{T as ns,a as is,L as rs}from"./LimitPriceChart-C264-Tbb.js";import"./Swap-QkgER5sD.js";import{T as as}from"./TradeConfirmAmountInfo-BVFeG-79.js";import{I as je}from"./InputBox-cvzQCj0g.js";import{L as os}from"./api-data-utils-D656F-wl.js";import{u as cs}from"./global-iZ7St_zm.js";import{R as tt}from"./RefreshButton-C1kwCG7k.js";import{u as ls}from"./useRpcListener-D8tK2rVa.js";import"./AddressCopyLink-BnCAac35.js";import"./AddressUnderline-CPGiMg8E.js";import"./usePositionList-CyCzZNts.js";import"./useGetPoolList-DBJielhS.js";import"./index-BVFwDyvF.js";import"./ExpendItem-Dexzs6Wu.js";import"./msafe-oYBkW7LJ.js";import"./PriceRange-BFhvNGCl.js";import"./PositionStatus-Cy2qCSNc.js";import"./CoinPairInfo-DmtDGhhi.js";import"./_getAllKeysIn-Caqnu8Ck.js";import"./IconBg-C4r55JcD.js";import"./SwapConfirmBlock-Bg-u1s8N.js";import"./index-BzKWeyUu.js";import"./usePriceImpact-BMryGRgg.js";import"./CurrentPrice-bArlFA15.js";import"./HighlightText-DSzYWpab.js";import"./HTextLabelBox-DVxTk_Ir.js";import"./swap-DRTXgWYs.js";import"./Slippage-C-5lq2_6.js";import"./TooltipIcon-BGEWyiwk.js";import"./switch-Dw_sCPfe.js";import"./index-CosTxpEh.js";import"./debounce-B0JWIAw5.js";import"./throttle-DfDFquvd.js";import"./usePreviousValue-D4m5LJZe.js";const xe=({info:t,imgSize:n="32px"})=>{const{pay_coin:i,target_coin:u,total_pay_amount:x,expect_obtain_amount:d}=t;return e.jsxs(b,{children:[e.jsx(Bt,{w:n,h:n,coinAIconUrl:i.logo_url,coinBIconUrl:u.logo_url}),e.jsxs(f,{color:"text_caption",children:[N(x)," ",i.symbol," → ",N(d)," ",u.symbol]})]})},ue=({info:t})=>e.jsx(b,{justifyContent:"end",gap:"2px",children:e.jsxs(f,{color:"text_caption",children:[Te(t==null?void 0:t.expire_ts,"")," (UTC)"]})}),me=({info:t})=>{const{pay_coin:n,total_pay_amount:i,deal_amount:u,deal_rate:x}=t;return e.jsxs(b,{justifyContent:"end",gap:"2px",children:[e.jsxs(f,{color:"text_caption",children:[N(u),"/",N(i)," ",n.symbol]}),e.jsxs(f,{color:"primary_gray",children:["(",rt(Number(x)*100),")"]})]})},bt=({historyInfo:t,type:n,...i})=>{const{getExplorerUrl:u}=at(),{pay_coin:x,target_coin:d}=t,j=p.useMemo(()=>(t==null?void 0:t.events)||[],[t]),h=c=>{const l=c==null?void 0:c.event_type;return l.includes("OrderCanceledEvent")?{text:"Cancel",color:"primary_yellow",icon:"#icon-tx_remove",tokenInfo:x,num:`+${N(Le(c==null?void 0:c.amount,x==null?void 0:x.decimals))}`}:l.includes("FlashLoanEvent")?{text:"Trade",color:"primary",icon:"#icon-a-icon_swap2",tokenInfo:d,num:`+${N(Le(c==null?void 0:c.amount,d==null?void 0:d.decimals))}`}:l.includes("OrderPlacedEvent")?{text:"Create",color:"primary_green",icon:"#icon-a-icon_add1",num:`-${N(Le(c==null?void 0:c.amount,x==null?void 0:x.decimals))}`,tokenInfo:x}:{text:"",icon:"",color:"",num:"",tokenInfo:null}},{isApp:a}=ie();return e.jsx(V,{p:"16px",borderTop:"none",borderRadius:" 0 0 16px 16px",...i,children:e.jsx(k,{align:"flex-start",children:j.map(c=>{const{tokenInfo:l,text:o,icon:s,color:r,num:g}=h(c);return e.jsxs(k,{align:"flex-start",w:"100%",bg:"card_bg",borderRadius:"8px",p:"12px",flexDirection:{base:"column",lg:"row"},children:[e.jsxs(b,{align:{base:"flex-start",lg:"center"},w:"100%",gap:"16px",justifyContent:"space-between",children:[e.jsxs(b,{gap:n=="card"?"4px":"8px",flexDirection:n=="card"?"column":"row",align:n=="card"?"flex-start":"center",children:[e.jsxs(b,{w:"68px",justify:"flex-start",gap:"4px",children:[e.jsx(q,{svgW:"14px",xlinkHref:s,svgFill:r,svgHover:r}),e.jsx(f,{color:r,children:o})]}),!a&&e.jsxs(f,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[g," ",l==null?void 0:l.symbol]})]}),e.jsxs(b,{gap:n=="card"?"4px":"20px",flexDirection:n=="card"&&!a?"column":"row",align:n=="card"?"flex-end":"center",children:[e.jsxs(f,{h:"20px",lineHeight:"20px",children:[Te(Number(c.block_time),"")," (UTC)"]}),e.jsxs(b,{gap:"4px",cursor:"pointer",onClick:w=>{ke(w),window.open(u(c.tx,"tx"))},_hover:{svg:{fill:"text_caption"}},children:[!a&&e.jsx(f,{color:"text_caption",children:"View Transaction"}),e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]}),a&&e.jsxs(f,{whiteSpace:"nowrap",color:"text_caption",h:"20px",lineHeight:"20px",children:[g," ",l==null?void 0:l.symbol]})]},c==null?void 0:c.tx)})})})},oe=({info:t})=>{const[n,i]=p.useState(!0),{getTokenRank:u}=Jt();p.useEffect(()=>{const a=u(t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin);i(a)},[t==null?void 0:t.pay_coin,t==null?void 0:t.target_coin]);const{pay_coin:x,target_coin:d,price:j,reseverPrice:h}=t;return e.jsxs(b,{justifyContent:"end",children:[n?e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(f,{color:"text_caption",lineHeight:"1",children:N(j)}),e.jsxs(f,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[d.symbol," per ",x.symbol]})]}):e.jsxs(b,{flexWrap:"wrap",justify:"flex-end",children:[e.jsx(f,{color:"text_caption",children:N(h)}),e.jsxs(f,{color:"text_caption",whiteSpace:"nowrap",lineHeight:"1",children:[x.symbol," per ",d.symbol]})]}),e.jsx(q,{xlinkHref:"#icon-icon_swap1",svgW:"14px",svgH:"14px",ml:"-6px",onClick:a=>{ke(a),i(!n)}})]})},ft=({historyInfo:t,openExpendItemObj:n})=>e.jsxs(b,{justifyContent:"end",gap:"4px",children:[(t==null?void 0:t.status)=="Cancelled"?e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_cancelled",svgFill:"primary_yellow",svgHover:"primary_yellow"}):e.jsx(q,{svgW:"18px",xlinkHref:"#icon-icon_check",svgFill:"primary_green",svgHover:"primary_green"}),e.jsx(f,{color:(t==null?void 0:t.status)=="Cancelled"?"primary_yellow":"primary_green",children:t==null?void 0:t.status}),e.jsx(q,{svgW:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:n[t==null?void 0:t.order_id]?"rotate(180deg)":"rotate(0deg)"})]}),ds=(t,n)=>({orderListLoading:!1,myOrderList:[],setOrderListLoading:i=>{t(()=>({orderListLoading:i}))},setMyOrderList:i=>{t(()=>({myOrderList:i}))}}),ye=ot(ds);function Se(){const{currentAccount:t,addressChangeVersion:n}=te(),{peripherySdk:i}=be(),{setOrderListLoading:u,setMyOrderList:x,myOrderList:d,orderListLoading:j}=ye(),{fetchTokenInfo:h}=ze(),a=async(l=t==null?void 0:t.address,o)=>{try{if(!l){u(!1),x([]);return}o&&u(!0);const s=await i.LimitOrder.getOwnerLimitOrderList(l,"all"),r=await c(s.data.filter(g=>g.status===ge.PartialCompleted||g.status===ge.Running));x(r)}catch{}finally{u(!1)}},c=async l=>{const o=[];for(const s of l){const[r,g]=await Promise.all([h(s.pay_coin_type),h(s.target_coin_type)]);if(r&&g){const{total_pay_amount:w,pay_balance:T,rate:L,obtained_amount:C,claimed_amount:M,target_balance:y,created_ts:A,expire_ts:_,status:E,id:P}=s,v=ne(w,r.decimals).toString(),$=ne(T,r.decimals).toString(),K=ne(C,g.decimals).toString(),B=ne(M,g.decimals).toString(),Z=ne(y,g.decimals).toString(),O=ct.rateToPrice(L.toString(),r.decimals,g.decimals),U=Q(1).div(O).toString(),S=ne(Q(w).sub(T).toFixed(0),r.decimals).toString(),D={order_id:P,pay_coin:r,target_coin:g,price:O,reseverPrice:U,total_pay_amount:v,expect_obtain_amount:Q(v).mul(O).toString(),remaining_amount:$,deal_amount:S,deal_rate:Q(S).div(v).toString(),obtained_amount:K,claimed_amount:B,un_claimed_amount:Q(Z).sub(B).toString(),created_ts:A,expire_ts:_,status:E};o.push(D)}}return o.sort((s,r)=>r.created_ts-s.created_ts)};return{fetchMyLimitOrder:a,orderListLoading:j,myOrderList:d}}function _t(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:n}=Se(),{signAndExecuteTransaction:i}=de(),{peripherySdk:u}=be(),[x,d]=p.useState(!1),{transactionConfirmation:j}=de();return{handleCancelOrder:async a=>{d(!0);const c={getShowInfo:r=>{const g="Canceling order",w={modalDescriptionText:g,toastTitleText:g};return r==="success"&&(w.toastDescriptionContent="Order cancelled successfully",w.modalDescriptionText="Order cancelled successfully",w.toastTitleText="Order cancelled"),w}};j(c);const l=a.map(r=>({pay_coin_type:r.pay_coin.coin_type,target_coin_type:r.target_coin.coin_type,order_id:r.order_id})),o=await u.LimitOrder.cancelOrdersByOwner(l),s=await i(o,c);d(!1),s&&setTimeout(()=>{t(),n()},2e3)},cancelOrderLoading:x}}function ps(){const{fetchAccountBalance:t}=we(),{fetchMyLimitOrder:n}=Se(),{signAndExecuteTransaction:i}=de(),{peripherySdk:u}=be(),[x,d]=p.useState(!1),[j,h]=p.useState(!1);return{handleClaimOrder:async(l,o)=>{d(!0);const s={pay_coin_type:l.pay_coin.coin_type,target_coin_type:l.target_coin.coin_type,order_id:l.order_id},r=await u.LimitOrder.claimTargetCoin(s),g=await i(r,{getShowInfo:(w,T)=>{var M;const L=`Claim ${N(o)} ${(M=l==null?void 0:l.target_coin)==null?void 0:M.symbol}`,C={modalDescriptionText:L,toastTitleText:L};return w==="success"&&(C.toastDescriptionContent="",C.modalDescriptionText="",C.toastTitleText="Claim successfully"),C}});d(!1),g&&setTimeout(()=>{t(),n()},2e3)},getLimitOrderClaimHistory:async l=>{h(!0);const o=await u.LimitOrder.getLimitOrderClaimLogs(l.order_id);return o?(h(!1),o.map(s=>{var g;const r=R(s.parsedJson.claimed_amount).div(Math.pow(10,(g=l.target_coin)==null?void 0:g.decimals));return{...s,...s.parsedJson,claimed_amount:r}})):[]},isClaimHistoryLoading:j,claimLoading:x}}const xs=({orderInfo:t,isOpen:n,onClose:i,handleClaim:u,claimLoading:x,getLimitOrderClaimHistory:d,isClaimHistoryLoading:j})=>{const{getExplorerUrl:h}=at(),[a,c]=p.useState(""),[l,o]=p.useState([]),[s,r]=p.useState({label:"Claim",value:"claim"}),g=[{label:"Claim",value:"claim"},{label:"History",value:"history"}],w=y=>{r(y),(y==null?void 0:y.value)=="history"&&T()},T=async()=>{const y=await d();y&&o(y)},L=p.useMemo(()=>!a||x?{disabled:!0,text:"Claim"}:R(a).gt(t.un_claimed_amount)||R(t.un_claimed_amount).eq(0)?{disabled:!0,text:"Maximum amount that can be withdrawn"}:{disabled:!1,text:"Claim"},[a,t.un_claimed_amount]),[C,M]=p.useState(!0);return p.useEffect(()=>{C&&(M(!1),c(t.un_claimed_amount))},[C,t.un_claimed_amount]),e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:i,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsx(lt,{fontWeight:"500",fontSize:"16px",children:"Claim"})}),e.jsx(He,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(k,{w:"100%",gap:"20px",p:"16px",pt:"0",align:"flex-start",children:[e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."})}),e.jsx(xe,{info:t,imgSize:"28px"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsx(dt,{type:"outlineTab",wrapStyle:{w:"100%",h:"36px",borderRadius:"8px",p:"4px",mt:"-1px",zIndex:"1"},itemStyle:{w:"50%",fontSize:"12px"},tabList:g,currentTab:s.label,handleChangeTab:w}),(s==null?void 0:s.value)=="claim"&&e.jsxs(e.Fragment,{children:[e.jsx(V,{w:"100%",p:"16px",mt:"-4px",children:e.jsxs(k,{gap:"16px",align:"flex-start",children:[e.jsx(f,{lineHeight:"18px",children:"Available to claim"}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(pt,{value:a?N(a).toString():"",onChange:y=>{c(y)},decimals:18,style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"28px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(b,{children:e.jsx(Kt,{portal:!1,token:t==null?void 0:t.target_coin,haveName:!1,imgBoxStyle:{w:"28px",h:"28px"}})})]})]})}),e.jsx(I,{onClick:()=>{u(a),i()},disabled:L.disabled,w:"calc(100% + 32px)",mb:"-30px",ml:"-16px",h:"52px",fontWeight:"500",children:L.text})]}),(s==null?void 0:s.value)=="history"&&e.jsx(k,{w:"100%",gap:"12px",children:j?e.jsxs(V,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:[e.jsxs(b,{justify:"space-between",children:[e.jsx(X,{height:"4",width:"150px"}),e.jsx(X,{height:"4",width:"150px"})]}),e.jsxs(b,{justify:"space-between",mt:"16px",children:[e.jsx(X,{height:"4",width:"150px"}),e.jsx(X,{height:"4",width:"150px"})]})]},history==null?void 0:history.id):(l==null?void 0:l.length)==0?e.jsx(ee,{type:"nodata",text:"No History.",p:"20px"}):l==null?void 0:l.map(y=>{var A,_;return e.jsx(V,{w:"100%",p:"16px",mt:"-4px",borderRadius:"12px",children:e.jsxs(k,{gap:"16px",align:"flex-start",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Amount"}),e.jsxs(b,{gap:"4px",children:[e.jsx($t,{imageUrl:(A=t==null?void 0:t.target_coin)==null?void 0:A.logo_url,w:"20px",h:"20px"}),e.jsxs(f,{color:"text_caption",lineHeight:"18px",children:[N(y==null?void 0:y.claimed_amount)," ",(_=t==null?void 0:t.target_coin)==null?void 0:_.symbol]})]})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Time"}),e.jsxs(b,{gap:"4px",cursor:"pointer",mr:"-4px",onClick:E=>{ke(E),window.open(h(y.digest,"tx"))},children:[e.jsxs(f,{color:"text_caption",children:[Te(Number(y==null?void 0:y.timestampMs),"")," (UTC)"]}),e.jsx(q,{svgW:"20px",xlinkHref:"#icon-icon_link1"})]})]})]})},y.digest)})})]})})]})]})},Oe=({orderInfo:t})=>{const{handleCancelOrder:n,cancelOrderLoading:i}=_t(),{handleClaimOrder:u,claimLoading:x,getLimitOrderClaimHistory:d,isClaimHistoryLoading:j}=ps(),[h,a]=p.useState(),[c,l]=p.useState(!1),o=(s,r)=>{a(s),r==="cancel"&&n([s]),r==="claim"&&l(!0)};return ie(),e.jsxs(b,{w:{base:"calc(100vw - 32px)",lg:"unset"},pl:{base:"8px",lg:"0px"},pr:{base:"8px",lg:"0px"},justify:"space-between",gap:"8px",children:[R(t==null?void 0:t.obtained_amount).lte(0)&&R(t.un_claimed_amount).lte(0)?e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"For a partially filled order, you can manually claim the filled amount if you want. Or you can wait for the auto distribution until your order is fully filled, expired or cancelled."}),children:e.jsx(pe,{w:{base:"calc(50vw - 28px)",lg:"80px"},children:e.jsx(I,{disabled:!0,w:"100%",h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",children:"Claim"})})}):e.jsx(I,{isLoading:x,disabled:x,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",onClick:()=>{x||o(t,"claim")},children:"Claim"}),e.jsx(I,{isLoading:i,disabled:i,w:{base:"50%",lg:"80px"},h:"28px",variant:"outline",borderRadius:"8px",fontSize:"14px",color:"primary_gray",bg:"button_ghost_bg",onClick:()=>{i||o(t,"cancel")},children:"Cancel"}),c&&e.jsx(xs,{orderInfo:t,claimLoading:x,isOpen:c,onClose:()=>l(!1),handleClaim:s=>u(t,s),getLimitOrderClaimHistory:()=>d(t),isClaimHistoryLoading:j})]})};function st(){const{currentAccount:t,onWalletModal:n}=te(),{myOrderList:i,orderListLoading:u}=ye(),x=10,[d,j]=p.useState([]),[h,a]=p.useState(0),[c,l]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){a(i==null?void 0:i.length);const o=(c-1)*x,s=o+x;j(i.slice(o,s))}},[c,i]),e.jsx(k,{w:"100%",children:t!=null&&t.address?u?e.jsx(V,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((o,s)=>e.jsx(wt,{},s))})}):i.length===0?e.jsx(ee,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"}):e.jsxs(V,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(d==null?void 0:d.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:d==null?void 0:d.map(o=>e.jsx(us,{orderInfo:o},o==null?void 0:o.order_id))}),!u&&(i==null?void 0:i.length)>x&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:h,size:x,currentPage:c,onChange:l})})]}):e.jsx(ee,{type:"nowallet",onboard:()=>n(!0),borderRadius:"16px"})})}const us=({orderInfo:t})=>{const{isApp:n}=ie();return e.jsxs(k,{w:"100%",gap:"16px",children:[e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(xe,{info:t,imgSize:"28px"}),!n&&e.jsx(Oe,{orderInfo:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),n&&e.jsx(Oe,{orderInfo:t})]})},wt=()=>e.jsxs(k,{w:"100%",gap:"12px",align:"flex-start",children:[e.jsx(b,{w:"100%",gap:"0",justify:"space-between",children:e.jsxs(b,{gap:"0",children:[e.jsxs(b,{gap:"0px",mr:"8px",align:"flex-start",children:[e.jsx(Ke,{size:"8"}),e.jsx(Ke,{size:"8"})]}),e.jsx(X,{height:"4",width:"100px"})]})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(X,{height:"4",width:"180px"}),e.jsx(X,{height:"4",width:"150px"})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(X,{height:"4",width:"180px"}),e.jsx(X,{height:"4",width:"150px"})]})]});function nt(t){const{historyOrderList:n,historyOrderLoading:i}=t,{currentAccount:u,onWalletModal:x}=te(),d=10,[j,h]=p.useState([]),[a,c]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){c(n==null?void 0:n.length);const s=(l-1)*d,r=s+d;h(n.slice(s,r))}},[l,n]),e.jsx(k,{w:"100%",children:u!=null&&u.address?i?e.jsx(V,{p:{base:"12px",lg:"20px 16px"},borderRadius:"16px",children:e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:[{},{}].map((s,r)=>e.jsx(wt,{},r))})}):n.length===0?e.jsx(ee,{type:"nodata",text:"You don't have any order history.",borderRadius:"16px"}):e.jsxs(V,{borderRadius:"16px",p:{base:"12px",lg:"20px 16px"},h:(j==null?void 0:j.length)>8?"927px":"unset",overflowY:"auto",children:[e.jsx(k,{gap:"20px",sx:{">div":{borderBottom:"1px solid",borderColor:"border",pb:"20px",_last:{borderBottom:"none",pb:"0px"}}},children:j==null?void 0:j.map(s=>e.jsx(ms,{historyInfo:s},s==null?void 0:s.order_id))}),!i&&(n==null?void 0:n.length)>d&&e.jsx(pe,{mt:"12px",children:e.jsx(_e,{total:a,size:d,currentPage:l,onChange:o})})]}):e.jsx(ee,{type:"nowallet",onboard:()=>x(!0),borderRadius:"16px"})})}const ms=({historyInfo:t})=>{const[n,i]=p.useState({});return e.jsxs(k,{w:"100%",gap:"16px",children:[e.jsx(b,{w:"100%",justify:"space-between",children:e.jsx(xe,{info:t,imgSize:"28px"})}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Limit Price"}),e.jsx(oe,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expiry"}),e.jsx(ue,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Filled Size"}),e.jsx(me,{info:t})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Status"}),e.jsx(xt,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,i({...n})},children:e.jsx(ft,{historyInfo:t,openExpendItemObj:n})})]}),n[t==null?void 0:t.order_id]&&e.jsx(bt,{historyInfo:t,p:"0",border:"none",type:"card"})]})};function gs({historyInfo:t}){const[n,i]=p.useState({});return e.jsxs(fe.Fragment,{children:[e.jsxs(Y,{cursor:"pointer",onClick:()=>{n[t==null?void 0:t.order_id]?n[t==null?void 0:t.order_id]=!1:n[t==null?void 0:t.order_id]=!0,i({...n})},sx:{td:{pb:n[t==null?void 0:t.order_id]?"20px !important":"16px !important"}},children:[e.jsx(F,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(F,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(ft,{historyInfo:t,openExpendItemObj:n})})]}),!n[t==null?void 0:t.order_id]&&e.jsx(Y,{h:"16px"}),e.jsx(Y,{position:"relative",top:"-20px",left:"0px",sx:{td:{p:"0 !important",bg:"transparent !important",border:"none !important",_first:{borderRadius:" 16px !important"},_last:{borderRadius:"0 0 16px 0 !important"}},_hover:{bg:"transparent !important",td:{bg:"transparent !important"}}},children:n[t==null?void 0:t.order_id]&&e.jsx(F,{colSpan:5,children:e.jsx(bt,{historyInfo:t})})})]},t==null?void 0:t.order_id)}function hs(t){const{historyOrderList:n,historyOrderLoading:i}=t,{currentAccount:u,onWalletModal:x}=te(),d=10,[j,h]=p.useState([]),[a,c]=p.useState(0),[l,o]=p.useState(1);return p.useEffect(()=>{if((n==null?void 0:n.length)>0){c(n==null?void 0:n.length);const s=(l-1)*d,r=s+d;h(n.slice(s,r))}},[l,n]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"66px !important"}},children:[e.jsx(ht,{children:e.jsxs(Y,{children:[e.jsx(J,{children:"Order Info"}),e.jsx(J,{textAlign:"right",children:"Limit Price"}),e.jsx(J,{textAlign:"right",children:"Expiry"}),e.jsx(J,{textAlign:"right",children:"Filled Size"}),e.jsx(J,{textAlign:"right",children:"Status"})]})}),e.jsx(jt,{children:u!=null&&u.address?i?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):n.length===0?e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nodata",text:"You don't have any order history."})})}):e.jsxs(fe.Fragment,{children:[j.map(s=>e.jsx(gs,{historyInfo:s},s.order_id)),!i&&(n==null?void 0:n.length)>d&&e.jsx(F,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:a,size:d,currentPage:l,onChange:o})})})]}):e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nowallet",onboard:()=>{x(!0)}})})})})]})}const js=(t,n)=>({quoteToken:void 0,payCoin:he.clmm_swap.from_coin,targetCoin:he.clmm_swap.to_coin,setPayCoin:i=>{t(()=>({payCoin:i}))},setTargetCoin:i=>{t(()=>({targetCoin:i}))},setQuoteToken:i=>{t(()=>({quoteToken:i}))},expiresIn:"7 Days",setExpiresIn:i=>{t(()=>({expiresIn:i}))},customExpiresVal:null,setCustomExpiresVal:i=>{t(()=>({customExpiresVal:i}))},refreshPriceLoading:!1,setRefreshPriceLoading:i=>{t(()=>({refreshPriceLoading:i}))}}),re=ot(js);function bs(t,n){const{getTokenPrice:i}=Fe(),u=i(t),x=i(n),d=p.useMemo(()=>{if(u&&x){const j=Q(u.price).div(x.price).toString(),h=j.toString();return{price:j,displayPrice:h}}},[u,x]);return{price:d==null?void 0:d.price,displayPrice:d==null?void 0:d.displayPrice}}function yt(){const{payCoin:t,targetCoin:n,setRefreshPriceLoading:i}=re(),{fetchTokenPrices:u}=Fe();return{refreshCoinMarketPrice:()=>{const d=[];t&&d.push(t.coin_type),n&&d.push(n.coin_type),d.length>0&&(i(!0),u(d).finally(()=>{i(!1)}))}}}function fs(){const{refreshCoinMarketPrice:t}=yt(),{fetchAccountBalance:n}=we(),{fetchMyLimitOrder:i}=Se(),{signAndExecuteTransaction:u}=de(),{peripherySdk:x}=be(),{findBestRouters:d}=qt(),{fetchTokenPrices:j,getTokenAmountValue:h}=Fe(),a=ut(),{pay:c,target:l}=Vt(),{getTokenInfo:o}=ze(),{payCoin:s,targetCoin:r,quoteToken:g,expiresIn:w,setPayCoin:T,setTargetCoin:L,setQuoteToken:C,customExpiresVal:M,setExpiresIn:y,setRefreshPriceLoading:A}=re(),[_,E]=p.useState(""),[P,v]=p.useState(""),[$,K]=p.useState(!0),[B,Z]=p.useState(!0),[O,U]=p.useState(""),{displayPrice:S}=bs((g==null?void 0:g.coin_type)===(s==null?void 0:s.coin_type)?r==null?void 0:r.coin_type:s==null?void 0:s.coin_type,g==null?void 0:g.coin_type),{balanceInfo:D}=et(s),{balanceInfo:De}=et(r),St=h(s==null?void 0:s.coin_type,_),Ct=h(r==null?void 0:r.coin_type,P),[Ce,vt]=p.useState(""),We=p.useRef(Ce);p.useEffect(()=>{We.current=Ce},[Ce]);const[ce,Be]=p.useState(void 0),[Lt,$e]=p.useState(""),Ot=p.useRef(_),Tt=p.useRef(P);p.useEffect(()=>{Ot.current=_},[_]),p.useEffect(()=>{Tt.current=P},[P]),p.useEffect(()=>{T(o(c)||he.clmm_swap.from_coin),L(o(l)||he.clmm_swap.to_coin)},[c,l]),p.useEffect(()=>{if(Be(void 0),t(),kt(),s&&r){const m=s.extensions&&s.extensions.rank||"0",z=r.extensions&&r.extensions.rank||"0";R(m).gte(z)?C({...s}):C({...r})}},[s==null?void 0:s.coin_type,r==null?void 0:r.coin_type]);const kt=async()=>{if(s&&r){const m=`${s.coin_type}_${r.coin_type}`;vt(m);const z=Object.entries(Zt).map(([W,se])=>se.id),G=await d({fromToken:s,toToken:r,amount:Ze(1,s.decimals).toFixed(0),providersKeys:z,by_amount_in:!0,uuid:m});m===We.current&&Be(G)}};p.useEffect(()=>{B?U(S||""):Ye()},[S]),p.useEffect(()=>{g&&!B&&+O&&U(N(R(1).div(O).toFixed(g.decimals)).toString())},[g]),p.useEffect(()=>{Ue($?_:P,$),Ye()},[O]);const[Pt,Mt]=p.useState({tooltip:"",color:"",text:"",bg:""}),[At,Ve]=p.useState(!1),Ye=()=>{var m,z;if(!B&&S&&O){Ve(!0);const G=R(O).sub(S).div(S).mul(100).toFixed(2);$e(G);const W=R(G).gt(0),se=W?G:G.split("-")[1],H={tooltip:"",color:"",text:"",bg:""};H.tooltip=`Limit order price is ${se}% ${W?"higher":"lower"} than the market.`,((m=g==null?void 0:g.coin_type)==null?void 0:m.toLowerCase())==((z=r==null?void 0:r.coin_type)==null?void 0:z.toLowerCase())?Number(O)>Number(S)?(H.text="",H.color="#68FFD8"):Number(S)>Number(O)&&(H.text=`Your limit order price is ${se}% ${W?"higher":"lower"} than market. You are selling at a much ${W?"higher":"lower"} rate. We recommend you to use`,H.color="#ffb62d",H.bg="rgba(255,202,104,0.1)"):Number(O)>Number(S)?(H.text=`Your limit order price is ${se}% ${W?"higher":"lower"} than market. You are buying at a much ${W?"higher":"lower"} rate. We recommend you to use`,H.color="#ffb62d",H.bg="rgba(255,202,104,0.1)"):Number(S)>Number(O)&&(H.text="",H.color="#68FFD8"),Mt(H),Ve(!1);return}$e("")},Et=(m=!0)=>{Z(m),m&&(U(S||""),t())},Ue=(m,z)=>{if(K(z),z?E(m):v(m),g&&s&&r&&+O&&+m)if(z){g.coin_type===s.coin_type?v(R(m).div(O).toString().toString()):v(R(m).mul(O).toString().toString());return}else{g.coin_type===r.coin_type?E(R(m).div(O).toString().toString()):E(R(m).mul(O).toString().toString());return}z?v(""):E("")},Ge=(m,z)=>{Qe(),K(z),Z(!0),z?m.coin_type===(r==null?void 0:r.coin_type)?a(`/limit/${m==null?void 0:m.coin_type}/${s==null?void 0:s.coin_type}`):a(`/limit/${m==null?void 0:m.coin_type}/${r==null?void 0:r.coin_type}`):m.coin_type===(s==null?void 0:s.coin_type)?a(`/limit/${r==null?void 0:r.coin_type}/${m==null?void 0:m.coin_type}`):a(`/limit/${s==null?void 0:s.coin_type}/${m==null?void 0:m.coin_type}`)},Ht=async()=>{r&&(Ge(r,!0),E(P),v(_))},Qe=()=>{E(""),v("")};p.useEffect(()=>()=>{y("7 Days")},[]);const[Rt,ve]=p.useState(!1),Ft=m=>{switch(m){case"5 Minutes":return 3e5;case"10 Minutes":return 6e5;case"30 Minutes":return 18e5;case"1 Hour":return 36e5;case"1 Day":return 864e5;case"3 Days":return 2592e5;case"7 Days":return 6048e5;case"1 Month":return 2592e6;default:return 0}},{showInsufficientBalanceToast:zt}=Xt(),{transactionConfirmation:Nt}=de(),Dt=async()=>{const m={getShowInfo:(W,se)=>{const H="Creating order",le={modalDescriptionText:H,toastTitleText:H};return W==="success"&&(le.toastDescriptionContent="",le.modalDescriptionText="Created order successfully",le.toastTitleText="Created order successfully"),W==="rejected"&&(le.toastTitleText="Create order"),le}};Nt(m);const z=Date.parse(new Date().toString())+(Ft(w)||M);ve(!0);let G;(g==null?void 0:g.coin_type)===(r==null?void 0:r.coin_type)?G=O:G=R(1).div(O).toFixed(r.decimals);try{const W={pay_coin_type:s.coin_type,target_coin_type:r.coin_type,expired_ts:z,target_decimal:r.decimals,pay_decimal:s.decimals,price:Number(G),pay_coin_amount:Number(Ze(_,s.decimals).toFixed(0))},se=await x.LimitOrder.placeLimitOrder(W),H=await u(se,m);ve(!1),H&&(n(),i(),Qe())}catch(W){zt(String(W)),ve(!1)}},{currentAccount:ae}=te(),Je=p.useMemo(()=>{const m=h(s==null?void 0:s.coin_type,_);return Number(m)==0&&Number(_)>0?!1:Number(m)<5},[s,_]),Wt=p.useMemo(()=>{const m={text:"Place Limit Order",disabled:!1};return ae!=null&&ae.address?!s||!r?(m.disabled=!0,m.text=" Select a token",m):!Number(_)||!Number(P)?(m.disabled=!0,m.text="Enter an amount",m):Je?(m.disabled=!0,m.text="Order size should be higher than $5",m):Number(_)>Number(D==null?void 0:D.balanceFormat)||!(D!=null&&D.balanceFormat)?(m.disabled=!0,m.text=`Insufficient ${s==null?void 0:s.symbol} balance`,m):(ce&&ce.errorCode&&(ce.errorCode===Ie.NoRouter||ce.errorCode===Ie.HoneyPot)&&(m.text="No Available Route",m.disabled=!0),m):(m.disabled=!1,m.text="Connect Wallet",m)},[ae==null?void 0:ae.address,s,r,ce,_,P,Je,D]);return{priceImpactInfoLoading:At,priceImpactInfo:Pt,fixPayCoin:$,onReverseClick:Ht,handleSelectToken:Ge,marketPrice:S,payCoin:s,targetCoin:r,handleAmountChange:Ue,payAmount:_,targetAmount:P,payBalanceInfo:D,targetBalanceInfo:De,payAmountValue:St,targetAmountValue:Ct,useMarketPrice:B,handleMarketPriceClick:Et,inputPrice:O,setInputPrice:U,priceImpact:Lt,quoteToken:g,setQuoteToken:C,handleSubmitOrder:Dt,submitOrderLoading:Rt,buttonTextStatus:Wt}}const _s=({confirmData:t,isOpen:n,onClose:i,handleSubmitOrder:u,submitOrderLoading:x})=>{var g,w,T,L;const{payAmount:d,targetAmount:j,payCoin:h,targetCoin:a,inputPrice:c,expiresIn:l,quoteToken:o}=t,s=((g=o==null?void 0:o.coin_type)==null?void 0:g.toLowerCase())==((w=a==null?void 0:a.coin_type)==null?void 0:w.toLowerCase())?c:R(1).div(c).toString(),r=((T=o==null?void 0:o.coin_type)==null?void 0:T.toLowerCase())==((L=a==null?void 0:a.coin_type)==null?void 0:L.toLowerCase())?R(1).div(c).toString():c;return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:n,onClose:i,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsx(lt,{fontWeight:"500",fontSize:"16px",children:"Review your order"})}),e.jsx(He,{}),e.jsx(Re,{textAlign:"center",p:"0px",children:e.jsxs(k,{w:"100%",gap:"16px",p:"16px",children:[e.jsx(as,{coinA:{amount:N(d,h==null?void 0:h.decimals).toString()||"0",...h},iconParams:{xlinkHref:"#icon-a-icon_trade",svgFill:"text_caption",fontSize:"12px"},coinB:{amount:N(j,a==null?void 0:a.decimals).toString()||"0",...a}}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Price"}),e.jsx(oe,{info:{pay_coin:h,target_coin:a,price:s,reseverPrice:r}})]}),e.jsxs(b,{w:"100%",justify:"space-between",children:[e.jsx(f,{children:"Expires in"}),e.jsx(f,{color:"text_caption",children:l})]}),e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"You will receive exactly what you have specified if your order is fully filled in the end."})}),e.jsx(V,{borderRadius:"8px",p:"8px",children:e.jsx(f,{lineHeight:"20px",textAlign:"left",fontSize:"12px",children:"Please note that your order may not be filled immediately after the price is triggered, depending on pending sequence and liquidity depth."})}),e.jsx(I,{onClick:()=>{u(),i()},disabled:x,w:"calc(100% + 32px)",mb:"-30px",h:"52px",fontWeight:"500",children:"Place Order"})]})})]})]})},ws=({isOpen:t,onClose:n})=>{const{isApp:i}=ie(),{setCustomExpiresVal:u,setExpiresIn:x}=re(),[d,j]=p.useState(""),[h,a]=p.useState(""),c=T=>{const L=T.target.value.replace(/[^\d]/g,"");j(L)},l=T=>{const L=T.target.value.replace(/[^\d]/g,"");a(L)},[o,s]=p.useState({}),r=(T,L)=>{const C=Number(T||0)*60+Number(L||0),M=Math.floor(C/(60*24)),y=Math.floor(C%(60*24)/60),A=C%60;let _="";M>0&&(_+=M+"d "),y>0&&(_+=y+"h "),A>0&&(_+=A+"m "),s({timeText:_.trim()||"0 m",time:C*60*1e3})};p.useEffect(()=>{r(d,h)},[d,h]);const g=p.useMemo(()=>!d&&!h||Number(d)==0&&!h||Number(h)==0&&!d||Number(d)==0&&Number(h)==0,[d,h]),w=()=>{x(o==null?void 0:o.timeText),u(o==null?void 0:o.time),n()};return e.jsxs(Pe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:t,onClose:n,isCentered:!0,children:[e.jsx(Me,{}),e.jsxs(Ae,{maxW:"1200px",w:i?"calc(100vw - 32px)":"440px",children:[e.jsx(Ee,{mr:"-10px",children:e.jsxs(b,{w:"100%",gap:"24px",justify:"space-between",align:"center",children:[e.jsx(f,{fontSize:"16px",fontWeight:"500",color:"text_caption",children:"Custom Expiry Period"}),e.jsx(b,{gap:"0",align:"center",children:e.jsx(He,{mt:"0",position:"static"})})]})}),e.jsx(Re,{p:{base:"8px 16px",lg:"16px"},pt:"0 !important",children:e.jsxs(k,{w:"100%",children:[e.jsx(je,{children:e.jsxs(b,{children:[e.jsx(Xe,{value:d,onChange:c,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(f,{children:"Hours"})]})}),e.jsx(je,{children:e.jsxs(b,{children:[e.jsx(Xe,{value:h,onChange:l,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsx(f,{children:"Minutes"})]})}),e.jsx(I,{onClick:w,disabled:g,w:"calc(100% + 32px)",mb:"-30px",mt:"12px",h:"52px",fontWeight:"500",children:"Set Period"})]})})]})]})};function ys(t){const{expiresIn:n,setExpiresIn:i}=re(),[u,x]=p.useState(!1),d=["5 Minutes","10 Minutes","30 Minutes","1 Hour","1 Day","3 Days","7 Days","1 Month","Custom"];return e.jsxs(je,{w:"156px",borderRadius:"16px",children:[e.jsxs(k,{w:"100%",h:"100%",gap:"20px",alignItems:"start",justify:"space-between",sx:{button:{w:"100%",h:"23px",">span":{">div":{display:"flex",justifyContent:"space-between",p:{fontSize:"16px"}}}}},children:[e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"280px",children:"No extra cancellation fee will be charged for order expiry or cancellation. Gas will be consumed upon manual cancellation."}),children:e.jsxs(b,{gap:"4px",children:[e.jsx(f,{fontSize:"13px",fontWeight:"500",children:"Expires in"}),e.jsx(q,{xlinkHref:"#icon-icon_tips"})]})}),e.jsx(ts,{label:n,list:d,onListItemClick:j=>{j=="Custom"?x(!0):i(j)}})]}),u&&e.jsx(ws,{isOpen:u,onClose:()=>x(!1)})]})}function Ss(t){ie();const{marketPrice:n,priceImpactInfo:i,priceImpactInfoLoading:u,priceImpact:x,inputPrice:d,handleMarketPriceClick:j,setInputPrice:h}=t,{payCoin:a,targetCoin:c,quoteToken:l,refreshPriceLoading:o,setQuoteToken:s}=re();return e.jsx(je,{w:"calc(100% - 156px)",children:e.jsxs(k,{w:"100%",gap:"20px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsxs(b,{children:[e.jsx(f,{fontSize:"13px",fontWeight:"500",children:(l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?`Buy ${qe(c==null?void 0:c.symbol,10)} at rate`:`Sell ${qe(a==null?void 0:a.symbol,10)} at rate`}),Number(x)!==0&&!o&&(u?e.jsx(Yt,{size:"sm"}):e.jsx(Ne,{placement:"top",tooltip:e.jsx(f,{fontSize:"12px",lineHeight:"20px",maxW:"220px",children:i.tooltip}),children:e.jsxs(f,{color:i.color,children:[R(x).gt(0)?"+":"",Number(x)>1e4?">10000%":rt(x)]})}))]}),(n||o)&&e.jsx(I,{isLoading:o,loadingText:"Market",minW:"58px",h:"22px",pl:"4px",pr:"4px",color:"primary_gray",borderRadius:"4px",variant:"outline",fontWeight:"500",fontSize:"12px",onClick:()=>j(!0),children:"Market"})]}),e.jsxs(b,{w:"100%",justifyContent:"space-between",children:[e.jsx(pt,{value:d?Ut(d).toString():"",onChange:r=>{j(!1),h(r)},decimals:18,placeholder:"0.0",style:{width:"calc(100% - 8px)",background:"none",whiteSpace:"nowrap",opacity:1,outline:"none",color:"var(--chakra-colors-text_caption)",fontSize:"20px",touchAction:"manipulation",transition:"all 0.3s"}}),e.jsxs(b,{gap:"4px",children:[e.jsx(f,{textColor:"text_caption",children:l==null?void 0:l.symbol}),e.jsx(q,{xlinkHref:"#icon-icon_swap1",onClick:()=>{c&&a&&((l==null?void 0:l.coin_type)===(a==null?void 0:a.coin_type)?s(c):s(a))}})]})]})]})})}function Cs(){const{expiresIn:t}=re(),{buttonTextStatus:n,payBalanceInfo:i,targetBalanceInfo:u,payAmountValue:x,targetAmountValue:d,payAmount:j,targetAmount:h,payCoin:a,targetCoin:c,marketPrice:l,handleAmountChange:o,handleMarketPriceClick:s,handleSelectToken:r,inputPrice:g,setInputPrice:w,priceImpact:T,quoteToken:L,handleSubmitOrder:C,submitOrderLoading:M,onReverseClick:y,priceImpactInfoLoading:A,priceImpactInfo:_}=fs(),E=p.useMemo(()=>({payAmount:j,targetAmount:h,payCoin:a,targetCoin:c,inputPrice:g,expiresIn:t,quoteToken:L}),[j,h,a,c,g,t,L]),{onWalletModal:P}=te(),[v,$]=p.useState("#icon-a-icon_trade"),K=S=>$(S?"#icon-icon_swap1":"#icon-a-icon_trade"),[B,Z]=p.useState(!1),O=ut(),U=p.useMemo(()=>{const S=[];return a&&S.push(a),c&&S.push(c),S},[a,c]);return e.jsxs(k,{w:{base:"100%",lg:"470px"},gap:"8px",mb:"8px",children:[e.jsxs(b,{w:"100%",justifyContent:"space-between",mb:"8px",children:[e.jsx(ns,{currTradeTab:is.Limit}),e.jsx(ss,{})]}),e.jsx(It,{onClick:y,from:{title:"You Pay",balance:(i==null?void 0:i.balanceFormat)||"",value:j,amountValue:x,onChange:S=>{o(S,!0)},selectable:!0,placeholder:"0.0",token:a,onTokenChange:S=>{r(S,!0)}},to:{title:"You Receive",balance:(u==null?void 0:u.balanceFormat)||"",value:h,amountValue:d,onTokenChange:S=>{r(S,!1)},onChange:S=>{o(S,!1)},selectable:!0,placeholder:"0.0",token:c,half:!1,max:!1},iconParams:{xlinkHref:v,svgFill:"text_caption",transform:v==="#icon-a-icon_trade"?"":"rotate(90deg)",fontSize:v==="#icon-a-icon_trade"?"12px":"16px",onMouseEnter:()=>K(!0),onMouseLeave:()=>K(!1)}}),e.jsxs(b,{w:"100%",justifyContent:"space-between",alignItems:"stretch",gap:"8px",flexDirection:{base:"column",lg:"row"},sx:{">div":{w:{base:"100% !important"}}},children:[e.jsx(Ss,{marketPrice:l,priceImpactInfoLoading:A,priceImpactInfo:_,priceImpact:T,inputPrice:g,setInputPrice:w,handleMarketPriceClick:s}),e.jsx(ys,{})]}),(_==null?void 0:_.text)&&l&&Number(T)!==0&&g&&e.jsxs(f,{color:_==null?void 0:_.color,lineHeight:"20px",bg:_==null?void 0:_.bg,p:"12px",borderRadius:"8px",children:[_==null?void 0:_.text," ",e.jsx(f,{color:_==null?void 0:_.color,textDecoration:"underline",as:"span",cursor:"pointer",onClick:()=>O(`/swap/${a==null?void 0:a.coin_type}/${c==null?void 0:c.coin_type}`),children:"Cetus Swap"})," instead."]}),e.jsx(I,{disabled:(n==null?void 0:n.disabled)||M,isLoading:M,mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",onClick:(n==null?void 0:n.text)=="Connect Wallet"?()=>P(!0):()=>Z(!0),children:n==null?void 0:n.text}),B&&e.jsx(_s,{confirmData:E,isOpen:B,onClose:()=>Z(!1),handleSubmitOrder:C,submitOrderLoading:M}),(a||c)&&e.jsx(es,{addToken:!0,tokensInfo:U,waringModalCancel:S=>{S.forEach(D=>{(D.coin_type===(a==null?void 0:a.coin_type)||D.coin_type===(c==null?void 0:c.coin_type))&&r(void 0,D.coin_type===(a==null?void 0:a.coin_type))})}})]})}function vs({orderInfo:t}){return e.jsxs(fe.Fragment,{children:[e.jsxs(Y,{cursor:"pointer",sx:{td:{pb:"16px !important"}},children:[e.jsx(F,{w:"30%",children:e.jsx(xe,{info:t})}),e.jsx(F,{w:"20%",textAlign:"right",children:e.jsx(oe,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(me,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(ue,{info:t})}),e.jsx(F,{textAlign:"right",children:e.jsx(Oe,{orderInfo:t})})]}),e.jsx(Y,{h:"16px"})]},t==null?void 0:t.order_id)}function Ls(){const{currentAccount:t,onWalletModal:n}=te(),{myOrderList:i,orderListLoading:u}=ye(),x=10,[d,j]=p.useState([]),[h,a]=p.useState(0),[c,l]=p.useState(1);return p.useEffect(()=>{if((i==null?void 0:i.length)>0){a(i==null?void 0:i.length);const o=(c-1)*x,s=o+x;j(i.slice(o,s))}},[c,i]),e.jsxs(gt,{variant:"simple_list",w:"100%",sx:{td:{h:"60px !important"}},children:[e.jsx(ht,{children:e.jsxs(Y,{children:[e.jsx(J,{children:"Order Info"}),e.jsx(J,{textAlign:"right",children:"Price"}),e.jsx(J,{textAlign:"right",children:"Filled Size"}),e.jsx(J,{textAlign:"right",children:"Expiry"}),e.jsx(J,{textAlign:"right",children:"Action"})]})}),e.jsx(jt,{children:t!=null&&t.address?u?e.jsx(mt,{itemList:[1,2,3],skeletonNum:5,rowStyle:{h:"66px"}}):i.length===0?e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nodata",text:"You don't have any open orders yet.",borderRadius:"16px"})})}):e.jsxs(fe.Fragment,{children:[d.map(o=>e.jsx(vs,{orderInfo:o},o.order_id)),!u&&(i==null?void 0:i.length)>x&&e.jsx(F,{colSpan:5,w:"100%",pt:"0px !important",children:e.jsx(pe,{w:"100%",children:e.jsx(_e,{total:h,size:x,currentPage:c,onChange:l})})})]}):e.jsx(Y,{sx:{td:{bg:"none !important",p:"0 !important",border:"none !important"},_hover:{bg:"none !important",border:"none !important"}},children:e.jsx(F,{colSpan:5,w:"100%",children:e.jsx(ee,{type:"nowallet",onboard:()=>{n(!0)},borderRadius:"16px"})})})})]})}function Os(){const{fetchByApi:t}=Gt(),{fetchTokenInfo:n}=ze(),{currentAccount:i}=te(),[u,x]=p.useState(!1),[d,j]=p.useState([]);p.useEffect(()=>{j([])},[i==null?void 0:i.address]);const h=async(c,l)=>{try{l&&x(!0);const o=await t(os,"GET",{wallet_address:c});if(o!=null&&o.list){const s=await a((o==null?void 0:o.list)||[]);return j(s),s}}catch{}finally{x(!1)}},a=async c=>{const l=[];for(const o of c){const[s,r]=await Promise.all([n(o.pay_coin),n(o.target_coin)]);if(s&&r){const{total_pay_amount:g,remaining_amount:w,rate:T,obtained_amount:L,claimed_amount:C,target_balance:M,created_ts:y,expire_ts:A,cancel_reason:_,events:E}=o,P=E;P.sort((O,U)=>U.block_time-O.block_time);const v=ne(g,s.decimals).toString(),$=ct.rateToPrice(T.toString(),s.decimals,r.decimals),K=Q(1).div($).toString(),B=ne(Q(g).sub(w).toFixed(0),s.decimals).toString(),Z={order_id:o.order_id,pay_coin:s,target_coin:r,price:$,reseverPrice:K,total_pay_amount:v,remaining_amount:w,deal_amount:B,deal_rate:Q(B).div(v).toString(),expect_obtain_amount:Q(v).mul($).toString(),obtained_amount:L,claimed_amount:C,un_claimed_amount:"0",created_ts:y,expire_ts:A,status:Number(_)===0?ge.Completed:ge.Cancelled,events:P};l.push(Z)}}return l.sort((o,s)=>s.created_ts=o.created_ts),l};return{getLimitOrderHistory:h,historyOrderLoading:u,historyOrderList:d}}function Tn(){const{currentAccount:t}=te(),{getLimitOrderHistory:n,historyOrderList:i,historyOrderLoading:u}=Os(),{fetchMyLimitOrder:x}=Se(),{setMyOrderList:d,myOrderList:j,orderListLoading:h}=ye(),{payCoin:a,targetCoin:c}=re(),{fetchAccountBalance:l}=we();p.useEffect(()=>{t!=null&&t.address&&l()},[]);const{isShowTradeChart:o,isShowTradeOrders:s}=cs(),[r,g]=p.useState([]),[w,T]=p.useState({label:"Open Orders"}),L=p.useMemo(()=>{const v=[];return v.push({label:"Open Orders",num:w.label==="Open Orders"&&j.length>0&&!h?j.length.toString():void 0}),v.push({label:"Order History",num:w.label==="Order History"&&r.length>0&&!u?r.length.toString():void 0}),v},[w.label,j,r,u,h]);p.useEffect(()=>{C(!0)},[w.label,t,s]),ls({onRpcChange:()=>{C(!0),t!=null&&t.address&&l()}});const C=v=>{s&&(P(0),t!=null&&t.address&&(w.label==="Open Orders"?x(t.address,v):n(t.address,v)))};p.useEffect(()=>{t!=null&&t.address&&(i==null?void 0:i.length)>0?g(i):(g([]),d([]))},[i,t==null?void 0:t.address]);const M=v=>{T(v)},{windowWidth:y,isApp:A}=ie(),{refreshCoinMarketPrice:_}=yt(),[E,P]=p.useState(0);return Qt({interval:1e3,callback:()=>{P(E+1),E>=20&&(P(0),_(),t!=null&&t.address&&l(),C(!1))}}),e.jsxs(k,{mt:y&&y<1024?"28px":"42px",w:"100%",gap:"0px",className:A||o||s?"":"bg_img",children:[e.jsxs(b,{w:"100%",justifyContent:"center",alignItems:"start",gap:"16px",flexDirection:{base:o?"column":"column-reverse",lg:"row"},children:[(s||o)&&e.jsx(b,{gap:"8px",w:{base:"100%",lg:"calc(100% - 470px)"},children:o?e.jsx(rs,{baseToken:a,quoteToken:c}):e.jsxs(k,{w:"100%",children:[e.jsx(it,{tabList:L,currTab:w,myOrderList:j,handleChangeTab:M,handleGetOrderList:C}),w.label==="Open Orders"&&e.jsx(st,{}),w.label==="Order History"&&e.jsx(nt,{historyOrderList:r,historyOrderLoading:u})]})}),e.jsx(Cs,{})]}),s&&o&&e.jsxs(k,{w:"100%",gap:"0",align:"flex-start",mt:{base:"8px",lg:"0px"},children:[e.jsx(it,{handleGetOrderList:()=>C(!0),tabList:L,currTab:w,myOrderList:j,handleChangeTab:M}),A&&e.jsx(xt,{h:"16px"}),w.label==="Open Orders"&&(A?e.jsx(st,{}):e.jsx(Ls,{})),w.label==="Order History"&&(A?e.jsx(nt,{historyOrderList:r,historyOrderLoading:u}):e.jsx(hs,{historyOrderList:r,historyOrderLoading:u}))]})]})}const it=({tabList:t,currTab:n,myOrderList:i,handleChangeTab:u,handleGetOrderList:x})=>{const{handleCancelOrder:d,cancelOrderLoading:j}=_t(),{isApp:h}=ie(),a=n.label==="Open Orders"&&i.length>1;return e.jsxs(b,{w:"100%",justifyContent:"space-between",flexDirection:{base:n.label==="Open Orders"&&i.length>1?"column":"row",lg:"row"},gap:{base:"16px",lg:"8px"},children:[e.jsxs(b,{w:{base:"100%",lg:"395px"},justifyContent:"space-between",children:[e.jsx(dt,{type:"borderTab",wrapStyle:{w:"100%",h:"52px",gap:"32px",bg:"none",border:"none",mb:{base:"0px",lg:"8px"}},itemStyle:{fontSize:"16px"},tabList:t,currentTab:n.label,handleChangeTab:u}),h&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]}),(!h||a)&&e.jsxs(b,{gap:"8px",w:{base:"100%",lg:"unset"},children:[a&&e.jsx(I,{onClick:()=>{d(i)},disabled:j,isLoading:j,h:"28px",minH:"unset",borderRadius:"8px",fontSize:"14px",variant:"outline",color:"primary_gray",w:{base:"100%",lg:"92px"},mb:{base:"-8px",lg:"0"},_hover:{color:"text_caption"},children:"Cancel All"}),!h&&e.jsx(tt,{handleRefresh:x,w:"28px",h:"28px",innerStyle:{bg:"none"}})]})]})};export{Tn as default};
