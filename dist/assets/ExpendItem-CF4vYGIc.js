import{R as M,r as L,j as t,H as S,aC as H,T,a1 as W,b as $,a as V,aO as k,I as G,c as K,V as p,$ as C,S as J,a$ as O}from"./index-VLgXFcAE.js";import{u as Q}from"./useAccountBalance-DFcM11B7.js";import{u as X}from"./useTransaction-CwuJvIz0.js";import{M as U}from"./msafe-oYBkW7LJ.js";import{c as Y,d as Z,b as D}from"./usePositionList-4KJFm0UW.js";import{C as f}from"./CetusTooltip-CS_PI-uB.js";import{S as I}from"./SingleTokenInfo-fnjtOwas.js";import{u as ee}from"./useToken-BPa2fJ0v.js";import{P as ae,L as se}from"./PriceRange-_k4AK1vq.js";function te(){const{peripherySdk:e}=M();return{getStakeTxPayload:async(m,r)=>{const x={pool_id:r,clmm_position_id:m},s=await e.Farms.depositPayload(x),o={action:U.FarmingStake,txbParams:x};return{tx:s,msafeParams:o}},getUnstakeTxPayload:async(m,r)=>{const x={pool_id:m,position_nft_id:r},s=await e.Farms.withdrawPayload(x),o={action:U.FarmingUnstake,txbParams:x};return{tx:s,msafeParams:o}},getHarvestFarmsTxPayload:async(m,r)=>{const x={pool_id:m,position_nft_id:r},s=await e.Farms.harvestPayload(x),o={action:U.FarmingHarvest,txbParams:x};return{tx:s,msafeParams:o}},getBatchHarvestFarmsTxPayload:async m=>({tx:await e.Farms.batchHarvestPayload(m),msafeParams:{action:"FarmingBatchHarvest",txbParams:m}})}}function re(){const{getBatchHarvestFarmsTxPayload:e,getStakeTxPayload:d,getUnstakeTxPayload:b,getHarvestFarmsTxPayload:i}=te(),{signAndExecuteTransaction:y}=X(),[m,r]=L.useState(!1),[x,s]=L.useState(!1),{fetchAccountBalance:o}=Q();return{toStakePos:async(w,h,g,u)=>{s(!0);try{const{tx:n,msafeParams:c}=await d(w,h);console.log("ðŸš€ ~ toStakePos ~ tx:",n);const l=await y(n,{getShowInfo:()=>({modalDescriptionText:`Stake ${g}`,toastTitleText:"Stake"})},{msafeParams:c});l&&(console.log("ðŸš€ ~ toStakePos ~ res:",l),u(l.events)),s(!1)}catch(n){console.log("ðŸš€ ~ toStakePos ~ error:",n),s(!1)}},toUnStakePos:async(w,h,g,u)=>{s(!0);try{const{tx:n,msafeParams:c}=await b(h,w);console.log("ðŸš€ ~ toUnstack ~ tx:",n);const l=await y(n,{getShowInfo:()=>({modalDescriptionText:`Unstake ${g}`,toastTitleText:"Unstake"})},{msafeParams:c});console.log("ðŸš€ ~ toUnStakePos ~ res:",l),l&&(o(),u()),s(!1)}catch(n){console.log("ðŸš€ ~ toUnStakePos ~ error:",n),s(!1)}},toClaimPos:async(w,h,g)=>{r(!0);try{const{tx:u,msafeParams:n}=await i(h,w);console.log("ðŸš€ ~ toClaimPos ~ tx:",u);const c=await y(u,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:n});console.log("ðŸš€ ~ toClaimPos ~ res:",c),c&&(o(),g()),r(!1)}catch(u){r(!1),console.log("ðŸš€ ~ toClaimPos ~ error:",u)}},toClaimAllPos:async(w,h)=>{r(!0);try{const g=[];w.forEach(l=>{l!=null&&l.farmsPool&&g.push({pool_id:l.farmsPool,position_nft_id:l.id})}),console.log("ðŸš€ ~ list.forEach  toClaimAllPos ~ params:",g);const{tx:u,msafeParams:n}=await e(g);console.log("ðŸš€ ~ toClaimAllPos ~ tx:",u);const c=await y(u,{getShowInfo:()=>({modalDescriptionText:" Claim rewards",toastTitleText:" Claim"})},{msafeParams:n});console.log("ðŸš€ ~ toClaimAllPos ~ res:",c),c&&setTimeout(async()=>{o(),h()},2e3),r(!1)}catch(g){r(!1),console.log("ðŸš€ ~ toClaimAllPos ~ error:",g)}},claimLoading:m,unstakeLoading:x}}function ye({positionInfo:e,apiInfo:d}){var F,z;const{farmsPosRewardsData:b,posPoolsRelatedData:i,posPoolsOriginalData:y}=Y(),{getPositionBaseList:m}=Z(),{currentAccount:r}=W(),{isApp:x}=$(),s=b[e==null?void 0:e.id],o=s==null?void 0:s.reduce((a,P)=>a+P.display_amount_owed,0),_=i[e==null?void 0:e.posId],R=(_==null?void 0:_.currentStatus)=="Active",{getClmmPosName:B}=D(),v=L.useMemo(()=>{var a;if(e!=null&&e.tokenName)return e==null?void 0:e.tokenName;{const P=(a=y==null?void 0:y[e==null?void 0:e.clmmPool])==null?void 0:a.index;return B(e==null?void 0:e.index,P)}},[e==null?void 0:e.tokenName,e==null?void 0:e.index,e==null?void 0:e.clmmPool,y]),w=V(),h=()=>{setTimeout(async()=>{await m(r==null?void 0:r.address)},2e3)},{toStakePos:g,toUnStakePos:u,toClaimPos:n,unstakeLoading:c,claimLoading:l}=re(),A=async a=>{g(e==null?void 0:e.id,d==null?void 0:d.farmsPoolAddress,v,h)},q=async()=>{u(e==null?void 0:e.id,e==null?void 0:e.farmsPool,v,h)},E=async()=>{n(e==null?void 0:e.id,e==null?void 0:e.farmsPool,h)},j=L.useMemo(()=>(s==null?void 0:s.length)>0?s.reduce((a,P)=>k(a).plus(P==null?void 0:P.display_amount_owed).toString(),"0"):"0",[s,r==null?void 0:r.address,l,c]);return console.log("ðŸš€ ~ totalAmount ~ totalAmount:",j),t.jsxs(S,{bg:"bg_primary",w:"100%",gap:"16px",borderRadius:{base:"12px",lg:"20px"},border:{base:"none",lg:"1px solid"},borderColor:"border !important",p:"12px",justifyContent:"space-between",flexDirection:{base:"column",lg:"row"},children:[t.jsx(ae,{positionInfo:e,symbolEllipsesDecimals:10,labelInfo:{text:v,style:{color:"text_caption",mb:"-2px"}},children:t.jsxs(S,{justify:"center",h:{base:"14px",lg:"20px"},borderRadius:"4px",p:"0px",mb:{base:"0",lg:"-2px"},cursor:"pointer",onClick:a=>{K(a),w(`/position-detail/${e==null?void 0:e.id}`)},sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[t.jsx(T,{fontSize:"12px",color:"primary",children:"Manage position"}),t.jsx(G,{ml:"-8px",svgW:"12px",svgH:"12px",xlinkHref:"#icon-icon_arrow",variant:"gray",transition:"transform 0.5s",transform:"rotate(-90deg)"})]})}),t.jsxs(S,{w:{base:"100%",lg:"unset"},gap:{base:"8px",lg:"40px"},flexDirection:{base:"column",lg:"row"},children:[t.jsxs(p,{w:{base:"100%",lg:"unset"},align:"flex-start",justify:"space-between",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[t.jsx(T,{color:"primary_gray",mb:"-12px",mt:"12px",children:"Liquidity"}),t.jsx(se,{positionInfo:e,fontSize:"14px"})]}),t.jsxs(p,{justify:"space-between",w:{base:"100%",lg:"unset"},minW:{base:"100%",lg:"180px"},align:"flex-end",gap:"4px",flexDirection:{base:"row",lg:"column"},children:[t.jsxs(S,{gap:"4px",children:[t.jsx(T,{color:"primary_gray",children:"Earnings"}),!x&&t.jsx(C,{isLoading:l,disabled:c||l||k(o).eq(0),onClick:c||l||k(o).eq(0)?()=>{}:E,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]}),t.jsxs(S,{children:[t.jsx(J,{isLoaded:!!j,children:t.jsx(p,{align:"flex-end",children:s&&(s==null?void 0:s.length)>0&&k(j).gt(0)?s==null?void 0:s.map(a=>{var P;return console.log("ðŸš€ ~ ExpendItem ~ posFarmsData && posFarmsData?.length > 0 && d(totalAmount).gt(0) :",s,(s==null?void 0:s.length)>0,j,k(j).gt(0)),t.jsx(O.Fragment,{children:k(a==null?void 0:a.display_amount_owed).gt(0)&&t.jsx(N,{coinType:(P=a==null?void 0:a.token)==null?void 0:P.coin_type,amount:(a==null?void 0:a.display_amount_owed)||0,tokenInfo:a==null?void 0:a.token},a==null?void 0:a.coinType)},a==null?void 0:a.rewarder_type)}):((F=d==null?void 0:d.farmsRewarderList)==null?void 0:F.length)>0?(z=d==null?void 0:d.farmsRewarderList)==null?void 0:z.map(a=>(console.log("ðŸš€ ~ apiInfo?.farmsRewarderList?.map ~ item:",a),t.jsx(N,{coinType:a==null?void 0:a.coinType,amount:"0"},a==null?void 0:a.coinType))):t.jsx(T,{textColor:"text_caption",textAlign:"right",children:"--"})})}),x&&t.jsx(C,{isLoading:l,disabled:c||l||k(o).eq(0),onClick:c||l||k(o).eq(0)?()=>{}:E,h:"20px",w:"48px",fontSize:"12px",borderRadius:"4px",variant:"outline",children:"Claim"})]})]}),t.jsxs(p,{mt:{base:"8px",lg:"0"},w:{base:"100%",lg:"unset"},children:[(e==null?void 0:e.posType)=="farms"&&t.jsx(C,{disabled:c,isLoading:c,variant:"outline",w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:q,children:"Unstake"}),(e==null?void 0:e.posType)=="clmm"&&!R&&t.jsx(f,{placement:"top",tooltip:t.jsx(T,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:t.jsx(C,{disabled:!0,borderRadius:"8px",w:{base:"calc(100vw - 68px)",lg:"100px"},h:"32px",fontSize:"14px",children:"Stake"})}),(e==null?void 0:e.posType)=="clmm"&&R&&t.jsx(C,{disabled:c,isLoading:c,w:{base:"100%",lg:"100px"},h:"32px",borderRadius:"8px",fontSize:"14px",onClick:A,children:"Stake"})]})]})]})}const N=({coinType:e,amount:d,tokenInfo:b,boxStyle:i,textAlign:y="right"})=>{var x;console.log("ðŸš€ ~ RewardsCon ~ coinType:",e,d);const{getTokenInfo:m}=ee(),r=s=>{if(s)try{return m(s)}catch(o){console.error("Error fetching token info:",o)}};return t.jsxs(S,{gap:"0",...i,children:[t.jsx(I,{token:b||r(H(e)),coinType:H(e),imgBoxStyle:{w:"20px",h:"20px"},warningIcon:{iconW:"10px",iconH:"10px"},haveName:!1,haveSymbol:!1}),t.jsxs(T,{textColor:"text_caption",textAlign:y,children:[d," ",(b==null?void 0:b.symbol)||((x=r(H(e)))==null?void 0:x.symbol)]})]})};export{ye as E,N as R,re as u};
