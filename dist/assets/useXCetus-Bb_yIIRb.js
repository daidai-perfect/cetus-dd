import{a as m,j as e,X as xe,Y as pe,Z as me,$ as he,a8 as Ce,a0 as be,a1 as ge,V as B,H as F,T as v,v as te,f as ae,a2 as Se,a3 as we,a4 as Te,a5 as ve}from"./vendor-DXHkIl66.js";import{u as W}from"./useTransaction-BTAziacg.js";import{j as P,k as U,as as M,w as I,d as Z,t as ee,C as Q,M as O,p as se,i as ye,B as oe,am as re,a as ie,c as G,v as K,F as ke,n as je,aY as Ie,aZ as Re,aR as Me,al as _e,ar as De,a0 as Y,aK as Ae}from"./index-D9pp8Hi3.js";import{M as H}from"./msafe-oYBkW7LJ.js";import{u as V}from"./useAccountBalance-B_3a4s2o.js";import{u as ce}from"./useTokenBalance-B5WtMwBb.js";import{u as q,d as $,e as le,f as Le,g as Oe,h as Pe}from"./useXCetusHelper-oVCqL6mQ.js";import{T as de}from"./TradeInputGroup-DQUP8Off.js";import{H as Ue}from"./HTextLabelBox-DZ_tWilY.js";import{C as Ee}from"./CheckBox-B9E3zwgj.js";import{H as Xe}from"./HighlightText-BLaAjUt8.js";import{u as Fe}from"./activeOrders-DsiJE7C1.js";const st=(x,r,c="seconds")=>{const s=()=>{const t=x-new Date().getTime();if(t<=0)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0};const i=Math.floor(t/1e3%60),d=Math.floor(t/1e3/60%60),n=Math.floor(t/(1e3*60*60)%24),a=Math.floor(t/(1e3*60*60*24)%30),h=Math.floor(t/(1e3*60*60*24*30)%12),b=Math.floor(t/(1e3*60*60*24*365));return c==="days"?{years:0,months:0,days:a+h*30+b*365,hours:n,minutes:d,seconds:i}:c==="months"?{years:0,months:h+b*12,days:a,hours:n,minutes:d,seconds:i}:{years:b,months:h,days:a,hours:n,minutes:d,seconds:i}},[o,l]=m.useState(s());return m.useEffect(()=>{const u=setInterval(()=>{const t=s();l(t),t.years===0&&t.months===0&&t.days===0&&t.hours===0&&t.minutes===0&&t.seconds===0&&(clearInterval(u),r&&r())},1e3);return()=>clearInterval(u)},[x]),o};function Be(){const{fetchAccountBalance:x}=V(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{currentAccount:s}=P(),{fetchOwnerVeNFT:o}=$(),{xCetusSdk:l}=U(),{veNFT:u}=M(),[t,i]=m.useState(""),[d,n]=m.useState(""),{balanceInfo:a}=ce(I.cetus_coin),h=f=>{i(f),n(f)},[b,y]=m.useState(!1),g=async()=>{y(!0);const f={venft_id:u==null?void 0:u.id,amount:ee(t,9).toFixed(0)},_=await l.XCetusModule.convertPayload(f),R=await c(_,{getShowInfo:k=>{const D=`Converting ${Q(t)} CETUS to ${Q(t)} xCETUS`,A={modalTitleText:"Convert",modalDescriptionText:D,toastDescriptionContent:D};if(k==="success"){const L=D.replace("Converting","Converted");A.modalDescriptionText=L,A.toastDescriptionContent=L}return A}},{msafeParams:{action:H.xCETUSConvert,txbParams:f}});y(!1),R&&(s&&o(s==null?void 0:s.address,!0),i(""),n(""),x(),r())},T=m.useMemo(()=>{const f={text:"Convert",disabled:!1};return s!=null&&s.address?+t?(+t&&Z(t).gt((a==null?void 0:a.balanceFormat)||0)&&(f.disabled=!0,f.text="Insufficient CETUS Balance"),f):(f.text="Enter an amount",f.disabled=!0,f):(f.text="Connect Wallet",f.disabled=!1,f)},[a==null?void 0:a.balanceFormat,s==null?void 0:s.address,t]);return{inputAmountFrom:t,inputAmountTo:d,handleInputChange:h,balanceInfoFrom:a,convertLoading:b,btnText:T.text,btnDisabled:T.disabled,handleConvertClick:g}}function ue(x){const{isOpen:r,onClose:c,onSubmitClick:s}=x,{setShowConvertModel:o}=M(),[l,u]=m.useState(!1);return e.jsxs(xe,{autoFocus:!1,returnFocusOnClose:!1,isOpen:r,onClose:c,isCentered:!0,children:[e.jsx(pe,{}),e.jsxs(me,{children:[e.jsx(he,{children:e.jsx(Ce,{fontWeight:"500",fontSize:"16px"})}),e.jsx(be,{}),e.jsx(ge,{textAlign:"center",p:"0px",children:e.jsxs(B,{w:"100%",gap:"20px",p:"20px",pb:"90px",pos:"relative",children:[e.jsx(Xe,{text_color:"text_caption",text_size:"14px",text:` Please note that after conversion, if you want to convert xCETUS back to CETUS, a vesting period will be applied & different vesting
              durations correspond to different redeem ratios. Learn more`,keywords:["Learn more"],onKeywordClick:()=>{window.open("https://cetus-1.gitbook.io/cetus-docs/tokenomics/xcetus","_blank")}}),e.jsxs(F,{children:[e.jsx(Ee,{checked:l,onClick:()=>{u(!l)}}),e.jsx(v,{color:"text_caption",children:"Do not remind again."})]}),e.jsx(te,{pos:"absolute",bottom:"0px",mt:"4px",w:"100%",h:"52px",borderRadius:"12px",fontSize:"16px",fontWeight:"500",onClick:()=>{o(!l),s()},children:"Convert"})]})})]})]})}function ot(x){const{availableXCetusAmount:r,iconParams:c,onIconClick:s}=x,{currentAccount:o,onWalletModal:l}=P(),{inputAmountFrom:u,inputAmountTo:t,handleInputChange:i,balanceInfoFrom:d,btnText:n,btnDisabled:a,handleConvertClick:h,convertLoading:b}=Be(),{showConvertModel:y}=M(),[g,T]=m.useState(!1);return e.jsxs(B,{w:"100%",gap:"8px",children:[e.jsx(de,{onClick:s,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:(d==null?void 0:d.balanceFormat)||"",value:u,amountValue:"",loading:!1,onChange:f=>{i(f)},selectable:!1,placeholder:"0.0",token:I.cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:O(r,9),value:t,half:!1,max:!1,amountValue:"",onChange:f=>{i(f)},selectable:!1,placeholder:"0.0",token:I.x_cetus_coin},iconParams:c}),e.jsx(te,{w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:a||b,isLoading:b,onClick:()=>{console.log(o,y,"showConvertModel"),o?y?T(!0):h():l(!0)},children:n}),g&&e.jsx(ue,{isOpen:g,onClose:()=>{T(!1)},onSubmitClick:()=>{T(!1),h()}})]})}function Ve(x){const{fetchAccountBalance:r}=V(),{fetchOwnerLockCetusList:c}=q(),{signAndExecuteTransaction:s}=W(),{currentAccount:o}=P(),{fetchOwnerVeNFT:l}=$(),{xCetusSdk:u}=U(),{veNFT:t}=M(),[i,d]=m.useState(""),[n,a]=m.useState(""),[h,b]=m.useState(180),[y,g]=m.useState(""),[T,f]=m.useState(!0),{balanceInfo:_}=ce(I.cetus_coin),R=(C,j)=>{f(j),j?d(C):a(C),D(C,j,h)},k=C=>{b(C),D(T?i:n,T,C)},D=async(C,j,E)=>{if(+C){const X=ee(C,9);if(j){const S=await u.XCetusModule.redeemNum(X,E);a(O(S.amount_out,9)),g(Z(S.percent).mul(100).toFixed(2,se.ROUND_DOWN))}else{const S=await u.XCetusModule.reverseRedeemNum(X,E);d(O(S.amount_out,9)),g(Z(S.percent).mul(100).toFixed(2,se.ROUND_DOWN))}}else d(""),a(""),g("")},[A,L]=m.useState(!1),J=async()=>{if(!t)return;L(!0);const C={venft_id:t.id,amount:ee(i,9).toFixed(0),lock_day:h},j=u.XCetusModule.redeemLockPayload(C),E=await s(j,{getShowInfo:X=>{const S=`Redeeming ${Q(i)} xCETUS to ${Q(n)} CETUS`,N={modalTitleText:"Redeem",modalDescriptionText:S,toastDescriptionContent:S};if(X==="success"){const p=S.replace("Redeeming","Redeemed");N.modalDescriptionText=p,N.toastDescriptionContent=p}return N}},{msafeParams:{action:H.xCETUSRedeemLock,txbParams:C}});L(!1),E&&(o&&l(o==null?void 0:o.address,!0),d(""),a(""),r(),c())},z=m.useMemo(()=>{const C={text:"Redeem",disabled:!1};return o!=null&&o.address?+i?(+i&&Z(i).gt(x||0)&&(C.disabled=!0,C.text="Insufficient xCETUS Balance"),C):(C.text="Enter an amount",C.disabled=!0,C):(C.text="Connect Wallet",C.disabled=!1,C)},[x,o==null?void 0:o.address,i]);return{inputAmountFrom:i,inputAmountTo:n,handleInputChange:R,balanceInfoTo:_,convertLoading:A,btnText:z.text,btnDisabled:z.disabled,handleConvertClick:J,day:h,handleDayChange:k,percent:y}}function Ne(x){const{day:r,onChange:c}=x,s=m.useMemo(()=>`${r}D`,[r]),o=[{label:"15D"},{label:"30D"},{label:"90D"},{label:"180D"}];return e.jsxs(ae,{children:[e.jsxs(F,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[e.jsxs(v,{fontSize:"16px",color:"text_caption",whiteSpace:"nowrap",children:[r," Days"]}),e.jsx(ye,{type:"outlineTab",tabList:o,currentTab:s,handleChangeTab:l=>{l.label==="MAX"?c(100):c(l.label.replace("D",""))},wrapStyle:{flex:"1",maxW:"300px",h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"12px",margin:"0px"}})]}),e.jsxs(Se,{"aria-label":"slider-ex-1",min:15,max:180,focusThumbOnChange:!1,value:Number(r),onChange:l=>c(l),children:[e.jsx(we,{h:"8px",children:e.jsx(Te,{h:"4px"})}),e.jsx(ve,{})]})]})}function at(x){const{availableXCetusAmount:r,iconParams:c,onIconClick:s}=x,{currentAccount:o,onWalletModal:l}=P(),{inputAmountFrom:u,inputAmountTo:t,handleInputChange:i,balanceInfoTo:d,btnText:n,btnDisabled:a,handleConvertClick:h,day:b,handleDayChange:y,percent:g,convertLoading:T}=Ve(r),{showConvertModel:f}=M(),[_,R]=m.useState(!1);return e.jsxs(B,{w:"100%",gap:"8px",children:[e.jsx(de,{onClick:s,borderRadius:"12px",from:{wrapStyle:{borderRadius:"12px"},title:"From",balance:r,value:u,amountValue:"",loading:!1,onChange:k=>{i(k,!0)},selectable:!1,placeholder:"0.0",token:I.x_cetus_coin},to:{wrapStyle:{borderRadius:"12px"},title:"To",balance:(d==null?void 0:d.balanceFormat)||"",value:t,half:!1,max:!1,amountValue:"",onChange:k=>{i(k,!1)},selectable:!1,placeholder:"0.0",token:I.cetus_coin},iconParams:c}),e.jsxs(oe,{borderRadius:"12px",p:{base:"16px 8px",lg:"16px"},children:[e.jsx(v,{mb:"16px",color:"primary_gray",children:"Vesting duration"}),e.jsx(Ne,{day:b,onChange:k=>{y(Number(k))}})]}),e.jsx(oe,{borderRadius:"12px",p:"0px",border:"none",children:e.jsxs(B,{w:"100%",gap:"20px",children:[e.jsx(te,{mt:"-1px",w:"100%",borderRadius:"12px",h:"56px",fontSize:"20px",fontWeight:"500",disabled:a||T,isLoading:T,onClick:()=>{o?f?R(!0):h():l(!0)},children:n}),+g&&e.jsx(F,{w:"100%",p:"34px 16px 20px",border:"1px solid",borderColor:"border",mt:"-34px",borderRadius:"12px",children:e.jsx(Ue,{label:"Redeem ratio",labelStyle:{fontSize:"14px"},value:re(g),valueStyle:{fontSize:"14px"}})})]})}),_&&e.jsx(ue,{isOpen:_,onClose:()=>{R(!1)},onSubmitClick:()=>{R(!1),h()}})]})}function rt(){const{fetchAccountBalance:x}=V(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{xCetusSdk:s}=U(),{veNFT:o}=M(),{fetchOwnerVeNFT:l}=$(),{currentAccount:u}=P(),[t,i]=m.useState(!1);return{handleCancelOrder:async n=>{if(!o)return;i(!0);const a={venft_id:o.id,lock_id:n.id},h=s.XCetusModule.cancelRedeemPayload(a),b=await c(h,{},{msafeParams:{action:H.xCETUSCancelRedeem,txbParams:a}});i(!1),b&&(x(),r(),u&&l(u==null?void 0:u.address,!0))},cancelOrderLoading:t}}function it(){const{fetchAccountBalance:x}=V(),{fetchOwnerLockCetusList:r}=q(),{signAndExecuteTransaction:c}=W(),{xCetusSdk:s}=U(),{veNFT:o}=M(),{fetchOwnerVeNFT:l}=$(),{currentAccount:u}=P(),[t,i]=m.useState(!1);return{handleClaimOrder:async n=>{if(i(!0),!o)return;const a={lock_id:n,venft_id:o.id},h=await s.XCetusModule.redeemPayload(a),b=await c(h,{},{useDevInspect:!1,msafeParams:{action:H.xCETUSRedeem,txbParams:a}});i(!1),b&&(x(),r(),u&&l(u==null?void 0:u.address,!0))},claimOrderLoading:t}}function ct({xcetus_amount:x,cetus_amount:r,imageSize:c="24px"}){const{isApp:s}=ie();return s?e.jsxs(B,{w:"100%",align:"center",gap:"8px",children:[e.jsxs(F,{children:[e.jsx(G,{imageUrl:I.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(v,{color:"text_caption",children:[K(O(x,9),9)," xCETUS"]})]}),e.jsx(v,{color:"text_caption",transform:"rotate(90deg)",children:"→"}),e.jsxs(F,{children:[e.jsx(G,{imageUrl:I.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(v,{color:"text_caption",children:[K(O(r,9),9)," CETUS "]})]})]}):e.jsxs(F,{children:[e.jsx(G,{imageUrl:I.x_cetus_coin.logo_url,p:"4px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(v,{color:"text_caption",children:[K(O(x,9),9)," xCETUS →"]}),e.jsx(G,{imageUrl:I.cetus_coin.logo_url,p:"2px",imgBoxStyle:{w:c,h:c,bg:"block_color",borderColor:"transparent",borderRadius:"20px"}}),e.jsxs(v,{color:"text_caption",children:[K(O(r,9),9)," CETUS "]})]})}function lt(){const{fetchAccountBalance:x}=V(),{signAndExecuteTransaction:r}=W(),{xCetusSdk:c}=U(),{veNFT:s}=M(),[o,l]=m.useState(!1),{fetchVeNFTDividendInfo:u}=le();return{handleClaimReward:async i=>{if(s){l(!0),console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:23 ~ handleClaimReward ~ rewardList:",i);try{const d=c.XCetusModule.redeemDividendV3Payload(s.id,i),n=await r(d,{},{useDevInspect:!0,msafeParams:{action:H.xCETUSClaimStakingRwewards,txbParams:{veNftId:s.id,rewardList:i}}});l(!1),n&&(x(),u(s.id))}catch(d){console.log("🚀 ~ file: useXCetusClaimRewardAction.ts:40 ~ handleClaimReward ~ error:",d)}finally{l(!1)}}},claimRewardLoading:o}}function dt({children:x}){const{isApp:r}=ie();return e.jsx(ke,{placement:r?"bottom-end":"top-start",maxW:{base:"calc(100vw - 16px)",lg:"unset"},tooltip:r?e.jsxs(ae,{as:"div",lineHeight:"20px",children:[e.jsx(v,{as:"span",fontSize:"12px",color:"text_caption",children:"The estimated APR of the current epoch for all xCETUS holders. "}),e.jsx(v,{as:"span",fontSize:"12px",color:"text_highlight",children:"APR = ($ Rewards of the upcoming week * 52) / $ Total xCETUS staked * 100% "}),e.jsx(v,{as:"span",fontSize:"12px",color:"text_caption",children:"Both real-time value of rewards and CETUS price will affect the APR fluctuation."})]}):e.jsxs(B,{alignItems:"start",children:[e.jsx(v,{whiteSpace:"nowrap",fontSize:"12px",color:"text_caption",children:"The estimated APR of the current epoch for all xCETUS holders."}),e.jsx(v,{whiteSpace:"nowrap",fontSize:"12px",color:"text_highlight",children:"APR = ($ Rewards of the upcoming week * 52) / $ Total xCETUS staked * 100%"}),e.jsx(v,{whiteSpace:"nowrap",fontSize:"12px",color:"text_caption",children:"Both real-time value of rewards and CETUS price will affect the APR fluctuation."})]}),children:x})}function We(){const{getTokenPrice:x,fetchTokenPrices:r}=je();return{refreshCoinPriceInfo:async(s,o=!1)=>{const l=new Set;o||s.forEach(u=>{x(u,6e5)||l.add(u)}),console.log("🚀 ~ refreshCoinPriceInfo ~ notFetchCoinList:",{notFetchCoinList:l,coinTypeList:s}),l.size>0&&await r(Array.from(l),!1)}}}function ut(){const{limitUserIndexerObj:x,setLimitUserIndexerObj:r,dcaUserIndexerObj:c,setDcaUserIndexerObj:s}=Fe(),{peripherySdk:o}=U();return{getLimitUserIndexer:async t=>{const i=x[t];if(i)return i;try{const d=new Me;o.LimitOrder.buildGetUserIndexerHandle(t,d);const n=await o.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:d,sender:_e("0x0")}),a=o.LimitOrder.parsedQueryUserIndexerEvent(n);if(a)return r(t,a),a}catch(d){throw console.log("🚀 ~ getLimitUserIndexer ~ error:",d),d}},getDcaUserIndexer:async t=>{const i=c[t];if(i)return i;try{const{dca:d}=o.sdkOptions,{user_indexer_id:n}=Ie(d),a=await o.ClmmSDK.fullClient.getDynamicFieldObject({parentId:n,name:{type:"address",value:t}}),h=Re(a).value.fields.id.id;if(h)return s(t,h),h}catch(d){throw console.log("🚀 ~ getDcaUserIndexer ~ error:",d),d}}}}function ft(x=!1){const{xCetusSdk:r}=U(),{currentAccount:c}=P(),{fetchAccountBalance:s}=V(),{refreshCoinPriceInfo:o}=We(),{lockCetusList:l,veNFTLoading:u,lockCetusListLoading:t,clearData:i,owner:d,veNFT:n,XCetusManager:a,setXCetusManager:h,setDividendManager:b,setPhaseDividendInfoMap:y,phaseDividendInfoMap:g}=M(),{nextStartTime:T,currentPeriod:f,calculateCurrPeriod:_}=Le(),{summaryRewardList:R,rewardList:k,totalRewardValue:D}=Oe(f),{fetchVeNFTDividendInfo:A}=le(),L=async p=>{try{const w=await r.XCetusModule.getXcetusManager(p);w&&h(w)}catch(w){console.log("🚀 ~ fetchXCetusManager ~ error:",w)}},J=async p=>{try{const w=await r.XCetusModule.getPhaseDividendInfo(p.toString());if(w)y(w);else{const fe=(p-1).toString();if(!g[fe]){const ne=await r.XCetusModule.getPhaseDividendInfo(p.toString());ne&&y(ne)}}}catch(w){console.log("🚀 ~ fetchXCetusManager ~ error:",w)}},z=async p=>{try{const w=await r.XCetusModule.getDividendManager(p);w&&b(w)}catch(w){console.log("🚀 ~ fetchXCetusManager ~ error:",w)}},{fetchOwnerVeNFT:C}=$(),j=m.useMemo(()=>{if(n&&c&&!t){const p=De.getAvailableXCetus(n,l);if(Y(p).gte(0))return p}return"0"},[n==null?void 0:n.xcetus_balance,l]),E=m.useMemo(()=>{if(n){const p=Y(n.xcetus_balance).sub(j);if(p.gte(0))return p.toFixed(0)}return"0"},[n==null?void 0:n.xcetus_balance,j]),X=m.useMemo(()=>{if(a&&n){const p=Y(n.xcetus_balance).div(a.treasury).mul(100);return Y(p).lt(.01)?"<0.01%":re(p.toString(),3)}return c?"0%":"--"},[a==null?void 0:a.treasury,n==null?void 0:n.xcetus_balance]),S=m.useMemo(()=>{if(f){let p=g[f.toString()];return p===void 0&&(p=g[(f-1).toString()]),p}},[g,f]),{cetusApr:N}=Pe(S,a==null?void 0:a.treasury);return m.useEffect(()=>{if(S){const p=S.bonus_types.map(w=>Ae(w,!1));p&&(p.push("0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"),o(p))}},[S==null?void 0:S.id]),m.useEffect(()=>{f&&f>0&&J(f)},[f]),m.useEffect(()=>{n&&!x&&A(n.id)},[n==null?void 0:n.id]),{fetchOwnerVeNFT:C,fetchAccountBalance:s,fetchXCetusManager:L,fetchDividendManager:z,fetchVeNFTDividendInfo:A,veNFTLoading:u,lockCetusListLoading:t,redeemingXCetusAmount:E,availableXCetusAmount:j,veNFT:n,myShare:X,nextStartTime:T,cetusApr:N,summaryRewardList:R,rewardList:k,totalRewardValue:D,lockCetusList:l,calculateCurrPeriod:_}}export{ot as C,dt as E,ct as X,rt as a,it as b,lt as c,ft as d,at as e,We as f,ut as g,st as u};
//# sourceMappingURL=useXCetus-Bb_yIIRb.js.map
