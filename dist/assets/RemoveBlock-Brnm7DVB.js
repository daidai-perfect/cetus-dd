import{b as Qe,a1 as Ne,r as w,a as Ve,aO as ae,j as i,V as ke,H as P,an as Ze,T as E,I as Pe,W as Me,a$ as Be,$ as le,B as ue,aH as Ie,R as et,a4 as tt,aa as xe,a7 as it,d as a,aP as ot,Y as st,aR as at,by as Y,a6 as re,aS as $e,k as lt,bB as nt,bC as pt,bD as dt,bE as mt}from"./index-D49RffYW.js";import{L as Te}from"./LockInput-D8hYvbJh.js";import{u as ct}from"./global-iZ7St_zm.js";import{c as _e,g as rt,b as xt,h as ut}from"./usePositionList-CyCzZNts.js";import{u as Ae,a as Ee}from"./useCurrentPos-CwMCqO3d.js";import{M as we}from"./msafe-oYBkW7LJ.js";import{u as gt}from"./useAccountBalance-D-weOZgA.js";import{u as bt}from"./useTransaction-i5gFyneH.js";import{u as yt}from"./usePosAdd-vnaoQeks.js";import{v as Fe}from"./index-BzKWeyUu.js";import{T as ht}from"./TradeInputGroup-C7m7R_Tz.js";import{A as St}from"./index-BVFwDyvF.js";import{u as Tt,R as ze}from"./ExpendItem-Dexzs6Wu.js";import{C as wt}from"./CetusTooltip-7TnGbJNH.js";import{R as kt}from"./RangeAlerts-CxanDQq5.js";const _t="/assets/img_farming@2x-CwRUS-3E.png";function At(){Qe();const{currentPosBaseInfo:t,farmsPosRewardsData:y,posPoolsRelatedData:V,posBaseListLoading:B,posPoolsOriginalData:e}=_e(),{currentPosPoolInfo:m}=Ae(),{currentAccount:S}=Ne(),{getCurrentPosBaseInfo:Q,getCurrentPosHistory:ne}=Ee(),{getFarmsRewardsData:pe}=rt(),{getClmmPosName:oe}=xt(),$=w.useMemo(()=>{var o;if(t!=null&&t.tokenName)return t==null?void 0:t.tokenName;{const j=(o=e==null?void 0:e[t==null?void 0:t.clmmPool])==null?void 0:o.index;return oe(t==null?void 0:t.index,j)||""}},[t==null?void 0:t.tokenName,t==null?void 0:t.index,t==null?void 0:t.clmmPool,e]),v=V[t==null?void 0:t.posId],U=(v==null?void 0:v.currentStatus)=="Active",d=y[t==null?void 0:t.id],l=(m==null?void 0:m.farmsRewarderList)||[],u=d==null?void 0:d.reduce((o,j)=>o+j.display_amount_owed,0),{toStakePos:I,toUnStakePos:k,toClaimPos:T,unstakeLoading:_,claimLoading:A}=Tt(),G=Ve(),de=o=>{G(`/position-detail/${o[0].parsedJson.wrapped_position_id}`,{replace:!0}),setTimeout(()=>{Q(S==null?void 0:S.address,o[0].parsedJson.wrapped_position_id,!0)},2e3)},F=async()=>{I(t==null?void 0:t.id,m==null?void 0:m.farmsPoolAddress,$,de)},c=()=>{G(`/position-detail/${t==null?void 0:t.posId}`,{replace:!0}),setTimeout(()=>{Q(S==null?void 0:S.address,t==null?void 0:t.posId,!0)},2e3)},ee=async()=>{k(t==null?void 0:t.id,t==null?void 0:t.farmsPool,$,c)},ge=()=>{setTimeout(()=>{pe([t])},2e3)},be=async()=>{T(t==null?void 0:t.id,t==null?void 0:t.farmsPool,ge)},me=w.useMemo(()=>(d==null?void 0:d.length)>0?d.reduce((o,j)=>ae(o).plus(j==null?void 0:j.display_amount_owed).toString(),"0"):"0",[d,S==null?void 0:S.address,A,_]);return i.jsx(i.Fragment,{children:((m==null?void 0:m.farmsPoolAddress)||ae(me).gt(0))&&i.jsxs(ke,{w:"100%",children:[i.jsxs(P,{w:"100%",zIndex:"1",p:{base:"12px 8px",lg:"12px 16px"},bgImage:_t,bgSize:"100% 100%",justify:"space-between",children:[i.jsxs(ke,{align:"flex-start",children:[i.jsxs(P,{children:[i.jsx(Ze,{src:"/images/icon_farms.png",w:"24px",h:"24px"}),i.jsx(E,{color:"primary_yellow",fontSize:"20px",children:"Farming"})]}),i.jsx(E,{color:"primary_yellow",fontSize:"14px",children:"Stake Position to Earn"})]}),i.jsxs(P,{gap:"4px",bg:"primary_yellow_opacity.10",p:"12px 16px",borderRadius:"100px",children:[i.jsx(E,{color:"primary",fontSize:"12px",fontWeight:"500",children:"APR"}),i.jsx(E,{color:"primary",fontSize:"12px",fontWeight:"500",children:i.jsx(St,{poolInfo:m,isPosition:!0,showAprSize:"12px"})}),i.jsxs(P,{gap:"4px",cursor:"pointer",onClick:()=>G("/farms"),sx:{_hover:{p:{color:"text_caption"},svg:{fill:"text_caption"}}},children:[i.jsx(E,{fontSize:"12px",ml:"8px",fontWeight:"500",children:"View"}),i.jsx(Pe,{boxW:"14px",boxH:"14px",xlinkHref:"#icon-icon_list_token"})]})]})]}),i.jsxs(Me,{mt:"-20px",p:{base:"28px 8px 12px",lg:"28px 16px 16px"},zIndex:"0",borderRadius:"0 0 12px 12px",borderTop:"none",children:[i.jsx(E,{children:"Farming Rewards"}),i.jsx(P,{w:"100%",flexWrap:"wrap",children:(d==null?void 0:d.length)>0&&ae(me).gt(0)?d==null?void 0:d.map(o=>{var j;return i.jsx(Be.Fragment,{children:ae(o==null?void 0:o.display_amount_owed).gt(0)&&i.jsx(ze,{coinType:(j=o==null?void 0:o.token)==null?void 0:j.coin_type,amount:o==null?void 0:o.display_amount_owed,tokenInfo:o==null?void 0:o.token,boxStyle:{mt:"16px",w:"calc(50% - 4px) "},textAlign:"left"},o==null?void 0:o.coinType)},o==null?void 0:o.rewarder_type)}):(l==null?void 0:l.length)>0?l==null?void 0:l.map(o=>i.jsx(ze,{coinType:o==null?void 0:o.coinType,amount:"0",boxStyle:{mt:"16px",w:"calc(50% - 4px) "},textAlign:"left"},o==null?void 0:o.coinType)):i.jsx(E,{textColor:"text_caption",textAlign:"right",mt:"8px",children:"--"})}),i.jsxs(P,{w:"100%",justify:"space-between",mt:"16px",children:[(t==null?void 0:t.posType)=="farms"&&i.jsx(le,{disabled:A||_,isLoading:_,variant:"outline",h:"40px",w:"50%",fontSize:"14px",onClick:ee,children:"Unstake"}),(t==null?void 0:t.posType)=="clmm"&&!U&&i.jsx(ue,{w:"50%",sx:{">button":{w:"100%"}},children:i.jsx(wt,{placement:"top",tooltip:i.jsx(E,{fontSize:"12px",lineHeight:"20px",w:"200px",children:"Farming rewards are only available for active positions."}),children:i.jsx(ue,{w:"100%",children:i.jsx(le,{disabled:!0,h:"40px",w:"100%",fontSize:"14px",children:"Stake"})})})}),(t==null?void 0:t.posType)=="clmm"&&U&&i.jsx(le,{disabled:A||_,isLoading:_,h:"40px",w:"50%",fontSize:"14px",onClick:F,children:"Stake"}),i.jsx(le,{disabled:A||_||ae(u).eq(0),isLoading:A,variant:"outline",h:"40px",w:"50%",fontSize:"14px",onClick:be,children:"Claim rewards"})]})]})]})})}function Rt(){const{clmmSdk:t}=Ie(),{peripherySdk:y}=et(),{getTokenAmountValue:V}=tt(),{getCoinAmountFromLiquidity:B}=ut(),{currentPosBaseInfo:e,posLiquidityData:m,posRewardsData:S,setPosBaseList:Q}=_e(),{getCurrentPosBaseInfo:ne,getCurrentPosHistory:pe}=Ee(),{preAdd:oe,showDisplayTokenALock:$,showDisplayTokenBLock:v}=yt(),{currentPosPoolInfo:U,currentPoolSqrtPrice:d,tokenAmountA:l,tokenAmountB:u,setIsFixedDisplayTokenA:I,setTokenAmountA:k,setTokenAmountB:T,slideValue:_,setSlideValue:A,isFixedDisplayTokenA:G,isPosDetailRefresh:de,currentPosDetailTab:F}=Ae(),c=S[e==null?void 0:e.posId],{slippage:ee,mevProtect:ge,maxCapForGas:be,transactionMode:me,customGasPrice:o}=ct(),[j,te]=w.useState(!1),[We,ye]=w.useState(""),r=e==null?void 0:e.displayTokenA,x=e==null?void 0:e.displayTokenB,Z=m[e==null?void 0:e.posId],X=xe(Z==null?void 0:Z.displayCoinAmountA,void 0,!0),J=xe(Z==null?void 0:Z.displayCoinAmountB,void 0,!0),De=V(r==null?void 0:r.coin_type,l),He=V(x==null?void 0:x.coin_type,u),[Re,se]=w.useState(""),ve=w.useRef("");w.useEffect(()=>{ve.current=Re},[Re]);const ce=()=>{k(""),T(""),te(!1),se(""),A("--")},je=it((s,p,h)=>{var q,b;const C=p?(q=e==null?void 0:e.displayTokenA)==null?void 0:q.decimals:(b=e==null?void 0:e.displayTokenB)==null?void 0:b.decimals,f=ot(s,C),M=e==null?void 0:e.tokenA,z=e==null?void 0:e.tokenB,n=e==null?void 0:e.lowerTick,g=e==null?void 0:e.upperTick,D=e==null?void 0:e.isReverse,L={amount:f,tokenA:M,tokenB:z,isTokenA:D?!p:p,lowerTick:n,upperTick:g,curSqrtPrice:d,isReverse:D,roundUp:!1},{displayCoinAmountA:H,displayCoinAmountB:O,liquidityAmount:R}=oe(L);if(ve.current===h){ye(R);const N=st(a(R).div(e==null?void 0:e.liquidity).mul(100).toNumber(),2,!0);a(N).gt(100)||a(N).eq(100)?(A(100),k(X),T(J)):(A(N),p?T(O||""):k(H||""))}else ce();te(!1)},500),[Ue,Ce]=w.useState(!1),he=()=>{if((l||u)&&at(e))if(Ue||Number(_)==100)fe(Number(_));else{const s=G?l:u;if(+s){const p=Fe();se(p),je(s,G,p)}}};w.useEffect(()=>{F=="remove"&&he()},[X,J]);const Ge=(s,p)=>{if(Ce(!1),ye(""),!s){ce();return}if(te(!0),I(p),p){if(k(s),a(s).eq(X)){T(J),A(100),se(""),te(!1);return}}else if(T(s),a(s).eq(J)){k(X),A(100),se(""),te(!1);return}if(+s){const h=Fe();se(h),je(s,p,h)}else te(!1),p?T(""):k("")},fe=s=>{if(Ce(!0),s==100)k(X),T(J);else{const p=e==null?void 0:e.tokenA,h=e==null?void 0:e.tokenB,C=xe(a(e==null?void 0:e.liquidity).mul(s).div(100).toString()||"0",0,!0),f=e==null?void 0:e.lowerTick,M=e==null?void 0:e.upperTick,z=e==null?void 0:e.isReverse,n={tokenA:p,tokenB:h,liquidity:C,currentSqrtPrice:d,lowerTick:f,upperTick:M,roundUp:!1};try{const{amountA:g,amountB:D}=B(n);ye(C);const K=z?D:g,L=z?g:D;k(a(K).gt(0)?K:""),T(a(L).gt(0)?L:"")}catch{k(""),T("")}}},Le=async s=>{const{posId:p,poolAddress:h,coinTypeA:C,coinTypeB:f,amountA:M,amountB:z,liquidity:n,lowerTick:g,upperTick:D,posType:K,rewarderCoinTypes:L,farmsPoolId:H,farmsPosId:O}=s,R=a(M).mul(a(1).sub(a(ee))),q=a(z.toString()).mul(a(1).sub(a(ee)));if(K==="clmm"){const b={coinTypeA:C,coinTypeB:f,pool_id:h,pos_id:p,delta_liquidity:n,min_amount_a:Y(R.toString(),0)||"",min_amount_b:Y(q.toString(),0)||"",collect_fee:!0,rewarder_coin_types:L},N=await t.Position.removeLiquidityTransactionPayload(b),ie={action:we.DecreaseLiquidity,txbParams:b};return{tx:N,msafeParams:ie}}else{const b={pool_id:H||"",coinTypeA:C,coinTypeB:f,position_nft_id:O||"",clmm_pool_id:h,min_amount_a:Y(R.toString(),0)||"",min_amount_b:Y(q.toString(),0)||"",collect_rewarder:!1,clmm_rewarder_types:L,delta_liquidity:n,unstake:!1,close_position:!1};return{tx:await y.Farms.removeLiquidityPayload(b),msafeParams:{action:"FarmingDecreaseLiquidity",txbParams:b}}}},qe=async s=>{const{posId:p,poolAddress:h,coinTypeA:C,coinTypeB:f,amountA:M,amountB:z,liquidity:n,lowerTick:g,upperTick:D,posType:K,rewarderCoinTypes:L,farmsPoolId:H,farmsPosId:O}=s,R=a(M).mul(a(1).sub(a(ee))),q=a(z.toString()).mul(a(1).sub(a(ee)));if(K==="clmm"){const b={coinTypeA:C,coinTypeB:f,pool_id:h,pos_id:p||"",min_amount_a:Y(R.toString(),0)||"",min_amount_b:Y(q.toString(),0)||"",rewarder_coin_types:L,collect_fee:!1},N=await t.Position.closePositionTransactionPayload(b),ie={action:we.RemoveLiquidity,txbParams:b};return{tx:N,msafeParams:ie}}else{const b={pool_id:H||"",coinTypeA:C,coinTypeB:f,position_nft_id:O||"",clmm_pool_id:h,min_amount_a:Y(R.toString(),0)||"",min_amount_b:Y(q.toString(),0)||"",collect_fee:!0,collect_rewarder:!0,clmm_rewarder_types:L,delta_liquidity:n,unstake:!0,close_position:!0,clmm_position_id:p},N=await y.Farms.removeLiquidityPayload(b),ie={action:we.FarmingRemoveLiquidity,txbParams:b};return{tx:N,msafeParams:ie}}},{currentAccount:W}=Ne(),Xe=w.useMemo(()=>{const s={text:"Remove",disabled:!1};return W!=null&&W.address?!+l&&!+u?(s.text="Enter an amount",s.disabled=!0,s):!$&&l&&a(l).gt(X||0)||!v&&u&&a(u).gt(J||0)?(s.disabled=!0,s.text="Invalid Amount",s):((e==null?void 0:e.posType)=="burn"&&(s.disabled=!0),s):(s.text="Connect Wallet",s.disabled=!1,s)},[l,u,X,J,W==null?void 0:W.address]),{signAndExecuteTransaction:Je}=bt(),{fetchAccountBalance:Ke}=gt(),[Oe,Se]=w.useState(!1),Ye=Ve();return{resetInputAmount:ce,showDisplayTokenALock:$,showDisplayTokenBLock:v,currentPosLiquidityData:Z,getRemoveTsPayload:Le,getCloseTsPayload:qe,tokenABalance:X,tokenBBalance:J,displayTokenA:r,displayTokenB:x,tokenAmountValueA:De,tokenAmountValueB:He,preRemoveLoading:j,handleAmountChange:Ge,btnStatusText:Xe,changeSlideFun:fe,toRemove:async()=>{var f,M,z;Se(!0);const s=e!=null&&e.isReverse?a(u).mul(re.pow(10,x.decimals)).toString():a(l).mul(re.pow(10,r.decimals)).toString(),p=e!=null&&e.isReverse?a(l).mul(re.pow(10,r.decimals)).toString():a(u).mul(re.pow(10,x.decimals)).toString(),h=_==100,C=h?!c||(c==null?void 0:c.length)==0?(f=(U==null?void 0:U.miningRewardList)||[])==null?void 0:f.reduce((n,g)=>(n.push(g.coinType),n),[]):(M=c||[])==null?void 0:M.reduce((n,g)=>(n.push(g.coin_address),n),[]):(z=c||[])==null?void 0:z.reduce((n,g)=>(a(g==null?void 0:g.amount_owed).gt(0)&&n.push(g.coin_address),n),[]);try{const n={posId:(e==null?void 0:e.posType)=="farms"?e==null?void 0:e.id:e==null?void 0:e.posId,poolAddress:e==null?void 0:e.clmmPool,coinTypeA:e==null?void 0:e.coinTypeA,coinTypeB:e==null?void 0:e.coinTypeB,amountA:s,amountB:p,liquidity:We,lowerTick:e==null?void 0:e.lowerTick,upperTick:e==null?void 0:e.upperTick,posType:e==null?void 0:e.posType,rewarderCoinTypes:C};(e==null?void 0:e.posType)=="farms"&&(n.farmsPoolId=e==null?void 0:e.farmsPool,n.farmsPosId=e==null?void 0:e.id);const{tx:g,msafeParams:D}=h?await qe(n):await Le(n);await Je(g,{getShowInfo:(L,H)=>{const O=!$&&!v?`Remove ${l} ${r==null?void 0:r.symbol} and ${u} ${x==null?void 0:x.symbol}`:$?v?"Remove":`Remove ${u} ${x==null?void 0:x.symbol}`:`Remove ${l} ${r==null?void 0:r.symbol}`,R={modalDescriptionText:O,toastTitleText:O};if(L==="success"){let q=l,b=u;H&&(q=$e(H,r)||l,b=$e(H,x)||u);const N=!$&&!v?`Removed Liquidity ${q} ${r==null?void 0:r.symbol} and ${b} ${x==null?void 0:x.symbol}`:$?v?"Removed Liquidity":`Removed Liquidity ${b} ${x==null?void 0:x.symbol}`:`Removed Liquidity ${q} ${r==null?void 0:r.symbol}`;R.toastDescriptionContent="",R.modalDescriptionText="",R.toastTitleText="Remove Liquidity Successful"}return R}},{useMev:ge,useFastMode:me==="Fast Mode",maxCapForGas:be,customGasPrice:o,msafeParams:D})?(Ke(),ce(),h?(Q([]),Ye("/pools?tab=positions")):ne(W==null?void 0:W.address,e==null?void 0:e.id,!0)):he(),Se(!1)}catch{he(),Se(!1)}},isRemoveLoading:Oe}}function Gt(){const{currentPosBaseInfo:t,posPoolsRelatedData:y}=_e(),{tokenAmountA:V,tokenAmountB:B,isFixedDisplayTokenA:e,slideValue:m,setSlideValue:S,curPosContractPoolInfo:Q}=Ae(),{tokenABalance:ne,tokenBBalance:pe,displayTokenA:oe,displayTokenB:$,tokenAmountValueA:v,tokenAmountValueB:U,preRemoveLoading:d,handleAmountChange:l,changeSlideFun:u,btnStatusText:I,toRemove:k,isRemoveLoading:T,showDisplayTokenALock:_,showDisplayTokenBLock:A,resetInputAmount:G}=Rt();w.useEffect(()=>()=>{G()},[]);const de=c=>{c=="MAX"||c==100?(S(100),u(100)):(S(Number(c.split("%")[0])),u(Number(c.split("%")[0])))};w.useEffect(()=>S("--"),[]);const F=y[t==null?void 0:t.posId];return i.jsxs(ke,{w:"100%",gap:"8px",children:[i.jsxs(ue,{w:"100%",position:"relative",children:[i.jsx(ht,{from:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:ne||"",value:V,amountValue:v,loading:!e&&d,onChange:c=>{l(c,!0)},needRemainBalance:!1,placeholder:"0.0",balanceLabel:"Available",token:oe,half:!1},to:{wrapStyle:{h:"108px",borderRadius:"12px"},balance:pe||"",value:B,amountValue:U,loading:e&&d,onChange:c=>{l(c,!1)},needRemainBalance:!1,placeholder:"0.0",balanceLabel:"Available",token:$,half:!1}}),(!t||!Q)&&i.jsx(Te,{position:"absolute",top:"0px",left:"0",borderRadius:"12px",h:"224px",zIndex:9999}),t&&(t==null?void 0:t.posType)=="burn"&&i.jsx(Te,{position:"absolute",top:"0px",left:"0",h:"224px",borderRadius:"12px",text:"Your liquidity has been permanently locked",zIndex:9999}),t&&Q&&(_||A)&&i.jsx(Te,{position:"absolute",top:_?"0px":"116px",borderRadius:"12px",h:"108px",left:"0"})]}),(t==null?void 0:t.posType)!=="burn"&&i.jsxs(Me,{borderRadius:"12px",p:"16px",children:[i.jsx(E,{color:"primary_gray",children:"Amount"}),i.jsx(vt,{percentage:m,onChange:c=>de(c)})]}),i.jsx(le,{isLoading:T,onClick:k,disabled:I.disabled||T,w:"100%",h:"56px",fontSize:"20px",fontWeight:"500",children:I.text}),(t==null?void 0:t.posType)!=="burn"&&i.jsx(At,{}),F&&(F==null?void 0:F.minPrice)!=="0"&&(F==null?void 0:F.maxPrice)!=="∞"&&i.jsx(kt,{subscriptionSource:"PositionDetail"})]})}function vt(t){const{percentage:y,onChange:V}=t,B=w.useMemo(()=>y!==100?`${y}%`:"MAX",[y]),e=[{label:"25%"},{label:"50%"},{label:"75%"},{label:"MAX"}];return i.jsxs(ue,{children:[i.jsxs(P,{w:"100%",justifyContent:"space-between",m:"10px 0",children:[i.jsxs(E,{fontSize:"24px",color:"text_caption",children:[y=="--"?"--":a(y).gt(0)&&Number(y)<.01?"<0.01":xe(y,2),"%"]}),i.jsx(lt,{type:"outlineTab",tabList:e,currentTab:B,handleChangeTab:m=>{m.label==="MAX"?V(100):V(m.label.replace("%",""))},wrapStyle:{w:{base:"220px",lg:"310px"},h:"32px",p:"3px",borderRadius:"8px"},itemStyle:{flex:"1",fontSize:"14px",margin:"0px"}})]}),i.jsxs(nt,{"aria-label":"slider-ex-1",min:0,max:100,focusThumbOnChange:!1,value:y=="--"?0:Number(y),onChange:m=>V(m+"%"),children:[i.jsx(pt,{children:i.jsx(dt,{})}),i.jsx(mt,{})]})]})}export{At as F,vt as P,Gt as R};
